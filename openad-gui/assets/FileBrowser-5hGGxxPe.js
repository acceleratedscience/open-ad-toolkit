import{d as q,A as G,q as H,i as J,j as w,c as N,D as M,J as U,H as K,I as P,o,a as r,z as i,F as p,r as f,G as h,t as d,e as C,g as E,f as R,x as O,y as Q,_ as X}from"./index-p_WFAwHj.js";import g from"./SvgServe-AotVP2aT.js";const F=y=>(O("data-v-7a28e69e"),y=y(),Q(),y),Y={id:"col-wrap"},Z=F(()=>i("div",{class:"column filler-left"},[i("div",{class:"col-header"}),i("div",{class:"col-body"})],-1)),ee=["title","onClick"],te={class:"col-body"},ae=["title","onClick"],se=["title","onClick"],le=["data-type","data-ext","title","onClick","onDblclick"],ie=["data-type","data-ext","title","onClick","onDblclick"],ne={key:0,class:"empty"},oe={key:0,class:"col-split"},ce={key:0,class:"column file-preview"},re=["title"],ue={id:"file-preview"},de={class:"soft"},me=F(()=>i("br",null,null,-1)),ve=F(()=>i("div",{class:"column filler-right"},[i("div",{class:"col-header"}),i("div",{class:"col-body"})],-1)),pe=q({__name:"FileBrowser",setup(y){const x=G(),z=H(),A=J().loadApi("fileSystem"),s=w(null),u=w(null),_=w(null),m=w(null),B=N(()=>m.value?m.value[m.value.length-1]:void 0),D=N(()=>m.value?m.value[m.value.length-2]:void 0);M(async()=>{s.value=s.value?s.value:[],S(),window.addEventListener("popstate",S)}),U(()=>{window.removeEventListener("popstate",S)});async function S(){await k();const n=z.path.replace(/(^\/headless)?\/~(\/)?/,"").split("/").filter(a=>!!a);for(const[a,e]of n.entries()){const c=n.slice(0,a+1).join("/");await k(c,e,a+1)}const l=z.hash.replace(/^#/,"");if(s.value&&l&&l.length>0){const a=s.value[s.value.length-1],c=a.files.concat(a.files_hidden).filter(v=>v.filename===l)[0];L(c,s.value.length)}}async function L(t,n){const l=new RegExp("/?"+t.filename+"$"),a=t.path.replace(l,"");x.push("/~/"+a+"#"+t.filename),b(n-1),t.sel=!0,t.disp_size=K(t._meta.size),t.disp_time_created=P(t._meta.time_created),t.disp_time_edited=P(t._meta.time_edited),s.value&&s.value.splice(n),u.value=t}function W(){u.value=null}function I(t){x.push("/~/"+t.path)}async function k(t="",n="",l=0,a=!1){a&&x.push("/~/"+t),l>0&&$(l-1,"dir",n);const e=await j(t);e&&(W(),s.value&&(s.value.splice(l),s.value[l]=e));const c=B.value?B.value.clientWidth:0,v=D.value?D.value.clientWidth:0,T=_.value?_.value.scrollWidth-c-v:0;_.value&&(_.value.scrollLeft=T)}function $(t,n,l){if(b(t),s.value){const a=s.value[t],c=(n=="dir"?a.dirs.concat(a.dirs_hidden):a.files.concat(a.files_hidden)).filter(v=>v.filename===l)[0];c.sel=!0}}async function V(t){s.value&&s.value.splice(t+1),b(t),W()}function b(t){s.value&&(s.value[t].dirs.forEach(n=>n.sel=!1),s.value[t].dirs_hidden.forEach(n=>n.sel=!1),s.value[t].files.forEach(n=>n.sel=!1),s.value[t].files_hidden.forEach(n=>n.sel=!1))}async function j(t=""){if(!A)return;const{status:n,data:l,statusText:a}=await A.get_workspace_files(t);if(n!==200){console.error(a);return}else return l}return(t,n)=>(o(),r("div",{id:"col-scroll-x",ref_key:"colScroll",ref:_},[i("div",Y,[Z,(o(!0),r(p,null,f(s.value,(l,a)=>(o(),r(p,{key:a},[i("div",{class:"column",ref_for:!0,ref_key:"columns",ref:m},[i("div",{class:h(["col-header",{root:a==0}]),title:l._meta.name,onClick:e=>V(a)},d(l._meta.name),11,ee),i("div",te,[(o(!0),r(p,null,f(l.dirs_hidden,(e,c)=>(o(),r("div",{key:c,class:h(["dir hidden",{sel:e.sel}]),title:e.filename,onClick:()=>k(e.path,e.filename,a+1,!0)},[i("div",null,d(e.filename),1),(o(),C(g,{filename:"icn-caret-right",key:e.filename}))],10,ae))),128)),(o(!0),r(p,null,f(l.dirs,(e,c)=>(o(),r("div",{key:c,class:h(["dir",{sel:e.sel}]),title:e.filename,onClick:()=>k(e.path,e.filename,a+1,!0)},[i("div",null,d(e.filename),1),(o(),C(g,{filename:"icn-caret-right",key:e.filename}))],10,se))),128)),(o(!0),r(p,null,f(l.files_hidden,(e,c)=>(o(),r("div",{key:c,class:h(["file hidden",{sel:e.sel}]),"data-type":e._meta.type,"data-ext":e._meta.ext,title:e.filename,onClick:()=>L(e,a+1),onDblclick:v=>I(e)},[(o(),C(g,{filename:"icn-"+e._meta.type,key:e._meta.type},null,8,["filename"])),i("div",null,d(e.filename),1)],42,le))),128)),(o(!0),r(p,null,f(l.files,(e,c)=>(o(),r("div",{key:c,class:h(["file",{sel:e.sel}]),"data-type":e._meta.type,"data-ext":e._meta.ext,title:e.filename,onClick:()=>L(e,a+1),onDblclick:v=>I(e)},[(o(),C(g,{filename:"icn-"+e._meta.type,key:e._meta.type},null,8,["filename"])),i("div",null,d(e.filename),1)],42,ie))),128)),l._meta.empty?(o(),r("div",ne,"Empty directory")):E("",!0)])],512),s.value&&a<s.value.length-1||u.value?(o(),r("div",oe)):E("",!0)],64))),128)),u.value?(o(),r("div",ce,[i("div",{class:"col-header",title:u.value._meta.name},d(u.value._meta.name),9,re),i("div",ue,[i("b",null,d(u.value._meta.name),1),i("small",null,[i("i",null,d(u.value.disp_size),1),i("div",de,[R(" Created: "+d(u.value.disp_time_created),1),me,R(" Last edit: "+d(u.value.disp_time_edited),1)])])])])):E("",!0),ve])],512))}}),ye=X(pe,[["__scopeId","data-v-7a28e69e"]]);export{ye as default};
