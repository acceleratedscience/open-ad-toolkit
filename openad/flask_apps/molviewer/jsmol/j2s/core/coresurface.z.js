(function(eb,cc,dc,ec,D,fc,O,T,F,P,H,y,gc,W,hc,Y,u,Z,w,Aa,ha,da,g,Ha,ma,na,$,ta,va,ua,B,ic,jc,Ia,kc,lc,mc,nc,Ja,fb,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,d,m){O("JS");F(null,"JS.ScriptExt",["JU.AU"],function(){c$=H(function(){this.e=this.vwr=null;this.chk=!1;this.st=null;this.slen=0;P(this,arguments)},JS,"ScriptExt");d(c$,"init",function(a){this.e=a;this.vwr=this.e.vwr;return this},"~O");d(c$,"atomExpressionAt",function(a){return this.e.atomExpressionAt(a)},"~N");d(c$,"checkLength",
function(a){this.e.checkLength(a)},"~N");d(c$,"error",function(a){this.e.error(a)},"~N");d(c$,"invArg",function(){this.e.invArg()});d(c$,"invPO",function(){this.error(23)});d(c$,"getShapeProperty",function(a,b){return this.e.getShapeProperty(a,b)},"~N,~S");d(c$,"paramAsStr",function(a){return this.e.paramAsStr(a)},"~N");d(c$,"centerParameter",function(a){return this.e.centerParameter(a,null)},"~N");d(c$,"floatParameter",function(a){return this.e.floatParameter(a)},"~N");d(c$,"getPoint3f",function(a,
b){return this.e.getPoint3f(a,b,!0)},"~N,~B");d(c$,"intParameter",function(a){return this.e.intParameter(a)},"~N");d(c$,"isFloatParameter",function(a){switch(this.e.tokAt(a)){case 2:case 3:return!0}return!1},"~N");d(c$,"setShapeProperty",function(a,b,c){this.e.setShapeProperty(a,b,c)},"~N,~S,~O");d(c$,"showString",function(a){this.e.showString(a)},"~S");d(c$,"stringParameter",function(a){return this.e.stringParameter(a)},"~N");d(c$,"getToken",function(a){return this.e.getToken(a)},"~N");d(c$,"tokAt",
function(a){return this.e.tokAt(a)},"~N");d(c$,"setShapeId",function(a,b,c){c&&this.invArg();b=this.e.setShapeNameParameter(b).toLowerCase();this.setShapeProperty(a,"thisID",b);return b},"~N,~N,~B");d(c$,"getColorTrans",function(a,b,c,e){c=3.4028235E38;1765808134!=a.theTok&&--b;switch(this.tokAt(b+1)){case 603979967:b++;c=this.isFloatParameter(b+1)?a.getTranslucentLevel(++b):this.vwr.getFloat(570425353);break;case 1073742074:b++,c=0}a.isColorParam(b+1)?e[0]=a.getArgbParam(++b):1073742333==this.tokAt(b+
1)?(e[0]=0,a.iToken=b+1):3.4028235E38==c?this.invArg():e[0]=-2147483648;return c},"JS.ScriptEval,~N,~B,~A");d(c$,"finalizeObject",function(a,b,c,e,k,h,f,d){k&&this.setShapeProperty(a,"set",h);-2147483648!=b&&this.e.setShapePropertyBs(a,"color",Integer.$valueOf(b),d);3.4028235E38!=c&&this.e.setShapeTranslucency(a,"","translucent",c,d);0!=e&&this.setShapeProperty(a,"scale",Integer.$valueOf(e));0<f&&(this.e.setMeshDisplayProperty(a,f,0)||this.invArg())},"~N,~N,~N,~N,~B,~O,~N,JU.BS");d(c$,"getIntArray2",
function(a){a=this.e.getToken(a).getList();for(var b=JU.AU.newInt2(a.size()),c=b.length;0<=--c;){var e=a.get(c).getList();null==e&&this.invArg();b[c]=u(e.size(),0);for(var k=b[c].length;0<=--k;)b[c][k]=e.get(k).intValue}return b},"~N");d(c$,"getAllPoints",function(a,b){var c=null,e=null;try{switch(this.e.tokAt(a)){case 7:c=this.e.getPointArray(a,-1,!1);break;case 12290:case 10:case 1073742325:e=this.atomExpressionAt(a)}null==c&&(null==e&&(e=this.vwr.getAllAtoms()),c=this.bsToArray(e))}catch(k){if(!Y(k,
Exception))throw k;}(null==c||c.length<b)&&this.invArg();return c},"~N,~N");d(c$,"bsToArray",function(a){for(var b=Array(a.cardinality()),c=a.nextSetBit(0),e=0;0<=c;c=a.nextSetBit(c+1))b[e++]=this.vwr.ms.at[c];return b},"JU.BS")});O("JS");F(["JS.ScriptExt"],"JS.IsoExt","java.lang.Boolean $.Float $.Short JU.AU $.BS $.Lst $.M4 $.Measure $.P3 $.PT $.Quat $.SB $.V3 J.api.Interface J.atomdata.RadiusData J.c.VDW JS.SV $.ScriptEval $.ScriptInterruption $.T JU.BSUtil $.BoxInfo $.C $.Escape $.Logger $.Parser $.TempArray $.Triangulator JV.JC".split(" "),
function(){c$=Aa(JS,"IsoExt",JS.ScriptExt);W(c$,function(){da(this,JS.IsoExt,[])});m(c$,"dispatch",function(a,b,c){this.chk=this.e.chk;this.slen=this.e.slen;this.st=c;switch(a){case 23:this.cgo();break;case 25:this.contact();break;case 17:this.dipole();break;case 22:this.draw();break;case 24:case 30:case 29:this.isosurface(a);break;case 26:this.lcaoCartoon();break;case 27:case 28:this.mo(b,a)}return null},"~N,~B,~A");d(c$,"dipole",function(){var a=this.e,b=null,c=null,e=!1,k=!1,h=!1,f=!1,d=null;a.sm.loadShape(17);
if(!(1073742001==this.tokAt(1)&&this.listIsosurface(17)))if(this.setShapeProperty(17,"init",null),1==this.slen)this.setShapeProperty(17,"thisID",null);else{for(var j=1;j<this.slen;++j){c=b=null;switch(this.getToken(j).tok){case 1073742327:b="all";f=!0;break;case 1073742335:b="on";break;case 1073742334:b="off";break;case 12291:b="delete";break;case 2:case 3:b="value";c=Float.$valueOf(this.floatParameter(j));break;case 10:10==this.tokAt(j+1)?this.setShapeProperty(17,"startSet",this.atomExpressionAt(j++)):
b="atomBitset";case 1073742325:null==b&&(b=e||k?"endSet":"startSet");c=d=this.atomExpressionAt(j);j=a.iToken;0==this.tokAt(j+1)&&"startSet"===b&&(b="atomBitset");f=e=!0;break;case 1073742332:case 8:c=this.getPoint3f(j,!0);j=a.iToken;b=e||k?"endCoord":"startCoord";k=!0;break;case 1677721602:b="bonds";f=!0;break;case 4102:f=!0;b="calculate";a.isAtomExpression(j+1)&&(c=d=this.atomExpressionAt(++j),j=a.iToken);break;case 1073741974:this.setShapeId(17,++j,h);j=a.iToken;break;case 1275069442:b="cross";
c=Boolean.TRUE;break;case 1073742040:b="cross";c=Boolean.FALSE;break;case 1073742066:this.isFloatParameter(j+1)?(c=this.floatParameter(++j),2==a.theTok?(b="offsetPercent",c=Integer.$valueOf(y(c))):(b="offset",c=Float.$valueOf(c))):(b="offsetPt",c=this.centerParameter(++j),j=a.iToken);break;case 1073742068:b="offsetSide";c=Float.$valueOf(this.floatParameter(++j));break;case 1073742188:b="value";c=Float.$valueOf(this.floatParameter(++j));break;case 1073742196:b="width";c=Float.$valueOf(this.floatParameter(++j));
break;default:if(268441089==a.theTok||JS.T.tokAttr(a.theTok,1073741824)){this.setShapeId(17,j,h);j=a.iToken;break}this.invArg()}h=12291!=a.theTok&&4102!=a.theTok;f&&(this.chk||a.getPartialCharges(d),f=!1);null!=b&&this.setShapeProperty(17,b,c)}(k||e)&&this.setShapeProperty(17,"set",null)}});d(c$,"draw",function(){var a=this.e;a.sm.loadShape(22);switch(this.tokAt(1)){case 1073742001:if(this.listIsosurface(22))return;break;case 136314895:case 134221850:case 4138:this.e.getCmdExt().dispatch(4133,!1,
this.st);return}for(var b=!1,c=!1,e=!1,k=!1,h=!1,f,d=null,j=0,p=3.4028235E38,l=u(-1,[-2147483648]),g=0,r="",L=0,v=null,qa=this.initIsosurface(22),m=(f=null!=qa)&&null==this.getShapeProperty(22,"ID"),w=null,Ka=0,oa=-1,aa=-1,I=!1,E=0,A=null,q=a.iToken;q<this.slen;++q){var K=null,G=null,E=this.getToken(q).tok;switch(E){case 134217763:switch(E=this.getToken(q+(1073741864==this.tokAt(q+1)?2:1)).tok){case 1814695966:case 1812599299:j=E;k=!0;continue;case 1073742330:++q;K="intersect";G=a.objectNameParameter(++q);
b=k=!0;break;default:this.invArg()}break;case 1073741864:I=!0;aa==q-1&&aa++;switch(this.tokAt(q+1)){case 134217750:case 1073741998:case 1812599299:continue;default:this.invArg()}break;case 1073741994:case 1814695966:case 1812599299:var N=f=A=null;switch(E){case 1812599299:switch(this.tokAt(q+1)){case 1073741864:switch(this.tokAt(q+2)){case 134217750:case 1073741998:break;case 1073742330:d=B(-1,[a.objectNameParameter(q+3),null]);if(this.chk)return;this.vwr.shm.getShapePropertyData(24,"points",d);d=
d[1];null==d&&this.invArg();q+=2;default:I=!0,q++}break;case 10:case 1073742325:N=a.getAtomsStartingAt(q+1),q=a.iToken}break;case 1814695966:I&&this.invArg(),a.isArrayParameter(q+1)&&(f=this.vwr.getSymTemp().getUnitCell(a.getPointArray(q+1,-1,!1),!1,null),q=a.iToken),1073741994==this.tokAt(q+1)&&(1814695966==j&&(j=1073741994),++q,A=a.checkHKL(a.getPointOrPlane(++q,3)),q=a.iToken)}if(this.chk)break;null!=N?I&&(f=this.vwr.getSymTemp().getUnitCell(this.vwr.getOrientation(1814695966,"array",N,null),!1,
null)):I?f=this.vwr.getSymTemp().getUnitCell(this.vwr.getOrientation(1814695966,"array",null,d),!1,null):1814695966==E&&null==f&&(f=this.vwr.getCurrentUnitCell());if(null==A)d=this.getBoxPoints(null!=f?1814695966:E,f,N,g/100);else{N=JU.Measure.getLatticePoints(f.getLatticeCentering(),y(A.x),y(A.y),y(A.z));d=Array(N.size());for(E=0;E<N.size();E++)d[E]=N.get(E),f.toCartesian(d[E],!0)}I=!1;if(!k){null==d&&this.invArg();K="polygon";f=new JU.Lst;f.addLast(d);null==A?(this.vwr.getTriangulator(),f.addLast(JU.Triangulator.fullCubePolygon)):
f.addLast(null);G=f;b=!0;g=0;break}1073742335==this.tokAt(q+1)&&(aa=++q);break;case 1073741998:case 134219777:case 134217750:A=aa==q-1;if(!b&&!k&&0==j){if(134219777==a.theTok){b=!0;this.setShapeProperty(22,"plane",null);E=new JU.Lst;a.hklParameter(++q,E,!0);q=a.iToken;K="coords";G=E;break}if(!I){K=134217750==E?"plane":"line";oa=q+1;break}!this.chk&&(1073741998!=E&&null==d)&&(f=this.vwr.getCurrentUnitCell(),j=null==f?1812599299:1814695966,d=this.getBoxPoints(j,f,null,g/100),k=!0)}N=f=null;switch(E){case 134217750:f=
a.planeParameter(q,I);break;case 134219777:f=a.hklParameter(++q,null,!0);break;case 1073741998:1073741994==j&&this.invArg(),N=I?this.bsToArray(a.getAtomsStartingAt(++q)):a.isCenterParameter(q+1)?B(-1,[this.centerParameter(++q),this.centerParameter(a.iToken+1)]):a.getPointArray(++q,2,!1),2>N.length&&this.invArg()}q=a.iToken;b=!0;if(this.chk)break;if(1073741998==E){N=JU.Measure.getBestLineThroughPoints(N,-1);if(0!=j&&(f=JU.V3.newVsub(N[1],N[0]),f.scale(1/f.length()),N=A?JU.Measure.getProjectedLineSegment(d,
-1,N[0],f,null):this.vwr.getTriangulator().intersectLine(d,-1,N[0],f),null==N||null==N[1]))return;c||(this.setShapeProperty(22,"points",Integer.$valueOf(g)),c=!0);E=new JU.Lst;E.addLast(N[0]);E.addLast(N[1]);this.setShapeProperty(22,"coords",E);break}0==j?(G=f,K="planedef"):(1073741994==j?(K="polygon",N=JU.Measure.getPointsOnPlane(d,f),d=N.toArray(Array(N.size())),f=new JU.Lst,f.addLast(d),f.addLast(null),G=f):(K="polygon",G=this.vwr.getTriangulator().intersectPlane(f,d,A?-1:0)),g=0);break;case 1275068447:d=
a.isArrayParameter(++q)?a.getPointArray(q,-1,!1):null;null==d&&a.isAtomExpression(q)&&(N=a.atomExpressionAt(q),d=this.vwr.ms.getAtomPointVector(N).toArray(Array(N.cardinality())));null!=d&&(q=a.iToken+1,12289==this.tokAt(q)&&(v=a.centerParameter(++q,null),q=a.iToken+1));switch(this.tokAt(q)){case 536875009:c="";break;case 1111490563:c="Cs";break;case 1073742330:d=B(-1,[a.objectNameParameter(++q),null]);if(this.chk)return;this.vwr.shm.getShapePropertyData(21,"points",d);d=d[1];null==d&&this.invArg();
c="";break;case 1275203608:c=":poly";break;case 134217764:null==v&&(v=new JU.P3);c=this.vwr.ms.generateCrystalClass(this.vwr.bsA().nextSetBit(0),JU.P3.new3(NaN,NaN,NaN));null!=d&&this.invArg();d=Array(c.size());for(E=c.size();0<=--E;)d[E]=c.get(E);q++;c="";break;default:c=a.optParameterAsString(q)}g=0==g?1:g/100;e=0;0<c.length&&this.isFloatParameter(++q)&&(e=this.intParameter(q++));536875009==this.tokAt(q)&&(g=this.floatParameter(++q));this.chk||a.runScript(this.vwr.ms.getPointGroupAsString(this.vwr.bsA(),
c,e,g,d,v,null==qa?"":qa));return;case 4106:w=u(4,0);Ka=4;b=a.floatParameterSet(++q,4,4);q=a.iToken;for(E=0;4>E;E++)w[E]=y(b[E]);b=!0;break;case 1677721602:case 1153433601:if(null==w||Ka>(1228931586==a.theTok?2:3))Ka=0,w=u(-1,[-1,-1,-1,-1]);w[Ka++]=this.atomExpressionAt(++q).nextSetBit(0);q=a.iToken;w[Ka++]=1677721602==a.theTok?this.atomExpressionAt(++q).nextSetBit(0):-1;q=a.iToken;b=!0;break;case 554176565:switch(this.getToken(++q).tok){case 1073742330:K="slab";G=a.objectNameParameter(++q);q=a.iToken;
b=!0;break;default:this.invArg()}break;case 1275203608:case 134217751:case 1073742106:A=134217751==E;K="polygon";b=!0;f=new JU.Lst;var D=0,G=0,U=N=null,V=null;if(a.isArrayParameter(++q)){N=a.getPointArray(q,-1,!0);if(0<N.length&&null==N[0]){1275203608==E?D=this.getIntArray2(q):(D=JU.AU.newInt2(1),D[0]=a.expandFloatArray(a.floatParameterSet(q,-1,2147483647),-1,!1));N=this.getAllPoints(this.e.iToken+1,3);try{V=J.api.Interface.getInterface("JU.MeshCapper",this.vwr,"script").set(null).triangulateFaces(D,
N,null)}catch(O){this.invArg()}}D=N.length}1275203608==E&&(D=N.length);if(null==N){D=Math.max(0,this.intParameter(q));N=Array(D);for(E=0;E<D;E++)N[E]=this.centerParameter(++a.iToken)}q=a.iToken;switch(this.tokAt(q+1)){case 11:case 12:U=JS.SV.newT(this.getToken(++q)).toArray().getList();G=U.size();break;case 7:U=this.getToken(++q).getList();G=U.size();break;case 2:G=this.intParameter(++q);0>G&&(A=!0);break;default:null==V&&(!A&&!this.chk)&&(V=J.api.Interface.getInterface("JU.MeshCapper",this.vwr,"script").set(null).triangulatePolygon(N,
-1))}if(null==V&&!A){V=JU.AU.newInt2(G);for(E=0;E<G;E++)A=null==U?a.floatParameterSet(++a.iToken,3,4):JS.SV.flistValue(U.get(E),0),(3>A.length||4<A.length)&&this.invArg(),V[E]=u(-1,[y(A[0]),y(A[1]),y(A[2]),3==A.length?7:y(A[3])])}0<D?(f.addLast(N),f.addLast(V)):f=null;G=f;q=a.iToken;break;case 134217764:case 1296041985:d=null;c=2147483647;p=e=null;k=0;j=h=null;l=1296041985==E;L=-1;m=B(-1,[null,this.vwr.getFrameAtoms()]);if(l)switch(c=0,this.tokAt(++q)){case 4:d=this.stringParameter(q);break;case 12:d=
JS.SV.sValue(this.getToken(q));break;default:if(!a.isCenterParameter(q))if(a.isArrayParameter(q)){q=a.floatParameterSet(q,1,2147483647);j=u(q.length,0);for(E=j.length;0<=--E;)j[E]=y(q[E]);q=a.iToken+1}else c=this.intParameter(q++),a.isArrayParameter(q)&&(h=JU.P3.newA(a.floatParameterSet(q,3,3)),q=a.iToken+1);a.isCenterParameter(q)&&(v=a.centerParameter(q,m));null==j&&a.isCenterParameter(a.iToken+1)&&(e=a.centerParameter(++a.iToken,m));if(this.chk)return;q=a.iToken;null==v&&q+1<this.slen&&(v=this.centerParameter(++q),
p=a.isAtomExpression(q)?this.atomExpressionAt(q):null,q=a.iToken);L=(!l||null!=e)&&2==this.tokAt(q+1)?a.getToken(++q).intValue:-1;-1>L&&this.invArg();1814695966==this.tokAt(q+1)?(e=new JU.P3,k=1073742066,a.iToken=++q):1073742066==this.tokAt(q+1)&&(q++,e=this.getPoint3f(q+1,!1),k=1073742066,q=a.iToken)}else 1073742327==this.tokAt(q+1)&&(L=-2,a.iToken=++q);null!=d&&(q++,a.isCenterParameter(q)&&(v=a.centerParameter(q,m)));a.checkLast(a.iToken);if(this.chk)return;q="";m=null!=p?p.nextSetBit(0):-1;null==
p&&0<=this.vwr.am.cmi&&(p=this.vwr.getModelUndeletedAtomsBitSet(this.vwr.am.cmi));null!=p&&(q=null,0!=k&&(p=this.vwr.getSymmetryInfo(m,d,c,h,v,e,134217751,null,g/100,L,k,j),T(p,JU.P3)?e=p:q=""),null==qa&&(qa=l?"sym":"sg"),null==q&&(q=this.vwr.getSymmetryInfo(m,d,c,h,v,e,135176,qa,g/100,L,k,j)),l||(q="draw ID sym* delete;"+q),q="draw ID sg* delete;"+q+";draw *;");a.runBufferedSafely(0<q.length?q:'draw ID "'+qa+'*" delete',a.outputBuffer);return;case 4115:h=!0;continue;case 1073742332:case 9:case 8:if(9==
a.theTok||!a.isPoint3f(q)){G=a.getPoint4f(q);if(h){a.checkLast(a.iToken);this.chk||a.runScript(JU.Escape.drawQuat(JU.Quat.newP4(G),null==qa?"frame":qa," "+r,null==v?new JU.P3:v,g/100));return}K="planedef"}else G=v=this.getPoint3f(q,!0),K="coord";q=a.iToken;b=!0;break;case 1073742E3:K="lineData";G=a.floatParameterSet(++q,0,2147483647);q=a.iToken;b=!0;break;case 12290:case 10:case 1073742325:K="atomSet";G=this.atomExpressionAt(q);h&&(v=this.centerParameter(q));q=a.iToken;b=!0;break;case 7:b=!0;K=oa==
q?"coords":"modelBasedPoints";G=a.theToken.value;break;case 1073742195:case 268436992:break;case 268437504:G=a.xypParameter(q);if(null!=G){q=a.iToken;K="coord";b=!0;break}e&&this.invArg();e=!0;break;case 268437505:e||this.invArg();e=!1;break;case 1140850693:K="reverse";break;case 1073742166:if(1765808134==this.tokAt(++q)){G=Integer.$valueOf(this.e.getArgbParamOrNone(++q,!1));K="titlecolor";q=this.e.iToken;break}if(4114==this.tokAt(q)){--q;continue}case 4:G=this.stringParameter(q);K="title";break;
case 545259562:G=this.stringParameter(++q);K="hoverlabel";break;case 4114:E=this.floatParameter(++q);G=1073741824==this.tokAt(q+1)?this.paramAsStr(++q):null;f=1073741824==this.tokAt(q+1)?this.paramAsStr(++q):null;(4!=this.tokAt(q+1)&&++q!=this.slen||0>=E||255<E)&&this.invArg();K="myfont";if(null==G||null==f)A=this.vwr.shm.getShapePropertyIndex(22,"font",-1),null==G&&(G=A.fontFace),null==f&&(f=A.fontStyle);G=this.vwr.getFont3D(G,f,E);break;case 135198:K="vector";break;case 1140850691:G=Float.$valueOf(this.floatParameter(++q));
K="length";break;case 3:G=Float.$valueOf(this.floatParameter(q));K="length";break;case 1094713359:K="modelIndex";G=Integer.$valueOf(this.intParameter(++q));break;case 2:e?(K="modelIndex",G=Integer.$valueOf(this.intParameter(q))):g=this.intParameter(q);break;case 536875009:g=Math.round(this.floatParameter(++q)*(2==this.getToken(q).tok?1:100));continue;case 1073741974:qa=this.setShapeId(22,++q,f);m=null==this.getShapeProperty(22,"ID");q=a.iToken;break;case 1073742027:K="fixed";G=Boolean.FALSE;break;
case 12293:K="fixed";G=Boolean.TRUE;break;case 1073742066:E=this.getPoint3f(++q,!0);q=a.iToken;K="offset";G=E;break;case 1073741906:K="crossed";break;case 1073742196:G=Float.$valueOf(this.floatParameter(++q));K="width";r=K+" "+G;break;case 1073741908:K="curve";oa=q+1;break;case 1073741840:K="arc";oa=q+1;break;case 1073741846:K="arrow";oa=q+1;break;case 1073742194:K="vertices";oa=q+1;break;case 1073741880:K="circle";break;case 1073741912:K="cylinder";break;case 1073742048:K="nohead";break;case 1073741860:K=
"isbarb";break;case 1073742130:K="rotate45";break;case 1073742092:K="perp";break;case 1665140738:case 1073741917:r=1665140738==a.theTok;A=this.floatParameter(++q);r&&(A*=2);G=Float.$valueOf(A);K=r||3==this.tokAt(q)?"width":"diameter";r=K+(3==this.tokAt(q)?" "+A:" "+y(A));break;case 1073742330:if(268437504==this.tokAt(q+2)||h){b=v=this.centerParameter(q);q=a.iToken;K="coord";G=b;b=!0;break}G=a.objectNameParameter(++q);K="identifier";b=!0;break;case 1765808134:case 603979967:case 1073742074:f=!0;p=
this.getColorTrans(a,q,!1,l);q=a.iToken;continue;default:if(!a.setMeshDisplayProperty(22,0,a.theTok)){if(268441089==a.theTok||JS.T.tokAttr(a.theTok,1073741824)){qa=this.setShapeId(22,q,f);q=a.iToken;break}this.invArg()}0==L&&(L=q);q=a.iToken;continue}f=12291!=a.theTok;b&&(!c&&!h)&&(this.setShapeProperty(22,"points",Integer.$valueOf(g)),c=!0,g=0);b&&m&&this.invArg();null!=K&&this.setShapeProperty(22,K,G)}this.finalizeObject(22,l[0],p,g,b,w,L,null)});d(c$,"mo",function(a,b){var c=this.e,e=2147483647,
k=!1,h=null,f=this.vwr.getVisibleFramesBitSet(),d=new JU.Lst,j=!1,p=1073877011==this.tokAt(0),l=1;if(p){var g=this.e.optParameterAsString(1).equals("view");if(1==this.e.slen||g||this.e.optParameterAsString(1).equals("options")){this.chk||(c=g?"VIEW":this.e.optParameterAsString(2),this.vwr.startNBO(c));return}}if(1094717454==this.tokAt(1)||4115==this.tokAt(1))l=c.modelNumberParameter(2),0>l&&this.invArg(),f.clearAll(),f.set(l),l=3;c.sm.loadShape(b);for(g=f.nextSetBit(0);0<=g;g=f.nextSetBit(g+1)){var r=
l;if(1073742001==this.tokAt(r)&&this.listIsosurface(b))break;this.setShapeProperty(b,"init",Integer.$valueOf(g));if(a)break;var L=null,v=this.getShapeProperty(b,"moNumber").intValue(),m=this.getShapeProperty(b,"moLinearCombination"),u=this.getShapeProperty(b,"moSquareData"),B=null==m?null:this.getShapeProperty(b,"moSquareLinear");0==v&&(v=2147483647);var y=null,D=null,aa=!1,I=null;switch(this.getToken(r).tok){case 1140850696:if(1073877010==b){this.mo(a,28);return}h=this.paramAsStr(++r).toUpperCase();
4==c.tokAt(r+1)&&(I=this.paramAsStr(++c.iToken));break;case 1073741875:case 554176565:y=c.theToken.value;D=this.getCapSlabObject(r,!1);break;case 1073741914:B=Boolean.TRUE;m=w(-1,[1]);e=v=0;break;case 2:v=this.intParameter(r);1073741865==this.tokAt(r+1)&&(j=!0);m=this.moCombo(d);null==m&&0>v&&(m=w(-1,[-100,-v]));aa=!0;break;case 268440576:switch(this.tokAt(++r)){case 1073741973:case 1073742008:break;default:this.invArg()}k=!0;case 1073741973:case 1073742008:2147483647==(e=this.moOffset(r))&&this.invArg();
v=0;m=this.moCombo(d);aa=!0;break;case 1073742037:v=1073742037;j=!1;m=this.moCombo(d);aa=!0;break;case 1073742108:v=1073742108;j=!1;m=this.moCombo(d);aa=!0;break;case 1765808134:this.setColorOptions(null,r+1,b,2);break;case 134217750:y="plane";D=1073742333==this.tokAt(this.e.iToken=++r)?null:c.planeParameter(r,!1);break;case 134217751:this.addShapeProperty(d,"randomSeed",2==this.tokAt(r+2)?Integer.$valueOf(this.intParameter(r+2)):null);y="monteCarloCount";D=Integer.$valueOf(this.intParameter(r+1));
break;case 536875009:y="scale";D=Float.$valueOf(this.floatParameter(r+1));break;case 1073741910:268440577==this.tokAt(r+1)?(y="cutoffPositive",D=Float.$valueOf(this.floatParameter(r+2))):(y="cutoff",D=Float.$valueOf(this.floatParameter(r+1)));break;case 536870916:y="debug";break;case 1073742054:y="plane";break;case 1073742104:case 1073742122:y="resolution";D=Float.$valueOf(this.floatParameter(r+1));break;case 1073742156:null==m?u=Boolean.TRUE:B=Boolean.TRUE;aa=!1;break;case 1073742168:r+1<this.slen&&
4==this.tokAt(r+1)&&(y="titleFormat",D=this.paramAsStr(r+1));break;case 1073741824:this.invArg();break;case 4:if(p&&1==r){I=c.stringParameter(r);break}default:p&&4==c.tokAt(r)&&(I=this.paramAsStr(r++));if(c.isArrayParameter(r)){m=c.floatParameterSet(r,1,2147483647);1073742156==this.tokAt(c.iToken+1)&&(aa=!1,B=Boolean.TRUE,c.iToken++);break}e=c.iToken;c.setMeshDisplayProperty(b,0,c.theTok)||this.invArg();this.setShapeProperty(b,"setProperties",d);c.setMeshDisplayProperty(b,e,this.tokAt(e));return}null!=
y&&this.addShapeProperty(d,y,D);r=2147483647!=v||null!=m;if(this.chk)break;if(null!=h||null!=I||r){r&&4==this.tokAt(c.iToken+1)&&(L=this.paramAsStr(++c.iToken));c.setCursorWait(!0);if(null!=h||null!=I)h=h+":"+I;this.setMoData(d,v,m,e,k,g,L,h,j);r&&this.addShapeProperty(d,"finalize",null)}aa||(this.setShapeProperty(b,"squareLinear",B),this.setShapeProperty(b,"squareData",u));0<d.size()&&this.setShapeProperty(b,"setProperties",d);r&&!c.tQuiet&&(L="",p?L=this.getShapeProperty(b,"moLabel"):(v=this.getShapeProperty(b,
"moNumber").intValue(),L=""+v),this.showString(JS.T.nameOf(this.tokAt(0))+" "+L+" "+(j?"beta ":"")+this.getShapeProperty(b,"message")));d.clear()}},"~B,~N");d(c$,"setNBOType",function(a,b){var c=-1,e=null,k=b.indexOf(":");0<k&&(e=b.substring(k+1),b=b.substring(0,k),b.equals("null")&&(b=null),e.equals("null")&&(e=null));0>(null==b?0:JV.JC.getNBOTypeFromName(b))&&this.invArg();a.containsKey("nboLabels")||this.error(27);if(this.chk)return-1;null!=b&&!J.api.Interface.getInterface("J.adapter.readers.quantum.GenNBOReader",
this.vwr,"script").readNBOCoefficients(a,b,this.vwr)&&this.error(27);var k=a.get("auxFiles"),h=this.vwr.getCurrentModelAuxInfo().get("auxFiles");null==h?this.vwr.getCurrentModelAuxInfo().put("auxFiles",k):h.addAll(k);if(null!=e){k=e.indexOf(".");0<k&&(h=JU.PT.parseInt(e.substring(k+1)),e=e.substring(0,k),k=h);for(var h=a.get("nboLabels"),f=0,d=h.length;f<d;f++)if(e.equals(h[f])&&(0>k||0==--k)){c=f+1;break}0>c&&this.error(27)}return c},"java.util.Map,~S");d(c$,"moCombo",function(a){if(1073742156!=
this.tokAt(this.e.iToken+1))return null;this.addShapeProperty(a,"squareLinear",Boolean.TRUE);this.e.iToken++;return w(0,0)},"JU.Lst");d(c$,"moOffset",function(a){var b=1073741973==this.getToken(a).tok?0:1,c=this.tokAt(++a);2==c&&"-"==this.e.st[a].value.charAt(0)?b+=this.intParameter(a):268440577==c?b+=this.intParameter(++a):268440576==c&&(b-=this.intParameter(++a));return b},"~N");d(c$,"setMoData",function(a,b,c,e,k,h,f,d,j){var g=this.e;0>h&&(h=this.vwr.am.cmi,0>h&&g.errorStr(30,"MO isosurfaces"));
var l=this.vwr.ms.getInfo(h,"moData");null==l&&this.error(27);this.vwr.checkMenuUpdate();if(null!=d){var t=this.setNBOType(l,d),r=l.get("nboLabels").length;g.showString(r+" orbitals of type "+d.substring(0,d.indexOf(":")+1)+" modelIndex="+this.vwr.getModelNumberDotted(h));0<t&&(b=t);if(null==c&&2147483647==b)return}d=null;t=0;h=null;if(null==c||2>c.length){null!=c&&1==c.length?e=0:j&&l.containsKey("firstBeta")&&(e=l.get("firstBeta").intValue());d=l.containsKey("lastMoNumber")?l.get("lastMoNumber").intValue():
0;t=l.containsKey("lastMoCount")?l.get("lastMoCount").intValue():1;1073742108==b?b=d-1:1073742037==b&&(b=d+t);d=l.get("mos");t=null==d?0:d.size();0==t&&this.error(25);1==t&&1<b&&this.error(29);if(2147483647!=e){if(!j)if(l.containsKey("HOMO"))b=l.get("HOMO").intValue()+e,e=0;else{b=t;for(j=0;j<t;j++)if(r=d.get(j),null!=(h=r.get("occupancy"))){if(0.5>h.floatValue()){b=j;break}}else if(null!=(h=r.get("energy"))){if(0<h.floatValue()){b=j;break}}else break;null==h&&this.error(28)}b+=e;this.chk||JU.Logger.info("MO "+
b)}(1>b||b>t)&&g.errorStr(26,""+t)}b=Math.abs(b);l.put("lastMoNumber",Integer.$valueOf(b));l.put("lastMoCount",Integer.$valueOf(1));k&&null==c&&(c=w(-1,[-100,b]));if(null!=c&&2>c.length){r=d.get(b-1);if(null==(h=r.get("energy")))c=w(-1,[100,b]);else{g=h.floatValue();e=JU.BS.newN(t);k=0;c=1==c.length&&1==c[0];for(j=0;j<t;j++)if(null!=(h=d.get(j).get("energy")))if(h=h.floatValue(),c?h<=g:h==g)e.set(j+1),k+=2;c=w(k,0);for(g=j=0;j<k;j+=2)c[j]=1,c[j+1]=g=e.nextSetBit(g+1);l.put("lastMoNumber",Integer.$valueOf(e.nextSetBit(0)));
l.put("lastMoCount",Integer.$valueOf(D(k/2)))}this.addShapeProperty(a,"squareLinear",Boolean.TRUE)}this.addShapeProperty(a,"moData",l);null!=f&&this.addShapeProperty(a,"title",f);this.addShapeProperty(a,"molecularOrbital",null!=c?c:Integer.$valueOf(Math.abs(b)));this.addShapeProperty(a,"clear",null)},"JU.Lst,~N,~A,~N,~B,~N,~S,~S,~B");d(c$,"isosurface",function(a){var b=this.e;b.sm.loadShape(a);if(!(1073742001==this.tokAt(1)&&this.listIsosurface(a))){var c=0,e=!1,k=!1,h=24==a,f=29==a,d=30==a,j=26==
a,g=j||12291==this.tokAt(1)||b.$isStateScript,l=!1,t=!1,r=!1,L=!1,v=!1,m=!1,Ba=!1,yb=!1,O=!1,oa=!1,aa=!1,I=!1,E=!1,A=!1,q=!1,K=null,G=null,N=null,P=null,U,V,H,F,W,Z=NaN,$=NaN,ha=0,da=null,ma=2147483647,S=null,X=null,ia=null,s=new JU.SB,Q,na=null,ta=null,va=!1,ca=null,ra=0,ja=null,ba=this.chk?0:-2147483648;b.setCursorWait(!0);var ya=null!=this.initIsosurface(a),ua=ya&&null==this.getShapeProperty(a,"ID"),Aa=!1,gb=!1,La=!1,Ha=!1,Ma=null,hb=null,ib=null,pa=null,jb=null,Fa=null,Na=null,C=new JU.Lst,Ia=
!1;(f||d)&&this.addShapeProperty(C,"fileType","Pmesh");for(var n=b.iToken;n<this.slen;++n){var z=null,x=null,R=this.getToken(n).tok;1073741824==R&&(ja=this.paramAsStr(n),ja.equalsIgnoreCase("map")&&(R=4125));switch(R){case 1073742148:g=!0;s.append(" silent");z="silent";break;case 603979868:da=1073742335==this.getToken(++n).tok?Boolean.TRUE:1073742334==b.theTok?Boolean.FALSE:null;null==da&&this.invArg();continue;case 553648146:ma=this.intParameter(++n);continue;case 4128:z="moveIsosurface";12!=this.tokAt(++n)&&
this.invArg();x=this.getToken(n++).value;break;case 1296041985:for(var Ja=this.floatArraySet(n+2,this.intParameter(n+1),16),Fa=Array(Ja.length),ea=Fa.length;0<=--ea;)Fa[ea]=JU.M4.newA16(Ja[ea]);n=b.iToken;break;case 1088421903:0>ba&&(ba=Math.min(this.vwr.am.cmi,0));var zb=null==ia;null==X&&(X=JU.BSUtil.copy(this.vwr.bsA()));X.and(this.vwr.ms.getAtoms(1296041985,Integer.$valueOf(1)));zb||X.andNot(ia);this.addShapeProperty(C,"select",X);zb&&(ia=JU.BSUtil.copy(X),JU.BSUtil.invertInPlace(ia,this.vwr.ms.ac),
q=!0,this.addShapeProperty(C,"ignore",ia),s.append(" ignore ").append(JU.Escape.eBS(ia)));s.append(" symmetry");0==ra&&this.addShapeProperty(C,"colorRGB",Integer.$valueOf(1296041985));Fa=this.vwr.ms.getSymMatrices(ba);break;case 1073742066:z="offset";x=this.centerParameter(++n);n=b.iToken;break;case 528432:z="rotate";x=1073742333==this.tokAt(b.iToken=++n)?null:b.getPoint4f(n);n=b.iToken;break;case 1610612740:z="scale3d";x=Float.$valueOf(this.floatParameter(++n));break;case 1073742090:s.append(" periodic");
z="periodic";break;case 1073742078:case 266298:case 134217751:z=b.theToken.value.toString();s.append(" ").appendO(b.theToken.value);x=this.centerParameter(++n);s.append(" ").append(JU.Escape.eP(x));n=b.iToken;break;case 1812599299:if(0<=b.fullCommand.indexOf("# BBOX="))var Ab=JU.PT.split(JU.PT.getQuotedAttribute(b.fullCommand,"# BBOX"),","),ca=B(-1,[JU.Escape.uP(Ab[0]),JU.Escape.uP(Ab[1])]);else b.isCenterParameter(n+1)?(ca=B(-1,[this.getPoint3f(n+1,!0),this.getPoint3f(b.iToken+1,!0)]),n=b.iToken):
ca=this.vwr.ms.getBBoxVertices();s.append(" boundBox "+JU.Escape.eP(ca[0])+" "+JU.Escape.eP(ca[ca.length-1]));z="boundingBox";x=ca;break;case 135188:f=!0;s.append(" pmesh");z="fileType";x="Pmesh";break;case 134217763:X=this.atomExpressionAt(++n);this.chk?S=new JU.BS:1073742325==this.tokAt(b.iToken+1)||10==this.tokAt(b.iToken+1)?(S=this.atomExpressionAt(++b.iToken),S.and(this.vwr.ms.getAtomsWithinRadius(5,X,!1,null,null))):(S=this.vwr.ms.getAtomsWithinRadius(5,X,!0,null,null),S.andNot(this.vwr.ms.getAtoms(1094713360,
X)));S.andNot(X);s.append(" intersection ").append(JU.Escape.eBS(X)).append(" ").append(JU.Escape.eBS(S));n=b.iToken;if(134320141==this.tokAt(n+1)){n++;var Oa=this.getToken(++n).value;s.append(" function ").append(JU.PT.esc(Oa));this.chk||this.addShapeProperty(C,"func",Oa.equals("a+b")||Oa.equals("a-b")?Oa:this.createFunction("__iso__","a,b",Oa))}else A=!0;z="intersection";x=B(-1,[X,S]);break;case 1610625028:case 134217759:if(e=1610625028==R){s.append(" display");c=n;R=this.tokAt(n+1);if(0==R)continue;
n++;this.addShapeProperty(C,"token",Integer.$valueOf(1073742335));if(10==R||1073742327==R){z="bsDisplay";1073742327==R?s.append(" all"):(x=this.st[n].value,s.append(" ").append(JU.Escape.eBS(x)));b.checkLast(n);break}else 134217759!=R&&(b.iToken=n,this.invArg())}else ha=n;var Xa,Ca=null,S=null,Ya=Array(1);1073742325==this.tokAt(n+1)?(Xa=this.floatParameter(n+3),b.isPoint3f(n+4)?(Ca=b.centerParameter(n+4,null),b.iToken+=2):b.isPoint3f(n+5)?(Ca=b.centerParameter(n+5,null),b.iToken+=2):(S=b.atomExpression(this.st,
n+5,this.slen,!0,!1,Ya,!0),null==S&&this.invArg())):(Xa=this.floatParameter(++n),Ca=b.centerParameter(++n,Ya),S=T(Ya[0],JU.BS)?Ya[0]:null);e&&b.checkLast(b.iToken);n=b.iToken;0<=b.fullCommand.indexOf("# WITHIN=")&&(S=JU.BS.unescape(JU.PT.getQuotedAttribute(b.fullCommand,"# WITHIN")));this.chk||(null!=S&&0<=ba&&(S=this.vwr.restrictToModel(S,ba)),null==Ca&&(Ca=null==S?new JU.P3:this.vwr.ms.getAtomSetCenter(S)),ca=this.getWithinDistanceVector(C,Xa,Ca,S,e),s.append(" within ").appendF(Xa).append(" ").append(null==
S?JU.Escape.eP(Ca):JU.Escape.eBS(S)));continue;case 1073742083:var z="parameters",Bb=b.floatParameterSet(++n,1,10),n=b.iToken,x=Bb;s.append(" parameters ").append(JU.Escape.eAF(Bb));break;case 1715472409:case 1073742190:var Ma=b.theToken.value,eb=1073742190==R,Pa=this.tokAt(n+1);null==jb?(!l&&(!r&&!t)&&(this.addShapeProperty(C,"sasurface",Float.$valueOf(0)),s.append(" vdw"),l=!0),z="property",null==da&&(da=JS.T.tokAttr(Pa,1111490560)&&1==this.vwr.getIsosurfacePropertySmoothing(!1)?Boolean.TRUE:Boolean.FALSE),
this.addShapeProperty(C,"propertySmoothing",da),s.append(" isosurfacePropertySmoothing "+da),da===Boolean.TRUE&&(2147483647==ma&&(ma=this.vwr.getIsosurfacePropertySmoothing(!0)),this.addShapeProperty(C,"propertySmoothingPower",Integer.$valueOf(ma)),s.append(" isosurfacePropertySmoothingPower "+ma)),this.vwr.g.rangeSelected&&this.addShapeProperty(C,"rangeSelected",Boolean.TRUE)):z=jb;ja=this.paramAsStr(n);s.append(" ").append(ja);if(0==ja.toLowerCase().indexOf("property_")){G=w(this.vwr.ms.ac,0);if(this.chk)continue;
G=this.vwr.getDataObj(ja,null,1);null==G&&this.invArg();this.addShapeProperty(C,z,G);continue}var Qa=this.vwr.ms.ac,G=w(Qa,0);if(eb){var Cb=this.paramAsStr(++n);0==Cb.length?G=b.floatParameterSet(n,Qa,Qa):(G=w(Qa,0),this.chk||JU.Parser.parseStringInfestedFloatArray(""+b.getParameter(Cb,4,!0),null,G));this.chk||s.append(' "" ').append(JU.Escape.eAF(G))}else{this.getToken(++n);if(!this.chk){s.append(" "+b.theToken.value);var fb=this.vwr.ms.at;this.vwr.autoCalculate(Pa,null);if(1765808134!=Pa){Q=new JU.P3;
for(var kb=Qa;0<=--kb;)G[kb]=fb[kb].atomPropertyFloat(this.vwr,Pa,Q)}}1765808134==Pa&&(pa="inherit");if(134217759==this.tokAt(n+1)){var Db=this.floatParameter(n+=2);s.append(" within "+Db);this.addShapeProperty(C,"propertyDistanceMax",Float.$valueOf(Db))}}x=G;break;case 1094713359:case 1094717454:l&&this.invArg();ba=1094713359==R?this.intParameter(++n):b.modelNumberParameter(++n);s.append(" modelIndex "+ba);if(0>ba){z="fixed";x=Boolean.TRUE;break}z="modelIndex";x=Integer.$valueOf(ba);break;case 1275082241:var z=
"select",lb=this.atomExpressionAt(++n),x=lb,n=b.iToken;1073742072==this.tokAt(n+1)&&(n++,ia=JU.BSUtil.copy(lb),JU.BSUtil.invertInPlace(ia,this.vwr.ms.ac),this.addShapeProperty(C,"ignore",ia),s.append(" ignore ").append(JU.Escape.eBS(ia)),q=!0);l||r?s.append(" select "+JU.Escape.eBS(lb)):(X=x,0>ba&&0<=X.nextSetBit(0)&&(ba=this.vwr.ms.at[X.nextSetBit(0)].mi));break;case 2109448:P=10==b.getToken(++n).tok?b.theToken.value:b.expandFloatArray(b.floatParameterSet(n,1,2147483647),1,!0);n=b.iToken;break;case 36867:var Eb=
this.intParameter(++n),P=0<Eb?JU.BSUtil.newAndSetBit(Eb-1):new JU.BS;break;case 12289:z="center";x=this.centerParameter(++n);s.append(" center "+JU.Escape.eP(x));n=b.iToken;break;case 1073742147:case 1765808134:ya=!0;if(1073742147==R)La=!0,s.append(" sign"),this.addShapeProperty(C,"sign",Boolean.TRUE);else{if(1073741914==this.tokAt(n+1)){n++;z="colorDensity";s.append(" color density");Ha=!0;if(this.isFloatParameter(n+1)){var Fb=this.floatParameter(++n);s.append(" "+Fb);x=Float.$valueOf(Fb)}break}if(4==
this.getToken(n+1).tok)pa=this.paramAsStr(++n),0<pa.indexOf(" ")&&(Na=JU.C.getColixArray(pa),null==Na&&this.error(4));else if(1073742018==b.theTok){n++;s.append(" color mesh");ra=b.getArgbParam(++n);this.addShapeProperty(C,"meshcolor",Integer.$valueOf(ra));s.append(" ").append(JU.Escape.escapeColor(ra));n=b.iToken;continue}if(603979967==(b.theTok=this.tokAt(n+1))||1073742074==b.theTok){s.append(" color");ib=this.setColorOptions(s,n+1,24,-2);n=b.iToken;continue}switch(this.tokAt(n+1)){case 1073741826:case 1073742114:this.getToken(++n);
s.append(" color range");this.addShapeProperty(C,"rangeAll",null);if(1073742327==this.tokAt(n+1)){n++;s.append(" all");continue}var Gb=this.floatParameter(++n),Hb=this.floatParameter(++n);this.addShapeProperty(C,"red",Float.$valueOf(Gb));this.addShapeProperty(C,"blue",Float.$valueOf(Hb));s.append(" ").appendF(Gb).append(" ").appendF(Hb);continue}if(b.isColorParam(n+1)&&(ra=b.getArgbParam(n+1),1073742170==this.tokAt(n+2))){pa=b.getColorRange(n+1);n=b.iToken;break}s.append(" color")}b.isColorParam(n+
1)?(ra=b.getArgbParam(++n),s.append(" ").append(JU.Escape.escapeColor(ra)),n=b.iToken,this.addShapeProperty(C,"colorRGB",Integer.$valueOf(ra)),ya=!0,b.isColorParam(n+1)?(ra=b.getArgbParam(++n),n=b.iToken,this.addShapeProperty(C,"colorRGB",Integer.$valueOf(ra)),s.append(" ").append(JU.Escape.escapeColor(ra)),L=!0):La&&this.invPO()):!La&&(null==Na&&null==pa)&&this.invPO();continue;case 134221829:h||this.invArg();aa=!this.chk;continue;case 1228935687:4!=this.tokAt(n+1)&&this.invPO();continue;case 1111492618:case 1648363544:s.append(" ").appendO(b.theToken.value);
var Ra=b.encodeRadiusParameter(n,!1,!0);if(null==Ra)return;s.append(" ").appendO(Ra);Float.isNaN(Ra.value)&&(Ra.value=100);x=Ra;z="radius";oa=!0;r&&(l=!1);n=b.iToken;break;case 1073741864:k=!0;continue;case 134217750:t=!0;z="plane";x=b.planeParameter(n,k);n=b.iToken;s.append(" plane ").append(JU.Escape.eP4(x));break;case 536875009:z="scale";x=Float.$valueOf(this.floatParameter(++n));s.append(" scale ").appendO(x);break;case 1073742327:ya&&this.invArg();z="thisID";break;case 1112150020:l=!0;++n;x=
b.getPoint4f(n);z="ellipsoid";n=b.iToken;s.append(" ellipsoid ").append(JU.Escape.eP4(x));break;case 134219777:t=!0;z="plane";x=b.hklParameter(++n,null,!0);n=b.iToken;s.append(" plane ").append(JU.Escape.eP4(x));break;case 135182:var l=!0,Za=this.paramAsStr(++n);this.addShapeProperty(C,"lcaoType",Za);s.append(" lcaocartoon ").append(JU.PT.esc(Za));switch(this.getToken(++n).tok){case 12290:case 10:case 1073742325:z="lcaoCartoon";S=this.atomExpressionAt(n);n=b.iToken;if(this.chk)continue;var Sa=S.nextSetBit(0);
0>Sa&&this.error(14);s.append(" ({").appendI(Sa).append("})");ba=this.vwr.ms.at[Sa].mi;this.addShapeProperty(C,"modelIndex",Integer.$valueOf(ba));var mb=B(-1,[new JU.V3,new JU.V3,JU.V3.newV(this.vwr.ms.at[Sa]),new JU.V3]);if(!Za.equalsIgnoreCase("s")&&null==this.vwr.getHybridizationAndAxes(Sa,mb[0],mb[1],Za))return;x=mb;break;default:this.error(14)}break;case 1073877011:K=this.paramAsStr(++n).toUpperCase(),s.append(" nbo ").append(K).append(" ");case 1073877010:null==K&&s.append(" mo ");var Ta=2147483647,
Ga=2147483647,nb=268440576==this.tokAt(n+1);nb&&n++;var Ua=null;switch(this.tokAt(++n)){case 0:b.bad();break;case 1073741914:s.append("[1] squared ");this.addShapeProperty(C,"squareLinear",Boolean.TRUE);Ua=w(-1,[1]);Ga=Ta=0;n++;break;case 1073741973:case 1073742008:Ga=this.moOffset(n);Ta=0;n=b.iToken;s.append((nb?"-":"")+"HOMO ");0<Ga&&s.append("+");0!=Ga&&s.appendI(Ga);break;case 2:Ta=this.intParameter(n);s.appendI(Ta);1073741865==this.tokAt(n+1)&&(yb=!0,n++);break;default:b.isArrayParameter(n)&&
(Ua=b.floatParameterSet(n,1,2147483647),n=b.iToken)}if(1073742156==this.tokAt(n+1))this.addShapeProperty(C,"squareLinear",Boolean.TRUE),s.append(" squared"),null==Ua&&(Ua=w(0,0));else if(134217751==this.tokAt(n+1)){++n;var Ib=this.intParameter(++n),Jb=2==this.tokAt(n+1)?this.intParameter(++n):-System.currentTimeMillis()%1E4;this.addShapeProperty(C,"monteCarloCount",Integer.$valueOf(Ib));this.addShapeProperty(C,"randomSeed",Integer.$valueOf(Jb));s.append(" points ").appendI(Ib).appendC(" ").appendI(Jb)}this.setMoData(C,
Ta,Ua,Ga,nb,ba,null,K,yb);l=!0;continue;case 1073742036:z="nci";s.append(" "+z);var R=this.tokAt(n+1),Kb=1228935687!=R&&4!=R&&1073742032!=R,x=Boolean.$valueOf(Kb);Kb&&(l=!0);break;case 1073742016:case 1073742022:var Lb=1073742016==R,z=Lb?"mep":"mlp";s.append(" "+z);var $a=null,ob=-1,l=!0;2==this.tokAt(n+1)&&(ob=this.intParameter(++n),s.append(" "+ob),this.addShapeProperty(C,"mepCalcType",Integer.$valueOf(ob)));if(4==this.tokAt(n+1))$a=this.stringParameter(++n),s.append(" /*file*/"+JU.PT.esc($a));
else if(1715472409==this.tokAt(n+1)){jb=z;continue}if(!this.chk)try{G=null==$a&&Lb?this.vwr.getOrCalcPartialCharges(X,ia):this.getAtomicPotentials(X,ia,$a)}catch(Mb){if(Y(Mb,JV.JmolAsyncException))throw new JS.ScriptInterruption(this.e,"partialcharge",1);throw Mb;}!this.chk&&null==G&&this.error(32);x=G;break;case 1312817669:Ba=!this.chk;s.append(" volume");break;case 1073741974:this.setShapeId(a,++n,ya);ua=null==this.getShapeProperty(a,"ID");n=b.iToken;break;case 1073741888:603979967==this.tokAt(n+
1)&&(Aa=!0,n++);pa=this.paramAsStr(++n).toLowerCase();pa.equals("sets")?s.append(' colorScheme "sets"'):b.isColorParam(n)&&(pa=b.getColorRange(n),n=b.iToken);break;case 1073741828:z="addHydrogens";x=Boolean.TRUE;s.append(" addHydrogens");break;case 1073741836:z="angstroms";s.append(" angstroms");break;case 1073741837:z="anisotropy";x=this.getPoint3f(++n,!1);s.append(" anisotropy").append(JU.Escape.eP(x));n=b.iToken;break;case 1073741842:m=!this.chk;s.append(" area");break;case 1073741850:case 1073742076:l=
!0;L&&!v&&(s.append(' phase "_orb"'),this.addShapeProperty(C,"phase","_orb"));var ga=w(7,0);ga[0]=this.intParameter(++n);ga[1]=this.intParameter(++n);ga[2]=this.intParameter(++n);ga[3]=this.isFloatParameter(n+1)?this.floatParameter(++n):6;s.append(" atomicOrbital ").appendI(y(ga[0])).append(" ").appendI(y(ga[1])).append(" ").appendI(y(ga[2])).append(" ").appendF(ga[3]);134217751==this.tokAt(n+1)&&(n+=2,ga[4]=this.intParameter(n),ga[5]=3==this.tokAt(n+1)?this.floatParameter(++n):0,ga[6]=2==this.tokAt(n+
1)?this.intParameter(++n):-System.currentTimeMillis()%1E4,s.append(" points ").appendI(y(ga[4])).appendC(" ").appendF(ga[5]).appendC(" ").appendI(y(ga[6])));z="hydrogenOrbital";x=ga;break;case 1073741866:s.append(" binary");continue;case 1073741868:s.append(" blockData");z="blockData";x=Boolean.TRUE;break;case 1073741875:case 554176565:E=!0;z=b.theToken.value;x=this.getCapSlabObject(n,!1);n=b.iToken;break;case 1073741876:h||this.invArg();var O=!0,Nb=this.isFloatParameter(n+1)?this.floatParameter(++n):
1.2,pb=this.isFloatParameter(n+1)?this.floatParameter(++n):10;if(this.chk)continue;if(50<pb){b.integerOutOfRange(0,50);return}s.append(" cavity ").appendF(Nb).append(" ").appendF(pb);this.addShapeProperty(C,"envelopeRadius",Float.$valueOf(pb));this.addShapeProperty(C,"cavityRadius",Float.$valueOf(Nb));z="cavity";break;case 1073741896:case 1073741900:z="contour";s.append(" contour");switch(this.tokAt(n+1)){case 1073741920:x=b.floatParameterSet(n+2,1,2147483647);s.append(" discrete ").append(JU.Escape.eAF(x));
n=b.iToken;break;case 1073741981:Q=this.getPoint3f(n+2,!1);(0>=Q.z||Q.y<Q.x)&&this.invArg();Q.z==y(Q.z)&&Q.z>Q.y-Q.x&&(Q.z=(Q.y-Q.x)/Q.z);x=Q;n=b.iToken;s.append(" increment ").append(JU.Escape.eP(Q));break;default:x=Integer.$valueOf(2==this.tokAt(n+1)?this.intParameter(++n):0),s.append(" ").appendO(x),2==this.tokAt(n+1)&&(this.addShapeProperty(C,z,x),x=Integer.$valueOf(-Math.abs(this.intParameter(++n))),s.append(" ").appendO(x))}break;case 1073741910:s.append(" cutoff ");268440577==this.tokAt(++n)?
(z="cutoffPositive",x=Float.$valueOf($=this.floatParameter(++n)),s.append("+").appendO(x)):this.isFloatParameter(n)?(z="cutoff",x=Float.$valueOf($=this.floatParameter(n)),s.appendO(x)):Ha?(z="cutoffRange",x=b.floatParameterSet(n,2,2),this.addShapeProperty(C,"cutoff",Float.$valueOf(0)),s.append(JU.Escape.eAF(x)),n=b.iToken):this.invArg();break;case 1073741928:z="downsample";x=Integer.$valueOf(this.intParameter(++n));s.append(" downsample ").appendO(x);break;case 1073741931:z="eccentricity";x=b.getPoint4f(++n);
s.append(" eccentricity ").append(JU.Escape.eP4(x));n=b.iToken;break;case 1073741932:s.append(" ed");this.setMoData(C,-1,null,0,!1,ba,null,null,!1);l=!0;continue;case 536870916:case 1073742041:s.append(" ").appendO(b.theToken.value);z="debug";x=536870916==R?Boolean.TRUE:Boolean.FALSE;break;case 12293:s.append(" fixed");z="fixed";x=Boolean.TRUE;break;case 1073741962:s.append(" fullPlane");z="fullPlane";x=Boolean.TRUE;break;case 1073741966:case 1073741968:var Yb=1073741968==R,z=""+b.theToken.value,
wa=new JU.Lst,x=wa,I=l=!0;s.append(" ").append(z);var ka=this.paramAsStr(++n);if(ka.equals("=")){s.append(" =");ka=this.paramAsStr(++n);s.append(" ").append(JU.PT.esc(ka));wa.addLast(ka);this.chk||this.addShapeProperty(C,"func",this.createFunction("__iso__","x,y,z",ka));break}var qb=JU.PT.getQuotedAttribute(b.fullCommand,"# DATA"+(I?"2":""));null==qb?qb="inline":ka=qb;var Ob=0==ka.indexOf("data2d_"),Zb=0==ka.indexOf("data3d_"),gb=ka.equals("inline");s.append(" inline");wa.addLast(ka);var Pb=this.getPoint3f(++n,
!1);s.append(" ").append(JU.Escape.eP(Pb));wa.addLast(Pb);var xa;F=++b.iToken;wa.addLast(xa=b.getPoint4f(F));s.append(" ").append(JU.Escape.eP4(xa));U=y(xa.x);W=++b.iToken;wa.addLast(xa=b.getPoint4f(W));s.append(" ").append(JU.Escape.eP4(xa));V=y(xa.x);wa.addLast(xa=b.getPoint4f(++b.iToken));s.append(" ").append(JU.Escape.eP4(xa));H=y(xa.x);(0==U||0==V||0==H)&&this.invArg();if(!this.chk){var la=null,sa=null;if(Yb){gb?(U=Math.abs(U),V=Math.abs(V),H=Math.abs(H),sa=this.floatArraySetXYZ(++b.iToken,U,
V,H)):sa=Zb?this.vwr.getDataObj(ka,null,3):this.vwr.functionXYZ(ka,U,V,H);U=Math.abs(U);V=Math.abs(V);H=Math.abs(H);null==sa&&(b.iToken=F,b.errorStr(53,"xyzdata is null."));if(sa.length!=U||sa[0].length!=V||sa[0][0].length!=H)b.iToken=F,b.errorStr(53,"xyzdata["+sa.length+"]["+sa[0].length+"]["+sa[0][0].length+"] is not of size ["+U+"]["+V+"]["+H+"]");wa.addLast(sa);s.append(" ").append(JU.Escape.e(sa))}else{gb?(U=Math.abs(U),V=Math.abs(V),la=this.floatArraySet(++b.iToken,U,V)):Ob?(la=this.vwr.getDataObj(ka,
null,2),U=null==la?0:la.length,V=3):(la=this.vwr.functionXY(ka,U,V),U=Math.abs(U),V=Math.abs(V));null==la&&(b.iToken=F,b.errorStr(53,"fdata is null."));la.length!=U&&!Ob&&(b.iToken=F,b.errorStr(53,"fdata length is not correct: "+la.length+" "+U+"."));for(ea=0;ea<U;ea++)null==la[ea]&&(b.iToken=W,b.errorStr(53,"fdata["+ea+"] is null.")),la[ea].length!=V&&(b.iToken=W,b.errorStr(53,"fdata["+ea+"] is not the right length: "+la[ea].length+" "+V+"."));wa.addLast(la);s.append(" ").append(JU.Escape.e(la))}}n=
b.iToken;break;case 1073742188:var $b=this.e.isAtomExpression(++n),Qb=this.getAllPoints(n,1);s.append(" value "+($b?this.e.atomExpressionAt(n).toString():JU.Escape.eAP(Qb)));z="probes";x=Qb;n=this.e.iToken;break;case 1073741970:z="gridPoints";s.append(" gridPoints");break;case 1073741976:z="ignore";x=ia=this.atomExpressionAt(++n);s.append(" ignore ").append(JU.Escape.eBS(ia));n=b.iToken;break;case 1073741985:z="insideOut";s.append(" insideout");break;case 1073741988:case 1073741986:case 1073742100:s.append(" ").appendO(b.theToken.value);
z="pocket";x=1073742100==R?Boolean.TRUE:Boolean.FALSE;break;case 1073742002:z="lobe";x=b.getPoint4f(++n);n=b.iToken;s.append(" lobe ").append(JU.Escape.eP4(x));l=!0;break;case 1073742004:case 1073742006:z="lp";x=b.getPoint4f(++n);n=b.iToken;s.append(" lp ").append(JU.Escape.eP4(x));l=!0;break;case 4125:(r||this.slen==n+1)&&this.invArg();r=!0;if((O||oa||A)&&!l)l=!0,this.addShapeProperty(C,"bsSolvent",oa||A?new JU.BS:b.lookupIdentifierValue("solvent")),this.addShapeProperty(C,"sasurface",Float.$valueOf(0));
0==s.length()?(na=this.getShapeProperty(24,"plane"),null==na?null!=this.getShapeProperty(24,"contours")&&this.addShapeProperty(C,"nocontour",null):(this.addShapeProperty(C,"plane",na),s.append("plane ").append(JU.Escape.eP4(na)),t=!0,na=null)):!l&&!t&&this.invArg();s.append("; isosurface map");this.addShapeProperty(C,"map",l?Boolean.TRUE:Boolean.FALSE);break;case 1073742014:z="maxset";x=Integer.$valueOf(this.intParameter(++n));s.append(" maxSet ").appendO(x);break;case 1073742020:z="minset";x=Integer.$valueOf(this.intParameter(++n));
s.append(" minSet ").appendO(x);break;case 1073742112:l=!0;z="rad";x=b.getPoint4f(++n);n=b.iToken;s.append(" radical ").append(JU.Escape.eP4(x));break;case 1073742027:z="fixed";x=Boolean.FALSE;s.append(" modelBased");break;case 1073742028:case 1073742135:case 1612709912:var Ma=b.theToken.value,ab;1073742028==R?(z="molecular",s.append(" molecular"),ab=this.isFloatParameter(n+1)?this.floatParameter(++n):1.4):(this.addShapeProperty(C,"bsSolvent",b.lookupIdentifierValue("solvent")),z=1073742135==R?"sasurface":
"solvent",s.append(" ").appendO(b.theToken.value),ab=this.isFloatParameter(n+1)?this.floatParameter(++n):this.vwr.getFloat(570425394));s.append(" ").appendF(ab);x=Float.$valueOf(ab);1073741961==this.tokAt(n+1)&&(this.addShapeProperty(C,"doFullMolecular",null),s.append(" full"),n++);l=!0;break;case 1073742032:this.addShapeProperty(C,"fileType","Mrc");s.append(" mrc");continue;case 1140850696:var fa=b.stringParameter(++n);this.addShapeProperty(C,"fileType",fa);s.append(' type "'+fa+'"');continue;case 1073742064:case 1073742062:this.addShapeProperty(C,
"fileType","Obj");s.append(" obj");continue;case 1073742033:this.addShapeProperty(C,"fileType","Msms");s.append(" msms");continue;case 1073742094:l&&this.invArg();z="phase";v=!0;x=4==this.tokAt(n+1)?this.stringParameter(++n):"_orb";s.append(" phase ").append(JU.PT.esc(x));break;case 1073742104:case 1073742122:z="resolution";x=Float.$valueOf(this.floatParameter(++n));s.append(" resolution ").appendO(x);break;case 1073742124:z="reverseColor";x=Boolean.TRUE;s.append(" reversecolor");break;case 1073742127:case 1073742146:z=
"sigma";x=Float.$valueOf(Z=this.floatParameter(++n));s.append(" sigma ").appendO(x);break;case 1112150021:z="geodesic";x=Float.$valueOf(this.floatParameter(++n));s.append(" geosurface ").appendO(x);l=!0;break;case 1073742154:z="sphere";x=Float.$valueOf(this.floatParameter(++n));s.append(" sphere ").appendO(x);l=!0;break;case 1073742156:z="squareData";x=Boolean.TRUE;s.append(" squared");break;case 1073741984:z=!l&&!t&&!r?"readFile":"mapColor";ja=this.stringParameter(++n);null==ja&&this.invArg();f&&
(ja=JU.PT.replaceWithCharacter(ja,"{,}|"," "));b.debugHigh&&JU.Logger.debug("pmesh inline data:\n"+ja);x=this.chk?null:ja;this.addShapeProperty(C,"fileName","");s.append(" INLINE ").append(JU.PT.esc(ja));l=!0;break;case 268437504:case 1073742195:case 7:(null!=hb||ua)&&this.invArg();var bb=b.listParameter4(n,2,2147483647,!0),n=b.iToken,Va=D(bb.size()/2);(0==Va||2*Va!=bb.size())&&this.invArg();var rb=Array(Va),sb=w(Va,0);s.append("[");try{for(var Rb=ea=0;ea<Va;ea++)sb[ea]=bb.get(Rb++).floatValue(),
rb[ea]=this.e.checkFileExists("ISOSURFACE_"+ea+"_",!1,bb.get(Rb++),n,!1),s.appendF(sb[ea]),s.append(" /*file*/").append(JU.PT.esc(rb[ea]));s.append("]")}catch(Sb){if(Y(Sb,Exception))this.invArg();else throw Sb;}hb=B(-1,[rb,sb]);z=!l&&!t&&!r?"readFile":"mapColor";l=!0;if(this.chk)break;this.addShapeProperty(C,"filesData",hb);break;case 545259556:case 545259557:case 1073741914:case 4:var tb=!l&&!t,M=null,z=tb&&!r?"readFile":"mapColor";4==R?M=this.paramAsStr(n):1073741914==R&&(M="=density/");if(null==
M||0==M.length||M.equals("*")||M.equals("=")){var Tb=this.vwr.getPdbID();null==Tb&&b.errorStr(22,"no PDBID available");M="*"+(545259557==R?"*":"")+Tb}var Ub=!1;M.startsWith("http://eds.bmc.uu.se/eds/dfs/cb/")&&M.endsWith(".omap")&&(M=(0<=M.indexOf("_diff")?"*":"")+"*"+M.substring(32,36));if(M.startsWith("*")||M.startsWith("=")){var ac=!Float.isNaN($)||!Float.isNaN(Z),ub=0<=M.indexOf("/full");ub&&(M=JU.PT.rep(M,"/full",""));0<=M.indexOf("/diff")&&(M="*"+M.substring(0,M.indexOf("/diff")));M.startsWith("**")&&
(ac||this.addShapeProperty(C,"sigma",Float.$valueOf(Z=3)),La||(La=!0,s.append(" sign"),this.addShapeProperty(C,"sign",Boolean.TRUE)));var bc=M,M=this.vwr.setLoadFormat(M,this.chk?"?":ub?"_":"-",!1);null==M&&b.errorStr(22,"error parsing filename: "+bc);Ub=!ub}Ub&&(null==ca&&0==ha&&(Ma=M,0>ba&&(ba=this.vwr.am.cmi),S=this.vwr.getModelUndeletedAtomsBitSet(ba),0<=S.nextSetBit(0)&&(ca=this.getWithinDistanceVector(C,2,null,S,!1),s.append(" within 2.0 ").append(JU.Escape.eBS(S)))),null!=ca&&0<=M.indexOf("/0,0,0/0,0,0?")&&
(M=M.$replace("0,0,0/0,0,0",ca[0].x+","+ca[0].y+","+ca[0].z+"/"+ca[ca.length-1].x+","+ca[ca.length-1].y+","+ca[ca.length-1].z)),tb&&(Ia=!0));var cb=null==M?-1:M.indexOf("#-");if(Float.isNaN(Z)&&Float.isNaN($))if(0<=(cb=M.indexOf("#-cutoff=")))this.addShapeProperty(C,"cutoff",Float.$valueOf($=Float.parseFloat(M.substring(cb+9)))),s.append(" cutoff "+$);else if(0<=(cb=M.indexOf("#-sigma=")))this.addShapeProperty(C,"sigma",Float.$valueOf(Z=Float.parseFloat(M.substring(cb+8)))),s.append(" sigma "+Z);
Float.isNaN(Z)?Float.isNaN($)||this.showString("using cutoff = "+$):this.showString("using sigma = "+Z);tb&&(this.vwr.getP("_fileType").equals("Pdb")&&Float.isNaN(Z)&&Float.isNaN($))&&(this.addShapeProperty(C,"sigma",Float.$valueOf(-1)),s.append(" sigma -1.0"));0==M.length&&(0>ba&&(ba=this.vwr.am.cmi),M=b.getFullPathName(!1),x=this.vwr.ms.getInfo(ba,"jmolSurfaceInfo"));var vb=-1;null==x&&2==this.tokAt(n+1)&&this.addShapeProperty(C,"fileIndex",Integer.$valueOf(vb=this.intParameter(++n)));var Wa=4==
this.tokAt(n+1)?this.stringParameter(++n):null,l=!0;if(this.chk)break;var Vb,za=null;null==x&&(0<=b.fullCommand.indexOf("# FILE0=")?(M=JU.PT.getQuotedAttribute(b.fullCommand,"# FILE0"),1073741848==this.tokAt(n+1)&&(n+=2)):1073741848==this.tokAt(n+1)&&(za=this.vwr.fm.getFilePath(this.stringParameter(b.iToken=n+=2),!1,!1),Vb=this.vwr.getFullPathNameOrError(za),za=Vb[0],""!==this.vwr.fm.getPathForAllFiles()?(M=za,za=null):this.addShapeProperty(C,"localName",za)));null==Wa&&(M=this.e.checkFileExists("ISOSURFACE_"+
(r?"MAP_":""),!1,M,n,!1));this.showString("reading isosurface data from "+M);null!=Wa&&(x=this.vwr.fm.cacheGet(M,!1),this.addShapeProperty(C,"calculationType",Wa));null==x&&(this.addShapeProperty(C,"fileName",M),null!=za&&(M=za),0<=vb&&s.append(" ").appendI(vb));s.append(" /*file*/").append(JU.PT.esc(M));null!=Wa&&s.append(" ").append(JU.PT.esc(Wa));break;case 4106:z="connections";switch(this.tokAt(++n)){case 12290:case 10:case 1073742325:x=u(-1,[this.atomExpressionAt(n).nextSetBit(0)]);break;default:x=
u(-1,[y(b.floatParameterSet(n,1,1)[0])])}n=b.iToken;break;case 1094713347:z="atomIndex";x=Integer.$valueOf(this.intParameter(++n));break;case 1073741999:z="link";s.append(" link");break;case 1814695966:24!=a&&this.invArg();268440577==this.tokAt(n+1)&&n++;z="extendGrid";x=Float.$valueOf(this.floatParameter(++n));s.append(" unitcell "+x);break;case 1073741994:24!=a&&this.invArg();Q=this.getPoint3f(++n,!1);n=b.iToken;if(0>=Q.x||0>=Q.y||0>=Q.z)break;Q.x=y(Q.x);Q.y=y(Q.y);Q.z=y(Q.z);s.append(" lattice ").append(JU.Escape.eP(Q));
r?(z="mapLattice",x=Q):(ta=Q,12293==this.tokAt(n+1)&&(s.append(" fixed"),va=!0,n++));break;default:1073741824==R&&(z="thisID",x=ja);if(!b.setMeshDisplayProperty(a,0,R)){if(JS.T.tokAttr(R,1073741824)&&!ya){this.setShapeId(a,n,ya);n=b.iToken;break}this.invArg()}0==c&&(c=n);n=this.slen-1}ya=12291!=R;ua&&l&&this.invArg();null!=z&&this.addShapeProperty(C,z,x)}if(!this.chk){if((O||oa)&&!l)l=!0,this.addShapeProperty(C,"bsSolvent",oa?new JU.BS:b.lookupIdentifierValue("solvent")),this.addShapeProperty(C,"sasurface",
Float.$valueOf(0));t&&(!l&&!r)&&(this.addShapeProperty(C,"nomap",Float.$valueOf(0)),l=!0);null!=P&&this.addShapeProperty(C,"getSurfaceSets",P);if(null!=Na)this.addShapeProperty(C,"colorDiscrete",Na);else if("sets".equals(pa))this.addShapeProperty(C,"setColorScheme",null);else if(null!=pa){var db=this.vwr.cm.getColorEncoder(pa);null!=db&&(db.isTranslucent=Aa,db.hi=3.4028235E38,this.addShapeProperty(C,"remapColor",db))}if(l&&!j&&0!=s.indexOf(";")){C.add(0,B(-1,["newObject",null]));var Wb=null==X;Wb&&
(X=JU.BSUtil.copy(this.vwr.bsA()));0>ba&&(ba=this.vwr.am.cmi);X.and(this.vwr.getModelUndeletedAtomsBitSet(ba));null!=Ma&&(1<this.vwr.ms.getModelBS(X,!1).cardinality()&&b.errorStr(30,"ISOSURFACE "+Ma),Wb&&(C.add(0,B(-1,["select",X])),0==s.indexOf("; isosurface map")&&(s=(new JU.SB).append("; isosurface map select ").append(JU.Escape.eBS(X)).append(s.substring(16)))))}A&&!E&&(l||this.addShapeProperty(C,"sasurface",Float.$valueOf(0)),r||(this.addShapeProperty(C,"map",Boolean.TRUE),this.addShapeProperty(C,
"select",S),this.addShapeProperty(C,"sasurface",Float.$valueOf(0))),this.addShapeProperty(C,"slab",this.getCapSlabObject(-100,!1)));var Xb=l&&this.vwr.getBoolean(603979934);Xb&&JU.Logger.startTimer("isosurface");this.setShapeProperty(a,"setProperties",C);Xb&&this.showString(JU.Logger.getTimerMsg("isosurface",0));Ia&&(this.setShapeProperty(a,"token",Integer.$valueOf(1073742018)),this.setShapeProperty(a,"token",Integer.$valueOf(1073742046)),q=!0,s.append(" mesh nofill frontOnly"))}null!=ta&&(this.setShapeProperty(a,
"lattice",ta),va&&this.setShapeProperty(a,"fixLattice",Boolean.TRUE));null!=Fa&&this.setShapeProperty(a,"symops",Fa);q&&this.setShapeProperty(a,"token",Integer.$valueOf(1073741960));0<c&&(b.setMeshDisplayProperty(a,c,0)||this.invArg());if(!this.chk){var Da=null,Ea=null;m&&(Da=this.getShapeProperty(a,"area"),T(Da,Float)?this.vwr.setFloatProperty("isosurfaceArea",Da.floatValue()):this.vwr.g.setUserVariable("isosurfaceArea",JS.SV.getVariableAD(Da)));Ba&&(Ea=Ba?this.getShapeProperty(a,"volume"):null,
T(Ea,Float)?this.vwr.setFloatProperty("isosurfaceVolume",Ea.floatValue()):this.vwr.g.setUserVariable("isosurfaceVolume",JS.SV.getVariableAD(Ea)));if(!j){fa=null;r&&!l?this.setShapeProperty(a,"finalize",s.toString()):l&&(N=s.toString(),this.setShapeProperty(a,"finalize",(0==N.indexOf("; isosurface map")?"":" select "+JU.Escape.eBS(X)+" ")+N),fa=this.getShapeProperty(a,"ID"),null!=fa&&(!b.tQuiet&&!g)&&($=this.getShapeProperty(a,"cutoff").floatValue(),Float.isNaN($)&&!Float.isNaN(Z)&&JU.Logger.error("sigma not supported"),
fa+=" created "+this.getShapeProperty(a,"message")));var wb,xb;if(m||Ba)wb=m?"isosurfaceArea = "+(T(Da,Float)?""+Da:JU.Escape.eAD(Da)):null,xb=Ba?"isosurfaceVolume = "+(T(Ea,Float)?""+Ea:JU.Escape.eAD(Ea)):null,null==fa?(m&&this.showString(wb),Ba&&this.showString(xb)):(m&&(fa+="\n"+wb),Ba&&(fa+="\n"+xb));null!=fa&&!g&&this.showString(fa);l&&(fa=this.getShapeProperty(a,"output"),null!=fa&&!g&&this.showString(fa))}null!=ib&&this.setShapeProperty(a,"translucency",ib);this.setShapeProperty(a,"clear",
null);aa&&this.setShapeProperty(a,"cache",null);!g&&(!e&&!E&&12291!=b.theTok)&&this.listIsosurface(a)}}},"~N");d(c$,"lcaoCartoon",function(){var a=this.e;a.sm.loadShape(26);if(!(1073742001==a.tokAt(1)&&this.listIsosurface(26)))if(this.setShapeProperty(26,"init",a.fullCommand),1==this.slen)this.setShapeProperty(26,"lcaoID",null);else{for(var b=!1,c=null,c=1;c<this.slen;c++){var e=null,k=null;switch(this.getToken(c).tok){case 1073741875:case 554176565:e=a.theToken.value;1073742334==this.tokAt(c+1)&&
(a.iToken=c+1);k=this.getCapSlabObject(c,!0);c=a.iToken;break;case 12289:this.isosurface(26);return;case 528432:var h=k=0,f=0;switch(this.getToken(++c).tok){case 1111492629:k=0.017453292519943295*this.floatParameter(++c);break;case 1111492630:h=0.017453292519943295*this.floatParameter(++c);break;case 1111492631:f=0.017453292519943295*this.floatParameter(++c);break;default:this.invArg()}e="rotationAxis";k=JU.V3.new3(k,h,f);break;case 1073742335:case 1610625028:case 2097192:e="on";break;case 1073742334:case 12294:case 2097194:e=
"off";break;case 12291:e="delete";break;case 12290:case 10:case 1073742325:e="select";k=this.atomExpressionAt(c);c=a.iToken;break;case 1140850693:e="reversecolor";k=Boolean.TRUE;1073742335==this.tokAt(c+1)?++c:1073742334==this.tokAt(c+1)&&(k=Boolean.FALSE,++c);break;case 1765808134:c=this.setColorOptions(null,c+1,26,-2);null!=c&&this.setShapeProperty(26,"settranslucency",c);c=a.iToken;b=!0;continue;case 603979967:case 1073742074:a.setMeshDisplayProperty(26,c,a.theTok);c=a.iToken;b=!0;continue;case 1112152075:case 4:k=
this.paramAsStr(c).toLowerCase();k.equals("spacefill")&&(k="cpk");e="create";a.optParameterAsString(c+1).equalsIgnoreCase("molecular")&&(c++,e="molecular");break;case 1275082241:a.isAtomExpression(c+1)?(e="select",k=this.atomExpressionAt(c+1),c=a.iToken):(e="selectType",k=this.paramAsStr(++c),k.equals("spacefill")&&(k="cpk"));break;case 536875009:e="scale";k=Float.$valueOf(this.floatParameter(++c));break;case 1073742004:case 1073742006:e="lonePair";break;case 1073742112:case 1073742111:e="radical";
break;case 1073742028:e="molecular";break;case 1073741904:k=this.paramAsStr(++c);e="create";a.optParameterAsString(c+1).equalsIgnoreCase("molecular")&&(c++,e="molecular");break;case 1073741974:k=a.setShapeNameParameter(++c);c=a.iToken;b&&this.invArg();e="lcaoID";break;default:if(268441089==a.theTok||JS.T.tokAttr(a.theTok,1073741824))268441089!=a.theTok&&(k=this.paramAsStr(c)),b&&this.invArg(),e="lcaoID"}12291!=a.theTok&&(b=!0);null==e&&this.invArg();this.setShapeProperty(26,e,k)}this.setShapeProperty(26,
"clear",null)}});d(c$,"contact",function(){var a=this.e;a.sm.loadShape(25);if(1073742001==this.tokAt(1)&&this.listIsosurface(25))return!1;var b=0;a.iToken=1;for(var c=null!=this.initIsosurface(25),e=c&&null==this.getShapeProperty(25,"ID"),k=null,h=null,f=null,d=null,j=null,g=!1,l=new JU.SB,t=2147483647,r=134217750,L=0,v=NaN,m=NaN,u=!0,y=null,H=null,F=0,aa=!1,I=-2147483648,E=1<a.iToken,A=a.iToken;A<this.slen;++A){switch(f=this.getToken(A).tok){default:E=!0;if(!a.setMeshDisplayProperty(25,0,a.theTok)){268441089!=
a.theTok&&!JS.T.tokAttr(a.theTok,1073741824)&&this.invArg();this.setShapeId(25,A,c);A=a.iToken;break}0==b&&(b=A);A=a.iToken;continue;case 1073741974:E=!0;this.setShapeId(25,++A,c);e=null==this.getShapeProperty(25,"ID");A=a.iToken;break;case 1765808134:switch(this.tokAt(A+1)){case 1073741914:f=0;g=!0;l.append(" color density");A++;break;case 1140850696:f=0,aa=!0,l.append(" color type"),A++}if(0==f)break;case 603979967:case 1073742074:E=!0;0==F&&(F=A);a.setMeshDisplayProperty(25,A,a.theTok);A=a.iToken;
break;case 554176565:E=!0;H=this.getCapSlabObject(A,!1);this.setShapeProperty(25,"slab",H);A=a.iToken;break;case 1073741914:g=!0;l.append(" density");this.isFloatParameter(A+1)&&(null==j&&(j=w(1,0)),j[0]=-Math.abs(this.floatParameter(++A)),l.append(" "+-j[0]));break;case 1073742122:c=this.floatParameter(++A);0<c&&(l.append(" resolution ").appendF(c),this.setShapeProperty(25,"resolution",Float.$valueOf(c)));break;case 1094717454:case 1094713359:I=1094713359==a.theTok?this.intParameter(++A):a.modelNumberParameter(++A);
l.append(" modelIndex "+I);break;case 134217759:case 1275069443:v=this.floatParameter(++A);l.append(" within ").appendF(v);break;case 268440577:case 2:case 3:d=a.encodeRadiusParameter(A,!1,!1);if(null==d)return!1;l.append(" ").appendO(d);A=a.iToken;break;case 1073741990:case 1073741989:y=1073741989==f?Boolean.TRUE:Boolean.FALSE;l.append(" ").appendO(a.theToken.value);break;case 1073742020:t=this.intParameter(++A);break;case 1613238294:case 1073741881:case 1648363544:L=f;l.append(" ").appendO(a.theToken.value);
break;case 1073742135:this.isFloatParameter(A+1)&&(m=this.floatParameter(++A));case 1073741875:case 1073742036:case 2097180:u=!1;case 1275068932:case 1073741961:case 134217750:case 4106:r=f;l.append(" ").appendO(a.theToken.value);1073742135==f&&l.append(" ").appendF(m);break;case 1073742083:j=a.floatParameterSet(++A,1,10);A=a.iToken;break;case 12290:case 10:case 1073742325:(e||null!=h)&&this.invArg(),f=JU.BSUtil.copy(this.atomExpressionAt(A)),A=a.iToken,null==k?k=f:h=f,l.append(" ").append(JU.Escape.eBS(f))}c=
12291!=a.theTok}!E&&null==k&&this.error(13);if(this.chk)return!1;if(null!=k){1648363544==L&&null==d&&(d=new J.atomdata.RadiusData(null,0,J.atomdata.RadiusData.EnumType.OFFSET,J.c.VDW.AUTO));A=null==d?new J.atomdata.RadiusData(null,0.26,J.atomdata.RadiusData.EnumType.OFFSET,J.c.VDW.AUTO):d;h=1073742036==r&&null==h&&null!=y&&y.booleanValue()?k:a.getMathExt().setContactBitSets(k,h,u,v,A,!0);switch(r){case 1073741875:case 1073742135:A=a.lookupIdentifierValue("solvent");k.andNot(A);h.andNot(A);h.andNot(k);
break;case 2097180:h.andNot(k);break;case 1073742036:2147483647==t&&(t=100),this.setShapeProperty(25,"minset",Integer.$valueOf(t)),l.append(" minSet ").appendI(t),null==j&&(j=w(-1,[0.5,2]))}null!=y&&(j=null==j?w(2,0):JU.AU.ensureLengthA(j,2),j[1]=y.booleanValue()?1:2);null!=j&&l.append(" parameters ").append(JU.Escape.eAF(j));this.setShapeProperty(25,"set",B(-1,[Integer.$valueOf(L),Integer.$valueOf(r),Boolean.$valueOf(g),Boolean.$valueOf(aa),k,h,d,Float.$valueOf(m),j,Integer.$valueOf(I),l.toString()]));
0<F&&a.setMeshDisplayProperty(25,F,0)}0<b&&(a.setMeshDisplayProperty(25,b,0)||this.invArg());null!=H&&null!=k&&this.setShapeProperty(25,"slab",H);if(null!=k&&(1073742036==r||u)){k=this.getShapeProperty(25,"volume");b=1073741961==r;if(JU.AU.isAD(k))for(A=a=0;A<k.length;A++)a+=b?k[A]:Math.abs(k[A]);else a=k.floatValue();a=Math.round(1E3*a)/1E3;if(g||1275068932!=r)g=this.getShapeProperty(25,"nSets").intValue(),g="Contacts: "+(0>g?D(-g/2):g),0!=a&&(g+=", with "+(b?"approx ":"net ")+"volume "+a+" A^3"),
this.showString(g)}return!0});d(c$,"cgo",function(){var a=this.e;a.sm.loadShape(23);if(1073742001==this.tokAt(1)&&this.listIsosurface(23))return!1;for(var b=0,c=null!=this.initIsosurface(23),e=c&&null==this.getShapeProperty(23,"ID"),k=!1,h=-1,f=null,d=3.4028235E38,j=u(-1,[-2147483648]),g=0,l=a.iToken;l<this.slen;++l){var t=null,h=null;switch(this.getToken(l).tok){case 268437504:case 1073742195:case 7:(null!=f||e)&&this.invArg();f=new JU.Lst;l=u(-1,[l,this.slen]);a.getShapePropertyData(23,"data",B(-1,
[this.st,l,f,this.vwr]))||this.invArg();l=l[0];continue;case 536875009:++l>=this.slen&&this.error(34);switch(this.getToken(l).tok){case 2:g=this.intParameter(l);continue;case 3:g=Math.round(100*this.floatParameter(l));continue}this.error(34);break;case 12293:t="modelIndex";h=Integer.$valueOf(-1);break;case 1094713359:case 1094717454:h=1094713359==a.theTok?this.intParameter(++l):a.modelNumberParameter(++l);t="modelIndex";h=Integer.$valueOf(h);break;case 1765808134:case 603979967:case 1073742074:d=
this.getColorTrans(a,l,!1,j);l=a.iToken;c=!0;continue;case 1073741974:this.setShapeId(23,++l,c);e=null==this.getShapeProperty(23,"ID");l=a.iToken;break;default:if(!a.setMeshDisplayProperty(23,0,a.theTok)){if(268441089==a.theTok||JS.T.tokAttr(a.theTok,1073741824)){this.setShapeId(23,l,c);l=a.iToken;break}this.invArg()}0==b&&(b=l);l=a.iToken;continue}c=12291!=a.theTok;null!=f&&!k&&(t="points",h=Integer.$valueOf(g),k=!0,g=0);null!=t&&this.setShapeProperty(23,t,h)}this.finalizeObject(23,j[0],d,g,null!=
f,f,b,null);return!0});d(c$,"getAtomicPotentials",function(a,b,c){var e=w(this.vwr.ms.ac,0),k=J.api.Interface.getOption("quantum.MlpCalculation",this.vwr,"script");k.set(this.vwr);c=null==c?null:this.vwr.getFileAsString3(c,!1,null);try{k.assignPotentials(this.vwr.ms.at,e,this.vwr.getSmartsMatch("a",a),this.vwr.getSmartsMatch("/noAromatic/[$(C=O),$(O=C),$(NC=O)]",a),b,c)}catch(h){if(!Y(h,Exception))throw h;}return e},"JU.BS,JU.BS,~S");d(c$,"getCapSlabObject",function(a,b){if(0>a)return JU.TempArray.getSlabWithinRange(a,
0);var c=this.e,e=null,k=554176565==this.tokAt(a),h=this.tokAt(a+1),f=null,d=f=null,j=null,g=null;if(603979967==h)switch(j=this.isFloatParameter(++a+1)?this.floatParameter(++a):0.5,c.isColorParam(a+1)?(j=Short.$valueOf(JU.C.getColixTranslucent3(JU.C.getColix(c.getArgbParam(a+1)),0!=j,j)),a=c.iToken):j=Short.$valueOf(JU.C.getColixTranslucent3(1,0!=j,j)),h=this.tokAt(a+1)){case 1073742018:case 1073741938:g=Integer.$valueOf(h);h=this.tokAt(++a+1);break;default:g=Integer.$valueOf(1073741938)}switch(h){case 1073742334:return c.iToken=
a+1,Integer.$valueOf(-2147483648);case 1073742333:c.iToken=a+1;break;case 1073742330:a++;e=B(-1,[Float.$valueOf(1),this.paramAsStr(++a)]);h=1073742018;break;case 134217759:a++;if(1073742114==this.tokAt(++a))e=this.floatParameter(++a),h=this.floatParameter(++a),e=B(-1,[Float.$valueOf(e),Float.$valueOf(h)]),h=1073742114;else if(this.isFloatParameter(a)){e=this.floatParameter(a);if(c.isCenterParameter(++a)){var f=Array(1),l=c.centerParameter(a,f);if(this.chk||!T(f[0],JU.BS))f=B(-1,[l]);else for(var l=
this.vwr.ms.at,d=f[0],f=Array(d.cardinality()),t=0,r=d.nextSetBit(0);0<=r;r=d.nextSetBit(r+1),t++)f[t]=l[r]}else f=c.getPointArray(a,-1,!1);0==f.length&&(c.iToken=a,this.invArg());e=B(-1,[Float.$valueOf(e),f,d])}else e=c.getPointArray(a,4,!1),h=1812599299;break;case 1812599299:c.iToken=a+1;e=JU.BoxInfo.toOABC(this.vwr.ms.getBBoxVertices(),null);break;case 1073741872:case 1814695966:c.iToken=a+1;c=this.vwr.getCurrentUnitCell();if(null==c)1814695966==h&&this.invArg();else{f=JU.BoxInfo.toOABC(c.getUnitCellVerticesNoOffset(),
c.getCartesianOffset());c=y(c.getUnitCellInfoType(6));e=d=null;switch(c){case 1:e=JU.V3.newVsub(f[2],f[0]),e.scale(1E3);case 2:d=JU.V3.newVsub(f[1],f[0]),d.scale(1E3),f[0].sub(d),f[1].scale(2E3),1==c&&(f[0].sub(e),f[2].scale(2E3))}e=f}break;case 12290:case 10:case 1073742325:if(e=this.atomExpressionAt(a+1),h=3,!c.isCenterParameter(++c.iToken)){k=!0;break}default:if(!b&&k&&this.isFloatParameter(a+1)){e=this.floatParameter(++a);if(!this.isFloatParameter(a+1))return Integer.$valueOf(y(e));h=this.floatParameter(++a);
e=B(-1,[Float.$valueOf(e),Float.$valueOf(h)]);h=1073742114;break}f=c.planeParameter(++a,!1);h=this.isFloatParameter(c.iToken+1)?this.floatParameter(++c.iToken):NaN;Float.isNaN(h)||(f.w-=h);e=f;h=134217750}j=null==g?null:B(-1,[g,j]);return JU.TempArray.getSlabObjectType(h,e,!k,j)},"~N,~B");d(c$,"setColorOptions",function(a,b,c,e){var k=this.e;this.getToken(b);var h="opaque";if(603979967==k.theTok)if(h="translucent",0>e){var f=this.isFloatParameter(b+1)?this.floatParameter(++b):3.4028235E38;k.setShapeTranslucency(c,
null,"translucent",f,null);null!=a&&(a.append(" translucent"),3.4028235E38!=f&&a.append(" ").appendF(f))}else k.setMeshDisplayProperty(c,b,k.theTok);else 1073742074==k.theTok?0<=e&&k.setMeshDisplayProperty(c,b,k.theTok):k.iToken--;e=Math.abs(e);for(f=0;f<e;f++)if(k.isColorParam(k.iToken+1)){var d=k.getArgbParam(++k.iToken);this.setShapeProperty(c,"colorRGB",Integer.$valueOf(d));null!=a&&a.append(" ").append(JU.Escape.escapeColor(d))}else if(k.iToken<b)this.invArg();else break;return h},"JU.SB,~N,~N,~N");
d(c$,"createFunction",function(a,b,c){var e=(new JS.ScriptEval).setViewer(this.vwr);try{e.compileScript(null,"function "+a+"("+b+") { return "+c+"}",!1);var k=new JU.Lst;for(a=0;a<b.length;a+=2)k.addLast(JS.SV.newF(0).setName(b.substring(a,a+1)));return B(-1,[e.aatoken[0][1].value,k])}catch(h){if(Y(h,Exception))return null;throw h;}},"~S,~S,~S");d(c$,"getWithinDistanceVector",function(a,b,c,e,k){var h=new JU.Lst,f=Array(2);if(null==e){var d=JU.P3.new3(b,b,b),j=JU.P3.newP(c);j.sub(d);d.add(c);f[0]=
j;f[1]=d;h.addLast(c)}else c=this.vwr.ms.getBoxInfo(e,-Math.abs(2*b)),f[0]=c.getBoundBoxVertices()[0],f[1]=c.getBoundBoxVertices()[7],1==e.cardinality()&&h.addLast(this.vwr.ms.at[e.nextSetBit(0)]);1==h.size()&&!k&&(this.addShapeProperty(a,"withinDistance",Float.$valueOf(b)),this.addShapeProperty(a,"withinPoint",h.get(0)));this.addShapeProperty(a,k?"displayWithin":"withinPoints",B(-1,[Float.$valueOf(b),f,e,h]));return f},"JU.Lst,~N,JU.P3,JU.BS,~B");d(c$,"addShapeProperty",function(a,b,c){this.chk||
a.addLast(B(-1,[b,c]))},"JU.Lst,~S,~O");d(c$,"floatArraySetXYZ",function(a,b,c,e){var k=this.e,h=this.tokAt(a++);1073742195==h&&(h=this.tokAt(a++));(268437504!=h||0>=b)&&this.invArg();for(var f=JU.AU.newFloat3(b,-1),d=0;268437505!=h;)switch(h=this.getToken(a).tok,h){case 1073742195:case 268437505:continue;case 268436992:a++;break;case 268437504:f[d++]=this.floatArraySet(a,c,e);a=++k.iToken;h=0;d==b&&268437505!=this.tokAt(a)&&this.invArg();break;default:this.invArg()}return f},"~N,~N,~N,~N");d(c$,
"floatArraySet",function(a,b,c){var e=this.tokAt(a++);1073742195==e&&(e=this.tokAt(a++));268437504!=e&&this.invArg();for(var k=JU.AU.newFloat2(b),h=0;268437505!=e;)switch(e=this.getToken(a).tok,e){case 1073742195:case 268437505:continue;case 268436992:a++;break;case 268437504:a++;e=w(c,0);k[h++]=e;for(var f=0;f<c;f++)e[f]=this.floatParameter(a++),268436992==this.tokAt(a)&&a++;268437505!=this.tokAt(a++)&&this.invArg();e=0;h==b&&268437505!=this.tokAt(a)&&this.invArg();break;default:this.invArg()}return k},
"~N,~N,~N");d(c$,"initIsosurface",function(a){var b=this.e;this.setShapeProperty(a,"init",b.fullCommand);b.iToken=0;var c=this.tokAt(1),e=this.tokAt(2);if(12291==c||12291==e&&1073742327==this.tokAt(++b.iToken))return this.setShapeProperty(a,"delete",null),b.iToken+=2,this.slen>b.iToken&&(this.setShapeProperty(a,"init",b.fullCommand),this.setShapeProperty(a,"thisID","+PREVIOUS_MESH+")),null;b.iToken=1;return!b.setMeshDisplayProperty(a,0,c)&&(this.setShapeProperty(a,"thisID","+PREVIOUS_MESH+"),22!=
a&&this.setShapeProperty(a,"title",B(-1,[b.thisCommand])),1073741974!=c&&(268441089==e||268441089==c&&b.setMeshDisplayProperty(a,0,e)))?(a=this.setShapeId(a,1,!1),b.iToken++,a):null},"~N");d(c$,"listIsosurface",function(a){var b=3<this.slen?"0":0==this.tokAt(2)?"":" "+this.getToken(2).value;this.chk||this.showString(this.getShapeProperty(a,"list"+b));return!0},"~N");d(c$,"getBoxPoints",function(a,b,c,e){switch(a){case 1814695966:return null==b?null:b.getCanonicalCopy(e,!0);case 1812599299:return null==
c?a=this.vwr.ms.getBoxInfo():(a=new JU.BoxInfo,this.vwr.calcAtomsMinMax(c,a)),JU.BoxInfo.getCanonicalCopy(a.getBoundBoxVertices(),e);default:return null}},"~N,J.api.SymmetryInterface,JU.BS,~N")});O("JU");F(["JU.TriangleData"],"JU.Triangulator","JU.AU $.BS $.Lst $.Measure $.P3 $.P4 $.V3".split(" "),function(){c$=Aa(JU,"Triangulator",JU.TriangleData);d(c$,"intersectLine",function(a,b,c,e){b=new JU.V3;for(var k=new JU.V3,h=new JU.V3,f=new JU.V3,d=null,j=null,g=new JU.P3,l=new JU.P4,t=3.4028235E38,r=
-3.4028235E38,L=0;12>L;L++){var v=JU.Triangulator.fullCubePolygon[L];if(0==L%2){JU.Measure.getPlaneThroughPoints(a[v[0]],a[v[1]],a[v[2]],b,k,l);if(null==JU.Measure.getIntersection(c,e,l,g,b,h)){L++;continue}f.sub2(g,c)}if(JU.Measure.isInTriangle(g,a[v[0]],a[v[1]],a[v[2]],b,k,h)){v=e.dot(f);v<t&&(t=v,d=g);v>r&&(r=v,j=g);0==L%2&&L++;if(0.01<r-t)break;g=new JU.P3}}return null==d||(null==j||0.001>d.distance(j))&&null==(j=d)?null:B(-1,[d,j])},"~A,~N,JU.P3,JU.V3");d(c$,"getCellProjection",function(a,b){for(var c=
new JU.V3,e=0,k=-3.4028235E38,h=0,f=Array(8),d=0;8>d;d++)e=b[d].dot(a),e>k&&(k=e,h=d),JU.Measure.getPlaneProjection(b[d],a,f[d]=new JU.P3,c);e=JU.Triangulator.fullCubeCorners[h][3];c=JU.AU.newInt2(6);for(d=k=0;12>d;d++)if(0!=(e&JU.TriangleData.Pwr2[d])){var j=u(4,0),g=JU.Triangulator.fullCubePolygon[d];j[0]=g[0];j[1]=g[1];j[2]=g[2];j[3]=g[0]==h?2:g[1]==h?0:g[2]==h?1:3;c[k++]=j}h=new JU.Lst;h.addLast(f);h.addLast(c);return h},"JU.P4,~A");d(c$,"intersectPlane",function(a,b,c){if(-1==c&&8==b.length)return this.getCellProjection(a,
b);for(var e=new JU.Lst,k=Array(12),h=0,f=w(8,0),d=0;8>d;d++)f[d]=a.x*b[d].x+a.y*b[d].y+a.z*b[d].z+a.w,0>f[d]&&(h|=JU.TriangleData.Pwr2[d]);a=JU.TriangleData.triangleTable2[h];if(null==a)return null;for(d=0;24>d;d+=2){var h=JU.TriangleData.edgeVertexes[d],j=JU.TriangleData.edgeVertexes[d+1],g=JU.P3.newP(b[j]);g.sub(b[h]);g.scale(f[h]/(f[h]-f[j]));g.add(b[h]);k[d>>1]=g}if(0==c){c=new JU.BS;for(d=0;d<a.length;d++)c.set(a[d]),2==d%4&&d++;d=c.cardinality();f=Array(d);e.addLast(f);b=u(12,0);for(d=h=0;d<
a.length;d++)j=a[d],c.get(j)&&(c.clear(j),f[h]=k[j],b[j]=h++),2==d%4&&d++;k=JU.AU.newInt2(a.length>>2);e.addLast(k);for(d=0;d<a.length;d++)k[d>>2]=u(-1,[b[a[d++]],b[a[d++]],b[a[d++]],a[d]]);return e}for(d=0;d<a.length;d++)b=k[a[d++]],f=k[a[d++]],h=k[a[d++]],1==(c&1)&&e.addLast(B(-1,[b,f,h])),2==(c&2)&&(j=a[d],1==(j&1)&&e.addLast(B(-1,[b,f])),2==(j&2)&&e.addLast(B(-1,[f,h])),4==(j&4)&&e.addLast(B(-1,[b,h])));return e},"JU.P4,~A,~N");Z(c$,"fullCubePolygon",B(-1,[u(-1,[0,4,5,3]),u(-1,[5,1,0,3]),u(-1,
[1,5,6,2]),u(-1,[6,2,1,3]),u(-1,[2,6,7,2]),u(-1,[7,3,2,3]),u(-1,[3,7,4,2]),u(-1,[4,0,3,2]),u(-1,[6,5,4,0]),u(-1,[4,7,6,0]),u(-1,[0,1,2,0]),u(-1,[2,3,0,0])]),"fullCubeCorners",B(-1,[u(-1,[1,4,3,3267]),u(-1,[0,2,5,3087]),u(-1,[1,3,6,3132]),u(-1,[2,0,7,3312]),u(-1,[0,5,7,963]),u(-1,[1,6,4,783]),u(-1,[2,7,5,828]),u(-1,[3,4,6,1008])]))});O("JU");F(["JU.P3i"],"JU.TriangleData",null,function(){c$=Aa(JU,"TriangleData");Z(c$,"Pwr2",u(-1,[1,2,4,8,16,32,64,128,256,512,1024,2048]));c$.cubeVertexOffsets=c$.prototype.cubeVertexOffsets=
B(-1,[JU.P3i.new3(0,0,0),JU.P3i.new3(1,0,0),JU.P3i.new3(1,0,1),JU.P3i.new3(0,0,1),JU.P3i.new3(0,1,0),JU.P3i.new3(1,1,0),JU.P3i.new3(1,1,1),JU.P3i.new3(0,1,1)]);Z(c$,"edgeVertexes",g(-1,[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),"triangleTable2",B(-1,[null,g(-1,[0,8,3,7]),g(-1,[0,1,9,7]),g(-1,[1,8,3,6,9,8,1,5]),g(-1,[1,2,10,7]),g(-1,[0,8,3,7,1,2,10,7]),g(-1,[9,2,10,6,0,2,9,5]),g(-1,[2,8,3,6,2,10,8,1,10,9,8,3]),g(-1,[3,11,2,7]),g(-1,[0,11,2,6,8,11,0,5]),g(-1,[1,9,0,7,2,3,11,7]),g(-1,[1,11,2,
6,1,9,11,1,9,8,11,3]),g(-1,[3,10,1,6,11,10,3,5]),g(-1,[0,10,1,6,0,8,10,1,8,11,10,3]),g(-1,[3,9,0,6,3,11,9,1,11,10,9,3]),g(-1,[9,8,10,5,10,8,11,6]),g(-1,[4,7,8,7]),g(-1,[4,3,0,6,7,3,4,5]),g(-1,[0,1,9,7,8,4,7,7]),g(-1,[4,1,9,6,4,7,1,1,7,3,1,3]),g(-1,[1,2,10,7,8,4,7,7]),g(-1,[3,4,7,6,3,0,4,3,1,2,10,7]),g(-1,[9,2,10,6,9,0,2,3,8,4,7,7]),g(-1,[2,10,9,3,2,9,7,0,2,7,3,6,7,9,4,6]),g(-1,[8,4,7,7,3,11,2,7]),g(-1,[11,4,7,6,11,2,4,1,2,0,4,3]),g(-1,[9,0,1,7,8,4,7,7,2,3,11,7]),g(-1,[4,7,11,3,9,4,11,1,9,11,2,2,9,
2,1,6]),g(-1,[3,10,1,6,3,11,10,3,7,8,4,7]),g(-1,[1,11,10,6,1,4,11,0,1,0,4,3,7,11,4,5]),g(-1,[4,7,8,7,9,0,11,1,9,11,10,6,11,0,3,6]),g(-1,[4,7,11,3,4,11,9,4,9,11,10,6]),g(-1,[9,5,4,7]),g(-1,[9,5,4,7,0,8,3,7]),g(-1,[0,5,4,6,1,5,0,5]),g(-1,[8,5,4,6,8,3,5,1,3,1,5,3]),g(-1,[1,2,10,7,9,5,4,7]),g(-1,[3,0,8,7,1,2,10,7,4,9,5,7]),g(-1,[5,2,10,6,5,4,2,1,4,0,2,3]),g(-1,[2,10,5,3,3,2,5,1,3,5,4,2,3,4,8,6]),g(-1,[9,5,4,7,2,3,11,7]),g(-1,[0,11,2,6,0,8,11,3,4,9,5,7]),g(-1,[0,5,4,6,0,1,5,3,2,3,11,7]),g(-1,[2,1,5,3,
2,5,8,0,2,8,11,6,4,8,5,5]),g(-1,[10,3,11,6,10,1,3,3,9,5,4,7]),g(-1,[4,9,5,7,0,8,1,5,8,10,1,2,8,11,10,3]),g(-1,[5,4,0,3,5,0,11,0,5,11,10,6,11,0,3,6]),g(-1,[5,4,8,3,5,8,10,4,10,8,11,6]),g(-1,[9,7,8,6,5,7,9,5]),g(-1,[9,3,0,6,9,5,3,1,5,7,3,3]),g(-1,[0,7,8,6,0,1,7,1,1,5,7,3]),g(-1,[1,5,3,5,3,5,7,6]),g(-1,[9,7,8,6,9,5,7,3,10,1,2,7]),g(-1,[10,1,2,7,9,5,0,5,5,3,0,2,5,7,3,3]),g(-1,[8,0,2,3,8,2,5,0,8,5,7,6,10,5,2,5]),g(-1,[2,10,5,3,2,5,3,4,3,5,7,6]),g(-1,[7,9,5,6,7,8,9,3,3,11,2,7]),g(-1,[9,5,7,3,9,7,2,0,9,
2,0,6,2,7,11,6]),g(-1,[2,3,11,7,0,1,8,5,1,7,8,2,1,5,7,3]),g(-1,[11,2,1,3,11,1,7,4,7,1,5,6]),g(-1,[9,5,8,5,8,5,7,6,10,1,3,3,10,3,11,6]),g(-1,[5,7,0,1,5,0,9,6,7,11,0,1,1,0,10,5,11,10,0,1]),g(-1,[11,10,0,1,11,0,3,6,10,5,0,1,8,0,7,5,5,7,0,1]),g(-1,[11,10,5,3,7,11,5,5]),g(-1,[10,6,5,7]),g(-1,[0,8,3,7,5,10,6,7]),g(-1,[9,0,1,7,5,10,6,7]),g(-1,[1,8,3,6,1,9,8,3,5,10,6,7]),g(-1,[1,6,5,6,2,6,1,5]),g(-1,[1,6,5,6,1,2,6,3,3,0,8,7]),g(-1,[9,6,5,6,9,0,6,1,0,2,6,3]),g(-1,[5,9,8,3,5,8,2,0,5,2,6,6,3,2,8,5]),g(-1,[2,
3,11,7,10,6,5,7]),g(-1,[11,0,8,6,11,2,0,3,10,6,5,7]),g(-1,[0,1,9,7,2,3,11,7,5,10,6,7]),g(-1,[5,10,6,7,1,9,2,5,9,11,2,2,9,8,11,3]),g(-1,[6,3,11,6,6,5,3,1,5,1,3,3]),g(-1,[0,8,11,3,0,11,5,0,0,5,1,6,5,11,6,6]),g(-1,[3,11,6,3,0,3,6,1,0,6,5,2,0,5,9,6]),g(-1,[6,5,9,3,6,9,11,4,11,9,8,6]),g(-1,[5,10,6,7,4,7,8,7]),g(-1,[4,3,0,6,4,7,3,3,6,5,10,7]),g(-1,[1,9,0,7,5,10,6,7,8,4,7,7]),g(-1,[10,6,5,7,1,9,7,1,1,7,3,6,7,9,4,6]),g(-1,[6,1,2,6,6,5,1,3,4,7,8,7]),g(-1,[1,2,5,5,5,2,6,6,3,0,4,3,3,4,7,6]),g(-1,[8,4,7,7,9,
0,5,5,0,6,5,2,0,2,6,3]),g(-1,[7,3,9,1,7,9,4,6,3,2,9,1,5,9,6,5,2,6,9,1]),g(-1,[3,11,2,7,7,8,4,7,10,6,5,7]),g(-1,[5,10,6,7,4,7,2,1,4,2,0,6,2,7,11,6]),g(-1,[0,1,9,7,4,7,8,7,2,3,11,7,5,10,6,7]),g(-1,[9,2,1,6,9,11,2,2,9,4,11,1,7,11,4,5,5,10,6,7]),g(-1,[8,4,7,7,3,11,5,1,3,5,1,6,5,11,6,6]),g(-1,[5,1,11,1,5,11,6,6,1,0,11,1,7,11,4,5,0,4,11,1]),g(-1,[0,5,9,6,0,6,5,2,0,3,6,1,11,6,3,5,8,4,7,7]),g(-1,[6,5,9,3,6,9,11,4,4,7,9,5,7,11,9,1]),g(-1,[10,4,9,6,6,4,10,5]),g(-1,[4,10,6,6,4,9,10,3,0,8,3,7]),g(-1,[10,0,1,
6,10,6,0,1,6,4,0,3]),g(-1,[8,3,1,3,8,1,6,0,8,6,4,6,6,1,10,6]),g(-1,[1,4,9,6,1,2,4,1,2,6,4,3]),g(-1,[3,0,8,7,1,2,9,5,2,4,9,2,2,6,4,3]),g(-1,[0,2,4,5,4,2,6,6]),g(-1,[8,3,2,3,8,2,4,4,4,2,6,6]),g(-1,[10,4,9,6,10,6,4,3,11,2,3,7]),g(-1,[0,8,2,5,2,8,11,6,4,9,10,3,4,10,6,6]),g(-1,[3,11,2,7,0,1,6,1,0,6,4,6,6,1,10,6]),g(-1,[6,4,1,1,6,1,10,6,4,8,1,1,2,1,11,5,8,11,1,1]),g(-1,[9,6,4,6,9,3,6,0,9,1,3,3,11,6,3,5]),g(-1,[8,11,1,1,8,1,0,6,11,6,1,1,9,1,4,5,6,4,1,1]),g(-1,[3,11,6,3,3,6,0,4,0,6,4,6]),g(-1,[6,4,8,3,11,
6,8,5]),g(-1,[7,10,6,6,7,8,10,1,8,9,10,3]),g(-1,[0,7,3,6,0,10,7,0,0,9,10,3,6,7,10,5]),g(-1,[10,6,7,3,1,10,7,1,1,7,8,2,1,8,0,6]),g(-1,[10,6,7,3,10,7,1,4,1,7,3,6]),g(-1,[1,2,6,3,1,6,8,0,1,8,9,6,8,6,7,6]),g(-1,[2,6,9,1,2,9,1,6,6,7,9,1,0,9,3,5,7,3,9,1]),g(-1,[7,8,0,3,7,0,6,4,6,0,2,6]),g(-1,[7,3,2,3,6,7,2,5]),g(-1,[2,3,11,7,10,6,8,1,10,8,9,6,8,6,7,6]),g(-1,[2,0,7,1,2,7,11,6,0,9,7,1,6,7,10,5,9,10,7,1]),g(-1,[1,8,0,6,1,7,8,2,1,10,7,1,6,7,10,5,2,3,11,7]),g(-1,[11,2,1,3,11,1,7,4,10,6,1,5,6,7,1,1]),g(-1,[8,
9,6,1,8,6,7,6,9,1,6,1,11,6,3,5,1,3,6,1]),g(-1,[0,9,1,7,11,6,7,7]),g(-1,[7,8,0,3,7,0,6,4,3,11,0,5,11,6,0,1]),g(-1,[7,11,6,7]),g(-1,[7,6,11,7]),g(-1,[3,0,8,7,11,7,6,7]),g(-1,[0,1,9,7,11,7,6,7]),g(-1,[8,1,9,6,8,3,1,3,11,7,6,7]),g(-1,[10,1,2,7,6,11,7,7]),g(-1,[1,2,10,7,3,0,8,7,6,11,7,7]),g(-1,[2,9,0,6,2,10,9,3,6,11,7,7]),g(-1,[6,11,7,7,2,10,3,5,10,8,3,2,10,9,8,3]),g(-1,[7,2,3,6,6,2,7,5]),g(-1,[7,0,8,6,7,6,0,1,6,2,0,3]),g(-1,[2,7,6,6,2,3,7,3,0,1,9,7]),g(-1,[1,6,2,6,1,8,6,0,1,9,8,3,8,7,6,3]),g(-1,[10,7,
6,6,10,1,7,1,1,3,7,3]),g(-1,[10,7,6,6,1,7,10,4,1,8,7,2,1,0,8,3]),g(-1,[0,3,7,3,0,7,10,0,0,10,9,6,6,10,7,5]),g(-1,[7,6,10,3,7,10,8,4,8,10,9,6]),g(-1,[6,8,4,6,11,8,6,5]),g(-1,[3,6,11,6,3,0,6,1,0,4,6,3]),g(-1,[8,6,11,6,8,4,6,3,9,0,1,7]),g(-1,[9,4,6,3,9,6,3,0,9,3,1,6,11,3,6,5]),g(-1,[6,8,4,6,6,11,8,3,2,10,1,7]),g(-1,[1,2,10,7,3,0,11,5,0,6,11,2,0,4,6,3]),g(-1,[4,11,8,6,4,6,11,3,0,2,9,5,2,10,9,3]),g(-1,[10,9,3,1,10,3,2,6,9,4,3,1,11,3,6,5,4,6,3,1]),g(-1,[8,2,3,6,8,4,2,1,4,6,2,3]),g(-1,[0,4,2,5,4,6,2,3]),
g(-1,[1,9,0,7,2,3,4,1,2,4,6,6,4,3,8,6]),g(-1,[1,9,4,3,1,4,2,4,2,4,6,6]),g(-1,[8,1,3,6,8,6,1,0,8,4,6,3,6,10,1,3]),g(-1,[10,1,0,3,10,0,6,4,6,0,4,6]),g(-1,[4,6,3,1,4,3,8,6,6,10,3,1,0,3,9,5,10,9,3,1]),g(-1,[10,9,4,3,6,10,4,5]),g(-1,[4,9,5,7,7,6,11,7]),g(-1,[0,8,3,7,4,9,5,7,11,7,6,7]),g(-1,[5,0,1,6,5,4,0,3,7,6,11,7]),g(-1,[11,7,6,7,8,3,4,5,3,5,4,2,3,1,5,3]),g(-1,[9,5,4,7,10,1,2,7,7,6,11,7]),g(-1,[6,11,7,7,1,2,10,7,0,8,3,7,4,9,5,7]),g(-1,[7,6,11,7,5,4,10,5,4,2,10,2,4,0,2,3]),g(-1,[3,4,8,6,3,5,4,2,3,2,5,
1,10,5,2,5,11,7,6,7]),g(-1,[7,2,3,6,7,6,2,3,5,4,9,7]),g(-1,[9,5,4,7,0,8,6,1,0,6,2,6,6,8,7,6]),g(-1,[3,6,2,6,3,7,6,3,1,5,0,5,5,4,0,3]),g(-1,[6,2,8,1,6,8,7,6,2,1,8,1,4,8,5,5,1,5,8,1]),g(-1,[9,5,4,7,10,1,6,5,1,7,6,2,1,3,7,3]),g(-1,[1,6,10,6,1,7,6,2,1,0,7,1,8,7,0,5,9,5,4,7]),g(-1,[4,0,10,1,4,10,5,6,0,3,10,1,6,10,7,5,3,7,10,1]),g(-1,[7,6,10,3,7,10,8,4,5,4,10,5,4,8,10,1]),g(-1,[6,9,5,6,6,11,9,1,11,8,9,3]),g(-1,[3,6,11,6,0,6,3,4,0,5,6,2,0,9,5,3]),g(-1,[0,11,8,6,0,5,11,0,0,1,5,3,5,6,11,3]),g(-1,[6,11,3,3,
6,3,5,4,5,3,1,6]),g(-1,[1,2,10,7,9,5,11,1,9,11,8,6,11,5,6,6]),g(-1,[0,11,3,6,0,6,11,2,0,9,6,1,5,6,9,5,1,2,10,7]),g(-1,[11,8,5,1,11,5,6,6,8,0,5,1,10,5,2,5,0,2,5,1]),g(-1,[6,11,3,3,6,3,5,4,2,10,3,5,10,5,3,1]),g(-1,[5,8,9,6,5,2,8,0,5,6,2,3,3,8,2,5]),g(-1,[9,5,6,3,9,6,0,4,0,6,2,6]),g(-1,[1,5,8,1,1,8,0,6,5,6,8,1,3,8,2,5,6,2,8,1]),g(-1,[1,5,6,3,2,1,6,5]),g(-1,[1,3,6,1,1,6,10,6,3,8,6,1,5,6,9,5,8,9,6,1]),g(-1,[10,1,0,3,10,0,6,4,9,5,0,5,5,6,0,1]),g(-1,[0,3,8,7,5,6,10,7]),g(-1,[10,5,6,7]),g(-1,[11,5,10,6,7,
5,11,5]),g(-1,[11,5,10,6,11,7,5,3,8,3,0,7]),g(-1,[5,11,7,6,5,10,11,3,1,9,0,7]),g(-1,[10,7,5,6,10,11,7,3,9,8,1,5,8,3,1,3]),g(-1,[11,1,2,6,11,7,1,1,7,5,1,3]),g(-1,[0,8,3,7,1,2,7,1,1,7,5,6,7,2,11,6]),g(-1,[9,7,5,6,9,2,7,0,9,0,2,3,2,11,7,3]),g(-1,[7,5,2,1,7,2,11,6,5,9,2,1,3,2,8,5,9,8,2,1]),g(-1,[2,5,10,6,2,3,5,1,3,7,5,3]),g(-1,[8,2,0,6,8,5,2,0,8,7,5,3,10,2,5,5]),g(-1,[9,0,1,7,5,10,3,1,5,3,7,6,3,10,2,6]),g(-1,[9,8,2,1,9,2,1,6,8,7,2,1,10,2,5,5,7,5,2,1]),g(-1,[1,3,5,5,3,7,5,3]),g(-1,[0,8,7,3,0,7,1,4,1,7,
5,6]),g(-1,[9,0,3,3,9,3,5,4,5,3,7,6]),g(-1,[9,8,7,3,5,9,7,5]),g(-1,[5,8,4,6,5,10,8,1,10,11,8,3]),g(-1,[5,0,4,6,5,11,0,0,5,10,11,3,11,3,0,3]),g(-1,[0,1,9,7,8,4,10,1,8,10,11,6,10,4,5,6]),g(-1,[10,11,4,1,10,4,5,6,11,3,4,1,9,4,1,5,3,1,4,1]),g(-1,[2,5,1,6,2,8,5,0,2,11,8,3,4,5,8,5]),g(-1,[0,4,11,1,0,11,3,6,4,5,11,1,2,11,1,5,5,1,11,1]),g(-1,[0,2,5,1,0,5,9,6,2,11,5,1,4,5,8,5,11,8,5,1]),g(-1,[9,4,5,7,2,11,3,7]),g(-1,[2,5,10,6,3,5,2,4,3,4,5,2,3,8,4,3]),g(-1,[5,10,2,3,5,2,4,4,4,2,0,6]),g(-1,[3,10,2,6,3,5,10,
2,3,8,5,1,4,5,8,5,0,1,9,7]),g(-1,[5,10,2,3,5,2,4,4,1,9,2,5,9,4,2,1]),g(-1,[8,4,5,3,8,5,3,4,3,5,1,6]),g(-1,[0,4,5,3,1,0,5,5]),g(-1,[8,4,5,3,8,5,3,4,9,0,5,5,0,3,5,1]),g(-1,[9,4,5,7]),g(-1,[4,11,7,6,4,9,11,1,9,10,11,3]),g(-1,[0,8,3,7,4,9,7,5,9,11,7,2,9,10,11,3]),g(-1,[1,10,11,3,1,11,4,0,1,4,0,6,7,4,11,5]),g(-1,[3,1,4,1,3,4,8,6,1,10,4,1,7,4,11,5,10,11,4,1]),g(-1,[4,11,7,6,9,11,4,4,9,2,11,2,9,1,2,3]),g(-1,[9,7,4,6,9,11,7,2,9,1,11,1,2,11,1,5,0,8,3,7]),g(-1,[11,7,4,3,11,4,2,4,2,4,0,6]),g(-1,[11,7,4,3,11,
4,2,4,8,3,4,5,3,2,4,1]),g(-1,[2,9,10,6,2,7,9,0,2,3,7,3,7,4,9,3]),g(-1,[9,10,7,1,9,7,4,6,10,2,7,1,8,7,0,5,2,0,7,1]),g(-1,[3,7,10,1,3,10,2,6,7,4,10,1,1,10,0,5,4,0,10,1]),g(-1,[1,10,2,7,8,7,4,7]),g(-1,[4,9,1,3,4,1,7,4,7,1,3,6]),g(-1,[4,9,1,3,4,1,7,4,0,8,1,5,8,7,1,1]),g(-1,[4,0,3,3,7,4,3,5]),g(-1,[4,8,7,7]),g(-1,[9,10,8,5,10,11,8,3]),g(-1,[3,0,9,3,3,9,11,4,11,9,10,6]),g(-1,[0,1,10,3,0,10,8,4,8,10,11,6]),g(-1,[3,1,10,3,11,3,10,5]),g(-1,[1,2,11,3,1,11,9,4,9,11,8,6]),g(-1,[3,0,9,3,3,9,11,4,1,2,9,5,2,11,
9,1]),g(-1,[0,2,11,3,8,0,11,5]),g(-1,[3,2,11,7]),g(-1,[2,3,8,3,2,8,10,4,10,8,9,6]),g(-1,[9,10,2,3,0,9,2,5]),g(-1,[2,3,8,3,2,8,10,4,0,1,8,5,1,10,8,1]),g(-1,[1,10,2,7]),g(-1,[1,3,8,3,9,1,8,5]),g(-1,[0,9,1,7]),g(-1,[0,3,8,7]),null]))});O("J.jvxl.api");Ha(J.jvxl.api,"VertexDataServer");O("J.jvxl.api");F(["J.jvxl.api.VertexDataServer"],"J.jvxl.api.MeshDataServer",null,function(){Ha(J.jvxl.api,"MeshDataServer",J.jvxl.api.VertexDataServer)});O("J.shapesurface");F(["J.jvxl.api.MeshDataServer","J.shape.MeshCollection",
"JU.P3i","$.P4"],"J.shapesurface.Isosurface","java.io.BufferedReader java.lang.Boolean $.Float java.util.Hashtable JU.A4 $.AU $.BS $.CU $.Lst $.M3 $.M4 $.P3 $.PT $.Quat $.Rdr $.SB $.V3 J.jvxl.data.JvxlCoder $.JvxlData $.MeshData J.jvxl.readers.SurfaceGenerator J.shape.Mesh J.shapesurface.IsosurfaceMesh JU.C $.Escape $.Logger $.TempArray JV.JC $.Viewer".split(" "),function(){c$=H(function(){this.actualID=this.thisMesh=this.isomeshes=null;this.explicitContours=this.iHaveBitSets=!1;this.moNumber=this.atomIndex=
0;this.moLinearCombination=null;this.meshColix=this.defaultColix=this.colorType=0;this.center=null;this.scale3d=0;this.isColorExplicit=this.isPhaseColored=!1;this.scriptAppendix="";this.sg=null;this.withinDistance2=0;this.isWithinNot=!1;this.cutoffRange=this.withinPoints=null;this.allowMesh=!0;this.script=null;this.iHaveModelIndex=!1;this.nLCAO=0;this.lcaoDir=null;this.associateNormals=!1;this.keyXy=this.ptXY=this.newFileName=this.oldFileName=null;P(this,arguments)},J.shapesurface,"Isosurface",J.shape.MeshCollection,
J.jvxl.api.MeshDataServer);ha(c$,function(){this.isomeshes=Array(4);this.lcaoDir=new JU.P4;this.ptXY=new JU.P3i});m(c$,"allocMesh",function(a,b){var c=this.meshCount++;this.meshes=this.isomeshes=JU.AU.ensureLength(this.isomeshes,2*this.meshCount);this.currentMesh=this.thisMesh=this.isomeshes[c]=null==b?new J.shapesurface.IsosurfaceMesh(this.vwr,a,this.colix,c):b;this.currentMesh.index=c;null!=this.sg&&this.sg.setJvxlData(this.jvxlData=this.thisMesh.jvxlData)},"~S,J.shape.Mesh");d(c$,"initShape",function(){Ia(this,
J.shapesurface.Isosurface,"initShape",[]);this.myType="isosurface";this.newSg()});d(c$,"newSg",function(){this.sg=new J.jvxl.readers.SurfaceGenerator(this.vwr,this,null,this.jvxlData=new J.jvxl.data.JvxlData);this.sg.params.showTiming=this.vwr.getBoolean(603979934);this.sg.version="Jmol "+JV.Viewer.getJmolVersion()});d(c$,"clearSg",function(){this.sg=null});m(c$,"setProperty",function(a,b,c){this.setPropI(a,b,c)},"~S,~O,JU.BS");d(c$,"setPropI",function(a,b,c){if("cache"===a){if(null!=this.currentMesh){var e=
this.currentMesh.thisID;c=this.currentMesh.modelIndex;this.vwr.cachePut("cache://isosurface_"+e,this.getPropI("jvxlDataXml",-1).getBytes());this.deleteMeshI(this.currentMesh.index);this.setPropI("init",null,null);this.setPropI("thisID",e,null);this.setPropI("modelIndex",Integer.$valueOf(c),null);this.setPropI("fileName","cache://isosurface_"+e,null);this.setPropI("readFile",null,null);this.setPropI("finalize","isosurface ID "+JU.PT.esc(e)+(0<=c?" modelIndex "+c:"")+" /*file*/"+JU.PT.esc("cache://isosurface_"+
e),null);this.setPropI("clear",null,null)}}else if("delete"===a)this.setPropertySuper(a,b,c),this.explicitID||(this.nLCAO=this.nUnnamed=0),this.currentMesh=this.thisMesh=null;else if("remapInherited"===a)for(e=this.meshCount;0<=--e;)null!=this.isomeshes[e]&&"#inherit;".equals(this.isomeshes[e].colorCommand)&&this.isomeshes[e].remapColors(this.vwr,null,NaN);else if("remapColor"===a)null!=this.thisMesh&&this.thisMesh.remapColors(this.vwr,b,this.translucentLevel);else if("thisID"===a)null!=this.actualID&&
(b=this.actualID),this.setPropertySuper("thisID",b,null);else if("params"===a){if(null!=this.thisMesh){this.ensureMeshSource();this.thisMesh.checkAllocColixes();a=b[0];var k=null;if(null!=a){for(e=0;e<a.length;e++)a[e]=a[e];k=u(c.length(),0);b=0;for(e=c.nextSetBit(0);0<=e;e=c.nextSetBit(e+1),b++)k[e]=b}this.thisMesh.setVertexColixesForAtoms(this.vwr,a,k,c);this.thisMesh.setVertexColorMap()}}else if("atomcolor"===a)null!=this.thisMesh&&(this.ensureMeshSource(),this.thisMesh.colorVertices(JU.C.getColixO(b),
c,!0));else if("pointSize"===a)null!=this.thisMesh&&(this.thisMesh.volumeRenderPointSize=b.floatValue());else if("vertexcolor"===a)null!=this.thisMesh&&this.thisMesh.colorVertices(JU.C.getColixO(b),c,!1);else if("colorPhase"===a){e=b;c=JU.C.getColix(e[0].intValue());b=JU.C.getColix(e[1].intValue());e=null!=this.thisMesh?this.thisMesh.thisID:JU.PT.isWild(this.previousMeshID)?this.previousMeshID:null;k=this.getMeshList(e,!1);for(e=k.size();0<=--e;)this.setColorPhase(k.get(e),c,b)}else if("color"===
a){var h=JU.C.getHexCode(JU.C.getColixO(b));if(null!=this.thisMesh)this.setIsoMeshColor(this.thisMesh,h);else{k=this.getMeshList(JU.PT.isWild(this.previousMeshID)?this.previousMeshID:null,!1);for(e=k.size();0<=--e;)this.setIsoMeshColor(k.get(e),h)}this.setPropertySuper(a,b,c)}else if("nocontour"===a)null!=this.thisMesh&&this.thisMesh.deleteContours();else if("fixed"===a)this.isFixed=b.booleanValue(),this.setMeshI();else if("newObject"===a)null!=this.thisMesh&&this.thisMesh.clearType(this.thisMesh.meshType,
!1);else if("moveIsosurface"===a)null!=this.thisMesh&&!this.thisMesh.isModelConnected&&(this.thisMesh.updateCoordinates(b,null),this.thisMesh.altVertices=null);else if("refreshTrajectories"===a){c=b[0].intValue();for(e=this.meshCount;0<=--e;)this.meshes[e].modelIndex==c&&(null!=this.meshes[e].connectedAtoms||this.meshes[e].isModelConnected)&&this.meshes[e].updateCoordinates(b[2],b[1])}else if("modelIndex"===a)this.iHaveModelIndex||(this.modelIndex=b.intValue(),this.isFixed=0>this.modelIndex,this.sg.params.modelIndex=
Math.abs(this.modelIndex));else if("lcaoCartoon"===a||"lonePair"===a||"radical"===a)e=b,this.explicitID||this.setPropertySuper("thisID",null,null),this.sg.setProp("lcaoCartoonCenter",e[2],null)||this.drawLcaoCartoon(e[0],e[1],e[3],"lonePair"===a?2:"radical"===a?1:0,null==this.thisMesh?!1:this.thisMesh.reverseColor);else if(!("select"===a&&this.iHaveBitSets||"ignore"===a&&this.iHaveBitSets))if("reversecolor"===a)null!=this.thisMesh&&(this.thisMesh.reverseColor=b===Boolean.TRUE);else if("meshcolor"===
a)e=b.intValue(),this.meshColix=JU.C.getColix(e),null!=this.thisMesh&&(this.thisMesh.meshColix=this.meshColix);else if("offset"===a)e=JU.P3.newP(b),e.equals(JV.JC.center)&&(e=null),null!=this.thisMesh&&(this.thisMesh.rotateTranslate(null,e,!0),this.thisMesh.altVertices=null);else if("rotate"===a)null!=this.thisMesh&&(this.thisMesh.rotateTranslate(JU.Quat.newP4(b),null,!0),this.thisMesh.altVertices=null);else if("bsDisplay"===a)this.bsDisplay=b;else if("displayWithin"===a)e=b,this.displayWithinDistance2=
e[0].floatValue(),this.isDisplayWithinNot=0>this.displayWithinDistance2,this.displayWithinDistance2*=this.displayWithinDistance2,this.displayWithinPoints=e[3],0==this.displayWithinPoints.size()&&(this.displayWithinPoints=this.ms.getAtomPointVector(e[2]));else if("finalize"===a)null!=this.thisMesh&&(e=b,null!=e&&!e.startsWith("; isosurface map")&&(this.thisMesh.setDiscreteColixes(this.sg.params.contoursDiscrete,this.sg.params.contourColixes),this.setJvxlInfo()),this.setScriptInfo(e)),this.clearSg();
else if("connections"===a)null!=this.currentMesh&&(this.connections=b,0<=this.connections[0]&&this.connections[0]<this.ms.ac?this.currentMesh.connectedAtoms=this.connections:this.connections=this.currentMesh.connectedAtoms=null);else if("fixLattice"===a)null!=this.thisMesh&&this.thisMesh.fixLattice();else{if("slab"===a){if(T(b,Integer)){null!=this.thisMesh&&(this.thisMesh.jvxlData.slabValue=b.intValue());return}if(null!=this.thisMesh){switch(b[0].intValue()){case 1073742018:e=b[1];c=this.getMesh(e[1]);
if(null==c)return;e[1]=c}this.slabPolygons(b);return}}if("cap"===a&&null!=this.thisMesh&&0!=this.thisMesh.pc)this.thisMesh.getMeshSlicer().slabPolygons(b,!0),this.thisMesh.initialize(this.thisMesh.lighting,null,null);else{if("map"===a&&(null!=this.sg&&(this.sg.params.isMapped=!0),this.setProperty("squareData",Boolean.FALSE,null),null==this.thisMesh||0==this.thisMesh.vc))return;if("probes"===a)null!=this.sg&&(this.sg.params.probes=b,this.sg.params.probeValues=w(this.sg.params.probes.length,0));else if("deleteVdw"===
a){for(e=this.meshCount;0<=--e;)null!=this.isomeshes[e].bsVdw&&(null==c||c.intersects(this.isomeshes[e].bsVdw))&&this.deleteMeshI(e);this.currentMesh=this.thisMesh=null}else{if("mapColor"===a||"readFile"===a){if(null==b){if(null==this.sg.params.filesData)b=this.getFileReader(this.sg.params.fileName);else{b=this.sg.params.filesData;k=this.sg.params.filesData[0];h=Array(k.length);for(e=h.length;0<=--e&&null!=b;)if(null==(h[e]=this.getFileReader(k[e])))b=null;null!=b&&(this.sg.params.filesData[0]=h)}if(null==
b)return}}else if("atomIndex"===a)this.atomIndex=b.intValue(),null!=this.thisMesh&&(this.thisMesh.atomIndex=this.atomIndex);else if("center"===a)this.center.setT(b);else if("colorRGB"===a)e=b.intValue(),1296041985==e?this.colorType=e:(this.colorType=0,this.defaultColix=JU.C.getColix(e));else if("contour"===a)this.explicitContours=!0;else if("functionXY"===a)2==this.sg.params.state&&this.setScriptInfo(null);else if("init"===a)this.newSg();else if("getSurfaceSets"===a){if(null!=this.thisMesh){if(T(b,
JU.BS))h=b,h.isEmpty()&&(h=null);else{h=new JU.BS;k=b;for(e=k.length;0<=--e;)0<k[e]&&h.set(k[e]-1)}this.thisMesh.jvxlData.thisSet=h;this.thisMesh.calculatedVolume=null;this.thisMesh.calculatedArea=null}}else if("localName"===a)b=this.vwr.getOutputChannel(b,null),a="outputChannel";else if("molecularOrbital"===a){if(this.isFixed=!1,this.setMeshI(),T(b,Integer)?(this.moNumber=b.intValue(),this.moLinearCombination=null):(this.moLinearCombination=b,this.moNumber=0),this.isColorExplicit||(this.isPhaseColored=
!0),null==this.sg||!this.sg.params.isMapped)e=this.ms.am[this.currentMesh.modelIndex].mat4,null!=e&&(e=JU.M4.newM4(e),e.invert(),this.setPropI("modelInvRotation",e,null))}else"phase"===a?this.isPhaseColored=!0:"plane"!==a&&"pocket"!==a&&("scale3d"===a?(this.scale3d=b.floatValue(),null!=this.thisMesh&&(this.thisMesh.scale3d=this.thisMesh.jvxlData.scale3d=this.scale3d,this.thisMesh.altVertices=null)):"title"===a?(T(b,String)&&"-".equals(b)&&(b=null),this.setPropertySuper(a,b,c),b=this.title):"withinPoints"===
a?(e=b,this.withinDistance2=e[0].floatValue(),this.isWithinNot=0>this.withinDistance2,this.withinDistance2*=this.withinDistance2,this.withinPoints=e[3],0==this.withinPoints.size()&&(this.withinPoints=this.ms.getAtomPointVector(e[2]))):("nci"===a||"orbital"===a)&&null!=this.sg?this.sg.params.testFlags=this.vwr.getBoolean(603979962)?2:0:"cutoffRange"===a&&(this.cutoffRange=b));if(null!=this.sg&&this.sg.setProp(a,b,c)){if(this.sg.isValid){"molecularOrbital"===a&&(this.currentMesh.isModelConnected=!0,
this.currentMesh.mat4=this.ms.am[this.currentMesh.modelIndex].mat4);return}a="delete"}if("init"===a)this.explicitID=!1,this.scriptAppendix="",e=T(b,String)?b:null,b=null==e?-1:e.indexOf("# ID="),this.actualID=0<=b?JU.PT.getQuotedStringAt(e,b):null,this.setPropertySuper("thisID","+PREVIOUS_MESH+",null),null!=e&&!(this.iHaveBitSets=this.getScriptBitSets(e,null))&&this.sg.setProp("select",c,null),this.initializeIsosurface(),this.sg.params.modelIndex=this.isFixed?-1:this.modelIndex;else if("clear"===
a)this.discardTempData(!0);else if("colorDensity"===a)null!=b&&null!=this.currentMesh&&(this.currentMesh.volumeRenderPointSize=b.floatValue());else if("deleteModelAtoms"===a){a=b[2][0];k=b[2][1];b=b[2][2];for(e=this.meshCount;0<=--e;)c=this.meshes[e],null!=c&&(null!=c.connectedAtoms&&(h=c.connectedAtoms[0],h>=k+b?c.connectedAtoms[0]=h-b:h>=k&&(c.connectedAtoms=null)),c.connectedAtoms=null,c.modelIndex==a?(this.meshCount--,c===this.currentMesh&&(this.currentMesh=this.thisMesh=null),this.meshes=this.isomeshes=
JU.AU.deleteElements(this.meshes,e,1)):c.modelIndex>a&&(c.modelIndex--,c.atomIndex>=k&&(c.atomIndex-=b)))}else this.setPropertySuper(a,b,c)}}}},"~S,~O,JU.BS");d(c$,"getFileReader",function(a){var b=this.vwr.fm.getBufferedReaderOrErrorMessageFromName(a,null,!0,!0);if(T(b,String))return JU.Logger.error("Isosurface: could not open file "+a+" -- "+b),null;if(!T(b,java.io.BufferedReader))try{b=JU.Rdr.getBufferedReader(b,"ISO-8859-1")}catch(c){if(!Y(c,java.io.IOException))throw c;}return b},"~S");d(c$,
"setIsoMeshColor",function(a,b){a.jvxlData.baseColor=b;a.isColorSolid=!0;a.pcs=null;a.colorsExplicit=!1;a.colorEncoder=null;a.vertexColorMap=null},"J.shapesurface.IsosurfaceMesh,~S");d(c$,"setColorPhase",function(a,b,c){a.colorPhased=!0;a.colix=a.jvxlData.minColorIndex=b;a.jvxlData.maxColorIndex=c;a.jvxlData.isBicolorMap=!0;a.jvxlData.colorDensity=!1;a.isColorSolid=!1;a.remapColors(this.vwr,null,this.translucentLevel)},"J.shapesurface.IsosurfaceMesh,~N,~N");d(c$,"ensureMeshSource",function(){var a=
null!=this.thisMesh.vertexSource;if(a)for(var b=this.thisMesh.vc;0<=--b;)if(0>this.thisMesh.vertexSource[b]){a=!1;break}if(!a){var a=this.thisMesh.vertexSource,c=this.thisMesh.vcs,b=this.thisMesh.isColorSolid?this.thisMesh.colix:0;this.setProperty("init",null,null);this.setProperty("map",Boolean.FALSE,null);this.setProperty("property",w(this.ms.ac,0),null);0!=b&&(this.thisMesh.colorCommand="color isosurface "+JU.C.getHexCode(b),this.setProperty("color",Integer.$valueOf(JU.C.getArgb(b)),null));if(null!=
a){for(b=this.thisMesh.vc;0<=--b;)0>a[b]&&(a[b]=this.thisMesh.vertexSource[b]);this.thisMesh.vertexSource=a;this.thisMesh.vcs=c}}});d(c$,"slabPolygons",function(a){this.thisMesh.calculatedVolume=null;this.thisMesh.calculatedArea=null;this.thisMesh.getMeshSlicer().slabPolygons(a,!1);this.thisMesh.reinitializeLightingAndColor(this.vwr)},"~A");d(c$,"setPropertySuper",function(a,b,c){"thisID"===a&&null!=this.currentMesh&&null!=this.currentMesh.thisID&&this.currentMesh.thisID.equals(b)?this.checkExplicit(b):
(this.currentMesh=this.thisMesh,this.setPropMC(a,b,c),this.thisMesh=this.currentMesh,this.jvxlData=null==this.thisMesh?null:this.thisMesh.jvxlData,null!=this.sg&&this.sg.setJvxlData(this.jvxlData))},"~S,~O,JU.BS");m(c$,"getPropertyData",function(a,b){var c;"keys"===a&&(c=T(b[1],JU.Lst)?b[1]:new JU.Lst,b[1]=c,c.addLast("info"),c.addLast("data"),c.addLast("atoms"));if("colorEncoder"===a)return c=this.getMesh(b[0]),null!=c&&null!=(b[1]=c.colorEncoder);if("intersectPlane"===a){c=this.getMesh(b[0]);if(null==
c||4>b.length)return!1;b[3]=Integer.$valueOf(c.modelIndex);c.getMeshSlicer().getIntersection(0,b[1],null,b[2],null,null,null,!1,!1,134217750,!1);return!0}if("getBoundingBox"===a){c=b[0];c=this.getMesh(c);if(null==c||null==c.vs)return!1;b[2]=c.jvxlData.boundingBox;if(null!=c.mat4){var e=Array(2);e[0]=JU.P3.newP(c.jvxlData.boundingBox[0]);e[1]=JU.P3.newP(c.jvxlData.boundingBox[1]);var k=new JU.V3;c.mat4.getTranslation(k);e[0].add(k);e[1].add(k);b[2]=e}return!0}if("unitCell"===a)return c=this.getMesh(b[0]),
null!=c&&null!=(b[1]=c.getUnitCell());if("getCenter"===a&&-2147483648==b[1].intValue()){c=b[0];c=this.getMesh(c);if(null==c||null==c.vs)return!1;e=JU.P3.newP(c.jvxlData.boundingBox[0]);e.add(c.jvxlData.boundingBox[1]);e.scale(0.5);null!=c.mat4&&(k=new JU.V3,c.mat4.getTranslation(k),e.add(k));b[2]=e;return!0}return this.getPropDataMC(a,b)},"~S,~A");m(c$,"getProperty",function(a,b){return this.getPropI(a,b)},"~S,~N");d(c$,"getPropI",function(a,b){var c=this.thisMesh;if(0<=b&&(b>=this.meshCount||null==
(c=this.isomeshes[b])))return null;var e=this.getPropMC(a,b);if(null!=e)return e;if("message"===a){c="";if(!this.jvxlData.isValid)return"invalid! (no atoms selected?)";Float.isNaN(this.jvxlData.integration)||(c+="integration "+this.jvxlData.integration);if(24==this.shapeID||27==this.shapeID||28==this.shapeID)c=null==this.jvxlData.cutoffRange?c+(" with cutoff="+this.jvxlData.cutoff):c+(" with cutoffRange="+JU.Escape.eAF(this.jvxlData.cutoffRange));if(27==this.shapeID||28==this.shapeID)return c;3.4028235E38!=
this.jvxlData.dataMin&&(c+=" min="+this.jvxlData.dataMin+" max="+this.jvxlData.dataMax);c+="; "+JV.JC.shapeClassBases[this.shapeID].toLowerCase()+" count: "+this.getPropMC("count",b);return c+this.getPropI("dataRangeStr",b)+this.jvxlData.msg}if("dataRange"===a)return this.getDataRange(c);if("dataRangeStr"===a)return c=this.getDataRange(c),null!=c&&3.4028235E38!=c[0]&&c[0]!=c[1]?"\nisosurface full data range "+c[0]+" to "+c[1]+" with color scheme spanning "+c[2]+" to "+c[3]:"";if("moNumber"===a)return Integer.$valueOf(this.moNumber);
if("moLinearCombination"===a)return this.moLinearCombination;if("nSets"===a)return e=null==c?-2147483648:c.nSets,0==e&&(this.calculateVolumeOrArea(c,!0),e=c.nSets),Integer.$valueOf(-2147483648==e?0:Math.abs(c.nSets));if("area"===a)return null==c?Float.$valueOf(NaN):this.calculateVolumeOrArea(c,!0);if("volume"===a)return null==c?Float.$valueOf(NaN):this.calculateVolumeOrArea(c,!1);if(null==c)return null;if("output"===a)return null==c.jvxlData.sbOut&&null==c.jvxlData.jvxlFileTitle?null:c.jvxlData.jvxlFileTitle+
"\n"+(null==c.jvxlData.sbOut?"":c.jvxlData.sbOut.toString());if("cutoff"===a)return Float.$valueOf(this.jvxlData.cutoff);if("cutoffRange"===a)return this.jvxlData.cutoffRange;if("minMaxInfo"===a)return w(-1,[this.jvxlData.dataMin,this.jvxlData.dataMax]);if("plane"===a)return this.jvxlData.jvxlPlane;if("contours"===a)return c.getContours();if("pmesh"===a||"pmeshbin"===a)return c.getPmeshData("pmeshbin"===a);if("jvxlDataXml"===a||"jvxlMeshXml"===a){var k=null;this.jvxlData.slabInfo=null;"jvxlMeshXml"===
a||this.jvxlData.vertexDataOnly||null!=c.bsSlabDisplay&&null==c.bsSlabGhost?(k=new J.jvxl.data.MeshData,this.fillMeshData(k,1,c),k.polygonColorData=J.shapesurface.Isosurface.getPolygonColorData(k.pc,k.pcs,k.colorsExplicit?k.pis:null,k.bsSlabDisplay)):null!=c.bsSlabGhost&&(this.jvxlData.slabInfo=c.slabOptions.toString());e=new JU.SB;this.getMeshCommand(e,c.index);c.setJvxlColorMap(!0);return J.jvxl.data.JvxlCoder.jvxlGetFile(this.jvxlData,k,this.title,"",!0,1,e.toString(),null)}if("jvxlFileInfo"===
a)return J.jvxl.data.JvxlCoder.jvxlGetInfo(this.jvxlData);if("command"===a){e=new JU.SB;c=this.getMeshList(0>b?this.previousMeshID:c.thisID,!1);for(k=c.size();0<=--k;)this.getMeshCommand(e,c.get(k).index);return e.toString()}return"atoms"===a?c.surfaceAtoms:"colorEncoder"===a?c.colorEncoder:"values"===a||"value"===a?c.probeValues:null},"~S,~N");d(c$,"getDataRange",function(a){return null==a?null:a.getDataRange()},"J.shapesurface.IsosurfaceMesh");d(c$,"calculateVolumeOrArea",function(a,b){if(b){if(null!=
a.calculatedArea)return a.calculatedArea}else if(null!=a.calculatedVolume)return a.calculatedVolume;var c=new J.jvxl.data.MeshData;this.fillMeshData(c,1,a);c.nSets=a.nSets;c.vertexSets=a.vertexSets;if(!b&&a.jvxlData.colorDensity)return c=a.jvxlData.voxelVolume,c*=null==a.bsSlabDisplay?a.vc:a.bsSlabDisplay.cardinality(),a.calculatedVolume=Float.$valueOf(c);var e=J.jvxl.data.MeshData.calculateVolumeOrArea(c,a.jvxlData.thisSet,b,!1);0>=a.nSets&&(a.nSets=-c.nSets);b?a.calculatedArea=e:a.calculatedVolume=
e;return e},"J.shapesurface.IsosurfaceMesh,~B");c$.getPolygonColorData=d(c$,"getPolygonColorData",function(a,b,c,e){var k=null!=c;if(null==b&&null==c)return null;for(var h=new JU.SB,f=0,d=0,j=0,g=0,l=!1,t=0;t<a||!0==(l=!0);t++)if(l||null==e||e.get(t))if(l||(k?(g=c[t][4])!=j:b[t]!=d)){0!=f&&h.append(" ").appendI(f).append(" ").appendI(k?j:0==d?0:JU.C.getArgb(d));if(l)break;k?j=g:d=b[t];f=1}else f++;h.append("\n");return h.toString()},"~N,~A,~A,JU.BS");m(c$,"getShapeState",function(){this.clean();var a=
new JU.SB;a.append("\n");for(var b=0;b<this.meshCount;b++)this.getMeshCommand(a,b);return a.toString()});d(c$,"getMeshCommand",function(a,b){var c=this.meshes[b];if(!(null==c||null==c.scriptCommand)){var e=c.scriptCommand;1<this.ms.mc&&J.shape.Shape.appendCmd(a,"frame "+this.vwr.getModelNumberDotted(c.modelIndex));e=JU.PT.rep(e,";; isosurface map"," map");e=JU.PT.rep(e,"; isosurface map"," map");e.endsWith(" map")&&(e=e.substring(0,e.length-4));var e=e.$replace("\t"," "),e=JU.PT.rep(e,";#","; #"),
k=e.indexOf("; #");0<=k&&(e=e.substring(0,k));null!=c.connectedAtoms&&(e+=" connect "+JU.Escape.eAI(c.connectedAtoms));e=JU.PT.trim(e,";");null!=c.linkedMesh&&(e+=" LINK");"lcaoCartoon"===this.myType&&0<=c.atomIndex&&(e+=" ATOMINDEX "+c.atomIndex);J.shape.Shape.appendCmd(a,e);k=this.myType+" ID "+JU.PT.esc(c.thisID);null!=c.jvxlData.thisSet&&!c.jvxlData.thisSet.isEmpty()&&J.shape.Shape.appendCmd(a,k+(1==c.jvxlData.thisSet.cardinality()?" set "+(c.jvxlData.thisSet.nextSetBit(0)+1):" subset "+c.jvxlData.thisSet));
null!=c.mat4&&!c.isModelConnected&&J.shape.Shape.appendCmd(a,k+" move "+JU.Escape.matrixToScript(c.mat4));0!=c.scale3d&&J.shape.Shape.appendCmd(a,k+" scale3d "+c.scale3d);-2147483648!=c.jvxlData.slabValue&&J.shape.Shape.appendCmd(a,k+" slab "+c.jvxlData.slabValue);null!=c.slabOptions&&J.shape.Shape.appendCmd(a,c.slabOptions.toString());if("#"!=e.charAt(0)&&(this.allowMesh&&J.shape.Shape.appendCmd(a,c.getState(this.myType)),!c.isColorSolid&&(0==c.colorType&&JU.C.isColixTranslucent(c.colix))&&J.shape.Shape.appendCmd(a,
"color "+this.myType+" "+J.shape.Shape.getTranslucentLabel(c.colix)),null!=c.colorCommand&&(0==c.colorType&&!c.colorCommand.equals("#inherit;"))&&J.shape.Shape.appendCmd(a,c.colorCommand),e=c.isColorSolid&&null!=c.pcs,c.isColorSolid&&0==c.colorType&&!c.colorsExplicit&&!e?J.shape.Shape.appendCmd(a,J.shape.Shape.getColorCommandUnk(this.myType,c.colix,this.translucentAllowed)):c.jvxlData.isBicolorMap&&c.colorPhased&&J.shape.Shape.appendCmd(a,"color isosurface phase "+J.shape.Shape.encodeColor(c.jvxlData.minColorIndex)+
" "+J.shape.Shape.encodeColor(c.jvxlData.maxColorIndex)),null!=c.vertexColorMap))for(var h,c=c.vertexColorMap.entrySet().iterator();c.hasNext()&&((h=c.next())||1);)e=h.getValue(),e.isEmpty()||J.shape.Shape.appendCmd(a,"color "+this.myType+" "+JU.Escape.eBS(e)+" "+h.getKey())}},"JU.SB,~N");d(c$,"getScriptBitSets",function(a,b){this.script=a;var c;this.iHaveModelIndex=!1;this.modelIndex=-1;if(null!=a&&0<=(c=a.indexOf("MODEL({"))){var e=a.indexOf("})",c);0<e&&(c=JU.BS.unescape(a.substring(c+3,e+1)),
this.modelIndex=null==c?-1:c.nextSetBit(0),this.iHaveModelIndex=0<=this.modelIndex)}if(null==a)return!1;this.getCapSlabInfo(a);c=a.indexOf("# ({");if(0>c)return!1;e=a.indexOf("})",c);if(0>e)return!1;c=JU.BS.unescape(a.substring(c+2,e+2));null==b?this.sg.setProp("select",c,null):b[0]=c;if(0>(c=a.indexOf("({",e)))return!0;e=a.indexOf("})",c);if(0>e)return!1;c=JU.BS.unescape(a.substring(c+1,e+1));null==b?this.sg.setProp("ignore",c,null):b[1]=c;if((c=a.indexOf("/({",e))==e+2){if(0>(e=a.indexOf("})",c)))return!1;
c=JU.BS.unescape(a.substring(c+3,e+1));null==b?this.ms.setTrajectoryBs(c):b[2]=c}return!0},"~S,~A");d(c$,"getCapSlabInfo",function(a){var b=a.indexOf("# SLAB=");0<=b&&this.sg.setProp("slab",this.getCapSlabObject(JU.PT.getQuotedStringAt(a,b),!1),null);b=a.indexOf("# CAP=");0<=b&&this.sg.setProp("slab",this.getCapSlabObject(JU.PT.getQuotedStringAt(a,b),!0),null)},"~S");d(c$,"getCapSlabObject",function(a,b){try{if(0==a.indexOf("array")){var c=JU.PT.split(a.substring(6,a.length-1),",");return JU.TempArray.getSlabObjectType(1812599299,
B(-1,[JU.Escape.uP(c[0]),JU.Escape.uP(c[1]),JU.Escape.uP(c[2]),JU.Escape.uP(c[3])]),b,null)}var e=JU.Escape.uP(a);if(T(e,JU.P4))return JU.TempArray.getSlabObjectType(134217750,e,b,null)}catch(k){if(!Y(k,Exception))throw k;}return null},"~S,~B");d(c$,"initializeIsosurface",function(){this.iHaveModelIndex||(this.modelIndex=this.vwr.am.cmi);this.atomIndex=-1;this.bsDisplay=null;this.center=JU.P3.new3(NaN,0,0);this.colix=5;this.cutoffRange=this.connections=null;this.colorType=this.defaultColix=this.meshColix=
0;this.displayWithinPoints=null;this.explicitContours=!1;this.isFixed=0>this.modelIndex;this.isPhaseColored=this.isColorExplicit=!1;this.linkedMesh=null;0>this.modelIndex&&(this.modelIndex=0);this.scale3d=0;this.title=null;this.translucentLevel=0;this.withinPoints=null;this.initState()});d(c$,"initState",function(){this.associateNormals=!0;this.sg.initState()});d(c$,"setMeshI",function(){this.thisMesh.visible=!0;this.thisMesh.modelIndex=0<=(this.thisMesh.atomIndex=this.atomIndex)?this.ms.at[this.atomIndex].mi:
this.isFixed?-1:0<=this.modelIndex?this.modelIndex:this.vwr.am.cmi;this.thisMesh.scriptCommand=this.script;this.thisMesh.ptCenter.setT(this.center);this.thisMesh.scale3d=null==this.thisMesh.jvxlData.jvxlPlane?0:this.scale3d});d(c$,"discardTempData",function(a){a&&(this.title=null,null!=this.thisMesh&&(this.thisMesh.surfaceSet=null))},"~B");d(c$,"getDefaultColix",function(){return 0!=this.defaultColix?this.defaultColix:!this.sg.jvxlData.wasCubic?this.colix:JU.C.getColix(0<=this.sg.params.cutoff?-11525984:
-6283184)});d(c$,"drawLcaoCartoon",function(a,b,c,e,k){var h=this.sg.setLcao(),f=0<=h.indexOf("anti-sp");f&&(h=h.substring(5));var d=c.x+c.y+c.z;this.defaultColix=JU.C.getColix(this.sg.params.colorPos);var j=JU.C.getColix(this.sg.params.colorNeg);k&&(k=j,j=this.defaultColix,this.defaultColix=k);k=new JU.V3;var g=0<h.length&&"-"==h.charAt(0);g&&(h=h.substring(1));g=g?-1:1;k.cross(a,b);if(0!=d){var l=new JU.A4;0!=c.x?l.setVA(b,d):0!=c.y?l.setVA(k,d):l.setVA(a,d);c=(new JU.M3).setAA(l);c.rotate(b);c.rotate(k);
c.rotate(a)}null==this.thisMesh&&0==this.nLCAO&&(this.nLCAO=this.meshCount);c=null==this.thisMesh?(0<e?"lp":"lcao")+ ++this.nLCAO+"_"+h:this.thisMesh.thisID;null==this.thisMesh&&this.allocMesh(c,null);h.equals("px")?(this.thisMesh.thisID+="a",d=this.thisMesh,this.createLcaoLobe(b,g,e),0<e||(this.setProperty("thisID",c+"b",null),this.createLcaoLobe(b,-g,0),this.thisMesh.colix=j,this.linkedMesh=this.thisMesh.linkedMesh=d)):h.equals("py")?(this.thisMesh.thisID+="a",d=this.thisMesh,this.createLcaoLobe(k,
g,e),0<e||(this.setProperty("thisID",c+"b",null),this.createLcaoLobe(k,-g,0),this.thisMesh.colix=j,this.linkedMesh=this.thisMesh.linkedMesh=d)):(d=this.thisMesh,h.equals("pz")?(d.thisID+="a",this.createLcaoLobe(a,g,e),0<e||(this.setProperty("thisID",c+"b",null),this.createLcaoLobe(a,-g,0),this.thisMesh.colix=j,this.linkedMesh=this.thisMesh.linkedMesh=d)):h.equals("pza")||0==h.indexOf("sp")||0==h.indexOf("d")||0==h.indexOf("lp")?(this.createLcaoLobe(a,g,e),f&&0==e&&(d.thisID+="a",this.setProperty("thisID",
c+"b",null),this.createLcaoLobe(a,-g/2,0),this.thisMesh.colix=j,this.linkedMesh=this.thisMesh.linkedMesh=d)):h.equals("pzb")?this.createLcaoLobe(a,-g,e):h.equals("pxa")?this.createLcaoLobe(b,g,e):h.equals("pxb")?this.createLcaoLobe(b,-g,e):h.equals("pya")?this.createLcaoLobe(k,g,e):h.equals("pyb")?this.createLcaoLobe(k,-g,e):h.equals("spacefill")||h.equals("cpk")?this.createLcaoLobe(null,2*this.ms.at[this.atomIndex].getRadius(),e):this.createLcaoLobe(null,1,e))},"JU.V3,JU.V3,JU.V3,~N,~B");d(c$,"createLcaoLobe",
function(a,b,c){this.initState();JU.Logger.debugging&&JU.Logger.debug("creating isosurface ID "+this.thisMesh.thisID);null==a?this.setProperty("sphere",Float.$valueOf(b/2),null):(this.lcaoDir.x=a.x*b,this.lcaoDir.y=a.y*b,this.lcaoDir.z=a.z*b,this.lcaoDir.w=0.7,this.setProperty(2==c?"lp":1==c?"rad":"lobe",this.lcaoDir,null));this.thisMesh.colix=this.defaultColix;this.setScriptInfo(null)},"JU.V3,~N,~N");m(c$,"invalidateTriangles",function(){this.thisMesh.invalidatePolygons()});m(c$,"setOutputChannel",
function(a,b){a.setOutputChannel(b)},"javajs.api.GenericBinaryDocument,JU.OC");m(c$,"fillMeshData",function(a,b,c){if(null==a){if(null==this.thisMesh&&this.allocMesh(null,null),this.thisMesh.isMerged||this.thisMesh.clearType(this.myType,this.sg.params.iAddGridPoints),this.thisMesh.connectedAtoms=this.connections,this.thisMesh.colix=this.getDefaultColix(),this.thisMesh.colorType=this.colorType,this.thisMesh.meshColix=this.meshColix,this.isPhaseColored||this.thisMesh.jvxlData.isBicolorMap)this.thisMesh.isColorSolid=
!1}else if(null==c&&(c=this.thisMesh),null!=c)switch(b){case 1:a.mergeVertexCount0=c.mergeVertexCount0;a.vs=c.vs;a.vertexSource=c.vertexSource;a.vvs=c.vvs;a.vc=c.vc;a.vertexIncrement=c.vertexIncrement;a.pc=c.pc;a.pis=c.pis;a.pcs=c.pcs;a.bsSlabDisplay=c.bsSlabDisplay;a.bsSlabGhost=c.bsSlabGhost;a.slabColix=c.slabColix;a.slabMeshType=c.slabMeshType;a.polygonCount0=c.polygonCount0;a.vertexCount0=c.vertexCount0;a.slabOptions=c.slabOptions;a.colorsExplicit=c.colorsExplicit;break;case 2:if(null==c.vcs||
c.vc>c.vcs.length)c.vcs=$(c.vc,0);a.vcs=c.vcs;break;case 3:c.surfaceSet=a.surfaceSet;c.vertexSets=a.vertexSets;c.nSets=a.nSets;break;case 4:c.vs=a.vs,c.vvs=a.vvs,c.vc=a.vc,c.vertexIncrement=a.vertexIncrement,c.vertexSource=a.vertexSource,c.pc=a.pc,c.pis=a.pis,c.pcs=a.pcs,c.bsSlabDisplay=a.bsSlabDisplay,c.bsSlabGhost=a.bsSlabGhost,c.slabColix=a.slabColix,c.slabMeshType=a.slabMeshType,c.polygonCount0=a.polygonCount0,c.vertexCount0=a.vertexCount0,c.mergeVertexCount0=a.mergeVertexCount0,c.slabOptions=
a.slabOptions,c.colorsExplicit=a.colorsExplicit}},"J.jvxl.data.MeshData,~N,J.shapesurface.IsosurfaceMesh");m(c$,"notifySurfaceGenerationCompleted",function(){this.setMeshI();this.setBsVdw();this.thisMesh.surfaceAtoms=this.sg.params.bsSelected;this.thisMesh.insideOut=this.sg.params.isInsideOut();this.thisMesh.isModelConnected=this.sg.params.isModelConnected;this.thisMesh.vertexSource=this.sg.params.vertexSource;this.thisMesh.oabc=this.sg.getOriginVaVbVc();this.thisMesh.calculatedArea=null;this.thisMesh.calculatedVolume=
null;this.thisMesh.probeValues=this.sg.params.probeValues;if(!this.thisMesh.isMerged)return this.thisMesh.initialize(this.sg.params.isFullyLit()?1073741964:1073741958,null,this.sg.params.thePlane),null!=this.jvxlData.fixedLattice&&(this.thisMesh.lattice=this.jvxlData.fixedLattice,this.thisMesh.fixLattice()),this.thisMesh.setColorsFromJvxlData(this.sg.params.colorRgb);this.sg.params.allowVolumeRender||(this.thisMesh.jvxlData.allowVolumeRender=!1);this.thisMesh.setColorsFromJvxlData(this.sg.params.colorRgb);
null!=this.thisMesh.jvxlData.slabInfo&&this.vwr.runScriptCautiously("isosurface "+this.thisMesh.jvxlData.slabInfo);0<this.sg.params.psi_monteCarloCount&&(this.thisMesh.diameter=-1);return!1});m(c$,"notifySurfaceMappingCompleted",function(){this.thisMesh.isMerged||this.thisMesh.initialize(this.sg.params.isFullyLit()?1073741964:1073741958,null,this.sg.params.thePlane);this.setBsVdw();this.thisMesh.isColorSolid=!1;this.thisMesh.colorDensity=this.jvxlData.colorDensity;this.thisMesh.volumeRenderPointSize=
this.jvxlData.pointSize;this.thisMesh.colorEncoder=this.sg.params.colorEncoder;this.thisMesh.getContours();0!=this.thisMesh.jvxlData.nContours&&-1!=this.thisMesh.jvxlData.nContours&&(this.explicitContours=!0);this.explicitContours&&null!=this.thisMesh.jvxlData.jvxlPlane&&(this.thisMesh.havePlanarContours=!0);this.setPropertySuper("token",Integer.$valueOf(this.explicitContours?1073742046:1073741938),null);this.setPropertySuper("token",Integer.$valueOf(this.explicitContours?1073741898:1073742039),null);
this.thisMesh.isMerged||this.thisMesh.setJvxlDataRendering();null!=this.sg.params.slabInfo&&(this.thisMesh.slabPolygonsList(this.sg.params.slabInfo,!1),this.thisMesh.reinitializeLightingAndColor(this.vwr));this.thisMesh.setColorCommand()});d(c$,"setBsVdw",function(){null!=this.sg.bsVdw&&(null==this.thisMesh.bsVdw&&(this.thisMesh.bsVdw=new JU.BS),this.thisMesh.bsVdw.or(this.sg.bsVdw))});m(c$,"calculateGeodesicSurface",function(a,b){return this.vwr.calculateSurface(a,b)},"JU.BS,~N");m(c$,"getSurfacePointIndexAndFraction",
function(){return 0},"~N,~B,~N,~N,~N,JU.P3i,~N,~N,~N,~N,JU.T3,JU.V3,~B,~A");m(c$,"addVertexCopy",function(a,b,c,e){return null!=this.cutoffRange&&(b<this.cutoffRange[0]||b>this.cutoffRange[1])?-1:null!=this.withinPoints&&!J.shape.Mesh.checkWithin(a,this.withinPoints,this.withinDistance2,this.isWithinNot)?-1:this.thisMesh.addVertexCopy(a,b,c,this.associateNormals,e)},"JU.T3,~N,~N,~B");m(c$,"addTriangleCheck",function(a,b,c,e,k,h,f){return 0>a||0>b||0>c||h&&!J.jvxl.data.MeshData.checkCutoff(a,b,c,this.thisMesh.vvs)?
-1:this.thisMesh.addTriangleCheck(a,b,c,e,k,f)},"~N,~N,~N,~N,~N,~B,~N");d(c$,"setScriptInfo",function(a){a=null==a?this.sg.params.script:a;var b=null==a?-1:a.indexOf("; isosurface map");if(0==b)null!=this.thisMesh.scriptCommand&&(b=this.thisMesh.scriptCommand.indexOf("; isosurface map"),0<=b&&(this.thisMesh.scriptCommand=this.thisMesh.scriptCommand.substring(0,b)),this.thisMesh.scriptCommand+=a);else if(this.thisMesh.title=this.sg.params.title,this.thisMesh.dataType=this.sg.params.dataType,this.thisMesh.scale3d=
this.sg.params.scale3d,null!=a&&(null!=this.oldFileName&&(a=a.$replace(this.oldFileName,this.newFileName))," "==a.charAt(0)&&(a=this.myType+" ID "+JU.PT.esc(this.thisMesh.thisID)+a,b=a.indexOf("; isosurface map"))),this.thisMesh.scriptCommand=0<b&&0<this.scriptAppendix.length?a.substring(0,b)+this.scriptAppendix+a.substring(b):a+this.scriptAppendix,!this.explicitID&&null!=a&&0<=(b=a.indexOf("# ID=")))this.thisMesh.thisID=JU.PT.getQuotedStringAt(a,b)},"~S");m(c$,"addRequiredFile",function(a){a=' # /*file*/"'+
a+'"';0>this.scriptAppendix.indexOf(a)&&(this.scriptAppendix+=a)},"~S");m(c$,"setRequiredFile",function(a,b){this.oldFileName=a;this.newFileName=b},"~S,~S");d(c$,"setJvxlInfo",function(){if(this.sg.jvxlData!==this.jvxlData||this.sg.jvxlData!==this.thisMesh.jvxlData)this.jvxlData=this.thisMesh.jvxlData=this.sg.jvxlData});m(c$,"getShapeDetail",function(){for(var a=new JU.Lst,b=0;b<this.meshCount;b++){var c=new java.util.Hashtable,e=this.isomeshes[b];null==e||(null==e.vs||0==e.vc&&0==e.pc)||(this.addMeshInfo(e,
c),a.addLast(c))}return a});d(c$,"addMeshInfo",function(a,b){b.put("ID",null==a.thisID?"<noid>":a.thisID);b.put("visible",Boolean.$valueOf(a.visible));b.put("vertexCount",Integer.$valueOf(a.vc));null!=a.calculatedVolume&&b.put("volume",a.calculatedVolume);null!=a.calculatedArea&&b.put("area",a.calculatedArea);Float.isNaN(a.ptCenter.x)||b.put("center",a.ptCenter);null!=a.mat4&&b.put("mat4",a.mat4);0!=a.scale3d&&b.put("scale3d",Float.$valueOf(a.scale3d));b.put("xyzMin",a.jvxlData.boundingBox[0]);b.put("xyzMax",
a.jvxlData.boundingBox[1]);var c=J.jvxl.data.JvxlCoder.jvxlGetInfo(a.jvxlData);null!=c&&b.put("jvxlInfo",c.$replace("\n"," "));b.put("modelIndex",Integer.$valueOf(a.modelIndex));b.put("color",JU.CU.colorPtFromInt(JU.C.getArgb(a.colix),null));null!=a.colorEncoder&&b.put("colorKey",a.colorEncoder.getColorKey());null!=a.title&&b.put("title",a.title);(null!=a.jvxlData.contourValues||null!=a.jvxlData.contourValuesUsed)&&b.put("contours",a.getContourList(this.vwr))},"J.shapesurface.IsosurfaceMesh,java.util.Map");
m(c$,"getPlane",function(){return null},"~N");m(c$,"getValue",function(){return 0},"~N,~N,~N,~N");m(c$,"checkObjectHovered",function(a,b,c){if(null!=this.keyXy&&a>=this.keyXy[0]&&b>=this.keyXy[1]&&a<this.keyXy[2]&&b<this.keyXy[3])return this.hoverKey(a,b),!0;if(!this.vwr.getDrawHover())return!1;c=this.findValue(a,b,!1,c);if(null==c)return!1;this.vwr.hoverOnPt(a,b,c,this.pickedMesh.thisID,this.pickedPt);return!0},"~N,~N,JU.BS");d(c$,"hoverKey",function(a,b){try{var c,e=1-1*(b-this.keyXy[1])/(this.keyXy[3]-
this.keyXy[1]);if(this.thisMesh.showContourLines){var k=this.thisMesh.getContours();if(null==k){if(null==this.thisMesh.jvxlData.contourValues)return;var h=D(Math.floor(e*this.thisMesh.jvxlData.contourValues.length));if(0>h||h>this.thisMesh.jvxlData.contourValues.length)return;c=""+this.thisMesh.jvxlData.contourValues[h]}else{h=D(Math.floor(e*k.length));if(0>h||h>k.length)return;c=""+k[h].get(2).floatValue()}}else{var f=this.thisMesh.colorEncoder.quantize(e,!0),e=this.thisMesh.colorEncoder.quantize(e,
!1);c=""+f+" - "+e}this.vwr.hoverOnPt(a,b,c,null,null)}catch(d){if(!Y(d,Exception))throw d;}},"~N,~N");m(c$,"checkObjectClicked",function(a,b,c,e,k){if(!k||!this.vwr.isBound(c,18))return null;c=100;this.vwr.gdata.isAntialiased()&&(a<<=1,b<<=1,c<<=1);for(var h=k=-1,f=-2147483648,d=2147483647,g=0;g<this.meshCount;g++){var p=this.isomeshes[g];if(this.isPickable(p,e)&&(p=p.vs,null!=p))for(var l=p.length;0<=--l;){var t=p[l];null!=t&&0<=this.coordinateInRange(a,b,t,c,this.ptXY)&&(this.ptXY.z<d&&(k=g,d=
this.ptXY.z,h=l),this.ptXY.z>f&&(f=this.ptXY.z))}}if(0>k)return null;this.pickedMesh=this.isomeshes[k];this.setPropertySuper("thisID",this.pickedMesh.thisID,null);this.pickedVertex=h;a=new JU.P3;a.setT(this.pickedMesh.vs[this.pickedVertex]);this.pickedModel=this.pickedMesh.modelIndex;b=this.getPickedPoint(a,this.pickedModel);this.setStatusPicked(-4,a,b);return b},"~N,~N,~N,JU.BS,~B");d(c$,"isPickable",function(a,b){return 0!=a.visibilityFlags&&(0>a.modelIndex||b.get(a.modelIndex))&&!JU.C.isColixTranslucent(a.colix)},
"J.shapesurface.IsosurfaceMesh,JU.BS");d(c$,"findValue",function(a,b,c,e){c=100;this.vwr.gdata.isAntialiased()&&(a<<=1,b<<=1,c<<=1);for(var k=-1,h=null,d=null,g=0;g<this.meshCount;g++)if(d=this.isomeshes[g],this.isPickable(d,e)){var j=d.jvxlData.vContours,p=0>d.firstRealVertex?0:d.firstRealVertex,l=0;if(null!=j&&0<j.length){for(p=0;p<j.length;p++)for(var t=j[p],r=t.size()-1,L=6;L<r;L++){var v=t.get(L),m=this.coordinateInRange(a,b,v,c,this.ptXY);0<=m&&(c=m,h=t,l=p,this.pickedMesh=d,this.pickedPt=v)}if(null!=
h)return h.get(2).toString()+(JU.Logger.debugging?" "+l:"")}else if(null!=d.jvxlData.jvxlPlane&&null!=d.vvs){j=null==d.mat4&&0==d.scale3d?d.vs:d.getOffsetVertices(d.jvxlData.jvxlPlane);for(L=d.vc;--L>=p;)v=j[L],m=this.coordinateInRange(a,b,v,c,this.ptXY),0<=m&&(c=m,k=L,this.pickedMesh=d,this.pickedPt=v);if(-1!=k)break}else if(null!=d.vvs){if(null!=d.bsSlabDisplay)for(L=d.bsSlabDisplay.nextSetBit(0);0<=L;L=d.bsSlabDisplay.nextSetBit(L+1)){if(j=d.pis[L],null!=j)for(l=0;3>l;l++)v=d.vs[j[l]],m=this.coordinateInRange(a,
b,v,c,this.ptXY),0<=m&&(c=m,k=j[l],this.pickedMesh=d,this.pickedPt=v)}else for(L=d.vc;--L>=p;)v=d.vs[L],m=this.coordinateInRange(a,b,v,c,this.ptXY),0<=m&&(c=m,k=L,this.pickedMesh=d,this.pickedPt=v);if(-1!=k)break}}return-1==k?null:(JU.Logger.debugging?"$"+d.thisID+"["+(k+1)+"] "+d.vs[k]+": ":d.thisID+": ")+d.vvs[k]},"~N,~N,~B,JU.BS");d(c$,"getCmd",function(a){var b=(new JU.SB).append("\n");this.getMeshCommand(b,a);return b.toString()},"~N");m(c$,"getValues",function(a){return null==a?null:a.getValidValues(null)},
"J.shape.Mesh");m(c$,"getVertices",function(a){return null==a?null:a.getValidVertices(null)},"J.shape.Mesh");Z(c$,"MAX_OBJECT_CLICK_DISTANCE_SQUARED",100)});O("J.jvxl.data");F(null,"J.jvxl.data.JvxlCoder","java.lang.Float JU.BS $.Lst $.P3 $.PT $.SB J.api.Interface J.jvxl.data.VolumeData JU.BSUtil $.C $.Escape $.Logger JV.Viewer".split(" "),function(){c$=Aa(J.jvxl.data,"JvxlCoder");c$.jvxlGetFile=d(c$,"jvxlGetFile",function(a,b,c,e,k,d,f,g){J.jvxl.data.JvxlCoder.checkHaveXMLUtil();var j=new JU.SB;
if("TRAILERONLY".equals(e))return JU.XmlUtil.closeTag(j,"jvxlSurfaceSet"),JU.XmlUtil.closeTag(j,"jvxl"),j.toString();var p=null!=b,l="HEADERONLY".equals(e);if(k){JU.XmlUtil.openDocument(j);JU.XmlUtil.openTagAttr(j,"jvxl",B(-1,["version","2.4","jmolVersion",a.version,"xmlns","http://jmol.org/jvxl_schema","xmlns:cml","http://www.xml-cml.org/schema"]));JU.XmlUtil.appendCdata(j,"jvxlFileTitle",null,null==a.jvxlFileTitle?"\n":"\n"+a.jvxlFileTitle);null!=a.moleculeXml&&j.append(a.moleculeXml);var t=p?null:
a.jvxlVolumeDataXml;null==t&&(t=(new J.jvxl.data.VolumeData).setVolumetricXml());j.append(t);JU.XmlUtil.openTagAttr(j,"jvxlSurfaceSet",B(-1,["count",""+(0<d?d:1)]));if(l)return j.toString()}d=p?"pmesh":null==a.jvxlPlane?"isosurface":"plane";null!=a.jvxlColorData&&0<a.jvxlColorData.length&&(d="mapped "+d);JU.XmlUtil.openTagAttr(j,"jvxlSurface",B(-1,["type",d]));j.append(J.jvxl.data.JvxlCoder.jvxlGetInfoData(a,p));J.jvxl.data.JvxlCoder.jvxlAppendCommandState(j,g,f);if(null!=c||null!=e&&0<e.length){f=
new JU.SB;null!=e&&0<e.length&&f.append(e).append("\n");if(null!=c)for(e=0;e<c.length;e++)f.append(c[e]).appendC("\n");JU.XmlUtil.appendCdata(j,"jvxlSurfaceTitle",null,f.toString())}f=new JU.SB;JU.XmlUtil.openTagAttr(f,"jvxlSurfaceData",p||null==a.jvxlPlane?null:null==a.mapLattice?B(-1,["plane",JU.Escape.eP4(a.jvxlPlane)]):B(-1,["plane",JU.Escape.eP4(a.jvxlPlane),"maplattice",JU.Escape.eP(a.mapLattice)]));if(p)J.jvxl.data.JvxlCoder.appendXmlVertexOnlyData(f,a,b,!0);else{if(null==a.jvxlPlane){if(null==
a.jvxlEdgeData)return"";J.jvxl.data.JvxlCoder.appendXmlEdgeData(f,a)}J.jvxl.data.JvxlCoder.appendXmlColorData(f,a.jvxlColorData,!0,a.isJvxlPrecisionColor,a.valueMappedToRed,a.valueMappedToBlue)}J.jvxl.data.JvxlCoder.appendEncodedBitSetTag(f,"jvxlInvalidatedVertexData",a.jvxlExcluded[1],-1,null);0<a.excludedVertexCount&&(J.jvxl.data.JvxlCoder.appendEncodedBitSetTag(f,"jvxlExcludedVertexData",a.jvxlExcluded[0],a.excludedVertexCount,null),J.jvxl.data.JvxlCoder.appendEncodedBitSetTag(f,"jvxlExcludedPlaneData",
a.jvxlExcluded[2],-1,null));J.jvxl.data.JvxlCoder.appendEncodedBitSetTag(f,"jvxlExcludedTriangleData",a.jvxlExcluded[3],a.excludedTriangleCount,null);JU.XmlUtil.closeTag(f,"jvxlSurfaceData");b=f.length();j.appendSB(f);null!=a.vContours&&0<a.vContours.length&&J.jvxl.data.JvxlCoder.jvxlEncodeContourData(a.vContours,j);if(null!=a.vertexColorMap){null==a.baseColor?JU.XmlUtil.openTag(j,"jvxlVertexColorData"):JU.XmlUtil.openTagAttr(j,"jvxlVertexColorData",B(-1,["baseColor",a.baseColor]));var r;for(c=a.vertexColorMap.entrySet().iterator();c.hasNext()&&
((r=c.next())||1);)J.jvxl.data.JvxlCoder.appendEncodedBitSetTag(j,"jvxlColorMap",r.getValue(),-1,B(-1,["color",r.getKey()]));a.vertexColorMap=null;JU.XmlUtil.closeTag(j,"jvxlVertexColorData")}JU.XmlUtil.closeTag(j,"jvxlSurface");k&&(JU.XmlUtil.closeTag(j,"jvxlSurfaceSet"),JU.XmlUtil.closeTag(j,"jvxl"));return J.jvxl.data.JvxlCoder.jvxlSetCompressionRatio(j,a,b)},"J.jvxl.data.JvxlData,J.jvxl.data.MeshData,~A,~S,~B,~N,~S,~S");c$.checkHaveXMLUtil=d(c$,"checkHaveXMLUtil",function(){J.jvxl.data.JvxlCoder.haveXMLUtil||
(JV.Viewer.isJS&&J.api.Interface.getInterface("JU.XmlUtil",null,"show"),J.jvxl.data.JvxlCoder.haveXMLUtil=!0)});c$.appendEncodedBitSetTag=d(c$,"appendEncodedBitSetTag",function(a,b,c,e,k){0>e&&(e=JU.BSUtil.cardinalityOf(c));if(0!=e){var d=new JU.SB;d.append("\n ");J.jvxl.data.JvxlCoder.jvxlEncodeBitSetBuffer(c,-1,d);JU.XmlUtil.appendTagObj(a,b,B(-1,[k,"bsEncoding","base90+35","count",""+e,"len",""+c.length()]),J.jvxl.data.JvxlCoder.jvxlCompressString(d.toString(),!0))}},"JU.SB,~S,JU.BS,~N,~A");c$.jvxlSetCompressionRatio=
d(c$,"jvxlSetCompressionRatio",function(a,b,c){a=a.toString();b=y(0<b.nBytes?b.nBytes/c:13*b.nPointsX*b.nPointsY*b.nPointsZ/c);return JU.PT.rep(a,'"not calculated"',0<b?'"'+b+':1"':'"?"')},"JU.SB,J.jvxl.data.JvxlData,~N");c$.appendXmlEdgeData=d(c$,"appendXmlEdgeData",function(a,b){JU.XmlUtil.appendTagObj(a,"jvxlEdgeData",B(-1,["count",""+(b.jvxlEdgeData.length-1),"encoding","base90f1","bsEncoding","base90+35c","isXLowToHigh",""+b.isXLowToHigh,"data",J.jvxl.data.JvxlCoder.jvxlCompressString(b.jvxlEdgeData,
!0)]),"\n"+J.jvxl.data.JvxlCoder.jvxlCompressString(b.jvxlSurfaceData,!0))},"JU.SB,J.jvxl.data.JvxlData");c$.jvxlAppendCommandState=d(c$,"jvxlAppendCommandState",function(a,b,c){null!=b&&JU.XmlUtil.appendCdata(a,"jvxlIsosurfaceCommand",null,"\n"+(0>b.indexOf("#")?b:b.substring(0,b.indexOf("#")))+"\n");null!=c&&(0<=c.indexOf("** XML ** ")?(c=JU.PT.split(c,"** XML **")[1].trim(),JU.XmlUtil.appendTag(a,"jvxlIsosurfaceState","\n"+c+"\n")):JU.XmlUtil.appendCdata(a,"jvxlIsosurfaceState",null,"\n"+c))},
"JU.SB,~S,~S");c$.appendXmlColorData=d(c$,"appendXmlColorData",function(a,b,c,e,k,d){var f;if(!(null==b||0>(f=b.length-1)))e&&(f/=2),JU.XmlUtil.appendTagObj(a,"jvxlColorData",B(-1,["count",""+f,"encoding",c?"base90f"+(e?"2":"1"):"none","min",""+k,"max",""+d,"data",J.jvxl.data.JvxlCoder.jvxlCompressString(b,!0)]),null)},"JU.SB,~S,~B,~B,~N,~N");c$.jvxlGetInfo=d(c$,"jvxlGetInfo",function(a){return J.jvxl.data.JvxlCoder.jvxlGetInfoData(a,a.vertexDataOnly)},"J.jvxl.data.JvxlData");c$.jvxlGetInfoData=d(c$,
"jvxlGetInfoData",function(a,b){if(null==a.jvxlSurfaceData)return"";J.jvxl.data.JvxlCoder.checkHaveXMLUtil();var c=new JU.Lst,e=a.nSurfaceInts,k=b?0:a.jvxlEdgeData.length-1,d=null==a.jvxlColorData?-1:a.jvxlColorData.length-1;J.jvxl.data.JvxlCoder.addAttrib(c,"\n  isModelConnected",""+a.isModelConnected);if(!b){J.jvxl.data.JvxlCoder.addAttrib(c,"\n  cutoff",null==a.cutoffRange?""+a.cutoff:a.cutoffRange[0]+" "+a.cutoffRange[1]);J.jvxl.data.JvxlCoder.addAttrib(c,"\n  isCutoffAbsolute",""+a.isCutoffAbsolute);
J.jvxl.data.JvxlCoder.addAttrib(c,"\n  pointsPerAngstrom",""+a.pointsPerAngstrom);var f=a.jvxlSurfaceData.length+k+d+1;0<f&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nBytesData",""+f);J.jvxl.data.JvxlCoder.addAttrib(c,"\n  isXLowToHigh",""+a.isXLowToHigh);null==a.jvxlPlane&&(J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nSurfaceInts",""+e),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nBytesUncompressedEdgeData",""+k));0<d&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nBytesUncompressedColorData",""+d)}a.excludedVertexCount=
JU.BSUtil.cardinalityOf(a.jvxlExcluded[0]);a.excludedTriangleCount=JU.BSUtil.cardinalityOf(a.jvxlExcluded[3]);0<a.excludedVertexCount&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nExcludedVertexes",""+a.excludedVertexCount);0<a.excludedTriangleCount&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nExcludedTriangles",""+a.excludedTriangleCount);f=JU.BSUtil.cardinalityOf(a.jvxlExcluded[1]);0<f&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nInvalidatedVertexes",""+f);null!=a.slabInfo&&J.jvxl.data.JvxlCoder.addAttrib(c,
"\n  slabInfo",a.slabInfo);a.isJvxlPrecisionColor&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  precisionColor","true");a.colorDensity&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  colorDensity","true");Float.isNaN(a.pointSize)?0!=a.diameter&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  diameter",""+a.diameter):J.jvxl.data.JvxlCoder.addAttrib(c,"\n  pointSize",""+a.pointSize);a.allowVolumeRender||J.jvxl.data.JvxlCoder.addAttrib(c,"\n  allowVolumeRender","false");null==a.jvxlPlane||b?(null!=a.fixedLattice&&!b&&J.jvxl.data.JvxlCoder.addAttrib(c,
"\n  fixedLattice",""+a.fixedLattice),a.isContoured?(J.jvxl.data.JvxlCoder.addAttrib(c,"\n  contoured","true"),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  colorMapped","true")):a.isBicolorMap?(J.jvxl.data.JvxlCoder.addAttrib(c,"\n  bicolorMap","true"),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  colorNegative",JU.C.getHexCode(a.minColorIndex)),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  colorPositive",JU.C.getHexCode(a.maxColorIndex))):0<d&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  colorMapped","true"),null!=a.vContours&&
0<a.vContours.length&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nContourData",""+a.vContours.length)):(null!=a.mapLattice&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  mapLattice",""+a.mapLattice),0!=a.scale3d&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  scale3d",""+a.scale3d),0<d&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  colorMapped","true"),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  plane",JU.Escape.eP4(a.jvxlPlane)));null!=a.color&&0>a.color.indexOf("null")&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  color",a.color);
J.jvxl.data.JvxlCoder.addAttrib(c,"\n  translucency",""+a.translucency);null!=a.meshColor&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  meshColor",a.meshColor);null!=a.colorScheme&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  colorScheme",a.colorScheme);null!=a.rendering&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  rendering",a.rendering);null!=a.thisSet&&(e=J.jvxl.data.JvxlCoder.subsetString(a.thisSet),e.startsWith("[")?J.jvxl.data.JvxlCoder.addAttrib(c,"\n  subset",e):J.jvxl.data.JvxlCoder.addAttrib(c,"\n  set",
e));-2147483648!=a.slabValue&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  slabValue",""+a.slabValue);a.isSlabbable&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  slabbable","true");0<a.nVertexColors&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nVertexColors",""+a.nVertexColors);e=3.4028235E38==a.mappedDataMin?0:a.mappedDataMin;k=a.isColorReversed?a.valueMappedToRed:a.valueMappedToBlue;d=a.isColorReversed?a.valueMappedToBlue:a.valueMappedToRed;null!=a.jvxlColorData&&(0<a.jvxlColorData.length&&!a.isBicolorMap)&&(J.jvxl.data.JvxlCoder.addAttrib(c,
"\n  dataMinimum",""+e),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  dataMaximum",""+a.mappedDataMax),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  valueMappedToRed",""+d),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  valueMappedToBlue",""+k));a.isContoured&&(null==a.contourValues||null==a.contourColixes?null==a.vContours&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nContours",""+Math.abs(a.nContours)):(null!=a.jvxlPlane&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  contoured","true"),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  nContours",
""+a.contourValues.length),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  contourValues",JU.Escape.eAF(null==a.contourValuesUsed?a.contourValues:a.contourValuesUsed)),J.jvxl.data.JvxlCoder.addAttrib(c,"\n  contourColors",a.contourColors)),0<a.thisContour&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  thisContour",""+a.thisContour));a.insideOut&&J.jvxl.data.JvxlCoder.addAttrib(c,"\n  insideOut","true");a.vertexDataOnly?J.jvxl.data.JvxlCoder.addAttrib(c,"\n  note","vertex/face data only"):a.isXLowToHigh&&J.jvxl.data.JvxlCoder.addAttrib(c,
"\n  note","progressive JVXL+ -- X values read from low(0) to high("+(a.nPointsX-1)+")");J.jvxl.data.JvxlCoder.addAttrib(c,"\n  xyzMin",JU.Escape.eP(a.boundingBox[0]));J.jvxl.data.JvxlCoder.addAttrib(c,"\n  xyzMax",JU.Escape.eP(a.boundingBox[1]));J.jvxl.data.JvxlCoder.addAttrib(c,"\n  approximateCompressionRatio","not calculated");J.jvxl.data.JvxlCoder.addAttrib(c,"\n  jmolVersion",a.version);e=new JU.SB;JU.XmlUtil.openTagAttr(e,"jvxlSurfaceInfo",c.toArray(Array(c.size())));JU.XmlUtil.closeTag(e,
"jvxlSurfaceInfo");return e.toString()},"J.jvxl.data.JvxlData,~B");c$.subsetString=d(c$,"subsetString",function(a){if(1<a.cardinality()){for(var b="[ ",c=a.nextSetBit(0);0<=c;c=a.nextSetBit(c))b+=++c+" ";return b+"]"}return""+(a.nextSetBit(0)+1)},"JU.BS");c$.addAttrib=d(c$,"addAttrib",function(a,b,c){a.addLast(B(-1,[b,c]))},"JU.Lst,~S,~S");c$.jvxlEncodeContourData=d(c$,"jvxlEncodeContourData",function(a,b){JU.XmlUtil.openTagAttr(b,"jvxlContourData",B(-1,["count",""+a.length]));for(var c=0;c<a.length;c++)if(!(6>
a[c].size())){var e=a[c].get(0).intValue(),k=new JU.SB;k.append("\n");var d=a[c].get(1);J.jvxl.data.JvxlCoder.jvxlEncodeBitSetBuffer(d,e,k);JU.XmlUtil.appendTagObj(b,"jvxlContour",B(-1,["index",""+c,"value",""+a[c].get(2),"color",JU.Escape.escapeColor(a[c].get(4)[0]),"count",""+d.length(),"encoding","base90iff1","bsEncoding","base90+35c","data",J.jvxl.data.JvxlCoder.jvxlCompressString(a[c].get(5).toString(),!0)]),J.jvxl.data.JvxlCoder.jvxlCompressString(k.toString(),!0))}JU.XmlUtil.closeTag(b,"jvxlContourData")},
"~A,JU.SB");c$.set3dContourVector=d(c$,"set3dContourVector",function(a,b,c){if(!(6>a.size()))for(var e=a.get(5),k=a.get(1),d=0,f=e.length(),g=0,j=" ",p=" ",l=k.nextSetBit(0);0<=l;l=k.nextSetBit(l+1)){for(var t=b[l];d<f&&!JU.PT.isDigit(j=e.charAt(d++)););for(g=j.charCodeAt(0)-48;d<f&&JU.PT.isWhitespace(j=e.charAt(d++)););for(;d<f&&JU.PT.isWhitespace(p=e.charAt(d++)););var r=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter(j.charCodeAt(0),35,90,0),m=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter(p.charCodeAt(0),
35,90,0),v,u;0==(g&1)?(v=t[1],u=g=t[2],t=t[0]):(v=t[0],u=t[1],0!=(g&2)?(g=u,t=t[2]):(g=t[2],t=v));a.addLast(J.jvxl.data.JvxlCoder.getContourPoint(c,v,u,r));a.addLast(J.jvxl.data.JvxlCoder.getContourPoint(c,g,t,m))}},"JU.Lst,~A,~A");c$.getContourPoint=d(c$,"getContourPoint",function(a,b,c,e){var k=new JU.P3;k.sub2(a[c],a[b]);k.scaleAdd2(e,k,a[b]);return k},"~A,~N,~N,~N");c$.appendContourTriangleIntersection=d(c$,"appendContourTriangleIntersection",function(a,b,c,e){e.appendI(a);e.appendC(J.jvxl.data.JvxlCoder.jvxlFractionAsCharacter(b));
e.appendC(J.jvxl.data.JvxlCoder.jvxlFractionAsCharacter(c))},"~N,~N,~N,JU.SB");c$.jvxlCreateColorData=d(c$,"jvxlCreateColorData",function(a,b){if(null==b)a.jvxlColorData="";else{var c=a.colorFractionBase,e=a.colorFractionRange,k=0<a.saveVertexCount?a.saveVertexCount:a.vertexCount;k>b.length&&System.out.println("JVXLCODER ERROR");var d=a.isJvxlPrecisionColor,f=d?a.mappedDataMin:a.valueMappedToRed,g=d?a.mappedDataMax:a.valueMappedToBlue;b.length<k&&System.out.println("JVXLCOLOR OHOHO");a.jvxlColorData=
J.jvxl.data.JvxlCoder.jvxlEncodeColorData(b,f,g,c,e,a.isTruncated,d)}},"J.jvxl.data.JvxlData,~A");c$.jvxlEncodeColorData=d(c$,"jvxlEncodeColorData",function(a,b,c,e,k,d,f){for(var g=new JU.SB,j=new JU.SB,p=0,l=a.length;p<l;p++){var t=a[p];Float.isNaN(t)&&(t=b);d&&(t=0<t?0.999:-0.999);f?J.jvxl.data.JvxlCoder.jvxlAppendCharacter2(t,b,c,e,k,g,j):g.appendC(J.jvxl.data.JvxlCoder.jvxlValueAsCharacter(t,b,c,e,k))}return g.appendSB(j).appendC("\n").toString()},"~A,~N,~N,~N,~N,~B,~B");c$.appendXmlVertexOnlyData=
d(c$,"appendXmlVertexOnlyData",function(a,b,c,e){var k=u(c.vc,0);J.jvxl.data.JvxlCoder.appendXmlTriangleData(a,c.pis,c.pc,c.bsSlabDisplay,k,e)&&J.jvxl.data.JvxlCoder.appendXmlVertexData(a,b,k,c.vs,c.vvs,c.vc,c.polygonColorData,c.pc,c.bsSlabDisplay,b.vertexColors,0<b.jvxlColorData.length,e)},"JU.SB,J.jvxl.data.JvxlData,J.jvxl.data.MeshData,~B");c$.appendXmlTriangleData=d(c$,"appendXmlTriangleData",function(a,b,c,e,k,d){for(var f=new JU.SB,g=new JU.SB,j=1,p=0,l=0,t=!1,r=0,m=null!=e,v=0;v<c;)if(null==
b[v]||m&&!e.get(v))v++;else{var u=b[v][p],u=0<k[u]?k[u]:k[u]=++l,w=u-j,j=u;0==w?(f.appendC("!"),t=!1):32<w?(t&&f.appendC("+"),f.appendI(w),t=!0):-32>w?(f.appendI(w),t=!0):(f.appendC(String.fromCharCode(92+w)),t=!1);0==++p%3&&(g.appendI(b[v][3]),p=0,v++,r++)}if(0==f.length())return!0;JU.XmlUtil.appendTagObj(a,"jvxlTriangleData",B(-1,["count",""+r,"encoding","jvxltdiff","data",J.jvxl.data.JvxlCoder.jvxlCompressString(f.toString(),d)]),null);JU.XmlUtil.appendTagObj(a,"jvxlTriangleEdgeData",B(-1,["count",
""+r,"encoding","jvxlsc","data",J.jvxl.data.JvxlCoder.jvxlCompressString(g.toString(),d)]),null);return!0},"JU.SB,~A,~N,JU.BS,~A,~B");c$.appendXmlVertexData=d(c$,"appendXmlVertexData",function(a,b,c,e,k,d,f,g,j,p,l,t){var r=b.colorFractionBase,m=b.colorFractionRange,v,w=b.boundingBox[0],y=b.boundingBox[1],D=new JU.SB,H=new JU.SB,F=null,aa=null!=j;if(0<g){aa&&(g=j.cardinality());for(var aa=!1,F=u(d,0),I=0;I<d;I++)0<c[I]&&(F[c[I]-1]=I)}for(I=c=0;I<d;I++)if(!aa||j.get(I))c++,v=e[0==g?I:F[I]],J.jvxl.data.JvxlCoder.jvxlAppendCharacter2(v.x,
w.x,y.x,r,m,D,H),J.jvxl.data.JvxlCoder.jvxlAppendCharacter2(v.y,w.y,y.y,r,m,D,H),J.jvxl.data.JvxlCoder.jvxlAppendCharacter2(v.z,w.z,y.z,r,m,D,H);D.appendSB(H);JU.XmlUtil.appendTagObj(a,"jvxlVertexData",B(-1,["count",""+c,"min",JU.Escape.eP(w),"max",JU.Escape.eP(y),"encoding","base90xyz2","data",J.jvxl.data.JvxlCoder.jvxlCompressString(D.toString(),t)]),null);null!=f&&JU.XmlUtil.appendTagObj(a,"jvxlPolygonColorData",B(-1,["encoding","jvxlnc","count",""+g]),"\n"+f);if(l){D=new JU.SB;H=new JU.SB;if(null==
p)for(I=0;I<d;I++){if(!aa||j.get(I))J.jvxl.data.JvxlCoder.jvxlAppendCharacter2(k[0==g?I:F[I]],b.mappedDataMin,b.mappedDataMax,r,m,D,H)}else{e=0;D.appendI(c).append(" ");for(I=0;I<d;I++)if(!aa||j.get(I))k=p[0==g?I:F[I]],k==e?k=0:e=k,D.appendI(k),D.append(" ")}J.jvxl.data.JvxlCoder.appendXmlColorData(a,D.appendSB(H).append("\n").toString(),null==p,!0,b.valueMappedToRed,b.valueMappedToBlue)}},"JU.SB,J.jvxl.data.JvxlData,~A,~A,~A,~N,~S,~N,JU.BS,~A,~B,~B");c$.jvxlFractionAsCharacter=d(c$,"jvxlFractionAsCharacter",
function(a){return J.jvxl.data.JvxlCoder.jvxlFractionAsCharacterRange(a,35,90)},"~N");c$.jvxlFractionAsCharacterRange=d(c$,"jvxlFractionAsCharacterRange",function(a,b,c){0.9999<a?a=0.9999:Float.isNaN(a)&&(a=1.0001);a=D(Math.floor(a*c+b));return a<b?String.fromCharCode(b):92==a?"!":String.fromCharCode(a)},"~N,~N,~N");c$.jvxlAppendCharacter2=d(c$,"jvxlAppendCharacter2",function(a,b,c,e,k,d,f){a=b==c?a:(a-b)/(c-b);b=J.jvxl.data.JvxlCoder.jvxlFractionAsCharacterRange(a,e,k);d.appendC(b);a-=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter(b.charCodeAt(0),
e,k,0);f.appendC(J.jvxl.data.JvxlCoder.jvxlFractionAsCharacterRange(a*k,e,k))},"~N,~N,~N,~N,~N,JU.SB,JU.SB");c$.jvxlFractionFromCharacter=d(c$,"jvxlFractionFromCharacter",function(a,b,c,e){if(a==b+c)return NaN;a<b&&(a=92);a=(a-b+e)/c;return 0>a?0:1<a?0.999999:a},"~N,~N,~N,~N");c$.jvxlFractionFromCharacter2=d(c$,"jvxlFractionFromCharacter2",function(a,b,c,e){a=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter(a,c,e,0);b=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter(b,c,e,0.5);return a+b/e},"~N,~N,~N,~N");
c$.jvxlValueAsCharacter=d(c$,"jvxlValueAsCharacter",function(a,b,c,e,k){return J.jvxl.data.JvxlCoder.jvxlFractionAsCharacterRange(b==c?a:(a-b)/(c-b),e,k)},"~N,~N,~N,~N,~N");c$.jvxlValueFromCharacter2=d(c$,"jvxlValueFromCharacter2",function(a,b,c,e,k,d){a=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter2(a,b,k,d);return e==c?a:c+a*(e-c)},"~N,~N,~N,~N,~N,~N");c$.jvxlEncodeBitSet0=d(c$,"jvxlEncodeBitSet0",function(a,b,c){var e=0,k=-1,d=0;0>b&&(b=a.length());for(var f=0,g=!1,j=b-1,p=0;p<b;++p)g==a.get(p)?
e++:(e==k&&p!=j?d++:(0<d&&(c.appendC(" ").appendI(-d),d=0,f++),c.appendC(" ").appendI(e),f++,k=e),e=1,g=!g);c.appendC(" ").appendI(e).appendC("\n");return f},"JU.BS,~N,JU.SB");c$.jvxlEncodeBitSet=d(c$,"jvxlEncodeBitSet",function(a){var b=new JU.SB;J.jvxl.data.JvxlCoder.jvxlEncodeBitSetBuffer(a,-1,b);return b.toString()},"JU.BS");c$.jvxlEncodeBitSetBuffer=d(c$,"jvxlEncodeBitSetBuffer",function(a,b,c){var e=0,k=0,d=!1;0>b&&(b=a.length());if(0==b)return 0;c.append("-");for(var f=0;f<b;++f)d==a.get(f)?
e++:(J.jvxl.data.JvxlCoder.jvxlAppendEncodedNumber(c,e,35,90),k++,e=1,d=!d);J.jvxl.data.JvxlCoder.jvxlAppendEncodedNumber(c,e,35,90);c.appendC("\n");return k},"JU.BS,~N,JU.SB");c$.jvxlAppendEncodedNumber=d(c$,"jvxlAppendEncodedNumber",function(a,b,c,e){var k=b<e;for(0==b?a.appendC(String.fromCharCode(c)):k||a.appendC(String.fromCharCode(c+e));0<b;){var d=D(b/e);b=c+b-d*e;92==b&&(b=33);a.appendC(String.fromCharCode(b));b=d}k||a.append(" ")},"JU.SB,~N,~N,~N");c$.jvxlDecodeBitSetRange=d(c$,"jvxlDecodeBitSetRange",
function(a,b,c){for(var e=new JU.BS,k=0,d=0,f=!1,g=u(1,0);-2147483648!=(k=J.jvxl.data.JvxlCoder.jvxlParseEncodedInt(a,b,c,g));)f&&e.setBits(d,d+k),d+=k,f=!f;return e},"~S,~N,~N");c$.jvxlParseEncodedInt=d(c$,"jvxlParseEncodedInt",function(a,b,c,e){var k=!1,d=0,f=e[0],g=a.length;if(0>f)return-2147483648;for(;f<g&&JU.PT.isWhitespace(a.charAt(f));)++f;if(f>=g)return-2147483648;var j=1,p=a.charCodeAt(f)==b+c;for(p&&f++;f<g&&!JU.PT.isWhitespace(a.charAt(f));){k=a.charCodeAt(f);k<b&&(k=92);d+=(k-b)*j;k=
!0;++f;if(!p)break;j*=c}k||(d=-2147483648);e[0]=f;return d},"~S,~N,~N,~A");c$.jvxlDecodeBitSet=d(c$,"jvxlDecodeBitSet",function(a){if(a.startsWith("-"))return J.jvxl.data.JvxlCoder.jvxlDecodeBitSetRange(J.jvxl.data.JvxlCoder.jvxlDecompressString(a.substring(1)),35,90);for(var b=new JU.BS,c=0,e=0,k=0,d=0,f=!1,g=u(1,0);;){c=0>k++?c:JU.PT.parseIntNext(a,g);if(-2147483648==c)break;0>c?(k=c,c=e):(f&&b.setBits(d,d+c),d+=c,e=c,f=!f)}return b},"~S");c$.jvxlCompressString=d(c$,"jvxlCompressString",function(a,
b){if(0<=a.indexOf("~"))return a;for(var c=new JU.SB,e="\x00",k=!1,d=!1,f=0,g=a.length,j=0;j<=g;j++){var p=j==g?"\x00":a.charAt(j);switch(p){case "\n":case "\r":continue;case "&":case "<":k=b;break;default:k=!1}if(p==e)++f,p="\x00";else if(0<f||d){if(4>f&&!d||" "==e||"\t"==e)for(;0<=--f;)c.appendC(e);else d?d=!1:c.appendC("~"),c.appendI(f),c.appendC(" ");f=0}"\x00"!=p&&(k?(d=!0,c.appendC("~"),e=p,p=String.fromCharCode(p.charCodeAt(0)-1)):e=p,c.appendC(p))}return c.toString()},"~S,~B");c$.jvxlDecompressString=
d(c$,"jvxlDecompressString",function(a){if(0>a.indexOf("~"))return a;for(var b=new JU.SB,c="\x00",e=u(1,0),k=0;k<a.length;k++){var d=a.charAt(k);if("~"==d)switch(e[0]=++k,d=a.charAt(k)){case ";":case "%":e[0]++,b.appendC(c=String.fromCharCode(d.charCodeAt(0)+1));case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":k=JU.PT.parseIntNext(a,e);for(d=0;d<k;d++)b.appendC(c);k=e[0];continue;case "~":--k;break;default:JU.Logger.error("Error uncompressing string "+a.substring(0,
k)+"?")}b.appendC(d);c=d}return b.toString()},"~S");c$.jvxlCreateHeaderWithoutTitleOrAtoms=d(c$,"jvxlCreateHeaderWithoutTitleOrAtoms",function(a,b){J.jvxl.data.JvxlCoder.jvxlCreateHeader(a,b)},"J.jvxl.data.VolumeData,JU.SB");c$.jvxlCreateHeader=d(c$,"jvxlCreateHeader",function(a,b){a.setVolumetricXml();0==b.length()&&b.append("Line 1\nLine 2\n")},"J.jvxl.data.VolumeData,JU.SB");Z(c$,"JVXL_VERSION1","2.0","JVXL_VERSION_XML","2.4","haveXMLUtil",!1,"CONTOUR_NPOLYGONS",0,"CONTOUR_BITSET",1,"CONTOUR_VALUE",
2,"CONTOUR_COLIX",3,"CONTOUR_COLOR",4,"CONTOUR_FDATA",5,"CONTOUR_POINTS",6,"defaultEdgeFractionBase",35,"defaultEdgeFractionRange",90,"defaultColorFractionBase",35,"defaultColorFractionRange",90)});O("J.jvxl.data");F(["JU.M3","$.P3","$.V3"],"J.jvxl.data.VolumeData",["java.lang.Float","java.util.Hashtable","JU.SB","JU.Escape","$.Logger"],function(){c$=H(function(){this.sr=null;this.doIterate=!0;this.voxelCounts=this.volumetricVectors=this.origin=this.volumetricOrigin=null;this.nPoints=0;this.volumetricVectorLengths=
this.voxelMap=this.voxelData=null;this.yzCount=this.minToPlaneDistance=this.maxVectorLength=0;this.thePlane=this.inverseMatrix=this.volumetricMatrix=this.unitVolumetricVectors=null;this.thePlaneNormalMag=0;this.mappingPlane=this.xmlData=this.ptXyzTemp=null;this.voxelVolume=this.maxGrid=this.minGrid=this.mappingPlaneNormalMag=0;this.oabc=null;this.isSquared=this.isPeriodic=!1;this.ptTemp=this.edgeVector=null;P(this,arguments)},J.jvxl.data,"VolumeData");ha(c$,function(){this.volumetricOrigin=new JU.P3;
this.origin=w(3,0);this.volumetricVectors=Array(3);this.voxelCounts=u(3,0);this.volumetricVectorLengths=w(3,0);this.unitVolumetricVectors=Array(3);this.volumetricMatrix=new JU.M3;this.inverseMatrix=new JU.M3;this.ptXyzTemp=new JU.P3;this.edgeVector=new JU.V3;this.ptTemp=new JU.P3});d(c$,"getVoxelData",function(){return this.voxelData});d(c$,"setVoxelDataAsArray",function(a){this.voxelData=a;null!=a&&(this.sr=null)},"~A");d(c$,"hasPlane",function(){return null!=this.thePlane});W(c$,function(){this.volumetricVectors[0]=
new JU.V3;this.volumetricVectors[1]=new JU.V3;this.volumetricVectors[2]=new JU.V3;this.unitVolumetricVectors[0]=new JU.V3;this.unitVolumetricVectors[1]=new JU.V3;this.unitVolumetricVectors[2]=new JU.V3});d(c$,"setMappingPlane",function(a){this.mappingPlane=a;null!=a&&(this.mappingPlaneNormalMag=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z))},"JU.P4");d(c$,"distanceToMappingPlane",function(a){return(this.mappingPlane.x*a.x+this.mappingPlane.y*a.y+this.mappingPlane.z*a.z+this.mappingPlane.w)/this.mappingPlaneNormalMag},
"JU.T3");d(c$,"setVolumetricOrigin",function(a,b,c){this.volumetricOrigin.set(a,b,c)},"~N,~N,~N");d(c$,"getOriginFloat",function(){return this.origin});d(c$,"getYzCount",function(){this.minGrid=this.volumetricVectors[0].length();this.minGrid=Math.min(this.minGrid,this.volumetricVectors[1].length());this.minGrid=Math.min(this.minGrid,this.volumetricVectors[2].length());this.maxGrid=this.volumetricVectors[0].length();this.maxGrid=Math.max(this.maxGrid,this.volumetricVectors[1].length());this.maxGrid=
Math.max(this.maxGrid,this.volumetricVectors[2].length());this.nPoints=this.voxelCounts[0]*this.voxelCounts[1]*this.voxelCounts[2];return this.yzCount=this.voxelCounts[1]*this.voxelCounts[2]});d(c$,"getVolumetricVectorLengths",function(){return this.volumetricVectorLengths});d(c$,"setVolumetricVector",function(a,b,c,e){this.volumetricVectors[a].x=b;this.volumetricVectors[a].y=c;this.volumetricVectors[a].z=e;this.setUnitVectors()},"~N,~N,~N,~N");d(c$,"getVoxelCounts",function(){return this.voxelCounts});
d(c$,"setVoxelCounts",function(a,b,c){this.voxelCounts[0]=a;this.voxelCounts[1]=b;this.voxelCounts[2]=c;return a*b*c},"~N,~N,~N");d(c$,"getVoxelDataAt",function(a){var b=D(a/this.yzCount);a-=b*this.yzCount;var c=D(a/this.voxelCounts[2]);return this.voxelData[b][c][a-c*this.voxelCounts[2]]},"~N");d(c$,"getPointIndex",function(a,b,c){return a*this.yzCount+b*this.voxelCounts[2]+c},"~N,~N,~N");d(c$,"getPoint",function(a,b){var c=D(a/this.yzCount);a-=c*this.yzCount;var e=D(a/this.voxelCounts[2]);this.voxelPtToXYZ(c,
e,a-e*this.voxelCounts[2],b)},"~N,JU.P3");d(c$,"setVoxelData",function(a,b){var c=D(a/this.yzCount);a-=c*this.yzCount;var e=D(a/this.voxelCounts[2]);this.voxelData[c][e][a-e*this.voxelCounts[2]]=b},"~N,~N");d(c$,"setVoxelMap",function(){this.voxelMap=new java.util.Hashtable;this.getYzCount()});d(c$,"setMatrix",function(){for(var a=0;3>a;a++)this.volumetricMatrix.setColumnV(a,this.volumetricVectors[a]);try{this.inverseMatrix.invertM(this.volumetricMatrix)}catch(b){if(Y(b,Exception))return JU.Logger.error("VolumeData error setting matrix -- bad unit vectors? "),
!1;throw b;}return!0});d(c$,"transform",function(a,b){this.volumetricMatrix.rotate2(a,b)},"JU.V3,JU.V3");d(c$,"setPlaneParameters",function(a){this.thePlane=a;this.thePlaneNormalMag=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)},"JU.P4");d(c$,"calcVoxelPlaneDistance",function(a,b,c){this.voxelPtToXYZ(a,b,c,this.ptXyzTemp);return this.distancePointToPlane(this.ptXyzTemp)},"~N,~N,~N");d(c$,"getToPlaneParameter",function(){return Math.sqrt(this.thePlane.x*this.thePlane.x+this.thePlane.y*this.thePlane.y+this.thePlane.z*
this.thePlane.z)*this.minToPlaneDistance});d(c$,"isNearPlane",function(a,b,c,e){this.voxelPtToXYZ(a,b,c,this.ptXyzTemp);return this.thePlane.x*this.ptXyzTemp.x+this.thePlane.y*this.ptXyzTemp.y+this.thePlane.z*this.ptXyzTemp.z+this.thePlane.w<e},"~N,~N,~N,~N");d(c$,"distancePointToPlane",function(a){return(this.thePlane.x*a.x+this.thePlane.y*a.y+this.thePlane.z*a.z+this.thePlane.w)/this.thePlaneNormalMag},"JU.T3");d(c$,"voxelPtToXYZ",function(a,b,c,e){e.scaleAdd2(a,this.volumetricVectors[0],this.volumetricOrigin);
e.scaleAdd2(b,this.volumetricVectors[1],e);e.scaleAdd2(c,this.volumetricVectors[2],e)},"~N,~N,~N,JU.T3");d(c$,"setUnitVectors",function(){this.maxVectorLength=0;this.voxelVolume=1;for(var a=0;3>a;a++){var b=this.volumetricVectorLengths[a]=this.volumetricVectors[a].length();if(0==b)return!1;b>this.maxVectorLength&&(this.maxVectorLength=b);this.voxelVolume*=b;this.unitVolumetricVectors[a].setT(this.volumetricVectors[a]);this.unitVolumetricVectors[a].normalize()}this.minToPlaneDistance=2*this.maxVectorLength;
this.origin[0]=this.volumetricOrigin.x;this.origin[1]=this.volumetricOrigin.y;this.origin[2]=this.volumetricOrigin.z;this.oabc=Array(4);this.oabc[0]=JU.V3.newV(this.volumetricOrigin);for(a=0;3>a;a++)b=this.oabc[a+1]=new JU.V3,b.scaleAdd2(this.voxelCounts[a]-1,this.volumetricVectors[a],b);return this.setMatrix()});d(c$,"xyzToVoxelPt",function(a,b,c,e){this.ptXyzTemp.set(a,b,c);this.ptXyzTemp.sub(this.volumetricOrigin);this.inverseMatrix.rotate(this.ptXyzTemp);e.set(Math.round(this.ptXyzTemp.x),Math.round(this.ptXyzTemp.y),
Math.round(this.ptXyzTemp.z))},"~N,~N,~N,JU.T3i");d(c$,"lookupInterpolatedVoxelValue",function(a,b){if(null!=this.mappingPlane)return this.distanceToMappingPlane(a);if(null!=this.sr){var c=this.sr.getValueAtPoint(a,b);return this.isSquared?c*c:c}this.ptXyzTemp.sub2(a,this.volumetricOrigin);this.inverseMatrix.rotate(this.ptXyzTemp);var e,d=this.indexLower(this.ptXyzTemp.x,e=this.voxelCounts[0]-1),h=this.indexUpper(this.ptXyzTemp.x,d,e),f=this.indexLower(this.ptXyzTemp.y,e=this.voxelCounts[1]-1),g=
this.indexUpper(this.ptXyzTemp.y,f,e),c=this.indexLower(this.ptXyzTemp.z,e=this.voxelCounts[2]-1),j=this.indexUpper(this.ptXyzTemp.z,c,e);e=J.jvxl.data.VolumeData.getFractional2DValue(this.mantissa(this.ptXyzTemp.x-d),this.mantissa(this.ptXyzTemp.y-f),this.getVoxelValue(d,f,c),this.getVoxelValue(h,f,c),this.getVoxelValue(d,g,c),this.getVoxelValue(h,g,c));d=J.jvxl.data.VolumeData.getFractional2DValue(this.mantissa(this.ptXyzTemp.x-d),this.mantissa(this.ptXyzTemp.y-f),this.getVoxelValue(d,f,j),this.getVoxelValue(h,
f,j),this.getVoxelValue(d,g,j),this.getVoxelValue(h,g,j));return e+this.mantissa(this.ptXyzTemp.z-c)*(d-e)},"JU.T3,~B");d(c$,"mantissa",function(a){return this.isPeriodic?a-Math.floor(a):a},"~N");d(c$,"getVoxelValue",function(a,b,c){if(null==this.voxelMap)return this.voxelData[a][b][c];a=this.voxelMap.get(Integer.$valueOf(this.getPointIndex(a,b,c)));return null==a?NaN:a.floatValue()},"~N,~N,~N");c$.getFractional2DValue=d(c$,"getFractional2DValue",function(a,b,c,e,d,h){c+=a*(e-c);return c+b*(d+a*(h-
d)-c)},"~N,~N,~N,~N,~N,~N");d(c$,"indexLower",function(a,b){if(this.isPeriodic&&0<b){for(;0>a;)a+=b;for(;a>=b;)a-=b;return D(Math.floor(a))}if(0>a)return 0;var c=D(Math.floor(a));return c>b?b:c},"~N,~N");d(c$,"indexUpper",function(a,b,c){return!this.isPeriodic&&0>a||b==c?b:b+1},"~N,~N,~N");d(c$,"offsetCenter",function(a){var b=new JU.P3;b.scaleAdd2((this.voxelCounts[0]-1)/2,this.volumetricVectors[0],b);b.scaleAdd2((this.voxelCounts[1]-1)/2,this.volumetricVectors[1],b);b.scaleAdd2((this.voxelCounts[2]-
1)/2,this.volumetricVectors[2],b);this.volumetricOrigin.sub2(a,b)},"JU.P3");d(c$,"setDataDistanceToPlane",function(a){this.setPlaneParameters(a);a=this.voxelCounts[0];var b=this.voxelCounts[1],c=this.voxelCounts[2];this.voxelData=w(a,b,c,0);for(var e=0;e<a;e++)for(var d=0;d<b;d++)for(var h=0;h<c;h++)this.voxelData[e][d][h]=this.calcVoxelPlaneDistance(e,d,h)},"JU.P4");d(c$,"filterData",function(a,b){var c=!Float.isNaN(b);if(null!=this.sr)this.isSquared=a;else{var e=this.voxelCounts[0],d=this.voxelCounts[1],
h=this.voxelCounts[2];if(a)for(var f=0;f<e;f++)for(var g=0;g<d;g++)for(var j=0;j<h;j++)this.voxelData[f][g][j]*=this.voxelData[f][g][j];if(c)for(f=0;f<e;f++)for(g=0;g<d;g++)for(j=0;j<h;j++)this.voxelData[f][g][j]=b-this.voxelData[f][g][j]}},"~B,~N");d(c$,"capData",function(a,b){if(null!=this.voxelData){var c=this.voxelCounts[0],e=this.voxelCounts[1],d=this.voxelCounts[2],h=JU.V3.new3(a.x,a.y,a.z);h.normalize();for(var f=0;f<c;f++)for(var g=0;g<e;g++)for(var j=0;j<d;j++){var p=this.voxelData[f][g][j]-
b;this.voxelPtToXYZ(f,g,j,this.ptXyzTemp);var l=(this.ptXyzTemp.x*h.x+this.ptXyzTemp.y*h.y+this.ptXyzTemp.z*h.z+a.w-b)/1;if(0<=l||l>p)this.voxelData[f][g][j]=l}}},"JU.P4,~N");d(c$,"setVolumetricXml",function(){var a=new JU.SB;if(0==this.voxelCounts[0])a.append("<jvxlVolumeData>\n");else{a.append('<jvxlVolumeData origin="'+JU.Escape.eP(this.volumetricOrigin)+'">\n');for(var b=0;3>b;b++)a.append('<jvxlVolumeVector type="'+b+'" count="'+this.voxelCounts[b]+'" vector="'+JU.Escape.eP(this.volumetricVectors[b])+
'"></jvxlVolumeVector>\n')}a.append("</jvxlVolumeData>\n");return this.xmlData=a.toString()});d(c$,"setVoxelMapValue",function(a,b,c,e){null!=this.voxelMap&&this.voxelMap.put(Integer.$valueOf(this.getPointIndex(a,b,c)),Float.$valueOf(e))},"~N,~N,~N,~N");d(c$,"calculateFractionalPoint",function(a,b,c,e,d,h){var f=d-e,g=(a-e)/f;this.edgeVector.sub2(c,b);h.scaleAdd2(g,this.edgeVector,b);if(null==this.sr||!this.doIterate||d==e||0.01>g||0.99<g||0.01>this.edgeVector.length())return a;b=0;this.ptTemp.setT(h);
c=this.lookupInterpolatedVoxelValue(this.ptTemp,!1);for(d=NaN;10>++b;){var j=(c-e)/f;if(0>j||1<j)break;j=(a-c)/f/2;g+=j;if(0>g||1<g)break;h.setT(this.ptTemp);d=c;if(0.005>Math.abs(j))break;this.ptTemp.scaleAdd2(j,this.edgeVector,h);c=this.lookupInterpolatedVoxelValue(this.ptTemp,!1)}return d},"~N,JU.P3,JU.P3,~N,~N,JU.P3")});O("J.jvxl.data");F(null,"J.jvxl.data.JvxlData",["java.lang.Float","JU.SB","J.jvxl.data.JvxlCoder"],function(){c$=H(function(){this.msg="";this.wasCubic=this.wasJvxl=!1;this.jvxlPlane=
this.jvxlExcluded=this.jvxlVolumeDataXml=this.jvxlColorData=this.jvxlEdgeData=this.jvxlSurfaceData=this.jvxlFileMessage=this.jvxlFileTitle=this.jvxlFileSource=null;this.isColorReversed=this.jvxlDataIsColorDensity=this.jvxlDataIs2dContour=this.jvxlDataIsColorMapped=this.isJvxlPrecisionColor=!1;this.thisSet=null;this.edgeFractionBase=35;this.edgeFractionRange=90;this.colorFractionBase=35;this.colorFractionRange=90;this.isValid=!0;this.vertexDataOnly=this.isModelConnected=this.isCutoffAbsolute=this.isTruncated=
this.isBicolorMap=this.isContoured=this.isXLowToHigh=this.insideOut=!1;this.cutoff=this.valueMappedToBlue=this.valueMappedToRed=this.mappedDataMax=this.mappedDataMin=0;this.cutoffRange=null;this.vertexCount=this.nSurfaceInts=this.nEdges=this.nContours=this.nBytes=this.nPointsZ=this.nPointsY=this.nPointsX=this.pointsPerAngstrom=0;this.contourValuesUsed=this.contourValues=this.contourColors=this.contourColixes=this.vContours=null;this.thisContour=-1;this.scale3d=0;this.minColorIndex=-1;this.maxColorIndex=
0;this.boundingBox=this.version=this.title=null;this.excludedVertexCount=this.excludedTriangleCount=0;this.colorDensity=!1;this.pointSize=0;this.moleculeXml=null;this.saveVertexCount=this.dataMax=this.dataMin=0;this.vertexColorMap=null;this.nVertexColors=0;this.meshColor=this.color=this.vertexColors=null;this.translucency=0;this.rendering=this.colorScheme=null;this.slabValue=-2147483648;this.isSlabbable=!1;this.diameter=0;this.slabInfo=null;this.allowVolumeRender=!1;this.voxelVolume=0;this.baseColor=
this.fixedLattice=this.mapLattice=null;this.integration=NaN;this.sbOut=null;P(this,arguments)},J.jvxl.data,"JvxlData");ha(c$,function(){this.jvxlExcluded=Array(4)});W(c$,function(){});d(c$,"clear",function(){this.allowVolumeRender=!0;this.jvxlVolumeDataXml=this.jvxlColorData=this.jvxlEdgeData=this.jvxlSurfaceData="";this.colorScheme=this.color=null;this.colorDensity=!1;this.pointSize=NaN;this.contourColors=this.contourColixes=this.contourValuesUsed=this.contourValues=null;this.integration=NaN;this.isSlabbable=
!1;this.isValid=!0;this.meshColor=this.mapLattice=null;this.msg="";this.nVertexColors=this.nPointsX=0;this.slabInfo=this.fixedLattice=null;this.slabValue=-2147483648;this.rendering=this.thisSet=null;this.thisContour=-1;this.translucency=0;this.vertexColors=this.vertexColorMap=this.vContours=null;this.voxelVolume=0});d(c$,"setSurfaceInfo",function(a,b,c,e){this.jvxlSurfaceData=e;this.jvxlPlane=a;this.mapLattice=b;this.nSurfaceInts=c},"JU.P4,JU.P3,~N,~S");d(c$,"setSurfaceInfoFromBitSet",function(a,
b){this.setSurfaceInfoFromBitSetPts(a,b,null)},"JU.BS,JU.P4");d(c$,"setSurfaceInfoFromBitSetPts",function(a,b,c){var e=new JU.SB;a=null!=b?0:J.jvxl.data.JvxlCoder.jvxlEncodeBitSetBuffer(a,this.nPointsX*this.nPointsY*this.nPointsZ,e);this.setSurfaceInfo(b,c,a,e.toString())},"JU.BS,JU.P4,JU.P3");d(c$,"jvxlUpdateInfo",function(a,b){this.title=a;this.nBytes=b},"~A,~N");c$.updateSurfaceData=d(c$,"updateSurfaceData",function(a,b,c,e,d){if(0==a.length)return"";a=a.toCharArray();for(var h=0,f=0;h<c;h+=e,
f++)Float.isNaN(b[h])&&(a[f]=d);return String.copyValueOf(a)},"~S,~A,~N,~N,~S")});O("J.jvxl.data");F(["JU.MeshSurface"],"J.jvxl.data.MeshData","java.lang.Float java.util.Arrays JU.AU $.BS $.V3 JU.BSUtil".split(" "),function(){c$=H(function(){this.setsSuccessful=!1;this.vertexIncrement=1;this.polygonColorData=null;va("J.jvxl.data.MeshData.SSet")||J.jvxl.data.MeshData.$MeshData$SSet$();va("J.jvxl.data.MeshData.SortSet")||J.jvxl.data.MeshData.$MeshData$SortSet$();P(this,arguments)},J.jvxl.data,"MeshData",
JU.MeshSurface);d(c$,"addVertexCopy",function(a,b,c,e){0>c&&(this.vertexIncrement=-c);return this.addVCVal(a,b,e)},"JU.T3,~N,~N,~B");d(c$,"getSurfaceSet",function(){return null==this.surfaceSet?this.getSurfaceSetForLevel(0):this.surfaceSet});d(c$,"getSurfaceSetForLevel",function(a){0==a&&(this.surfaceSet=Array(100),this.nSets=0);this.setsSuccessful=!0;for(var b=0;b<this.pc;b++)if(null!=this.pis[b]&&(null==this.bsSlabDisplay||this.bsSlabDisplay.get(b))){var c=this.pis[b],e=this.findSet(c[0]),d=this.findSet(c[1]),
h=this.findSet(c[2]);0>e&&0>d&&0>h?this.createSet(c[0],c[1],c[2]):e==d&&d==h||(0<=e?(this.surfaceSet[e].set(c[1]),this.surfaceSet[e].set(c[2]),0<=d&&d!=e&&this.mergeSets(e,d),0<=h&&(h!=e&&h!=d)&&this.mergeSets(e,h)):0<=d?(this.surfaceSet[d].set(c[0]),this.surfaceSet[d].set(c[2]),0<=h&&h!=d&&this.mergeSets(d,h)):(this.surfaceSet[h].set(c[0]),this.surfaceSet[h].set(c[1])))}for(b=c=0;b<this.nSets;b++)null!=this.surfaceSet[b]&&c++;e=Array(this.surfaceSet.length);for(b=c=0;b<this.nSets;b++)null!=this.surfaceSet[b]&&
(e[c++]=this.surfaceSet[b]);this.nSets=c;this.surfaceSet=e;!this.setsSuccessful&&2>a&&this.getSurfaceSetForLevel(a+1);if(0==a){a=Array(this.nSets);for(b=0;b<this.nSets;b++)a[b]=ta(J.jvxl.data.MeshData.SSet,this,null,this.surfaceSet[b]);java.util.Arrays.sort(a,ta(J.jvxl.data.MeshData.SortSet,this,null));for(b=0;b<this.nSets;b++)this.surfaceSet[b]=a[b].bs;this.setVertexSets(!1)}return this.surfaceSet},"~N");d(c$,"setVertexSets",function(a){if(null!=this.surfaceSet){for(var b=0,c=0;c<this.nSets;c++)null!=
this.surfaceSet[c]&&0>this.surfaceSet[c].nextSetBit(0)&&(this.surfaceSet[c]=null),null==this.surfaceSet[c]&&b++;if(0<b){a=Array(this.nSets-b);for(var e=c=0;c<this.nSets;c++)null!=this.surfaceSet[c]&&(a[e++]=this.surfaceSet[c]);this.surfaceSet=a;this.nSets-=b}else if(a)return;this.vertexSets=u(this.vc,0);for(c=0;c<this.nSets;c++)for(b=this.surfaceSet[c].nextSetBit(0);0<=b;b=this.surfaceSet[c].nextSetBit(b+1))this.vertexSets[b]=c}},"~B");d(c$,"findSet",function(a){for(var b=0;b<this.nSets;b++)if(null!=
this.surfaceSet[b]&&this.surfaceSet[b].get(a))return b;return-1},"~N");d(c$,"createSet",function(a,b,c){var e;for(e=0;e<this.nSets&&null!=this.surfaceSet[e];e++);e==this.surfaceSet.length&&(this.surfaceSet=JU.AU.ensureLength(this.surfaceSet,this.surfaceSet.length+100));this.surfaceSet[e]=new JU.BS;this.surfaceSet[e].set(a);this.surfaceSet[e].set(b);this.surfaceSet[e].set(c);e==this.nSets&&this.nSets++},"~N,~N,~N");d(c$,"mergeSets",function(a,b){this.surfaceSet[a].or(this.surfaceSet[b]);this.surfaceSet[b]=
null},"~N,~N");d(c$,"invalidateSurfaceSet",function(a){for(var b=this.surfaceSet[a].nextSetBit(0);0<=b;b=this.surfaceSet[a].nextSetBit(b+1))this.vvs[b]=NaN;this.surfaceSet[a]=null},"~N");c$.checkCutoff=d(c$,"checkCutoff",function(a,b,c,e){if(0>a||0>b||0>c)return!1;a=e[a];b=e[b];c=e[c];return 0<=a&&0<=b&&0<=c||0>=a&&0>=b&&0>=c},"~N,~N,~N,~A");c$.calculateVolumeOrArea=d(c$,"calculateVolumeOrArea",function(a,b,c,e){(e||0>=a.nSets)&&a.getSurfaceSet();var d=null!=b&&1==b.cardinality(),h=d||0>=a.nSets?
1:a.nSets;e=Ja(h,0);for(var f=new JU.V3,g=new JU.V3,j=new JU.V3,p=a.pc;0<=--p;)if(null!=a.setABC(p)){var l=0>=a.nSets?0:a.vertexSets[a.iA];if(null==b||b.get(l))c?(f.sub2(a.vs[a.iB],a.vs[a.iA]),g.sub2(a.vs[a.iC],a.vs[a.iA]),j.cross(f,g),e[d?0:l]+=j.length()):(f.setT(a.vs[a.iB]),g.setT(a.vs[a.iC]),j.cross(f,g),g.setT(a.vs[a.iA]),e[d?0:l]+=g.dot(j))}a=c?2:6;for(p=0;p<h;p++)e[p]/=a;if(d)return Float.$valueOf(e[0]);if(null!=b){b.and(JU.BSUtil.newBitSet2(0,e.length));a=Ja(b.cardinality(),0);c=0;for(p=b.nextSetBit(0);0<=
p;p=b.nextSetBit(p+1))a[c++]=e[p];e=a}return e},"J.jvxl.data.MeshData,JU.BS,~B,~B");d(c$,"updateInvalidatedVertices",function(a){a.clearAll();for(var b=0;b<this.vc;b+=this.vertexIncrement)Float.isNaN(this.vvs[b])&&a.set(b)},"JU.BS");d(c$,"invalidateVertices",function(a){for(var b=a.nextSetBit(0);0<=b;b=a.nextSetBit(b+1))this.vvs[b]=NaN},"JU.BS");c$.$MeshData$SSet$=function(){na(self.c$);c$=H(function(){ua(this,arguments);this.bs=null;this.n=0;P(this,arguments)},J.jvxl.data.MeshData,"SSet");W(c$,function(a){this.bs=
a;this.n=a.cardinality()},"JU.BS");c$=ma()};c$.$MeshData$SortSet$=function(){na(self.c$);c$=H(function(){ua(this,arguments);P(this,arguments)},J.jvxl.data.MeshData,"SortSet",null,java.util.Comparator);m(c$,"compare",function(a,b){return a.n>b.n?-1:a.n<b.n?1:0},"J.jvxl.data.MeshData.SSet,J.jvxl.data.MeshData.SSet");c$=ma()};Z(c$,"MODE_GET_VERTICES",1,"MODE_GET_COLOR_INDEXES",2,"MODE_PUT_SETS",3,"MODE_PUT_VERTICES",4)});O("J.jvxl.readers");F(null,"J.jvxl.readers.XmlReader",["JU.P3","$.PT","$.SB","JU.Escape"],
function(){c$=H(function(){this.line=this.br=null;P(this,arguments)},J.jvxl.readers,"XmlReader");d(c$,"getLine",function(){return this.line});W(c$,function(a){this.br=a},"java.io.BufferedReader");d(c$,"toTag",function(a){this.skipTo("<"+a);if(null==this.line)return"";var b=this.line.indexOf("<"+a)+a.length+1;if(b==this.line.length||" "==this.line.charAt(b)||">"==this.line.charAt(b))return this.line;this.line=null;return this.toTag(a)},"~S");d(c$,"skipTag",function(a){this.skipTo("</"+a+">")},"~S");
d(c$,"getXmlData",function(a,b,c,e){return this.getXmlDataLF(a,b,c,e,!1)},"~S,~S,~B,~B");d(c$,"getXmlDataLF",function(a,b,c,e,d){var h="</"+a+">";a="<"+a;if(null==b){b=new JU.SB;try{null==this.line&&(this.line=this.br.readLine());for(;0>this.line.indexOf(a);)this.line=this.br.readLine()}catch(f){if(Y(f,Exception))return null;throw f;}b.append(this.line);d&&b.append("\n");var g=!1,j=this.line.indexOf("/>"),p=this.line.indexOf(">");if(0>p||j==p-1)g=e;for(;0>this.line.indexOf(h)&&(!g||0>this.line.indexOf("/>"));)b.append(this.line=
this.br.readLine()),d&&b.append("\n");b=b.toString()}return J.jvxl.readers.XmlReader.extractTag(b,a,h,c)},"~S,~S,~B,~B,~B");c$.extractTagOnly=d(c$,"extractTagOnly",function(a,b){return J.jvxl.readers.XmlReader.extractTag(a,"<"+b+">","</"+b+">",!1)},"~S,~S");c$.extractTag=d(c$,"extractTag",function(a,b,c,e){b=a.indexOf(b);if(0>b)return"";var d=a.indexOf(c,b);0>d&&(d=a.indexOf("/>",b),c="/>");if(0>d)return"";if(e)return d+=c.length,a.substring(b,d);for(c=!1;b<d;b++)if('"'==(e=a.charAt(b)))c=!c;else if(c&&
"\\"==e)b++;else if(!c&&(">"==e||"/"==e))break;if(b>=d)return"";for(;JU.PT.isWhitespace(a.charAt(++b)););return J.jvxl.readers.XmlReader.unwrapCdata(a.substring(b,d))},"~S,~S,~S,~B");c$.unwrapCdata=d(c$,"unwrapCdata",function(a){return a.startsWith("<![CDATA[")&&a.endsWith("]]\x3e")?JU.PT.rep(a.substring(9,a.length-3),"]]]]\x3e<![CDATA[>","]]\x3e"):a},"~S");c$.getXmlAttrib=d(c$,"getXmlAttrib",function(a,b){var c=u(1,0),e=J.jvxl.readers.XmlReader.setNext(a,b,c,1);if(2>e||2>(e=J.jvxl.readers.XmlReader.setNext(a,
'"',c,0)))return"";c=J.jvxl.readers.XmlReader.setNext(a,'"',c,-1);return 0>=c?"":a.substring(e,c)},"~S,~S");d(c$,"getXmlPoint",function(a,b){var c=J.jvxl.readers.XmlReader.getXmlAttrib(a,b).$replace("(","{").$replace(")","}"),c=JU.Escape.uP(c);return T(c,JU.P3)?c:new JU.P3},"~S,~S");c$.setNext=d(c$,"setNext",function(a,b,c,e){var d=c[0];if(0>d||0>(d=a.indexOf(b,c[0])))return-1;d+=b.length;c[0]=d+e;return 0<e&&d<a.length&&"="!=a.charAt(d)?J.jvxl.readers.XmlReader.setNext(a,b,c,e):c[0]},"~S,~S,~A,~N");
d(c$,"skipTo",function(a){null==this.line&&(this.line=this.br.readLine());for(;null!=this.line&&0>this.line.indexOf(a);)this.line=this.br.readLine()},"~S");d(c$,"isNext",function(a){if(null==this.line||0<=this.line.indexOf("</")&&this.line.indexOf("</")==this.line.indexOf("<"))this.line=this.br.readLine();return 0<=this.line.indexOf("<"+a)},"~S")});O("J.jvxl.readers");F(["JU.P3","$.V3"],"J.jvxl.readers.SurfaceGenerator","java.lang.Float java.util.Map JU.AU $.BS $.Measure $.P4 $.PT $.Rdr $.SB J.jvxl.data.JvxlCoder $.JvxlData $.MeshData $.VolumeData J.jvxl.readers.Parameters $.SurfaceReader JU.Logger JV.FileManager".split(" "),
function(){c$=H(function(){this.version=this.marchingSquares=this.atomDataServer=this.meshDataServer=this.volumeDataTemp=this.meshData=this.jvxlData=this.params=null;this.isValid=!0;this.bsVdw=this.fileType=null;this.colorPtr=0;this.ptRef=this.vNorm=this.vAB=this.readerData=this.out=this.surfaceReader=null;P(this,arguments)},J.jvxl.readers,"SurfaceGenerator");ha(c$,function(){this.vAB=new JU.V3;this.vNorm=new JU.V3;this.ptRef=JU.P3.new3(0,0,1E15)});W(c$,function(a,b,c,e){this.atomDataServer=a;this.meshDataServer=
b;this.params=new J.jvxl.readers.Parameters;this.meshData=null==c?new J.jvxl.data.MeshData:c;this.jvxlData=null==e?new J.jvxl.data.JvxlData:e;this.volumeDataTemp=new J.jvxl.data.VolumeData;this.initializeIsosurface()},"J.atomdata.AtomDataServer,J.jvxl.api.MeshDataServer,J.jvxl.data.MeshData,J.jvxl.data.JvxlData");d(c$,"setJvxlData",function(a){this.jvxlData=a;null!=a&&(a.version=this.version)},"J.jvxl.data.JvxlData");d(c$,"setProp",function(a,b){if("debug"===a){var c=b.booleanValue();this.params.logMessages=
c;this.params.logCube=c;return!0}if("init"===a)return this.initializeIsosurface(),T(b,J.jvxl.readers.Parameters)?this.params=b:(this.params.script=b,null!=this.params.script&&0<=this.params.script.indexOf(";#")&&(this.params.script=JU.PT.rep(this.params.script,";#","; #"))),!1;if("silent"===a)return this.params.isSilent=!0;if("map"===a)return this.params.resetForMapping(b.booleanValue()),null!=this.surfaceReader&&(this.surfaceReader.minMax=null),!0;if("finalize"===a)return this.initializeIsosurface(),
!0;if("clear"===a)return null!=this.surfaceReader&&this.surfaceReader.discardTempData(!0),!1;if("fileIndex"===a)return this.params.fileIndex=b.intValue(),0>this.params.fileIndex&&(this.params.fileIndex=0),this.params.readAllData=!1,!0;if("blockData"===a)return this.params.blockCubeData=b.booleanValue(),!0;if("withinPoints"===a)return this.params.boundingBox=b[1],!0;if("boundingBox"===a)return this.params.boundingBox=B(-1,[JU.P3.newP(b[0]),JU.P3.newP(b[b.length-1])]),!0;if("func"===a)return this.params.func=
b,!0;if("intersection"===a)return this.params.intersection=b,!0;if("bsSolvent"===a)return this.params.bsSolvent=b,!0;if("select"===a)return this.params.bsSelected=b,!0;if("ignore"===a)return this.params.bsIgnore=b,!0;if("propertySmoothing"===a)return this.params.propertySmoothing=b.booleanValue(),!0;if("propertyDistanceMax"===a)return this.params.propertyDistanceMax=b.floatValue(),!0;if("propertySmoothingPower"===a)return this.params.propertySmoothingPower=b.intValue(),!0;if("title"===a){if(null==
b)this.params.title=null;else if(JU.AU.isAS(b)&&(this.params.title=b,JU.Logger.debugging))for(var e=0;e<this.params.title.length;e++)0<this.params.title[e].length&&JU.Logger.info(this.params.title[e]);return!0}if("sigma"===a)return this.params.cutoff=this.params.sigma=b.floatValue(),this.params.cutoffRange=null,this.params.cutoffAutomatic=!1,!0;if("cutoff"===a)return this.params.cutoff=b.floatValue(),this.params.cutoffRange=null,this.params.isPositiveOnly=!1,this.params.cutoffAutomatic=!1,!0;if("cutoffPositive"===
a)return this.params.cutoff=b.floatValue(),this.params.cutoffRange=null,this.params.isPositiveOnly=!0,this.params.isCutoffAbsolute=!1,this.params.cutoffAutomatic=!1,!0;if("cutoffRange"===a)return this.params.cutoffRange=b,this.params.cutoff=this.params.cutoffRange[0],this.params.isPositiveOnly=!1,this.params.cutoffAutomatic=!1,!0;if("parameters"===a)return this.params.parameters=JU.AU.ensureLengthA(b,2),0<this.params.parameters.length&&0!=this.params.parameters[0]&&(this.params.cutoff=this.params.parameters[0]),
!0;if("cap"===a||"slab"===a)return null!=b&&this.params.addSlabInfo(b),!0;if("scale"===a)return this.params.scale=b.floatValue(),!0;if("scale3d"===a)return this.params.scale3d=b.floatValue(),!0;if("angstroms"===a)return this.params.isAngstroms=!0;if("resolution"===a)return c=b.floatValue(),this.params.resolution=0<c?c:3.4028235E38,!0;if("downsample"===a)return c=b.intValue(),this.params.downsampleFactor=0<=c?c:0,!0;if("anisotropy"===a)return 0==(this.params.dataType&32)&&this.params.setAnisotropy(b),
!0;if("eccentricity"===a)return this.params.setEccentricity(b),!0;if("addHydrogens"===a)return this.params.addHydrogens=b.booleanValue(),!0;if("squareData"===a)return this.params.isSquared=null==b?!1:b.booleanValue(),!0;if("squareLinear"===a)return this.params.isSquaredLinear=null==b?!1:b.booleanValue(),!0;if("gridPoints"===a)return this.params.iAddGridPoints=!0;if("atomIndex"===a)return this.params.atomIndex=b.intValue(),!0;if("insideOut"===a)return this.params.insideOut=!0;if("sign"===a)return this.params.isCutoffAbsolute=
!this.params.isPositiveOnly,this.params.colorBySign=!0,this.colorPtr=0,!0;if("colorRGB"===a)return c=b.intValue(),this.params.colorRgb=this.params.colorPos=this.params.colorPosLCAO=c,0==this.colorPtr++?this.params.colorNeg=this.params.colorNegLCAO=c:this.params.colorRgb=2147483647,!0;if("monteCarloCount"===a)return this.params.psi_monteCarloCount=b.intValue(),!0;if("rangeAll"===a)return this.params.rangeAll=!0;if("rangeSelected"===a)return this.params.rangeSelected=!0;if("red"===a)return this.params.valueMappedToRed=
b.floatValue(),!0;if("blue"===a)return this.params.valueMappedToBlue=b.floatValue(),this.params.valueMappedToRed>this.params.valueMappedToBlue&&(c=this.params.valueMappedToRed,this.params.valueMappedToRed=this.params.valueMappedToBlue,this.params.valueMappedToBlue=c,this.params.isColorReversed=!this.params.isColorReversed),this.params.rangeDefined=!0,this.params.rangeAll=!1,!0;if("reverseColor"===a)return this.params.isColorReversed=!0;if("setColorScheme"===a)return this.getSurfaceSets(),this.params.colorBySets=
!0,this.mapSurface(),!0;if("center"===a)return this.params.center.setT(b),!0;if("origin"===a)return this.params.origin=b,!0;if("step"===a)return this.params.steps=b,!0;if("modelInvRotation"===a)return this.params.modelInvRotation=b,!0;if("point"===a)return this.params.points=b,!0;if("withinDistance"===a)return this.params.distance=b.floatValue(),!0;if("withinPoint"===a)return this.params.point=b,!0;if("progressive"===a)return this.params.isXLowToHigh=!0;if("phase"===a)return this.params.isCutoffAbsolute=
!0,this.params.colorBySign=!0,this.params.colorByPhase=!0,this.params.colorPhase=J.jvxl.readers.SurfaceReader.getColorPhaseIndex(b),0>this.params.colorPhase&&(JU.Logger.warn(" invalid color phase: "+b),this.params.colorPhase=0),this.params.colorByPhase=0!=this.params.colorPhase,2<=this.params.state&&(this.params.dataType=this.params.surfaceType,this.params.state=3,this.params.isBicolorMap=!0,this.surfaceReader.applyColorScale()),!0;if("radius"===a)return JU.Logger.info("solvent probe radius set to "+
b),this.params.atomRadiusData=b,!0;if("envelopeRadius"===a)return this.params.envelopeRadius=b.floatValue(),!0;if("cavityRadius"===a)return this.params.cavityRadius=b.floatValue(),!0;if("cavity"===a)return this.params.isCavity=!0;if("doFullMolecular"===a)return this.params.doFullMolecular=!0;if("pocket"===a)return this.params.pocket=b,this.params.fullyLit=this.params.pocket.booleanValue(),!0;if("minset"===a)return this.params.minSet=b.intValue(),!0;if("maxset"===a)return this.params.maxSet=b.intValue(),
!0;if("plane"===a)return this.params.setPlane(b),!0;if("contour"===a){this.params.isContoured=!0;if(JU.AU.isAF(b))this.params.contoursDiscrete=b,this.params.nContours=this.params.contoursDiscrete.length;else if(T(b,JU.P3)){var c=this.params.contourIncrements=b,e=c.x,d=c.y,h=c.z;0>=h&&(h=1);for(var c=0,f=e;f<=d+h/10;f+=h,c++);this.params.contoursDiscrete=w(c,0);f=e;for(e=0;e<c;e++,f+=h)this.params.contoursDiscrete[e]=f;this.params.nContours=c}else c=b.intValue(),this.params.thisContour=0,0==c?this.params.nContours=
9:0<c?this.params.nContours=c:this.params.thisContour=-c;return!0}if("colorDiscrete"===a)return this.params.contourColixes=b,!0;if("colorDensity"===a)return this.params.colorDensity=!0,null!=b&&(this.params.pointSize=b.floatValue()),!1;if("fullPlane"===a)return this.params.contourFromZero=!b.booleanValue(),!0;if("mapLattice"===a)return this.params.mapLattice=b,!0;if("extendGrid"===a)return this.params.extendGrid=b.floatValue(),!0;if("property"===a)return this.params.dataType=1208,this.params.theProperty=
b,this.mapSurface(),!0;if("sphere"===a)return this.params.setSphere(b.floatValue(),!1),this.readerData=Float.$valueOf(this.params.distance),this.surfaceReader=this.newReader("IsoShapeReader"),this.generateSurface(),!0;if("geodesic"===a)return this.params.setSphere(b.floatValue(),!0),this.readerData=Float.$valueOf(this.params.distance),this.surfaceReader=this.newReader("IsoShapeReader"),this.generateSurface(),!0;if("ellipsoid"===a){if(T(b,JU.P4))this.params.setEllipsoidP4(b);else if(JU.AU.isAF(b))this.params.setEllipsoidAF(b);
else return!0;this.readerData=Float.$valueOf(this.params.distance);this.surfaceReader=this.newReader("IsoShapeReader");this.generateSurface();return!0}if("ellipsoid3"===a)return this.params.setEllipsoidAF(b),this.readerData=Float.$valueOf(this.params.distance),this.surfaceReader=this.newReader("IsoShapeReader"),this.generateSurface(),!0;if("lp"===a)return this.params.setLp(b),this.readerData=w(-1,[3,2,0,15,0]),this.surfaceReader=this.newReader("IsoShapeReader"),this.generateSurface(),!0;if("rad"===
a)return this.params.setRadical(b),this.readerData=w(-1,[3,2,0,15,0]),this.surfaceReader=this.newReader("IsoShapeReader"),this.generateSurface(),!0;if("lobe"===a)return this.params.setLobe(b),this.readerData=w(-1,[3,2,0,15,0]),this.surfaceReader=this.newReader("IsoShapeReader"),this.generateSurface(),!0;if("hydrogenOrbital"===a){if(!this.params.setAtomicOrbital(b))return this.isValid=!1,!0;this.readerData=w(-1,[this.params.psi_n,this.params.psi_l,this.params.psi_m,this.params.psi_Znuc,this.params.psi_monteCarloCount]);
this.surfaceReader=this.newReader("IsoShapeReader");this.processState();return!0}if("functionXY"===a)return this.params.setFunctionXY(b),this.params.isContoured&&this.volumeDataTemp.setPlaneParameters(null==this.params.thePlane?this.params.thePlane=JU.P4.new4(0,0,1,0):this.params.thePlane),0<=this.params.functionInfo.get(0).indexOf("_xyz")&&this.getFunctionZfromXY(),this.processState(),!0;if("functionXYZ"===a)return this.params.setFunctionXYZ(b),this.processState(),!0;if("lcaoType"===a)return this.params.setLcao(b,
this.colorPtr),!0;if("lcaoCartoonCenter"===a){if(2!=++this.params.state)return!0;Float.isNaN(this.params.center.x)&&this.params.center.setT(b);return!1}if("molecular"===a||"solvent"===a||"sasurface"===a||"nomap"===a)return this.params.setSolvent(a,b.floatValue()),this.params.isSilent||JU.Logger.info(this.params.calculationType),this.processState(),!0;if("moData"===a)return this.params.moData=b,!0;if("mepCalcType"===a)return this.params.mep_calcType=b.intValue(),!0;if("mep"===a)return this.params.setMep(b,
!1),this.processState(),!0;if("mlp"===a)return this.params.setMep(b,!0),this.processState(),!0;if("nci"===a)return c=b.booleanValue(),this.params.setNci(c),c&&this.processState(),!0;if("calculationType"===a)return this.params.calculationType=b,!0;if("charges"===a)return this.params.theProperty=b,!0;if("randomSeed"===a)return this.params.randomSeed=b.intValue(),!0;if("molecularOrbital"===a)return c=0,e=null,T(b,Integer)?c=b.intValue():e=b,this.params.setMO(c,e),JU.Logger.info(this.params.calculationType),
this.processState(),!0;if("fileType"===a)return this.fileType=b,!0;if("fileName"===a)return this.params.fileName=b,!0;if("filesData"===a)return this.params.filesData=b,!0;if("outputChannel"===a)return this.out=b,!0;if("readFile"===a){if(null==(this.surfaceReader=this.setFileData(this.atomDataServer,b)))return JU.Logger.error("Could not set the surface data"),!0;this.surfaceReader.setOutputChannel(this.out);this.generateSurface();return!0}if("mapColor"===a){if(null==(this.surfaceReader=this.setFileData(this.atomDataServer,
b)))return JU.Logger.error("Could not set the mapping data"),!0;this.surfaceReader.setOutputChannel(this.out);this.mapSurface();return!0}if("getSurfaceSets"===a)return this.getSurfaceSets(),!0;"periodic"===a&&(this.params.isPeriodic=!0);return!1},"~S,~O,JU.BS");d(c$,"newReader",function(a){a=J.jvxl.readers.SurfaceGenerator.getInterface(a);null!=a&&a.init(this);return a},"~S");d(c$,"newReaderBr",function(a,b){var c=J.jvxl.readers.SurfaceGenerator.getInterface(a);null!=c&&c.init2(this,b);return c},
"~S,java.io.BufferedReader");c$.getInterface=d(c$,"getInterface",function(a){try{var b=eb._4Name("J.jvxl.readers."+a);return null==b?null:b.newInstance()}catch(c){if(Y(c,Exception))return JU.Logger.error("Interface.java Error creating instance for "+a+": \n"+c.toString()),null;throw c;}},"~S");d(c$,"getSurfaceSets",function(){null==this.meshDataServer?this.meshData.getSurfaceSet():(this.meshDataServer.fillMeshData(this.meshData,1,null),this.meshData.getSurfaceSet(),this.meshDataServer.fillMeshData(this.meshData,
3,null))});d(c$,"processState",function(){1==this.params.state&&null!=this.params.thePlane&&this.params.state++;2<=this.params.state?this.mapSurface():this.generateSurface()});d(c$,"setReader",function(){this.readerData=null;if(null!=this.surfaceReader)return!this.surfaceReader.vertexDataOnly;switch(this.params.dataType){case 1207:this.surfaceReader=this.newReader("IsoPlaneReader");break;case 1208:this.surfaceReader=this.newReader("AtomPropertyMapper");break;case 1328:case 1329:this.readerData=1328==
this.params.dataType?"Mep":"Mlp";this.surfaceReader=3==this.params.state?this.newReader("AtomPropertyMapper"):this.newReader("Iso"+this.readerData+"Reader");break;case 1334:this.surfaceReader=this.newReader("IsoIntersectFileReader");break;case 1333:this.surfaceReader=this.newReader("IsoIntersectAtomReader");break;case 1195:case 1203:case 1196:this.surfaceReader=this.newReader("IsoSolventReader");break;case 1844:case 1837:this.surfaceReader=this.newReader("IsoMOReader");break;case 8:this.surfaceReader=
this.newReader("IsoFxyReader");break;case 9:this.surfaceReader=this.newReader("IsoFxyzReader")}JU.Logger.debugging&&JU.Logger.info("Using surface reader "+this.surfaceReader);this.params.isSilent&&null!=this.surfaceReader&&(this.surfaceReader.isQuiet=!0);return!0});d(c$,"generateSurface",function(){if(2==++this.params.state){this.setReader();null==this.params.sbOut&&(this.params.sbOut=new JU.SB);this.jvxlData.sbOut=this.params.sbOut;var a=null!=this.meshDataServer;this.params.colorBySign&&(this.params.isBicolorMap=
!0);if(null==this.surfaceReader)JU.Logger.error("surfaceReader is null for "+this.params.dataType);else if(this.surfaceReader.createIsosurface(!1)){if(null!=this.params.probes)for(var b=this.params.probeValues.length;0<=--b;)this.params.probeValues[b]=this.surfaceReader.getValueAtPoint(this.params.probes[b],!1);null!=this.params.pocket&&a&&this.surfaceReader.selectPocket(!this.params.pocket.booleanValue());0<this.params.minSet&&this.surfaceReader.excludeMinimumSet();0<this.params.maxSet&&this.surfaceReader.excludeMaximumSet();
null!=this.params.slabInfo&&this.surfaceReader.slabIsosurface(this.params.slabInfo);a&&this.meshDataServer.notifySurfaceGenerationCompleted()&&(this.surfaceReader.hasColorData=!1);null!=this.jvxlData.thisSet&&this.getSurfaceSets();this.jvxlData.jvxlDataIs2dContour&&(this.surfaceReader.colorIsosurface(),this.params.state=3);this.jvxlData.jvxlDataIsColorDensity&&(this.params.state=3);if(this.params.colorBySign||this.params.isBicolorMap)this.params.state=3,this.surfaceReader.applyColorScale();null!=
this.jvxlData.vertexColorMap&&(this.jvxlData.vertexColorMap=null,this.surfaceReader.hasColorData=!1);this.surfaceReader.jvxlUpdateInfo();this.marchingSquares=this.surfaceReader.marchingSquares;this.surfaceReader.discardTempData(!1);this.params.mappedDataMin=3.4028235E38;this.surfaceReader.closeReader();if(3!=this.params.state&&(this.surfaceReader.hasColorData||this.params.colorDensity))this.params.state=3,this.colorIsosurface();this.surfaceReader=null}else JU.Logger.error("Could not create isosurface"),
this.params.cutoff=NaN,this.params.cutoffRange=null,this.surfaceReader.closeReader()}});d(c$,"mapSurface",function(){1==this.params.state&&null!=this.params.thePlane&&this.params.state++;if(!(3>++this.params.state)&&this.setReader()){this.params.isPeriodic&&(this.surfaceReader.volumeData.isPeriodic=!0);if(null!=this.params.thePlane){var a=this.params.isSquared;this.params.isSquared=!1;this.params.cutoff=0;this.params.cutoffRange=null;this.surfaceReader.volumeData.setMappingPlane(this.params.thePlane);
this.surfaceReader.createIsosurface(!this.params.isPeriodic);this.surfaceReader.volumeData.setMappingPlane(null);null!=this.meshDataServer&&this.meshDataServer.notifySurfaceGenerationCompleted();if(1207==this.params.dataType){this.surfaceReader.discardTempData(!0);return}this.params.isSquared=a;this.params.mappedDataMin=3.4028235E38;this.surfaceReader.readVolumeData(!0);null!=this.params.mapLattice&&(this.surfaceReader.volumeData.isPeriodic=!0)}else!this.params.colorBySets&&!this.params.colorDensity&&
(this.surfaceReader.readAndSetVolumeParameters(!0),this.params.mappedDataMin=3.4028235E38,this.surfaceReader.readVolumeData(!0));this.colorIsosurface();this.surfaceReader.closeReader();this.surfaceReader=null}});d(c$,"colorIsosurface",function(){this.surfaceReader.colorIsosurface();this.surfaceReader.jvxlUpdateInfo();this.surfaceReader.updateTriangles();this.surfaceReader.discardTempData(!0);null!=this.meshDataServer&&this.meshDataServer.notifySurfaceMappingCompleted()});d(c$,"getProperty",function(a,
b){return"jvxlFileData"===a?J.jvxl.data.JvxlCoder.jvxlGetFile(this.jvxlData,null,this.params.title,"",!0,b,null,null):"jvxlFileInfo"===a?J.jvxl.data.JvxlCoder.jvxlGetInfo(this.jvxlData):null},"~S,~N");d(c$,"setFileData",function(a,b){var c=this.fileType;this.fileType=null;if(T(b,java.util.Map)){var e=b;if(e.containsKey("__pymolSurfaceData__"))return this.readerData=e,this.newReaderBr("PyMOLMeshReader",null);b=e.get("volumeData")}if(T(b,J.jvxl.data.VolumeData))return this.volumeDataTemp=b,this.newReader("VolumeDataReader");
e=null;T(b,String)&&(e=b,b=JU.Rdr.getBR(b));if(T(b,Array)){for(var e=b[0],d=Array(e.length),h=0;h<e.length;h++)this.fileType=c,d[h]=this.setFileData(a,e[h]);b[0]=d;this.readerData=b;return this.newReader("IsoIntersectGridReader")}d=b;null==c&&(c=JV.FileManager.determineSurfaceFileType(d));if(null!=c&&c.startsWith("UPPSALA")){h=this.params.fileName;h=h.substring(0,h.indexOf("/",10));h+=JU.PT.getQuotedStringAt(c,c.indexOf("A HREF")+1);this.params.fileName=h;b=this.atomDataServer.getBufferedInputStream(h);
if(null==b)return JU.Logger.error("Isosurface: could not open file "+h),null;try{d=JU.Rdr.getBufferedReader(b,null)}catch(f){if(!Y(f,Exception))throw f;}c=JV.FileManager.determineSurfaceFileType(d)}null==c&&(c="UNKNOWN");JU.Logger.info("data file type was determined to be "+c);if(c.equals("Jvxl+"))return this.newReaderBr("JvxlReader",d);this.readerData=B(-1,[this.params.fileName,e]);0<="MRC DELPHI DSN6".indexOf(c.toUpperCase())&&(c+="Binary");return this.newReaderBr(c+"Reader",d)},"JV.Viewer,~O");
d(c$,"getReaderData",function(){var a=this.readerData;this.readerData=null;return a});d(c$,"initializeIsosurface",function(){this.params.initialize();this.colorPtr=0;this.marchingSquares=this.surfaceReader=null;this.initState()});d(c$,"initState",function(){this.params.state=1;this.params.dataType=this.params.surfaceType=0});d(c$,"setLcao",function(){this.params.colorPos=this.params.colorPosLCAO;this.params.colorNeg=this.params.colorNegLCAO;return this.params.lcaoType});d(c$,"getFunctionZfromXY",
function(){for(var a=this.params.functionInfo.get(1),b=u(3,0),c=u(3,0),e=Array(3),d=0;3>d;d++){var h=this.params.functionInfo.get(d+2);b[d]=Math.abs(y(h.x));e[d]=JU.V3.new3(h.y,h.z,h.w)}for(var h=b[0],b=b[1],f=new JU.P3,g=new JU.P3,j=new JU.P3,p=new JU.P3,l=this.params.functionInfo.get(5),t=w(h,b,0),r,d=0;d<h;d++)for(var m=0;m<b;m++){f.scaleAdd2(d,e[0],a);f.scaleAdd2(m,e[1],f);var v=J.jvxl.readers.SurfaceGenerator.findNearestThreePoints(f.x,f.y,l,c);g.set((r=l[c[0]])[0],r[1],r[2]);1E-5>v?f.z=r[2]:
(j.set((r=l[c[1]])[0],r[1],r[2]),p.set((r=l[c[2]])[0],r[1],r[2]),f.z=this.distanceVerticalToPlane(f.x,f.y,g,j,p));t[d][m]=f.z}this.params.functionInfo.set(5,t)});d(c$,"distanceVerticalToPlane",function(a,b,c,e,d){c=JU.Measure.getDirectedNormalThroughPoints(c,e,d,this.ptRef,this.vNorm,this.vAB);return(this.vNorm.x*a+this.vNorm.y*b+c)/-this.vNorm.z},"~N,~N,JU.P3,JU.P3,JU.P3");c$.findNearestThreePoints=d(c$,"findNearestThreePoints",function(a,b,c,e){var d,h,f,g,j,p,l;j=p=l=-1;h=f=g=3.4028235E38;for(var t=
c.length;0<=--t;)d=(d=c[t][0]-a)*d+(d=c[t][1]-b)*d,d<h?(g=f,f=h,h=d,l=p,p=j,j=t):d<f?(g=f,f=d,l=p,p=t):d<g&&(g=d,l=t);e[0]=j;e[1]=p;e[2]=l;return h},"~N,~N,~A,~A");d(c$,"addRequiredFile",function(a){null!=this.meshDataServer&&this.meshDataServer.addRequiredFile(a)},"~S");d(c$,"setRequiredFile",function(a,b){null!=this.meshDataServer&&this.meshDataServer.setRequiredFile(a,b)},"~S,~S");d(c$,"log",function(a){null==this.atomDataServer?System.out.println(a):this.atomDataServer.log(a)},"~S");d(c$,"setOutputChannel",
function(a,b){null!=this.meshDataServer&&this.meshDataServer.setOutputChannel(a,b)},"javajs.api.GenericBinaryDocument,JU.OC");d(c$,"fillAtomData",function(a,b){0!=(b&2)&&null!=a.bsSelected&&(null==this.bsVdw&&(this.bsVdw=new JU.BS),this.bsVdw.or(a.bsSelected));this.atomDataServer.fillAtomData(a,b)},"J.atomdata.AtomData,~N");d(c$,"getOriginVaVbVc",function(){return null==this.surfaceReader.volumeData?null:this.surfaceReader.volumeData.oabc})});O("J.jvxl.readers");F(null,"J.jvxl.readers.Parameters",
"java.lang.Float java.util.Hashtable JU.A4 $.Lst $.M3 $.P3 $.P4 $.V3 JU.Escape $.Logger".split(" "),function(){c$=H(function(){this.testFlags=this.state=0;this.isSilent=this.logCube=this.logCompression=this.logMessages=!1;this.assocCutoff=0.3;this.surfaceType=this.dataType=0;this.calculationType="";this.atomRadiusData=null;this.addHydrogens=!1;this.solventExtendedAtomRadius=this.solventRadius=0;this.propertySmoothing=!1;this.propertySmoothingPower=4;this.cavityRadius=this.envelopeRadius=0;this.isCavity=
!1;this.pocket=null;this.minSet=0;this.slabInfo=null;this.slabPlaneOffset=NaN;this.theProperty=null;this.solvent_ptsPerAngstrom=4;this.solvent_gridMax=60;this.plane_ptsPerAngstrom=4;this.plane_gridMax=81;this.colorBySets=this.colorByPhase=this.colorBySign=!1;this.colorPhase=this.colorNegLCAO=this.colorPosLCAO=this.colorPos=this.colorNeg=this.colorRgb=0;this.iAddGridPoints=this.colorDensity=!1;this.atomIndex=0;this.isAngstroms=!1;this.scale3d=this.scale=0;this.anisotropy=null;this.isAnisotropic=!1;
this.eccentricityMatrixInverse=this.eccentricityMatrix=null;this.isEccentric=!1;this.eccentricityRatio=this.eccentricityScale=0;this.functionInfo=this.lcaoType=this.anisoB=this.aniosU=null;this.psi_n=2;this.psi_Znuc=this.psi_m=this.psi_l=1;this.psi_ptsPerAngstrom=5;this.psi_monteCarloCount=0;this.mep_gridMax=40;this.mep_ptsPerAngstrom=3;this.mep_marginAngstroms=1;this.mep_calcType=-1;this.qmOrbitalCount=this.qmOrbitalType=0;this.moData=null;this.qm_gridMax=80;this.qm_ptsPerAngstrom=10;this.qm_marginAngstroms=
1;this.qm_nAtoms=0;this.qm_moNumber=2147483647;this.point=this.center=this.qm_moLinearCombination=null;this.distance=0;this.allowVolumeRender=!1;this.title=this.func=this.bsSolvent=this.bsIgnore=this.bsSelected=this.script=null;this.readAllData=this.blockCubeData=!1;this.fileIndex=-1;this.fileName=null;this.modelIndex=-1;this.modelInvRotation=null;this.dataXYReversed=this.insideOut=this.isXLowToHigh=!1;this.cutoff=3.4028235E38;this.cutoffRange=null;this.sigma=3.4028235E38;this.cutoffAutomatic=!0;
this.rangeDefined=this.rangeSelected=this.rangeAll=this.isPositiveOnly=this.isCutoffAbsolute=!1;this.mappedDataMax=this.mappedDataMin=this.valueMappedToBlue=this.valueMappedToRed=0;this.isSquaredLinear=this.isSquared=this.isBicolorMap=this.isColorReversed=!1;this.thePlane=null;this.isContoured=!1;this.thisContour=this.nContours=0;this.contourFromZero=!1;this.parameters=null;this.maxSet=this.downsampleFactor=this.resolution=0;this.bsExcluded=this.boundingBox=this.contourIncrements=this.contourColixes=
this.contoursDiscrete=null;this.contourType=0;this.colorSchemeTranslucent=!1;this.colorEncoder=null;this.usePropertyForColorRange=!0;this.doFullMolecular=this.isPeriodic=!1;this.propertyDistanceMax=2147483647;this.randomSeed=0;this.fullyLit=!1;this.mapLattice=this.contactPair=this.volumeData=this.points=this.steps=this.origin=this.intersection=this.vertexSource=null;this.extendGrid=0;this.showTiming=this.isMapped=!1;this.pointSize=0;this.probes=null;this.isModelConnected=!1;this.sbOut=this.probeValues=
this.filesData=this.surfaceAtoms=null;P(this,arguments)},J.jvxl.readers,"Parameters");ha(c$,function(){this.anisotropy=w(3,0)});d(c$,"initialize",function(){this.addHydrogens=!1;this.allowVolumeRender=!0;this.atomRadiusData=null;this.atomIndex=-1;this.blockCubeData=!1;this.boundingBox=null;this.bsExcluded=Array(4);this.bsSolvent=this.bsSelected=this.bsIgnore=null;this.calculationType="";this.center=new JU.P3;this.resetForMapping(!0);this.colorBySign=this.colorByPhase=this.colorBySets=!1;this.colorEncoder=
null;this.colorNeg=-65536;this.colorNegLCAO=-8388480;this.colorPos=-16776961;this.colorPosLCAO=-23296;this.colorRgb=-2147483648;this.colorSchemeTranslucent=!1;this.contourColixes=this.contoursDiscrete=this.contourIncrements=this.contactPair=null;this.contourFromZero=!0;this.cutoff=3.4028235E38;this.cutoffAutomatic=!0;this.dataXYReversed=!1;this.distance=3.4028235E38;this.doFullMolecular=!1;this.envelopeRadius=10;this.extendGrid=0;this.fileIndex=1;this.readAllData=!0;this.fileName="";this.filesData=
null;this.fullyLit=!1;this.functionInfo=null;this.logCube=this.logCompression=this.isSilent=this.isPeriodic=this.isMapped=this.isEccentric=this.isContoured=this.isSquaredLinear=this.isSquared=this.isModelConnected=this.isColorReversed=this.isCavity=this.isBicolorMap=this.isCutoffAbsolute=this.isPositiveOnly=this.isAngstroms=this.insideOut=this.iAddGridPoints=!1;this.logMessages=JU.Logger.debugging;this.mapLattice=null;this.mep_calcType=-1;this.minSet=0;this.modelIndex=-1;this.modelInvRotation=null;
this.nContours=0;this.pocket=null;this.pointSize=NaN;this.probeValues=this.probes=null;this.propertyDistanceMax=2147483647;this.propertySmoothing=!1;this.propertySmoothingPower=4;this.rangeSelected=this.rangeAll=this.rangeDefined=!1;this.resolution=3.4028235E38;this.scale=NaN;this.scale3d=0;this.sigma=NaN;this.slabInfo=null;this.solventExtendedAtomRadius=0;this.state=1;this.testFlags=0;this.theProperty=this.thePlane=null;this.thisContour=-1;this.title=null;this.usePropertyForColorRange=!0;this.vertexSource=
null});d(c$,"resetForMapping",function(a){a||(this.state=2);this.center.x=NaN;this.colorDensity=!1;this.intersection=this.func=null;this.isAnisotropic=!1;this.isMapped=!0;this.mappedDataMin=3.4028235E38;this.points=this.parameters=this.origin=null;this.qmOrbitalType=0;this.volumeData=this.steps=null},"~B");d(c$,"setAnisotropy",function(a){this.anisotropy[0]=a.x;this.anisotropy[1]=a.y;this.anisotropy[2]=a.z;this.isAnisotropic=!0;Float.isNaN(this.center.x)&&this.center.set(0,0,0)},"JU.P3");d(c$,"setEccentricity",
function(a){var b=JU.V3.new3(a.x,a.y,a.z),c=0<this.scale?this.scale:0>a.w?1:b.length();a=Math.abs(a.w);b.normalize();var e=JU.V3.new3(0,0,1);b.add(e);b.normalize();Float.isNaN(b.x)&&b.set(1,0,0);this.eccentricityMatrixInverse=new JU.M3;this.eccentricityMatrixInverse.invertM(this.eccentricityMatrix=(new JU.M3).setAA(JU.A4.newVA(b,3.141592653589793)));this.isEccentric=this.isAnisotropic=!0;this.eccentricityScale=c;this.eccentricityRatio=a;1<a&&(this.eccentricityScale*=a);this.anisotropy[0]=a*c;this.anisotropy[1]=
a*c;this.anisotropy[2]=c;Float.isNaN(this.center.x)&&this.center.set(0,0,0)},"JU.P4");d(c$,"setPlane",function(a){this.thePlane=a;0==this.thePlane.x&&(0==this.thePlane.y&&0==this.thePlane.z)&&(this.thePlane.z=1);this.isContoured=!0},"JU.P4");d(c$,"setSphere",function(a,b){this.dataType=b?74:65;this.distance=a;this.setEccentricity(JU.P4.new4(0,0,1,1));this.cutoff=1.4E-45;this.isCutoffAbsolute=!1;this.isSilent=!this.logMessages;this.script=this.getScriptParams()+" SPHERE "+a+";"},"~N,~B");d(c$,"setEllipsoidP4",
function(a){this.dataType=66;this.distance=1;this.setEccentricity(a);this.cutoff=1.4E-45;this.isCutoffAbsolute=!1;this.isSilent=!this.logMessages},"JU.P4");d(c$,"setEllipsoidAF",function(a){this.anisoB=a;this.dataType=67;this.distance=0.3*(Float.isNaN(this.scale)?1:this.scale);this.cutoff=1.4E-45;this.isCutoffAbsolute=!1;this.isSilent=!this.logMessages;Float.isNaN(this.center.x)&&this.center.set(0,0,0);3.4028235E38==this.resolution&&(this.resolution=6)},"~A");d(c$,"setLobe",function(a){this.dataType=
68;this.setEccentricity(a);3.4028235E38==this.cutoff&&(this.cutoff=0.14,this.isSquared&&(this.cutoff*=this.cutoff));this.isSilent=!this.logMessages;this.script=this.getScriptParams()+" LOBE {"+a.x+" "+a.y+" "+a.z+" "+a.w+"};"},"JU.P4");d(c$,"getScriptParams",function(){return" center "+JU.Escape.eP(this.center)+(Float.isNaN(this.scale)?"":" scale "+this.scale)});d(c$,"setLp",function(a){this.dataType=70;this.setEccentricity(a);3.4028235E38==this.cutoff&&(this.cutoff=0.14,this.isSquared&&(this.cutoff*=
this.cutoff));this.isSilent=!this.logMessages;this.script=" center "+JU.Escape.eP(this.center)+(Float.isNaN(this.scale)?"":" scale "+this.scale)+" LP {"+a.x+" "+a.y+" "+a.z+" "+a.w+"};"},"JU.P4");d(c$,"setRadical",function(a){this.dataType=71;this.setEccentricity(a);3.4028235E38==this.cutoff&&(this.cutoff=0.14,this.isSquared&&(this.cutoff*=this.cutoff));this.isSilent=!this.logMessages;this.script=" center "+JU.Escape.eP(this.center)+(Float.isNaN(this.scale)?"":" scale "+this.scale)+" RAD {"+a.x+" "+
a.y+" "+a.z+" "+a.w+"};"},"JU.P4");d(c$,"setLcao",function(a,b){this.lcaoType=a;1==b&&(this.colorPosLCAO=this.colorNegLCAO);this.isSilent=!this.logMessages},"~S,~N");d(c$,"setSolvent",function(a,b){this.isEccentric=this.isAnisotropic=!1;this.solventRadius=Math.abs(b);this.dataType=null!=this.intersection?1333:"nomap"===a?1207:"molecular"===a?1203:"sasurface"===a||0==this.solventRadius?1196:1195;if(2>this.state&&(this.cutoffAutomatic||!this.colorDensity)&&(null==this.intersection||3.4028235E38==this.cutoff))this.cutoff=
0;switch(this.dataType){case 1333:this.calculationType="VDW intersection";break;case 1207:this.calculationType="unmapped plane";break;case 1203:this.calculationType="molecular surface with radius "+this.solventRadius;0==this.minSet&&(this.minSet=50);break;case 1195:this.calculationType="solvent-excluded surface with radius "+this.solventRadius;0==this.minSet&&(this.minSet=50);break;case 1196:this.calculationType="solvent-accessible surface with radius "+this.solventRadius,0==this.minSet&&(this.minSet=
50)}switch(this.dataType){case 1207:this.solventExtendedAtomRadius=this.solventRadius;this.solventRadius=0;this.isContoured=!1;break;case 1203:this.solventExtendedAtomRadius=0;break;case 1195:this.solventExtendedAtomRadius=0;null==this.bsIgnore?this.bsIgnore=this.bsSolvent:null!=this.bsSolvent&&this.bsIgnore.or(this.bsSolvent);break;case 1196:this.solventExtendedAtomRadius=this.solventRadius,this.solventRadius=0,null==this.bsIgnore?this.bsIgnore=this.bsSolvent:null!=this.bsSolvent&&this.bsIgnore.or(this.bsSolvent)}},
"~S,~N");d(c$,"setFunctionXY",function(a){this.dataType=8;this.functionInfo=a;this.cutoff=1.4E-45;this.isEccentric=this.isAnisotropic=!1},"JU.Lst");d(c$,"setFunctionXYZ",function(a){this.dataType=9;this.functionInfo=a;3.4028235E38==this.cutoff&&(this.cutoff=1.4E-45);this.isEccentric=this.isAnisotropic=!1},"JU.Lst");d(c$,"setAtomicOrbital",function(a){this.dataType=1294;this.setEccentricity(JU.P4.new4(0,0,1,1));this.psi_n=y(a[0]);this.psi_l=y(a[1]);this.psi_m=y(a[2]);this.psi_Znuc=a[3];this.psi_monteCarloCount=
y(a[4]);this.distance=a[5];if(0!=this.distance||null!=this.thePlane)this.allowVolumeRender=!1;this.randomSeed=y(a[6]);this.psi_ptsPerAngstrom=10;if(3.4028235E38==this.cutoff||0.14==this.cutoff)this.cutoff=0<this.psi_monteCarloCount?0:0.04,this.isSquared&&(this.cutoff*=this.cutoff);this.isCutoffAbsolute=!0;2>this.state&&(null==this.thePlane&&this.colorBySign)&&(this.isBicolorMap=!0);return 0<this.psi_Znuc&&Math.abs(this.psi_m)<=this.psi_l&&this.psi_l<this.psi_n},"~A");d(c$,"setMep",function(a,b){this.dataType=
b?1329:1328;this.theProperty=a;this.isEccentric=this.isAnisotropic=this.usePropertyForColorRange=!1;3.4028235E38==this.cutoff&&(this.cutoff=0.1,this.isSquared&&(this.cutoff*=this.cutoff));this.isCutoffAbsolute=0<this.cutoff&&!this.isPositiveOnly;this.contourFromZero=!1;2<=this.state||null!=this.thePlane?!this.rangeDefined&&!this.rangeAll&&(this.valueMappedToRed=-0.1,this.valueMappedToBlue=0.1,this.rangeDefined=!0):this.isBicolorMap=this.colorBySign=!0},"~A,~B");d(c$,"setNci",function(a){this.fullyLit=
!0;this.qm_gridMax=200;a&&(this.dataType=1844);this.qm_marginAngstroms=2;this.qmOrbitalType=a?3:4;if(a&&(null==this.parameters||2>this.parameters.length))this.parameters=w(-1,[this.cutoff,2]);if(3.4028235E38==this.cutoff||0==this.cutoff)this.cutoff=0.3;this.isSquared&&(this.cutoff*=this.cutoff);null==this.title&&(this.title=[]);this.moData=new java.util.Hashtable},"~B");d(c$,"setMO",function(a,b){this.isModelConnected=!0;this.qm_moLinearCombination=b;this.qm_moNumber=null==b?Math.abs(a):y(b[1]);this.qmOrbitalType=
this.moData.containsKey("haveVolumeData")?5:this.moData.containsKey("gaussians")?1:this.moData.containsKey("slaters")?2:0;var c=0>=a&&null==b;0==this.qmOrbitalType?(JU.Logger.error("MO ERROR: No basis functions found in file for MO calculation. (GAUSSIAN 'gfprint' keyword may be missing?)"),this.title=B(-1,["no basis functions found in file"])):(this.qmOrbitalCount=this.moData.get("mos").size(),this.calculationType=this.moData.get("calculationType"),this.calculationType="Molecular orbital #"+this.qm_moNumber+
"/"+this.qmOrbitalCount+" "+(null==this.calculationType?"":this.calculationType),!c&&null==this.title&&(this.title=Array(5),this.title[0]="%F",this.title[1]="Model %M  MO %I/%N %T",this.title[2]="?Energy = %E %U",this.title[3]="?Symmetry = %S",this.title[4]="?Occupancy = %O"));this.dataType=1837;3.4028235E38==this.cutoff&&(this.cutoff=c?0.01:0.05);if(this.isSquared||this.isSquaredLinear)this.cutoff*=this.cutoff;this.isEccentric=this.isAnisotropic=!1;this.isCutoffAbsolute=0<this.cutoff&&!this.isPositiveOnly;
2<=this.state||null!=this.thePlane||(this.colorBySign=!0,this.colorByPhase&&0==this.colorPhase&&(this.colorByPhase=!1),this.isBicolorMap=!0)},"~N,~A");d(c$,"setMapRanges",function(a,b){if(!this.colorDensity&&(this.colorByPhase||this.colorBySign||(null!=this.thePlane||this.isBicolorMap)&&!this.isContoured))this.mappedDataMin=-1,this.mappedDataMax=1;if(3.4028235E38==this.mappedDataMin||this.mappedDataMin==this.mappedDataMax){var c=a.getMinMaxMappedValues(b);System.out.println("parameters - setmapranges "+
c[0]+" "+c[1]);this.mappedDataMin=c[0];this.mappedDataMax=c[1]}0==this.mappedDataMin&&0==this.mappedDataMax&&(this.mappedDataMin=-1,this.mappedDataMax=1);this.rangeDefined||(this.valueMappedToRed=this.mappedDataMin,this.valueMappedToBlue=this.mappedDataMax)},"J.jvxl.readers.SurfaceReader,~B");d(c$,"addSlabInfo",function(a){null==this.slabInfo&&(this.slabInfo=new JU.Lst);this.slabInfo.addLast(a)},"~A");d(c$,"isInsideOut",function(){return this.insideOut!=this.dataXYReversed});d(c$,"isFullyLit",function(){return null!=
this.thePlane||this.fullyLit});Z(c$,"STATE_UNINITIALIZED",0,"STATE_INITIALIZED",1,"STATE_DATA_READ",2,"STATE_DATA_COLORED",3,"NO_ANISOTROPY",32,"IS_SILENT",64,"IS_SOLVENTTYPE",128,"HAS_MAXGRID",256,"IS_POINTMAPPABLE",512,"IS_SLABBABLE",1024,"SURFACE_NONE",0,"SURFACE_SPHERE",65,"SURFACE_ELLIPSOID2",66,"SURFACE_ELLIPSOID3",67,"SURFACE_LOBE",68,"SURFACE_LCAOCARTOON",69,"SURFACE_LONEPAIR",70,"SURFACE_RADICAL",71,"SURFACE_FUNCTIONXY",8,"SURFACE_FUNCTIONXYZ",9,"SURFACE_GEODESIC",74,"SURFACE_SOLVENT",1195,
"SURFACE_SASURFACE",1196,"SURFACE_MOLECULARORBITAL",1837,"SURFACE_ATOMICORBITAL",1294,"SURFACE_MEP",1328,"SURFACE_MLP",1329,"SURFACE_MOLECULAR",1203,"SURFACE_NCI",1844,"SURFACE_INTERSECT_ATOM",1333,"SURFACE_INTERSECT_FILE",1334,"SURFACE_NOMAP",1207,"SURFACE_PROPERTY",1208,"ANGSTROMS_PER_BOHR",0.5291772,"defaultEdgeFractionBase",35,"defaultEdgeFractionRange",90,"defaultColorFractionBase",35,"defaultColorFractionRange",90,"defaultMappedDataMin",0,"defaultMappedDataMax",1,"defaultCutoff",0.02,"defaultOrbitalCutoff",
0.04,"defaultLobeCutoff",0.14,"defaultOrbitalCutoffOld",0.14,"defaultQMOrbitalCutoff",0.05,"defaultQMElectronDensityCutoff",0.01,"defaultContourCount",11,"nContourMax",100,"defaultColorNegative",4294901760,"defaultColorPositive",4278190335,"defaultColorNegativeLCAO",4286578816,"defaultColorPositiveLCAO",4294944E3,"defaultSolventRadius",1.2,"defaultMepCutoff",0.1,"defaultMepMin",-0.1,"defaultMepMax",0.1,"MEP_MAX_GRID",40,"QM_TYPE_UNKNOWN",0,"QM_TYPE_GAUSSIAN",1,"QM_TYPE_SLATER",2,"QM_TYPE_NCI_PRO",
3,"QM_TYPE_NCI_SCF",4,"QM_TYPE_VOLUME_DATA",5,"MO_MAX_GRID",80)});O("J.jvxl.readers");F(["J.jvxl.api.VertexDataServer","JU.P3"],"J.jvxl.readers.SurfaceReader","java.lang.Float JU.AU $.BS J.jvxl.calc.MarchingCubes $.MarchingSquares J.jvxl.data.JvxlCoder $.MeshData JU.BoxInfo $.C $.ColorEncoder $.Escape $.Logger".split(" "),function(){c$=H(function(){this.edgeData=this.volumeData=this.jvxlData=this.meshData=this.params=this.meshDataServer=this.sg=null;this.isXLowToHigh=this.isProgressive=this.allowSigma=
this.haveSurfaceAtoms=!1;this.assocCutoff=0.3;this.hasColorData=this.vertexDataOnly=this.isPeriodic=this.isQuiet=!1;this.dataMin=3.4028235E38;this.dataMax=-3.4028235E38;this.dataMean=0;this.anisotropy=this.center=this.xyzMax=this.xyzMin=null;this.isAnisotropic=!1;this.eccentricityMatrixInverse=this.eccentricityMatrix=null;this.isEccentric=!1;this.edgeCount=this.eccentricityRatio=this.eccentricityScale=0;this.voxelData=this.voxelCounts=this.volumetricVectors=this.volumetricOrigin=null;this.nPointsZ=
this.nPointsY=this.nPointsX=this.nDataPoints=this.nBytes=0;this.isJvxl=!1;this.colorFractionRange=this.colorFractionBase=this.edgeFractionRange=this.edgeFractionBase=0;this.fractionData=this.jvxlFileHeaderBuffer=null;this.jvxlColorDataRead=this.jvxlEdgeDataRead="";this.jvxlVoxelBitSet=null;this.jvxlDataIsColorDensity=this.jvxlDataIs2dContour=this.jvxlDataIsPrecisionColor=this.jvxlDataIsColorMapped=!1;this.jvxlCutoff=0;this.jvxlCutoffRange=null;this.jvxlNSurfaceInts=0;this.cJvxlEdgeNaN="\x00";this.contourVertexCount=
0;this.yzPlanes=this.marchingCubes=this.marchingSquares=null;this.yzCount=0;this.minMax=this.ptTemp=this.qpc=null;this.haveSetAnisotropy=!1;P(this,arguments)},J.jvxl.readers,"SurfaceReader",null,J.jvxl.api.VertexDataServer);ha(c$,function(){this.ptTemp=new JU.P3});W(c$,function(){});d(c$,"initSR",function(a){this.sg=a;this.params=a.params;this.assocCutoff=this.params.assocCutoff;this.isXLowToHigh=this.params.isXLowToHigh;this.center=this.params.center;this.anisotropy=this.params.anisotropy;this.isAnisotropic=
this.params.isAnisotropic;this.eccentricityMatrix=this.params.eccentricityMatrix;this.eccentricityMatrixInverse=this.params.eccentricityMatrixInverse;this.isEccentric=this.params.isEccentric;this.eccentricityScale=this.params.eccentricityScale;this.eccentricityRatio=this.params.eccentricityRatio;this.marchingSquares=a.marchingSquares;this.meshData=a.meshData;this.jvxlData=a.jvxlData;this.setVolumeDataV(a.volumeDataTemp);this.meshDataServer=a.meshDataServer;this.cJvxlEdgeNaN=String.fromCharCode(125)},
"J.jvxl.readers.SurfaceGenerator");d(c$,"setOutputChannel",function(){},"JU.OC");d(c$,"newVoxelDataCube",function(){this.volumeData.setVoxelDataAsArray(this.voxelData=w(this.nPointsX,this.nPointsY,this.nPointsZ,0))});d(c$,"setVolumeDataV",function(a){this.nBytes=0;this.volumetricOrigin=a.volumetricOrigin;this.volumetricVectors=a.volumetricVectors;this.voxelCounts=a.voxelCounts;this.voxelData=a.getVoxelData();this.volumeData=a},"J.jvxl.data.VolumeData");d(c$,"jvxlUpdateInfo",function(){this.jvxlData.jvxlUpdateInfo(this.params.title,
this.nBytes)});d(c$,"readAndSetVolumeParameters",function(a){return!this.readVolumeParameters(a)?!1:this.vertexDataOnly?!0:this.volumeData.setUnitVectors()},"~B");d(c$,"createIsosurface",function(a){this.resetIsosurface();this.params.showTiming&&JU.Logger.startTimer("isosurface creation");this.jvxlData.cutoff=NaN;this.jvxlData.cutoffRange=null;if(!this.readAndSetVolumeParameters(a))return!1;!a&&(!Float.isNaN(this.params.sigma)&&!this.allowSigma)&&(0<this.params.sigma&&JU.Logger.error("Reader does not support SIGMA option -- using cutoff 1.6"),
this.params.cutoff=1.6);0>this.params.sigma&&(this.params.sigma=-this.params.sigma);this.nPointsX=this.voxelCounts[0];this.nPointsY=this.voxelCounts[1];this.nPointsZ=this.voxelCounts[2];this.jvxlData.isSlabbable=0!=(this.params.dataType&1024);this.jvxlData.insideOut=this.params.isInsideOut();this.jvxlData.isBicolorMap=this.params.isBicolorMap;this.jvxlData.nPointsX=this.nPointsX;this.jvxlData.nPointsY=this.nPointsY;this.jvxlData.nPointsZ=this.nPointsZ;this.jvxlData.jvxlVolumeDataXml=this.volumeData.xmlData;
this.jvxlData.voxelVolume=this.volumeData.voxelVolume;if(a)this.volumeData.setMappingPlane(this.params.thePlane),null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,1,null),this.params.setMapRanges(this,!1),this.generateSurfaceData(),this.volumeData.setMappingPlane(null);else{if(!this.readVolumeData(!1))return!1;this.generateSurfaceData()}if(null==this.jvxlFileHeaderBuffer)this.jvxlData.jvxlFileTitle="",this.jvxlData.jvxlFileSource=null,this.jvxlData.jvxlFileMessage=null;else{a=
this.jvxlFileHeaderBuffer.toString();var b=a.indexOf("\n",a.indexOf("\n",a.indexOf("\n")+1)+1)+1;this.jvxlData.jvxlFileTitle=a.substring(0,b);this.jvxlData.jvxlFileSource=this.params.fileName}null==this.params.contactPair&&this.setBBoxAll();this.jvxlData.isValid=3.4028235E38!=this.xyzMin.x;this.params.isSilent||(this.jvxlData.isValid?JU.Logger.info("boundbox corners "+JU.Escape.eP(this.xyzMin)+" "+JU.Escape.eP(this.xyzMax)):JU.Logger.error("no isosurface points were found!"));this.jvxlData.boundingBox=
B(-1,[this.xyzMin,this.xyzMax]);this.jvxlData.dataMin=this.dataMin;this.jvxlData.dataMax=this.dataMax;this.jvxlData.cutoffRange=this.isJvxl?this.jvxlCutoffRange:this.params.cutoffRange;this.jvxlData.cutoff=null!=this.jvxlCutoffRange?this.jvxlData.cutoffRange[0]:this.isJvxl?this.jvxlCutoff:this.params.cutoff;this.jvxlData.isCutoffAbsolute=this.params.isCutoffAbsolute;this.jvxlData.isModelConnected=this.params.isModelConnected;this.jvxlData.pointsPerAngstrom=1/this.volumeData.volumetricVectorLengths[0];
this.jvxlData.jvxlColorData="";this.jvxlData.jvxlPlane=this.params.thePlane;this.jvxlData.jvxlEdgeData=this.edgeData;this.jvxlData.isBicolorMap=this.params.isBicolorMap;this.jvxlData.isContoured=this.params.isContoured;this.jvxlData.colorDensity=this.params.colorDensity;this.jvxlData.pointSize=this.params.pointSize;null!=this.jvxlData.vContours&&(this.params.nContours=this.jvxlData.vContours.length);this.jvxlData.nContours=this.params.contourFromZero?this.params.nContours:-1-this.params.nContours;
this.jvxlData.thisContour=this.params.thisContour;this.jvxlData.nEdges=this.edgeCount;this.jvxlData.edgeFractionBase=this.edgeFractionBase;this.jvxlData.edgeFractionRange=this.edgeFractionRange;this.jvxlData.colorFractionBase=this.colorFractionBase;this.jvxlData.colorFractionRange=this.colorFractionRange;this.jvxlData.jvxlDataIs2dContour=this.jvxlDataIs2dContour;this.jvxlData.jvxlDataIsColorMapped=this.jvxlDataIsColorMapped;this.jvxlData.jvxlDataIsColorDensity=this.jvxlDataIsColorDensity;this.jvxlData.isXLowToHigh=
this.isXLowToHigh;this.jvxlData.vertexDataOnly=this.vertexDataOnly;this.jvxlData.saveVertexCount=0;if(this.jvxlDataIsColorMapped||0<this.jvxlData.nVertexColors)null!=this.meshDataServer&&(this.meshDataServer.fillMeshData(this.meshData,1,null),this.meshDataServer.fillMeshData(this.meshData,2,null)),this.jvxlData.jvxlColorData=this.readColorData(),this.updateSurfaceData(),null!=this.meshDataServer&&this.meshDataServer.notifySurfaceMappingCompleted();this.params.showTiming&&JU.Logger.checkTimer("isosurface creation",
!1);return!0},"~B");d(c$,"resetIsosurface",function(){this.meshData=new J.jvxl.data.MeshData;this.xyzMin=this.xyzMax=null;this.jvxlData.isBicolorMap=this.params.isBicolorMap;null!=this.meshDataServer&&this.meshDataServer.fillMeshData(null,0,null);this.contourVertexCount=0;3.4028235E38==this.params.cutoff&&(this.params.cutoff=0.02);this.jvxlData.jvxlSurfaceData="";this.jvxlData.jvxlEdgeData="";this.jvxlData.jvxlColorData="";this.edgeCount=0;this.edgeFractionBase=35;this.edgeFractionRange=90;this.colorFractionBase=
35;this.colorFractionRange=90;this.params.mappedDataMin=3.4028235E38});d(c$,"discardTempData",function(a){this.discardTempDataSR(a)},"~B");d(c$,"discardTempDataSR",function(a){a&&(this.voxelData=null,this.marchingCubes=this.sg.marchingSquares=this.marchingSquares=null)},"~B");d(c$,"initializeVolumetricData",function(){this.nPointsX=this.voxelCounts[0];this.nPointsY=this.voxelCounts[1];this.nPointsZ=this.voxelCounts[2];this.setVolumeDataV(this.volumeData)});d(c$,"gotoAndReadVoxelData",function(a){this.initializeVolumetricData();
if(0<this.nPointsX&&0<this.nPointsY&&0<this.nPointsZ)try{this.gotoData(this.params.fileIndex-1,this.nPointsX*this.nPointsY*this.nPointsZ),this.readSurfaceData(a)}catch(b){if(Y(b,Exception))return JU.Logger.error(b.toString()),!1;throw b;}return!0},"~B");d(c$,"gotoData",function(){},"~N,~N");d(c$,"readColorData",function(){if(null==this.jvxlData.vertexColors)return"";var a=this.jvxlData.vertexCount,b=this.meshData.vcs,c=this.meshData.vvs;if(null==b||b.length<a)this.meshData.vcs=b=$(a,0);if(null==c||
c.length<a)this.meshData.vvs=w(a,0);for(c=0;c<a;c++)b[c]=JU.C.getColix(this.jvxlData.vertexColors[c]);return"-"});m(c$,"getPlane",function(a){return this.getPlaneSR(a)},"~N");d(c$,"getPlaneSR",function(a){0==this.yzCount&&this.initPlanes();null!=this.qpc&&this.qpc.getPlane(a,this.yzPlanes[a%2]);return this.yzPlanes[a%2]},"~N");d(c$,"initPlanes",function(){this.yzCount=this.nPointsY*this.nPointsZ;this.isQuiet||JU.Logger.info("reading data progressively -- yzCount = "+this.yzCount);this.yzPlanes=JU.AU.newFloat2(2);
this.yzPlanes[0]=w(this.yzCount,0);this.yzPlanes[1]=w(this.yzCount,0)});m(c$,"getValue",function(a,b,c,e){return this.getValue2(a,b,c,e)},"~N,~N,~N,~N");d(c$,"getValue2",function(a,b,c,e){return null==this.yzPlanes?this.voxelData[a][b][c]:this.yzPlanes[a%2][e]},"~N,~N,~N,~N");d(c$,"generateSurfaceData",function(){this.edgeData="";if(this.vertexDataOnly)try{this.readSurfaceData(!1)}catch(a){if(Y(a,Exception))System.out.println(a.toString()),JU.Logger.error("Exception in SurfaceReader::readSurfaceData: "+
a.toString());else throw a;}else{this.contourVertexCount=0;var b=-1;this.marchingSquares=null;if(null!=this.params.thePlane||this.params.isContoured)this.marchingSquares=new J.jvxl.calc.MarchingSquares(this,this.volumeData,this.params.thePlane,this.params.contoursDiscrete,this.params.nContours,this.params.thisContour,this.params.contourFromZero),b=this.marchingSquares.contourType,this.marchingSquares.setMinMax(this.params.valueMappedToRed,this.params.valueMappedToBlue);this.params.contourType=b;this.params.isXLowToHigh=
this.isXLowToHigh;this.marchingCubes=new J.jvxl.calc.MarchingCubes(this,this.volumeData,this.params,this.jvxlVoxelBitSet);b=this.marchingCubes.getEdgeData();null==this.params.thePlane&&(this.edgeData=b);this.jvxlData.setSurfaceInfoFromBitSetPts(this.marchingCubes.bsVoxels,this.params.thePlane,this.params.mapLattice);this.jvxlData.jvxlExcluded=this.params.bsExcluded;this.isJvxl&&(this.edgeData=this.jvxlEdgeDataRead);this.postProcessVertices()}});d(c$,"postProcessVertices",function(){});m(c$,"getSurfacePointIndexAndFraction",
function(a,b,c,e,d,h,f,g,j,p,l,t,r,m){b=this.getSurfacePointAndFraction(a,b,j,p,l,t,c,e,d,f,g,m,this.ptTemp);if(null!=this.marchingSquares&&this.params.isContoured)return this.marchingSquares.addContourVertex(this.ptTemp,a);a=0<this.assocCutoff?m[0]<this.assocCutoff?f:m[0]>1-this.assocCutoff?g:-1:-1;0<=a&&(a=this.marchingCubes.getLinearOffset(c,e,d,a));a=this.addVertexCopy(this.ptTemp,b,a,!0);0<=a&&this.params.iAddGridPoints&&(this.marchingCubes.calcVertexPoint(c,e,d,g,this.ptTemp),this.addVertexCopy(j<
p?l:this.ptTemp,Math.min(j,p),-3,!0),this.addVertexCopy(j<p?this.ptTemp:l,Math.max(j,p),-3,!0));return a},"~N,~B,~N,~N,~N,JU.P3i,~N,~N,~N,~N,JU.T3,JU.V3,~B,~A");d(c$,"getSurfacePointAndFraction",function(a,b,c,e,d,h,f,g,j,p,l,t,r){return this.getSPF(a,b,c,e,d,h,f,g,j,p,l,t,r)},"~N,~B,~N,~N,JU.T3,JU.V3,~N,~N,~N,~N,~N,~A,JU.T3");d(c$,"getSPF",function(a,b,c,e,d,h,f,g,j,p,l,t,r){e-=c;f=(a-c)/e;if(b&&(0>f||1<f))f=(-a-c)/e;if(0>f||1<f)f=NaN;t[0]=f;r.scaleAdd2(f,h,d);return c+f*e},"~N,~B,~N,~N,JU.T3,JU.V3,~N,~N,~N,~N,~N,~A,JU.T3");
d(c$,"addVertexCopy",function(a,b,c,e){return this.addVC(a,b,c,e)},"JU.T3,~N,~N,~B");d(c$,"addVC",function(a,b,c,e){return Float.isNaN(b)&&-3!=c?-1:null==this.meshDataServer?this.meshData.addVertexCopy(a,b,c,e):this.meshDataServer.addVertexCopy(a,b,c,e)},"JU.T3,~N,~N,~B");d(c$,"addTriangleCheck",function(a,b,c,e,d,h,f){if(null!=this.marchingSquares&&this.params.isContoured){if(0==f)return this.marchingSquares.addTriangle(a,b,c,e,d);f=0}return null!=this.meshDataServer?this.meshDataServer.addTriangleCheck(a,
b,c,e,d,h,f):h&&!J.jvxl.data.MeshData.checkCutoff(a,b,c,this.meshData.vvs)?-1:this.meshData.addTriangleCheck(a,b,c,e,d,f)},"~N,~N,~N,~N,~N,~B,~N");d(c$,"colorIsosurface",function(){this.params.isSquared&&null!=this.volumeData&&this.volumeData.filterData(!0,NaN);null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,1,null);this.jvxlData.saveVertexCount=0;this.params.isContoured&&null!=this.marchingSquares&&(this.initializeMapping(),this.params.setMapRanges(this,!1),this.marchingSquares.setMinMax(this.params.valueMappedToRed,
this.params.valueMappedToBlue),this.jvxlData.saveVertexCount=this.marchingSquares.contourVertexCount,this.contourVertexCount=this.marchingSquares.generateContourData(this.jvxlDataIs2dContour,this.params.isSquared?1E-8:1E-4),this.jvxlData.contourValuesUsed=this.marchingSquares.contourValuesUsed,this.minMax=this.marchingSquares.getMinMax(),null!=this.meshDataServer&&this.meshDataServer.notifySurfaceGenerationCompleted(),this.finalizeMapping());this.applyColorScale();this.jvxlData.nContours=this.params.contourFromZero?
this.params.nContours:-1-this.params.nContours;this.jvxlData.thisContour=this.params.thisContour;this.jvxlData.jvxlFileMessage="mapped: min = "+this.params.valueMappedToRed+"; max = "+this.params.valueMappedToBlue});d(c$,"applyColorScale",function(){this.colorFractionBase=this.jvxlData.colorFractionBase=35;this.colorFractionRange=this.jvxlData.colorFractionRange=90;0==this.params.colorPhase&&(this.params.colorPhase=1);null==this.meshDataServer?this.meshData.vcs=$(this.meshData.vc,0):(this.meshDataServer.fillMeshData(this.meshData,
1,null),null==this.params.contactPair&&this.meshDataServer.fillMeshData(this.meshData,2,null));var a=this.params.colorDensity||this.params.isBicolorMap||this.params.colorBySign||!this.params.colorByPhase;null!=this.params.contactPair&&(a=!1);this.jvxlData.isJvxlPrecisionColor=!0;this.jvxlData.vertexCount=0<this.contourVertexCount?this.contourVertexCount:this.meshData.vc;this.jvxlData.minColorIndex=-1;this.jvxlData.maxColorIndex=0;this.jvxlData.contourValues=this.params.contoursDiscrete;this.jvxlData.isColorReversed=
this.params.isColorReversed;if(!this.params.colorDensity&&(this.params.isBicolorMap&&!this.params.isContoured||this.params.colorBySign))this.jvxlData.minColorIndex=JU.C.getColixTranslucent3(JU.C.getColix(this.params.isColorReversed?this.params.colorPos:this.params.colorNeg),0!=this.jvxlData.translucency,this.jvxlData.translucency),this.jvxlData.maxColorIndex=JU.C.getColixTranslucent3(JU.C.getColix(this.params.isColorReversed?this.params.colorNeg:this.params.colorPos),0!=this.jvxlData.translucency,
this.jvxlData.translucency);this.jvxlData.isTruncated=0<=this.jvxlData.minColorIndex&&!this.params.isContoured;if(!this.jvxlDataIs2dContour&&!this.hasColorData&&!this.vertexDataOnly&&!(this.params.colorDensity||this.params.isBicolorMap&&!this.params.isContoured)){this.haveSurfaceAtoms&&null==this.meshData.vertexSource&&(this.meshData.vertexSource=u(this.meshData.vc,0));var b=3.4028235E38,c=-3.4028235E38,e;this.initializeMapping();for(var d=this.meshData.vc;--d>=this.meshData.mergeVertexCount0;){if(this.params.colorBySets)e=
this.meshData.vertexSets[d];else if(this.params.colorByPhase)e=this.getPhase(this.meshData.vs[d]);else{var h=this.haveSurfaceAtoms;e=this.volumeData.lookupInterpolatedVoxelValue(this.meshData.vs[d],h);h&&(this.meshData.vertexSource[d]=this.getSurfaceAtomIndex())}e<b&&(b=e);e>c&&3.4028235E38!=e&&(c=e);this.meshData.vvs[d]=e}this.params.rangeSelected&&null==this.minMax&&(this.minMax=w(-1,[b,c]));this.finalizeMapping()}this.params.setMapRanges(this,!0);this.jvxlData.mappedDataMin=this.params.mappedDataMin;
this.jvxlData.mappedDataMax=this.params.mappedDataMax;this.jvxlData.valueMappedToRed=this.params.valueMappedToRed;this.jvxlData.valueMappedToBlue=this.params.valueMappedToBlue;null==this.params.contactPair&&null==this.jvxlData.vertexColors&&this.colorData();J.jvxl.data.JvxlCoder.jvxlCreateColorData(this.jvxlData,a?this.meshData.vvs:null);this.haveSurfaceAtoms&&null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,4,null);null!=this.meshDataServer&&this.params.colorBySets&&this.meshDataServer.fillMeshData(this.meshData,
3,null)});d(c$,"colorData",function(){var a=this.meshData.vvs,b=this.meshData.vcs;this.meshData.pcs=null;var c=this.jvxlData.valueMappedToBlue,e=this.jvxlData.valueMappedToRed,d=this.jvxlData.minColorIndex,h=this.jvxlData.maxColorIndex;null==this.params.colorEncoder&&(this.params.colorEncoder=new JU.ColorEncoder(null,null));this.params.colorEncoder.setRange(this.params.valueMappedToRed,this.params.valueMappedToBlue,this.params.isColorReversed);for(var f=this.meshData.vc;0<=--f;){var g=a[f];0<=d?0>=
g?b[f]=d:0<g&&(b[f]=h):(g<=e&&(g=e),g>=c&&(g=c),b[f]=this.params.colorEncoder.getColorIndex(g))}if((0<this.params.nContours||null!=this.jvxlData.contourValues)&&null==this.jvxlData.contourColixes){a=null==this.jvxlData.contourValues?this.params.nContours:this.jvxlData.contourValues.length;b=this.jvxlData.contourColixes=$(a,0);d=this.jvxlData.contourValues;null==d&&(d=this.jvxlData.contourValuesUsed);null==this.jvxlData.contourValuesUsed&&(this.jvxlData.contourValuesUsed=null==d?w(a,0):d);c=(c-e)/
(a+1);this.params.colorEncoder.setRange(this.params.valueMappedToRed,this.params.valueMappedToBlue,this.params.isColorReversed);for(f=0;f<a;f++)h=null==d?e+(f+1)*c:d[f],this.jvxlData.contourValuesUsed[f]=h,b[f]=JU.C.getColixTranslucent(this.params.colorEncoder.getArgb(h));this.jvxlData.contourColors=JU.C.getHexCodes(b)}});c$.getColorPhaseIndex=d(c$,"getColorPhaseIndex",function(a){for(var b=-1,c=0;c<J.jvxl.readers.SurfaceReader.colorPhases.length;c++)if(a.equalsIgnoreCase(J.jvxl.readers.SurfaceReader.colorPhases[c])){b=
c;break}return b},"~S");d(c$,"getPhase",function(a){switch(this.params.colorPhase){case 0:case -1:case 1:return 0<a.x?1:-1;case 2:return 0<a.y?1:-1;case 3:return 0<a.z?1:-1;case 4:return 0<a.x*a.y?1:-1;case 5:return 0<a.y*a.z?1:-1;case 6:return 0<a.x*a.z?1:-1;case 7:return 0<a.x*a.x-a.y*a.y?1:-1;case 8:return 0<2*a.z*a.z-a.x*a.x-a.y*a.y?1:-1}return 1},"JU.T3");d(c$,"getMinMaxMappedValues",function(a){if(null!=this.minMax&&3.4028235E38!=this.minMax[0])return this.minMax;if(this.params.colorBySets)return this.minMax=
w(-1,[0,Math.max(this.meshData.nSets-1,0)]);var b=3.4028235E38,c=-3.4028235E38;if(this.params.usePropertyForColorRange&&null!=this.params.theProperty){for(a=this.params.theProperty.length;0<=--a;)if(!this.params.rangeSelected||this.params.bsSelected.get(a)){var e=this.params.theProperty[a];Float.isNaN(e)||(e<b&&(b=e),e>c&&(c=e))}return this.minMax=w(-1,[b,c])}var e=0<this.contourVertexCount?this.contourVertexCount:this.meshData.vc,d=this.meshData.vs,h=a||this.jvxlDataIs2dContour||this.vertexDataOnly||
this.params.colorDensity;for(a=this.meshData.mergeVertexCount0;a<e;a++){var f;f=h?this.meshData.vvs[a]:this.volumeData.lookupInterpolatedVoxelValue(d[a],!1);f<b&&(b=f);f>c&&3.4028235E38!=f&&(c=f)}return this.minMax=w(-1,[b,c])},"~B");d(c$,"updateTriangles",function(){null==this.meshDataServer?this.meshData.invalidatePolygons():this.meshDataServer.invalidateTriangles()});d(c$,"updateSurfaceData",function(){this.meshData.setVertexSets(!0);this.updateTriangles();null==this.params.bsExcluded[1]&&(this.params.bsExcluded[1]=
new JU.BS);this.meshData.updateInvalidatedVertices(this.params.bsExcluded[1])});d(c$,"selectPocket",function(){},"~B");d(c$,"excludeMinimumSet",function(){null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,1,null);this.meshData.getSurfaceSet();for(var a,b=this.meshData.nSets;0<=--b;)null!=(a=this.meshData.surfaceSet[b])&&a.cardinality()<this.params.minSet&&this.meshData.invalidateSurfaceSet(b);this.updateSurfaceData();null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,
3,null)});d(c$,"excludeMaximumSet",function(){null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,1,null);this.meshData.getSurfaceSet();for(var a,b=this.meshData.nSets;0<=--b;)null!=(a=this.meshData.surfaceSet[b])&&a.cardinality()>this.params.maxSet&&this.meshData.invalidateSurfaceSet(b);this.updateSurfaceData();null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,3,null)});d(c$,"slabIsosurface",function(a){null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,
1,null);this.meshData.slabPolygonsList(a,!0);null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,4,null)},"JU.Lst");d(c$,"setVertexAnisotropy",function(a){a.x*=this.anisotropy[0];a.y*=this.anisotropy[1];a.z*=this.anisotropy[2];a.add(this.center)},"JU.T3");d(c$,"setVectorAnisotropy",function(a){this.haveSetAnisotropy=!0;a.x*=this.anisotropy[0];a.y*=this.anisotropy[1];a.z*=this.anisotropy[2]},"JU.T3");d(c$,"setVolumetricAnisotropy",function(){this.haveSetAnisotropy||(this.setVolumetricOriginAnisotropy(),
this.setVectorAnisotropy(this.volumetricVectors[0]),this.setVectorAnisotropy(this.volumetricVectors[1]),this.setVectorAnisotropy(this.volumetricVectors[2]))});d(c$,"setVolumetricOriginAnisotropy",function(){this.volumetricOrigin.setT(this.center)});d(c$,"setBBoxAll",function(){null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,1,null);this.xyzMin=new JU.P3;this.xyzMax=new JU.P3;this.meshData.setBox(this.xyzMin,this.xyzMax)});d(c$,"setBBox",function(a,b){null==this.xyzMin&&(this.xyzMin=
JU.P3.new3(3.4028235E38,3.4028235E38,3.4028235E38),this.xyzMax=JU.P3.new3(-3.4028235E38,-3.4028235E38,-3.4028235E38));JU.BoxInfo.addPoint(a,this.xyzMin,this.xyzMax,b)},"JU.T3,~N");d(c$,"getValueAtPoint",function(){return 0},"JU.T3,~B");d(c$,"initializeMapping",function(){});d(c$,"finalizeMapping",function(){});d(c$,"getSurfaceAtomIndex",function(){return-1});Z(c$,"ANGSTROMS_PER_BOHR",0.5291772,"defaultMappedDataMin",0,"defaultMappedDataMax",1,"defaultCutoff",0.02,"colorPhases",B(-1,"_orb x y z xy yz xz x2-y2 z2".split(" ")))});
O("J.jvxl.calc");F(["JU.TriangleData","JU.BS","$.P3","$.SB","$.V3"],"J.jvxl.calc.MarchingCubes",["java.lang.Float","J.jvxl.data.JvxlCoder"],function(){c$=H(function(){this.volumeData=this.surfaceReader=null;this.contourType=0;this.isContoured=!1;this.cutoff=0;this.isXLowToHigh=this.isSquared=this.isCutoffAbsolute=!1;this.yzCount=this.nZ=this.nY=this.cubeCountZ=this.cubeCountY=this.cubeCountX=0;this.colorDensity=!1;this.integrateSquared=!0;this.edgeData=this.bsExcludedPlanes=this.bsExcludedTriangles=
this.bsExcludedVertices=this.bsVoxels=null;this.excludePartialCubes=!0;this.isDensityRange=!1;this.mode=0;this.vertexValues=null;this.edgeCount=0;this.mappingPlane=this.yzPlanes=this.isoPointIndexPlanes=this.edgePointIndexes=this.edgeVectors=this.voxelVertexVectors=null;this.$isInside=this.allInside=!1;this.voxelData=this.offset=null;this.nTriangles=0;this.linearOffsets=this.fReturn=this.edgeVertexPlanes=this.edgeVertexPointers=this.pointA=this.pt0=this.bsValues=null;P(this,arguments)},J.jvxl.calc,
"MarchingCubes",JU.TriangleData);ha(c$,function(){this.edgeData=new JU.SB;this.vertexValues=w(8,0);this.voxelVertexVectors=Array(8);this.edgeVectors=Array(12);for(var a=12;0<=--a;)this.edgeVectors[a]=new JU.V3;this.edgePointIndexes=u(12,0);this.bsValues=new JU.BS;this.pt0=new JU.P3;this.pointA=new JU.P3;this.fReturn=w(1,0);this.linearOffsets=u(8,0)});W(c$,function(){da(this,J.jvxl.calc.MarchingCubes,[])});W(c$,function(a,b,c,e){da(this,J.jvxl.calc.MarchingCubes,[]);this.excludePartialCubes=!0;this.surfaceReader=
a;this.bsVoxels=e;a=c.bsExcluded;this.bsExcludedVertices=null==a[0]?a[0]=new JU.BS:a[0];this.bsExcludedPlanes=null==a[2]?a[2]=new JU.BS:a[2];this.bsExcludedTriangles=null==a[3]?a[3]=new JU.BS:a[3];this.mode=null!=b.getVoxelData()||null!=b.mappingPlane?1:null!=e?2:3;this.setParameters(b,c)},"J.jvxl.api.VertexDataServer,J.jvxl.data.VolumeData,J.jvxl.readers.Parameters,JU.BS");d(c$,"setParameters",function(a,b){this.volumeData=a;this.colorDensity=b.colorDensity;this.isContoured=null==b.thePlane&&b.isContoured&&
!this.colorDensity;this.cutoff=b.cutoff;this.isCutoffAbsolute=b.isCutoffAbsolute;this.isDensityRange=null!=b.cutoffRange;this.contourType=b.contourType;this.isSquared=b.isSquared;this.isXLowToHigh=b.isXLowToHigh;this.cubeCountX=a.voxelCounts[0]-1;this.cubeCountY=a.voxelCounts[1]-1;this.cubeCountZ=a.voxelCounts[2]-1;a.getYzCount();null!=b.mapLattice&&(this.cubeCountX*=Math.abs(b.mapLattice.x),this.cubeCountY*=Math.abs(b.mapLattice.y),this.cubeCountZ*=Math.abs(b.mapLattice.z));this.nY=this.cubeCountY+
1;this.nZ=this.cubeCountZ+1;this.yzCount=this.nY*this.nZ;null==this.bsVoxels&&(this.bsVoxels=new JU.BS);this.edgeVertexPointers=this.isXLowToHigh?J.jvxl.calc.MarchingCubes.edgeVertexPointersLowToHigh:J.jvxl.calc.MarchingCubes.edgeVertexPointersHighToLow;this.edgeVertexPlanes=this.isXLowToHigh?J.jvxl.calc.MarchingCubes.edgeVertexPlanesLowToHigh:J.jvxl.calc.MarchingCubes.edgeVertexPlanesHighToLow;this.isoPointIndexPlanes=u(2,this.yzCount,3,0);this.yzPlanes=3==this.mode?w(2,this.yzCount,0):null;this.setLinearOffsets();
this.calcVoxelVertexVectors()},"J.jvxl.data.VolumeData,J.jvxl.readers.Parameters");d(c$,"calcVoxelVertexVectors",function(){for(var a=8;0<=--a;)this.volumeData.transform(J.jvxl.calc.MarchingCubes.cubeVertexVectors[a],this.voxelVertexVectors[a]=new JU.V3);for(a=12;0<=--a;)this.edgeVectors[a].sub2(this.voxelVertexVectors[JU.TriangleData.edgeVertexes[a+a+1]],this.voxelVertexVectors[JU.TriangleData.edgeVertexes[a+a]])});d(c$,"resetIndexPlane",function(a){for(var b=0;b<this.yzCount;b++)for(var c=0;3>c;c++)a[b][c]=
-2147483648;return a},"~A");d(c$,"getEdgeData",function(){if(0>this.cubeCountX||0>this.cubeCountY||0>this.cubeCountZ)return"";this.mappingPlane=this.volumeData.mappingPlane;this.edgeCount=0;var a,b,c,e,d,h;this.isXLowToHigh?(a=0,this.colorDensity?(b=this.cubeCountX+1,h=this.yzCount-1):(b=this.cubeCountX,h=this.yzCount-1-this.nZ-1),c=1,e=this.yzCount):(this.colorDensity?(a=this.cubeCountX,h=(this.cubeCountX+1)*this.yzCount-1):(a=this.cubeCountX-1,h=this.cubeCountX*this.yzCount-1-this.nZ-1),c=b=-1,
e=-this.yzCount);d=h;this.resetIndexPlane(this.isoPointIndexPlanes[1]);this.voxelData=null;var f=this.cubeCountY+(this.colorDensity?1:0),g=this.cubeCountZ+(this.colorDensity?1:0);switch(this.mode){case 3:this.getPlane(a,!1);break;case 1:this.voxelData=this.volumeData.getVoxelData()}this.allInside=this.colorDensity&&(0==this.cutoff||2==this.mode&&0>this.bsVoxels.nextSetBit(0));for(var j=this.colorDensity&&0==this.cutoff,p=0;a!=b;a+=c,h+=e,d=h)if(3==this.mode&&a+c<=b&&this.getPlane(a+c,!0),!this.bsExcludedPlanes.get(a)||
!this.bsExcludedPlanes.get(a+c))if(this.colorDensity)for(var l=f;0<=--l;)for(var t=g;0<=--t;d--)p=this.getValue(a,l,t,d,0),(j||this.$isInside)&&this.addVertex(a,l,t,d,p);else{l=this.isoPointIndexPlanes[0];this.isoPointIndexPlanes[0]=this.isoPointIndexPlanes[1];this.isoPointIndexPlanes[1]=this.resetIndexPlane(l);for(var r=!0,l=f;0<=--l;d--)for(t=g;0<=--t;d--){for(var m=0,v=8;0<=--v;)p=this.getValue(a,l,t,d,v),this.$isInside&&(m|=JU.TriangleData.Pwr2[v]);r&&!Float.isNaN(p)&&(r=!1);0!=m&&255!=m&&this.processOneCubical(m,
a,l,t,d)&&(!this.isContoured&&!this.colorDensity)&&this.processTriangles(m)}r&&this.bsExcludedPlanes.set(a)}return this.edgeData.toString()});d(c$,"getValue",function(a,b,c,e,d){this.offset=JU.TriangleData.cubeVertexOffsets[d];e+=this.linearOffsets[d];switch(this.mode){case 3:a=this.vertexValues[d]=this.getValueArray(a+this.offset.x,b+this.offset.y,c+this.offset.z,e,this.yzPlanes[J.jvxl.calc.MarchingCubes.yzPlanePts[d]]);this.$isInside=this.allInside||this.bsVoxels.get(e);break;case 2:this.$isInside=
this.allInside||this.bsVoxels.get(e);a=this.vertexValues[d]=(this.isDensityRange?!this.$isInside:this.bsExcludedVertices.get(e))?NaN:this.$isInside?1:0;break;default:case 1:null==this.mappingPlane?a=this.vertexValues[d]=this.voxelData[a+this.offset.x][b+this.offset.y][c+this.offset.z]:(this.volumeData.voxelPtToXYZ(a+this.offset.x,b+this.offset.y,c+this.offset.z,this.pt0),a=this.vertexValues[d]=this.volumeData.distanceToMappingPlane(this.pt0)),this.isSquared&&(this.vertexValues[d]*=this.vertexValues[d]),
(this.$isInside=this.allInside?!0:J.jvxl.calc.MarchingCubes.isInside(this.vertexValues[d],this.cutoff,this.isCutoffAbsolute))&&this.bsVoxels.set(e)}return a},"~N,~N,~N,~N,~N");d(c$,"getPlane",function(a,b){if(!(0>a||a>this.cubeCountX))if(this.surfaceReader.getPlane(a),b){var c=this.yzPlanes[0];this.yzPlanes[0]=this.yzPlanes[1];this.yzPlanes[1]=c}},"~N,~B");d(c$,"processTriangles",function(a){a=JU.TriangleData.triangleTable2[a];for(var b=a.length;0<=(b-=4);)this.addTriangle(a[b],a[b+1],a[b+2],a[b+
3])},"~N");d(c$,"addVertex",function(a,b,c,e,d){this.volumeData.voxelPtToXYZ(a,b,c,this.pt0);0>this.surfaceReader.addVertexCopy(this.pt0,d,-4,!0)&&this.bsExcludedVertices.set(e)},"~N,~N,~N,~N,~N");d(c$,"addTriangle",function(a,b,c,e){!this.bsExcludedTriangles.get(this.nTriangles)&&0>this.surfaceReader.addTriangleCheck(this.edgePointIndexes[a],this.edgePointIndexes[b],this.edgePointIndexes[c],e,0,this.isCutoffAbsolute,0)&&this.bsExcludedTriangles.set(this.nTriangles);this.nTriangles++},"~N,~N,~N,~N");
d(c$,"getValueArray",function(a,b,c,e,d){var h=e%this.yzCount;this.bsValues.set(e);a=this.surfaceReader.getValue(a,b,c,h);this.isSquared&&(a*=a);d[h]=a;J.jvxl.calc.MarchingCubes.isInside(a,this.cutoff,this.isCutoffAbsolute)&&this.bsVoxels.set(e);return a},"~N,~N,~N,~N,~A");c$.isInside=d(c$,"isInside",function(a,b,c){return 0<b&&(c?Math.abs(a):a)>=b||0>=b&&a<=b},"~N,~N,~B");d(c$,"processOneCubical",function(a,b,c,e,d){a=J.jvxl.calc.MarchingCubes.insideMaskTable[a];for(var h=!1,f=12;0<=--f;)if(0!=(a&
JU.TriangleData.Pwr2[f])){var g=this.edgeVertexPlanes[f],j=(d+this.linearOffsets[this.edgeVertexPointers[f]])%this.yzCount,p=J.jvxl.calc.MarchingCubes.edgeTypeTable[f],l=this.edgePointIndexes[f]=this.isoPointIndexPlanes[g][j][p];if(-2147483648!=l)-1==l&&(h=this.excludePartialCubes);else{var l=JU.TriangleData.edgeVertexes[f<<1],t=JU.TriangleData.edgeVertexes[(f<<1)+1],r=this.vertexValues[l],m=this.vertexValues[t];this.calcVertexPoint(b,c,e,l,this.pointA);this.edgeCount++;g=this.edgePointIndexes[f]=
this.isoPointIndexPlanes[g][j][p]=this.surfaceReader.getSurfacePointIndexAndFraction(this.cutoff,this.isCutoffAbsolute,b,c,e,JU.TriangleData.cubeVertexOffsets[l],l,t,r,m,this.pointA,this.edgeVectors[f],p==this.contourType,this.fReturn);this.addEdgeData(0>g?NaN:this.fReturn[0]);if(Float.isNaN(this.fReturn[0])||0>g)h=this.excludePartialCubes}}return!h},"~N,~N,~N,~N,~N");d(c$,"addEdgeData",function(a){a=J.jvxl.data.JvxlCoder.jvxlFractionAsCharacter(a);this.edgeData.appendC(a)},"~N");d(c$,"calcVertexPoint",
function(a,b,c,e,d){this.volumeData.voxelPtToXYZ(a,b,c,this.pt0);d.add2(this.pt0,this.voxelVertexVectors[e])},"~N,~N,~N,~N,JU.P3");d(c$,"setLinearOffsets",function(){this.linearOffsets[0]=0;this.linearOffsets[1]=this.yzCount;this.linearOffsets[2]=this.yzCount+1;this.linearOffsets[3]=1;this.linearOffsets[4]=this.nZ;this.linearOffsets[5]=this.yzCount+this.nZ;this.linearOffsets[6]=this.yzCount+this.nZ+1;this.linearOffsets[7]=this.nZ+1});d(c$,"getLinearOffset",function(a,b,c,e){return a*this.yzCount+
b*this.nZ+c+this.linearOffsets[e]},"~N,~N,~N,~N");Z(c$,"MODE_CUBE",1,"MODE_JVXL",2,"MODE_PLANES",3);Z(c$,"yzPlanePts",u(-1,[0,1,1,0,0,1,1,0]),"edgeVertexPointersLowToHigh",u(-1,[1,1,2,0,5,5,6,4,0,1,2,3]),"edgeVertexPointersHighToLow",u(-1,[0,1,3,0,4,5,7,4,0,1,2,3]),"edgeVertexPlanesLowToHigh",u(-1,[1,1,1,0,1,1,1,0,0,1,1,0]),"edgeVertexPlanesHighToLow",u(-1,[1,0,1,1,1,0,1,1,1,0,0,1]));c$.cubeVertexVectors=c$.prototype.cubeVertexVectors=B(-1,[JU.V3.new3(0,0,0),JU.V3.new3(1,0,0),JU.V3.new3(1,0,1),JU.V3.new3(0,
0,1),JU.V3.new3(0,1,0),JU.V3.new3(1,1,0),JU.V3.new3(1,1,1),JU.V3.new3(0,1,1)]);Z(c$,"edgeTypeTable",u(-1,[0,2,0,2,0,2,0,2,1,1,1,1]),"insideMaskTable",$(-1,[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,
3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,
2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]))});O("J.jvxl.calc");F(["JU.P3","java.util.Hashtable"],"J.jvxl.calc.MarchingSquares",["java.lang.Float","JU.AU","JU.Logger"],function(){c$=
H(function(){this.volumeData=this.surfaceReader=null;this.valueMax=this.valueMin=this.thisContour=this.contourType=this.nContourSegments=0;this.pointB=this.pointA=null;this.contourFromZero=!0;this.contoursDiscrete=null;this.contourVertexCount=0;this.contourVertexes=null;va("J.jvxl.calc.MarchingSquares.ContourVertex")||J.jvxl.calc.MarchingSquares.$MarchingSquares$ContourVertex$();this.contourPlaneMaximumValue=this.contourPlaneMinimumValue=0;this.ptTemp=this.contourValuesUsed=null;this.triangleCount=
0;this.htPts=this.triangles=null;va("J.jvxl.calc.MarchingSquares.Triangle")||J.jvxl.calc.MarchingSquares.$MarchingSquares$Triangle$();P(this,arguments)},J.jvxl.calc,"MarchingSquares");ha(c$,function(){this.pointA=new JU.P3;this.pointB=new JU.P3;this.contourVertexes=Array(1E3);this.ptTemp=new JU.P3;this.triangles=Array(1E3);this.htPts=new java.util.Hashtable});W(c$,function(a,b,c,e,d,h,f){this.surfaceReader=a;this.volumeData=b;this.thisContour=h;this.contoursDiscrete=e;this.contourFromZero=f;null==
e?(this.nContourSegments=(0==d?9:d)+0,100<this.nContourSegments&&(this.nContourSegments=100)):(this.nContourSegments=d=e.length,this.contourFromZero=!1)},"J.jvxl.api.VertexDataServer,J.jvxl.data.VolumeData,JU.P4,~A,~N,~N,~B");d(c$,"setMinMax",function(a,b){this.valueMin=a;this.valueMax=b},"~N,~N");d(c$,"addContourVertex",function(a,b){this.contourVertexCount==this.contourVertexes.length&&(this.contourVertexes=JU.AU.doubleLength(this.contourVertexes));var c=this.surfaceReader.addVertexCopy(a,b,-2,
!0);this.contourVertexes[this.contourVertexCount++]=ta(J.jvxl.calc.MarchingSquares.ContourVertex,this,null,a);return c},"JU.P3,~N");d(c$,"setContourData",function(a,b){this.contourVertexes[a].setValue(b)},"~N,~N");d(c$,"calcContourPoint",function(a,b,c,e){return this.volumeData.calculateFractionalPoint(a,this.pointA,this.pointB,b,c,e)},"~N,~N,~N,JU.P3");d(c$,"addTriangle",function(a,b,c,e,d){this.triangleCount==this.triangles.length&&(this.triangles=JU.AU.doubleLength(this.triangles));this.triangles[this.triangleCount++]=
ta(J.jvxl.calc.MarchingSquares.Triangle,this,null,a,b,c,e,d);return 0},"~N,~N,~N,~N,~N");d(c$,"generateContourData",function(a,b){JU.Logger.info("generateContours: "+this.nContourSegments+" segments");this.getVertexValues(a);this.createContours(this.valueMin,this.valueMax,b);this.addAllTriangles();return this.contourVertexCount},"~B,~N");d(c$,"getVertexValues",function(a){this.contourPlaneMinimumValue=3.4028235E38;this.contourPlaneMaximumValue=-3.4028235E38;for(var b=0;b<this.contourVertexCount;b++){var c=
this.contourVertexes[b],e;a?e=c.value:(e=this.volumeData.lookupInterpolatedVoxelValue(c,!1),c.setValue(e));e<this.contourPlaneMinimumValue&&(this.contourPlaneMinimumValue=e);e>this.contourPlaneMaximumValue&&(this.contourPlaneMaximumValue=e)}},"~B");d(c$,"createContours",function(a,b,c){b-=a;this.contourValuesUsed=w(this.nContourSegments,0);for(var e=this.triangleCount;0<=--e;)this.triangles[e].check=0;for(var d=-3.4028235E38,e=0;e<this.nContourSegments;e++){d=null!=this.contoursDiscrete?this.contoursDiscrete[e]:
this.contourFromZero?a+1*e/this.nContourSegments*b:0==e?-3.4028235E38:e==this.nContourSegments-1?3.4028235E38:a+1*(e-1)/(this.nContourSegments-1)*b;null==this.contoursDiscrete&&Math.abs(d)<c&&(d=0>d?-c:c);this.contourValuesUsed[e]=d;JU.Logger.info("#contour "+(e+1)+" "+d+" "+this.triangleCount);this.htPts.clear();for(var h=this.triangleCount;0<=--h;)this.triangles[h].isValid&&this.checkContour(this.triangles[h],e,d)}this.valueMin=this.contourValuesUsed[0];this.valueMax=0==this.contourValuesUsed.length?
this.valueMin:this.contourValuesUsed[this.contourValuesUsed.length-1];return!0},"~N,~N,~N");d(c$,"intercept",function(a,b,c){var e=a.pts[b];a=a.pts[(b+1)%3];if(2147483647==e||2147483647==a)return-1;b=e<a?e+"_"+a:a+"_"+e;if(this.htPts.containsKey(b))return this.htPts.get(b).intValue();var d=this.contourVertexes[e].value,h=this.contourVertexes[a].value,f=-1;if(d!=h){var g=(c-d)/(h-d);if(0<=g&&1>=g&&(this.pointA.setT(this.contourVertexes[e]),this.pointB.setT(this.contourVertexes[a]),c=this.calcContourPoint(c,
d,h,this.ptTemp),!Float.isNaN(c))){f=this.addContourVertex(this.ptTemp,c);if(0>f)return-1;this.contourVertexes[f].setValue(c)}}this.htPts.put(b,Integer.$valueOf(f));return f},"J.jvxl.calc.MarchingSquares.Triangle,~N,~N");d(c$,"checkContour",function(a,b,c){if(!(0<this.thisContour&&b+1!=this.thisContour)){var e=this.intercept(a,0,c),d=this.intercept(a,1,c);c=this.intercept(a,2,c);var h=a.pts,f=0;0<=e&&(f+=1);0<=d&&(f+=2);0<=c&&(f+=4);switch(f){case 3:this.addTriangle(h[0],e,d,2|a.check&1,b);this.addTriangle(e,
h[1],d,4|a.check&3,b);this.addTriangle(h[0],d,h[2],a.check&6,b);break;case 5:this.addTriangle(h[0],e,c,2|a.check&5,b);this.addTriangle(e,h[1],c,4|a.check&1,b);this.addTriangle(c,h[1],h[2],a.check&6,b);break;case 6:this.addTriangle(h[0],h[1],c,a.check&5,b);this.addTriangle(c,h[1],d,4|a.check&2,b);this.addTriangle(c,d,h[2],1|a.check&6,b);break;default:return}a.isValid=!1}},"J.jvxl.calc.MarchingSquares.Triangle,~N,~N");d(c$,"getMinMax",function(){return w(-1,[this.valueMin,this.valueMax])});d(c$,"addAllTriangles",
function(){for(var a=0;a<this.triangleCount;a++)if(this.triangles[a].isValid){var b=this.triangles[a];this.surfaceReader.addTriangleCheck(b.pts[0],b.pts[1],b.pts[2],b.check,b.contourIndex,!1,-1)}});c$.$MarchingSquares$ContourVertex$=function(){na(self.c$);c$=H(function(){ua(this,arguments);this.value=0;P(this,arguments)},J.jvxl.calc.MarchingSquares,"ContourVertex",JU.P3);W(c$,function(a){da(this,J.jvxl.calc.MarchingSquares.ContourVertex,[]);this.setT(a)},"JU.P3");d(c$,"setValue",function(a){this.value=
a},"~N");m(c$,"toString",function(){return this.value+" "+this.x+" "+this.y+" "+this.z});c$=ma()};c$.$MarchingSquares$Triangle$=function(){na(self.c$);c$=H(function(){ua(this,arguments);this.pts=null;this.check=0;this.isValid=!0;this.contourIndex=0;P(this,arguments)},J.jvxl.calc.MarchingSquares,"Triangle");W(c$,function(a,b,c,e,d){this.pts=u(-1,[a,b,c]);this.check=e;this.contourIndex=d},"~N,~N,~N,~N,~N");c$=ma()};Z(c$,"CONTOUR_POINT",-1,"VERTEX_POINT",-2,"EDGE_POINT",-3,"nContourMax",100,"defaultContourCount",
9)});O("J.shapesurface");F(["J.shape.Mesh"],"J.shapesurface.IsosurfaceMesh","java.lang.Float java.util.Hashtable JU.AU $.BS $.CU $.Lst $.M4 $.P3 $.P3i $.PT $.SB $.V3 J.api.Interface J.jvxl.data.JvxlCoder $.JvxlData JS.T JU.C $.ColorEncoder $.Logger $.SimpleUnitCell JV.Viewer".split(" "),function(){c$=H(function(){this.jvxlData=null;this.vertexIncrement=1;this.firstRealVertex=-1;this.dataType=0;this.hasGridPoints=!1;this.assocGridPointNormals=this.assocGridPointMap=this.info=this.calculatedVolume=
this.calculatedArea=null;this.mergeAssociatedNormalCount=0;this.bsVdw=this.colorEncoder=this.contourColixes=this.contourValues=this.centers=null;this.colorPhased=!1;this.probeValues=null;P(this,arguments)},J.shapesurface,"IsosurfaceMesh",J.shape.Mesh);m(c$,"getResolution",function(){return 1/this.jvxlData.pointsPerAngstrom});W(c$,function(a,b,c,e){da(this,J.shapesurface.IsosurfaceMesh,[]);this.mesh1(a,b,c,e);this.jvxlData=new J.jvxl.data.JvxlData;this.checkByteCount=2;this.jvxlData.version=JV.Viewer.getJmolVersion()},
"JV.Viewer,~S,~N,~N");d(c$,"clearType",function(a,b){this.clear(a);this.jvxlData.clear();this.colorEncoder=this.centers=this.calculatedArea=this.calculatedVolume=this.bsVdw=this.assocGridPointNormals=this.assocGridPointMap=null;this.colorsExplicit=this.colorPhased=!1;this.firstRealVertex=-1;this.hasGridPoints=b;this.isColorSolid=!0;this.nSets=this.mergeAssociatedNormalCount=0;this.pcs=null;this.showPoints=b;this.vertexColorMap=this.vcs=this.surfaceSet=null;this.vertexIncrement=1;this.vvs=this.vertexSets=
null},"~S,~B");d(c$,"allocVertexColixes",function(){if(null==this.vcs){this.vcs=$(this.vc,0);for(var a=this.vc;0<=--a;)this.vcs[a]=this.colix}this.isColorSolid=!1});d(c$,"addVertexCopy",function(a,b,c,e,d){a=this.addVCVal(a,b,d);switch(c){case -1:0>this.firstRealVertex&&(this.firstRealVertex=a);break;case -2:this.hasGridPoints=!0;break;case -3:this.vertexIncrement=3;break;default:0>this.firstRealVertex&&(this.firstRealVertex=a),e&&(null==this.assocGridPointMap&&(this.assocGridPointMap=new java.util.Hashtable),
this.assocGridPointMap.put(Integer.$valueOf(a),Integer.$valueOf(c+this.mergeAssociatedNormalCount)))}return a},"JU.T3,~N,~N,~B,~B");m(c$,"setTranslucent",function(a,b){this.colix=JU.C.getColixTranslucent3(this.colix,a,b);if(null!=this.vcs)for(var c=this.vc;0<=--c;)this.vcs[c]=JU.C.getColixTranslucent3(this.vcs[c],a,b)},"~B,~N");d(c$,"setMerged",function(a){this.mergePolygonCount0=(this.isMerged=a)?this.pc:0;this.mergeVertexCount0=a?this.vc:0;a&&(this.mergeAssociatedNormalCount+=this.jvxlData.nPointsX*
this.jvxlData.nPointsY*this.jvxlData.nPointsZ,this.assocGridPointNormals=null)},"~B");m(c$,"sumVertexNormals",function(a,b){J.shape.Mesh.sumVertexNormals2(this,a,b);if(null!=this.assocGridPointMap&&0<b.length&&!this.isMerged){null==this.assocGridPointNormals&&(this.assocGridPointNormals=new java.util.Hashtable);for(var c,e=this.assocGridPointMap.entrySet().iterator();e.hasNext()&&((c=e.next())||1);){var d=c.getValue();this.assocGridPointNormals.containsKey(d)||this.assocGridPointNormals.put(d,JU.V3.new3(0,
0,0));this.assocGridPointNormals.get(d).add(b[c.getKey().intValue()])}for(e=this.assocGridPointMap.entrySet().iterator();e.hasNext()&&((c=e.next())||1);)b[c.getKey().intValue()]=this.assocGridPointNormals.get(c.getValue())}},"~A,~A");d(c$,"getCenters",function(){if(null!=this.centers)return this.centers;this.centers=Array(this.pc);for(var a=0;a<this.pc;a++){var b=this.pis[a];if(null!=b){var c=this.centers[a]=JU.P3.newP(this.vs[b[0]]);c.add(this.vs[b[1]]);c.add(this.vs[b[2]]);c.scale(0.33333334)}}return this.centers});
d(c$,"getContours",function(){var a=this.jvxlData.nContours;if(0==a||null==this.pis||(this.havePlanarContours=null!=this.jvxlData.jvxlPlane))return null;0>a&&(a=-1-a);var b=this.jvxlData.vContours;if(null!=b){for(var c=0;c<a&&!(6<b[c].size());c++)J.jvxl.data.JvxlCoder.set3dContourVector(b[c],this.pis,this.vs);return this.jvxlData.vContours}b=Array(a);for(c=0;c<a;c++)b[c]=new JU.Lst;if(null==this.jvxlData.contourValuesUsed){for(var e=(this.jvxlData.valueMappedToBlue-this.jvxlData.valueMappedToRed)/
(a+1),c=0;c<a;c++){var d=this.jvxlData.valueMappedToRed+(c+1)*e;J.shapesurface.IsosurfaceMesh.get3dContour(this,b[c],d,this.jvxlData.contourColixes[c])}JU.Logger.info(a+" contour lines; separation = "+e)}else for(c=0;c<a;c++)d=this.jvxlData.contourValuesUsed[c],J.shapesurface.IsosurfaceMesh.get3dContour(this,b[c],d,this.jvxlData.contourColixes[c]);this.jvxlData.contourColixes=$(a,0);this.jvxlData.contourValues=w(a,0);for(c=0;c<a;c++)this.jvxlData.contourValues[c]=b[c].get(2).floatValue(),this.jvxlData.contourColixes[c]=
b[c].get(3)[0];return this.jvxlData.vContours=b});d(c$,"getPmeshData",function(a){return J.api.Interface.getInterface("J.shapesurface.PMeshWriter",this.vwr,"script").write(this,a)},"~B");c$.get3dContour=d(c$,"get3dContour",function(a,b,c,e){var d=JU.BS.newN(a.pc),h=new JU.SB,f=JU.C.getArgb(e);J.shapesurface.IsosurfaceMesh.setContourVector(b,a.pc,d,c,e,f,h);for(e=0;e<a.pc;e++)null!=a.setABC(e)&&J.shapesurface.IsosurfaceMesh.addContourPoints(b,d,e,h,a.vs,a.vvs,a.iA,a.iB,a.iC,c)},"J.shapesurface.IsosurfaceMesh,JU.Lst,~N,~N");
c$.setContourVector=d(c$,"setContourVector",function(a,b,c,e,d,h,f){a.add(0,Integer.$valueOf(b));a.add(1,c);a.add(2,Float.$valueOf(e));a.add(3,$(-1,[d]));a.add(4,u(-1,[h]));a.add(5,f)},"JU.Lst,~N,JU.BS,~N,~N,~N,JU.SB");c$.addContourPoints=d(c$,"addContourPoints",function(a,b,c,e,d,h,f,g,j,p){var l=null,t=null,r=0,m=J.shapesurface.IsosurfaceMesh.checkPt(h,f,g,p);Float.isNaN(m)||(l=J.shapesurface.IsosurfaceMesh.getContourPoint(d,f,g,m),r|=1);var v=1==m?NaN:J.shapesurface.IsosurfaceMesh.checkPt(h,g,
j,p);Float.isNaN(v)||(t=J.shapesurface.IsosurfaceMesh.getContourPoint(d,g,j,v),0==r&&(l=t,m=v),r|=2);switch(r){case 0:return;case 1:if(0==m)return;case 2:v=1==v?NaN:J.shapesurface.IsosurfaceMesh.checkPt(h,j,f,p),Float.isNaN(v)||(t=J.shapesurface.IsosurfaceMesh.getContourPoint(d,j,f,v),r|=4)}switch(r){case 3:case 5:case 6:break;default:return}b.set(c);J.jvxl.data.JvxlCoder.appendContourTriangleIntersection(r,m,v,e);a.addLast(l);a.addLast(t)},"JU.Lst,JU.BS,~N,JU.SB,~A,~A,~N,~N,~N,~N");c$.checkPt=d(c$,
"checkPt",function(a,b,c,e){var d,h;return e==(d=a[b])?0:e==(h=a[c])?1:d<e==e<h?(e-d)/(h-d):NaN},"~A,~N,~N,~N");c$.getContourPoint=d(c$,"getContourPoint",function(a,b,c,e){var d=new JU.P3;d.sub2(a[c],a[b]);d.scaleAdd2(e,d,a[b]);return d},"~A,~N,~N,~N");d(c$,"setDiscreteColixes",function(a,b){null!=a&&(this.jvxlData.contourValues=a);if(null==a||0==a.length)a=this.jvxlData.contourValues=this.jvxlData.contourValuesUsed;null==b&&null!=this.jvxlData.contourColixes?b=this.jvxlData.contourColixes:(this.jvxlData.contourColixes=
b,this.jvxlData.contourColors=JU.C.getHexCodes(b));if(!(null==this.vs||null==this.vvs||null==a)){var c=a.length,e=a[c-1];this.colorCommand=null;var d=null!=b&&0<b.length;this.isColorSolid=d&&null!=this.jvxlData.jvxlPlane;if(null!=this.jvxlData.vContours){if(d)for(var h=0;h<this.jvxlData.vContours.length;h++)c=b[h%b.length],this.jvxlData.vContours[h].get(3)[0]=c,this.jvxlData.vContours[h].get(4)[0]=JU.C.getArgb(c)}else{this.pcs=$(this.pc,0);this.colorsExplicit=!1;for(h=0;h<this.pc;h++){var f=this.pis[h];
if(null!=f){this.pcs[h]=0;for(var f=(this.vvs[f[0]]+this.vvs[f[1]]+this.vvs[f[2]])/3,g=c;0<=--g;)if(f>=a[g]&&f<e){this.pcs[h]=d?b[g%b.length]:0;break}}}}}},"~A,~A");d(c$,"getContourList",function(){var a=new java.util.Hashtable;a.put("values",null==this.jvxlData.contourValuesUsed?this.jvxlData.contourValues:this.jvxlData.contourValuesUsed);var b=new JU.Lst;if(null!=this.jvxlData.contourColixes){for(var c=0;c<this.jvxlData.contourColixes.length;c++)b.addLast(JU.CU.colorPtFromInt(JU.C.getArgb(this.jvxlData.contourColixes[c]),
null));a.put("colors",b)}return a},"JV.Viewer");d(c$,"deleteContours",function(){this.jvxlData.contourValuesUsed=null;this.jvxlData.contourValues=null;this.jvxlData.contourColixes=null;this.jvxlData.vContours=null});d(c$,"setVertexColorMap",function(){this.vertexColorMap=new java.util.Hashtable;for(var a=-999,b=null,c=this.vc;0<=--c;){var e=this.vcs[c];e!=a&&(e=JU.C.getHexCode(a=e),b=this.vertexColorMap.get(e),null==b&&this.vertexColorMap.put(e,b=new JU.BS));b.set(c)}});d(c$,"setVertexColixesForAtoms",
function(a,b,c,e){this.jvxlData.vertexDataOnly=!0;this.jvxlData.vertexColors=u(this.vc,0);this.jvxlData.nVertexColors=this.vc;var d=a.ms.at;a=a.gdata;for(var h=this.mergeVertexCount0;h<this.vc;h++){var f=this.vertexSource[h];if(!(0>f)&&e.get(f)){this.jvxlData.vertexColors[h]=a.getColorArgbOrGray(this.vcs[h]=JU.C.copyColixTranslucency(this.colix,d[f].colixAtom));var g=null==b?0:b[c[f]];0==g&&(g=d[f].colixAtom);this.vcs[h]=JU.C.copyColixTranslucency(this.colix,g)}}},"JV.Viewer,~A,~A,JU.BS");d(c$,"colorVertices",
function(a,b,c){if(null!=this.vertexSource){a=JU.C.copyColixTranslucency(this.colix,a);var e=c?new JU.BS:b;this.checkAllocColixes();if(c)for(var d=0;d<this.vc;d++){var h=this.vertexSource[d];0<=h&&b.get(h)&&(this.vcs[d]=a,null!=e&&e.set(d))}else for(d=0;d<this.vc;d++)e.get(d)&&(this.vcs[d]=a);c&&(a=JU.C.getHexCode(a),null==this.vertexColorMap&&(this.vertexColorMap=new java.util.Hashtable),J.shapesurface.IsosurfaceMesh.addColorToMap(this.vertexColorMap,a,b))}},"~N,JU.BS,~B");d(c$,"checkAllocColixes",
function(){(null==this.vcs||null==this.vertexColorMap&&this.isColorSolid)&&this.allocVertexColixes();this.isColorSolid=!1});c$.addColorToMap=d(c$,"addColorToMap",function(a,b,c){for(var e=null,d,h=a.entrySet().iterator();h.hasNext()&&((d=h.next())||1);)d.getKey()===b?(e=d.getValue(),e.or(c)):d.getValue().andNot(c);null==e&&a.put(b,c)},"java.util.Map,~S,JU.BS");d(c$,"setJvxlColorMap",function(a){this.jvxlData.diameter=this.diameter;this.jvxlData.color=JU.C.getHexCode(this.colix);this.jvxlData.meshColor=
0==this.meshColix?null:JU.C.getHexCode(this.meshColix);this.jvxlData.translucency=30720==(this.colix&30720)?-1:JU.C.getColixTranslucencyFractional(this.colix);this.jvxlData.rendering=this.getRendering().substring(1);this.jvxlData.colorScheme=null==this.colorEncoder?null:this.colorEncoder.getColorScheme();null==this.jvxlData.vertexColors&&(this.jvxlData.nVertexColors=null==this.vertexColorMap?0:this.vertexColorMap.size());if(!(null==this.vertexColorMap||null==this.vertexSource||!a)){null==this.jvxlData.vertexColorMap&&
(this.jvxlData.vertexColorMap=new java.util.Hashtable);var b;for(a=this.vertexColorMap.entrySet().iterator();a.hasNext()&&((b=a.next())||1);){var c=b.getValue();if(!c.isEmpty()){for(var e=b.getKey(),d=new JU.BS,h=0;h<this.vc;h++)c.get(this.vertexSource[h])&&d.set(h);J.shapesurface.IsosurfaceMesh.addColorToMap(this.jvxlData.vertexColorMap,e,d)}}this.jvxlData.nVertexColors=this.jvxlData.vertexColorMap.size();0==this.jvxlData.vertexColorMap.size()&&(this.jvxlData.vertexColorMap=null)}},"~B");d(c$,"setColorCommand",
function(){if(!(null==this.colorEncoder||null==(this.colorCommand=this.colorEncoder.getColorScheme())))this.colorCommand=this.colorCommand.equals("inherit")?"#inherit;":"color $"+JU.PT.esc(this.thisID)+JU.PT.esc(this.colorCommand)+" range "+(this.jvxlData.isColorReversed?this.jvxlData.valueMappedToBlue+" "+this.jvxlData.valueMappedToRed:this.jvxlData.valueMappedToRed+" "+this.jvxlData.valueMappedToBlue)});d(c$,"setColorsFromJvxlData",function(a){this.diameter=this.jvxlData.diameter;-1!=a&&(-2147483648!=
a&&2147483647!=a?this.colix=JU.C.getColix(a):null!=this.jvxlData.color&&(this.colix=JU.C.getColixS(this.jvxlData.color)));0==this.colix&&(this.colix=5);this.colix=JU.C.getColixTranslucent3(this.colix,0!=this.jvxlData.translucency,this.jvxlData.translucency);a=0==this.jvxlData.translucency?NaN:this.jvxlData.translucency;null!=this.jvxlData.meshColor&&(this.meshColix=JU.C.getColixS(this.jvxlData.meshColor));this.setJvxlDataRendering();this.isColorSolid=!this.jvxlData.isBicolorMap&&null==this.jvxlData.vertexColors&&
null==this.jvxlData.vertexColorMap;if(null==this.colorEncoder)return!1;if(null==this.jvxlData.vertexColorMap){if(null!=this.jvxlData.colorScheme){var b=this.jvxlData.colorScheme,c=b.startsWith("translucent ");c&&(b=b.substring(12),a=NaN);this.colorEncoder.setColorScheme(b,c);this.remapColors(null,null,a)}}else{if(null!=this.jvxlData.baseColor)for(a=this.vc;0<=--a;)this.vcs[a]=this.colix;for(c=this.jvxlData.vertexColorMap.entrySet().iterator();c.hasNext()&&((b=c.next())||1);){var e=b.getValue(),d=
JU.C.copyColixTranslucency(this.colix,JU.C.getColixS(b.getKey()));for(a=e.nextSetBit(0);0<=a;a=e.nextSetBit(a+1))this.vcs[a]=d}}return!0},"~N");d(c$,"setJvxlDataRendering",function(){if(null!=this.jvxlData.rendering)for(var a=JU.PT.getTokens(this.jvxlData.rendering),b=0;b<a.length;b++)this.setTokenProperty(JS.T.getTokFromName(a[b]),!0)});d(c$,"remapColors",function(a,b,c){null==b&&(b=this.colorEncoder);null==b&&(b=this.colorEncoder=new JU.ColorEncoder(null,a));this.colorEncoder=b;this.setColorCommand();
Float.isNaN(c)?c=JU.C.getColixTranslucencyLevel(this.colix):this.colix=JU.C.getColixTranslucent3(this.colix,!0,c);var e=b.lo,d=b.hi,h=null!=this.vertexSource&&15==b.currentPalette;this.pcs=this.vertexColorMap=null;this.colorsExplicit=!1;this.jvxlData.baseColor=null;this.jvxlData.vertexCount=this.vc;if(!(null==this.vvs||0==this.jvxlData.vertexCount))if((null==this.vcs||this.vcs.length!=this.vc)&&this.allocVertexColixes(),h){this.jvxlData.vertexDataOnly=!0;this.jvxlData.vertexColors=u(this.vc,0);this.jvxlData.nVertexColors=
this.vc;b=a.ms.at;c=a.gdata;for(a=this.mergeVertexCount0;a<this.vc;a++)e=this.vertexSource[a],0<=e&&e<b.length&&(this.jvxlData.vertexColors[a]=c.getColorArgbOrGray(this.vcs[a]=JU.C.copyColixTranslucency(this.colix,b[e].colixAtom)))}else if(this.jvxlData.vertexColors=null,this.jvxlData.vertexColorMap=null,this.jvxlData.isBicolorMap)for(a=this.mergeVertexCount0;a<this.vc;a++)this.vcs[a]=JU.C.copyColixTranslucency(this.colix,0>this.vvs[a]?this.jvxlData.minColorIndex:this.jvxlData.maxColorIndex);else{this.jvxlData.isColorReversed=
b.isReversed;3.4028235E38!=d&&(this.jvxlData.valueMappedToRed=e,this.jvxlData.valueMappedToBlue=d);b.setRange(this.jvxlData.valueMappedToRed,this.jvxlData.valueMappedToBlue,this.jvxlData.isColorReversed);e=JU.C.isColixTranslucent(this.colix);b.isTranslucent&&(e||(this.colix=JU.C.getColixTranslucent3(this.colix,!0,0.5)),e=!1);this.vcs=JU.AU.ensureLengthShort(this.vcs,this.vc);for(a=this.vc;--a>=this.mergeVertexCount0;)this.vcs[a]=b.getColorIndex(this.vvs[a]);this.setTranslucent(e,c);this.colorEncoder=
b;c=this.getContours();if(null!=c)for(a=c.length;0<=--a;)e=c[a].get(2).floatValue(),d=c[a].get(3),d[0]=b.getColorIndex(e),c[a].get(4)[0]=JU.C.getArgb(d[0]);if(null!=this.contourValues){this.contourColixes=$(this.contourValues.length,0);for(a=0;a<this.contourValues.length;a++)this.contourColixes[a]=b.getColorIndex(this.contourValues[a]);this.setDiscreteColixes(null,null)}this.jvxlData.isJvxlPrecisionColor=!0;J.jvxl.data.JvxlCoder.jvxlCreateColorData(this.jvxlData,this.vvs);this.setColorCommand();this.isColorSolid=
!1}},"JV.Viewer,JU.ColorEncoder,~N");d(c$,"reinitializeLightingAndColor",function(a){this.initialize(this.lighting,null,null);if(null!=this.colorEncoder||this.jvxlData.isBicolorMap)this.vcs=null,this.remapColors(a,null,NaN)},"JV.Viewer");m(c$,"getBoundingBox",function(){return this.jvxlData.boundingBox});m(c$,"setBoundingBox",function(a){this.jvxlData.boundingBox=a},"~A");d(c$,"merge",function(a){var b=this.vc+(null==a?0:a.vc);null==this.pis&&(this.pis=u(0,0,0));null!=a&&null==a.pis&&(a.pis=u(0,0,
0));var c=(null==this.bsSlabDisplay||0==this.pc?this.pc:this.bsSlabDisplay.cardinality())+(null==a||0==a.pc?0:null==a.bsSlabDisplay?a.pc:a.bsSlabDisplay.cardinality());null==this.vs&&(this.vs=[]);this.vs=JU.AU.ensureLength(this.vs,b);this.vvs=JU.AU.ensureLengthA(this.vvs,b);var e=null!=this.vertexSource&&(null==a||null!=a.vertexSource);this.vertexSource=JU.AU.ensureLengthI(this.vertexSource,b);var d=JU.AU.newInt2(c),h=J.shapesurface.IsosurfaceMesh.mergePolygons(this,0,0,d);if(null!=a){J.shapesurface.IsosurfaceMesh.mergePolygons(a,
h,this.vc,d);for(h=0;h<a.vc;h++,this.vc++)this.vs[this.vc]=a.vs[h],this.vvs[this.vc]=a.vvs[h],e&&(this.vertexSource[this.vc]=a.vertexSource[h])}this.pc=this.polygonCount0=c;this.vc=this.vertexCount0=b;0<c&&this.resetSlab();this.pis=d},"J.jvxl.data.MeshData");c$.mergePolygons=d(c$,"mergePolygons",function(a,b,c,e){for(var d,h=0;h<a.pc;h++)if(!(null==(d=a.pis[h])||null!=a.bsSlabDisplay&&!a.bsSlabDisplay.get(h)))if(e[b++]=a.pis[h],0<c)for(var f=0;3>f;f++)d[f]+=c;return b},"JU.MeshSurface,~N,~N,~A");
m(c$,"getUnitCell",function(){return null!=this.unitCell||null!=(this.unitCell=this.vwr.ms.am[this.modelIndex].biosymmetry)||null!=(this.unitCell=this.vwr.ms.getUnitCell(this.modelIndex))||null!=this.oabc&&null!=(this.unitCell=this.vwr.getSymTemp().getUnitCell(this.oabc,!0,null))?this.unitCell:null});d(c$,"fixLattice",function(){if(null!=this.getUnitCell()){var a=new JU.P3i,b=JU.P3i.new3(y(this.lattice.x),y(this.lattice.y),y(this.lattice.z));this.jvxlData.fixedLattice=this.lattice;this.lattice=null;
JU.SimpleUnitCell.setMinMaxLatticeParameters(y(this.unitCell.getUnitCellInfoType(6)),a,b,0);var c=(b.x-a.x)*(b.y-a.y)*(b.z-a.z),e=new JU.P3,d=this.vc,h=c*this.vc;this.vs=JU.AU.arrayCopyPt(this.vs,h);this.vvs=null==this.vvs?null:JU.AU.ensureLengthA(this.vvs,h);var f=this.pc;this.pis=JU.AU.arrayCopyII(this.pis,c*this.pc);c=0;this.normixes=JU.AU.arrayCopyShort(this.normixes,h);for(h=a.x;h<b.x;h++)for(var g=a.y;g<b.y;g++)for(var j=a.z;j<b.z;j++)if(!(0==h&&0==g&&0==j)){e.set(h,g,j);this.unitCell.toCartesian(e,
!1);for(var p=0;p<d;p++){this.normixes[this.vc]=this.normixes[p];var l=JU.P3.newP(this.vs[p]);l.add(e);this.addVCVal(l,this.vvs[p],!1)}c+=d;for(p=0;p<f;p++)l=JU.AU.arrayCopyI(this.pis[p],-1),l[0]+=c,l[1]+=c,l[2]+=c,this.addPolygon(l,null)}a=new JU.P3;b=new JU.P3;this.setBox(a,b);this.jvxlData.boundingBox=B(-1,[a,b])}});m(c$,"getMinDistance2ForVertexGrouping",function(){return null!=this.jvxlData.boundingBox&&null!=this.jvxlData.boundingBox[0]&&5>this.jvxlData.boundingBox[1].distanceSquared(this.jvxlData.boundingBox[0])?
1E-10:1E-8});m(c$,"getVisibleVertexBitSet",function(){var a=this.getVisibleVBS();if(null!=this.jvxlData.thisSet)for(var b=0;b<this.vc;b++)this.jvxlData.thisSet.get(this.vertexSets[b])||a.clear(b);return a});d(c$,"updateCoordinates",function(a,b){var c=null==b||this.isModelConnected;if(!c)for(var e=0;e<this.connectedAtoms.length;e++)if(0<=this.connectedAtoms[e]&&b.get(this.connectedAtoms[e])){c=!0;break}c&&(this.isModelConnected?this.mat4=this.vwr.ms.am[this.modelIndex].mat4:(null==this.mat4&&(this.mat4=
JU.M4.newM4(null)),this.mat4.mul2(a,this.mat4)),this.recalcAltVertices=!0)},"JU.M4,JU.BS");d(c$,"getDataMinMax",function(){for(var a=3.4028235E38,b=-3.4028235E38,c=this.vvs.length;0<=--c;){var e=this.vvs[c];e<a&&(a=e);e>b&&(b=e)}return w(-1,[a,b])});d(c$,"getDataRange",function(){return null!=this.jvxlData.jvxlPlane&&null==this.colorEncoder?null:w(-1,[this.jvxlData.mappedDataMin,this.jvxlData.mappedDataMax,this.jvxlData.isColorReversed?this.jvxlData.valueMappedToBlue:this.jvxlData.valueMappedToRed,
this.jvxlData.isColorReversed?this.jvxlData.valueMappedToRed:this.jvxlData.valueMappedToBlue])});d(c$,"getInfo",function(a){var b=Ia(this,J.shapesurface.IsosurfaceMesh,"getInfo",[a]);if(a){a=new JU.BS;var c=this.getValidVertices(a);null!=c&&(b.put("allVertices",b.get("vertices")),b.put("vertices",c),c=b.get("vertexValues"),null!=c&&(a=this.getValidValues(a),b.put("allValues",c),b.put("vertexValues",a)))}return b},"~B");d(c$,"getValidValues",function(a){null==a&&this.getInvalidBS(a=new JU.BS);for(var b=
this.vc-a.cardinality(),b=w(b,0),c=0,e=a.nextClearBit(0);0<=e&&e<this.vc;e=a.nextClearBit(e+1))b[c++]=this.vvs[e];return b},"JU.BS");d(c$,"getValidVertices",function(a){var b=null!=a;null==a&&(a=new JU.BS);this.getInvalidBS(a);var c=this.vc-a.cardinality();if(c==this.vc&&b)return null;for(var b=Array(c),e=0,d=a.nextClearBit(0);0<=d&&e<c;d=a.nextClearBit(d+1))b[e++]=this.vs[d];return b},"JU.BS");d(c$,"getInvalidBS",function(a){var b=this.jvxlData.jvxlExcluded[1],c=this.jvxlData.thisSet;null!=b&&a.or(b);
if(null!=c)for(b=this.vc;0<=--b;)c.get(this.vertexSets[b])||a.set(b)},"JU.BS")});O("J.jvxl.readers");F(["J.jvxl.readers.SurfaceReader"],"J.jvxl.readers.VolumeDataReader",["java.lang.Float","JU.AU","$.SB","J.jvxl.data.JvxlCoder","JU.Logger"],function(){c$=H(function(){this.dataType=0;this.allowMapData=this.precalculateVoxelData=!1;this.point=null;this.maxGrid=this.ptsPerAngstrom=0;this.useOriginStepsPoints=!1;P(this,arguments)},J.jvxl.readers,"VolumeDataReader",J.jvxl.readers.SurfaceReader);W(c$,function(){da(this,
J.jvxl.readers.VolumeDataReader,[])});m(c$,"init",function(a){this.initVDR(a)},"J.jvxl.readers.SurfaceGenerator");d(c$,"initVDR",function(a){this.initSR(a);this.useOriginStepsPoints=null!=this.params.origin&&null!=this.params.points&&null!=this.params.steps;this.dataType=this.params.dataType;this.allowMapData=this.precalculateVoxelData=!0},"J.jvxl.readers.SurfaceGenerator");d(c$,"setup",function(){this.jvxlFileHeaderBuffer=(new JU.SB).append("volume data read from file\n\n");J.jvxl.data.JvxlCoder.jvxlCreateHeaderWithoutTitleOrAtoms(this.volumeData,
this.jvxlFileHeaderBuffer)},"~B");m(c$,"readVolumeParameters",function(a){this.setup(a);this.initializeVolumetricData();return!0},"~B");m(c$,"readVolumeData",function(a){try{this.readSurfaceData(a)}catch(b){if(Y(b,Exception))return System.out.println(b.toString()),!1;throw b;}return!0},"~B");d(c$,"readVoxelDataIndividually",function(a){if(!a||this.allowMapData)if(!a||null!=this.volumeData.sr)this.volumeData.setVoxelDataAsArray(this.voxelData=null);else{this.newVoxelDataCube();for(a=0;a<this.nPointsX;++a){var b=
JU.AU.newFloat2(this.nPointsY);this.voxelData[a]=b;for(var c=0,e=0;e<this.nPointsY;++e)for(var d=b[e]=w(this.nPointsZ,0),h=0;h<this.nPointsZ;++h,++c)d[h]=this.getValue(a,e,h,c)}}},"~B");d(c$,"setVolumeData",function(){});d(c$,"setVolumeDataParams",function(){if(null!=this.params.volumeData)return this.setVolumeDataV(this.params.volumeData),!0;if(!this.useOriginStepsPoints)return!1;this.volumetricOrigin.setT(this.params.origin);this.volumetricVectors[0].set(this.params.steps.x,0,0);this.volumetricVectors[1].set(0,
this.params.steps.y,0);this.volumetricVectors[2].set(0,0,this.params.steps.z);this.voxelCounts[0]=y(this.params.points.x);this.voxelCounts[1]=y(this.params.points.y);this.voxelCounts[2]=y(this.params.points.z);if(1>this.voxelCounts[0]||1>this.voxelCounts[1]||1>this.voxelCounts[2])return!1;this.showGridInfo();return!0});d(c$,"showGridInfo",function(){JU.Logger.info("grid origin  = "+this.params.origin);JU.Logger.info("grid steps   = "+this.params.steps);JU.Logger.info("grid points  = "+this.params.points);
this.ptTemp.x=this.params.steps.x*this.params.points.x;this.ptTemp.y=this.params.steps.y*this.params.points.y;this.ptTemp.z=this.params.steps.z*this.params.points.z;JU.Logger.info("grid lengths = "+this.ptTemp);this.ptTemp.add(this.params.origin);JU.Logger.info("grid max xyz = "+this.ptTemp)});d(c$,"setVoxelRange",function(a,b,c,e,d,h){-1E-4<=b-c&&(b=-10,c=10);var f=c-b,g=this.params.resolution;3.4028235E38!=g&&(e=g,h=0);c=D(Math.floor(f*e))+1;c>d&&(0<(this.dataType&256)?3.4028235E38==g?(this.isQuiet||
JU.Logger.info("Maximum number of voxels for index="+a+" exceeded ("+c+") -- set to "+d),c=d):this.isQuiet||JU.Logger.info("Warning -- high number of grid points: "+c):3.4028235E38==g&&(c=d));1==c&&(c=2);e=(c-1)/f;e<h&&(c=D(Math.floor(h*f+1)),e=(c-1)/f);d=this.volumeData.volumetricVectorLengths[a]=1/e;this.voxelCounts[a]=c;null!=this.params.sbOut&&this.params.sbOut.append("isosurface resolution for axis "+(a+1)+" set to "+e+" points/Angstrom; "+this.voxelCounts[a]+" voxels\n");switch(a){case 0:this.volumetricVectors[0].set(d,
0,0);this.volumetricOrigin.x=b;break;case 1:this.volumetricVectors[1].set(0,d,0);this.volumetricOrigin.y=b;break;case 2:this.volumetricVectors[2].set(0,0,d),this.volumetricOrigin.z=b,this.isEccentric&&this.eccentricityMatrix.rotate(this.volumetricOrigin),null!=this.center&&!Float.isNaN(this.center.x)&&this.volumetricOrigin.add(this.center),null!=this.params.sbOut&&this.params.sbOut.append(this.voxelCounts[0]*this.voxelCounts[1]*this.voxelCounts[2]+" voxels total\n")}this.isEccentric&&this.eccentricityMatrix.rotate(this.volumetricVectors[a]);
return this.voxelCounts[a]},"~N,~N,~N,~N,~N,~N");m(c$,"readSurfaceData",function(a){this.readSurfaceDataVDR(a)},"~B");d(c$,"readSurfaceDataVDR",function(a){this.isProgressive&&!a?(this.nDataPoints=this.volumeData.setVoxelCounts(this.nPointsX,this.nPointsY,this.nPointsZ),this.voxelData=null):this.precalculateVoxelData?this.generateCube():this.readVoxelDataIndividually(a)},"~B");d(c$,"generateCube",function(){JU.Logger.info("data type: user volumeData");JU.Logger.info("voxel grid origin:"+this.volumetricOrigin);
for(var a=0;3>a;++a)JU.Logger.info("voxel grid vector:"+this.volumetricVectors[a]);JU.Logger.info("Read "+this.nPointsX+" x "+this.nPointsY+" x "+this.nPointsZ+" data points")});m(c$,"closeReader",function(){})});O("J.jvxl.readers");F(["J.jvxl.readers.VolumeDataReader","JU.BS","$.P3","$.P3i","J.atomdata.AtomData"],"J.jvxl.readers.AtomDataReader","java.lang.Float java.util.Date JU.AU $.SB $.V3 J.atomdata.RadiusData J.c.VDW J.jvxl.data.JvxlCoder JU.BSUtil $.Logger".split(" "),function(){c$=H(function(){this.maxDistance=
0;this.fileDotModel=this.fileName=this.contactPair=null;this.modelIndex=0;this.myIndex=this.atomIndex=this.atomNo=this.atomProp=this.atomRadius=this.atomXyzTruncated=this.atomData=null;this.firstNearbyAtom=this.nearbyAtomCount=this.myAtomCount=this.ac=0;this.bsNearby=this.bsMyIgnored=this.bsMySelected=null;this.doUseIterator=this.havePlane=this.doAddHydrogens=!1;this.theProperty=0;this.haveOneProperty=!1;this.sr=this.minPtsPerAng=0;this.rs2=this.rs=null;this.maxRS=0;this.thisAtomSet=this.thisPlane=
null;this.vl2=this.vl1=this.vl0=this.margin=this.thisX=0;this.ptV=this.pt1=this.pt0=this.ptZ0=this.ptY0=this.voxelSource=this.noFaceSpheres=this.validSpheres=this.bsSurfaceVoxels=null;P(this,arguments)},J.jvxl.readers,"AtomDataReader",J.jvxl.readers.VolumeDataReader);ha(c$,function(){this.atomData=new J.atomdata.AtomData;this.bsMySelected=new JU.BS;this.bsMyIgnored=new JU.BS;this.ptY0=new JU.P3;this.ptZ0=new JU.P3;this.pt0=new JU.P3i;this.pt1=new JU.P3i;this.ptV=new JU.P3});W(c$,function(){da(this,
J.jvxl.readers.AtomDataReader,[])});d(c$,"initADR",function(a){this.initVDR(a);this.precalculateVoxelData=!0},"J.jvxl.readers.SurfaceGenerator");m(c$,"setup",function(){this.setup2()},"~B");d(c$,"setup2",function(){this.contactPair=this.params.contactPair;this.doAddHydrogens=null!=this.sg.atomDataServer&&this.params.addHydrogens;this.modelIndex=this.params.modelIndex;null!=this.params.bsIgnore&&(this.bsMyIgnored=this.params.bsIgnore);if(null!=this.params.volumeData){this.setVolumeDataV(this.params.volumeData);
this.setBBox(this.volumeData.volumetricOrigin,0);this.ptV.setT(this.volumeData.volumetricOrigin);for(var a=0;3>a;a++)this.ptV.scaleAdd2(this.volumeData.voxelCounts[a]-1,this.volumeData.volumetricVectors[a],this.ptV);this.setBBox(this.ptV,0)}(this.havePlane=null!=this.params.thePlane)&&this.volumeData.setPlaneParameters(this.params.thePlane)});d(c$,"markPlaneVoxels",function(a,b){for(var c=0,e=this.thisX*this.yzCount,d=e+this.yzCount;e<d;e++,c++)this.volumeData.getPoint(e,this.ptV),this.thisPlane[c]=
this.ptV.distance(a)-b},"JU.P3,~N");d(c$,"setVolumeForPlane",function(){this.useOriginStepsPoints?(this.xyzMin=JU.P3.newP(this.params.origin),this.xyzMax=JU.P3.newP(this.params.origin),this.xyzMax.add3((this.params.points.x-1)*this.params.steps.x,(this.params.points.y-1)*this.params.steps.y,(this.params.points.z-1)*this.params.steps.z)):null==this.params.boundingBox?(this.getAtoms(this.params.bsSelected,!1,!0,!1,!1,!1,!1,this.params.mep_marginAngstroms,this.params.modelInvRotation),null==this.xyzMin&&
(this.xyzMin=JU.P3.new3(-10,-10,-10),this.xyzMax=JU.P3.new3(10,10,10))):(this.xyzMin=JU.P3.newP(this.params.boundingBox[0]),this.xyzMax=JU.P3.newP(this.params.boundingBox[1]));this.setRanges(this.params.plane_ptsPerAngstrom,this.params.plane_gridMax,0)});d(c$,"getAtoms",function(a,b,c,e,d,h,f,g,j){h&&(c=!0);c&&(null==this.params.atomRadiusData&&(this.params.atomRadiusData=new J.atomdata.RadiusData(null,1,J.atomdata.RadiusData.EnumType.FACTOR,J.c.VDW.AUTO)),this.atomData.radiusData=this.params.atomRadiusData,
this.atomData.radiusData.valueExtended=this.params.solventExtendedAtomRadius,b&&(this.atomData.radiusData.vdwType=J.c.VDW.NOJMOL));this.atomData.modelIndex=this.modelIndex;this.atomData.bsSelected=a;this.atomData.bsIgnored=this.bsMyIgnored;this.sg.fillAtomData(this.atomData,1|(d?16:0)|(e?4:0)|(c?2:0));this.doUseIterator&&(this.atomData.bsSelected=null);this.ac=this.atomData.ac;this.modelIndex=this.atomData.firstModelIndex;null!=j&&this.atomData.transformXYZ(j,a);d=!1;for(e=0;e<this.ac;e++){if((null==
a||a.get(e))&&!this.bsMyIgnored.get(e)){if(this.havePlane&&Math.abs(this.volumeData.distancePointToPlane(this.atomData.xyz[e]))>2*(this.atomData.atomRadius[e]=this.getWorkingRadius(e,g)))continue;this.bsMySelected.set(e);d=!this.havePlane}if(c&&(h||d))this.atomData.atomRadius[e]=this.getWorkingRadius(e,g)}d=c&&b?this.getWorkingRadius(-1,g):0;this.myAtomCount=JU.BSUtil.cardinalityOf(this.bsMySelected);g=JU.BSUtil.copy(this.bsMySelected);f=0;this.atomProp=null;this.theProperty=3.4028235E38;this.haveOneProperty=
!1;a=this.params.theProperty;if(0<this.myAtomCount){j=null;if(b){this.atomData.bsSelected=g;this.sg.atomDataServer.fillAtomData(this.atomData,8);j=Array(f=this.atomData.hydrogenAtomCount);for(e=0;e<this.atomData.hAtoms.length;e++)if(null!=this.atomData.hAtoms[e])for(b=this.atomData.hAtoms[e].length;0<=--b;)j[--f]=this.atomData.hAtoms[e][b];f=j.length;JU.Logger.info(f+" attached hydrogens added")}b=f+this.myAtomCount;c&&(this.atomRadius=w(b,0));this.atomXyzTruncated=Array(b);null!=this.params.theProperty&&
(this.atomProp=w(b,0));this.atomNo=u(b,0);this.atomIndex=u(b,0);this.myIndex=u(this.ac,0);for(e=0;e<f;e++)c&&(this.atomRadius[e]=d),this.atomXyzTruncated[e]=j[e],this.atomNo[e]=-1,null!=this.atomProp&&this.addAtomProp(e,NaN);this.myAtomCount=f;for(e=g.nextSetBit(0);0<=e;e=g.nextSetBit(e+1))null!=this.atomProp&&this.addAtomProp(this.myAtomCount,null!=a&&e<a.length?a[e]:NaN),this.atomXyzTruncated[this.myAtomCount]=this.atomData.xyz[e],this.atomNo[this.myAtomCount]=this.atomData.atomicNumber[e],this.atomIndex[this.myAtomCount]=
e,this.myIndex[e]=this.myAtomCount,c&&(this.atomRadius[this.myAtomCount]=this.atomData.atomRadius[e]),this.myAtomCount++}this.firstNearbyAtom=this.myAtomCount;this.isQuiet||JU.Logger.info(this.myAtomCount+" atoms will be used in the surface calculation");0==this.myAtomCount&&(this.setBBox(JU.P3.new3(10,10,10),0),this.setBBox(JU.P3.new3(-10,-10,-10),0));for(e=0;e<this.myAtomCount;e++)this.setBBox(this.atomXyzTruncated[e],c?this.atomRadius[e]+0.5:0);Float.isNaN(this.params.scale)||(b=JU.V3.newVsub(this.xyzMax,
this.xyzMin),b.scale(0.5),this.xyzMin.add(b),b.scale(this.params.scale),this.xyzMax.add2(this.xyzMin,b),this.xyzMin.sub(b));if(h&&0!=this.myAtomCount){h=new JU.P3;this.bsNearby=new JU.BS;for(e=0;e<this.ac;e++)!g.get(e)&&!this.bsMyIgnored.get(e)&&(b=this.atomData.atomRadius[e],null!=this.params.thePlane&&Math.abs(this.volumeData.distancePointToPlane(this.atomData.xyz[e]))>2*b||(null!=this.params.theProperty&&(b+=this.maxDistance),h=this.atomData.xyz[e],h.x+b>this.xyzMin.x&&(h.x-b<this.xyzMax.x&&h.y+
b>this.xyzMin.y&&h.y-b<this.xyzMax.y&&h.z+b>this.xyzMin.z&&h.z-b<this.xyzMax.z)&&(this.bsNearby.set(e),this.nearbyAtomCount++)));h=this.myAtomCount;if(0!=this.nearbyAtomCount){h+=this.nearbyAtomCount;this.atomRadius=JU.AU.arrayCopyF(this.atomRadius,h);this.atomXyzTruncated=JU.AU.arrayCopyObject(this.atomXyzTruncated,h);null!=this.atomIndex&&(this.atomIndex=JU.AU.arrayCopyI(this.atomIndex,h));null!=a&&(this.atomProp=JU.AU.arrayCopyF(this.atomProp,h));for(e=this.bsNearby.nextSetBit(0);0<=e;e=this.bsNearby.nextSetBit(e+
1))null!=a&&this.addAtomProp(this.myAtomCount,a[e]),this.myIndex[e]=this.myAtomCount,this.atomIndex[this.myAtomCount]=e,this.atomXyzTruncated[this.myAtomCount]=this.atomData.xyz[e],this.atomRadius[this.myAtomCount++]=this.atomData.atomRadius[e]}c&&this.setRadii();this.haveOneProperty=!Float.isNaN(this.theProperty)}},"JU.BS,~B,~B,~B,~B,~B,~B,~N,JU.M4");d(c$,"setRadii",function(){if(null==this.rs){this.maxRS=0;this.rs=w(this.myAtomCount,0);this.rs2=w(this.myAtomCount,0);for(var a=0;a<this.myAtomCount;a++){var b=
this.rs[a]=this.atomRadius[a]+this.sr;b>this.maxRS&&(this.maxRS=b);this.rs2[a]=this.rs[a]*this.rs[a]}}});d(c$,"addAtomProp",function(a,b){this.atomProp[a]=b;!Float.isNaN(this.theProperty)&&b!=this.theProperty&&(this.theProperty=3.4028235E38==this.theProperty?b:NaN)},"~N,~N");d(c$,"getWorkingRadius",function(a,b){var c=0>a?this.atomData.hAtomRadius:this.atomData.atomRadius[a];return Float.isNaN(b)?Math.max(c,0.1):c+b},"~N,~N");d(c$,"setHeader",function(a,b){this.jvxlFileHeaderBuffer=new JU.SB;null!=
this.atomData.programInfo&&this.jvxlFileHeaderBuffer.append("#created by ").append(this.atomData.programInfo).append(" on ").append(""+new java.util.Date).append("\n");this.jvxlFileHeaderBuffer.append(a).append("\n").append(b).append("\n")},"~S,~S");d(c$,"setRanges",function(a,b,c){null!=this.xyzMin&&(this.ptsPerAngstrom=a,this.maxGrid=b,this.minPtsPerAng=c,this.setVolumeData(),J.jvxl.data.JvxlCoder.jvxlCreateHeader(this.volumeData,this.jvxlFileHeaderBuffer))},"~N,~N,~N");m(c$,"setVolumeData",function(){this.setVolumeDataADR()});
d(c$,"setVolumeDataADR",function(){this.setVolumeDataParams()||(this.setVoxelRange(0,this.xyzMin.x,this.xyzMax.x,this.ptsPerAngstrom,this.maxGrid,this.minPtsPerAng),this.setVoxelRange(1,this.xyzMin.y,this.xyzMax.y,this.ptsPerAngstrom,this.maxGrid,this.minPtsPerAng),this.setVoxelRange(2,this.xyzMin.z,this.xyzMax.z,this.ptsPerAngstrom,this.maxGrid,this.minPtsPerAng))});d(c$,"setVertexSource",function(){null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,1,null);if(null!=this.params.vertexSource){this.params.vertexSource=
JU.AU.arrayCopyI(this.params.vertexSource,this.meshData.vc);for(var a=0;a<this.meshData.vc;a++)this.params.vertexSource[a]=Math.abs(this.params.vertexSource[a])-1}});d(c$,"resetPlane",function(a){for(var b=0;b<this.yzCount;b++)this.thisPlane[b]=a},"~N");d(c$,"resetVoxelData",function(a){for(var b=0;b<this.nPointsX;++b)for(var c=0;c<this.nPointsY;++c)for(var e=0;e<this.nPointsZ;++e)this.voxelData[b][c][e]=a},"~N");d(c$,"getVoxel",function(a,b,c,e){return this.isProgressive?this.thisPlane[e%this.yzCount]:
this.voxelData[a][b][c]},"~N,~N,~N,~N");d(c$,"unsetVoxelData",function(){this.unsetVoxelData2()});d(c$,"unsetVoxelData2",function(){if(this.isProgressive)for(var a=0;a<this.yzCount;a++)3.4028235E38==this.thisPlane[a]&&(this.thisPlane[a]=NaN);else for(a=0;a<this.nPointsX;++a)for(var b=0;b<this.nPointsY;++b)for(var c=0;c<this.nPointsZ;++c)3.4028235E38==this.voxelData[a][b][c]&&(this.voxelData[a][b][c]=NaN)});d(c$,"setGridLimitsForAtom",function(a,b,c,e){b+=this.margin;this.volumeData.xyzToVoxelPt(a.x,
a.y,a.z,c);a=D(Math.floor(b/this.volumeData.volumetricVectorLengths[0]));var d=D(Math.floor(b/this.volumeData.volumetricVectorLengths[1]));b=D(Math.floor(b/this.volumeData.volumetricVectorLengths[2]));e.set(c.x+a,c.y+d,c.z+b);c.set(c.x-a,c.y-d,c.z-b);c.x=Math.max(c.x-1,0);c.y=Math.max(c.y-1,0);c.z=Math.max(c.z-1,0);e.x=Math.min(e.x+1,this.nPointsX);e.y=Math.min(e.y+1,this.nPointsY);e.z=Math.min(e.z+1,this.nPointsZ)},"JU.P3,~N,JU.P3i,JU.P3i");d(c$,"getAtomMinMax",function(a,b){for(var c=0;c<this.nPointsX;c++)b[c]=
new JU.BS;for(var e=this.myAtomCount;0<=--e;)if(null==a||a.get(e)){this.setGridLimitsForAtom(this.atomXyzTruncated[e],this.atomRadius[e],this.pt0,this.pt1);for(c=this.pt0.x;c<this.pt1.x;c++)b[c].set(e)}},"JU.BS,~A");d(c$,"markSphereVoxels",function(a,b){for(var c=3.4028235E38!=b&&null!=this.point,e=this.volumetricVectors[0],d=this.volumetricVectors[1],h=this.volumetricVectors[2],f=this.thisAtomSet.nextSetBit(0);0<=f;f=this.thisAtomSet.nextSetBit(f+1))if(this.havePlane||null==this.validSpheres||this.validSpheres.get(f)){var g=
null!=this.noFaceSpheres&&this.noFaceSpheres.get(f),j=f>=this.firstNearbyAtom,p=this.atomXyzTruncated[f],l=this.atomRadius[f];if(!(c&&p.distance(this.point)>b+l+0.5)){var t=l+a;this.setGridLimitsForAtom(p,t,this.pt0,this.pt1);this.isProgressive&&(this.pt0.x=this.thisX,this.pt1.x=this.thisX+1);this.volumeData.voxelPtToXYZ(this.pt0.x,this.pt0.y,this.pt0.z,this.ptV);for(var r=this.pt0.x;r<this.pt1.x;r++,this.ptV.add2(e,this.ptY0)){this.ptY0.setT(this.ptV);for(var m=this.pt0.y;m<this.pt1.y;m++,this.ptV.add2(d,
this.ptZ0)){this.ptZ0.setT(this.ptV);for(var v=this.pt0.z;v<this.pt1.z;v++,this.ptV.add(h)){var u=this.ptV.distance(p)-l,w=this.volumeData.getPointIndex(r,m,v);if((0==a||u<=t)&&u<this.getVoxel(r,m,v,w)){if(j||c&&this.ptV.distance(this.point)>b)u=NaN;this.setVoxel(r,m,v,w,u);Float.isNaN(u)||(null!=this.voxelSource&&(this.voxelSource[w]=f+1),0>u&&g&&this.bsSurfaceVoxels.set(w))}}}}}}},"~N,~N");d(c$,"setVoxel",function(a,b,c,e,d){this.isProgressive?this.thisPlane[e%this.yzCount]=d:this.voxelData[a][b][c]=
d},"~N,~N,~N,~N,~N")});O("J.jvxl.readers");F(["JU.P3","J.jvxl.readers.AtomDataReader","JU.P4","$.V3"],"J.jvxl.readers.IsoSolventReader","java.lang.Float java.util.Hashtable JU.BS $.Lst $.Measure J.jvxl.data.MeshData JU.BSUtil $.Logger $.MeshSurface $.TempArray".split(" "),function(){c$=H(function(){this.envelopeRadius=this.cavityRadius=0;this.dots=null;this.isPocket=this.isCavity=this.doCalculateTroughs=!1;this.bsAtomMinMax=this.p=this.vTemp2=this.ptTemp2=this.plane=this.vTemp=this.ptS2=this.ptS1=
this.vFaces=this.vEdges=this.htEdges=this.bsLocale=this.bsSurfaceDone=this.bsSurfacePoints=this.iter=null;this.isSurfacePoint=!1;this.nTest=this.iAtomSurface=0;va("J.jvxl.readers.IsoSolventReader.Edge")||J.jvxl.readers.IsoSolventReader.$IsoSolventReader$Edge$();va("J.jvxl.readers.IsoSolventReader.Face")||J.jvxl.readers.IsoSolventReader.$IsoSolventReader$Face$();this.ecosASB2=this.dAB2=this.dAB=this.rBS2=this.rAS2=this.rBS=this.rAS=0;P(this,arguments)},J.jvxl.readers,"IsoSolventReader",J.jvxl.readers.AtomDataReader);
ha(c$,function(){this.ptS1=new JU.P3;this.ptS2=new JU.P3;this.vTemp=new JU.V3;this.plane=new JU.P4;this.ptTemp2=new JU.P3;this.vTemp2=new JU.V3;this.p=new JU.P3});W(c$,function(){da(this,J.jvxl.readers.IsoSolventReader,[])});m(c$,"init",function(a){this.initADR(a)},"J.jvxl.readers.SurfaceGenerator");m(c$,"readVolumeParameters",function(a){this.setup(a);this.initializeVolumetricData();this.volumeData.setUnitVectors();this.vl0=this.volumeData.volumetricVectorLengths[0];this.vl1=this.volumeData.volumetricVectorLengths[1];
this.vl2=this.volumeData.volumetricVectorLengths[2];this.isProgressive&&(this.volumeData.getYzCount(),this.bsAtomMinMax=Array(this.nPointsX),this.getAtomMinMax(null,this.bsAtomMinMax),this.voxelSource=u(this.volumeData.nPoints,0));return!0},"~B");m(c$,"setup",function(a){this.setup2();if(null==this.contactPair){this.cavityRadius=this.params.cavityRadius;this.envelopeRadius=this.params.envelopeRadius;this.sr=this.params.solventRadius;this.point=this.params.point;this.isCavity=this.params.isCavity&&
null!=this.meshDataServer;this.isPocket=null!=this.params.pocket&&null!=this.meshDataServer;this.doUseIterator=this.doCalculateTroughs=!a&&null!=this.sg.atomDataServer&&!this.isCavity&&0<this.sr&&(1195==this.dataType||1203==this.dataType);this.getAtoms(this.params.bsSelected,this.doAddHydrogens,!0,!1,!1,!0,!1,NaN,null);if(this.isCavity||this.isPocket)this.dots=this.meshDataServer.calculateGeodesicSurface(this.bsMySelected,this.envelopeRadius);this.setHeader("solvent/molecular surface",this.params.calculationType);
if(this.havePlane||!a){var b=Math.max(this.params.solventExtendedAtomRadius,this.params.solventRadius),b=1<=b?1.5/b:0;0<b&&System.out.println("IsoSolventReader.minPtsPerAng="+b);this.setRanges(this.params.solvent_ptsPerAngstrom,this.params.solvent_gridMax,b);this.volumeData.getYzCount();this.margin=2*this.volumeData.maxGrid}null!=this.bsNearby&&this.bsMySelected.or(this.bsNearby)}else a||this.setVolumeData();this.doCalculateTroughs||(a?(this.precalculateVoxelData=!1,this.volumeData.sr=this):this.isCavity||
(this.isProgressive=this.isXLowToHigh=!0));null==this.thisAtomSet&&(this.thisAtomSet=JU.BSUtil.setAll(this.myAtomCount))},"~B");m(c$,"generateCube",function(){if(!(this.isCavity&&null!=this.params.theProperty)){this.isCavity&&1207!=this.dataType&&1208!=this.dataType?(this.params.vertexSource=null,this.newVoxelDataCube(),this.resetVoxelData(3.4028235E38),this.markSphereVoxels(this.cavityRadius,this.params.distance),this.generateSolventCavity(),this.resetVoxelData(3.4028235E38),this.markSphereVoxels(0,
NaN)):(this.voxelSource=u(this.volumeData.nPoints,0),this.generateSolventCube());this.unsetVoxelData();var a=this.params.slabInfo;if(null!=a)for(var b=0;b<a.size();b++)a.get(b)[2].booleanValue()&&T(a.get(b)[0],JU.P4)&&(this.volumeData.capData(a.get(b)[0],this.params.cutoff),a.removeItemAt(b--))}});m(c$,"getSurfacePointAndFraction",function(a,b,c,e,d,h,f,g,j,p,l,m,r){p=this.marchingCubes.getLinearOffset(f,g,j,p);l=this.marchingCubes.getLinearOffset(f,g,j,l);this.isSurfacePoint=null!=this.bsSurfaceVoxels&&
(this.bsSurfaceVoxels.get(p)||this.bsSurfaceVoxels.get(l));if(null!=this.voxelSource){var u=Math.abs(Float.isNaN(e)||c<e?this.voxelSource[p]:this.voxelSource[l]);0<u&&(this.iAtomSurface=this.atomIndex[u-1])}if(J.jvxl.readers.IsoSolventReader.testLinear||null==this.voxelSource||0==this.voxelSource[p]||this.voxelSource[p]!=this.voxelSource[l])return this.getSPF(a,b,c,e,d,h,f,g,j,p,l,m,r);a=m[0]=JU.MeshSurface.getSphericalInterpolationFraction(0>this.voxelSource[p]?this.sr:this.atomRadius[this.voxelSource[p]-
1],c,e,h.length());r.scaleAdd2(a,h,d);return c+a*(e-c)},"~N,~B,~N,~N,JU.T3,JU.V3,~N,~N,~N,~N,~N,~A,JU.T3");m(c$,"addVertexCopy",function(a,b,c,e){a=this.addVC(a,b,c,e);if(0>a)return a;this.isSurfacePoint&&this.bsSurfacePoints.set(a);null!=this.params.vertexSource&&(this.params.vertexSource[a]=this.iAtomSurface);return a},"JU.T3,~N,~N,~B");m(c$,"selectPocket",function(a){null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,1,null);for(var b=this.meshData.vs,c=this.meshData.vc,
e=this.meshData.vvs,d=this.dots.length,h=0;h<c;h++)for(var f=0;f<d;f++)this.dots[f].distance(b[h])<this.envelopeRadius&&(e[h]=NaN);this.meshData.getSurfaceSet();b=this.meshData.nSets;c=JU.BS.newN(b);for(h=0;h<b;h++)if(null!=(e=this.meshData.surfaceSet[h]))for(f=e.nextSetBit(0);0<=f;f=e.nextSetBit(f+1))if(Float.isNaN(this.meshData.vvs[f])){c.set(h);break}for(h=0;h<b;h++)null!=this.meshData.surfaceSet[h]&&c.get(h)==a&&this.meshData.invalidateSurfaceSet(h);this.updateSurfaceData();a||(this.meshData.surfaceSet=
null);null!=this.meshDataServer&&(this.meshDataServer.fillMeshData(this.meshData,3,null),this.meshData=new J.jvxl.data.MeshData)},"~B");m(c$,"postProcessVertices",function(){this.setVertexSource();if(this.doCalculateTroughs&&null!=this.bsSurfacePoints){var a=new JU.BS,b=this.meshData.getSurfaceSet(),c=null,e=this.isPocket?null:J.jvxl.data.MeshData.calculateVolumeOrArea(this.meshData,null,!1,!1),d=this.isCavity?4.71238898038469*Math.pow(this.sr,3):0,h=0,f=!1;if(null!=e&&!this.isCavity)for(var g=0;g<
this.meshData.nSets;g++){var j=e[g];Math.abs(j)>h&&(h=Math.abs(j),f=0>j)}h=f?-1:1;for(g=0;g<this.meshData.nSets;g++)if(f=b[g],f.intersects(this.bsSurfacePoints)&&(null==e||e[g]*h>d)&&null!=this.params.vertexSource){j=new JU.BS;null==c&&(c=Array(b.length));for(var p=f.nextSetBit(0);0<=p;p=f.nextSetBit(p+1)){var l=this.params.vertexSource[p];if(!(0>l)){if(a.get(l)){this.meshData.invalidateSurfaceSet(g);break}j.set(l)}}a.or(j)}else this.meshData.invalidateSurfaceSet(g);this.updateSurfaceData();null!=
this.meshDataServer&&(this.meshDataServer.fillMeshData(this.meshData,3,null),this.meshData=new J.jvxl.data.MeshData)}null!=this.params.thePlane&&null==this.params.slabInfo&&this.params.addSlabInfo(JU.TempArray.getSlabWithinRange(-100,0))});d(c$,"generateSolventCavity",function(){for(var a=JU.BS.newN(this.nPointsX*this.nPointsY*this.nPointsZ),b=0,c=this.dots.length,e=0,d,h=this.envelopeRadius,f=0;f<this.nPointsX;++f)for(var g=0;g<this.nPointsY;++g){var j=0;a:for(;j<this.nPointsZ;++j,++b)if(3.4028235E38>
(d=this.voxelData[f][g][j])&&d>=this.cavityRadius){this.volumeData.voxelPtToXYZ(f,g,j,this.ptV);for(var p=0;p<c;p++)if(this.dots[p].distance(this.ptV)<h)continue a;a.set(b);e++}}JU.Logger.info("cavities include "+e+" voxel points");this.atomRadius=w(e,0);this.atomXyzTruncated=Array(e);for(c=b=f=0;f<this.nPointsX;++f)for(g=0;g<this.nPointsY;++g)for(j=0;j<this.nPointsZ;++j)a.get(b++)&&(this.volumeData.voxelPtToXYZ(f,g,j,this.atomXyzTruncated[c]=new JU.P3),this.atomRadius[c++]=this.voxelData[f][g][j]);
this.myAtomCount=this.firstNearbyAtom=e;this.thisAtomSet=JU.BSUtil.setAll(this.myAtomCount);this.rs=null;this.setRadii()});d(c$,"generateSolventCube",function(){1207!=this.dataType&&(this.params.vertexSource=u(this.volumeData.nPoints,0),this.bsSurfaceDone=new JU.BS,this.bsSurfaceVoxels=new JU.BS,this.bsSurfacePoints=new JU.BS,this.doCalculateTroughs?(this.iter=this.sg.atomDataServer.getSelectedAtomIterator(this.bsMySelected,!0,!1,!1),this.vEdges=new JU.Lst,this.bsLocale=Array(this.myAtomCount),this.htEdges=
new java.util.Hashtable,this.getEdges(),JU.Logger.info(this.vEdges.size()+" edges"),this.vFaces=new JU.Lst,this.getFaces(),JU.Logger.info(this.vFaces.size()+" faces"),this.htEdges=this.bsLocale=null,this.iter.release(),this.iter=null,this.newVoxelDataCube(),this.resetVoxelData(3.4028235E38),this.markFaceVoxels(!0),this.markToroidVoxels(),this.validSpheres.or(this.noFaceSpheres),this.vEdges=null,this.markFaceVoxels(!1),this.vFaces=null):(this.newVoxelDataCube(),this.resetVoxelData(3.4028235E38)),this.markSphereVoxels(0,
this.doCalculateTroughs?3.4028235E38:this.params.distance),this.validSpheres=this.noFaceSpheres=null)});d(c$,"getEdges",function(){for(var a=0;a<this.myAtomCount;a++)this.bsLocale[a]=new JU.BS;for(a=0;a<this.myAtomCount;a++){var b=this.atomXyzTruncated[a],c=this.rs[a];for(this.sg.atomDataServer.setIteratorForAtom(this.iter,this.atomIndex[a],c+this.maxRS);this.iter.hasNext();){var e=this.iter.next(),e=this.myIndex[e];if(!(a>=this.firstNearbyAtom&&e>=this.firstNearbyAtom)){var d=this.rs[e],h=b.distance(this.atomXyzTruncated[e]);
h>=c+d||(d=ta(J.jvxl.readers.IsoSolventReader.Edge,this,null,this,a,e,h),this.vEdges.addLast(d),this.bsLocale[a].set(e),this.bsLocale[e].set(a),this.htEdges.put(d.toString(),d))}}}});d(c$,"findEdge",function(a,b){return this.htEdges.get(a<b?a+"_"+b:b+"_"+a)},"~N,~N");d(c$,"getFaces",function(){var a=new JU.BS;this.params.surfaceAtoms=this.validSpheres=new JU.BS;this.noFaceSpheres=JU.BSUtil.setAll(this.myAtomCount);for(var b=this.vEdges.size();0<=--b;){var c=this.vEdges.get(b),e=c.ia,d=c.ib;a.clearAll();
a.or(this.bsLocale[e]);a.and(this.bsLocale[d]);for(var h=a.nextSetBit(d+1);0<=h;h=a.nextSetBit(h+1))if(this.getSolventPoints(c,e,d,h)){var f,g=!1;if(null!=(f=this.validateFace(e,d,h,c,this.ptS1)))this.vFaces.addLast(f),g=!0;if(null!=(f=this.validateFace(e,d,h,c,this.ptS2)))this.vFaces.addLast(f),g=!0;g&&(this.noFaceSpheres.clear(e),this.noFaceSpheres.clear(d),this.noFaceSpheres.clear(h))}}});d(c$,"validateFace",function(a,b,c,e,d){this.sg.atomDataServer.setIteratorForPoint(this.iter,this.modelIndex,
d,this.maxRS);for(var h=!0;this.iter.hasNext();){var f=this.iter.next(),g=this.myIndex[f];if(!(g==a||g==b||g==c)&&this.atomData.atoms[f].distance(d)<this.atomData.atomRadius[f]+this.sr){h=!1;break}}f=this.findEdge(b,c);g=this.findEdge(a,c);d=h?ta(J.jvxl.readers.IsoSolventReader.Face,this,null,a,b,c,d):null;e.addFace(d);f.addFace(d);g.addFace(d);if(!h)return null;this.validSpheres.set(a);this.validSpheres.set(b);this.validSpheres.set(c);return d},"~N,~N,~N,J.jvxl.readers.IsoSolventReader.Edge,JU.P3");
d(c$,"markFaceVoxels",function(a){for(var b=new JU.BS,c=this.volumetricVectors[0],e=this.volumetricVectors[1],d=this.volumetricVectors[2],h=this.vFaces.size();0<=--h;){var f=this.vFaces.get(h),g=this.atomXyzTruncated[f.ia],j=this.atomXyzTruncated[f.ib],p=this.atomXyzTruncated[f.ic],l=f.pS;this.setGridLimitsForAtom(l,this.sr,this.pt0,this.pt1);this.volumeData.voxelPtToXYZ(this.pt0.x,this.pt0.y,this.pt0.z,this.ptV);for(var m=this.pt0.x;m<this.pt1.x;m++,this.ptV.add2(c,this.ptY0)){this.ptY0.setT(this.ptV);
for(var r=this.pt0.y;r<this.pt1.y;r++,this.ptV.add2(e,this.ptZ0)){this.ptZ0.setT(this.ptV);for(var u=this.pt0.z;u<this.pt1.z;u++,this.ptV.add(d)){var v=this.sr-this.ptV.distance(l),w=this.voxelData[m][r][u],y=this.volumeData.getPointIndex(m,r,u);a&&0<v&&this.bsSurfaceDone.set(y);if(JU.Measure.isInTetrahedron(this.ptV,g,j,p,l,this.plane,this.vTemp,this.vTemp2,!1)&&(!a?!this.bsSurfaceDone.get(y)&&0>v&&v>1.8*-this.volumeData.maxGrid&&v>w==b.get(y):0<v&&(0>w||3.4028235E38==w||v>w==b.get(y))))b.set(y),
this.setVoxel(m,r,u,y,v),null!=this.voxelSource&&(this.voxelSource[y]=-1-f.ia),0<v&&this.bsSurfaceVoxels.set(y)}}}}},"~B");d(c$,"markToroidVoxels",function(){for(var a=this.volumetricVectors[0],b=this.volumetricVectors[1],c=this.volumetricVectors[2],e=this.vEdges.size();0<=--e;){var d=this.vEdges.get(e);if(d.isValid()){var h=d.ia,f=d.ib,g=this.atomXyzTruncated[h],j=this.atomXyzTruncated[f];this.rAS=this.rs[h];this.rBS=this.rs[f];this.rAS2=this.rs2[h];this.rBS2=this.rs2[f];this.dAB=d.d;this.dAB2=d.d2;
this.ecosASB2=d.cosASB2;this.setGridLimitsForAtom(d,d.maxr,this.pt0,this.pt1);this.volumeData.voxelPtToXYZ(this.pt0.x,this.pt0.y,this.pt0.z,this.ptV);for(d=this.pt0.x;d<this.pt1.x;d++,this.ptV.add2(a,this.ptY0)){this.ptY0.setT(this.ptV);for(f=this.pt0.y;f<this.pt1.y;f++,this.ptV.add2(b,this.ptZ0)){this.ptZ0.setT(this.ptV);for(var p=this.pt0.z;p<this.pt1.z;p++,this.ptV.add(c)){var l=this.checkSpecialVoxel(g,j,this.ptV);if(!Float.isNaN(l)&&(l=this.sr-l,l<this.voxelData[d][f][p])){var m=this.volumeData.getPointIndex(d,
f,p);this.setVoxel(d,f,p,m,l);null!=this.voxelSource&&(this.voxelSource[m]=-1-h)}}}}}}});m(c$,"unsetVoxelData",function(){if(this.havePlane)if(this.isProgressive)for(var a=0;a<this.yzCount;a++)0.001>this.thisPlane[a]||(this.thisPlane[a]=0.001);else for(a=0;a<this.nPointsX;++a)for(var b=0;b<this.nPointsY;++b)for(var c=0;c<this.nPointsZ;++c)0.001>this.voxelData[a][b][c]||(this.voxelData[a][b][c]=0.001);else this.unsetVoxelData2()});d(c$,"getSolventPoints",function(a,b,c,e){var d=this.rs[b],h=a.v;a=
(a.d2+this.rs2[b]-this.rs2[c])/(2*a.d*d);c=Math.acos(a);this.p.scaleAdd2(a*d,h,this.atomXyzTruncated[b]);JU.Measure.getPlaneThroughPoint(this.p,h,this.plane);b=Math.sin(c)*d;a=this.atomXyzTruncated[e];c=this.rs[e];d=JU.Measure.distanceToPlane(this.plane,a);if(Math.abs(d)>=0.9*c)return!1;this.ptTemp.scaleAdd2(-d,h,a);a=this.p.distance(this.ptTemp);e=(b*b+a*a-(this.rs2[e]-d*d))/(2*b*a);if(0.99<=Math.abs(e))return!1;d=this.vTemp2;d.sub2(this.ptTemp,this.p);d.normalize();this.ptTemp.scaleAdd2(b*e,d,this.p);
d.cross(h,d);d.normalize();d.scale(Math.sqrt(1-e*e)*b);this.ptS1.add2(this.ptTemp,d);this.ptS2.sub2(this.ptTemp,d);return!0},"J.jvxl.readers.IsoSolventReader.Edge,~N,~N,~N");d(c$,"checkSpecialVoxel",function(a,b,c){var e=a.distance(c),d=a.distanceSquared(c),h=this.rAS/e;if(1<h)return this.p.set(a.x+(c.x-a.x)*h,a.y+(c.y-a.y)*h,a.z+(c.z-a.z)*h),b.distanceSquared(this.p)>=this.rBS2?NaN:this.solventDistance(this.rAS,this.rAS2,this.rBS2,e,d,b.distanceSquared(c));e=b.distance(c);return 1<(h=this.rBS/e)?
(this.p.set(b.x+(c.x-b.x)*h,b.y+(c.y-b.y)*h,b.z+(c.z-b.z)*h),a.distanceSquared(this.p)>=this.rAS2?NaN:this.solventDistance(this.rBS,this.rBS2,this.rAS2,e,e*e,d)):NaN},"JU.P3,JU.P3,JU.P3");d(c$,"solventDistance",function(a,b,c,e,d,h){h=Math.acos((d+this.dAB2-h)/(2*e*this.dAB));c=Math.acos((b+this.dAB2-c)/(2*a*this.dAB));d=b+d-2*a*e*Math.cos(c-h);c=Math.sqrt(d);return this.ecosASB2<(b+d-e*e)/(c*a)?c:NaN},"~N,~N,~N,~N,~N,~N");d(c$,"dumpLine",function(a,b,c,e){this.sg.log('draw ID "x'+c+this.nTest++ +
'" '+JU.P3.newP(a)+" "+JU.P3.newP(b)+" color "+e)},"JU.P3,JU.T3,~S,~S");d(c$,"dumpLine2",function(a,b,c,e,d,h){var f=new JU.V3;f.setT(b);f.sub(a);f.normalize();f.scale(e);f.add(a);this.sg.log('draw ID "'+c+this.nTest++ +'" '+JU.P3.newP(a)+" "+JU.P3.newP(f)+" color "+d);this.sg.log('draw ID "'+c+this.nTest++ +'"'+JU.P3.newP(f)+" "+JU.P3.newP(b)+" color "+h+'"'+c+'"')},"JU.P3,JU.P3,~S,~N,~S,~S");d(c$,"dumpPoint",function(a,b,c){this.sg.log('draw ID "'+b+this.nTest++ +'"'+JU.P3.newP(a)+" color "+c)},
"JU.P3,~S,~S");m(c$,"getValueAtPoint",function(a){if(null!=this.contactPair)return a.distance(this.contactPair.myAtoms[1])-this.contactPair.radii[1];for(var b=3.4028235E38,c=0;c<this.firstNearbyAtom;c++){var e=a.distance(this.atomXyzTruncated[c])-this.rs[c];e<b&&(b=e)}return 3.4028235E38==b?NaN:b},"JU.T3,~B");m(c$,"discardTempData",function(a){this.rs2=this.rs=null;this.discardTempDataSR(a)},"~B");m(c$,"getPlane",function(a){0==this.yzCount&&this.initPlanes();this.thisX=a;this.thisPlane=this.yzPlanes[a%
2];null==this.contactPair?(this.resetPlane(3.4028235E38),this.thisAtomSet=this.bsAtomMinMax[a],this.markSphereVoxels(0,this.params.distance),this.unsetVoxelData()):this.markPlaneVoxels(this.contactPair.myAtoms[0],this.contactPair.radii[0]);return this.thisPlane},"~N");c$.$IsoSolventReader$Edge$=function(){na(self.c$);c$=H(function(){ua(this,arguments);this.cosASB2=this.maxr=this.d2=this.d=this.nInvalid=this.nFaces=this.ib=this.ia=0;this.v=null;P(this,arguments)},J.jvxl.readers.IsoSolventReader,"Edge",
JU.P3);fb(c$,function(a,b,c,e){this.ia=Math.min(b,c);this.ib=Math.max(b,c);this.d=e;this.d2=e*e;this.maxr=Math.sqrt(this.d2/4+Math.max(a.rs2[b],a.rs2[c]));this.ave(a.atomXyzTruncated[b],a.atomXyzTruncated[c]);this.cosASB2=(a.rs2[b]+a.rs2[c]-this.d2)/(a.rs[c]*a.rs[b]);this.v=JU.V3.newVsub(a.atomXyzTruncated[c],a.atomXyzTruncated[b]);this.v.normalize()},"J.jvxl.readers.IsoSolventReader,~N,~N,~N");d(c$,"addFace",function(a){this.nFaces++;null==a&&this.nInvalid++},"J.jvxl.readers.IsoSolventReader.Face");
d(c$,"isValid",function(){return 0==this.nFaces||this.nInvalid!=this.nFaces});m(c$,"toString",function(){return this.ia+"_"+this.ib});c$=ma()};c$.$IsoSolventReader$Face$=function(){na(self.c$);c$=H(function(){ua(this,arguments);this.ic=this.ib=this.ia=0;this.pS=null;P(this,arguments)},J.jvxl.readers.IsoSolventReader,"Face");W(c$,function(a,b,c,e){this.ia=a;this.ib=b;this.ic=c;this.pS=JU.P3.newP(e)},"~N,~N,~N,JU.P3");m(c$,"toString",function(){return this.ia+"_"+this.ib+"_"+this.ic+"_"+this.pS});c$=
ma()};Z(c$,"testLinear",!1)});O("J.jvxl.readers");F(["J.jvxl.readers.SurfaceReader"],"J.jvxl.readers.SurfaceFileReader",["JU.PT","J.api.Interface"],function(){c$=H(function(){this.next=this.line=this.out=this.binarydoc=this.br=null;P(this,arguments)},J.jvxl.readers,"SurfaceFileReader",J.jvxl.readers.SurfaceReader);ha(c$,function(){this.next=u(1,0)});W(c$,function(){da(this,J.jvxl.readers.SurfaceFileReader,[])});d(c$,"setStream",function(a,b){if(null==a)this.binarydoc.setStream(null,b);else try{if(T(this.br,
JU.Rdr.StreamReader)){var c=this.br.getStream();c.reset();this.binarydoc.setStream(c,!0)}}catch(e){if(Y(e,Exception))System.out.println("BCifDensityReader "+e),this.binarydoc.setStream(this.sg.atomDataServer.getBufferedInputStream(a),b);else throw e;}},"~S,~B");m(c$,"init",function(a){this.initSR(a)},"J.jvxl.readers.SurfaceGenerator");d(c$,"init2",function(a,b){this.init2SFR(a,b)},"J.jvxl.readers.SurfaceGenerator,java.io.BufferedReader");d(c$,"init2SFR",function(a,b){this.br=b;this.init(a)},"J.jvxl.readers.SurfaceGenerator,java.io.BufferedReader");
d(c$,"newBinaryDocument",function(){return J.api.Interface.getInterface("JU.BinaryDocument",this.sg.atomDataServer,"file")});m(c$,"setOutputChannel",function(a){null==this.binarydoc?this.out=a:this.sg.setOutputChannel(this.binarydoc,a)},"JU.OC");m(c$,"closeReader",function(){this.closeReaderSFR()});d(c$,"closeReaderSFR",function(){if(null!=this.br)try{this.br.close()}catch(a){if(!Y(a,java.io.IOException))throw a;}null!=this.out&&this.out.closeChannel();null!=this.binarydoc&&this.binarydoc.close()});
m(c$,"discardTempData",function(a){this.closeReader();this.discardTempDataSR(a)},"~B");d(c$,"getTokens",function(){return JU.PT.getTokensAt(this.line,0)});d(c$,"parseFloat",function(){return JU.PT.parseFloatNext(this.line,this.next)});d(c$,"parseFloatStr",function(a){this.next[0]=0;return JU.PT.parseFloatNext(a,this.next)},"~S");d(c$,"parseFloatRange",function(a,b,c){this.next[0]=b;return JU.PT.parseFloatRange(a,c,this.next)},"~S,~N,~N");d(c$,"parseInt",function(){return JU.PT.parseIntNext(this.line,
this.next)});d(c$,"parseIntStr",function(a){this.next[0]=0;return JU.PT.parseIntNext(a,this.next)},"~S");d(c$,"parseIntNext",function(a){return JU.PT.parseIntNext(a,this.next)},"~S");d(c$,"parseFloatArrayStr",function(a){this.next[0]=0;return JU.PT.parseFloatArrayNext(a,this.next,null,null,null)},"~S");d(c$,"parseFloatArray",function(a,b,c){return JU.PT.parseFloatArrayNext(this.line,this.next,a,b,c)},"~A,~S,~S");d(c$,"getQuotedStringNext",function(){return JU.PT.getQuotedStringNext(this.line,this.next)});
d(c$,"skipTo",function(a,b){if(null!=a)for(;0>this.rd().indexOf(a););null!=b&&(this.next[0]=this.line.indexOf(b)+b.length+2)},"~S,~S");d(c$,"rd",function(){this.line=this.br.readLine();if(null!=this.line&&(this.nBytes+=this.line.length,null!=this.out)){var a=this.line.getBytes();this.out.write(a,0,a.length);this.out.writeByteAsInt(10)}return this.line})});O("J.jvxl.readers");F(["J.jvxl.readers.SurfaceFileReader"],"J.jvxl.readers.VolumeFileReader","java.lang.Float JU.AU $.PT $.SB J.api.Interface J.atomdata.AtomData JU.Logger".split(" "),
function(){c$=H(function(){this.negativeAtomCount=this.endOfData=!1;this.nSurfaces=this.ac=0;this.canDownsample=this.isAngstroms=!1;this.downsampleRemainders=null;this.getNCIPlanes=!1;this.nData=0;this.readerClosed=!1;this.nSkipZ=this.nSkipY=this.nSkipX=this.downsampleFactor=0;this.yzPlanesRaw=null;this.iPlaneNCI=0;this.boundingBox=null;this.isScaledAlready=!1;P(this,arguments)},J.jvxl.readers,"VolumeFileReader",J.jvxl.readers.SurfaceFileReader);W(c$,function(){da(this,J.jvxl.readers.VolumeFileReader,
[])});m(c$,"init2",function(a,b){this.init2VFR(a,b)},"J.jvxl.readers.SurfaceGenerator,java.io.BufferedReader");d(c$,"init2VFR",function(a,b){this.init2SFR(a,b);this.canDownsample=this.isProgressive=this.isXLowToHigh=!0;this.jvxlData.wasCubic=!0;this.boundingBox=this.params.boundingBox;4==this.params.qmOrbitalType&&(this.hasColorData=null==this.params.parameters||0<=this.params.parameters[1],this.getNCIPlanes=!0,this.params.insideOut=!this.params.insideOut)},"J.jvxl.readers.SurfaceGenerator,java.io.BufferedReader");
d(c$,"recordData",function(a){if(Float.isNaN(a))return a;a<this.dataMin&&(this.dataMin=a);a>this.dataMax&&(this.dataMax=a);this.dataMean+=a;this.nData++;return a},"~N");m(c$,"closeReader",function(){this.readerClosed||(this.readerClosed=!0,this.closeReaderSFR(),0==this.nData||-3.4028235E38==this.dataMax||(this.dataMean/=this.nData,JU.Logger.info("VolumeFileReader closing file: "+this.nData+" points read \ndata min/max/mean = "+this.dataMin+"/"+this.dataMax+"/"+this.dataMean)))});m(c$,"readVolumeParameters",
function(){this.endOfData=!1;this.nSurfaces=this.readVolumetricHeader();if(0==this.nSurfaces)return!1;this.nSurfaces<this.params.fileIndex&&(JU.Logger.warn("not enough surfaces in file -- resetting params.fileIndex to "+this.nSurfaces),this.params.fileIndex=this.nSurfaces);return!0},"~B");m(c$,"readVolumeData",function(a){return this.readVolumeDataVFR(a)},"~B");d(c$,"readVolumeDataVFR",function(a){if(!this.gotoAndReadVoxelData(a))return!1;this.vertexDataOnly||JU.Logger.info("JVXL read: "+this.nPointsX+
" x "+this.nPointsY+" x "+this.nPointsZ+" data points");return!0},"~B");d(c$,"readVolumetricHeader",function(){try{this.readParameters();if(-2147483648==this.ac)return 0;this.vertexDataOnly||JU.Logger.info("voxel grid origin:"+this.volumetricOrigin);var a=this.params.downsampleFactor,b=this.canDownsample&&1<a;1<a&&!this.canDownsample&&(this.jvxlData.msg+="\ncannot downsample this file type");if(b){this.downsampleRemainders=u(3,0);JU.Logger.info("downsample factor = "+a);for(var c=0;3>c;++c){var e=
this.voxelCounts[c];this.downsampleRemainders[c]=e%a;this.voxelCounts[c]/=a;this.isPeriodic&&(this.voxelCounts[c]++,this.downsampleRemainders[c]--);this.volumetricVectors[c].scale(a);JU.Logger.info("downsampling axis "+(c+1)+" from "+e+" to "+this.voxelCounts[c])}}if(!this.vertexDataOnly)for(c=0;3>c;++c)this.isAngstroms||this.volumetricVectors[c].scale(0.5291772),this.line=this.voxelCounts[c]+" "+this.volumetricVectors[c].x+" "+this.volumetricVectors[c].y+" "+this.volumetricVectors[c].z,JU.Logger.info("voxel grid count/vector:"+
this.line);this.scaleIsosurface(this.params.scale);this.volumeData.setVolumetricXml();return this.nSurfaces}catch(d){if(Y(d,Exception))return JU.Logger.error(d.toString()),0;throw d;}});d(c$,"skipComments",function(a){for(var b=new JU.SB;null!=this.rd()&&(a&&0==this.line.length||0==this.line.indexOf("#"));)b.append(this.line).appendC("\n");return b.toString()},"~B");d(c$,"readVoxelVector",function(a){this.rd();var b=this.volumetricVectors[a];if(-2147483648==(this.voxelCounts[a]=this.parseIntStr(this.line)))this.next[0]=
this.line.indexOf(" ");b.set(this.parseFloat(),this.parseFloat(),this.parseFloat());this.isAnisotropic&&this.setVectorAnisotropy(b)},"~N");d(c$,"initializeSurfaceData",function(){this.downsampleFactor=this.params.downsampleFactor;this.nSkipZ=this.nSkipY=this.nSkipX=0;this.canDownsample&&0<this.downsampleFactor&&(this.nSkipX=this.downsampleFactor-1,this.nSkipY=this.downsampleRemainders[2]+(this.downsampleFactor-1)*(this.nSkipZ=(this.nPointsZ-(this.isPeriodic?1:0))*this.downsampleFactor+this.downsampleRemainders[2]),
this.nSkipZ=this.downsampleRemainders[1]*this.nSkipZ+(this.downsampleFactor-1)*this.nSkipZ*((this.nPointsY-(this.isPeriodic?1:0))*this.downsampleFactor+this.downsampleRemainders[1]));null!=this.params.thePlane?this.params.cutoff=0:this.isJvxl&&(this.params.cutoff=this.params.isBicolorMap||this.params.colorBySign?0.01:this.getJVXLCutoff());this.nDataPoints=0;this.next[0]=0;this.line="";this.jvxlNSurfaceInts=0});d(c$,"getJVXLCutoff",function(){return 0.5});m(c$,"readSurfaceData",function(a){this.readSurfaceDataVFR(a)},
"~B");d(c$,"readSurfaceDataVFR",function(a){this.initializeSurfaceData();if(this.isProgressive&&!a||this.isJvxl)this.nDataPoints=this.volumeData.setVoxelCounts(this.nPointsX,this.nPointsY,this.nPointsZ),this.voxelData=null,this.isJvxl&&(this.jvxlVoxelBitSet=this.getVoxelBitSet(this.nDataPoints));else if(a&&this.volumeData.hasPlane()){this.volumeData.setVoxelMap();var b=this.volumeData.getToPlaneParameter();for(a=0;a<this.nPointsX;++a){for(var c=0;c<this.nPointsY;++c){for(var e=0;e<this.nPointsZ;++e){var d=
this.recordData(this.getNextVoxelValue());this.volumeData.isNearPlane(a,c,e,b)&&this.volumeData.setVoxelMapValue(a,c,e,d);0!=this.nSkipX&&this.skipVoxels(this.nSkipX)}0!=this.nSkipY&&this.skipVoxels(this.nSkipY)}0!=this.nSkipZ&&this.skipVoxels(this.nSkipZ)}}else{this.voxelData=JU.AU.newFloat3(this.nPointsX,-1);for(a=0;a<this.nPointsX;++a){b=JU.AU.newFloat2(this.nPointsY);this.voxelData[a]=b;for(c=0;c<this.nPointsY;++c){d=w(this.nPointsZ,0);b[c]=d;for(e=0;e<this.nPointsZ;++e)d[e]=this.recordData(this.getNextVoxelValue()),
0!=this.nSkipX&&this.skipVoxels(this.nSkipX);0!=this.nSkipY&&this.skipVoxels(this.nSkipY)}0!=this.nSkipZ&&this.skipVoxels(this.nSkipZ)}}this.volumeData.setVoxelDataAsArray(this.voxelData)},"~B");m(c$,"getPlane",function(a){0==a&&this.initPlanes();if(this.getNCIPlanes)return this.getPlaneNCI(a);a=this.getPlaneSR(a);null==this.qpc&&this.getPlaneVFR(a,!0);return a},"~N");d(c$,"getPlaneNCI",function(a){var b;if(0==this.iPlaneNCI){this.qpc=J.api.Interface.getOption("quantum.NciCalculation",this.sg.atomDataServer,
null);b=new J.atomdata.AtomData;b.modelIndex=-1;b.bsSelected=this.params.bsSelected;this.sg.fillAtomData(b,1);this.qpc.setupCalculation(this.volumeData,this.sg.params.bsSelected,null,null,b.atoms,-1,!0,null,this.params.parameters,this.params.testFlags);this.iPlaneNCI=1;this.qpc.setPlanes(this.yzPlanesRaw=w(4,this.yzCount,0));if(this.hasColorData){this.getPlaneVFR(this.yzPlanesRaw[0],!1);this.getPlaneVFR(this.yzPlanesRaw[1],!1);b=this.yzPlanes[0];for(a=0;a<this.yzCount;a++)b[a]=NaN;return b}this.iPlaneNCI=
-1}var c=this.qpc.getNoValue(),e=this.nPointsX-1;switch(this.iPlaneNCI){case -1:b=this.yzPlanes[a%2];e++;break;case 3:b=this.yzPlanesRaw[0];this.yzPlanesRaw[0]=this.yzPlanesRaw[1];this.yzPlanesRaw[1]=this.yzPlanesRaw[2];this.yzPlanesRaw[2]=this.yzPlanesRaw[3];this.yzPlanesRaw[3]=b;b=this.yzPlanesRaw[this.iPlaneNCI];break;default:this.iPlaneNCI++,b=this.yzPlanesRaw[this.iPlaneNCI]}if(a<e){this.getPlaneVFR(b,!1);this.qpc.calcPlane(a,b=this.yzPlanes[a%2]);for(a=0;a<this.yzCount;a++)b[a]!=c&&this.recordData(b[a])}else for(a=
0;a<this.yzCount;a++)b[a]=NaN;return b},"~N");d(c$,"getPlaneVFR",function(a,b){try{for(var c=0,e=0;c<this.nPointsY;++c){for(var d=0;d<this.nPointsZ;++d){var h=this.getNextVoxelValue();b&&this.recordData(h);a[e++]=h;0!=this.nSkipX&&this.skipVoxels(this.nSkipX)}0!=this.nSkipY&&this.skipVoxels(this.nSkipY)}0!=this.nSkipZ&&this.skipVoxels(this.nSkipZ)}catch(f){if(!Y(f,Exception))throw f;}},"~A,~B");m(c$,"getValue",function(a,b,c,e){return null!=this.boundingBox&&(this.volumeData.voxelPtToXYZ(a,b,c,this.ptTemp),
this.ptTemp.x<this.boundingBox[0].x||this.ptTemp.x>this.boundingBox[1].x||this.ptTemp.y<this.boundingBox[0].y||this.ptTemp.y>this.boundingBox[1].y||this.ptTemp.z<this.boundingBox[0].z||this.ptTemp.z>this.boundingBox[1].z)?NaN:this.getValue2(a,b,c,e)},"~N,~N,~N,~N");d(c$,"skipVoxels",function(a){for(;0<=--a;)this.getNextVoxelValue()},"~N");d(c$,"getVoxelBitSet",function(){return null},"~N");d(c$,"getNextVoxelValue",function(){var a=0;if(1<this.nSurfaces&&!this.params.blockCubeData){for(var b=1;b<this.params.fileIndex;b++)this.nextVoxel();
a=this.nextVoxel();for(b=this.params.fileIndex;b<this.nSurfaces;b++)this.nextVoxel()}else a=this.nextVoxel();return a});d(c$,"nextVoxel",function(){var a=this.parseFloat();if(Float.isNaN(a)){for(;null!=this.rd()&&Float.isNaN(a=this.parseFloatStr(this.line)););null==this.line&&(this.endOfData||JU.Logger.warn("end of file reading cube voxel data? nBytes="+this.nBytes+" nDataPoints="+this.nDataPoints+" (line):"+this.line),this.endOfData=!0,this.line="0 0 0 0 0 0 0 0 0 0")}return a});m(c$,"gotoData",
function(a,b){if(this.params.blockCubeData){0<a&&JU.Logger.info("skipping "+a+" data sets, "+b+" points each");for(var c=0;c<a;c++)this.skipData(b)}},"~N,~N");d(c$,"skipData",function(a){this.skipDataVFR(a)},"~N");d(c$,"skipDataVFR",function(a){for(var b=0;b<a;)b+=this.countData(this.rd())},"~N");d(c$,"countData",function(a){for(var b=0,c=0,e=a.length,d;c<e;){for(;c<e&&(" "==(d=a.charAt(c))||"\t"==d);)++c;for(c<e&&++b;c<e&&" "!=(d=a.charAt(c))&&"\t"!=d;)++c}return b},"~S");c$.checkAtomLine=d(c$,"checkAtomLine",
function(a,b,c,e,d){0<=e.indexOf("ANGSTROMS")&&(b=!0);c=null==c?2147483647:JU.PT.parseInt(c);switch(c){case -2147483648:c=0;e=" "+e.substring(e.indexOf(" ")+1);break;case 2147483647:c=-2147483648;break;default:var h=""+c;e=e.substring(e.indexOf(h)+h.length)}b?0>e.indexOf("ANGSTROM")&&(e+=" ANGSTROMS"):0>e.indexOf("BOHR")&&(e+=" BOHR");e=(-2147483648==c?"":(a?"+":"-")+Math.abs(c))+e+"\n";d.append(e);return b},"~B,~B,~S,~S,JU.SB");m(c$,"getSurfacePointAndFraction",function(a,b,c,e,d,h,f,g,j,p,l,m,r){return this.getSPFv(a,
b,c,e,d,h,f,g,j,p,l,m,r)},"~N,~B,~N,~N,JU.T3,JU.V3,~N,~N,~N,~N,~N,~A,JU.T3");d(c$,"getSPFv",function(a,b,c,e,d,h,f,g,j,p,l,m,r){a=this.getSPF(a,b,c,e,d,h,f,g,j,p,l,m,r);if(null==this.qpc||Float.isNaN(a)||!this.hasColorData)return a;p=this.marchingCubes.getLinearOffset(f,g,j,p);l=this.marchingCubes.getLinearOffset(f,g,j,l);return this.qpc.process(p,l,m[0])},"~N,~B,~N,~N,JU.T3,JU.V3,~N,~N,~N,~N,~N,~A,JU.T3");d(c$,"scaleIsosurface",function(a){this.isScaledAlready||(this.isScaledAlready=!0,this.isAnisotropic&&
this.setVolumetricAnisotropy(),Float.isNaN(a)||(JU.Logger.info("applying scaling factor of "+a),this.volumetricOrigin.scaleAdd2((1-a)/2,this.volumetricVectors[0],this.volumetricOrigin),this.volumetricOrigin.scaleAdd2((1-a)/2,this.volumetricVectors[1],this.volumetricOrigin),this.volumetricOrigin.scaleAdd2((1-a)/2,this.volumetricVectors[2],this.volumetricOrigin),this.volumetricVectors[0].scale(a),this.volumetricVectors[1].scale(a),this.volumetricVectors[2].scale(a)))},"~N");d(c$,"swapXZ",function(){var a=
this.volumetricVectors[0];this.volumetricVectors[0]=this.volumetricVectors[2];this.volumetricVectors[2]=a;a=this.voxelCounts[0];this.voxelCounts[0]=this.voxelCounts[2];this.voxelCounts[2]=a;this.params.insideOut=!this.params.insideOut})});O("J.jvxl.readers");F(["J.jvxl.readers.VolumeFileReader"],"J.jvxl.readers.JvxlXmlReader","java.lang.Double $.Float $.NullPointerException java.util.Hashtable JU.AU $.BS $.CU $.Lst $.P3 $.P4 $.PT $.SB J.jvxl.data.JvxlCoder $.MeshData J.jvxl.readers.XmlReader J.shapesurface.IsosurfaceMesh JU.C $.ColorEncoder $.Escape $.Logger".split(" "),
function(){c$=H(function(){this.JVXL_VERSION="2.3";this.invalidatedVertexCount=this.excludedVertexCount=this.excludedTriangleCount=this.colorDataCount=this.edgeDataCount=this.surfaceDataCount=0;this.haveContourData=!1;this.xr=null;this.isXmlFile=!0;this.thisInside=!1;this.bsVoxelBitSet=this.tempDataXml=null;this.includeValueNaN=!0;this.valueCount=0;this.valueRange=this.valueMin=NaN;this.colorPtr=this.fractionPtr=0;this.strFractionTemp="";this.haveReadColorData=!1;this.jvxlColorEncodingRead=null;P(this,
arguments)},J.jvxl.readers,"JvxlXmlReader",J.jvxl.readers.VolumeFileReader);W(c$,function(){da(this,J.jvxl.readers.JvxlXmlReader,[])});m(c$,"init2",function(a,b){this.init2JXR(a,b)},"J.jvxl.readers.SurfaceGenerator,java.io.BufferedReader");d(c$,"init2JXR",function(a,b){this.init2VFR(a,b);this.jvxlData.wasJvxl=this.isJvxl=!0;this.isXLowToHigh=this.canDownsample=!1;this.xr=new J.jvxl.readers.XmlReader(b)},"J.jvxl.readers.SurfaceGenerator,java.io.BufferedReader");m(c$,"readVolumeData",function(a){if(!this.readVolumeDataVFR(a))return!1;
this.strFractionTemp=this.jvxlEdgeDataRead;this.fractionPtr=0;return!0},"~B");m(c$,"gotoAndReadVoxelData",function(a){this.initializeVolumetricData();if(0>this.nPointsX||0>this.nPointsY||0>this.nPointsZ)return!0;try{this.gotoData(this.params.fileIndex-1,this.nPointsX*this.nPointsY*this.nPointsZ);if(this.vertexDataOnly)return!0;this.volumeData.setMappingPlane(this.params.thePlane);this.readSurfaceData(a);this.volumeData.setMappingPlane(null);0<this.edgeDataCount&&(this.jvxlEdgeDataRead=this.jvxlReadFractionData("edge",
this.edgeDataCount));this.params.bsExcluded=this.jvxlData.jvxlExcluded=Array(4);if(this.hasColorData=0<this.colorDataCount)this.jvxlColorDataRead=this.jvxlReadFractionData("color",this.colorDataCount);0<this.excludedVertexCount&&(this.jvxlData.jvxlExcluded[0]=J.jvxl.data.JvxlCoder.jvxlDecodeBitSet(this.xr.getXmlData("jvxlExcludedVertexData",null,!1,!1)),this.xr.isNext("jvxlExcludedPlaneData")&&(this.jvxlData.jvxlExcluded[2]=J.jvxl.data.JvxlCoder.jvxlDecodeBitSet(this.xr.getXmlData("jvxlExcludedPlaneData",
null,!1,!1))));0<this.excludedTriangleCount&&(this.jvxlData.jvxlExcluded[3]=J.jvxl.data.JvxlCoder.jvxlDecodeBitSet(this.xr.getXmlData("jvxlExcludedTriangleData",null,!1,!1)));0<this.invalidatedVertexCount&&(this.jvxlData.jvxlExcluded[1]=J.jvxl.data.JvxlCoder.jvxlDecodeBitSet(this.xr.getXmlData("jvxlInvalidatedVertexData",null,!1,!1)));this.haveContourData&&this.jvxlDecodeContourData(this.jvxlData,this.xr.getXmlData("jvxlContourData",null,!1,!1));if(this.jvxlDataIsColorMapped&&0<this.jvxlData.nVertexColors){this.jvxlData.vertexColorMap=
new java.util.Hashtable;var b=this.xr.getXmlData("jvxlVertexColorData",null,!0,!1),c=J.jvxl.readers.XmlReader.getXmlAttrib(b,"baseColor");this.jvxlData.baseColor=0<c.length?c:null;for(a=0;a<this.jvxlData.nVertexColors;a++){var e=this.xr.getXmlData("jvxlColorMap",b,!0,!1),d=J.jvxl.readers.XmlReader.getXmlAttrib(e,"color"),h=J.jvxl.data.JvxlCoder.jvxlDecodeBitSet(this.xr.getXmlData("jvxlColorMap",e,!1,!1));this.jvxlData.vertexColorMap.put(d,h)}}}catch(f){if(Y(f,Exception))return JU.Logger.error(f.toString()),
!1;throw f;}return!0},"~B");m(c$,"readParameters",function(){var a=this.xr.getXmlDataLF("jvxlFileTitle",null,!1,!1,!0);this.jvxlFileHeaderBuffer=JU.SB.newS(null==a?"":a);this.xr.toTag("jvxlVolumeData");a=this.tempDataXml=this.xr.getXmlData("jvxlVolumeData",null,!0,!1);this.volumetricOrigin.setT(this.xr.getXmlPoint(a,"origin"));this.isAngstroms=!0;this.readVector(0);this.readVector(1);this.readVector(2);this.line=this.xr.toTag("jvxlSurfaceSet");this.nSurfaces=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(this.line,
"count"));JU.Logger.info("jvxl file surfaces: "+this.nSurfaces);JU.Logger.info("using default edge fraction base and range");JU.Logger.info("using default color fraction base and range");this.cJvxlEdgeNaN=String.fromCharCode(this.edgeFractionBase+this.edgeFractionRange)});m(c$,"getJVXLCutoff",function(){return this.params.cutoff});d(c$,"readVector",function(a){var b=this.xr.getXmlData("jvxlVolumeVector",this.tempDataXml,!0,!0);this.tempDataXml=this.tempDataXml.substring(this.tempDataXml.indexOf(b)+
b.length);var c=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(b,"count"));-2147483648==c&&(this.vertexDataOnly=!0);this.voxelCounts[a]=0>c?0:c;this.volumetricVectors[a].setT(this.xr.getXmlPoint(b,"vector"));this.isAnisotropic&&this.setVectorAnisotropy(this.volumetricVectors[a])},"~N");m(c$,"gotoData",function(a,b){0<a&&JU.Logger.info("skipping "+a+" data sets, "+b+" points each");this.vertexDataOnly=this.jvxlData.vertexDataOnly=0==b;for(var c=0;c<a;c++)this.jvxlSkipData(b,!0);this.xr.toTag("jvxlSurface");
this.jvxlReadSurfaceInfo()},"~N,~N");d(c$,"jvxlSkipData",function(){this.rd();this.xr.skipTag("jvxlSurface")},"~N,~B");d(c$,"jvxlReadSurfaceInfo",function(){var a=this.xr.getXmlData("jvxlSurfaceInfo",null,!0,!0);this.isXLowToHigh=J.jvxl.readers.XmlReader.getXmlAttrib(a,"isXLowToHigh").equals("true");var b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"cutoff");0>b.indexOf(" ")?(this.jvxlCutoff=this.parseFloatStr(b),Double.isNaN(this.jvxlCutoff)||JU.Logger.info("JVXL read: cutoff "+this.jvxlCutoff)):(this.jvxlCutoffRange=
this.parseFloatArrayStr(b),this.jvxlCutoff=this.jvxlCutoffRange[0],JU.Logger.info("JVXL read: cutoff "+JU.Escape.eAF(this.jvxlCutoffRange)));this.params.cutoff=this.jvxlCutoff;var c=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"nContourData"));this.haveContourData=0<c;this.params.isContoured=this.jvxlData.isModelConnected=J.jvxl.readers.XmlReader.getXmlAttrib(a,"contoured").equals("true");this.params.isModelConnected=J.jvxl.readers.XmlReader.getXmlAttrib(a,"isModelConnected").equals("true");
if(this.params.isContoured){var e=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"nContours"));0>=e?e=0:(0>this.params.thisContour&&(this.params.thisContour=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"thisContour"))),b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"contourValues"),0<b.length&&(b=b.$replace("["," ").$replace("]"," "),this.jvxlData.contourValues=this.params.contoursDiscrete=this.parseFloatArrayStr(b),JU.Logger.info("JVXL read: contourValues "+JU.Escape.eAF(this.jvxlData.contourValues))),
b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"contourColors"),0<b.length&&(this.jvxlData.contourColixes=this.params.contourColixes=JU.C.getColixArray(b),this.jvxlData.contourColors=JU.C.getHexCodes(this.jvxlData.contourColixes),JU.Logger.info("JVXL read: contourColixes "+JU.C.getHexCodes(this.jvxlData.contourColixes))),this.params.contourFromZero=J.jvxl.readers.XmlReader.getXmlAttrib(a,"contourFromZero").equals("true"));this.params.nContours=this.haveContourData?c:e}this.jvxlData.nVertexColors=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,
"nVertexColors"));this.params.isBicolorMap=J.jvxl.readers.XmlReader.getXmlAttrib(a,"bicolorMap").equals("true");this.params.isBicolorMap&&(b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"colorPositive"),0<b.length&&(-2147483648==this.params.colorRgb&&-16776961==this.params.colorPos)&&(this.params.colorPos=JU.CU.getArgbFromString(b)),b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"colorNegative"),0<b.length&&(-2147483648==this.params.colorRgb&&-65536==this.params.colorNeg)&&(this.params.colorNeg=JU.CU.getArgbFromString(b)));
if(this.params.isBicolorMap||this.params.colorBySign)this.jvxlCutoff=0;this.jvxlDataIsColorMapped=(-2147483648==this.params.colorRgb||2147483647==this.params.colorRgb)&&(this.params.isBicolorMap||J.jvxl.readers.XmlReader.getXmlAttrib(a,"colorMapped").equals("true"));this.jvxlData.isJvxlPrecisionColor=J.jvxl.readers.XmlReader.getXmlAttrib(a,"precisionColor").equals("true");this.jvxlData.jvxlDataIsColorDensity=this.params.colorDensity=-2147483648==this.params.colorRgb&&J.jvxl.readers.XmlReader.getXmlAttrib(a,
"colorDensity").equals("true");this.jvxlData.jvxlDataIsColorDensity&&Float.isNaN(this.params.pointSize)&&(b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"pointSize"),0<b.length&&(this.jvxlData.pointSize=this.params.pointSize=this.parseFloatStr(b)));b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"allowVolumeRender");this.jvxlData.allowVolumeRender=this.params.allowVolumeRender=0==b.length||b.equalsIgnoreCase("true");b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"plane");if(0<=b.indexOf("{")){this.params.thePlane=
null;this.params.mapLattice=null;try{this.params.thePlane=JU.Escape.uP(b),b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"maplattice"),JU.Logger.info("JVXL read: plane "+this.params.thePlane),0<=b.indexOf("{")&&(this.params.mapLattice=JU.Escape.uP(b),JU.Logger.info("JVXL read: mapLattice "+this.params.mapLattice)),0==this.params.scale3d&&(this.params.scale3d=this.parseFloatStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"scale3d"))),Float.isNaN(this.params.scale3d)&&(this.params.scale3d=0)}catch(d){if(Y(d,
Exception))null==this.params.thePlane?(JU.Logger.error("JVXL Error reading plane definition -- setting to 0 0 1 0  (z=0)"),this.params.thePlane=JU.P4.new4(0,0,1,0)):JU.Logger.error("JVXL Error reading mapLattice definition -- ignored");else throw d;}this.edgeDataCount=this.surfaceDataCount=0}else this.params.thePlane=null,this.surfaceDataCount=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"nSurfaceInts")),this.edgeDataCount=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"nBytesUncompressedEdgeData")),
b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"fixedLattice"),0<=b.indexOf("{")&&(this.jvxlData.fixedLattice=JU.Escape.uP(b));this.excludedVertexCount=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"nExcludedVertexes"));this.excludedTriangleCount=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"nExcludedTriangles"));this.invalidatedVertexCount=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"nInvalidatedVertexes"));b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"slabInfo");0<b.length&&
(this.jvxlData.slabInfo=b);this.colorDataCount=Math.max(0,this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"nBytesUncompressedColorData")));this.jvxlDataIs2dContour=null!=this.params.thePlane&&this.jvxlDataIsColorMapped;this.jvxlData.color=J.jvxl.readers.XmlReader.getXmlAttrib(a,"color");if(0==this.jvxlData.color.length||0<=this.jvxlData.color.indexOf("null"))this.jvxlData.color="orange";this.jvxlData.translucency=this.parseFloatStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"translucency"));
Float.isNaN(this.jvxlData.translucency)&&(this.jvxlData.translucency=0);b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"meshColor");0<b.length&&(this.jvxlData.meshColor=b);b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"rendering");0<b.length&&(this.jvxlData.rendering=b);this.jvxlData.colorScheme=J.jvxl.readers.XmlReader.getXmlAttrib(a,"colorScheme");0==this.jvxlData.colorScheme.length&&(this.jvxlData.colorScheme=this.jvxlDataIsColorMapped?"roygb":null);if(null==this.jvxlData.thisSet&&(b=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,
"set")),0<b&&(this.jvxlData.thisSet=new JU.BS,this.jvxlData.thisSet.set(b-1)),b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"subset"),null!=b&&2<b.length&&(b=b.$replace("["," ").$replace("]"," ").trim().$plit(" "),0<b.length))){this.jvxlData.thisSet=new JU.BS;for(c=b.length;0<=--c;)this.jvxlData.thisSet.set(JU.PT.parseInt(b[c])-1)}this.jvxlData.slabValue=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"slabValue"));this.jvxlData.isSlabbable=J.jvxl.readers.XmlReader.getXmlAttrib(a,"slabbable").equalsIgnoreCase("true");
this.jvxlData.diameter=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"diameter"));-2147483648==this.jvxlData.diameter&&(this.jvxlData.diameter=0);this.jvxlDataIs2dContour&&(this.params.isContoured=!0);this.params.colorBySign&&(this.params.isBicolorMap=!0);var b=J.jvxl.readers.XmlReader.getXmlAttrib(a,"insideOut").equals("true"),h=e=c=NaN,f=NaN;this.jvxlDataIsColorMapped&&(c=this.parseFloatStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"dataMinimum")),e=this.parseFloatStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,
"dataMaximum")),h=this.parseFloatStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"valueMappedToRed")),f=this.parseFloatStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"valueMappedToBlue")),Float.isNaN(c)&&(c=h=-1,e=f=1));this.jvxlSetColorRanges(c,e,h,f,b)});d(c$,"jvxlSetColorRanges",function(a,b,c,e,d){this.jvxlDataIsColorMapped&&(!Float.isNaN(a)&&!Float.isNaN(b)&&(0==b&&0==a&&(a=-1,b=1),this.params.mappedDataMin=a,this.params.mappedDataMax=b,JU.Logger.info("JVXL read: data_min/max "+this.params.mappedDataMin+
"/"+this.params.mappedDataMax)),this.params.rangeDefined||(!Float.isNaN(c)&&!Float.isNaN(e)?(0==c&&0==e&&(c=-1,e=1),this.params.valueMappedToRed=Math.min(c,e),this.params.valueMappedToBlue=Math.max(c,e),this.params.isColorReversed=c>e):(this.params.valueMappedToRed=0,this.params.valueMappedToBlue=1),this.params.rangeDefined=!0),JU.Logger.info("JVXL read: color red/blue: "+this.params.valueMappedToRed+"/"+this.params.valueMappedToBlue));this.jvxlData.valueMappedToRed=this.params.valueMappedToRed;this.jvxlData.valueMappedToBlue=
this.params.valueMappedToBlue;this.jvxlData.mappedDataMin=this.params.mappedDataMin;this.jvxlData.mappedDataMax=this.params.mappedDataMax;this.jvxlData.isColorReversed=this.params.isColorReversed;this.params.insideOut&&(d=!d);this.params.insideOut=this.jvxlData.insideOut=d},"~N,~N,~N,~N,~B");m(c$,"readSurfaceData",function(){this.thisInside=!this.params.isContoured;this.readSurfaceDataXML()||(this.tempDataXml=this.xr.getXmlData("jvxlEdgeData",null,!0,!1),this.bsVoxelBitSet=J.jvxl.data.JvxlCoder.jvxlDecodeBitSet(this.xr.getXmlData("jvxlEdgeData",
this.tempDataXml,!1,!1)),this.readSurfaceDataJXR())},"~B");d(c$,"readSurfaceDataXML",function(){return this.vertexDataOnly?(this.getEncodedVertexData(),!0):null!=this.params.thePlane?(this.volumeData.setDataDistanceToPlane(this.params.thePlane),this.setVolumeDataV(this.volumeData),this.params.cutoff=0,this.jvxlData.setSurfaceInfo(this.params.thePlane,this.params.mapLattice,0,""),this.jvxlData.scale3d=this.params.scale3d,!0):!1});d(c$,"readSurfaceDataJXR",function(){this.readSurfaceDataVFR(!1);this.volumeData.setMappingPlane(null)});
d(c$,"jvxlReadFractionData",function(a){var b;try{if(a.equals("edge"))b=J.jvxl.data.JvxlCoder.jvxlDecompressString(J.jvxl.readers.XmlReader.getXmlAttrib(this.tempDataXml,"data"));else{var c=this.xr.getXmlData("jvxlColorData",null,!0,!1);this.jvxlData.isJvxlPrecisionColor=J.jvxl.readers.JvxlXmlReader.getEncoding(c).endsWith("2");b=J.jvxl.data.JvxlCoder.jvxlDecompressString(J.jvxl.readers.XmlReader.getXmlAttrib(c,"data"))}}catch(e){if(Y(e,Exception))throw JU.Logger.error("Error reading "+a+" data "+
e),new NullPointerException;throw e;}return b},"~S,~N");m(c$,"getVoxelBitSet",function(a){if(null!=this.bsVoxelBitSet)return this.bsVoxelBitSet;var b=new JU.BS,c=0;if(0>=this.surfaceDataCount)return b;for(var e=0;c<a;){e=this.parseInt();if(-2147483648==e&&(this.rd(),null==this.line||-2147483648==(e=this.parseIntStr(this.line))))this.endOfData||JU.Logger.error("end of file in JvxlReader? line="+this.line),this.endOfData=!0,e=1E4;this.thisInside=!this.thisInside;++this.jvxlNSurfaceInts;this.thisInside&&
b.setBits(c,c+e);c+=e}return b},"~N");m(c$,"getSurfacePointAndFraction",function(a,b,c,e,d,h,f,g,j,p,l,m,r){if(0>=this.edgeDataCount)return this.getSPFv(a,b,c,e,d,h,f,g,j,p,l,m,r);r.scaleAdd2(m[0]=this.jvxlGetNextFraction(this.edgeFractionBase,this.edgeFractionRange,0.5),h,d);Float.isNaN(this.valueMin)&&this.setValueMinMax();return 0==this.valueCount||this.includeValueNaN&&Float.isNaN(m[0])?m[0]:this.getNextValue()},"~N,~B,~N,~N,JU.T3,JU.V3,~N,~N,~N,~N,~N,~A,JU.T3");d(c$,"getNextValue",function(){for(var a=
NaN;this.colorPtr<this.valueCount&&Float.isNaN(a);){a=this.jvxlData.isJvxlPrecisionColor?J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter2(this.jvxlColorDataRead.charCodeAt(this.colorPtr),this.jvxlColorDataRead.charCodeAt(this.colorPtr++ +this.valueCount),this.colorFractionBase,this.colorFractionRange):J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter(this.jvxlColorDataRead.charCodeAt(this.colorPtr++),this.colorFractionBase,this.colorFractionRange,0.5);break}return this.valueMin+a*this.valueRange});
d(c$,"setValueMinMax",function(){this.valueCount=this.jvxlColorDataRead.length;this.jvxlData.isJvxlPrecisionColor&&(this.valueCount/=2);this.includeValueNaN=this.valueCount!=this.jvxlEdgeDataRead.length;this.valueMin=!this.jvxlData.isJvxlPrecisionColor?this.params.valueMappedToRed:3.4028235E38==this.params.mappedDataMin?0:this.params.mappedDataMin;this.valueRange=(!this.jvxlData.isJvxlPrecisionColor?this.params.valueMappedToBlue:3.4028235E38==this.params.mappedDataMin?1:this.params.mappedDataMax)-
this.valueMin;this.haveReadColorData=!0});d(c$,"jvxlGetNextFraction",function(a,b,c){this.fractionPtr>=this.strFractionTemp.length&&(this.endOfData||JU.Logger.error("end of file reading compressed fraction data"),this.endOfData=!0,this.strFractionTemp=""+String.fromCharCode(a),this.fractionPtr=0);return J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter(this.strFractionTemp.charCodeAt(this.fractionPtr++),a,b,c)},"~N,~N,~N");m(c$,"readColorData",function(){if(!this.jvxlDataIsColorMapped)return"";var a=
this.jvxlData.vertexCount=this.meshData.vc,b=this.meshData.vcs,c=this.meshData.vvs;if("none".equals(this.jvxlColorEncodingRead)){this.jvxlData.vertexColors=u(a,0);for(var e=u(1,0),c=JU.PT.parseIntNext(this.jvxlColorDataRead,e),c=Math.min(c,a),a=JU.PT.getTokens(this.jvxlColorDataRead.substring(e[0])),d=!1,h=this.jvxlData.translucency,f=0,e=0;e<c;e++)try{var g=J.jvxl.readers.JvxlXmlReader.getColor(a[e]);0==g?g=f:f=g;b[e]=JU.C.getColixTranslucent(this.jvxlData.vertexColors[e]=g);JU.C.isColixTranslucent(b[e])?
d=!0:0!=h&&(b[e]=JU.C.getColixTranslucent3(b[e],!0,h))}catch(j){if(Y(j,Exception))JU.Logger.info("JvxlXmlReader: Cannot interpret color code: "+a[e]);else throw j;}d&&0==h&&(this.jvxlData.translucency=0.5);return"-"}null==this.params.colorEncoder&&(this.params.colorEncoder=new JU.ColorEncoder(null,null));this.params.colorEncoder.setColorScheme(null,!1);this.params.colorEncoder.setRange(this.params.valueMappedToRed,this.params.valueMappedToBlue,this.params.isColorReversed);JU.Logger.info("JVXL reading color data mapped min/max: "+
this.params.mappedDataMin+"/"+this.params.mappedDataMax+" for "+a+" vertices. using encoding keys "+this.colorFractionBase+" "+this.colorFractionRange);JU.Logger.info("mapping red--\x3eblue for "+this.params.valueMappedToRed+" to "+this.params.valueMappedToBlue+" colorPrecision:"+this.jvxlData.isJvxlPrecisionColor);var p=Float.isNaN(this.valueMin);p&&this.setValueMinMax();var l=3.4028235E38,m=-3.4028235E38;if(null==b||b.length<a)this.meshData.vcs=b=$(a,0);d=g=0;this.params.colorBySign&&(d=JU.C.getColix(this.params.isColorReversed?
this.params.colorNeg:this.params.colorPos),g=JU.C.getColix(this.params.isColorReversed?this.params.colorPos:this.params.colorNeg));for(var h=this.meshData.vertexIncrement,r=3.4028235E38==this.params.mappedDataMin,e=0;e<a;e+=h)f=p?c[e]=this.getNextValue():c[e],r&&(f<l&&(l=f),f>m&&(m=f));r&&(this.params.mappedDataMin=l,this.params.mappedDataMax=m);if(null!=this.jvxlData.colorScheme){p=null!=this.marchingSquares&&this.params.isContoured;for(e=0;e<a;e+=h)f=c[e],p?this.marchingSquares.setContourData(e,
f):(f=!this.params.colorBySign?this.params.colorEncoder.getColorIndex(f):(this.params.isColorReversed?0<f:0>=f)?g:d,b[e]=JU.C.getColixTranslucent3(f,!0,this.jvxlData.translucency))}return this.jvxlColorDataRead+"\n"});c$.getColor=d(c$,"getColor",function(a){var b=0;try{switch(a.charAt(0)){case "[":b=JU.CU.getArgbFromString(a);break;case "0":b=JU.PT.parseIntRadix(a.substring(2),16);break;default:b=JU.PT.parseIntRadix(a,10)}}catch(c){if(!Y(c,Exception))throw c;}return b},"~S");d(c$,"getEncodedVertexData",
function(){var a=this.xr.getXmlData("jvxlSurfaceData",null,!0,!1);this.jvxlDecodeVertexData(this.xr.getXmlData("jvxlVertexData",a,!0,!1),!1);var b=this.xr.getXmlData("jvxlTriangleData",a,!0,!1),c=this.xr.getXmlData("jvxlTriangleEdgeData",a,!0,!1),d=this.xr.getXmlData("jvxlPolygonColorData",a,!1,!1);this.jvxlDecodeTriangleData(b,c,d);a=this.xr.getXmlData("jvxlColorData",a,!0,!1);this.jvxlColorEncodingRead=J.jvxl.readers.JvxlXmlReader.getEncoding(a);this.jvxlData.isJvxlPrecisionColor=this.jvxlColorEncodingRead.endsWith("2");
a=this.getData(a,"jvxlColorData");this.jvxlColorDataRead=this.jvxlColorEncodingRead.equals("none")?a:J.jvxl.data.JvxlCoder.jvxlDecompressString(a);this.jvxlDataIsColorMapped=(-2147483648==this.params.colorRgb||2147483647==this.params.colorRgb)&&0<this.jvxlColorDataRead.length;this.haveContourData&&this.jvxlDecodeContourData(this.jvxlData,this.xr.getXmlData("jvxlContourData",null,!1,!1))});d(c$,"getData",function(a,b){var c=J.jvxl.readers.XmlReader.getXmlAttrib(a,"data");0==c.length&&(c=this.xr.getXmlData(b,
a,!1,!1));return c},"~S,~S");c$.getEncoding=d(c$,"getEncoding",function(a){if(0<J.jvxl.readers.XmlReader.getXmlAttrib(a,"len").length)return"";a=J.jvxl.readers.XmlReader.getXmlAttrib(a,"encoding");return 0==a.length?"none":a},"~S");d(c$,"jvxlDecodeVertexData",function(a,b){var c=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"count"));b||JU.Logger.info("Reading "+c+" vertices");var d=3*c,g=b?Array(c):null,h,f=J.jvxl.readers.XmlReader.getXmlAttrib(a,"data"),m=J.jvxl.readers.JvxlXmlReader.getEncoding(a);
if("none".equals(m)){0==f.length&&(f=this.xr.getXmlData("jvxlVertexData",a,!1,!1));d=JU.PT.parseFloatArray(f);d[0]!=3*c&&JU.Logger.info("JvxlXmlReader: vertexData count="+y(d[0])+"; expected "+3*c);f=0;for(m=1;f<c;f++){var j=JU.P3.new3(d[m++],d[m++],d[m++]);b?g[f]=j:this.addVertexCopy(j,0,f,!1)}}else{var p=this.xr.getXmlPoint(a,"min"),l=this.xr.getXmlPoint(a,"max");l.sub(p);var t=this.jvxlData.colorFractionBase,r=this.jvxlData.colorFractionRange,u=J.jvxl.data.JvxlCoder.jvxlDecompressString(f);0==
u.length&&(u=this.xr.getXmlData("jvxlVertexData",a,!1,!1));f=0;for(m=-1;f<c;f++)j=new JU.P3,h=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter2(u.charCodeAt(++m),u.charCodeAt(m+d),t,r),j.x=p.x+h*l.x,h=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter2(u.charCodeAt(++m),u.charCodeAt(m+d),t,r),j.y=p.y+h*l.y,h=J.jvxl.data.JvxlCoder.jvxlFractionFromCharacter2(u.charCodeAt(++m),u.charCodeAt(m+d),t,r),j.z=p.z+h*l.z,b?g[f]=j:this.addVertexCopy(j,0,f,!1)}return g},"~S,~B");d(c$,"jvxlDecodeTriangleData",function(a,
b,c){var d=this.parseIntStr(J.jvxl.readers.XmlReader.getXmlAttrib(a,"count"));if(!(0>d)){var g=u(1,0),h=null==c?-1:1,f=0;JU.Logger.info("Reading "+d+" triangles");var m=J.jvxl.readers.JvxlXmlReader.getEncoding(a);a=this.getData(a,"jvxlTriangleData");b=this.getData(b,"jvxlTriangleEdgeData");var j=u(3,0),p=u(1,0),l=null,t=7,r=!"none".equals(m);if(r)a=J.jvxl.data.JvxlCoder.jvxlDecompressString(a),b=J.jvxl.data.JvxlCoder.jvxlDecompressString(b).trim(),m=b.length==d;else{var w=JU.PT.parseIntNext(a,p);
(m=0<b.length)?(l=u(1,0),JU.PT.parseIntNext(b,l)):0<w&&JU.Logger.info("JvxlXmlReader: jvxlTriangleEdgeData count="+w+"; expected "+d)}for(var v=w=0,y=0,D=-1;w<d;){if(r){var B=a.charAt(++D);switch(B){case "!":B=0;break;case "+":case ".":case " ":case "\n":case "\r":case "\t":case ",":continue;case "-":case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":p[0]=D;B=JU.PT.parseIntNext(a,p);D=p[0]-1;break;default:B=B.charCodeAt(0)-92}v+=B}else v=JU.PT.parseIntNext(a,
p)-1;j[y]=v;if(3==++y){y=0;if(m&&(t=null==l?b.charCodeAt(w)-48:JU.PT.parseIntNext(b,l),0>t||7<t))t=7;0==--h&&(h=JU.PT.parseIntNext(c,g),B=JU.PT.parseIntNext(c,g),-2147483648==B?h=0:f=B|4278190080);this.addTriangleCheck(j[0],j[1],j[2],t,f,!1,f);w++}}}},"~S,~S,~S");d(c$,"jvxlDecodeContourData",function(a,b){var c=new JU.Lst,d=new JU.SB,g=new JU.SB,h=-1;a.vContours=null;if(null!=b){for(;0<=(h=b.indexOf("<jvxlContour",h+1));){var f=new JU.Lst,m=this.xr.getXmlData("jvxlContour",b.substring(h),!0,!1),j=
this.parseFloatStr(J.jvxl.readers.XmlReader.getXmlAttrib(m,"value"));d.append(" ").appendF(j);var p=J.jvxl.readers.JvxlXmlReader.getColor(J.jvxl.readers.XmlReader.getXmlAttrib(m,"color")),l=JU.C.getColix(p);g.append(" ").append(JU.Escape.escapeColor(p));var t=J.jvxl.data.JvxlCoder.jvxlDecompressString(J.jvxl.readers.XmlReader.getXmlAttrib(m,"data")),r=J.jvxl.data.JvxlCoder.jvxlDecodeBitSet(this.xr.getXmlData("jvxlContour",m,!1,!1)),m=r.length();J.shapesurface.IsosurfaceMesh.setContourVector(f,m,r,
j,l,p,JU.SB.newS(t));c.addLast(f)}m=c.size();if(0<m){a.vContours=JU.AU.createArrayOfArrayList(m);a.contourColixes=this.params.contourColixes=$(m,0);a.contourValues=this.params.contoursDiscrete=w(m,0);for(h=0;h<m;h++)a.vContours[h]=c.get(h),a.contourValues[h]=a.vContours[h].get(2).floatValue(),a.contourColixes[h]=a.vContours[h].get(3)[0];a.contourColors=JU.C.getHexCodes(a.contourColixes);JU.Logger.info("JVXL read: "+m+" discrete contours");JU.Logger.info("JVXL read: contour values: "+d);JU.Logger.info("JVXL read: contour colors: "+
g)}}},"J.jvxl.data.JvxlData,~S");m(c$,"postProcessVertices",function(){var a=this.params.bsExcluded[1];null!=a&&(null!=this.meshDataServer&&this.meshDataServer.fillMeshData(this.meshData,1,null),this.meshData.invalidateVertices(a),null!=this.meshDataServer&&(this.meshDataServer.fillMeshData(this.meshData,4,null),this.meshData=new J.jvxl.data.MeshData),this.updateTriangles())})});O("J.rendersurface");F(["J.render.MeshRenderer"],"J.rendersurface.IsosurfaceRenderer",["java.lang.Boolean","$.Float","JU.V3",
"JU.C","$.Normix"],function(){c$=H(function(){this.isBicolorMap=this.iHideBackground=!1;this.nError=this.backgroundColix=0;this.isosurface=this.imesh=this.vertexValues=null;this.showNumbers=this.iShowNormals=this.isNavigationMode=!1;this.showKey=null;this.hasColorRange=!1;this.meshScale=-1;this.globalSlabValue=this.mySlabValue=0;P(this,arguments)},J.rendersurface,"IsosurfaceRenderer",J.render.MeshRenderer);m(c$,"render",function(){return this.renderIso()});d(c$,"renderIso",function(){this.setGlobals();
for(var a=this.isosurface.meshCount;0<=--a;)if(this.mesh=this.imesh=this.isosurface.meshes[a],null==this.imesh.connectedAtoms||this.vwr.ms.at[this.imesh.connectedAtoms[0]].checkVisible())this.hasColorRange=!1,this.renderMeshSlab()&&(this.renderInfo(),this.isExport&&this.isGhostPass&&(this.exportPass=1,this.renderMeshSlab(),this.exportPass=2));return this.needTranslucent});d(c$,"setGlobals",function(){this.needTranslucent=!1;this.antialias=this.g3d.isAntialiased();this.iShowNormals=this.vwr.getBoolean(603979965);
this.showNumbers=this.vwr.getBoolean(603979964);this.isosurface=this.shape;this.exportPass=this.isExport?2:0;this.isNavigationMode=this.vwr.getBoolean(603979889);this.showKey=this.vwr.getBoolean(603979867)?Boolean.TRUE:null;this.isosurface.keyXy=null;this.meshScale=-1;this.globalSlabValue=this.vwr.gdata.slab;this.mySlabValue=this.isNavigationMode?y(this.tm.getNavigationOffset().z):2147483647});d(c$,"renderInfo",function(){if(!this.isExport&&this.hasColorRange&&!(null==this.imesh.colorEncoder||Boolean.TRUE!==
this.showKey)){this.showKey=Boolean.FALSE;var a=null,b=null,c=null,d=0,g=0;if(this.imesh.showContourLines)if(c=this.imesh.getContours(),null==c){b=this.imesh.jvxlData.contourColixes;if(null==b)return;d=b.length}else d=c.length,g=1;else a=this.imesh.colorEncoder.getColorSchemeArray(this.imesh.colorEncoder.currentPalette),d=null==a?0:a.length,g=2;if(!(2>d)){var h=this.antialias?2:1,f=this.vwr.getScreenHeight()*h,m=D(D(f/2)/(d-1)),f=3*D(f/4)-m,j=10*h,p=20*h;this.isosurface.keyXy=u(-1,[D(j/h),0,D((j+
p)/h),D((f+m)/h),D(m/h)]);for(var l=0;l<d;l++,f-=m){switch(g){case 0:if(!this.g3d.setC(b[l]))return;break;case 1:if(!this.g3d.setC(c[l].get(3)[0]))return;break;case 2:this.vwr.gdata.setColor(a[l])}this.g3d.fillTextRect(j,f,5,-2147483648,p,m)}this.isosurface.keyXy[1]=D((f+m)/h)}}});d(c$,"renderMeshSlab",function(){this.volumeRender=this.imesh.jvxlData.colorDensity&&this.imesh.jvxlData.allowVolumeRender;var a=this.mySlabValue;this.frontOnly=this.mesh.frontOnly||26==this.shapeID;this.isShell=this.mesh.isShell&&
26!=this.shapeID;if(!this.isNavigationMode&&(this.meshSlabValue=this.imesh.jvxlData.slabValue,-2147483648!=this.meshSlabValue&&this.imesh.jvxlData.isSlabbable)){for(var b=this.imesh.jvxlData.boundingBox,a=3.4028235E38,c=1.4E-45,d=b.length;0<=--d;)this.pt2f.setT(b[d]),this.tm.transformPt3f(this.pt2f,this.pt2f),this.pt2f.z<a&&(a=this.pt2f.z),this.pt2f.z>c&&(c=this.pt2f.z);a=Math.round(a+(c-a)*(100-this.meshSlabValue)/100);this.frontOnly=(new Boolean(this.frontOnly&100<=this.meshSlabValue)).valueOf();
this.isShell=(new Boolean(this.isShell&100<=this.meshSlabValue)).valueOf()}b=this.vwr.gdata.translucentCoverOnly;this.vwr.gdata.translucentCoverOnly=this.frontOnly||!this.vwr.getBoolean(603979967);this.thePlane=this.imesh.jvxlData.jvxlPlane;this.vertexValues=this.mesh.vvs;2147483647!=a&&this.imesh.jvxlData.isSlabbable?(this.g3d.setSlab(a),a=this.renderMesh2(this.mesh),this.g3d.setSlab(this.globalSlabValue)):a=this.renderMesh2(this.mesh);this.vwr.gdata.translucentCoverOnly=b;return a});m(c$,"render2",
function(a){if(this.volumeRender)this.renderPoints();else{switch(this.imesh.dataType){case 70:this.renderLonePair(!1);return;case 71:this.renderLonePair(!0);return}this.isBicolorMap=this.imesh.jvxlData.isBicolorMap;this.render2b(a);this.g3d.setC(4)&&this.imesh.showContourLines&&this.renderContourLines()}},"~B");d(c$,"renderLonePair",function(a){this.pt2f.setT(this.vertices[1]);this.tm.transformPt3f(this.pt2f,this.pt2f);var b=y(this.vwr.tm.scaleToScreen(y(this.pt2f.z),100));1>b&&(b=1);if(!a){var c=
new JU.V3;a=new JU.V3;this.pt1f.setT(this.vertices[0]);this.tm.transformPt3f(this.pt1f,this.pt1f);c.sub2(this.pt2f,this.pt1f);a.set(c.x,c.y,c.z+1);a.cross(a,c);a.normalize();c=this.vwr.tm.scaleToScreen(y(this.pt1f.z),100);a.scale(c);this.pt1f.add2(this.pt2f,a);this.pt2f.sub(a);this.screens[0].set(Math.round(this.pt1f.x),Math.round(this.pt1f.y),Math.round(this.pt1f.z));this.g3d.fillSphereI(b,this.screens[0])}this.screens[1].set(Math.round(this.pt2f.x),Math.round(this.pt2f.y),Math.round(this.pt2f.z));
this.g3d.fillSphereI(b,this.screens[1])},"~B");d(c$,"renderContourLines",function(){var a=this.imesh.getContours();if(null==a)null!=this.imesh.jvxlData.contourValues&&(this.hasColorRange=!0);else{this.hasColorRange=0==this.mesh.meshColix;for(var b=a.length;0<=--b;){var c=a[b];if(!(6>c.size())){this.colix=0==this.mesh.meshColix?c.get(3)[0]:this.mesh.meshColix;if(!this.g3d.setC(this.colix))break;for(var d=c.size()-1,g=this.getDiameter(),h=6;h<d;h++){var f=c.get(h),m=c.get(++h);if(Float.isNaN(f.x)||
Float.isNaN(m.x))break;this.tm.transformPtScrT3(f,this.pt1f);this.tm.transformPtScrT3(m,this.pt2f);this.pt1f.z-=2;this.pt2f.z-=2;!this.antialias&&1==g?this.g3d.drawLineAB(this.pt1f,this.pt2f):this.g3d.fillCylinderBits(1,g,this.pt1f,this.pt2f)}}}}});m(c$,"renderPoints",function(){try{this.volumeRender&&this.g3d.volumeRender(!0);var a=(this.volumeRender||0==this.mesh.pc)&&this.selectedPolyOnly,b=this.imesh.vertexIncrement,c;0>=this.mesh.diameter?(c=this.vwr.getInt(553648140),this.frontOnly=this.isShell=
!1):c=D(this.vwr.getScreenDim()/(this.volumeRender?50:100));var d=Math.round(Float.isNaN(this.mesh.volumeRenderPointSize)?150:1E3*this.mesh.volumeRenderPointSize);1>c&&(c=1);var g=this.showNumbers?D(this.vwr.getScreenWidth()/2):0,h=this.showNumbers?D(this.vwr.getScreenHeight()/2):0;this.showNumbers&&this.vwr.gdata.setFontBold("Monospaced",24);for(var f=!this.imesh.hasGridPoints||0>this.imesh.firstRealVertex?0:this.imesh.firstRealVertex;f<this.vertexCount;f+=b)if(!(null!=this.vertexValues&&Float.isNaN(this.vertexValues[f])||
this.frontOnly&&!this.isVisibleNormix(this.normixes[f])||null!=this.imesh.jvxlData.thisSet&&!this.imesh.jvxlData.thisSet.get(this.mesh.vertexSets[f])||!this.mesh.isColorSolid&&null!=this.mesh.vcs&&!this.setColix(this.mesh.vcs[f])||this.haveBsDisplay&&!this.mesh.bsDisplay.get(f)||a&&!this.bsPolygons.get(f))){this.hasColorRange=!0;if(this.showNumbers&&10<this.screens[f].z&&150>Math.abs(this.screens[f].x-g)&&150>Math.abs(this.screens[f].y-h)){var m=f+(this.mesh.isColorSolid?"":" "+this.mesh.vvs[f]);
this.g3d.setC(4);this.g3d.drawStringNoSlab(m,null,this.screens[f].x,this.screens[f].y,this.screens[f].z-30,0)}this.volumeRender?(c=y(this.vwr.tm.scaleToScreen(this.screens[f].z,d)),1>c&&(c=1),this.g3d.volumeRender4(c,this.screens[f].x,this.screens[f].y,this.screens[f].z)):this.g3d.fillSphereI(c,this.screens[f])}if(3==b){this.g3d.setC(this.isTranslucent?JU.C.getColixTranslucent3(12,!0,0.5):12);for(f=1;f<this.vertexCount;f+=3)this.g3d.fillCylinder(3,D(c/4),this.screens[f],this.screens[f+1]);this.g3d.setC(this.isTranslucent?
JU.C.getColixTranslucent3(21,!0,0.5):21);for(f=1;f<this.vertexCount;f+=3)this.g3d.fillSphereI(c,this.screens[f]);this.g3d.setC(this.isTranslucent?JU.C.getColixTranslucent3(7,!0,0.5):7);for(f=2;f<this.vertexCount;f+=3)this.g3d.fillSphereI(c,this.screens[f])}}catch(j){}this.volumeRender&&this.g3d.volumeRender(!1)});m(c$,"renderTriangles",function(a,b,c){this.g3d.addRenderer(1073742182);var d=this.mesh.pis;this.colix=this.isGhostPass?this.mesh.slabColix:!a&&0!=this.mesh.meshColix?this.mesh.meshColix:
this.mesh.colix;var g=!a&&0!=this.mesh.meshColix?null:this.mesh.vcs;this.isTranslucentInherit&&(this.colix=JU.C.copyColixTranslucency(this.mesh.slabColix,this.mesh.colix));this.g3d.setC(this.colix);c&&(this.frontOnly&&a&&(this.frontOnly=!1),this.bsPolygonsToExport.clearAll());1==this.exportType&&(this.frontOnly=!1);var h=this.isGhostPass&&!this.isBicolorMap||null==g||this.mesh.isColorSolid,f=this.isGhostPass&&!this.isBicolorMap||null==g||!a&&0!=this.mesh.meshColix,m=this.colix;null!=this.imesh.jvxlData.jvxlPlane&&
(!h&&!a&&this.mesh.fillTriangles)&&(h=!0,m=4);var j=h&&null!=this.mesh.pcs;j&&(!a&&this.mesh.fillTriangles)&&(j=!1);var p=this.imesh.jvxlData.contourColixes;this.hasColorRange=!h&&!this.isBicolorMap;for(var l=this.getDiameter(),t=this.mesh.pc;0<=--t;){var r=d[t];if(!(null==r||this.selectedPolyOnly&&!this.bsPolygons.get(t))){var u=r[0],v=r[1],w=r[2];if(!(null!=this.imesh.jvxlData.thisSet&&null!=this.mesh.vertexSets&&!this.imesh.jvxlData.thisSet.get(this.mesh.vertexSets[u]))&&(!this.haveBsDisplay||
this.mesh.bsDisplay.get(u)&&this.mesh.bsDisplay.get(v)&&this.mesh.bsDisplay.get(w))){var y=this.normixes[u],B=this.normixes[v],D=this.normixes[w],H=this.frontOnly||this.isShell?this.checkFront(y,B,D):7;if(!(a&&0==H)){var F,I,E;if(h){if(j&&t<this.mesh.pcs.length){F=this.mesh.pcs[t];if(0==F)continue;m=F}b&&(m=Math.round(10*Math.random())+5);F=I=E=m}else if(F=g[u],I=g[v],E=g[w],this.isBicolorMap){if(F!=I||I!=E)continue;this.isGhostPass&&(F=I=E=JU.C.copyColixTranslucency(this.mesh.slabColix,F))}if(a)c?
this.bsPolygonsToExport.set(t):(v==w?(this.setColix(F),u==v?this.g3d.fillSphereI(l,this.screens[u]):this.g3d.fillCylinder(3,l,this.screens[u],this.screens[v])):this.mesh.colorsExplicit?(this.vwr.gdata.setColor(r[4]),F=JU.C.copyColixTranslucency(this.mesh.colix,2047),this.g3d.setC(F),this.g3d.fillTriangle3CN(this.screens[u],F,y,this.screens[v],F,B,this.screens[w],F,D)):(this.isTranslucentInherit&&null!=g&&(F=JU.C.copyColixTranslucency(this.mesh.slabColix,g[u]),I=JU.C.copyColixTranslucency(this.mesh.slabColix,
g[v]),E=JU.C.copyColixTranslucency(this.mesh.slabColix,g[w])),this.g3d.fillTriangle3CN(this.screens[u],F,y,this.screens[v],I,B,this.screens[w],E,D)),this.iShowNormals&&this.renderNormals());else if(H&=r[3],0!=H){b&&(H=7);this.pt1i.setT(this.screens[u]);this.pt2i.setT(this.screens[v]);this.pt3i.setT(this.screens[w]);this.pt1i.z-=2;this.pt2i.z-=2;this.pt3i.z-=2;if(!f)if(j)this.g3d.setC(this.mesh.fillTriangles?4:p[r[4]%p.length]);else{this.drawTriangle(this.pt1i,F,this.pt2i,I,this.pt3i,E,H,l);continue}this.drawTriangle(this.pt1i,
m,this.pt2i,m,this.pt3i,m,H,l)}}}}}c&&this.exportSurface(h?m:0)},"~B,~B,~B");d(c$,"getDiameter",function(){var a;0>=this.mesh.diameter?(a=0>this.meshScale?this.meshScale=this.vwr.getInt(553648149):this.meshScale,this.antialias&&(a*=2)):a=D(this.vwr.getScreenDim()/100);1>a&&(a=1);return a});d(c$,"renderNormals",function(){if(this.g3d.setC(JU.C.copyColixTranslucency(this.mesh.colix,8))){this.vwr.gdata.setFontBold("Monospaced",24);for(var a=JU.Normix.getVertexVectors(),b=this.vertexCount;0<=--b;)if(!(null!=
this.vertexValues&&Float.isNaN(this.vertexValues[b]))){this.pt1f.setT(this.vertices[b]);var c=this.mesh.normixes[b];0<=c&&(this.pt2f.scaleAdd2(0.3,a[c],this.pt1f),this.tm.transformPtScrT3(this.pt2f,this.pt2f),this.pt1f.set(this.screens[b].x,this.screens[b].y,this.screens[b].z),this.g3d.drawLineAB(this.pt1f,this.pt2f))}}})})})(Clazz,Clazz.getClassName,Clazz.newLongArray,Clazz.doubleToByte,Clazz.doubleToInt,Clazz.doubleToLong,Clazz.declarePackage,Clazz.instanceOf,Clazz.load,Clazz.instantialize,Clazz.decorateAsClass,
Clazz.floatToInt,Clazz.floatToLong,Clazz.makeConstructor,Clazz.defineEnumConstant,Clazz.exceptionOf,Clazz.newIntArray,Clazz.defineStatics,Clazz.newFloatArray,Clazz.declareType,Clazz.prepareFields,Clazz.superConstructor,Clazz.newByteArray,Clazz.declareInterface,Clazz.p0p,Clazz.pu$h,Clazz.newShortArray,Clazz.innerTypeInstance,Clazz.isClassDefined,Clazz.prepareCallback,Clazz.newArray,Clazz.castNullAs,Clazz.floatToShort,Clazz.superCall,Clazz.decorateAsType,Clazz.newBooleanArray,Clazz.newCharArray,Clazz.implementOf,
Clazz.newDoubleArray,Clazz.overrideConstructor,Clazz.clone,Clazz.doubleToShort,Clazz.getInheritedLevel,Clazz.getParamsType,Clazz.isAF,Clazz.isAB,Clazz.isAI,Clazz.isAS,Clazz.isASS,Clazz.isAP,Clazz.isAFloat,Clazz.isAII,Clazz.isAFF,Clazz.isAFFF,Clazz.tryToSearchAndExecute,Clazz.getStackTrace,Clazz.inheritArgs,Clazz.alert,Clazz.defineMethod,Clazz.overrideMethod,Clazz.declareAnonymous,Clazz.cloneFinals);
