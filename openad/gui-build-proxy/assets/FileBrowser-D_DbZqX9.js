import{d as J,R as K,L as Q,b as X,u as Y,a as Z,r as w,c as ee,H as te,o as se,w as ae,ai as le,aj as P,P as ie,f as R,g as oe,h as i,i as c,v as r,S as m,m as h,F as v,A as S,j as ne,t as f,q as M,k as g,I as b,n as ce,p as re,C as ue,D as de,E as fe}from"./index-CbxKm7xL.js";const z=y=>(ue("data-v-3094a66b"),y=y(),de(),y),pe={key:0,class:"col-header"},me=z(()=>r("div",{class:"col-body"},null,-1)),ve=["title","onClick"],he={class:"col-body"},ye=["title","onClick"],ke=["title","onClick"],_e=["data-type","data-ext","title","onClick","onDblclick"],we=["data-type","data-ext","title","onClick","onDblclick","x"],Se={key:0,class:"empty"},Ce={key:0,class:"col-split"},Me={key:0,class:"column file-preview"},ge=["title"],be={id:"file-preview"},Be={class:"soft"},Te=z(()=>r("br",null,null,-1)),xe={class:"column filler-right"},Ee={key:0,class:"col-header"},Fe=z(()=>r("div",{class:"col-body"},null,-1)),Le=J({__name:"FileBrowser",props:{isModal:{type:Boolean},modelValue:{}},emits:["update:modelValue"],setup(y,{emit:$}){const V=K(),I=Q(),A=X(),k=Y(),C=Z(),B=w(!1),l=w(null),d=w(null),T=w(null),j=w(null),q=$,p=y,N=ee(()=>p.isModal??V.headless);te(async()=>{B.value=!0,l.value=l.value?l.value:[],x(),p.isModal||window.addEventListener("popstate",x)}),se(()=>{B.value=!1,p.isModal||window.removeEventListener("popstate",x)}),ae(()=>V.workspace,(t,s)=>{t&&s&&_()});async function x(){await _();const s=(p.isModal&&p.modelValue!=null?p.modelValue:C.path.replace(/(^\/headless)?\/~(\/)?/,"")).split("/").filter(a=>!!a);for(const[a,o]of s.entries()){const e=s.slice(0,a+1).join("/");await _(e,o,a+1)}const n=C.hash.replace(/^#/,"");if(l.value&&n&&n.length>0){const a=l.value[l.value.length-1],e=a.files.concat(a.filesHidden).filter(u=>u.filename===n)[0];e?E(e,l.value.length):p.isModal||k.push({path:C.path,query:C.query})}}async function E(t,s,n=!1){const a=new RegExp("/?"+t.filename+"$"),o=t.path.replace(a,""),e=N.value?"/headless":"";p.isModal||k.push(e+"/~/"+o+"#"+t.filename),L(s-1),t.sel=!0,t.dispSize=le(t._meta.size),t.dispTimeCreated=P(t._meta.timeCreated),t.dispTimeEdited=P(t._meta.timeEdited),l.value&&l.value.splice(s),d.value=t,D()}function H(){d.value=null}function F(t){if(p.isModal)return;const s=t._meta.size,n=s&&s>3e6,a=s&&s>1e7,o=s&&s>2e7;if(n){const e=o?"20 MB":a?"10 MB":"3 MB";let u=o?"It may take up to several minutes to load.":a?"It may take a minute to load.":"It may take a few seconds to load.";u+=" Are you sure you want to continue?",I.confirm(u,{title:`This file is over ${e}`,primaryBtn:"Open",onSubmit:()=>{A.setForcedLoading(!0),k.push("/~/"+t.path)}})}else k.push("/~/"+t.path)}async function _(t="",s="",n=0,a=!1){if(!B.value)return;a&&(p.isModal?q("update:modelValue",t):k.push("/~/"+t)),n>0&&W(n-1,"dir",s);const o=await U(t);o&&(H(),l.value&&(l.value.splice(n),l.value[n]=o)),a&&D()}async function D(){await ie(),T.value&&(T.value.scrollLeft=9999999999999)}function W(t,s,n){if(L(t),l.value){const a=l.value[t],e=a.dirs.concat(a.dirsHidden).filter(u=>u.filename===n)[0];e&&(e.sel=!0)}}async function O(t,s){var n;((n=t.target)==null?void 0:n.tagName)!=="BUTTON"&&(l.value&&l.value.splice(s+1),L(s),H())}function L(t){l.value&&(l.value[t].dirs.forEach(s=>s.sel=!1),l.value[t].dirsHidden.forEach(s=>s.sel=!1),l.value[t].files.forEach(s=>s.sel=!1),l.value[t].filesHidden.forEach(s=>s.sel=!1))}async function U(t=""){if(!R)return;const{status:s,data:n,statusText:a}=await R.getWorkspaceFiles(t);if(s!==200){console.error(a);return}else return n}return(t,s)=>{const n=oe("cv-button");return i(),c("div",{id:"col-scroll-x",ref_key:"colScroll",ref:T},[r("div",{id:"col-wrap",class:m({modal:t.isModal})},[r("div",{class:m(["column filler-left",{headless:N.value}])},[t.isModal?h("",!0):(i(),c("div",pe)),me],2),(i(!0),c(v,null,S(l.value,(a,o)=>(i(),c(v,{key:o},[r("div",{class:"column",ref_for:!0,ref_key:"columns",ref:j},[t.isModal?h("",!0):(i(),c("div",{key:0,class:m(["col-header",{root:o==0}]),title:a.dirname,onClick:e=>O(e,o)},[o==0?(i(),c("button",{key:0,class:"btn-workspace",onClick:s[0]||(s[0]=e=>ne(I).display("ModalWorkspaces"))},f(a.dirname),1)):(i(),c(v,{key:1},[M(f(a.dirname),1)],64))],10,ve)),r("div",he,[(i(!0),c(v,null,S(a.dirsHidden,(e,u)=>(i(),c("div",{key:u,class:m(["dir hidden",{sel:e.sel}]),title:e.filename,onClick:()=>_(e.path,e.filename,o+1,!0)},[r("div",null,f(e.filename),1),(i(),g(b,{icon:"icn-caret-right",key:e.filename}))],10,ye))),128)),(i(!0),c(v,null,S(a.dirs,(e,u)=>(i(),c("div",{key:u,class:m(["dir",{sel:e.sel}]),title:e.filename,onClick:()=>_(e.path,e.filename,o+1,!0)},[r("div",null,f(e.filename),1),(i(),g(b,{icon:"icn-caret-right",key:e.filename}))],10,ke))),128)),(i(!0),c(v,null,S(a.filesHidden,(e,u)=>(i(),c("div",{key:u,class:m(["file hidden",{sel:e.sel}]),"data-type":e._meta.fileType,"data-ext":e._meta.ext,title:e.filename,onClick:()=>E(e,o+1,!0),onDblclick:G=>F(e)},[(i(),g(b,{icon:"icn-file-"+e._meta.fileType,key:String(e._meta.fileType)},null,8,["icon"])),r("div",null,f(e.filename),1)],42,_e))),128)),(i(!0),c(v,null,S(a.files,(e,u)=>(i(),c("div",{key:u,class:m(["file",{sel:e.sel}]),"data-type":e._meta.fileType,"data-ext":e._meta.ext,title:e.filename,onClick:()=>E(e,o+1,!0),onDblclick:G=>F(e),x:"icn-file-"+e._meta.fileType},[(i(),g(b,{icon:"icn-file-"+e._meta.fileType,key:String(e._meta.fileType)},null,8,["icon"])),r("div",null,f(e.filename),1)],42,we))),128)),a._meta.empty?(i(),c("div",Se,"Empty directory")):h("",!0)])],512),l.value&&o<l.value.length-1||d.value?(i(),c("div",Ce)):h("",!0)],64))),128)),d.value&&!t.isModal?(i(),c("div",Me,[r("div",{class:"col-header",title:d.value.filename},f(d.value.filename),9,ge),r("div",be,[r("b",null,f(d.value.filename),1),r("small",null,[r("i",null,f(d.value.dispSize),1),r("div",Be,[M(" Created: "+f(d.value.dispTimeCreated),1),Te,M(" Last edit: "+f(d.value.dispTimeEdited),1)]),ce(n,{size:"small",kind:"secondary",onClick:s[1]||(s[1]=a=>F(d.value))},{default:re(()=>[M("open")]),_:1})])])])):h("",!0),r("div",xe,[t.isModal?h("",!0):(i(),c("div",Ee)),Fe])],2)],512)}}}),Ve=fe(Le,[["__scopeId","data-v-3094a66b"]]);export{Ve as default};
