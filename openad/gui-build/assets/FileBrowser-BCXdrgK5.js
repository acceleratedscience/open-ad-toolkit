import{d as G,L as Z,M as J,u as K,a as Q,r as k,e as X,G as Y,o as ee,w as te,ag as se,ah as P,Z as ae,g as R,h as le,i,j as o,x as r,O as m,n as h,F as v,N as w,k as ie,t as f,v as M,l as S,H as T,p as oe,q as ne,C as ce,D as re,E as ue}from"./index-lOmmCXOX.js";const N=y=>(ce("data-v-5bf012c2"),y=y(),re(),y),de={key:0,class:"col-header"},fe=N(()=>r("div",{class:"col-body"},null,-1)),pe=["title","onClick"],me={class:"col-body"},ve=["title","onClick"],he=["title","onClick"],ye=["data-type","data-ext","title","onClick","onDblclick"],_e=["data-type","data-ext","title","onClick","onDblclick","x"],ke={key:0,class:"empty"},we={key:0,class:"col-split"},Ce={key:0,class:"column file-preview"},ge=["title"],Me={id:"file-preview"},Se={class:"soft"},Te=N(()=>r("br",null,null,-1)),be={class:"column filler-right"},xe={key:0,class:"col-header"},Ee=N(()=>r("div",{class:"col-body"},null,-1)),Be=G({__name:"FileBrowser",props:{isModal:{type:Boolean},modelValue:{}},emits:["update:modelValue"],setup(y,{emit:$}){const V=Z(),I=J(),C=K(),g=Q(),b=k(!1),l=k(null),u=k(null),x=k(null),q=k(null),p=y,A=$,H=X(()=>p.isModal??V.headless);Y(async()=>{b.value=!0,l.value=l.value?l.value:[],E(),p.isModal||window.addEventListener("popstate",E)}),ee(()=>{b.value=!1,p.isModal||window.removeEventListener("popstate",E)}),te(()=>V.workspace,(t,s)=>{t&&s&&_()});async function E(){await _();const s=(p.isModal&&p.modelValue!=null?p.modelValue:g.path.replace(/(^\/headless)?\/~(\/)?/,"")).split("/").filter(a=>!!a);for(const[a,c]of s.entries()){const e=s.slice(0,a+1).join("/");await _(e,c,a+1)}const n=g.hash.replace(/^#/,"");if(l.value&&n&&n.length>0){const a=l.value[l.value.length-1],e=a.files.concat(a.filesHidden).filter(d=>d.filename===n)[0];e?B(e,l.value.length):p.isModal||C.push({path:g.path,query:g.query})}}async function B(t,s,n=!1){const a=new RegExp("/?"+t.filename+"$"),c=t.path.replace(a,""),e=H.value?"/headless":"";p.isModal||C.push(e+"/~/"+c+"#"+t.filename),L(s-1),t.sel=!0,t.dispSize=se(t._meta.size),t.dispTimeCreated=P(t._meta.timeCreated),t.dispTimeEdited=P(t._meta.timeEdited),l.value&&l.value.splice(s),u.value=t,D()}function z(){u.value=null}function F(t){p.isModal||C.push("/~/"+t.path)}async function _(t="",s="",n=0,a=!1){if(!b.value)return;a&&(p.isModal?A("update:modelValue",t):C.push("/~/"+t)),n>0&&W(n-1,"dir",s);const c=await O(t);c&&(z(),l.value&&(l.value.splice(n),l.value[n]=c)),a&&D()}async function D(){await ae(),x.value&&(x.value.scrollLeft=9999999999999)}function W(t,s,n){if(L(t),l.value){const a=l.value[t],e=a.dirs.concat(a.dirsHidden).filter(d=>d.filename===n)[0];e&&(e.sel=!0)}}async function j(t,s){var n;((n=t.target)==null?void 0:n.tagName)!=="BUTTON"&&(l.value&&l.value.splice(s+1),L(s),z())}function L(t){l.value&&(l.value[t].dirs.forEach(s=>s.sel=!1),l.value[t].dirsHidden.forEach(s=>s.sel=!1),l.value[t].files.forEach(s=>s.sel=!1),l.value[t].filesHidden.forEach(s=>s.sel=!1))}async function O(t=""){if(!R)return;const{status:s,data:n,statusText:a}=await R.getWorkspaceFiles(t);if(s!==200){console.error(a);return}else return n}return(t,s)=>{const n=le("cv-button");return i(),o("div",{id:"col-scroll-x",ref_key:"colScroll",ref:x},[r("div",{id:"col-wrap",class:m({modal:t.isModal})},[r("div",{class:m(["column filler-left",{headless:H.value}])},[t.isModal?h("",!0):(i(),o("div",de)),fe],2),(i(!0),o(v,null,w(l.value,(a,c)=>(i(),o(v,{key:c},[r("div",{class:"column",ref_for:!0,ref_key:"columns",ref:q},[t.isModal?h("",!0):(i(),o("div",{key:0,class:m(["col-header",{root:c==0}]),title:a.dirname,onClick:e=>j(e,c)},[c==0?(i(),o("button",{key:0,class:"btn-workspace",onClick:s[0]||(s[0]=e=>ie(I).display("ModalWorkspaces"))},f(a.dirname),1)):(i(),o(v,{key:1},[M(f(a.dirname),1)],64))],10,pe)),r("div",me,[(i(!0),o(v,null,w(a.dirsHidden,(e,d)=>(i(),o("div",{key:d,class:m(["dir hidden",{sel:e.sel}]),title:e.filename,onClick:()=>_(e.path,e.filename,c+1,!0)},[r("div",null,f(e.filename),1),(i(),S(T,{icon:"icn-caret-right",key:e.filename}))],10,ve))),128)),(i(!0),o(v,null,w(a.dirs,(e,d)=>(i(),o("div",{key:d,class:m(["dir",{sel:e.sel}]),title:e.filename,onClick:()=>_(e.path,e.filename,c+1,!0)},[r("div",null,f(e.filename),1),(i(),S(T,{icon:"icn-caret-right",key:e.filename}))],10,he))),128)),(i(!0),o(v,null,w(a.filesHidden,(e,d)=>(i(),o("div",{key:d,class:m(["file hidden",{sel:e.sel}]),"data-type":e._meta.fileType,"data-ext":e._meta.ext,title:e.filename,onClick:()=>B(e,c+1,!0),onDblclick:U=>F(e)},[(i(),S(T,{icon:"icn-file-"+e._meta.fileType,key:String(e._meta.fileType)},null,8,["icon"])),r("div",null,f(e.filename),1)],42,ye))),128)),(i(!0),o(v,null,w(a.files,(e,d)=>(i(),o("div",{key:d,class:m(["file",{sel:e.sel}]),"data-type":e._meta.fileType,"data-ext":e._meta.ext,title:e.filename,onClick:()=>B(e,c+1,!0),onDblclick:U=>F(e),x:"icn-file-"+e._meta.fileType},[(i(),S(T,{icon:"icn-file-"+e._meta.fileType,key:String(e._meta.fileType)},null,8,["icon"])),r("div",null,f(e.filename),1)],42,_e))),128)),a._meta.empty?(i(),o("div",ke,"Empty directory")):h("",!0)])],512),l.value&&c<l.value.length-1||u.value?(i(),o("div",we)):h("",!0)],64))),128)),u.value&&!t.isModal?(i(),o("div",Ce,[r("div",{class:"col-header",title:u.value.filename},f(u.value.filename),9,ge),r("div",Me,[r("b",null,f(u.value.filename),1),r("small",null,[r("i",null,f(u.value.dispSize),1),r("div",Se,[M(" Created: "+f(u.value.dispTimeCreated),1),Te,M(" Last edit: "+f(u.value.dispTimeEdited),1)]),oe(n,{size:"small",kind:"secondary",onClick:s[1]||(s[1]=a=>F(u.value))},{default:ne(()=>[M("open")]),_:1})])])])):h("",!0),r("div",be,[t.isModal?h("",!0):(i(),o("div",xe)),Ee])],2)],512)}}}),Le=ue(Be,[["__scopeId","data-v-5bf012c2"]]);export{Le as default};
