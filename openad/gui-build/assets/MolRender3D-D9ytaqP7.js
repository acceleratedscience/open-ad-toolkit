var zP=Object.defineProperty;var VP=(s,e,t)=>e in s?zP(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var lt=(s,e,t)=>VP(s,typeof e!="symbol"?e+"":e,t);import{a7 as lc,a8 as kP,d as GP,r as em,c as xy,H as HP,w as WP,o as XP,h as yy,i as vy,v as cc,n as Sy,Q as by,t as YP,j as jP,X as qP,m as $P,S as ZP,F as KP,P as JP,E as QP}from"./index-C4atIFxU.js";var qd={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */qd.exports;(function(s,e){(function(){var t,n="4.17.21",i=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",h=500,u="__lodash_placeholder__",f=1,p=2,m=4,g=1,v=2,y=1,x=2,w=4,S=8,E=16,A=32,C=64,P=128,L=256,T=512,R=30,G="...",K=800,Z=16,O=1,V=2,j=3,q=1/0,J=9007199254740991,se=17976931348623157e292,_e=NaN,Re=4294967295,ae=Re-1,ve=Re>>>1,oe=[["ary",P],["bind",y],["bindKey",x],["curry",S],["curryRight",E],["flip",T],["partial",A],["partialRight",C],["rearg",L]],Ce="[object Arguments]",Ie="[object Array]",ke="[object AsyncFunction]",Ye="[object Boolean]",$e="[object Date]",et="[object DOMException]",Ke="[object Error]",W="[object Function]",Le="[object GeneratorFunction]",Q="[object Map]",he="[object Number]",fe="[object Null]",De="[object Object]",je="[object Promise]",qe="[object Proxy]",it="[object RegExp]",ot="[object Set]",_t="[object String]",H="[object Symbol]",U="[object Undefined]",we="[object WeakMap]",We="[object WeakSet]",Ge="[object ArrayBuffer]",Je="[object DataView]",nt="[object Float32Array]",N="[object Float64Array]",F="[object Int8Array]",k="[object Int16Array]",ee="[object Int32Array]",ne="[object Uint8Array]",ye="[object Uint8ClampedArray]",ue="[object Uint16Array]",Ue="[object Uint32Array]",Ze=/\b__p \+= '';/g,Y=/\b(__p \+=) '' \+/g,Ve=/(__e\(.*?\)|\b__t\)) \+\n'';/g,me=/&(?:amp|lt|gt|quot|#39);/g,xe=/[&<>"']/g,Pe=RegExp(me.source),Qe=RegExp(xe.source),ie=/<%-([\s\S]+?)%>/g,at=/<%([\s\S]+?)%>/g,ce=/<%=([\s\S]+?)%>/g,wt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,be=/^\w*$/,Et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gn=/[\\^$.*+?()[\]{}|]/g,Dn=RegExp(gn.source),$n=/^\s+/,Un=/\s/,Zt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,wn=/\{\n\/\* \[wrapped with (.+)\] \*/,cr=/,? & /,Cr=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Rr=/[()=,{}\[\]\/\s]/,As=/\\(\\)?/g,z=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ge=/\w*$/,Te=/^[-+]0x[0-9a-f]+$/i,de=/^0b[01]+$/i,Ae=/^\[object .+?Constructor\]$/,rt=/^0o[0-7]+$/i,ut=/^(?:0|[1-9]\d*)$/,gt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,mt=/($^)/,Mt=/['\n\r\u2028\u2029\\]/g,ft="\\ud800-\\udfff",At="\\u0300-\\u036f",qt="\\ufe20-\\ufe2f",nn="\\u20d0-\\u20ff",Bn=At+qt+nn,Zn="\\u2700-\\u27bf",ln="a-z\\xdf-\\xf6\\xf8-\\xff",kt="\\xac\\xb1\\xd7\\xf7",Wl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Mn="\\u2000-\\u206f",Xr=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xl="A-Z\\xc0-\\xd6\\xd8-\\xde",Ts="\\ufe0e\\ufe0f",da=kt+Wl+Mn+Xr,Tn="['’]",Yr="["+ft+"]",fa="["+da+"]",zn="["+Bn+"]",pa="\\d+",Wf="["+Zn+"]",Yl="["+ln+"]",n1="[^"+ft+da+pa+Zn+ln+Xl+"]",Xf="\\ud83c[\\udffb-\\udfff]",kE="(?:"+zn+"|"+Xf+")",i1="[^"+ft+"]",Yf="(?:\\ud83c[\\udde6-\\uddff]){2}",jf="[\\ud800-\\udbff][\\udc00-\\udfff]",ma="["+Xl+"]",r1="\\u200d",s1="(?:"+Yl+"|"+n1+")",GE="(?:"+ma+"|"+n1+")",o1="(?:"+Tn+"(?:d|ll|m|re|s|t|ve))?",a1="(?:"+Tn+"(?:D|LL|M|RE|S|T|VE))?",l1=kE+"?",c1="["+Ts+"]?",HE="(?:"+r1+"(?:"+[i1,Yf,jf].join("|")+")"+c1+l1+")*",WE="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",XE="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",h1=c1+l1+HE,YE="(?:"+[Wf,Yf,jf].join("|")+")"+h1,jE="(?:"+[i1+zn+"?",zn,Yf,jf,Yr].join("|")+")",qE=RegExp(Tn,"g"),$E=RegExp(zn,"g"),qf=RegExp(Xf+"(?="+Xf+")|"+jE+h1,"g"),ZE=RegExp([ma+"?"+Yl+"+"+o1+"(?="+[fa,ma,"$"].join("|")+")",GE+"+"+a1+"(?="+[fa,ma+s1,"$"].join("|")+")",ma+"?"+s1+"+"+o1,ma+"+"+a1,XE,WE,pa,YE].join("|"),"g"),KE=RegExp("["+r1+ft+Bn+Ts+"]"),JE=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,QE=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],eA=-1,on={};on[nt]=on[N]=on[F]=on[k]=on[ee]=on[ne]=on[ye]=on[ue]=on[Ue]=!0,on[Ce]=on[Ie]=on[Ge]=on[Ye]=on[Je]=on[$e]=on[Ke]=on[W]=on[Q]=on[he]=on[De]=on[it]=on[ot]=on[_t]=on[we]=!1;var rn={};rn[Ce]=rn[Ie]=rn[Ge]=rn[Je]=rn[Ye]=rn[$e]=rn[nt]=rn[N]=rn[F]=rn[k]=rn[ee]=rn[Q]=rn[he]=rn[De]=rn[it]=rn[ot]=rn[_t]=rn[H]=rn[ne]=rn[ye]=rn[ue]=rn[Ue]=!0,rn[Ke]=rn[W]=rn[we]=!1;var tA={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},nA={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},iA={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},rA={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},sA=parseFloat,oA=parseInt,u1=typeof lc=="object"&&lc&&lc.Object===Object&&lc,aA=typeof self=="object"&&self&&self.Object===Object&&self,Hn=u1||aA||Function("return this")(),$f=e&&!e.nodeType&&e,go=$f&&!0&&s&&!s.nodeType&&s,d1=go&&go.exports===$f,Zf=d1&&u1.process,qi=function(){try{var re=go&&go.require&&go.require("util").types;return re||Zf&&Zf.binding&&Zf.binding("util")}catch{}}(),f1=qi&&qi.isArrayBuffer,p1=qi&&qi.isDate,m1=qi&&qi.isMap,g1=qi&&qi.isRegExp,_1=qi&&qi.isSet,x1=qi&&qi.isTypedArray;function Ri(re,Ne,Ee){switch(Ee.length){case 0:return re.call(Ne);case 1:return re.call(Ne,Ee[0]);case 2:return re.call(Ne,Ee[0],Ee[1]);case 3:return re.call(Ne,Ee[0],Ee[1],Ee[2])}return re.apply(Ne,Ee)}function lA(re,Ne,Ee,ht){for(var Tt=-1,jt=re==null?0:re.length;++Tt<jt;){var Cn=re[Tt];Ne(ht,Cn,Ee(Cn),re)}return ht}function $i(re,Ne){for(var Ee=-1,ht=re==null?0:re.length;++Ee<ht&&Ne(re[Ee],Ee,re)!==!1;);return re}function cA(re,Ne){for(var Ee=re==null?0:re.length;Ee--&&Ne(re[Ee],Ee,re)!==!1;);return re}function y1(re,Ne){for(var Ee=-1,ht=re==null?0:re.length;++Ee<ht;)if(!Ne(re[Ee],Ee,re))return!1;return!0}function Cs(re,Ne){for(var Ee=-1,ht=re==null?0:re.length,Tt=0,jt=[];++Ee<ht;){var Cn=re[Ee];Ne(Cn,Ee,re)&&(jt[Tt++]=Cn)}return jt}function Wh(re,Ne){var Ee=re==null?0:re.length;return!!Ee&&ga(re,Ne,0)>-1}function Kf(re,Ne,Ee){for(var ht=-1,Tt=re==null?0:re.length;++ht<Tt;)if(Ee(Ne,re[ht]))return!0;return!1}function an(re,Ne){for(var Ee=-1,ht=re==null?0:re.length,Tt=Array(ht);++Ee<ht;)Tt[Ee]=Ne(re[Ee],Ee,re);return Tt}function Rs(re,Ne){for(var Ee=-1,ht=Ne.length,Tt=re.length;++Ee<ht;)re[Tt+Ee]=Ne[Ee];return re}function Jf(re,Ne,Ee,ht){var Tt=-1,jt=re==null?0:re.length;for(ht&&jt&&(Ee=re[++Tt]);++Tt<jt;)Ee=Ne(Ee,re[Tt],Tt,re);return Ee}function hA(re,Ne,Ee,ht){var Tt=re==null?0:re.length;for(ht&&Tt&&(Ee=re[--Tt]);Tt--;)Ee=Ne(Ee,re[Tt],Tt,re);return Ee}function Qf(re,Ne){for(var Ee=-1,ht=re==null?0:re.length;++Ee<ht;)if(Ne(re[Ee],Ee,re))return!0;return!1}var uA=ep("length");function dA(re){return re.split("")}function fA(re){return re.match(Cr)||[]}function v1(re,Ne,Ee){var ht;return Ee(re,function(Tt,jt,Cn){if(Ne(Tt,jt,Cn))return ht=jt,!1}),ht}function Xh(re,Ne,Ee,ht){for(var Tt=re.length,jt=Ee+(ht?1:-1);ht?jt--:++jt<Tt;)if(Ne(re[jt],jt,re))return jt;return-1}function ga(re,Ne,Ee){return Ne===Ne?EA(re,Ne,Ee):Xh(re,S1,Ee)}function pA(re,Ne,Ee,ht){for(var Tt=Ee-1,jt=re.length;++Tt<jt;)if(ht(re[Tt],Ne))return Tt;return-1}function S1(re){return re!==re}function b1(re,Ne){var Ee=re==null?0:re.length;return Ee?np(re,Ne)/Ee:_e}function ep(re){return function(Ne){return Ne==null?t:Ne[re]}}function tp(re){return function(Ne){return re==null?t:re[Ne]}}function w1(re,Ne,Ee,ht,Tt){return Tt(re,function(jt,Cn,en){Ee=ht?(ht=!1,jt):Ne(Ee,jt,Cn,en)}),Ee}function mA(re,Ne){var Ee=re.length;for(re.sort(Ne);Ee--;)re[Ee]=re[Ee].value;return re}function np(re,Ne){for(var Ee,ht=-1,Tt=re.length;++ht<Tt;){var jt=Ne(re[ht]);jt!==t&&(Ee=Ee===t?jt:Ee+jt)}return Ee}function ip(re,Ne){for(var Ee=-1,ht=Array(re);++Ee<re;)ht[Ee]=Ne(Ee);return ht}function gA(re,Ne){return an(Ne,function(Ee){return[Ee,re[Ee]]})}function M1(re){return re&&re.slice(0,C1(re)+1).replace($n,"")}function Pi(re){return function(Ne){return re(Ne)}}function rp(re,Ne){return an(Ne,function(Ee){return re[Ee]})}function jl(re,Ne){return re.has(Ne)}function E1(re,Ne){for(var Ee=-1,ht=re.length;++Ee<ht&&ga(Ne,re[Ee],0)>-1;);return Ee}function A1(re,Ne){for(var Ee=re.length;Ee--&&ga(Ne,re[Ee],0)>-1;);return Ee}function _A(re,Ne){for(var Ee=re.length,ht=0;Ee--;)re[Ee]===Ne&&++ht;return ht}var xA=tp(tA),yA=tp(nA);function vA(re){return"\\"+rA[re]}function SA(re,Ne){return re==null?t:re[Ne]}function _a(re){return KE.test(re)}function bA(re){return JE.test(re)}function wA(re){for(var Ne,Ee=[];!(Ne=re.next()).done;)Ee.push(Ne.value);return Ee}function sp(re){var Ne=-1,Ee=Array(re.size);return re.forEach(function(ht,Tt){Ee[++Ne]=[Tt,ht]}),Ee}function T1(re,Ne){return function(Ee){return re(Ne(Ee))}}function Ps(re,Ne){for(var Ee=-1,ht=re.length,Tt=0,jt=[];++Ee<ht;){var Cn=re[Ee];(Cn===Ne||Cn===u)&&(re[Ee]=u,jt[Tt++]=Ee)}return jt}function Yh(re){var Ne=-1,Ee=Array(re.size);return re.forEach(function(ht){Ee[++Ne]=ht}),Ee}function MA(re){var Ne=-1,Ee=Array(re.size);return re.forEach(function(ht){Ee[++Ne]=[ht,ht]}),Ee}function EA(re,Ne,Ee){for(var ht=Ee-1,Tt=re.length;++ht<Tt;)if(re[ht]===Ne)return ht;return-1}function AA(re,Ne,Ee){for(var ht=Ee+1;ht--;)if(re[ht]===Ne)return ht;return ht}function xa(re){return _a(re)?CA(re):uA(re)}function hr(re){return _a(re)?RA(re):dA(re)}function C1(re){for(var Ne=re.length;Ne--&&Un.test(re.charAt(Ne)););return Ne}var TA=tp(iA);function CA(re){for(var Ne=qf.lastIndex=0;qf.test(re);)++Ne;return Ne}function RA(re){return re.match(qf)||[]}function PA(re){return re.match(ZE)||[]}var IA=function re(Ne){Ne=Ne==null?Hn:ya.defaults(Hn.Object(),Ne,ya.pick(Hn,QE));var Ee=Ne.Array,ht=Ne.Date,Tt=Ne.Error,jt=Ne.Function,Cn=Ne.Math,en=Ne.Object,op=Ne.RegExp,LA=Ne.String,Zi=Ne.TypeError,jh=Ee.prototype,NA=jt.prototype,va=en.prototype,qh=Ne["__core-js_shared__"],$h=NA.toString,Kt=va.hasOwnProperty,FA=0,R1=function(){var c=/[^.]+$/.exec(qh&&qh.keys&&qh.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),Zh=va.toString,OA=$h.call(en),DA=Hn._,UA=op("^"+$h.call(Kt).replace(gn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Kh=d1?Ne.Buffer:t,Is=Ne.Symbol,Jh=Ne.Uint8Array,P1=Kh?Kh.allocUnsafe:t,Qh=T1(en.getPrototypeOf,en),I1=en.create,L1=va.propertyIsEnumerable,eu=jh.splice,N1=Is?Is.isConcatSpreadable:t,ql=Is?Is.iterator:t,_o=Is?Is.toStringTag:t,tu=function(){try{var c=bo(en,"defineProperty");return c({},"",{}),c}catch{}}(),BA=Ne.clearTimeout!==Hn.clearTimeout&&Ne.clearTimeout,zA=ht&&ht.now!==Hn.Date.now&&ht.now,VA=Ne.setTimeout!==Hn.setTimeout&&Ne.setTimeout,nu=Cn.ceil,iu=Cn.floor,ap=en.getOwnPropertySymbols,kA=Kh?Kh.isBuffer:t,F1=Ne.isFinite,GA=jh.join,HA=T1(en.keys,en),Rn=Cn.max,Kn=Cn.min,WA=ht.now,XA=Ne.parseInt,O1=Cn.random,YA=jh.reverse,lp=bo(Ne,"DataView"),$l=bo(Ne,"Map"),cp=bo(Ne,"Promise"),Sa=bo(Ne,"Set"),Zl=bo(Ne,"WeakMap"),Kl=bo(en,"create"),ru=Zl&&new Zl,ba={},jA=wo(lp),qA=wo($l),$A=wo(cp),ZA=wo(Sa),KA=wo(Zl),su=Is?Is.prototype:t,Jl=su?su.valueOf:t,D1=su?su.toString:t;function D(c){if(fn(c)&&!Rt(c)&&!(c instanceof Gt)){if(c instanceof Ki)return c;if(Kt.call(c,"__wrapped__"))return Ux(c)}return new Ki(c)}var wa=function(){function c(){}return function(d){if(!cn(d))return{};if(I1)return I1(d);c.prototype=d;var _=new c;return c.prototype=t,_}}();function ou(){}function Ki(c,d){this.__wrapped__=c,this.__actions__=[],this.__chain__=!!d,this.__index__=0,this.__values__=t}D.templateSettings={escape:ie,evaluate:at,interpolate:ce,variable:"",imports:{_:D}},D.prototype=ou.prototype,D.prototype.constructor=D,Ki.prototype=wa(ou.prototype),Ki.prototype.constructor=Ki;function Gt(c){this.__wrapped__=c,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Re,this.__views__=[]}function JA(){var c=new Gt(this.__wrapped__);return c.__actions__=mi(this.__actions__),c.__dir__=this.__dir__,c.__filtered__=this.__filtered__,c.__iteratees__=mi(this.__iteratees__),c.__takeCount__=this.__takeCount__,c.__views__=mi(this.__views__),c}function QA(){if(this.__filtered__){var c=new Gt(this);c.__dir__=-1,c.__filtered__=!0}else c=this.clone(),c.__dir__*=-1;return c}function eT(){var c=this.__wrapped__.value(),d=this.__dir__,_=Rt(c),M=d<0,I=_?c.length:0,B=dC(0,I,this.__views__),$=B.start,te=B.end,le=te-$,Be=M?te:$-1,ze=this.__iteratees__,Xe=ze.length,st=0,pt=Kn(le,this.__takeCount__);if(!_||!M&&I==le&&pt==le)return ox(c,this.__actions__);var vt=[];e:for(;le--&&st<pt;){Be+=d;for(var Nt=-1,St=c[Be];++Nt<Xe;){var Vt=ze[Nt],Ht=Vt.iteratee,Ni=Vt.type,li=Ht(St);if(Ni==V)St=li;else if(!li){if(Ni==O)continue e;break e}}vt[st++]=St}return vt}Gt.prototype=wa(ou.prototype),Gt.prototype.constructor=Gt;function xo(c){var d=-1,_=c==null?0:c.length;for(this.clear();++d<_;){var M=c[d];this.set(M[0],M[1])}}function tT(){this.__data__=Kl?Kl(null):{},this.size=0}function nT(c){var d=this.has(c)&&delete this.__data__[c];return this.size-=d?1:0,d}function iT(c){var d=this.__data__;if(Kl){var _=d[c];return _===l?t:_}return Kt.call(d,c)?d[c]:t}function rT(c){var d=this.__data__;return Kl?d[c]!==t:Kt.call(d,c)}function sT(c,d){var _=this.__data__;return this.size+=this.has(c)?0:1,_[c]=Kl&&d===t?l:d,this}xo.prototype.clear=tT,xo.prototype.delete=nT,xo.prototype.get=iT,xo.prototype.has=rT,xo.prototype.set=sT;function jr(c){var d=-1,_=c==null?0:c.length;for(this.clear();++d<_;){var M=c[d];this.set(M[0],M[1])}}function oT(){this.__data__=[],this.size=0}function aT(c){var d=this.__data__,_=au(d,c);if(_<0)return!1;var M=d.length-1;return _==M?d.pop():eu.call(d,_,1),--this.size,!0}function lT(c){var d=this.__data__,_=au(d,c);return _<0?t:d[_][1]}function cT(c){return au(this.__data__,c)>-1}function hT(c,d){var _=this.__data__,M=au(_,c);return M<0?(++this.size,_.push([c,d])):_[M][1]=d,this}jr.prototype.clear=oT,jr.prototype.delete=aT,jr.prototype.get=lT,jr.prototype.has=cT,jr.prototype.set=hT;function qr(c){var d=-1,_=c==null?0:c.length;for(this.clear();++d<_;){var M=c[d];this.set(M[0],M[1])}}function uT(){this.size=0,this.__data__={hash:new xo,map:new($l||jr),string:new xo}}function dT(c){var d=yu(this,c).delete(c);return this.size-=d?1:0,d}function fT(c){return yu(this,c).get(c)}function pT(c){return yu(this,c).has(c)}function mT(c,d){var _=yu(this,c),M=_.size;return _.set(c,d),this.size+=_.size==M?0:1,this}qr.prototype.clear=uT,qr.prototype.delete=dT,qr.prototype.get=fT,qr.prototype.has=pT,qr.prototype.set=mT;function yo(c){var d=-1,_=c==null?0:c.length;for(this.__data__=new qr;++d<_;)this.add(c[d])}function gT(c){return this.__data__.set(c,l),this}function _T(c){return this.__data__.has(c)}yo.prototype.add=yo.prototype.push=gT,yo.prototype.has=_T;function ur(c){var d=this.__data__=new jr(c);this.size=d.size}function xT(){this.__data__=new jr,this.size=0}function yT(c){var d=this.__data__,_=d.delete(c);return this.size=d.size,_}function vT(c){return this.__data__.get(c)}function ST(c){return this.__data__.has(c)}function bT(c,d){var _=this.__data__;if(_ instanceof jr){var M=_.__data__;if(!$l||M.length<i-1)return M.push([c,d]),this.size=++_.size,this;_=this.__data__=new qr(M)}return _.set(c,d),this.size=_.size,this}ur.prototype.clear=xT,ur.prototype.delete=yT,ur.prototype.get=vT,ur.prototype.has=ST,ur.prototype.set=bT;function U1(c,d){var _=Rt(c),M=!_&&Mo(c),I=!_&&!M&&Ds(c),B=!_&&!M&&!I&&Ta(c),$=_||M||I||B,te=$?ip(c.length,LA):[],le=te.length;for(var Be in c)(d||Kt.call(c,Be))&&!($&&(Be=="length"||I&&(Be=="offset"||Be=="parent")||B&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||Jr(Be,le)))&&te.push(Be);return te}function B1(c){var d=c.length;return d?c[vp(0,d-1)]:t}function wT(c,d){return vu(mi(c),vo(d,0,c.length))}function MT(c){return vu(mi(c))}function hp(c,d,_){(_!==t&&!dr(c[d],_)||_===t&&!(d in c))&&$r(c,d,_)}function Ql(c,d,_){var M=c[d];(!(Kt.call(c,d)&&dr(M,_))||_===t&&!(d in c))&&$r(c,d,_)}function au(c,d){for(var _=c.length;_--;)if(dr(c[_][0],d))return _;return-1}function ET(c,d,_,M){return Ls(c,function(I,B,$){d(M,I,_(I),$)}),M}function z1(c,d){return c&&Ir(d,Vn(d),c)}function AT(c,d){return c&&Ir(d,_i(d),c)}function $r(c,d,_){d=="__proto__"&&tu?tu(c,d,{configurable:!0,enumerable:!0,value:_,writable:!0}):c[d]=_}function up(c,d){for(var _=-1,M=d.length,I=Ee(M),B=c==null;++_<M;)I[_]=B?t:Xp(c,d[_]);return I}function vo(c,d,_){return c===c&&(_!==t&&(c=c<=_?c:_),d!==t&&(c=c>=d?c:d)),c}function Ji(c,d,_,M,I,B){var $,te=d&f,le=d&p,Be=d&m;if(_&&($=I?_(c,M,I,B):_(c)),$!==t)return $;if(!cn(c))return c;var ze=Rt(c);if(ze){if($=pC(c),!te)return mi(c,$)}else{var Xe=Jn(c),st=Xe==W||Xe==Le;if(Ds(c))return cx(c,te);if(Xe==De||Xe==Ce||st&&!I){if($=le||st?{}:Cx(c),!te)return le?iC(c,AT($,c)):nC(c,z1($,c))}else{if(!rn[Xe])return I?c:{};$=mC(c,Xe,te)}}B||(B=new ur);var pt=B.get(c);if(pt)return pt;B.set(c,$),iy(c)?c.forEach(function(St){$.add(Ji(St,d,_,St,c,B))}):ty(c)&&c.forEach(function(St,Vt){$.set(Vt,Ji(St,d,_,Vt,c,B))});var vt=Be?le?Ip:Pp:le?_i:Vn,Nt=ze?t:vt(c);return $i(Nt||c,function(St,Vt){Nt&&(Vt=St,St=c[Vt]),Ql($,Vt,Ji(St,d,_,Vt,c,B))}),$}function TT(c){var d=Vn(c);return function(_){return V1(_,c,d)}}function V1(c,d,_){var M=_.length;if(c==null)return!M;for(c=en(c);M--;){var I=_[M],B=d[I],$=c[I];if($===t&&!(I in c)||!B($))return!1}return!0}function k1(c,d,_){if(typeof c!="function")throw new Zi(o);return oc(function(){c.apply(t,_)},d)}function ec(c,d,_,M){var I=-1,B=Wh,$=!0,te=c.length,le=[],Be=d.length;if(!te)return le;_&&(d=an(d,Pi(_))),M?(B=Kf,$=!1):d.length>=i&&(B=jl,$=!1,d=new yo(d));e:for(;++I<te;){var ze=c[I],Xe=_==null?ze:_(ze);if(ze=M||ze!==0?ze:0,$&&Xe===Xe){for(var st=Be;st--;)if(d[st]===Xe)continue e;le.push(ze)}else B(d,Xe,M)||le.push(ze)}return le}var Ls=px(Pr),G1=px(fp,!0);function CT(c,d){var _=!0;return Ls(c,function(M,I,B){return _=!!d(M,I,B),_}),_}function lu(c,d,_){for(var M=-1,I=c.length;++M<I;){var B=c[M],$=d(B);if($!=null&&(te===t?$===$&&!Li($):_($,te)))var te=$,le=B}return le}function RT(c,d,_,M){var I=c.length;for(_=Lt(_),_<0&&(_=-_>I?0:I+_),M=M===t||M>I?I:Lt(M),M<0&&(M+=I),M=_>M?0:sy(M);_<M;)c[_++]=d;return c}function H1(c,d){var _=[];return Ls(c,function(M,I,B){d(M,I,B)&&_.push(M)}),_}function Wn(c,d,_,M,I){var B=-1,$=c.length;for(_||(_=_C),I||(I=[]);++B<$;){var te=c[B];d>0&&_(te)?d>1?Wn(te,d-1,_,M,I):Rs(I,te):M||(I[I.length]=te)}return I}var dp=mx(),W1=mx(!0);function Pr(c,d){return c&&dp(c,d,Vn)}function fp(c,d){return c&&W1(c,d,Vn)}function cu(c,d){return Cs(d,function(_){return Qr(c[_])})}function So(c,d){d=Fs(d,c);for(var _=0,M=d.length;c!=null&&_<M;)c=c[Lr(d[_++])];return _&&_==M?c:t}function X1(c,d,_){var M=d(c);return Rt(c)?M:Rs(M,_(c))}function oi(c){return c==null?c===t?U:fe:_o&&_o in en(c)?uC(c):MC(c)}function pp(c,d){return c>d}function PT(c,d){return c!=null&&Kt.call(c,d)}function IT(c,d){return c!=null&&d in en(c)}function LT(c,d,_){return c>=Kn(d,_)&&c<Rn(d,_)}function mp(c,d,_){for(var M=_?Kf:Wh,I=c[0].length,B=c.length,$=B,te=Ee(B),le=1/0,Be=[];$--;){var ze=c[$];$&&d&&(ze=an(ze,Pi(d))),le=Kn(ze.length,le),te[$]=!_&&(d||I>=120&&ze.length>=120)?new yo($&&ze):t}ze=c[0];var Xe=-1,st=te[0];e:for(;++Xe<I&&Be.length<le;){var pt=ze[Xe],vt=d?d(pt):pt;if(pt=_||pt!==0?pt:0,!(st?jl(st,vt):M(Be,vt,_))){for($=B;--$;){var Nt=te[$];if(!(Nt?jl(Nt,vt):M(c[$],vt,_)))continue e}st&&st.push(vt),Be.push(pt)}}return Be}function NT(c,d,_,M){return Pr(c,function(I,B,$){d(M,_(I),B,$)}),M}function tc(c,d,_){d=Fs(d,c),c=Lx(c,d);var M=c==null?c:c[Lr(er(d))];return M==null?t:Ri(M,c,_)}function Y1(c){return fn(c)&&oi(c)==Ce}function FT(c){return fn(c)&&oi(c)==Ge}function OT(c){return fn(c)&&oi(c)==$e}function nc(c,d,_,M,I){return c===d?!0:c==null||d==null||!fn(c)&&!fn(d)?c!==c&&d!==d:DT(c,d,_,M,nc,I)}function DT(c,d,_,M,I,B){var $=Rt(c),te=Rt(d),le=$?Ie:Jn(c),Be=te?Ie:Jn(d);le=le==Ce?De:le,Be=Be==Ce?De:Be;var ze=le==De,Xe=Be==De,st=le==Be;if(st&&Ds(c)){if(!Ds(d))return!1;$=!0,ze=!1}if(st&&!ze)return B||(B=new ur),$||Ta(c)?Ex(c,d,_,M,I,B):cC(c,d,le,_,M,I,B);if(!(_&g)){var pt=ze&&Kt.call(c,"__wrapped__"),vt=Xe&&Kt.call(d,"__wrapped__");if(pt||vt){var Nt=pt?c.value():c,St=vt?d.value():d;return B||(B=new ur),I(Nt,St,_,M,B)}}return st?(B||(B=new ur),hC(c,d,_,M,I,B)):!1}function UT(c){return fn(c)&&Jn(c)==Q}function gp(c,d,_,M){var I=_.length,B=I,$=!M;if(c==null)return!B;for(c=en(c);I--;){var te=_[I];if($&&te[2]?te[1]!==c[te[0]]:!(te[0]in c))return!1}for(;++I<B;){te=_[I];var le=te[0],Be=c[le],ze=te[1];if($&&te[2]){if(Be===t&&!(le in c))return!1}else{var Xe=new ur;if(M)var st=M(Be,ze,le,c,d,Xe);if(!(st===t?nc(ze,Be,g|v,M,Xe):st))return!1}}return!0}function j1(c){if(!cn(c)||yC(c))return!1;var d=Qr(c)?UA:Ae;return d.test(wo(c))}function BT(c){return fn(c)&&oi(c)==it}function zT(c){return fn(c)&&Jn(c)==ot}function VT(c){return fn(c)&&Au(c.length)&&!!on[oi(c)]}function q1(c){return typeof c=="function"?c:c==null?xi:typeof c=="object"?Rt(c)?K1(c[0],c[1]):Z1(c):gy(c)}function _p(c){if(!sc(c))return HA(c);var d=[];for(var _ in en(c))Kt.call(c,_)&&_!="constructor"&&d.push(_);return d}function kT(c){if(!cn(c))return wC(c);var d=sc(c),_=[];for(var M in c)M=="constructor"&&(d||!Kt.call(c,M))||_.push(M);return _}function xp(c,d){return c<d}function $1(c,d){var _=-1,M=gi(c)?Ee(c.length):[];return Ls(c,function(I,B,$){M[++_]=d(I,B,$)}),M}function Z1(c){var d=Np(c);return d.length==1&&d[0][2]?Px(d[0][0],d[0][1]):function(_){return _===c||gp(_,c,d)}}function K1(c,d){return Op(c)&&Rx(d)?Px(Lr(c),d):function(_){var M=Xp(_,c);return M===t&&M===d?Yp(_,c):nc(d,M,g|v)}}function hu(c,d,_,M,I){c!==d&&dp(d,function(B,$){if(I||(I=new ur),cn(B))GT(c,d,$,_,hu,M,I);else{var te=M?M(Up(c,$),B,$+"",c,d,I):t;te===t&&(te=B),hp(c,$,te)}},_i)}function GT(c,d,_,M,I,B,$){var te=Up(c,_),le=Up(d,_),Be=$.get(le);if(Be){hp(c,_,Be);return}var ze=B?B(te,le,_+"",c,d,$):t,Xe=ze===t;if(Xe){var st=Rt(le),pt=!st&&Ds(le),vt=!st&&!pt&&Ta(le);ze=le,st||pt||vt?Rt(te)?ze=te:_n(te)?ze=mi(te):pt?(Xe=!1,ze=cx(le,!0)):vt?(Xe=!1,ze=hx(le,!0)):ze=[]:ac(le)||Mo(le)?(ze=te,Mo(te)?ze=oy(te):(!cn(te)||Qr(te))&&(ze=Cx(le))):Xe=!1}Xe&&($.set(le,ze),I(ze,le,M,B,$),$.delete(le)),hp(c,_,ze)}function J1(c,d){var _=c.length;if(_)return d+=d<0?_:0,Jr(d,_)?c[d]:t}function Q1(c,d,_){d.length?d=an(d,function(B){return Rt(B)?function($){return So($,B.length===1?B[0]:B)}:B}):d=[xi];var M=-1;d=an(d,Pi(xt()));var I=$1(c,function(B,$,te){var le=an(d,function(Be){return Be(B)});return{criteria:le,index:++M,value:B}});return mA(I,function(B,$){return tC(B,$,_)})}function HT(c,d){return ex(c,d,function(_,M){return Yp(c,M)})}function ex(c,d,_){for(var M=-1,I=d.length,B={};++M<I;){var $=d[M],te=So(c,$);_(te,$)&&ic(B,Fs($,c),te)}return B}function WT(c){return function(d){return So(d,c)}}function yp(c,d,_,M){var I=M?pA:ga,B=-1,$=d.length,te=c;for(c===d&&(d=mi(d)),_&&(te=an(c,Pi(_)));++B<$;)for(var le=0,Be=d[B],ze=_?_(Be):Be;(le=I(te,ze,le,M))>-1;)te!==c&&eu.call(te,le,1),eu.call(c,le,1);return c}function tx(c,d){for(var _=c?d.length:0,M=_-1;_--;){var I=d[_];if(_==M||I!==B){var B=I;Jr(I)?eu.call(c,I,1):wp(c,I)}}return c}function vp(c,d){return c+iu(O1()*(d-c+1))}function XT(c,d,_,M){for(var I=-1,B=Rn(nu((d-c)/(_||1)),0),$=Ee(B);B--;)$[M?B:++I]=c,c+=_;return $}function Sp(c,d){var _="";if(!c||d<1||d>J)return _;do d%2&&(_+=c),d=iu(d/2),d&&(c+=c);while(d);return _}function Ut(c,d){return Bp(Ix(c,d,xi),c+"")}function YT(c){return B1(Ca(c))}function jT(c,d){var _=Ca(c);return vu(_,vo(d,0,_.length))}function ic(c,d,_,M){if(!cn(c))return c;d=Fs(d,c);for(var I=-1,B=d.length,$=B-1,te=c;te!=null&&++I<B;){var le=Lr(d[I]),Be=_;if(le==="__proto__"||le==="constructor"||le==="prototype")return c;if(I!=$){var ze=te[le];Be=M?M(ze,le,te):t,Be===t&&(Be=cn(ze)?ze:Jr(d[I+1])?[]:{})}Ql(te,le,Be),te=te[le]}return c}var nx=ru?function(c,d){return ru.set(c,d),c}:xi,qT=tu?function(c,d){return tu(c,"toString",{configurable:!0,enumerable:!1,value:qp(d),writable:!0})}:xi;function $T(c){return vu(Ca(c))}function Qi(c,d,_){var M=-1,I=c.length;d<0&&(d=-d>I?0:I+d),_=_>I?I:_,_<0&&(_+=I),I=d>_?0:_-d>>>0,d>>>=0;for(var B=Ee(I);++M<I;)B[M]=c[M+d];return B}function ZT(c,d){var _;return Ls(c,function(M,I,B){return _=d(M,I,B),!_}),!!_}function uu(c,d,_){var M=0,I=c==null?M:c.length;if(typeof d=="number"&&d===d&&I<=ve){for(;M<I;){var B=M+I>>>1,$=c[B];$!==null&&!Li($)&&(_?$<=d:$<d)?M=B+1:I=B}return I}return bp(c,d,xi,_)}function bp(c,d,_,M){var I=0,B=c==null?0:c.length;if(B===0)return 0;d=_(d);for(var $=d!==d,te=d===null,le=Li(d),Be=d===t;I<B;){var ze=iu((I+B)/2),Xe=_(c[ze]),st=Xe!==t,pt=Xe===null,vt=Xe===Xe,Nt=Li(Xe);if($)var St=M||vt;else Be?St=vt&&(M||st):te?St=vt&&st&&(M||!pt):le?St=vt&&st&&!pt&&(M||!Nt):pt||Nt?St=!1:St=M?Xe<=d:Xe<d;St?I=ze+1:B=ze}return Kn(B,ae)}function ix(c,d){for(var _=-1,M=c.length,I=0,B=[];++_<M;){var $=c[_],te=d?d($):$;if(!_||!dr(te,le)){var le=te;B[I++]=$===0?0:$}}return B}function rx(c){return typeof c=="number"?c:Li(c)?_e:+c}function Ii(c){if(typeof c=="string")return c;if(Rt(c))return an(c,Ii)+"";if(Li(c))return D1?D1.call(c):"";var d=c+"";return d=="0"&&1/c==-q?"-0":d}function Ns(c,d,_){var M=-1,I=Wh,B=c.length,$=!0,te=[],le=te;if(_)$=!1,I=Kf;else if(B>=i){var Be=d?null:aC(c);if(Be)return Yh(Be);$=!1,I=jl,le=new yo}else le=d?[]:te;e:for(;++M<B;){var ze=c[M],Xe=d?d(ze):ze;if(ze=_||ze!==0?ze:0,$&&Xe===Xe){for(var st=le.length;st--;)if(le[st]===Xe)continue e;d&&le.push(Xe),te.push(ze)}else I(le,Xe,_)||(le!==te&&le.push(Xe),te.push(ze))}return te}function wp(c,d){return d=Fs(d,c),c=Lx(c,d),c==null||delete c[Lr(er(d))]}function sx(c,d,_,M){return ic(c,d,_(So(c,d)),M)}function du(c,d,_,M){for(var I=c.length,B=M?I:-1;(M?B--:++B<I)&&d(c[B],B,c););return _?Qi(c,M?0:B,M?B+1:I):Qi(c,M?B+1:0,M?I:B)}function ox(c,d){var _=c;return _ instanceof Gt&&(_=_.value()),Jf(d,function(M,I){return I.func.apply(I.thisArg,Rs([M],I.args))},_)}function Mp(c,d,_){var M=c.length;if(M<2)return M?Ns(c[0]):[];for(var I=-1,B=Ee(M);++I<M;)for(var $=c[I],te=-1;++te<M;)te!=I&&(B[I]=ec(B[I]||$,c[te],d,_));return Ns(Wn(B,1),d,_)}function ax(c,d,_){for(var M=-1,I=c.length,B=d.length,$={};++M<I;){var te=M<B?d[M]:t;_($,c[M],te)}return $}function Ep(c){return _n(c)?c:[]}function Ap(c){return typeof c=="function"?c:xi}function Fs(c,d){return Rt(c)?c:Op(c,d)?[c]:Dx($t(c))}var KT=Ut;function Os(c,d,_){var M=c.length;return _=_===t?M:_,!d&&_>=M?c:Qi(c,d,_)}var lx=BA||function(c){return Hn.clearTimeout(c)};function cx(c,d){if(d)return c.slice();var _=c.length,M=P1?P1(_):new c.constructor(_);return c.copy(M),M}function Tp(c){var d=new c.constructor(c.byteLength);return new Jh(d).set(new Jh(c)),d}function JT(c,d){var _=d?Tp(c.buffer):c.buffer;return new c.constructor(_,c.byteOffset,c.byteLength)}function QT(c){var d=new c.constructor(c.source,ge.exec(c));return d.lastIndex=c.lastIndex,d}function eC(c){return Jl?en(Jl.call(c)):{}}function hx(c,d){var _=d?Tp(c.buffer):c.buffer;return new c.constructor(_,c.byteOffset,c.length)}function ux(c,d){if(c!==d){var _=c!==t,M=c===null,I=c===c,B=Li(c),$=d!==t,te=d===null,le=d===d,Be=Li(d);if(!te&&!Be&&!B&&c>d||B&&$&&le&&!te&&!Be||M&&$&&le||!_&&le||!I)return 1;if(!M&&!B&&!Be&&c<d||Be&&_&&I&&!M&&!B||te&&_&&I||!$&&I||!le)return-1}return 0}function tC(c,d,_){for(var M=-1,I=c.criteria,B=d.criteria,$=I.length,te=_.length;++M<$;){var le=ux(I[M],B[M]);if(le){if(M>=te)return le;var Be=_[M];return le*(Be=="desc"?-1:1)}}return c.index-d.index}function dx(c,d,_,M){for(var I=-1,B=c.length,$=_.length,te=-1,le=d.length,Be=Rn(B-$,0),ze=Ee(le+Be),Xe=!M;++te<le;)ze[te]=d[te];for(;++I<$;)(Xe||I<B)&&(ze[_[I]]=c[I]);for(;Be--;)ze[te++]=c[I++];return ze}function fx(c,d,_,M){for(var I=-1,B=c.length,$=-1,te=_.length,le=-1,Be=d.length,ze=Rn(B-te,0),Xe=Ee(ze+Be),st=!M;++I<ze;)Xe[I]=c[I];for(var pt=I;++le<Be;)Xe[pt+le]=d[le];for(;++$<te;)(st||I<B)&&(Xe[pt+_[$]]=c[I++]);return Xe}function mi(c,d){var _=-1,M=c.length;for(d||(d=Ee(M));++_<M;)d[_]=c[_];return d}function Ir(c,d,_,M){var I=!_;_||(_={});for(var B=-1,$=d.length;++B<$;){var te=d[B],le=M?M(_[te],c[te],te,_,c):t;le===t&&(le=c[te]),I?$r(_,te,le):Ql(_,te,le)}return _}function nC(c,d){return Ir(c,Fp(c),d)}function iC(c,d){return Ir(c,Ax(c),d)}function fu(c,d){return function(_,M){var I=Rt(_)?lA:ET,B=d?d():{};return I(_,c,xt(M,2),B)}}function Ma(c){return Ut(function(d,_){var M=-1,I=_.length,B=I>1?_[I-1]:t,$=I>2?_[2]:t;for(B=c.length>3&&typeof B=="function"?(I--,B):t,$&&ai(_[0],_[1],$)&&(B=I<3?t:B,I=1),d=en(d);++M<I;){var te=_[M];te&&c(d,te,M,B)}return d})}function px(c,d){return function(_,M){if(_==null)return _;if(!gi(_))return c(_,M);for(var I=_.length,B=d?I:-1,$=en(_);(d?B--:++B<I)&&M($[B],B,$)!==!1;);return _}}function mx(c){return function(d,_,M){for(var I=-1,B=en(d),$=M(d),te=$.length;te--;){var le=$[c?te:++I];if(_(B[le],le,B)===!1)break}return d}}function rC(c,d,_){var M=d&y,I=rc(c);function B(){var $=this&&this!==Hn&&this instanceof B?I:c;return $.apply(M?_:this,arguments)}return B}function gx(c){return function(d){d=$t(d);var _=_a(d)?hr(d):t,M=_?_[0]:d.charAt(0),I=_?Os(_,1).join(""):d.slice(1);return M[c]()+I}}function Ea(c){return function(d){return Jf(py(fy(d).replace(qE,"")),c,"")}}function rc(c){return function(){var d=arguments;switch(d.length){case 0:return new c;case 1:return new c(d[0]);case 2:return new c(d[0],d[1]);case 3:return new c(d[0],d[1],d[2]);case 4:return new c(d[0],d[1],d[2],d[3]);case 5:return new c(d[0],d[1],d[2],d[3],d[4]);case 6:return new c(d[0],d[1],d[2],d[3],d[4],d[5]);case 7:return new c(d[0],d[1],d[2],d[3],d[4],d[5],d[6])}var _=wa(c.prototype),M=c.apply(_,d);return cn(M)?M:_}}function sC(c,d,_){var M=rc(c);function I(){for(var B=arguments.length,$=Ee(B),te=B,le=Aa(I);te--;)$[te]=arguments[te];var Be=B<3&&$[0]!==le&&$[B-1]!==le?[]:Ps($,le);if(B-=Be.length,B<_)return Sx(c,d,pu,I.placeholder,t,$,Be,t,t,_-B);var ze=this&&this!==Hn&&this instanceof I?M:c;return Ri(ze,this,$)}return I}function _x(c){return function(d,_,M){var I=en(d);if(!gi(d)){var B=xt(_,3);d=Vn(d),_=function(te){return B(I[te],te,I)}}var $=c(d,_,M);return $>-1?I[B?d[$]:$]:t}}function xx(c){return Kr(function(d){var _=d.length,M=_,I=Ki.prototype.thru;for(c&&d.reverse();M--;){var B=d[M];if(typeof B!="function")throw new Zi(o);if(I&&!$&&xu(B)=="wrapper")var $=new Ki([],!0)}for(M=$?M:_;++M<_;){B=d[M];var te=xu(B),le=te=="wrapper"?Lp(B):t;le&&Dp(le[0])&&le[1]==(P|S|A|L)&&!le[4].length&&le[9]==1?$=$[xu(le[0])].apply($,le[3]):$=B.length==1&&Dp(B)?$[te]():$.thru(B)}return function(){var Be=arguments,ze=Be[0];if($&&Be.length==1&&Rt(ze))return $.plant(ze).value();for(var Xe=0,st=_?d[Xe].apply(this,Be):ze;++Xe<_;)st=d[Xe].call(this,st);return st}})}function pu(c,d,_,M,I,B,$,te,le,Be){var ze=d&P,Xe=d&y,st=d&x,pt=d&(S|E),vt=d&T,Nt=st?t:rc(c);function St(){for(var Vt=arguments.length,Ht=Ee(Vt),Ni=Vt;Ni--;)Ht[Ni]=arguments[Ni];if(pt)var li=Aa(St),Fi=_A(Ht,li);if(M&&(Ht=dx(Ht,M,I,pt)),B&&(Ht=fx(Ht,B,$,pt)),Vt-=Fi,pt&&Vt<Be){var xn=Ps(Ht,li);return Sx(c,d,pu,St.placeholder,_,Ht,xn,te,le,Be-Vt)}var fr=Xe?_:this,ts=st?fr[c]:c;return Vt=Ht.length,te?Ht=EC(Ht,te):vt&&Vt>1&&Ht.reverse(),ze&&le<Vt&&(Ht.length=le),this&&this!==Hn&&this instanceof St&&(ts=Nt||rc(ts)),ts.apply(fr,Ht)}return St}function yx(c,d){return function(_,M){return NT(_,c,d(M),{})}}function mu(c,d){return function(_,M){var I;if(_===t&&M===t)return d;if(_!==t&&(I=_),M!==t){if(I===t)return M;typeof _=="string"||typeof M=="string"?(_=Ii(_),M=Ii(M)):(_=rx(_),M=rx(M)),I=c(_,M)}return I}}function Cp(c){return Kr(function(d){return d=an(d,Pi(xt())),Ut(function(_){var M=this;return c(d,function(I){return Ri(I,M,_)})})})}function gu(c,d){d=d===t?" ":Ii(d);var _=d.length;if(_<2)return _?Sp(d,c):d;var M=Sp(d,nu(c/xa(d)));return _a(d)?Os(hr(M),0,c).join(""):M.slice(0,c)}function oC(c,d,_,M){var I=d&y,B=rc(c);function $(){for(var te=-1,le=arguments.length,Be=-1,ze=M.length,Xe=Ee(ze+le),st=this&&this!==Hn&&this instanceof $?B:c;++Be<ze;)Xe[Be]=M[Be];for(;le--;)Xe[Be++]=arguments[++te];return Ri(st,I?_:this,Xe)}return $}function vx(c){return function(d,_,M){return M&&typeof M!="number"&&ai(d,_,M)&&(_=M=t),d=es(d),_===t?(_=d,d=0):_=es(_),M=M===t?d<_?1:-1:es(M),XT(d,_,M,c)}}function _u(c){return function(d,_){return typeof d=="string"&&typeof _=="string"||(d=tr(d),_=tr(_)),c(d,_)}}function Sx(c,d,_,M,I,B,$,te,le,Be){var ze=d&S,Xe=ze?$:t,st=ze?t:$,pt=ze?B:t,vt=ze?t:B;d|=ze?A:C,d&=~(ze?C:A),d&w||(d&=~(y|x));var Nt=[c,d,I,pt,Xe,vt,st,te,le,Be],St=_.apply(t,Nt);return Dp(c)&&Nx(St,Nt),St.placeholder=M,Fx(St,c,d)}function Rp(c){var d=Cn[c];return function(_,M){if(_=tr(_),M=M==null?0:Kn(Lt(M),292),M&&F1(_)){var I=($t(_)+"e").split("e"),B=d(I[0]+"e"+(+I[1]+M));return I=($t(B)+"e").split("e"),+(I[0]+"e"+(+I[1]-M))}return d(_)}}var aC=Sa&&1/Yh(new Sa([,-0]))[1]==q?function(c){return new Sa(c)}:Kp;function bx(c){return function(d){var _=Jn(d);return _==Q?sp(d):_==ot?MA(d):gA(d,c(d))}}function Zr(c,d,_,M,I,B,$,te){var le=d&x;if(!le&&typeof c!="function")throw new Zi(o);var Be=M?M.length:0;if(Be||(d&=~(A|C),M=I=t),$=$===t?$:Rn(Lt($),0),te=te===t?te:Lt(te),Be-=I?I.length:0,d&C){var ze=M,Xe=I;M=I=t}var st=le?t:Lp(c),pt=[c,d,_,M,I,ze,Xe,B,$,te];if(st&&bC(pt,st),c=pt[0],d=pt[1],_=pt[2],M=pt[3],I=pt[4],te=pt[9]=pt[9]===t?le?0:c.length:Rn(pt[9]-Be,0),!te&&d&(S|E)&&(d&=~(S|E)),!d||d==y)var vt=rC(c,d,_);else d==S||d==E?vt=sC(c,d,te):(d==A||d==(y|A))&&!I.length?vt=oC(c,d,_,M):vt=pu.apply(t,pt);var Nt=st?nx:Nx;return Fx(Nt(vt,pt),c,d)}function wx(c,d,_,M){return c===t||dr(c,va[_])&&!Kt.call(M,_)?d:c}function Mx(c,d,_,M,I,B){return cn(c)&&cn(d)&&(B.set(d,c),hu(c,d,t,Mx,B),B.delete(d)),c}function lC(c){return ac(c)?t:c}function Ex(c,d,_,M,I,B){var $=_&g,te=c.length,le=d.length;if(te!=le&&!($&&le>te))return!1;var Be=B.get(c),ze=B.get(d);if(Be&&ze)return Be==d&&ze==c;var Xe=-1,st=!0,pt=_&v?new yo:t;for(B.set(c,d),B.set(d,c);++Xe<te;){var vt=c[Xe],Nt=d[Xe];if(M)var St=$?M(Nt,vt,Xe,d,c,B):M(vt,Nt,Xe,c,d,B);if(St!==t){if(St)continue;st=!1;break}if(pt){if(!Qf(d,function(Vt,Ht){if(!jl(pt,Ht)&&(vt===Vt||I(vt,Vt,_,M,B)))return pt.push(Ht)})){st=!1;break}}else if(!(vt===Nt||I(vt,Nt,_,M,B))){st=!1;break}}return B.delete(c),B.delete(d),st}function cC(c,d,_,M,I,B,$){switch(_){case Je:if(c.byteLength!=d.byteLength||c.byteOffset!=d.byteOffset)return!1;c=c.buffer,d=d.buffer;case Ge:return!(c.byteLength!=d.byteLength||!B(new Jh(c),new Jh(d)));case Ye:case $e:case he:return dr(+c,+d);case Ke:return c.name==d.name&&c.message==d.message;case it:case _t:return c==d+"";case Q:var te=sp;case ot:var le=M&g;if(te||(te=Yh),c.size!=d.size&&!le)return!1;var Be=$.get(c);if(Be)return Be==d;M|=v,$.set(c,d);var ze=Ex(te(c),te(d),M,I,B,$);return $.delete(c),ze;case H:if(Jl)return Jl.call(c)==Jl.call(d)}return!1}function hC(c,d,_,M,I,B){var $=_&g,te=Pp(c),le=te.length,Be=Pp(d),ze=Be.length;if(le!=ze&&!$)return!1;for(var Xe=le;Xe--;){var st=te[Xe];if(!($?st in d:Kt.call(d,st)))return!1}var pt=B.get(c),vt=B.get(d);if(pt&&vt)return pt==d&&vt==c;var Nt=!0;B.set(c,d),B.set(d,c);for(var St=$;++Xe<le;){st=te[Xe];var Vt=c[st],Ht=d[st];if(M)var Ni=$?M(Ht,Vt,st,d,c,B):M(Vt,Ht,st,c,d,B);if(!(Ni===t?Vt===Ht||I(Vt,Ht,_,M,B):Ni)){Nt=!1;break}St||(St=st=="constructor")}if(Nt&&!St){var li=c.constructor,Fi=d.constructor;li!=Fi&&"constructor"in c&&"constructor"in d&&!(typeof li=="function"&&li instanceof li&&typeof Fi=="function"&&Fi instanceof Fi)&&(Nt=!1)}return B.delete(c),B.delete(d),Nt}function Kr(c){return Bp(Ix(c,t,Vx),c+"")}function Pp(c){return X1(c,Vn,Fp)}function Ip(c){return X1(c,_i,Ax)}var Lp=ru?function(c){return ru.get(c)}:Kp;function xu(c){for(var d=c.name+"",_=ba[d],M=Kt.call(ba,d)?_.length:0;M--;){var I=_[M],B=I.func;if(B==null||B==c)return I.name}return d}function Aa(c){var d=Kt.call(D,"placeholder")?D:c;return d.placeholder}function xt(){var c=D.iteratee||$p;return c=c===$p?q1:c,arguments.length?c(arguments[0],arguments[1]):c}function yu(c,d){var _=c.__data__;return xC(d)?_[typeof d=="string"?"string":"hash"]:_.map}function Np(c){for(var d=Vn(c),_=d.length;_--;){var M=d[_],I=c[M];d[_]=[M,I,Rx(I)]}return d}function bo(c,d){var _=SA(c,d);return j1(_)?_:t}function uC(c){var d=Kt.call(c,_o),_=c[_o];try{c[_o]=t;var M=!0}catch{}var I=Zh.call(c);return M&&(d?c[_o]=_:delete c[_o]),I}var Fp=ap?function(c){return c==null?[]:(c=en(c),Cs(ap(c),function(d){return L1.call(c,d)}))}:Jp,Ax=ap?function(c){for(var d=[];c;)Rs(d,Fp(c)),c=Qh(c);return d}:Jp,Jn=oi;(lp&&Jn(new lp(new ArrayBuffer(1)))!=Je||$l&&Jn(new $l)!=Q||cp&&Jn(cp.resolve())!=je||Sa&&Jn(new Sa)!=ot||Zl&&Jn(new Zl)!=we)&&(Jn=function(c){var d=oi(c),_=d==De?c.constructor:t,M=_?wo(_):"";if(M)switch(M){case jA:return Je;case qA:return Q;case $A:return je;case ZA:return ot;case KA:return we}return d});function dC(c,d,_){for(var M=-1,I=_.length;++M<I;){var B=_[M],$=B.size;switch(B.type){case"drop":c+=$;break;case"dropRight":d-=$;break;case"take":d=Kn(d,c+$);break;case"takeRight":c=Rn(c,d-$);break}}return{start:c,end:d}}function fC(c){var d=c.match(wn);return d?d[1].split(cr):[]}function Tx(c,d,_){d=Fs(d,c);for(var M=-1,I=d.length,B=!1;++M<I;){var $=Lr(d[M]);if(!(B=c!=null&&_(c,$)))break;c=c[$]}return B||++M!=I?B:(I=c==null?0:c.length,!!I&&Au(I)&&Jr($,I)&&(Rt(c)||Mo(c)))}function pC(c){var d=c.length,_=new c.constructor(d);return d&&typeof c[0]=="string"&&Kt.call(c,"index")&&(_.index=c.index,_.input=c.input),_}function Cx(c){return typeof c.constructor=="function"&&!sc(c)?wa(Qh(c)):{}}function mC(c,d,_){var M=c.constructor;switch(d){case Ge:return Tp(c);case Ye:case $e:return new M(+c);case Je:return JT(c,_);case nt:case N:case F:case k:case ee:case ne:case ye:case ue:case Ue:return hx(c,_);case Q:return new M;case he:case _t:return new M(c);case it:return QT(c);case ot:return new M;case H:return eC(c)}}function gC(c,d){var _=d.length;if(!_)return c;var M=_-1;return d[M]=(_>1?"& ":"")+d[M],d=d.join(_>2?", ":" "),c.replace(Zt,`{
/* [wrapped with `+d+`] */
`)}function _C(c){return Rt(c)||Mo(c)||!!(N1&&c&&c[N1])}function Jr(c,d){var _=typeof c;return d=d??J,!!d&&(_=="number"||_!="symbol"&&ut.test(c))&&c>-1&&c%1==0&&c<d}function ai(c,d,_){if(!cn(_))return!1;var M=typeof d;return(M=="number"?gi(_)&&Jr(d,_.length):M=="string"&&d in _)?dr(_[d],c):!1}function Op(c,d){if(Rt(c))return!1;var _=typeof c;return _=="number"||_=="symbol"||_=="boolean"||c==null||Li(c)?!0:be.test(c)||!wt.test(c)||d!=null&&c in en(d)}function xC(c){var d=typeof c;return d=="string"||d=="number"||d=="symbol"||d=="boolean"?c!=="__proto__":c===null}function Dp(c){var d=xu(c),_=D[d];if(typeof _!="function"||!(d in Gt.prototype))return!1;if(c===_)return!0;var M=Lp(_);return!!M&&c===M[0]}function yC(c){return!!R1&&R1 in c}var vC=qh?Qr:Qp;function sc(c){var d=c&&c.constructor,_=typeof d=="function"&&d.prototype||va;return c===_}function Rx(c){return c===c&&!cn(c)}function Px(c,d){return function(_){return _==null?!1:_[c]===d&&(d!==t||c in en(_))}}function SC(c){var d=Mu(c,function(M){return _.size===h&&_.clear(),M}),_=d.cache;return d}function bC(c,d){var _=c[1],M=d[1],I=_|M,B=I<(y|x|P),$=M==P&&_==S||M==P&&_==L&&c[7].length<=d[8]||M==(P|L)&&d[7].length<=d[8]&&_==S;if(!(B||$))return c;M&y&&(c[2]=d[2],I|=_&y?0:w);var te=d[3];if(te){var le=c[3];c[3]=le?dx(le,te,d[4]):te,c[4]=le?Ps(c[3],u):d[4]}return te=d[5],te&&(le=c[5],c[5]=le?fx(le,te,d[6]):te,c[6]=le?Ps(c[5],u):d[6]),te=d[7],te&&(c[7]=te),M&P&&(c[8]=c[8]==null?d[8]:Kn(c[8],d[8])),c[9]==null&&(c[9]=d[9]),c[0]=d[0],c[1]=I,c}function wC(c){var d=[];if(c!=null)for(var _ in en(c))d.push(_);return d}function MC(c){return Zh.call(c)}function Ix(c,d,_){return d=Rn(d===t?c.length-1:d,0),function(){for(var M=arguments,I=-1,B=Rn(M.length-d,0),$=Ee(B);++I<B;)$[I]=M[d+I];I=-1;for(var te=Ee(d+1);++I<d;)te[I]=M[I];return te[d]=_($),Ri(c,this,te)}}function Lx(c,d){return d.length<2?c:So(c,Qi(d,0,-1))}function EC(c,d){for(var _=c.length,M=Kn(d.length,_),I=mi(c);M--;){var B=d[M];c[M]=Jr(B,_)?I[B]:t}return c}function Up(c,d){if(!(d==="constructor"&&typeof c[d]=="function")&&d!="__proto__")return c[d]}var Nx=Ox(nx),oc=VA||function(c,d){return Hn.setTimeout(c,d)},Bp=Ox(qT);function Fx(c,d,_){var M=d+"";return Bp(c,gC(M,AC(fC(M),_)))}function Ox(c){var d=0,_=0;return function(){var M=WA(),I=Z-(M-_);if(_=M,I>0){if(++d>=K)return arguments[0]}else d=0;return c.apply(t,arguments)}}function vu(c,d){var _=-1,M=c.length,I=M-1;for(d=d===t?M:d;++_<d;){var B=vp(_,I),$=c[B];c[B]=c[_],c[_]=$}return c.length=d,c}var Dx=SC(function(c){var d=[];return c.charCodeAt(0)===46&&d.push(""),c.replace(Et,function(_,M,I,B){d.push(I?B.replace(As,"$1"):M||_)}),d});function Lr(c){if(typeof c=="string"||Li(c))return c;var d=c+"";return d=="0"&&1/c==-q?"-0":d}function wo(c){if(c!=null){try{return $h.call(c)}catch{}try{return c+""}catch{}}return""}function AC(c,d){return $i(oe,function(_){var M="_."+_[0];d&_[1]&&!Wh(c,M)&&c.push(M)}),c.sort()}function Ux(c){if(c instanceof Gt)return c.clone();var d=new Ki(c.__wrapped__,c.__chain__);return d.__actions__=mi(c.__actions__),d.__index__=c.__index__,d.__values__=c.__values__,d}function TC(c,d,_){(_?ai(c,d,_):d===t)?d=1:d=Rn(Lt(d),0);var M=c==null?0:c.length;if(!M||d<1)return[];for(var I=0,B=0,$=Ee(nu(M/d));I<M;)$[B++]=Qi(c,I,I+=d);return $}function CC(c){for(var d=-1,_=c==null?0:c.length,M=0,I=[];++d<_;){var B=c[d];B&&(I[M++]=B)}return I}function RC(){var c=arguments.length;if(!c)return[];for(var d=Ee(c-1),_=arguments[0],M=c;M--;)d[M-1]=arguments[M];return Rs(Rt(_)?mi(_):[_],Wn(d,1))}var PC=Ut(function(c,d){return _n(c)?ec(c,Wn(d,1,_n,!0)):[]}),IC=Ut(function(c,d){var _=er(d);return _n(_)&&(_=t),_n(c)?ec(c,Wn(d,1,_n,!0),xt(_,2)):[]}),LC=Ut(function(c,d){var _=er(d);return _n(_)&&(_=t),_n(c)?ec(c,Wn(d,1,_n,!0),t,_):[]});function NC(c,d,_){var M=c==null?0:c.length;return M?(d=_||d===t?1:Lt(d),Qi(c,d<0?0:d,M)):[]}function FC(c,d,_){var M=c==null?0:c.length;return M?(d=_||d===t?1:Lt(d),d=M-d,Qi(c,0,d<0?0:d)):[]}function OC(c,d){return c&&c.length?du(c,xt(d,3),!0,!0):[]}function DC(c,d){return c&&c.length?du(c,xt(d,3),!0):[]}function UC(c,d,_,M){var I=c==null?0:c.length;return I?(_&&typeof _!="number"&&ai(c,d,_)&&(_=0,M=I),RT(c,d,_,M)):[]}function Bx(c,d,_){var M=c==null?0:c.length;if(!M)return-1;var I=_==null?0:Lt(_);return I<0&&(I=Rn(M+I,0)),Xh(c,xt(d,3),I)}function zx(c,d,_){var M=c==null?0:c.length;if(!M)return-1;var I=M-1;return _!==t&&(I=Lt(_),I=_<0?Rn(M+I,0):Kn(I,M-1)),Xh(c,xt(d,3),I,!0)}function Vx(c){var d=c==null?0:c.length;return d?Wn(c,1):[]}function BC(c){var d=c==null?0:c.length;return d?Wn(c,q):[]}function zC(c,d){var _=c==null?0:c.length;return _?(d=d===t?1:Lt(d),Wn(c,d)):[]}function VC(c){for(var d=-1,_=c==null?0:c.length,M={};++d<_;){var I=c[d];M[I[0]]=I[1]}return M}function kx(c){return c&&c.length?c[0]:t}function kC(c,d,_){var M=c==null?0:c.length;if(!M)return-1;var I=_==null?0:Lt(_);return I<0&&(I=Rn(M+I,0)),ga(c,d,I)}function GC(c){var d=c==null?0:c.length;return d?Qi(c,0,-1):[]}var HC=Ut(function(c){var d=an(c,Ep);return d.length&&d[0]===c[0]?mp(d):[]}),WC=Ut(function(c){var d=er(c),_=an(c,Ep);return d===er(_)?d=t:_.pop(),_.length&&_[0]===c[0]?mp(_,xt(d,2)):[]}),XC=Ut(function(c){var d=er(c),_=an(c,Ep);return d=typeof d=="function"?d:t,d&&_.pop(),_.length&&_[0]===c[0]?mp(_,t,d):[]});function YC(c,d){return c==null?"":GA.call(c,d)}function er(c){var d=c==null?0:c.length;return d?c[d-1]:t}function jC(c,d,_){var M=c==null?0:c.length;if(!M)return-1;var I=M;return _!==t&&(I=Lt(_),I=I<0?Rn(M+I,0):Kn(I,M-1)),d===d?AA(c,d,I):Xh(c,S1,I,!0)}function qC(c,d){return c&&c.length?J1(c,Lt(d)):t}var $C=Ut(Gx);function Gx(c,d){return c&&c.length&&d&&d.length?yp(c,d):c}function ZC(c,d,_){return c&&c.length&&d&&d.length?yp(c,d,xt(_,2)):c}function KC(c,d,_){return c&&c.length&&d&&d.length?yp(c,d,t,_):c}var JC=Kr(function(c,d){var _=c==null?0:c.length,M=up(c,d);return tx(c,an(d,function(I){return Jr(I,_)?+I:I}).sort(ux)),M});function QC(c,d){var _=[];if(!(c&&c.length))return _;var M=-1,I=[],B=c.length;for(d=xt(d,3);++M<B;){var $=c[M];d($,M,c)&&(_.push($),I.push(M))}return tx(c,I),_}function zp(c){return c==null?c:YA.call(c)}function e2(c,d,_){var M=c==null?0:c.length;return M?(_&&typeof _!="number"&&ai(c,d,_)?(d=0,_=M):(d=d==null?0:Lt(d),_=_===t?M:Lt(_)),Qi(c,d,_)):[]}function t2(c,d){return uu(c,d)}function n2(c,d,_){return bp(c,d,xt(_,2))}function i2(c,d){var _=c==null?0:c.length;if(_){var M=uu(c,d);if(M<_&&dr(c[M],d))return M}return-1}function r2(c,d){return uu(c,d,!0)}function s2(c,d,_){return bp(c,d,xt(_,2),!0)}function o2(c,d){var _=c==null?0:c.length;if(_){var M=uu(c,d,!0)-1;if(dr(c[M],d))return M}return-1}function a2(c){return c&&c.length?ix(c):[]}function l2(c,d){return c&&c.length?ix(c,xt(d,2)):[]}function c2(c){var d=c==null?0:c.length;return d?Qi(c,1,d):[]}function h2(c,d,_){return c&&c.length?(d=_||d===t?1:Lt(d),Qi(c,0,d<0?0:d)):[]}function u2(c,d,_){var M=c==null?0:c.length;return M?(d=_||d===t?1:Lt(d),d=M-d,Qi(c,d<0?0:d,M)):[]}function d2(c,d){return c&&c.length?du(c,xt(d,3),!1,!0):[]}function f2(c,d){return c&&c.length?du(c,xt(d,3)):[]}var p2=Ut(function(c){return Ns(Wn(c,1,_n,!0))}),m2=Ut(function(c){var d=er(c);return _n(d)&&(d=t),Ns(Wn(c,1,_n,!0),xt(d,2))}),g2=Ut(function(c){var d=er(c);return d=typeof d=="function"?d:t,Ns(Wn(c,1,_n,!0),t,d)});function _2(c){return c&&c.length?Ns(c):[]}function x2(c,d){return c&&c.length?Ns(c,xt(d,2)):[]}function y2(c,d){return d=typeof d=="function"?d:t,c&&c.length?Ns(c,t,d):[]}function Vp(c){if(!(c&&c.length))return[];var d=0;return c=Cs(c,function(_){if(_n(_))return d=Rn(_.length,d),!0}),ip(d,function(_){return an(c,ep(_))})}function Hx(c,d){if(!(c&&c.length))return[];var _=Vp(c);return d==null?_:an(_,function(M){return Ri(d,t,M)})}var v2=Ut(function(c,d){return _n(c)?ec(c,d):[]}),S2=Ut(function(c){return Mp(Cs(c,_n))}),b2=Ut(function(c){var d=er(c);return _n(d)&&(d=t),Mp(Cs(c,_n),xt(d,2))}),w2=Ut(function(c){var d=er(c);return d=typeof d=="function"?d:t,Mp(Cs(c,_n),t,d)}),M2=Ut(Vp);function E2(c,d){return ax(c||[],d||[],Ql)}function A2(c,d){return ax(c||[],d||[],ic)}var T2=Ut(function(c){var d=c.length,_=d>1?c[d-1]:t;return _=typeof _=="function"?(c.pop(),_):t,Hx(c,_)});function Wx(c){var d=D(c);return d.__chain__=!0,d}function C2(c,d){return d(c),c}function Su(c,d){return d(c)}var R2=Kr(function(c){var d=c.length,_=d?c[0]:0,M=this.__wrapped__,I=function(B){return up(B,c)};return d>1||this.__actions__.length||!(M instanceof Gt)||!Jr(_)?this.thru(I):(M=M.slice(_,+_+(d?1:0)),M.__actions__.push({func:Su,args:[I],thisArg:t}),new Ki(M,this.__chain__).thru(function(B){return d&&!B.length&&B.push(t),B}))});function P2(){return Wx(this)}function I2(){return new Ki(this.value(),this.__chain__)}function L2(){this.__values__===t&&(this.__values__=ry(this.value()));var c=this.__index__>=this.__values__.length,d=c?t:this.__values__[this.__index__++];return{done:c,value:d}}function N2(){return this}function F2(c){for(var d,_=this;_ instanceof ou;){var M=Ux(_);M.__index__=0,M.__values__=t,d?I.__wrapped__=M:d=M;var I=M;_=_.__wrapped__}return I.__wrapped__=c,d}function O2(){var c=this.__wrapped__;if(c instanceof Gt){var d=c;return this.__actions__.length&&(d=new Gt(this)),d=d.reverse(),d.__actions__.push({func:Su,args:[zp],thisArg:t}),new Ki(d,this.__chain__)}return this.thru(zp)}function D2(){return ox(this.__wrapped__,this.__actions__)}var U2=fu(function(c,d,_){Kt.call(c,_)?++c[_]:$r(c,_,1)});function B2(c,d,_){var M=Rt(c)?y1:CT;return _&&ai(c,d,_)&&(d=t),M(c,xt(d,3))}function z2(c,d){var _=Rt(c)?Cs:H1;return _(c,xt(d,3))}var V2=_x(Bx),k2=_x(zx);function G2(c,d){return Wn(bu(c,d),1)}function H2(c,d){return Wn(bu(c,d),q)}function W2(c,d,_){return _=_===t?1:Lt(_),Wn(bu(c,d),_)}function Xx(c,d){var _=Rt(c)?$i:Ls;return _(c,xt(d,3))}function Yx(c,d){var _=Rt(c)?cA:G1;return _(c,xt(d,3))}var X2=fu(function(c,d,_){Kt.call(c,_)?c[_].push(d):$r(c,_,[d])});function Y2(c,d,_,M){c=gi(c)?c:Ca(c),_=_&&!M?Lt(_):0;var I=c.length;return _<0&&(_=Rn(I+_,0)),Tu(c)?_<=I&&c.indexOf(d,_)>-1:!!I&&ga(c,d,_)>-1}var j2=Ut(function(c,d,_){var M=-1,I=typeof d=="function",B=gi(c)?Ee(c.length):[];return Ls(c,function($){B[++M]=I?Ri(d,$,_):tc($,d,_)}),B}),q2=fu(function(c,d,_){$r(c,_,d)});function bu(c,d){var _=Rt(c)?an:$1;return _(c,xt(d,3))}function $2(c,d,_,M){return c==null?[]:(Rt(d)||(d=d==null?[]:[d]),_=M?t:_,Rt(_)||(_=_==null?[]:[_]),Q1(c,d,_))}var Z2=fu(function(c,d,_){c[_?0:1].push(d)},function(){return[[],[]]});function K2(c,d,_){var M=Rt(c)?Jf:w1,I=arguments.length<3;return M(c,xt(d,4),_,I,Ls)}function J2(c,d,_){var M=Rt(c)?hA:w1,I=arguments.length<3;return M(c,xt(d,4),_,I,G1)}function Q2(c,d){var _=Rt(c)?Cs:H1;return _(c,Eu(xt(d,3)))}function eR(c){var d=Rt(c)?B1:YT;return d(c)}function tR(c,d,_){(_?ai(c,d,_):d===t)?d=1:d=Lt(d);var M=Rt(c)?wT:jT;return M(c,d)}function nR(c){var d=Rt(c)?MT:$T;return d(c)}function iR(c){if(c==null)return 0;if(gi(c))return Tu(c)?xa(c):c.length;var d=Jn(c);return d==Q||d==ot?c.size:_p(c).length}function rR(c,d,_){var M=Rt(c)?Qf:ZT;return _&&ai(c,d,_)&&(d=t),M(c,xt(d,3))}var sR=Ut(function(c,d){if(c==null)return[];var _=d.length;return _>1&&ai(c,d[0],d[1])?d=[]:_>2&&ai(d[0],d[1],d[2])&&(d=[d[0]]),Q1(c,Wn(d,1),[])}),wu=zA||function(){return Hn.Date.now()};function oR(c,d){if(typeof d!="function")throw new Zi(o);return c=Lt(c),function(){if(--c<1)return d.apply(this,arguments)}}function jx(c,d,_){return d=_?t:d,d=c&&d==null?c.length:d,Zr(c,P,t,t,t,t,d)}function qx(c,d){var _;if(typeof d!="function")throw new Zi(o);return c=Lt(c),function(){return--c>0&&(_=d.apply(this,arguments)),c<=1&&(d=t),_}}var kp=Ut(function(c,d,_){var M=y;if(_.length){var I=Ps(_,Aa(kp));M|=A}return Zr(c,M,d,_,I)}),$x=Ut(function(c,d,_){var M=y|x;if(_.length){var I=Ps(_,Aa($x));M|=A}return Zr(d,M,c,_,I)});function Zx(c,d,_){d=_?t:d;var M=Zr(c,S,t,t,t,t,t,d);return M.placeholder=Zx.placeholder,M}function Kx(c,d,_){d=_?t:d;var M=Zr(c,E,t,t,t,t,t,d);return M.placeholder=Kx.placeholder,M}function Jx(c,d,_){var M,I,B,$,te,le,Be=0,ze=!1,Xe=!1,st=!0;if(typeof c!="function")throw new Zi(o);d=tr(d)||0,cn(_)&&(ze=!!_.leading,Xe="maxWait"in _,B=Xe?Rn(tr(_.maxWait)||0,d):B,st="trailing"in _?!!_.trailing:st);function pt(xn){var fr=M,ts=I;return M=I=t,Be=xn,$=c.apply(ts,fr),$}function vt(xn){return Be=xn,te=oc(Vt,d),ze?pt(xn):$}function Nt(xn){var fr=xn-le,ts=xn-Be,_y=d-fr;return Xe?Kn(_y,B-ts):_y}function St(xn){var fr=xn-le,ts=xn-Be;return le===t||fr>=d||fr<0||Xe&&ts>=B}function Vt(){var xn=wu();if(St(xn))return Ht(xn);te=oc(Vt,Nt(xn))}function Ht(xn){return te=t,st&&M?pt(xn):(M=I=t,$)}function Ni(){te!==t&&lx(te),Be=0,M=le=I=te=t}function li(){return te===t?$:Ht(wu())}function Fi(){var xn=wu(),fr=St(xn);if(M=arguments,I=this,le=xn,fr){if(te===t)return vt(le);if(Xe)return lx(te),te=oc(Vt,d),pt(le)}return te===t&&(te=oc(Vt,d)),$}return Fi.cancel=Ni,Fi.flush=li,Fi}var aR=Ut(function(c,d){return k1(c,1,d)}),lR=Ut(function(c,d,_){return k1(c,tr(d)||0,_)});function cR(c){return Zr(c,T)}function Mu(c,d){if(typeof c!="function"||d!=null&&typeof d!="function")throw new Zi(o);var _=function(){var M=arguments,I=d?d.apply(this,M):M[0],B=_.cache;if(B.has(I))return B.get(I);var $=c.apply(this,M);return _.cache=B.set(I,$)||B,$};return _.cache=new(Mu.Cache||qr),_}Mu.Cache=qr;function Eu(c){if(typeof c!="function")throw new Zi(o);return function(){var d=arguments;switch(d.length){case 0:return!c.call(this);case 1:return!c.call(this,d[0]);case 2:return!c.call(this,d[0],d[1]);case 3:return!c.call(this,d[0],d[1],d[2])}return!c.apply(this,d)}}function hR(c){return qx(2,c)}var uR=KT(function(c,d){d=d.length==1&&Rt(d[0])?an(d[0],Pi(xt())):an(Wn(d,1),Pi(xt()));var _=d.length;return Ut(function(M){for(var I=-1,B=Kn(M.length,_);++I<B;)M[I]=d[I].call(this,M[I]);return Ri(c,this,M)})}),Gp=Ut(function(c,d){var _=Ps(d,Aa(Gp));return Zr(c,A,t,d,_)}),Qx=Ut(function(c,d){var _=Ps(d,Aa(Qx));return Zr(c,C,t,d,_)}),dR=Kr(function(c,d){return Zr(c,L,t,t,t,d)});function fR(c,d){if(typeof c!="function")throw new Zi(o);return d=d===t?d:Lt(d),Ut(c,d)}function pR(c,d){if(typeof c!="function")throw new Zi(o);return d=d==null?0:Rn(Lt(d),0),Ut(function(_){var M=_[d],I=Os(_,0,d);return M&&Rs(I,M),Ri(c,this,I)})}function mR(c,d,_){var M=!0,I=!0;if(typeof c!="function")throw new Zi(o);return cn(_)&&(M="leading"in _?!!_.leading:M,I="trailing"in _?!!_.trailing:I),Jx(c,d,{leading:M,maxWait:d,trailing:I})}function gR(c){return jx(c,1)}function _R(c,d){return Gp(Ap(d),c)}function xR(){if(!arguments.length)return[];var c=arguments[0];return Rt(c)?c:[c]}function yR(c){return Ji(c,m)}function vR(c,d){return d=typeof d=="function"?d:t,Ji(c,m,d)}function SR(c){return Ji(c,f|m)}function bR(c,d){return d=typeof d=="function"?d:t,Ji(c,f|m,d)}function wR(c,d){return d==null||V1(c,d,Vn(d))}function dr(c,d){return c===d||c!==c&&d!==d}var MR=_u(pp),ER=_u(function(c,d){return c>=d}),Mo=Y1(function(){return arguments}())?Y1:function(c){return fn(c)&&Kt.call(c,"callee")&&!L1.call(c,"callee")},Rt=Ee.isArray,AR=f1?Pi(f1):FT;function gi(c){return c!=null&&Au(c.length)&&!Qr(c)}function _n(c){return fn(c)&&gi(c)}function TR(c){return c===!0||c===!1||fn(c)&&oi(c)==Ye}var Ds=kA||Qp,CR=p1?Pi(p1):OT;function RR(c){return fn(c)&&c.nodeType===1&&!ac(c)}function PR(c){if(c==null)return!0;if(gi(c)&&(Rt(c)||typeof c=="string"||typeof c.splice=="function"||Ds(c)||Ta(c)||Mo(c)))return!c.length;var d=Jn(c);if(d==Q||d==ot)return!c.size;if(sc(c))return!_p(c).length;for(var _ in c)if(Kt.call(c,_))return!1;return!0}function IR(c,d){return nc(c,d)}function LR(c,d,_){_=typeof _=="function"?_:t;var M=_?_(c,d):t;return M===t?nc(c,d,t,_):!!M}function Hp(c){if(!fn(c))return!1;var d=oi(c);return d==Ke||d==et||typeof c.message=="string"&&typeof c.name=="string"&&!ac(c)}function NR(c){return typeof c=="number"&&F1(c)}function Qr(c){if(!cn(c))return!1;var d=oi(c);return d==W||d==Le||d==ke||d==qe}function ey(c){return typeof c=="number"&&c==Lt(c)}function Au(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=J}function cn(c){var d=typeof c;return c!=null&&(d=="object"||d=="function")}function fn(c){return c!=null&&typeof c=="object"}var ty=m1?Pi(m1):UT;function FR(c,d){return c===d||gp(c,d,Np(d))}function OR(c,d,_){return _=typeof _=="function"?_:t,gp(c,d,Np(d),_)}function DR(c){return ny(c)&&c!=+c}function UR(c){if(vC(c))throw new Tt(r);return j1(c)}function BR(c){return c===null}function zR(c){return c==null}function ny(c){return typeof c=="number"||fn(c)&&oi(c)==he}function ac(c){if(!fn(c)||oi(c)!=De)return!1;var d=Qh(c);if(d===null)return!0;var _=Kt.call(d,"constructor")&&d.constructor;return typeof _=="function"&&_ instanceof _&&$h.call(_)==OA}var Wp=g1?Pi(g1):BT;function VR(c){return ey(c)&&c>=-J&&c<=J}var iy=_1?Pi(_1):zT;function Tu(c){return typeof c=="string"||!Rt(c)&&fn(c)&&oi(c)==_t}function Li(c){return typeof c=="symbol"||fn(c)&&oi(c)==H}var Ta=x1?Pi(x1):VT;function kR(c){return c===t}function GR(c){return fn(c)&&Jn(c)==we}function HR(c){return fn(c)&&oi(c)==We}var WR=_u(xp),XR=_u(function(c,d){return c<=d});function ry(c){if(!c)return[];if(gi(c))return Tu(c)?hr(c):mi(c);if(ql&&c[ql])return wA(c[ql]());var d=Jn(c),_=d==Q?sp:d==ot?Yh:Ca;return _(c)}function es(c){if(!c)return c===0?c:0;if(c=tr(c),c===q||c===-q){var d=c<0?-1:1;return d*se}return c===c?c:0}function Lt(c){var d=es(c),_=d%1;return d===d?_?d-_:d:0}function sy(c){return c?vo(Lt(c),0,Re):0}function tr(c){if(typeof c=="number")return c;if(Li(c))return _e;if(cn(c)){var d=typeof c.valueOf=="function"?c.valueOf():c;c=cn(d)?d+"":d}if(typeof c!="string")return c===0?c:+c;c=M1(c);var _=de.test(c);return _||rt.test(c)?oA(c.slice(2),_?2:8):Te.test(c)?_e:+c}function oy(c){return Ir(c,_i(c))}function YR(c){return c?vo(Lt(c),-J,J):c===0?c:0}function $t(c){return c==null?"":Ii(c)}var jR=Ma(function(c,d){if(sc(d)||gi(d)){Ir(d,Vn(d),c);return}for(var _ in d)Kt.call(d,_)&&Ql(c,_,d[_])}),ay=Ma(function(c,d){Ir(d,_i(d),c)}),Cu=Ma(function(c,d,_,M){Ir(d,_i(d),c,M)}),qR=Ma(function(c,d,_,M){Ir(d,Vn(d),c,M)}),$R=Kr(up);function ZR(c,d){var _=wa(c);return d==null?_:z1(_,d)}var KR=Ut(function(c,d){c=en(c);var _=-1,M=d.length,I=M>2?d[2]:t;for(I&&ai(d[0],d[1],I)&&(M=1);++_<M;)for(var B=d[_],$=_i(B),te=-1,le=$.length;++te<le;){var Be=$[te],ze=c[Be];(ze===t||dr(ze,va[Be])&&!Kt.call(c,Be))&&(c[Be]=B[Be])}return c}),JR=Ut(function(c){return c.push(t,Mx),Ri(ly,t,c)});function QR(c,d){return v1(c,xt(d,3),Pr)}function e3(c,d){return v1(c,xt(d,3),fp)}function t3(c,d){return c==null?c:dp(c,xt(d,3),_i)}function n3(c,d){return c==null?c:W1(c,xt(d,3),_i)}function i3(c,d){return c&&Pr(c,xt(d,3))}function r3(c,d){return c&&fp(c,xt(d,3))}function s3(c){return c==null?[]:cu(c,Vn(c))}function o3(c){return c==null?[]:cu(c,_i(c))}function Xp(c,d,_){var M=c==null?t:So(c,d);return M===t?_:M}function a3(c,d){return c!=null&&Tx(c,d,PT)}function Yp(c,d){return c!=null&&Tx(c,d,IT)}var l3=yx(function(c,d,_){d!=null&&typeof d.toString!="function"&&(d=Zh.call(d)),c[d]=_},qp(xi)),c3=yx(function(c,d,_){d!=null&&typeof d.toString!="function"&&(d=Zh.call(d)),Kt.call(c,d)?c[d].push(_):c[d]=[_]},xt),h3=Ut(tc);function Vn(c){return gi(c)?U1(c):_p(c)}function _i(c){return gi(c)?U1(c,!0):kT(c)}function u3(c,d){var _={};return d=xt(d,3),Pr(c,function(M,I,B){$r(_,d(M,I,B),M)}),_}function d3(c,d){var _={};return d=xt(d,3),Pr(c,function(M,I,B){$r(_,I,d(M,I,B))}),_}var f3=Ma(function(c,d,_){hu(c,d,_)}),ly=Ma(function(c,d,_,M){hu(c,d,_,M)}),p3=Kr(function(c,d){var _={};if(c==null)return _;var M=!1;d=an(d,function(B){return B=Fs(B,c),M||(M=B.length>1),B}),Ir(c,Ip(c),_),M&&(_=Ji(_,f|p|m,lC));for(var I=d.length;I--;)wp(_,d[I]);return _});function m3(c,d){return cy(c,Eu(xt(d)))}var g3=Kr(function(c,d){return c==null?{}:HT(c,d)});function cy(c,d){if(c==null)return{};var _=an(Ip(c),function(M){return[M]});return d=xt(d),ex(c,_,function(M,I){return d(M,I[0])})}function _3(c,d,_){d=Fs(d,c);var M=-1,I=d.length;for(I||(I=1,c=t);++M<I;){var B=c==null?t:c[Lr(d[M])];B===t&&(M=I,B=_),c=Qr(B)?B.call(c):B}return c}function x3(c,d,_){return c==null?c:ic(c,d,_)}function y3(c,d,_,M){return M=typeof M=="function"?M:t,c==null?c:ic(c,d,_,M)}var hy=bx(Vn),uy=bx(_i);function v3(c,d,_){var M=Rt(c),I=M||Ds(c)||Ta(c);if(d=xt(d,4),_==null){var B=c&&c.constructor;I?_=M?new B:[]:cn(c)?_=Qr(B)?wa(Qh(c)):{}:_={}}return(I?$i:Pr)(c,function($,te,le){return d(_,$,te,le)}),_}function S3(c,d){return c==null?!0:wp(c,d)}function b3(c,d,_){return c==null?c:sx(c,d,Ap(_))}function w3(c,d,_,M){return M=typeof M=="function"?M:t,c==null?c:sx(c,d,Ap(_),M)}function Ca(c){return c==null?[]:rp(c,Vn(c))}function M3(c){return c==null?[]:rp(c,_i(c))}function E3(c,d,_){return _===t&&(_=d,d=t),_!==t&&(_=tr(_),_=_===_?_:0),d!==t&&(d=tr(d),d=d===d?d:0),vo(tr(c),d,_)}function A3(c,d,_){return d=es(d),_===t?(_=d,d=0):_=es(_),c=tr(c),LT(c,d,_)}function T3(c,d,_){if(_&&typeof _!="boolean"&&ai(c,d,_)&&(d=_=t),_===t&&(typeof d=="boolean"?(_=d,d=t):typeof c=="boolean"&&(_=c,c=t)),c===t&&d===t?(c=0,d=1):(c=es(c),d===t?(d=c,c=0):d=es(d)),c>d){var M=c;c=d,d=M}if(_||c%1||d%1){var I=O1();return Kn(c+I*(d-c+sA("1e-"+((I+"").length-1))),d)}return vp(c,d)}var C3=Ea(function(c,d,_){return d=d.toLowerCase(),c+(_?dy(d):d)});function dy(c){return jp($t(c).toLowerCase())}function fy(c){return c=$t(c),c&&c.replace(gt,xA).replace($E,"")}function R3(c,d,_){c=$t(c),d=Ii(d);var M=c.length;_=_===t?M:vo(Lt(_),0,M);var I=_;return _-=d.length,_>=0&&c.slice(_,I)==d}function P3(c){return c=$t(c),c&&Qe.test(c)?c.replace(xe,yA):c}function I3(c){return c=$t(c),c&&Dn.test(c)?c.replace(gn,"\\$&"):c}var L3=Ea(function(c,d,_){return c+(_?"-":"")+d.toLowerCase()}),N3=Ea(function(c,d,_){return c+(_?" ":"")+d.toLowerCase()}),F3=gx("toLowerCase");function O3(c,d,_){c=$t(c),d=Lt(d);var M=d?xa(c):0;if(!d||M>=d)return c;var I=(d-M)/2;return gu(iu(I),_)+c+gu(nu(I),_)}function D3(c,d,_){c=$t(c),d=Lt(d);var M=d?xa(c):0;return d&&M<d?c+gu(d-M,_):c}function U3(c,d,_){c=$t(c),d=Lt(d);var M=d?xa(c):0;return d&&M<d?gu(d-M,_)+c:c}function B3(c,d,_){return _||d==null?d=0:d&&(d=+d),XA($t(c).replace($n,""),d||0)}function z3(c,d,_){return(_?ai(c,d,_):d===t)?d=1:d=Lt(d),Sp($t(c),d)}function V3(){var c=arguments,d=$t(c[0]);return c.length<3?d:d.replace(c[1],c[2])}var k3=Ea(function(c,d,_){return c+(_?"_":"")+d.toLowerCase()});function G3(c,d,_){return _&&typeof _!="number"&&ai(c,d,_)&&(d=_=t),_=_===t?Re:_>>>0,_?(c=$t(c),c&&(typeof d=="string"||d!=null&&!Wp(d))&&(d=Ii(d),!d&&_a(c))?Os(hr(c),0,_):c.split(d,_)):[]}var H3=Ea(function(c,d,_){return c+(_?" ":"")+jp(d)});function W3(c,d,_){return c=$t(c),_=_==null?0:vo(Lt(_),0,c.length),d=Ii(d),c.slice(_,_+d.length)==d}function X3(c,d,_){var M=D.templateSettings;_&&ai(c,d,_)&&(d=t),c=$t(c),d=Cu({},d,M,wx);var I=Cu({},d.imports,M.imports,wx),B=Vn(I),$=rp(I,B),te,le,Be=0,ze=d.interpolate||mt,Xe="__p += '",st=op((d.escape||mt).source+"|"+ze.source+"|"+(ze===ce?z:mt).source+"|"+(d.evaluate||mt).source+"|$","g"),pt="//# sourceURL="+(Kt.call(d,"sourceURL")?(d.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++eA+"]")+`
`;c.replace(st,function(St,Vt,Ht,Ni,li,Fi){return Ht||(Ht=Ni),Xe+=c.slice(Be,Fi).replace(Mt,vA),Vt&&(te=!0,Xe+=`' +
__e(`+Vt+`) +
'`),li&&(le=!0,Xe+=`';
`+li+`;
__p += '`),Ht&&(Xe+=`' +
((__t = (`+Ht+`)) == null ? '' : __t) +
'`),Be=Fi+St.length,St}),Xe+=`';
`;var vt=Kt.call(d,"variable")&&d.variable;if(!vt)Xe=`with (obj) {
`+Xe+`
}
`;else if(Rr.test(vt))throw new Tt(a);Xe=(le?Xe.replace(Ze,""):Xe).replace(Y,"$1").replace(Ve,"$1;"),Xe="function("+(vt||"obj")+`) {
`+(vt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(te?", __e = _.escape":"")+(le?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Xe+`return __p
}`;var Nt=my(function(){return jt(B,pt+"return "+Xe).apply(t,$)});if(Nt.source=Xe,Hp(Nt))throw Nt;return Nt}function Y3(c){return $t(c).toLowerCase()}function j3(c){return $t(c).toUpperCase()}function q3(c,d,_){if(c=$t(c),c&&(_||d===t))return M1(c);if(!c||!(d=Ii(d)))return c;var M=hr(c),I=hr(d),B=E1(M,I),$=A1(M,I)+1;return Os(M,B,$).join("")}function $3(c,d,_){if(c=$t(c),c&&(_||d===t))return c.slice(0,C1(c)+1);if(!c||!(d=Ii(d)))return c;var M=hr(c),I=A1(M,hr(d))+1;return Os(M,0,I).join("")}function Z3(c,d,_){if(c=$t(c),c&&(_||d===t))return c.replace($n,"");if(!c||!(d=Ii(d)))return c;var M=hr(c),I=E1(M,hr(d));return Os(M,I).join("")}function K3(c,d){var _=R,M=G;if(cn(d)){var I="separator"in d?d.separator:I;_="length"in d?Lt(d.length):_,M="omission"in d?Ii(d.omission):M}c=$t(c);var B=c.length;if(_a(c)){var $=hr(c);B=$.length}if(_>=B)return c;var te=_-xa(M);if(te<1)return M;var le=$?Os($,0,te).join(""):c.slice(0,te);if(I===t)return le+M;if($&&(te+=le.length-te),Wp(I)){if(c.slice(te).search(I)){var Be,ze=le;for(I.global||(I=op(I.source,$t(ge.exec(I))+"g")),I.lastIndex=0;Be=I.exec(ze);)var Xe=Be.index;le=le.slice(0,Xe===t?te:Xe)}}else if(c.indexOf(Ii(I),te)!=te){var st=le.lastIndexOf(I);st>-1&&(le=le.slice(0,st))}return le+M}function J3(c){return c=$t(c),c&&Pe.test(c)?c.replace(me,TA):c}var Q3=Ea(function(c,d,_){return c+(_?" ":"")+d.toUpperCase()}),jp=gx("toUpperCase");function py(c,d,_){return c=$t(c),d=_?t:d,d===t?bA(c)?PA(c):fA(c):c.match(d)||[]}var my=Ut(function(c,d){try{return Ri(c,t,d)}catch(_){return Hp(_)?_:new Tt(_)}}),eP=Kr(function(c,d){return $i(d,function(_){_=Lr(_),$r(c,_,kp(c[_],c))}),c});function tP(c){var d=c==null?0:c.length,_=xt();return c=d?an(c,function(M){if(typeof M[1]!="function")throw new Zi(o);return[_(M[0]),M[1]]}):[],Ut(function(M){for(var I=-1;++I<d;){var B=c[I];if(Ri(B[0],this,M))return Ri(B[1],this,M)}})}function nP(c){return TT(Ji(c,f))}function qp(c){return function(){return c}}function iP(c,d){return c==null||c!==c?d:c}var rP=xx(),sP=xx(!0);function xi(c){return c}function $p(c){return q1(typeof c=="function"?c:Ji(c,f))}function oP(c){return Z1(Ji(c,f))}function aP(c,d){return K1(c,Ji(d,f))}var lP=Ut(function(c,d){return function(_){return tc(_,c,d)}}),cP=Ut(function(c,d){return function(_){return tc(c,_,d)}});function Zp(c,d,_){var M=Vn(d),I=cu(d,M);_==null&&!(cn(d)&&(I.length||!M.length))&&(_=d,d=c,c=this,I=cu(d,Vn(d)));var B=!(cn(_)&&"chain"in _)||!!_.chain,$=Qr(c);return $i(I,function(te){var le=d[te];c[te]=le,$&&(c.prototype[te]=function(){var Be=this.__chain__;if(B||Be){var ze=c(this.__wrapped__),Xe=ze.__actions__=mi(this.__actions__);return Xe.push({func:le,args:arguments,thisArg:c}),ze.__chain__=Be,ze}return le.apply(c,Rs([this.value()],arguments))})}),c}function hP(){return Hn._===this&&(Hn._=DA),this}function Kp(){}function uP(c){return c=Lt(c),Ut(function(d){return J1(d,c)})}var dP=Cp(an),fP=Cp(y1),pP=Cp(Qf);function gy(c){return Op(c)?ep(Lr(c)):WT(c)}function mP(c){return function(d){return c==null?t:So(c,d)}}var gP=vx(),_P=vx(!0);function Jp(){return[]}function Qp(){return!1}function xP(){return{}}function yP(){return""}function vP(){return!0}function SP(c,d){if(c=Lt(c),c<1||c>J)return[];var _=Re,M=Kn(c,Re);d=xt(d),c-=Re;for(var I=ip(M,d);++_<c;)d(_);return I}function bP(c){return Rt(c)?an(c,Lr):Li(c)?[c]:mi(Dx($t(c)))}function wP(c){var d=++FA;return $t(c)+d}var MP=mu(function(c,d){return c+d},0),EP=Rp("ceil"),AP=mu(function(c,d){return c/d},1),TP=Rp("floor");function CP(c){return c&&c.length?lu(c,xi,pp):t}function RP(c,d){return c&&c.length?lu(c,xt(d,2),pp):t}function PP(c){return b1(c,xi)}function IP(c,d){return b1(c,xt(d,2))}function LP(c){return c&&c.length?lu(c,xi,xp):t}function NP(c,d){return c&&c.length?lu(c,xt(d,2),xp):t}var FP=mu(function(c,d){return c*d},1),OP=Rp("round"),DP=mu(function(c,d){return c-d},0);function UP(c){return c&&c.length?np(c,xi):0}function BP(c,d){return c&&c.length?np(c,xt(d,2)):0}return D.after=oR,D.ary=jx,D.assign=jR,D.assignIn=ay,D.assignInWith=Cu,D.assignWith=qR,D.at=$R,D.before=qx,D.bind=kp,D.bindAll=eP,D.bindKey=$x,D.castArray=xR,D.chain=Wx,D.chunk=TC,D.compact=CC,D.concat=RC,D.cond=tP,D.conforms=nP,D.constant=qp,D.countBy=U2,D.create=ZR,D.curry=Zx,D.curryRight=Kx,D.debounce=Jx,D.defaults=KR,D.defaultsDeep=JR,D.defer=aR,D.delay=lR,D.difference=PC,D.differenceBy=IC,D.differenceWith=LC,D.drop=NC,D.dropRight=FC,D.dropRightWhile=OC,D.dropWhile=DC,D.fill=UC,D.filter=z2,D.flatMap=G2,D.flatMapDeep=H2,D.flatMapDepth=W2,D.flatten=Vx,D.flattenDeep=BC,D.flattenDepth=zC,D.flip=cR,D.flow=rP,D.flowRight=sP,D.fromPairs=VC,D.functions=s3,D.functionsIn=o3,D.groupBy=X2,D.initial=GC,D.intersection=HC,D.intersectionBy=WC,D.intersectionWith=XC,D.invert=l3,D.invertBy=c3,D.invokeMap=j2,D.iteratee=$p,D.keyBy=q2,D.keys=Vn,D.keysIn=_i,D.map=bu,D.mapKeys=u3,D.mapValues=d3,D.matches=oP,D.matchesProperty=aP,D.memoize=Mu,D.merge=f3,D.mergeWith=ly,D.method=lP,D.methodOf=cP,D.mixin=Zp,D.negate=Eu,D.nthArg=uP,D.omit=p3,D.omitBy=m3,D.once=hR,D.orderBy=$2,D.over=dP,D.overArgs=uR,D.overEvery=fP,D.overSome=pP,D.partial=Gp,D.partialRight=Qx,D.partition=Z2,D.pick=g3,D.pickBy=cy,D.property=gy,D.propertyOf=mP,D.pull=$C,D.pullAll=Gx,D.pullAllBy=ZC,D.pullAllWith=KC,D.pullAt=JC,D.range=gP,D.rangeRight=_P,D.rearg=dR,D.reject=Q2,D.remove=QC,D.rest=fR,D.reverse=zp,D.sampleSize=tR,D.set=x3,D.setWith=y3,D.shuffle=nR,D.slice=e2,D.sortBy=sR,D.sortedUniq=a2,D.sortedUniqBy=l2,D.split=G3,D.spread=pR,D.tail=c2,D.take=h2,D.takeRight=u2,D.takeRightWhile=d2,D.takeWhile=f2,D.tap=C2,D.throttle=mR,D.thru=Su,D.toArray=ry,D.toPairs=hy,D.toPairsIn=uy,D.toPath=bP,D.toPlainObject=oy,D.transform=v3,D.unary=gR,D.union=p2,D.unionBy=m2,D.unionWith=g2,D.uniq=_2,D.uniqBy=x2,D.uniqWith=y2,D.unset=S3,D.unzip=Vp,D.unzipWith=Hx,D.update=b3,D.updateWith=w3,D.values=Ca,D.valuesIn=M3,D.without=v2,D.words=py,D.wrap=_R,D.xor=S2,D.xorBy=b2,D.xorWith=w2,D.zip=M2,D.zipObject=E2,D.zipObjectDeep=A2,D.zipWith=T2,D.entries=hy,D.entriesIn=uy,D.extend=ay,D.extendWith=Cu,Zp(D,D),D.add=MP,D.attempt=my,D.camelCase=C3,D.capitalize=dy,D.ceil=EP,D.clamp=E3,D.clone=yR,D.cloneDeep=SR,D.cloneDeepWith=bR,D.cloneWith=vR,D.conformsTo=wR,D.deburr=fy,D.defaultTo=iP,D.divide=AP,D.endsWith=R3,D.eq=dr,D.escape=P3,D.escapeRegExp=I3,D.every=B2,D.find=V2,D.findIndex=Bx,D.findKey=QR,D.findLast=k2,D.findLastIndex=zx,D.findLastKey=e3,D.floor=TP,D.forEach=Xx,D.forEachRight=Yx,D.forIn=t3,D.forInRight=n3,D.forOwn=i3,D.forOwnRight=r3,D.get=Xp,D.gt=MR,D.gte=ER,D.has=a3,D.hasIn=Yp,D.head=kx,D.identity=xi,D.includes=Y2,D.indexOf=kC,D.inRange=A3,D.invoke=h3,D.isArguments=Mo,D.isArray=Rt,D.isArrayBuffer=AR,D.isArrayLike=gi,D.isArrayLikeObject=_n,D.isBoolean=TR,D.isBuffer=Ds,D.isDate=CR,D.isElement=RR,D.isEmpty=PR,D.isEqual=IR,D.isEqualWith=LR,D.isError=Hp,D.isFinite=NR,D.isFunction=Qr,D.isInteger=ey,D.isLength=Au,D.isMap=ty,D.isMatch=FR,D.isMatchWith=OR,D.isNaN=DR,D.isNative=UR,D.isNil=zR,D.isNull=BR,D.isNumber=ny,D.isObject=cn,D.isObjectLike=fn,D.isPlainObject=ac,D.isRegExp=Wp,D.isSafeInteger=VR,D.isSet=iy,D.isString=Tu,D.isSymbol=Li,D.isTypedArray=Ta,D.isUndefined=kR,D.isWeakMap=GR,D.isWeakSet=HR,D.join=YC,D.kebabCase=L3,D.last=er,D.lastIndexOf=jC,D.lowerCase=N3,D.lowerFirst=F3,D.lt=WR,D.lte=XR,D.max=CP,D.maxBy=RP,D.mean=PP,D.meanBy=IP,D.min=LP,D.minBy=NP,D.stubArray=Jp,D.stubFalse=Qp,D.stubObject=xP,D.stubString=yP,D.stubTrue=vP,D.multiply=FP,D.nth=qC,D.noConflict=hP,D.noop=Kp,D.now=wu,D.pad=O3,D.padEnd=D3,D.padStart=U3,D.parseInt=B3,D.random=T3,D.reduce=K2,D.reduceRight=J2,D.repeat=z3,D.replace=V3,D.result=_3,D.round=OP,D.runInContext=re,D.sample=eR,D.size=iR,D.snakeCase=k3,D.some=rR,D.sortedIndex=t2,D.sortedIndexBy=n2,D.sortedIndexOf=i2,D.sortedLastIndex=r2,D.sortedLastIndexBy=s2,D.sortedLastIndexOf=o2,D.startCase=H3,D.startsWith=W3,D.subtract=DP,D.sum=UP,D.sumBy=BP,D.template=X3,D.times=SP,D.toFinite=es,D.toInteger=Lt,D.toLength=sy,D.toLower=Y3,D.toNumber=tr,D.toSafeInteger=YR,D.toString=$t,D.toUpper=j3,D.trim=q3,D.trimEnd=$3,D.trimStart=Z3,D.truncate=K3,D.unescape=J3,D.uniqueId=wP,D.upperCase=Q3,D.upperFirst=jp,D.each=Xx,D.eachRight=Yx,D.first=kx,Zp(D,function(){var c={};return Pr(D,function(d,_){Kt.call(D.prototype,_)||(c[_]=d)}),c}(),{chain:!1}),D.VERSION=n,$i(["bind","bindKey","curry","curryRight","partial","partialRight"],function(c){D[c].placeholder=D}),$i(["drop","take"],function(c,d){Gt.prototype[c]=function(_){_=_===t?1:Rn(Lt(_),0);var M=this.__filtered__&&!d?new Gt(this):this.clone();return M.__filtered__?M.__takeCount__=Kn(_,M.__takeCount__):M.__views__.push({size:Kn(_,Re),type:c+(M.__dir__<0?"Right":"")}),M},Gt.prototype[c+"Right"]=function(_){return this.reverse()[c](_).reverse()}}),$i(["filter","map","takeWhile"],function(c,d){var _=d+1,M=_==O||_==j;Gt.prototype[c]=function(I){var B=this.clone();return B.__iteratees__.push({iteratee:xt(I,3),type:_}),B.__filtered__=B.__filtered__||M,B}}),$i(["head","last"],function(c,d){var _="take"+(d?"Right":"");Gt.prototype[c]=function(){return this[_](1).value()[0]}}),$i(["initial","tail"],function(c,d){var _="drop"+(d?"":"Right");Gt.prototype[c]=function(){return this.__filtered__?new Gt(this):this[_](1)}}),Gt.prototype.compact=function(){return this.filter(xi)},Gt.prototype.find=function(c){return this.filter(c).head()},Gt.prototype.findLast=function(c){return this.reverse().find(c)},Gt.prototype.invokeMap=Ut(function(c,d){return typeof c=="function"?new Gt(this):this.map(function(_){return tc(_,c,d)})}),Gt.prototype.reject=function(c){return this.filter(Eu(xt(c)))},Gt.prototype.slice=function(c,d){c=Lt(c);var _=this;return _.__filtered__&&(c>0||d<0)?new Gt(_):(c<0?_=_.takeRight(-c):c&&(_=_.drop(c)),d!==t&&(d=Lt(d),_=d<0?_.dropRight(-d):_.take(d-c)),_)},Gt.prototype.takeRightWhile=function(c){return this.reverse().takeWhile(c).reverse()},Gt.prototype.toArray=function(){return this.take(Re)},Pr(Gt.prototype,function(c,d){var _=/^(?:filter|find|map|reject)|While$/.test(d),M=/^(?:head|last)$/.test(d),I=D[M?"take"+(d=="last"?"Right":""):d],B=M||/^find/.test(d);I&&(D.prototype[d]=function(){var $=this.__wrapped__,te=M?[1]:arguments,le=$ instanceof Gt,Be=te[0],ze=le||Rt($),Xe=function(Vt){var Ht=I.apply(D,Rs([Vt],te));return M&&st?Ht[0]:Ht};ze&&_&&typeof Be=="function"&&Be.length!=1&&(le=ze=!1);var st=this.__chain__,pt=!!this.__actions__.length,vt=B&&!st,Nt=le&&!pt;if(!B&&ze){$=Nt?$:new Gt(this);var St=c.apply($,te);return St.__actions__.push({func:Su,args:[Xe],thisArg:t}),new Ki(St,st)}return vt&&Nt?c.apply(this,te):(St=this.thru(Xe),vt?M?St.value()[0]:St.value():St)})}),$i(["pop","push","shift","sort","splice","unshift"],function(c){var d=jh[c],_=/^(?:push|sort|unshift)$/.test(c)?"tap":"thru",M=/^(?:pop|shift)$/.test(c);D.prototype[c]=function(){var I=arguments;if(M&&!this.__chain__){var B=this.value();return d.apply(Rt(B)?B:[],I)}return this[_](function($){return d.apply(Rt($)?$:[],I)})}}),Pr(Gt.prototype,function(c,d){var _=D[d];if(_){var M=_.name+"";Kt.call(ba,M)||(ba[M]=[]),ba[M].push({name:d,func:_})}}),ba[pu(t,x).name]=[{name:"wrapper",func:t}],Gt.prototype.clone=JA,Gt.prototype.reverse=QA,Gt.prototype.value=eT,D.prototype.at=R2,D.prototype.chain=P2,D.prototype.commit=I2,D.prototype.next=L2,D.prototype.plant=F2,D.prototype.reverse=O2,D.prototype.toJSON=D.prototype.valueOf=D.prototype.value=D2,D.prototype.first=D.prototype.head,ql&&(D.prototype[ql]=N2),D},ya=IA();go?((go.exports=ya)._=ya,$f._=ya):Hn._=ya}).call(lc)})(qd,qd.exports);var eI=qd.exports;const tI=kP(eI);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const hf="153",nI={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},iI={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},hb=0,u0=1,ub=2,rI=3,sI=0,_g=1,db=2,Fr=3,ys=0,di=1,Or=2,oI=2,_s=0,Yo=1,d0=2,f0=3,p0=4,fb=5,zo=100,pb=101,mb=102,m0=103,g0=104,gb=200,_b=201,xb=202,yb=203,xg=204,yg=205,vb=206,Sb=207,bb=208,wb=209,Mb=210,Eb=0,Ab=1,Tb=2,$d=3,Cb=4,Rb=5,Pb=6,Ib=7,ch=0,Lb=1,Nb=2,Br=0,Fb=1,Ob=2,Db=3,Ub=4,Bb=5,uf=300,ro=301,so=302,zc=303,Vc=304,Al=306,kc=1e3,ii=1001,Gc=1002,vn=1003,Zd=1004,aI=1004,Nc=1005,lI=1005,Sn=1006,vg=1007,cI=1007,oo=1008,hI=1008,xs=1009,zb=1010,Vb=1011,df=1012,Sg=1013,ms=1014,Dr=1015,vl=1016,bg=1017,wg=1018,Qs=1020,kb=1021,Vi=1023,Gb=1024,Hb=1025,eo=1026,$o=1027,Wb=1028,Mg=1029,Xb=1030,Eg=1031,Ag=1033,Ud=33776,Bd=33777,zd=33778,Vd=33779,_0=35840,x0=35841,y0=35842,v0=35843,Yb=36196,S0=37492,b0=37496,w0=37808,M0=37809,E0=37810,A0=37811,T0=37812,C0=37813,R0=37814,P0=37815,I0=37816,L0=37817,N0=37818,F0=37819,O0=37820,D0=37821,kd=36492,jb=36283,U0=36284,B0=36285,z0=36286,qb=2200,$b=2201,Zb=2202,Hc=2300,Wc=2301,Gd=2302,ko=2400,Go=2401,Xc=2402,ff=2500,Tg=2501,uI=0,dI=1,fI=2,Cg=3e3,to=3001,Kb=3200,Jb=3201,co=0,Qb=1,no="",It="srgb",yr="srgb-linear",Rg="display-p3",pI=0,Hd=7680,mI=7681,gI=7682,_I=7683,xI=34055,yI=34056,vI=5386,SI=512,bI=513,wI=514,MI=515,EI=516,AI=517,TI=518,ew=519,tw=512,nw=513,iw=514,rw=515,sw=516,ow=517,aw=518,lw=519,Yc=35044,CI=35048,RI=35040,PI=35045,II=35049,LI=35041,NI=35046,FI=35050,OI=35042,DI="100",V0="300 es",Kd=1035,Ur=2e3,jc=2001;let Ms=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e);e.target=null}}};const Qn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let wy=1234567;const jo=Math.PI/180,Sl=180/Math.PI;function Gi(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Qn[s&255]+Qn[s>>8&255]+Qn[s>>16&255]+Qn[s>>24&255]+"-"+Qn[e&255]+Qn[e>>8&255]+"-"+Qn[e>>16&15|64]+Qn[e>>24&255]+"-"+Qn[t&63|128]+Qn[t>>8&255]+"-"+Qn[t>>16&255]+Qn[t>>24&255]+Qn[n&255]+Qn[n>>8&255]+Qn[n>>16&255]+Qn[n>>24&255]).toLowerCase()}function mn(s,e,t){return Math.max(e,Math.min(t,s))}function Pg(s,e){return(s%e+e)%e}function UI(s,e,t,n,i){return n+(s-e)*(i-n)/(t-e)}function BI(s,e,t){return s!==e?(t-s)/(e-s):0}function Fc(s,e,t){return(1-t)*s+t*e}function zI(s,e,t,n){return Fc(s,e,1-Math.exp(-t*n))}function VI(s,e=1){return e-Math.abs(Pg(s,e*2)-e)}function kI(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function GI(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function HI(s,e){return s+Math.floor(Math.random()*(e-s+1))}function WI(s,e){return s+Math.random()*(e-s)}function XI(s){return s*(.5-Math.random())}function YI(s){s!==void 0&&(wy=s);let e=wy+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function jI(s){return s*jo}function qI(s){return s*Sl}function k0(s){return(s&s-1)===0&&s!==0}function cw(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Jd(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function $I(s,e,t,n,i){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),h=r((e+n)/2),u=o((e+n)/2),f=r((e-n)/2),p=o((e-n)/2),m=r((n-e)/2),g=o((n-e)/2);switch(i){case"XYX":s.set(a*u,l*f,l*p,a*h);break;case"YZY":s.set(l*p,a*u,l*f,a*h);break;case"ZXZ":s.set(l*f,l*p,a*u,a*h);break;case"XZX":s.set(a*u,l*g,l*m,a*h);break;case"YXY":s.set(l*m,a*u,l*g,a*h);break;case"ZYZ":s.set(l*g,l*m,a*u,a*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function ki(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function Dt(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const ZI={DEG2RAD:jo,RAD2DEG:Sl,generateUUID:Gi,clamp:mn,euclideanModulo:Pg,mapLinear:UI,inverseLerp:BI,lerp:Fc,damp:zI,pingpong:VI,smoothstep:kI,smootherstep:GI,randInt:HI,randFloat:WI,randFloatSpread:XI,seededRandom:YI,degToRad:jI,radToDeg:qI,isPowerOfTwo:k0,ceilPowerOfTwo:cw,floorPowerOfTwo:Jd,setQuaternionFromProperEuler:$I,normalize:Dt,denormalize:ki};class He{constructor(e=0,t=0){He.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(mn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ot{constructor(e,t,n,i,r,o,a,l,h){Ot.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,r,o,a,l,h)}set(e,t,n,i,r,o,a,l,h){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=o,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],l=n[6],h=n[1],u=n[4],f=n[7],p=n[2],m=n[5],g=n[8],v=i[0],y=i[3],x=i[6],w=i[1],S=i[4],E=i[7],A=i[2],C=i[5],P=i[8];return r[0]=o*v+a*w+l*A,r[3]=o*y+a*S+l*C,r[6]=o*x+a*E+l*P,r[1]=h*v+u*w+f*A,r[4]=h*y+u*S+f*C,r[7]=h*x+u*E+f*P,r[2]=p*v+m*w+g*A,r[5]=p*y+m*S+g*C,r[8]=p*x+m*E+g*P,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],l=e[6],h=e[7],u=e[8];return t*o*u-t*a*h-n*r*u+n*a*l+i*r*h-i*o*l}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],l=e[6],h=e[7],u=e[8],f=u*o-a*h,p=a*l-u*r,m=h*r-o*l,g=t*f+n*p+i*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/g;return e[0]=f*v,e[1]=(i*h-u*n)*v,e[2]=(a*n-i*o)*v,e[3]=p*v,e[4]=(u*t-i*l)*v,e[5]=(i*r-a*t)*v,e[6]=m*v,e[7]=(n*l-h*t)*v,e[8]=(o*t-n*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,a){const l=Math.cos(r),h=Math.sin(r);return this.set(n*l,n*h,-n*(l*o+h*a)+o+e,-i*h,i*l,-i*(-h*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(tm.makeScale(e,t)),this}rotate(e){return this.premultiply(tm.makeRotation(-e)),this}translate(e,t){return this.premultiply(tm.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const tm=new Ot;function hw(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}const KI={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function cl(s,e){return new KI[s](e)}function qc(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}const My={};function Oc(s){s in My||(My[s]=!0,console.warn(s))}function ml(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function nm(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}const JI=new Ot().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),QI=new Ot().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function eL(s){return s.convertSRGBToLinear().applyMatrix3(QI)}function tL(s){return s.applyMatrix3(JI).convertLinearToSRGB()}const nL={[yr]:s=>s,[It]:s=>s.convertSRGBToLinear(),[Rg]:eL},iL={[yr]:s=>s,[It]:s=>s.convertLinearToSRGB(),[Rg]:tL},ir={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(s){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!s},get workingColorSpace(){return yr},set workingColorSpace(s){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(s,e,t){if(this.enabled===!1||e===t||!e||!t)return s;const n=nL[e],i=iL[t];if(n===void 0||i===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return i(n(s))},fromWorkingColorSpace:function(s,e){return this.convert(s,this.workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this.workingColorSpace)}};let Ra;class Ig{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ra===void 0&&(Ra=qc("canvas")),Ra.width=e.width,Ra.height=e.height;const n=Ra.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Ra}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=qc("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let o=0;o<r.length;o++)r[o]=ml(r[o]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(ml(t[n]/255)*255):t[n]=ml(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let rL=0;class Ho{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:rL++}),this.uuid=Gi(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?r.push(im(i[o].image)):r.push(im(i[o]))}else r=im(i);n.url=r}return t||(e.images[this.uuid]=n),n}}function im(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?Ig.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let sL=0;class bn extends Ms{constructor(e=bn.DEFAULT_IMAGE,t=bn.DEFAULT_MAPPING,n=ii,i=ii,r=Sn,o=oo,a=Vi,l=xs,h=bn.DEFAULT_ANISOTROPY,u=no){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:sL++}),this.uuid=Gi(),this.name="",this.source=new Ho(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=h,this.format=a,this.internalFormat=null,this.type=l,this.offset=new He(0,0),this.repeat=new He(1,1),this.center=new He(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ot,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(Oc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===to?It:no),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==uf)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case kc:e.x=e.x-Math.floor(e.x);break;case ii:e.x=e.x<0?0:1;break;case Gc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case kc:e.y=e.y-Math.floor(e.y);break;case ii:e.y=e.y<0?0:1;break;case Gc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Oc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===It?to:Cg}set encoding(e){Oc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===to?It:no}}bn.DEFAULT_IMAGE=null;bn.DEFAULT_MAPPING=uf;bn.DEFAULT_ANISOTROPY=1;class Qt{constructor(e=0,t=0,n=0,i=1){Qt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const l=e.elements,h=l[0],u=l[4],f=l[8],p=l[1],m=l[5],g=l[9],v=l[2],y=l[6],x=l[10];if(Math.abs(u-p)<.01&&Math.abs(f-v)<.01&&Math.abs(g-y)<.01){if(Math.abs(u+p)<.1&&Math.abs(f+v)<.1&&Math.abs(g+y)<.1&&Math.abs(h+m+x-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const S=(h+1)/2,E=(m+1)/2,A=(x+1)/2,C=(u+p)/4,P=(f+v)/4,L=(g+y)/4;return S>E&&S>A?S<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(S),i=C/n,r=P/n):E>A?E<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(E),n=C/i,r=L/i):A<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(A),n=P/r,i=L/r),this.set(n,i,r,t),this}let w=Math.sqrt((y-g)*(y-g)+(f-v)*(f-v)+(p-u)*(p-u));return Math.abs(w)<.001&&(w=1),this.x=(y-g)/w,this.y=(f-v)/w,this.z=(p-u)/w,this.w=Math.acos((h+m+x-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class vr extends Ms{constructor(e=1,t=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Qt(0,0,e,t),this.scissorTest=!1,this.viewport=new Qt(0,0,e,t);const i={width:e,height:t,depth:1};n.encoding!==void 0&&(Oc("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===to?It:no),this.texture=new bn(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Sn,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Ho(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class pf extends bn{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=vn,this.minFilter=vn,this.wrapR=ii,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class oL extends vr{constructor(e=1,t=1,n=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new pf(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Lg extends bn{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=vn,this.minFilter=vn,this.wrapR=ii,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class aL extends vr{constructor(e=1,t=1,n=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Lg(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class lL extends vr{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Ei{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,a){let l=n[i+0],h=n[i+1],u=n[i+2],f=n[i+3];const p=r[o+0],m=r[o+1],g=r[o+2],v=r[o+3];if(a===0){e[t+0]=l,e[t+1]=h,e[t+2]=u,e[t+3]=f;return}if(a===1){e[t+0]=p,e[t+1]=m,e[t+2]=g,e[t+3]=v;return}if(f!==v||l!==p||h!==m||u!==g){let y=1-a;const x=l*p+h*m+u*g+f*v,w=x>=0?1:-1,S=1-x*x;if(S>Number.EPSILON){const A=Math.sqrt(S),C=Math.atan2(A,x*w);y=Math.sin(y*C)/A,a=Math.sin(a*C)/A}const E=a*w;if(l=l*y+p*E,h=h*y+m*E,u=u*y+g*E,f=f*y+v*E,y===1-a){const A=1/Math.sqrt(l*l+h*h+u*u+f*f);l*=A,h*=A,u*=A,f*=A}}e[t]=l,e[t+1]=h,e[t+2]=u,e[t+3]=f}static multiplyQuaternionsFlat(e,t,n,i,r,o){const a=n[i],l=n[i+1],h=n[i+2],u=n[i+3],f=r[o],p=r[o+1],m=r[o+2],g=r[o+3];return e[t]=a*g+u*f+l*m-h*p,e[t+1]=l*g+u*p+h*f-a*m,e[t+2]=h*g+u*m+a*p-l*f,e[t+3]=u*g-a*f-l*p-h*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,h=a(n/2),u=a(i/2),f=a(r/2),p=l(n/2),m=l(i/2),g=l(r/2);switch(o){case"XYZ":this._x=p*u*f+h*m*g,this._y=h*m*f-p*u*g,this._z=h*u*g+p*m*f,this._w=h*u*f-p*m*g;break;case"YXZ":this._x=p*u*f+h*m*g,this._y=h*m*f-p*u*g,this._z=h*u*g-p*m*f,this._w=h*u*f+p*m*g;break;case"ZXY":this._x=p*u*f-h*m*g,this._y=h*m*f+p*u*g,this._z=h*u*g+p*m*f,this._w=h*u*f-p*m*g;break;case"ZYX":this._x=p*u*f-h*m*g,this._y=h*m*f+p*u*g,this._z=h*u*g-p*m*f,this._w=h*u*f+p*m*g;break;case"YZX":this._x=p*u*f+h*m*g,this._y=h*m*f+p*u*g,this._z=h*u*g-p*m*f,this._w=h*u*f-p*m*g;break;case"XZY":this._x=p*u*f-h*m*g,this._y=h*m*f-p*u*g,this._z=h*u*g+p*m*f,this._w=h*u*f+p*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],l=t[9],h=t[2],u=t[6],f=t[10],p=n+a+f;if(p>0){const m=.5/Math.sqrt(p+1);this._w=.25/m,this._x=(u-l)*m,this._y=(r-h)*m,this._z=(o-i)*m}else if(n>a&&n>f){const m=2*Math.sqrt(1+n-a-f);this._w=(u-l)/m,this._x=.25*m,this._y=(i+o)/m,this._z=(r+h)/m}else if(a>f){const m=2*Math.sqrt(1+a-n-f);this._w=(r-h)/m,this._x=(i+o)/m,this._y=.25*m,this._z=(l+u)/m}else{const m=2*Math.sqrt(1+f-n-a);this._w=(o-i)/m,this._x=(r+h)/m,this._y=(l+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(mn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,l=t._y,h=t._z,u=t._w;return this._x=n*u+o*a+i*h-r*l,this._y=i*u+o*l+r*a-n*h,this._z=r*u+o*h+n*l-i*a,this._w=o*u-n*a-i*l-r*h,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-t;return this._w=m*o+t*this._w,this._x=m*n+t*this._x,this._y=m*i+t*this._y,this._z=m*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(l),u=Math.atan2(h,a),f=Math.sin((1-t)*u)/h,p=Math.sin(t*u)/h;return this._w=o*f+this._w*p,this._x=n*f+this._x*p,this._y=i*f+this._y*p,this._z=r*f+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class X{constructor(e=0,t=0,n=0){X.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ey.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ey.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,l=e.w,h=l*t+o*i-a*n,u=l*n+a*t-r*i,f=l*i+r*n-o*t,p=-r*t-o*n-a*i;return this.x=h*l+p*-r+u*-a-f*-o,this.y=u*l+p*-o+f*-r-h*-a,this.z=f*l+p*-a+h*-o-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=i*l-r*a,this.y=r*o-n*l,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return rm.copy(this).projectOnVector(e),this.sub(rm)}reflect(e){return this.sub(rm.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(mn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const rm=new X,Ey=new Ei;class Gr{constructor(e=new X(1/0,1/0,1/0),t=new X(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(is.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(is.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=is.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),Pa.copy(e.boundingBox),Pa.applyMatrix4(e.matrixWorld),this.union(Pa);else{const i=e.geometry;if(i!==void 0)if(t&&i.attributes!==void 0&&i.attributes.position!==void 0){const r=i.attributes.position;for(let o=0,a=r.count;o<a;o++)is.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(is)}else i.boundingBox===null&&i.computeBoundingBox(),Pa.copy(i.boundingBox),Pa.applyMatrix4(e.matrixWorld),this.union(Pa)}const n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,is),is.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(hc),Ru.subVectors(this.max,hc),Ia.subVectors(e.a,hc),La.subVectors(e.b,hc),Na.subVectors(e.c,hc),Us.subVectors(La,Ia),Bs.subVectors(Na,La),Eo.subVectors(Ia,Na);let t=[0,-Us.z,Us.y,0,-Bs.z,Bs.y,0,-Eo.z,Eo.y,Us.z,0,-Us.x,Bs.z,0,-Bs.x,Eo.z,0,-Eo.x,-Us.y,Us.x,0,-Bs.y,Bs.x,0,-Eo.y,Eo.x,0];return!sm(t,Ia,La,Na,Ru)||(t=[1,0,0,0,1,0,0,0,1],!sm(t,Ia,La,Na,Ru))?!1:(Pu.crossVectors(Us,Bs),t=[Pu.x,Pu.y,Pu.z],sm(t,Ia,La,Na,Ru))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,is).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(is).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ns[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ns[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ns[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ns[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ns[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ns[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ns[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ns[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ns),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ns=[new X,new X,new X,new X,new X,new X,new X,new X],is=new X,Pa=new Gr,Ia=new X,La=new X,Na=new X,Us=new X,Bs=new X,Eo=new X,hc=new X,Ru=new X,Pu=new X,Ao=new X;function sm(s,e,t,n,i){for(let r=0,o=s.length-3;r<=o;r+=3){Ao.fromArray(s,r);const a=i.x*Math.abs(Ao.x)+i.y*Math.abs(Ao.y)+i.z*Math.abs(Ao.z),l=e.dot(Ao),h=t.dot(Ao),u=n.dot(Ao);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>a)return!1}return!0}const cL=new Gr,uc=new X,om=new X;class wr{constructor(e=new X,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):cL.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;uc.subVectors(e,this.center);const t=uc.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(uc,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(om.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(uc.copy(e.center).add(om)),this.expandByPoint(uc.copy(e.center).sub(om))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const rs=new X,am=new X,Iu=new X,zs=new X,lm=new X,Lu=new X,cm=new X;class Tl{constructor(e=new X,t=new X(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,rs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=rs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(rs.copy(this.origin).addScaledVector(this.direction,t),rs.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){am.copy(e).add(t).multiplyScalar(.5),Iu.copy(t).sub(e).normalize(),zs.copy(this.origin).sub(am);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Iu),a=zs.dot(this.direction),l=-zs.dot(Iu),h=zs.lengthSq(),u=Math.abs(1-o*o);let f,p,m,g;if(u>0)if(f=o*l-a,p=o*a-l,g=r*u,f>=0)if(p>=-g)if(p<=g){const v=1/u;f*=v,p*=v,m=f*(f+o*p+2*a)+p*(o*f+p+2*l)+h}else p=r,f=Math.max(0,-(o*p+a)),m=-f*f+p*(p+2*l)+h;else p=-r,f=Math.max(0,-(o*p+a)),m=-f*f+p*(p+2*l)+h;else p<=-g?(f=Math.max(0,-(-o*r+a)),p=f>0?-r:Math.min(Math.max(-r,-l),r),m=-f*f+p*(p+2*l)+h):p<=g?(f=0,p=Math.min(Math.max(-r,-l),r),m=p*(p+2*l)+h):(f=Math.max(0,-(o*r+a)),p=f>0?r:Math.min(Math.max(-r,-l),r),m=-f*f+p*(p+2*l)+h);else p=o>0?-r:r,f=Math.max(0,-(o*p+a)),m=-f*f+p*(p+2*l)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,f),i&&i.copy(am).addScaledVector(Iu,p),m}intersectSphere(e,t){rs.subVectors(e.center,this.origin);const n=rs.dot(this.direction),i=rs.dot(rs)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,a,l;const h=1/this.direction.x,u=1/this.direction.y,f=1/this.direction.z,p=this.origin;return h>=0?(n=(e.min.x-p.x)*h,i=(e.max.x-p.x)*h):(n=(e.max.x-p.x)*h,i=(e.min.x-p.x)*h),u>=0?(r=(e.min.y-p.y)*u,o=(e.max.y-p.y)*u):(r=(e.max.y-p.y)*u,o=(e.min.y-p.y)*u),n>o||r>i||((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),f>=0?(a=(e.min.z-p.z)*f,l=(e.max.z-p.z)*f):(a=(e.max.z-p.z)*f,l=(e.min.z-p.z)*f),n>l||a>i)||((a>n||n!==n)&&(n=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,rs)!==null}intersectTriangle(e,t,n,i,r){lm.subVectors(t,e),Lu.subVectors(n,e),cm.crossVectors(lm,Lu);let o=this.direction.dot(cm),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;zs.subVectors(this.origin,e);const l=a*this.direction.dot(Lu.crossVectors(zs,Lu));if(l<0)return null;const h=a*this.direction.dot(lm.cross(zs));if(h<0||l+h>o)return null;const u=-a*zs.dot(cm);return u<0?null:this.at(u/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Pt{constructor(e,t,n,i,r,o,a,l,h,u,f,p,m,g,v,y){Pt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,r,o,a,l,h,u,f,p,m,g,v,y)}set(e,t,n,i,r,o,a,l,h,u,f,p,m,g,v,y){const x=this.elements;return x[0]=e,x[4]=t,x[8]=n,x[12]=i,x[1]=r,x[5]=o,x[9]=a,x[13]=l,x[2]=h,x[6]=u,x[10]=f,x[14]=p,x[3]=m,x[7]=g,x[11]=v,x[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Pt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Fa.setFromMatrixColumn(e,0).length(),r=1/Fa.setFromMatrixColumn(e,1).length(),o=1/Fa.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(i),h=Math.sin(i),u=Math.cos(r),f=Math.sin(r);if(e.order==="XYZ"){const p=o*u,m=o*f,g=a*u,v=a*f;t[0]=l*u,t[4]=-l*f,t[8]=h,t[1]=m+g*h,t[5]=p-v*h,t[9]=-a*l,t[2]=v-p*h,t[6]=g+m*h,t[10]=o*l}else if(e.order==="YXZ"){const p=l*u,m=l*f,g=h*u,v=h*f;t[0]=p+v*a,t[4]=g*a-m,t[8]=o*h,t[1]=o*f,t[5]=o*u,t[9]=-a,t[2]=m*a-g,t[6]=v+p*a,t[10]=o*l}else if(e.order==="ZXY"){const p=l*u,m=l*f,g=h*u,v=h*f;t[0]=p-v*a,t[4]=-o*f,t[8]=g+m*a,t[1]=m+g*a,t[5]=o*u,t[9]=v-p*a,t[2]=-o*h,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const p=o*u,m=o*f,g=a*u,v=a*f;t[0]=l*u,t[4]=g*h-m,t[8]=p*h+v,t[1]=l*f,t[5]=v*h+p,t[9]=m*h-g,t[2]=-h,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const p=o*l,m=o*h,g=a*l,v=a*h;t[0]=l*u,t[4]=v-p*f,t[8]=g*f+m,t[1]=f,t[5]=o*u,t[9]=-a*u,t[2]=-h*u,t[6]=m*f+g,t[10]=p-v*f}else if(e.order==="XZY"){const p=o*l,m=o*h,g=a*l,v=a*h;t[0]=l*u,t[4]=-f,t[8]=h*u,t[1]=p*f+v,t[5]=o*u,t[9]=m*f-g,t[2]=g*f-m,t[6]=a*u,t[10]=v*f+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(hL,e,uL)}lookAt(e,t,n){const i=this.elements;return Oi.subVectors(e,t),Oi.lengthSq()===0&&(Oi.z=1),Oi.normalize(),Vs.crossVectors(n,Oi),Vs.lengthSq()===0&&(Math.abs(n.z)===1?Oi.x+=1e-4:Oi.z+=1e-4,Oi.normalize(),Vs.crossVectors(n,Oi)),Vs.normalize(),Nu.crossVectors(Oi,Vs),i[0]=Vs.x,i[4]=Nu.x,i[8]=Oi.x,i[1]=Vs.y,i[5]=Nu.y,i[9]=Oi.y,i[2]=Vs.z,i[6]=Nu.z,i[10]=Oi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],l=n[8],h=n[12],u=n[1],f=n[5],p=n[9],m=n[13],g=n[2],v=n[6],y=n[10],x=n[14],w=n[3],S=n[7],E=n[11],A=n[15],C=i[0],P=i[4],L=i[8],T=i[12],R=i[1],G=i[5],K=i[9],Z=i[13],O=i[2],V=i[6],j=i[10],q=i[14],J=i[3],se=i[7],_e=i[11],Re=i[15];return r[0]=o*C+a*R+l*O+h*J,r[4]=o*P+a*G+l*V+h*se,r[8]=o*L+a*K+l*j+h*_e,r[12]=o*T+a*Z+l*q+h*Re,r[1]=u*C+f*R+p*O+m*J,r[5]=u*P+f*G+p*V+m*se,r[9]=u*L+f*K+p*j+m*_e,r[13]=u*T+f*Z+p*q+m*Re,r[2]=g*C+v*R+y*O+x*J,r[6]=g*P+v*G+y*V+x*se,r[10]=g*L+v*K+y*j+x*_e,r[14]=g*T+v*Z+y*q+x*Re,r[3]=w*C+S*R+E*O+A*J,r[7]=w*P+S*G+E*V+A*se,r[11]=w*L+S*K+E*j+A*_e,r[15]=w*T+S*Z+E*q+A*Re,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],l=e[9],h=e[13],u=e[2],f=e[6],p=e[10],m=e[14],g=e[3],v=e[7],y=e[11],x=e[15];return g*(+r*l*f-i*h*f-r*a*p+n*h*p+i*a*m-n*l*m)+v*(+t*l*m-t*h*p+r*o*p-i*o*m+i*h*u-r*l*u)+y*(+t*h*f-t*a*m-r*o*f+n*o*m+r*a*u-n*h*u)+x*(-i*a*u-t*l*f+t*a*p+i*o*f-n*o*p+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],l=e[6],h=e[7],u=e[8],f=e[9],p=e[10],m=e[11],g=e[12],v=e[13],y=e[14],x=e[15],w=f*y*h-v*p*h+v*l*m-a*y*m-f*l*x+a*p*x,S=g*p*h-u*y*h-g*l*m+o*y*m+u*l*x-o*p*x,E=u*v*h-g*f*h+g*a*m-o*v*m-u*a*x+o*f*x,A=g*f*l-u*v*l-g*a*p+o*v*p+u*a*y-o*f*y,C=t*w+n*S+i*E+r*A;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const P=1/C;return e[0]=w*P,e[1]=(v*p*r-f*y*r-v*i*m+n*y*m+f*i*x-n*p*x)*P,e[2]=(a*y*r-v*l*r+v*i*h-n*y*h-a*i*x+n*l*x)*P,e[3]=(f*l*r-a*p*r-f*i*h+n*p*h+a*i*m-n*l*m)*P,e[4]=S*P,e[5]=(u*y*r-g*p*r+g*i*m-t*y*m-u*i*x+t*p*x)*P,e[6]=(g*l*r-o*y*r-g*i*h+t*y*h+o*i*x-t*l*x)*P,e[7]=(o*p*r-u*l*r+u*i*h-t*p*h-o*i*m+t*l*m)*P,e[8]=E*P,e[9]=(g*f*r-u*v*r-g*n*m+t*v*m+u*n*x-t*f*x)*P,e[10]=(o*v*r-g*a*r+g*n*h-t*v*h-o*n*x+t*a*x)*P,e[11]=(u*a*r-o*f*r-u*n*h+t*f*h+o*n*m-t*a*m)*P,e[12]=A*P,e[13]=(u*v*i-g*f*i+g*n*p-t*v*p-u*n*y+t*f*y)*P,e[14]=(g*a*i-o*v*i-g*n*l+t*v*l+o*n*y-t*a*y)*P,e[15]=(o*f*i-u*a*i+u*n*l-t*f*l-o*n*p+t*a*p)*P,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,l=e.z,h=r*o,u=r*a;return this.set(h*o+n,h*a-i*l,h*l+i*a,0,h*a+i*l,u*a+n,u*l-i*o,0,h*l-i*a,u*l+i*o,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,h=r+r,u=o+o,f=a+a,p=r*h,m=r*u,g=r*f,v=o*u,y=o*f,x=a*f,w=l*h,S=l*u,E=l*f,A=n.x,C=n.y,P=n.z;return i[0]=(1-(v+x))*A,i[1]=(m+E)*A,i[2]=(g-S)*A,i[3]=0,i[4]=(m-E)*C,i[5]=(1-(p+x))*C,i[6]=(y+w)*C,i[7]=0,i[8]=(g+S)*P,i[9]=(y-w)*P,i[10]=(1-(p+v))*P,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Fa.set(i[0],i[1],i[2]).length();const o=Fa.set(i[4],i[5],i[6]).length(),a=Fa.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],pr.copy(this);const h=1/r,u=1/o,f=1/a;return pr.elements[0]*=h,pr.elements[1]*=h,pr.elements[2]*=h,pr.elements[4]*=u,pr.elements[5]*=u,pr.elements[6]*=u,pr.elements[8]*=f,pr.elements[9]*=f,pr.elements[10]*=f,t.setFromRotationMatrix(pr),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,i,r,o,a=Ur){const l=this.elements,h=2*r/(t-e),u=2*r/(n-i),f=(t+e)/(t-e),p=(n+i)/(n-i);let m,g;if(a===Ur)m=-(o+r)/(o-r),g=-2*o*r/(o-r);else if(a===jc)m=-o/(o-r),g=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=h,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=u,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,r,o,a=Ur){const l=this.elements,h=1/(t-e),u=1/(n-i),f=1/(o-r),p=(t+e)*h,m=(n+i)*u;let g,v;if(a===Ur)g=(o+r)*f,v=-2*f;else if(a===jc)g=r*f,v=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=v,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Fa=new X,pr=new Pt,hL=new X(0,0,0),uL=new X(1,1,1),Vs=new X,Nu=new X,Oi=new X,Ay=new Pt,Ty=new Ei;class hh{constructor(e=0,t=0,n=0,i=hh.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],a=i[8],l=i[1],h=i[5],u=i[9],f=i[2],p=i[6],m=i[10];switch(t){case"XYZ":this._y=Math.asin(mn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(p,h),this._z=0);break;case"YXZ":this._x=Math.asin(-mn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(mn(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-mn(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(p,m),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(mn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-mn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,h),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Ay.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ay,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ty.setFromEuler(this),this.setFromQuaternion(Ty,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}hh.DEFAULT_ORDER="XYZ";class mf{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let dL=0;const Cy=new X,Oa=new Ei,ss=new Pt,Fu=new X,dc=new X,fL=new X,pL=new Ei,Ry=new X(1,0,0),Py=new X(0,1,0),Iy=new X(0,0,1),mL={type:"added"},Ly={type:"removed"};class Yt extends Ms{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:dL++}),this.uuid=Gi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Yt.DEFAULT_UP.clone();const e=new X,t=new hh,n=new Ei,i=new X(1,1,1);function r(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Pt},normalMatrix:{value:new Ot}}),this.matrix=new Pt,this.matrixWorld=new Pt,this.matrixAutoUpdate=Yt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Yt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new mf,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Oa.setFromAxisAngle(e,t),this.quaternion.multiply(Oa),this}rotateOnWorldAxis(e,t){return Oa.setFromAxisAngle(e,t),this.quaternion.premultiply(Oa),this}rotateX(e){return this.rotateOnAxis(Ry,e)}rotateY(e){return this.rotateOnAxis(Py,e)}rotateZ(e){return this.rotateOnAxis(Iy,e)}translateOnAxis(e,t){return Cy.copy(e).applyQuaternion(this.quaternion),this.position.add(Cy.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ry,e)}translateY(e){return this.translateOnAxis(Py,e)}translateZ(e){return this.translateOnAxis(Iy,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ss.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Fu.copy(e):Fu.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),dc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ss.lookAt(dc,Fu,this.up):ss.lookAt(Fu,dc,this.up),this.quaternion.setFromRotationMatrix(ss),i&&(ss.extractRotation(i.matrixWorld),Oa.setFromRotationMatrix(ss),this.quaternion.premultiply(Oa.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(mL)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Ly)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Ly)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ss.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ss.multiply(e.parent.matrixWorld)),e.applyMatrix4(ss),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectsByProperty(e,t);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dc,e,fL),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dc,pL,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const r=t[n];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let r=0,o=i.length;r<o;r++){const a=i[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let h=0,u=l.length;h<u;h++){const f=l[h];r(e.shapes,f)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,h=this.material.length;l<h;l++)a.push(r(e.materials,this.material[l]));i.material=a}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),h=o(e.textures),u=o(e.images),f=o(e.shapes),p=o(e.skeletons),m=o(e.animations),g=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),h.length>0&&(n.textures=h),u.length>0&&(n.images=u),f.length>0&&(n.shapes=f),p.length>0&&(n.skeletons=p),m.length>0&&(n.animations=m),g.length>0&&(n.nodes=g)}return n.object=i,n;function o(a){const l=[];for(const h in a){const u=a[h];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Yt.DEFAULT_UP=new X(0,1,0);Yt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Yt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const mr=new X,os=new X,hm=new X,as=new X,Da=new X,Ua=new X,Ny=new X,um=new X,dm=new X,fm=new X;let Ou=!1,Wo=class Do{constructor(e=new X,t=new X,n=new X){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),mr.subVectors(e,t),i.cross(mr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){mr.subVectors(i,t),os.subVectors(n,t),hm.subVectors(e,t);const o=mr.dot(mr),a=mr.dot(os),l=mr.dot(hm),h=os.dot(os),u=os.dot(hm),f=o*h-a*a;if(f===0)return r.set(-2,-1,-1);const p=1/f,m=(h*l-a*u)*p,g=(o*u-a*l)*p;return r.set(1-m-g,g,m)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,as),as.x>=0&&as.y>=0&&as.x+as.y<=1}static getUV(e,t,n,i,r,o,a,l){return Ou===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Ou=!0),this.getInterpolation(e,t,n,i,r,o,a,l)}static getInterpolation(e,t,n,i,r,o,a,l){return this.getBarycoord(e,t,n,i,as),l.setScalar(0),l.addScaledVector(r,as.x),l.addScaledVector(o,as.y),l.addScaledVector(a,as.z),l}static isFrontFacing(e,t,n,i){return mr.subVectors(n,t),os.subVectors(e,t),mr.cross(os).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return mr.subVectors(this.c,this.b),os.subVectors(this.a,this.b),mr.cross(os).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Do.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Do.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Ou===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Ou=!0),Do.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}getInterpolation(e,t,n,i,r){return Do.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Do.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Do.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,a;Da.subVectors(i,n),Ua.subVectors(r,n),um.subVectors(e,n);const l=Da.dot(um),h=Ua.dot(um);if(l<=0&&h<=0)return t.copy(n);dm.subVectors(e,i);const u=Da.dot(dm),f=Ua.dot(dm);if(u>=0&&f<=u)return t.copy(i);const p=l*f-u*h;if(p<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(Da,o);fm.subVectors(e,r);const m=Da.dot(fm),g=Ua.dot(fm);if(g>=0&&m<=g)return t.copy(r);const v=m*h-l*g;if(v<=0&&h>=0&&g<=0)return a=h/(h-g),t.copy(n).addScaledVector(Ua,a);const y=u*g-m*f;if(y<=0&&f-u>=0&&m-g>=0)return Ny.subVectors(r,i),a=(f-u)/(f-u+(m-g)),t.copy(i).addScaledVector(Ny,a);const x=1/(y+v+p);return o=v*x,a=p*x,t.copy(n).addScaledVector(Da,o).addScaledVector(Ua,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},gL=0;class ri extends Ms{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:gL++}),this.uuid=Gi(),this.name="",this.type="Material",this.blending=Yo,this.side=ys,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=xg,this.blendDst=yg,this.blendEquation=zo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$d,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ew,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Hd,this.stencilZFail=Hd,this.stencilZPass=Hd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Yo&&(n.blending=this.blending),this.side!==ys&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(n.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=i(e.textures),o=i(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const uw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gr={h:0,s:0,l:0},Du={h:0,s:0,l:0};function pm(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}class ct{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=It){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ir.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=ir.workingColorSpace){return this.r=e,this.g=t,this.b=n,ir.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=ir.workingColorSpace){if(e=Pg(e,1),t=mn(t,0,1),n=mn(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=pm(o,r,e+1/3),this.g=pm(o,r,e),this.b=pm(o,r,e-1/3)}return ir.toWorkingColorSpace(this,i),this}setStyle(e,t=It){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=It){const n=uw[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ml(e.r),this.g=ml(e.g),this.b=ml(e.b),this}copyLinearToSRGB(e){return this.r=nm(e.r),this.g=nm(e.g),this.b=nm(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=It){return ir.fromWorkingColorSpace(ei.copy(this),e),Math.round(mn(ei.r*255,0,255))*65536+Math.round(mn(ei.g*255,0,255))*256+Math.round(mn(ei.b*255,0,255))}getHexString(e=It){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ir.workingColorSpace){ir.fromWorkingColorSpace(ei.copy(this),t);const n=ei.r,i=ei.g,r=ei.b,o=Math.max(n,i,r),a=Math.min(n,i,r);let l,h;const u=(a+o)/2;if(a===o)l=0,h=0;else{const f=o-a;switch(h=u<=.5?f/(o+a):f/(2-o-a),o){case n:l=(i-r)/f+(i<r?6:0);break;case i:l=(r-n)/f+2;break;case r:l=(n-i)/f+4;break}l/=6}return e.h=l,e.s=h,e.l=u,e}getRGB(e,t=ir.workingColorSpace){return ir.fromWorkingColorSpace(ei.copy(this),t),e.r=ei.r,e.g=ei.g,e.b=ei.b,e}getStyle(e=It){ir.fromWorkingColorSpace(ei.copy(this),e);const t=ei.r,n=ei.g,i=ei.b;return e!==It?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(gr),gr.h+=e,gr.s+=t,gr.l+=n,this.setHSL(gr.h,gr.s,gr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(gr),e.getHSL(Du);const n=Fc(gr.h,Du.h,t),i=Fc(gr.s,Du.s,t),r=Fc(gr.l,Du.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ei=new ct;ct.NAMES=uw;class ho extends ri{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ch,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ps=_L();function _L(){const s=new ArrayBuffer(4),e=new Float32Array(s),t=new Uint32Array(s),n=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const h=l-127;h<-27?(n[l]=0,n[l|256]=32768,i[l]=24,i[l|256]=24):h<-14?(n[l]=1024>>-h-14,n[l|256]=1024>>-h-14|32768,i[l]=-h-1,i[l|256]=-h-1):h<=15?(n[l]=h+15<<10,n[l|256]=h+15<<10|32768,i[l]=13,i[l|256]=13):h<128?(n[l]=31744,n[l|256]=64512,i[l]=24,i[l|256]=24):(n[l]=31744,n[l|256]=64512,i[l]=13,i[l|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let h=l<<13,u=0;for(;!(h&8388608);)h<<=1,u-=8388608;h&=-8388609,u+=947912704,r[l]=h|u}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:r,exponentTable:o,offsetTable:a}}function Mi(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=mn(s,-65504,65504),ps.floatView[0]=s;const e=ps.uint32View[0],t=e>>23&511;return ps.baseTable[t]+((e&8388607)>>ps.shiftTable[t])}function Ic(s){const e=s>>10;return ps.uint32View[0]=ps.mantissaTable[ps.offsetTable[e]+(s&1023)]+ps.exponentTable[e],ps.floatView[0]}const xL={toHalfFloat:Mi,fromHalfFloat:Ic},En=new X,Uu=new He;class tn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Yc,this.updateRange={offset:0,count:-1},this.gpuType=Dr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Uu.fromBufferAttribute(this,t),Uu.applyMatrix3(e),this.setXY(t,Uu.x,Uu.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)En.fromBufferAttribute(this,t),En.applyMatrix3(e),this.setXYZ(t,En.x,En.y,En.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)En.fromBufferAttribute(this,t),En.applyMatrix4(e),this.setXYZ(t,En.x,En.y,En.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)En.fromBufferAttribute(this,t),En.applyNormalMatrix(e),this.setXYZ(t,En.x,En.y,En.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)En.fromBufferAttribute(this,t),En.transformDirection(e),this.setXYZ(t,En.x,En.y,En.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ki(t,this.array)),t}setX(e,t){return this.normalized&&(t=Dt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ki(t,this.array)),t}setY(e,t){return this.normalized&&(t=Dt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ki(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Dt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ki(t,this.array)),t}setW(e,t){return this.normalized&&(t=Dt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array),i=Dt(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array),i=Dt(i,this.array),r=Dt(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Yc&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class yL extends tn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class vL extends tn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class SL extends tn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class bL extends tn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Ng extends tn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class wL extends tn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Fg extends tn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class ML extends tn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Ic(this.array[e*this.itemSize]);return this.normalized&&(t=ki(t,this.array)),t}setX(e,t){return this.normalized&&(t=Dt(t,this.array)),this.array[e*this.itemSize]=Mi(t),this}getY(e){let t=Ic(this.array[e*this.itemSize+1]);return this.normalized&&(t=ki(t,this.array)),t}setY(e,t){return this.normalized&&(t=Dt(t,this.array)),this.array[e*this.itemSize+1]=Mi(t),this}getZ(e){let t=Ic(this.array[e*this.itemSize+2]);return this.normalized&&(t=ki(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Dt(t,this.array)),this.array[e*this.itemSize+2]=Mi(t),this}getW(e){let t=Ic(this.array[e*this.itemSize+3]);return this.normalized&&(t=ki(t,this.array)),t}setW(e,t){return this.normalized&&(t=Dt(t,this.array)),this.array[e*this.itemSize+3]=Mi(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array)),this.array[e+0]=Mi(t),this.array[e+1]=Mi(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array),i=Dt(i,this.array)),this.array[e+0]=Mi(t),this.array[e+1]=Mi(n),this.array[e+2]=Mi(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array),i=Dt(i,this.array),r=Dt(r,this.array)),this.array[e+0]=Mi(t),this.array[e+1]=Mi(n),this.array[e+2]=Mi(i),this.array[e+3]=Mi(r),this}}class dt extends tn{constructor(e,t,n){super(new Float32Array(e),t,n)}}class EL extends tn{constructor(e,t,n){super(new Float64Array(e),t,n)}}let AL=0;const nr=new Pt,mm=new Yt,Ba=new X,Di=new Gr,fc=new Gr,kn=new X;class Bt extends Ms{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:AL++}),this.uuid=Gi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(hw(e)?Fg:Ng)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new Ot().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return nr.makeRotationFromQuaternion(e),this.applyMatrix4(nr),this}rotateX(e){return nr.makeRotationX(e),this.applyMatrix4(nr),this}rotateY(e){return nr.makeRotationY(e),this.applyMatrix4(nr),this}rotateZ(e){return nr.makeRotationZ(e),this.applyMatrix4(nr),this}translate(e,t,n){return nr.makeTranslation(e,t,n),this.applyMatrix4(nr),this}scale(e,t,n){return nr.makeScale(e,t,n),this.applyMatrix4(nr),this}lookAt(e){return mm.lookAt(e),mm.updateMatrix(),this.applyMatrix4(mm.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ba).negate(),this.translate(Ba.x,Ba.y,Ba.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new dt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Gr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new X(-1/0,-1/0,-1/0),new X(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const r=t[n];Di.setFromBufferAttribute(r),this.morphTargetsRelative?(kn.addVectors(this.boundingBox.min,Di.min),this.boundingBox.expandByPoint(kn),kn.addVectors(this.boundingBox.max,Di.max),this.boundingBox.expandByPoint(kn)):(this.boundingBox.expandByPoint(Di.min),this.boundingBox.expandByPoint(Di.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new X,1/0);return}if(e){const n=this.boundingSphere.center;if(Di.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];fc.setFromBufferAttribute(a),this.morphTargetsRelative?(kn.addVectors(Di.min,fc.min),Di.expandByPoint(kn),kn.addVectors(Di.max,fc.max),Di.expandByPoint(kn)):(Di.expandByPoint(fc.min),Di.expandByPoint(fc.max))}Di.getCenter(n);let i=0;for(let r=0,o=e.count;r<o;r++)kn.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(kn));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let h=0,u=a.count;h<u;h++)kn.fromBufferAttribute(a,h),l&&(Ba.fromBufferAttribute(e,h),kn.add(Ba)),i=Math.max(i,n.distanceToSquared(kn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new tn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,h=[],u=[];for(let R=0;R<a;R++)h[R]=new X,u[R]=new X;const f=new X,p=new X,m=new X,g=new He,v=new He,y=new He,x=new X,w=new X;function S(R,G,K){f.fromArray(i,R*3),p.fromArray(i,G*3),m.fromArray(i,K*3),g.fromArray(o,R*2),v.fromArray(o,G*2),y.fromArray(o,K*2),p.sub(f),m.sub(f),v.sub(g),y.sub(g);const Z=1/(v.x*y.y-y.x*v.y);isFinite(Z)&&(x.copy(p).multiplyScalar(y.y).addScaledVector(m,-v.y).multiplyScalar(Z),w.copy(m).multiplyScalar(v.x).addScaledVector(p,-y.x).multiplyScalar(Z),h[R].add(x),h[G].add(x),h[K].add(x),u[R].add(w),u[G].add(w),u[K].add(w))}let E=this.groups;E.length===0&&(E=[{start:0,count:n.length}]);for(let R=0,G=E.length;R<G;++R){const K=E[R],Z=K.start,O=K.count;for(let V=Z,j=Z+O;V<j;V+=3)S(n[V+0],n[V+1],n[V+2])}const A=new X,C=new X,P=new X,L=new X;function T(R){P.fromArray(r,R*3),L.copy(P);const G=h[R];A.copy(G),A.sub(P.multiplyScalar(P.dot(G))).normalize(),C.crossVectors(L,G);const Z=C.dot(u[R])<0?-1:1;l[R*4]=A.x,l[R*4+1]=A.y,l[R*4+2]=A.z,l[R*4+3]=Z}for(let R=0,G=E.length;R<G;++R){const K=E[R],Z=K.start,O=K.count;for(let V=Z,j=Z+O;V<j;V+=3)T(n[V+0]),T(n[V+1]),T(n[V+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new tn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let p=0,m=n.count;p<m;p++)n.setXYZ(p,0,0,0);const i=new X,r=new X,o=new X,a=new X,l=new X,h=new X,u=new X,f=new X;if(e)for(let p=0,m=e.count;p<m;p+=3){const g=e.getX(p+0),v=e.getX(p+1),y=e.getX(p+2);i.fromBufferAttribute(t,g),r.fromBufferAttribute(t,v),o.fromBufferAttribute(t,y),u.subVectors(o,r),f.subVectors(i,r),u.cross(f),a.fromBufferAttribute(n,g),l.fromBufferAttribute(n,v),h.fromBufferAttribute(n,y),a.add(u),l.add(u),h.add(u),n.setXYZ(g,a.x,a.y,a.z),n.setXYZ(v,l.x,l.y,l.z),n.setXYZ(y,h.x,h.y,h.z)}else for(let p=0,m=t.count;p<m;p+=3)i.fromBufferAttribute(t,p+0),r.fromBufferAttribute(t,p+1),o.fromBufferAttribute(t,p+2),u.subVectors(o,r),f.subVectors(i,r),u.cross(f),n.setXYZ(p+0,u.x,u.y,u.z),n.setXYZ(p+1,u.x,u.y,u.z),n.setXYZ(p+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)kn.fromBufferAttribute(e,t),kn.normalize(),e.setXYZ(t,kn.x,kn.y,kn.z)}toNonIndexed(){function e(a,l){const h=a.array,u=a.itemSize,f=a.normalized,p=new h.constructor(l.length*u);let m=0,g=0;for(let v=0,y=l.length;v<y;v++){a.isInterleavedBufferAttribute?m=l[v]*a.data.stride+a.offset:m=l[v]*u;for(let x=0;x<u;x++)p[g++]=h[m++]}return new tn(p,u,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Bt,n=this.index.array,i=this.attributes;for(const a in i){const l=i[a],h=e(l,n);t.setAttribute(a,h)}const r=this.morphAttributes;for(const a in r){const l=[],h=r[a];for(let u=0,f=h.length;u<f;u++){const p=h[u],m=e(p,n);l.push(m)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const h=o[a];t.addGroup(h.start,h.count,h.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const h in l)l[h]!==void 0&&(e[h]=l[h]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const h=n[l];e.data.attributes[l]=h.toJSON(e.data)}const i={};let r=!1;for(const l in this.morphAttributes){const h=this.morphAttributes[l],u=[];for(let f=0,p=h.length;f<p;f++){const m=h[f];u.push(m.toJSON(e.data))}u.length>0&&(i[l]=u,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const i=e.attributes;for(const h in i){const u=i[h];this.setAttribute(h,u.clone(t))}const r=e.morphAttributes;for(const h in r){const u=[],f=r[h];for(let p=0,m=f.length;p<m;p++)u.push(f[p].clone(t));this.morphAttributes[h]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let h=0,u=o.length;h<u;h++){const f=o[h];this.addGroup(f.start,f.count,f.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Fy=new Pt,To=new Tl,Bu=new wr,Oy=new X,za=new X,Va=new X,ka=new X,gm=new X,zu=new X,Vu=new He,ku=new He,Gu=new He,Dy=new X,Uy=new X,By=new X,Hu=new X,Wu=new X;let qn=class extends Yt{constructor(e=new Bt,t=new ho){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(r&&a){zu.set(0,0,0);for(let l=0,h=r.length;l<h;l++){const u=a[l],f=r[l];u!==0&&(gm.fromBufferAttribute(f,e),o?zu.addScaledVector(gm,u):zu.addScaledVector(gm.sub(t),u))}t.add(zu)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Bu.copy(n.boundingSphere),Bu.applyMatrix4(r),To.copy(e.ray).recast(e.near),!(Bu.containsPoint(To.origin)===!1&&(To.intersectSphere(Bu,Oy)===null||To.origin.distanceToSquared(Oy)>(e.far-e.near)**2))&&(Fy.copy(r).invert(),To.copy(e.ray).applyMatrix4(Fy),!(n.boundingBox!==null&&To.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,To)))}_computeIntersections(e,t,n){let i;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,h=r.attributes.uv,u=r.attributes.uv1,f=r.attributes.normal,p=r.groups,m=r.drawRange;if(a!==null)if(Array.isArray(o))for(let g=0,v=p.length;g<v;g++){const y=p[g],x=o[y.materialIndex],w=Math.max(y.start,m.start),S=Math.min(a.count,Math.min(y.start+y.count,m.start+m.count));for(let E=w,A=S;E<A;E+=3){const C=a.getX(E),P=a.getX(E+1),L=a.getX(E+2);i=Xu(this,x,e,n,h,u,f,C,P,L),i&&(i.faceIndex=Math.floor(E/3),i.face.materialIndex=y.materialIndex,t.push(i))}}else{const g=Math.max(0,m.start),v=Math.min(a.count,m.start+m.count);for(let y=g,x=v;y<x;y+=3){const w=a.getX(y),S=a.getX(y+1),E=a.getX(y+2);i=Xu(this,o,e,n,h,u,f,w,S,E),i&&(i.faceIndex=Math.floor(y/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(o))for(let g=0,v=p.length;g<v;g++){const y=p[g],x=o[y.materialIndex],w=Math.max(y.start,m.start),S=Math.min(l.count,Math.min(y.start+y.count,m.start+m.count));for(let E=w,A=S;E<A;E+=3){const C=E,P=E+1,L=E+2;i=Xu(this,x,e,n,h,u,f,C,P,L),i&&(i.faceIndex=Math.floor(E/3),i.face.materialIndex=y.materialIndex,t.push(i))}}else{const g=Math.max(0,m.start),v=Math.min(l.count,m.start+m.count);for(let y=g,x=v;y<x;y+=3){const w=y,S=y+1,E=y+2;i=Xu(this,o,e,n,h,u,f,w,S,E),i&&(i.faceIndex=Math.floor(y/3),t.push(i))}}}};function TL(s,e,t,n,i,r,o,a){let l;if(e.side===di?l=n.intersectTriangle(o,r,i,!0,a):l=n.intersectTriangle(i,r,o,e.side===ys,a),l===null)return null;Wu.copy(a),Wu.applyMatrix4(s.matrixWorld);const h=t.ray.origin.distanceTo(Wu);return h<t.near||h>t.far?null:{distance:h,point:Wu.clone(),object:s}}function Xu(s,e,t,n,i,r,o,a,l,h){s.getVertexPosition(a,za),s.getVertexPosition(l,Va),s.getVertexPosition(h,ka);const u=TL(s,e,t,n,za,Va,ka,Hu);if(u){i&&(Vu.fromBufferAttribute(i,a),ku.fromBufferAttribute(i,l),Gu.fromBufferAttribute(i,h),u.uv=Wo.getInterpolation(Hu,za,Va,ka,Vu,ku,Gu,new He)),r&&(Vu.fromBufferAttribute(r,a),ku.fromBufferAttribute(r,l),Gu.fromBufferAttribute(r,h),u.uv1=Wo.getInterpolation(Hu,za,Va,ka,Vu,ku,Gu,new He),u.uv2=u.uv1),o&&(Dy.fromBufferAttribute(o,a),Uy.fromBufferAttribute(o,l),By.fromBufferAttribute(o,h),u.normal=Wo.getInterpolation(Hu,za,Va,ka,Dy,Uy,By,new X),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const f={a,b:l,c:h,normal:new X,materialIndex:0};Wo.getNormal(za,Va,ka,f.normal),u.face=f}return u}class uo extends Bt{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const a=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const l=[],h=[],u=[],f=[];let p=0,m=0;g("z","y","x",-1,-1,n,t,e,o,r,0),g("z","y","x",1,-1,n,t,-e,o,r,1),g("x","z","y",1,1,e,n,t,i,o,2),g("x","z","y",1,-1,e,n,-t,i,o,3),g("x","y","z",1,-1,e,t,n,i,r,4),g("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(l),this.setAttribute("position",new dt(h,3)),this.setAttribute("normal",new dt(u,3)),this.setAttribute("uv",new dt(f,2));function g(v,y,x,w,S,E,A,C,P,L,T){const R=E/P,G=A/L,K=E/2,Z=A/2,O=C/2,V=P+1,j=L+1;let q=0,J=0;const se=new X;for(let _e=0;_e<j;_e++){const Re=_e*G-Z;for(let ae=0;ae<V;ae++){const ve=ae*R-K;se[v]=ve*w,se[y]=Re*S,se[x]=O,h.push(se.x,se.y,se.z),se[v]=0,se[y]=0,se[x]=C>0?1:-1,u.push(se.x,se.y,se.z),f.push(ae/P),f.push(1-_e/L),q+=1}}for(let _e=0;_e<L;_e++)for(let Re=0;Re<P;Re++){const ae=p+Re+V*_e,ve=p+Re+V*(_e+1),oe=p+(Re+1)+V*(_e+1),Ce=p+(Re+1)+V*_e;l.push(ae,ve,Ce),l.push(ve,oe,Ce),J+=6}a.addGroup(m,J,T),m+=J,p+=q}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function bl(s){const e={};for(const t in s){e[t]={};for(const n in s[t]){const i=s[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function ui(s){const e={};for(let t=0;t<s.length;t++){const n=bl(s[t]);for(const i in n)e[i]=n[i]}return e}function CL(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}function dw(s){return s.getRenderTarget()===null?s.outputColorSpace:yr}const fw={clone:bl,merge:ui};var RL=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,PL=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class kr extends ri{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=RL,this.fragmentShader=PL,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=bl(e.uniforms),this.uniformsGroups=CL(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class gf extends Yt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Pt,this.projectionMatrix=new Pt,this.projectionMatrixInverse=new Pt,this.coordinateSystem=Ur}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class jn extends gf{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Sl*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(jo*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Sl*2*Math.atan(Math.tan(jo*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(jo*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,h=o.fullHeight;r+=o.offsetX*i/l,t-=o.offsetY*n/h,i*=o.width/l,n*=o.height/h}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ga=-90,Ha=1;class pw extends Yt{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null;const i=new jn(Ga,Ha,e,t);i.layers=this.layers,this.add(i);const r=new jn(Ga,Ha,e,t);r.layers=this.layers,this.add(r);const o=new jn(Ga,Ha,e,t);o.layers=this.layers,this.add(o);const a=new jn(Ga,Ha,e,t);a.layers=this.layers,this.add(a);const l=new jn(Ga,Ha,e,t);l.layers=this.layers,this.add(l);const h=new jn(Ga,Ha,e,t);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,o,a,l]=t;for(const h of t)this.remove(h);if(e===Ur)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===jc)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of t)this.add(h),h.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,r,o,a,l,h]=this.children,u=e.getRenderTarget(),f=e.toneMapping,p=e.xr.enabled;e.toneMapping=Br,e.xr.enabled=!1;const m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=m,e.setRenderTarget(n,5),e.render(t,h),e.setRenderTarget(u),e.toneMapping=f,e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class uh extends bn{constructor(e,t,n,i,r,o,a,l,h,u){e=e!==void 0?e:[],t=t!==void 0?t:ro,super(e,t,n,i,r,o,a,l,h,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class mw extends vr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];t.encoding!==void 0&&(Oc("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===to?It:no),this.texture=new uh(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Sn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new uo(5,5,5),r=new kr({name:"CubemapFromEquirect",uniforms:bl(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:di,blending:_s});r.uniforms.tEquirect.value=t;const o=new qn(i,r),a=t.minFilter;return t.minFilter===oo&&(t.minFilter=Sn),new pw(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(r)}}const _m=new X,IL=new X,LL=new Ot;class $s{constructor(e=new X(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=_m.subVectors(n,t).cross(IL.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(_m),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||LL.getNormalMatrix(e),i=this.coplanarPoint(_m).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Co=new wr,Yu=new X;class _f{constructor(e=new $s,t=new $s,n=new $s,i=new $s,r=new $s,o=new $s){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Ur){const n=this.planes,i=e.elements,r=i[0],o=i[1],a=i[2],l=i[3],h=i[4],u=i[5],f=i[6],p=i[7],m=i[8],g=i[9],v=i[10],y=i[11],x=i[12],w=i[13],S=i[14],E=i[15];if(n[0].setComponents(l-r,p-h,y-m,E-x).normalize(),n[1].setComponents(l+r,p+h,y+m,E+x).normalize(),n[2].setComponents(l+o,p+u,y+g,E+w).normalize(),n[3].setComponents(l-o,p-u,y-g,E-w).normalize(),n[4].setComponents(l-a,p-f,y-v,E-S).normalize(),t===Ur)n[5].setComponents(l+a,p+f,y+v,E+S).normalize();else if(t===jc)n[5].setComponents(a,f,v,S).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Co.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Co.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Co)}intersectsSprite(e){return Co.center.set(0,0,0),Co.radius=.7071067811865476,Co.applyMatrix4(e.matrixWorld),this.intersectsSphere(Co)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Yu.x=i.normal.x>0?e.max.x:e.min.x,Yu.y=i.normal.y>0?e.max.y:e.min.y,Yu.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Yu)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function gw(){let s=null,e=!1,t=null,n=null;function i(r,o){t(r,o),n=s.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=s.requestAnimationFrame(i),e=!0)},stop:function(){s.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){s=r}}}function NL(s,e){const t=e.isWebGL2,n=new WeakMap;function i(h,u){const f=h.array,p=h.usage,m=s.createBuffer();s.bindBuffer(u,m),s.bufferData(u,f,p),h.onUploadCallback();let g;if(f instanceof Float32Array)g=s.FLOAT;else if(f instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(t)g=s.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=s.UNSIGNED_SHORT;else if(f instanceof Int16Array)g=s.SHORT;else if(f instanceof Uint32Array)g=s.UNSIGNED_INT;else if(f instanceof Int32Array)g=s.INT;else if(f instanceof Int8Array)g=s.BYTE;else if(f instanceof Uint8Array)g=s.UNSIGNED_BYTE;else if(f instanceof Uint8ClampedArray)g=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);return{buffer:m,type:g,bytesPerElement:f.BYTES_PER_ELEMENT,version:h.version}}function r(h,u,f){const p=u.array,m=u.updateRange;s.bindBuffer(f,h),m.count===-1?s.bufferSubData(f,0,p):(t?s.bufferSubData(f,m.offset*p.BYTES_PER_ELEMENT,p,m.offset,m.count):s.bufferSubData(f,m.offset*p.BYTES_PER_ELEMENT,p.subarray(m.offset,m.offset+m.count)),m.count=-1),u.onUploadCallback()}function o(h){return h.isInterleavedBufferAttribute&&(h=h.data),n.get(h)}function a(h){h.isInterleavedBufferAttribute&&(h=h.data);const u=n.get(h);u&&(s.deleteBuffer(u.buffer),n.delete(h))}function l(h,u){if(h.isGLBufferAttribute){const p=n.get(h);(!p||p.version<h.version)&&n.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);const f=n.get(h);f===void 0?n.set(h,i(h,u)):f.version<h.version&&(r(f.buffer,h,u),f.version=h.version)}return{get:o,remove:a,update:l}}class Cl extends Bt{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,a=Math.floor(n),l=Math.floor(i),h=a+1,u=l+1,f=e/a,p=t/l,m=[],g=[],v=[],y=[];for(let x=0;x<u;x++){const w=x*p-o;for(let S=0;S<h;S++){const E=S*f-r;g.push(E,-w,0),v.push(0,0,1),y.push(S/a),y.push(1-x/l)}}for(let x=0;x<l;x++)for(let w=0;w<a;w++){const S=w+h*x,E=w+h*(x+1),A=w+1+h*(x+1),C=w+1+h*x;m.push(S,E,C),m.push(E,A,C)}this.setIndex(m),this.setAttribute("position",new dt(g,3)),this.setAttribute("normal",new dt(v,3)),this.setAttribute("uv",new dt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cl(e.width,e.height,e.widthSegments,e.heightSegments)}}var FL=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,OL=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,DL=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,UL=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,BL=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,zL=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,VL="vec3 transformed = vec3( position );",kL=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,GL=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,HL=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,WL=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,XL=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,YL=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,jL=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,qL=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,$L=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,ZL=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,KL=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,JL=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,QL=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,eN=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,tN=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,nN=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,iN=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,rN=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,sN=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,oN="gl_FragColor = linearToOutputTexel( gl_FragColor );",aN=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,lN=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,cN=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,hN=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,uN=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,dN=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fN=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,pN=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,mN=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,gN=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,_N=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,xN=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,yN=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,vN=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,SN=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,bN=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,wN=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,MN=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,EN=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,AN=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,TN=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,CN=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,RN=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,PN=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,IN=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,LN=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,NN=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,FN=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ON=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,DN=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,UN=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,BN=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,zN=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,VN=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,kN=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,GN=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,HN=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,WN=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,XN=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,YN=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,jN=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,qN=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,$N=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ZN=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,KN=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,JN=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,QN=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,eF=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,tF=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,nF=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,iF=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,rF=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,sF=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,oF=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,aF=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,lF=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,cF=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,hF=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,uF=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,dF=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,fF=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,pF=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,mF=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,gF=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,_F=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,xF=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,yF=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,vF=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,SF=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,bF=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,wF=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,MF=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,EF=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,AF=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,TF=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,CF=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const RF=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,PF=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,IF=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,LF=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,NF=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,FF=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,OF=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,DF=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,UF=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,BF=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,zF=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,VF=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,kF=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,GF=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,HF=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,WF=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,XF=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,YF=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jF=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,qF=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$F=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,ZF=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,KF=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,JF=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QF=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,eO=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tO=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nO=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,iO=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,rO=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,sO=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,oO=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,aO=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,lO=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ft={alphamap_fragment:FL,alphamap_pars_fragment:OL,alphatest_fragment:DL,alphatest_pars_fragment:UL,aomap_fragment:BL,aomap_pars_fragment:zL,begin_vertex:VL,beginnormal_vertex:kL,bsdfs:GL,iridescence_fragment:HL,bumpmap_pars_fragment:WL,clipping_planes_fragment:XL,clipping_planes_pars_fragment:YL,clipping_planes_pars_vertex:jL,clipping_planes_vertex:qL,color_fragment:$L,color_pars_fragment:ZL,color_pars_vertex:KL,color_vertex:JL,common:QL,cube_uv_reflection_fragment:eN,defaultnormal_vertex:tN,displacementmap_pars_vertex:nN,displacementmap_vertex:iN,emissivemap_fragment:rN,emissivemap_pars_fragment:sN,encodings_fragment:oN,encodings_pars_fragment:aN,envmap_fragment:lN,envmap_common_pars_fragment:cN,envmap_pars_fragment:hN,envmap_pars_vertex:uN,envmap_physical_pars_fragment:wN,envmap_vertex:dN,fog_vertex:fN,fog_pars_vertex:pN,fog_fragment:mN,fog_pars_fragment:gN,gradientmap_pars_fragment:_N,lightmap_fragment:xN,lightmap_pars_fragment:yN,lights_lambert_fragment:vN,lights_lambert_pars_fragment:SN,lights_pars_begin:bN,lights_toon_fragment:MN,lights_toon_pars_fragment:EN,lights_phong_fragment:AN,lights_phong_pars_fragment:TN,lights_physical_fragment:CN,lights_physical_pars_fragment:RN,lights_fragment_begin:PN,lights_fragment_maps:IN,lights_fragment_end:LN,logdepthbuf_fragment:NN,logdepthbuf_pars_fragment:FN,logdepthbuf_pars_vertex:ON,logdepthbuf_vertex:DN,map_fragment:UN,map_pars_fragment:BN,map_particle_fragment:zN,map_particle_pars_fragment:VN,metalnessmap_fragment:kN,metalnessmap_pars_fragment:GN,morphcolor_vertex:HN,morphnormal_vertex:WN,morphtarget_pars_vertex:XN,morphtarget_vertex:YN,normal_fragment_begin:jN,normal_fragment_maps:qN,normal_pars_fragment:$N,normal_pars_vertex:ZN,normal_vertex:KN,normalmap_pars_fragment:JN,clearcoat_normal_fragment_begin:QN,clearcoat_normal_fragment_maps:eF,clearcoat_pars_fragment:tF,iridescence_pars_fragment:nF,output_fragment:iF,packing:rF,premultiplied_alpha_fragment:sF,project_vertex:oF,dithering_fragment:aF,dithering_pars_fragment:lF,roughnessmap_fragment:cF,roughnessmap_pars_fragment:hF,shadowmap_pars_fragment:uF,shadowmap_pars_vertex:dF,shadowmap_vertex:fF,shadowmask_pars_fragment:pF,skinbase_vertex:mF,skinning_pars_vertex:gF,skinning_vertex:_F,skinnormal_vertex:xF,specularmap_fragment:yF,specularmap_pars_fragment:vF,tonemapping_fragment:SF,tonemapping_pars_fragment:bF,transmission_fragment:wF,transmission_pars_fragment:MF,uv_pars_fragment:EF,uv_pars_vertex:AF,uv_vertex:TF,worldpos_vertex:CF,background_vert:RF,background_frag:PF,backgroundCube_vert:IF,backgroundCube_frag:LF,cube_vert:NF,cube_frag:FF,depth_vert:OF,depth_frag:DF,distanceRGBA_vert:UF,distanceRGBA_frag:BF,equirect_vert:zF,equirect_frag:VF,linedashed_vert:kF,linedashed_frag:GF,meshbasic_vert:HF,meshbasic_frag:WF,meshlambert_vert:XF,meshlambert_frag:YF,meshmatcap_vert:jF,meshmatcap_frag:qF,meshnormal_vert:$F,meshnormal_frag:ZF,meshphong_vert:KF,meshphong_frag:JF,meshphysical_vert:QF,meshphysical_frag:eO,meshtoon_vert:tO,meshtoon_frag:nO,points_vert:iO,points_frag:rO,shadow_vert:sO,shadow_frag:oO,sprite_vert:aO,sprite_frag:lO},tt={common:{diffuse:{value:new ct(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ot},alphaMap:{value:null},alphaMapTransform:{value:new Ot},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ot}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ot}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ot}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ot},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ot},normalScale:{value:new He(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ot},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ot}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ot}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ot}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ct(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ct(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ot},alphaTest:{value:0},uvTransform:{value:new Ot}},sprite:{diffuse:{value:new ct(16777215)},opacity:{value:1},center:{value:new He(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ot},alphaMap:{value:null},alphaMapTransform:{value:new Ot},alphaTest:{value:0}}},xr={basic:{uniforms:ui([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.fog]),vertexShader:Ft.meshbasic_vert,fragmentShader:Ft.meshbasic_frag},lambert:{uniforms:ui([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new ct(0)}}]),vertexShader:Ft.meshlambert_vert,fragmentShader:Ft.meshlambert_frag},phong:{uniforms:ui([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new ct(0)},specular:{value:new ct(1118481)},shininess:{value:30}}]),vertexShader:Ft.meshphong_vert,fragmentShader:Ft.meshphong_frag},standard:{uniforms:ui([tt.common,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.roughnessmap,tt.metalnessmap,tt.fog,tt.lights,{emissive:{value:new ct(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag},toon:{uniforms:ui([tt.common,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.gradientmap,tt.fog,tt.lights,{emissive:{value:new ct(0)}}]),vertexShader:Ft.meshtoon_vert,fragmentShader:Ft.meshtoon_frag},matcap:{uniforms:ui([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,{matcap:{value:null}}]),vertexShader:Ft.meshmatcap_vert,fragmentShader:Ft.meshmatcap_frag},points:{uniforms:ui([tt.points,tt.fog]),vertexShader:Ft.points_vert,fragmentShader:Ft.points_frag},dashed:{uniforms:ui([tt.common,tt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ft.linedashed_vert,fragmentShader:Ft.linedashed_frag},depth:{uniforms:ui([tt.common,tt.displacementmap]),vertexShader:Ft.depth_vert,fragmentShader:Ft.depth_frag},normal:{uniforms:ui([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,{opacity:{value:1}}]),vertexShader:Ft.meshnormal_vert,fragmentShader:Ft.meshnormal_frag},sprite:{uniforms:ui([tt.sprite,tt.fog]),vertexShader:Ft.sprite_vert,fragmentShader:Ft.sprite_frag},background:{uniforms:{uvTransform:{value:new Ot},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ft.background_vert,fragmentShader:Ft.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ft.backgroundCube_vert,fragmentShader:Ft.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ft.cube_vert,fragmentShader:Ft.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ft.equirect_vert,fragmentShader:Ft.equirect_frag},distanceRGBA:{uniforms:ui([tt.common,tt.displacementmap,{referencePosition:{value:new X},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ft.distanceRGBA_vert,fragmentShader:Ft.distanceRGBA_frag},shadow:{uniforms:ui([tt.lights,tt.fog,{color:{value:new ct(0)},opacity:{value:1}}]),vertexShader:Ft.shadow_vert,fragmentShader:Ft.shadow_frag}};xr.physical={uniforms:ui([xr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ot},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ot},clearcoatNormalScale:{value:new He(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ot},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ot},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ot},sheen:{value:0},sheenColor:{value:new ct(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ot},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ot},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ot},transmissionSamplerSize:{value:new He},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ot},attenuationDistance:{value:0},attenuationColor:{value:new ct(0)},specularColor:{value:new ct(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ot},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ot},anisotropyVector:{value:new He},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ot}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag};const ju={r:0,b:0,g:0};function cO(s,e,t,n,i,r,o){const a=new ct(0);let l=r===!0?0:1,h,u,f=null,p=0,m=null;function g(y,x){let w=!1,S=x.isScene===!0?x.background:null;switch(S&&S.isTexture&&(S=(x.backgroundBlurriness>0?t:e).get(S)),S===null?v(a,l):S&&S.isColor&&(v(S,1),w=!0),s.xr.getEnvironmentBlendMode()){case"opaque":w=!0;break;case"additive":n.buffers.color.setClear(0,0,0,1,o),w=!0;break;case"alpha-blend":n.buffers.color.setClear(0,0,0,0,o),w=!0;break}(s.autoClear||w)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),S&&(S.isCubeTexture||S.mapping===Al)?(u===void 0&&(u=new qn(new uo(1,1,1),new kr({name:"BackgroundCubeMaterial",uniforms:bl(xr.backgroundCube.uniforms),vertexShader:xr.backgroundCube.vertexShader,fragmentShader:xr.backgroundCube.fragmentShader,side:di,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(C,P,L){this.matrixWorld.copyPosition(L.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),u.material.uniforms.envMap.value=S,u.material.uniforms.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.toneMapped=S.colorSpace!==It,(f!==S||p!==S.version||m!==s.toneMapping)&&(u.material.needsUpdate=!0,f=S,p=S.version,m=s.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):S&&S.isTexture&&(h===void 0&&(h=new qn(new Cl(2,2),new kr({name:"BackgroundMaterial",uniforms:bl(xr.background.uniforms),vertexShader:xr.background.vertexShader,fragmentShader:xr.background.fragmentShader,side:ys,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(h)),h.material.uniforms.t2D.value=S,h.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,h.material.toneMapped=S.colorSpace!==It,S.matrixAutoUpdate===!0&&S.updateMatrix(),h.material.uniforms.uvTransform.value.copy(S.matrix),(f!==S||p!==S.version||m!==s.toneMapping)&&(h.material.needsUpdate=!0,f=S,p=S.version,m=s.toneMapping),h.layers.enableAll(),y.unshift(h,h.geometry,h.material,0,0,null))}function v(y,x){y.getRGB(ju,dw(s)),n.buffers.color.setClear(ju.r,ju.g,ju.b,x,o)}return{getClearColor:function(){return a},setClearColor:function(y,x=1){a.set(y),l=x,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,v(a,l)},render:g}}function hO(s,e,t,n){const i=s.getParameter(s.MAX_VERTEX_ATTRIBS),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||r!==null,a={},l=y(null);let h=l,u=!1;function f(O,V,j,q,J){let se=!1;if(o){const _e=v(q,j,V);h!==_e&&(h=_e,m(h.object)),se=x(O,q,j,J),se&&w(O,q,j,J)}else{const _e=V.wireframe===!0;(h.geometry!==q.id||h.program!==j.id||h.wireframe!==_e)&&(h.geometry=q.id,h.program=j.id,h.wireframe=_e,se=!0)}J!==null&&t.update(J,s.ELEMENT_ARRAY_BUFFER),(se||u)&&(u=!1,L(O,V,j,q),J!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t.get(J).buffer))}function p(){return n.isWebGL2?s.createVertexArray():r.createVertexArrayOES()}function m(O){return n.isWebGL2?s.bindVertexArray(O):r.bindVertexArrayOES(O)}function g(O){return n.isWebGL2?s.deleteVertexArray(O):r.deleteVertexArrayOES(O)}function v(O,V,j){const q=j.wireframe===!0;let J=a[O.id];J===void 0&&(J={},a[O.id]=J);let se=J[V.id];se===void 0&&(se={},J[V.id]=se);let _e=se[q];return _e===void 0&&(_e=y(p()),se[q]=_e),_e}function y(O){const V=[],j=[],q=[];for(let J=0;J<i;J++)V[J]=0,j[J]=0,q[J]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:j,attributeDivisors:q,object:O,attributes:{},index:null}}function x(O,V,j,q){const J=h.attributes,se=V.attributes;let _e=0;const Re=j.getAttributes();for(const ae in Re)if(Re[ae].location>=0){const oe=J[ae];let Ce=se[ae];if(Ce===void 0&&(ae==="instanceMatrix"&&O.instanceMatrix&&(Ce=O.instanceMatrix),ae==="instanceColor"&&O.instanceColor&&(Ce=O.instanceColor)),oe===void 0||oe.attribute!==Ce||Ce&&oe.data!==Ce.data)return!0;_e++}return h.attributesNum!==_e||h.index!==q}function w(O,V,j,q){const J={},se=V.attributes;let _e=0;const Re=j.getAttributes();for(const ae in Re)if(Re[ae].location>=0){let oe=se[ae];oe===void 0&&(ae==="instanceMatrix"&&O.instanceMatrix&&(oe=O.instanceMatrix),ae==="instanceColor"&&O.instanceColor&&(oe=O.instanceColor));const Ce={};Ce.attribute=oe,oe&&oe.data&&(Ce.data=oe.data),J[ae]=Ce,_e++}h.attributes=J,h.attributesNum=_e,h.index=q}function S(){const O=h.newAttributes;for(let V=0,j=O.length;V<j;V++)O[V]=0}function E(O){A(O,0)}function A(O,V){const j=h.newAttributes,q=h.enabledAttributes,J=h.attributeDivisors;j[O]=1,q[O]===0&&(s.enableVertexAttribArray(O),q[O]=1),J[O]!==V&&((n.isWebGL2?s:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](O,V),J[O]=V)}function C(){const O=h.newAttributes,V=h.enabledAttributes;for(let j=0,q=V.length;j<q;j++)V[j]!==O[j]&&(s.disableVertexAttribArray(j),V[j]=0)}function P(O,V,j,q,J,se,_e){_e===!0?s.vertexAttribIPointer(O,V,j,J,se):s.vertexAttribPointer(O,V,j,q,J,se)}function L(O,V,j,q){if(n.isWebGL2===!1&&(O.isInstancedMesh||q.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;S();const J=q.attributes,se=j.getAttributes(),_e=V.defaultAttributeValues;for(const Re in se){const ae=se[Re];if(ae.location>=0){let ve=J[Re];if(ve===void 0&&(Re==="instanceMatrix"&&O.instanceMatrix&&(ve=O.instanceMatrix),Re==="instanceColor"&&O.instanceColor&&(ve=O.instanceColor)),ve!==void 0){const oe=ve.normalized,Ce=ve.itemSize,Ie=t.get(ve);if(Ie===void 0)continue;const ke=Ie.buffer,Ye=Ie.type,$e=Ie.bytesPerElement,et=n.isWebGL2===!0&&(Ye===s.INT||Ye===s.UNSIGNED_INT||ve.gpuType===Sg);if(ve.isInterleavedBufferAttribute){const Ke=ve.data,W=Ke.stride,Le=ve.offset;if(Ke.isInstancedInterleavedBuffer){for(let Q=0;Q<ae.locationSize;Q++)A(ae.location+Q,Ke.meshPerAttribute);O.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=Ke.meshPerAttribute*Ke.count)}else for(let Q=0;Q<ae.locationSize;Q++)E(ae.location+Q);s.bindBuffer(s.ARRAY_BUFFER,ke);for(let Q=0;Q<ae.locationSize;Q++)P(ae.location+Q,Ce/ae.locationSize,Ye,oe,W*$e,(Le+Ce/ae.locationSize*Q)*$e,et)}else{if(ve.isInstancedBufferAttribute){for(let Ke=0;Ke<ae.locationSize;Ke++)A(ae.location+Ke,ve.meshPerAttribute);O.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=ve.meshPerAttribute*ve.count)}else for(let Ke=0;Ke<ae.locationSize;Ke++)E(ae.location+Ke);s.bindBuffer(s.ARRAY_BUFFER,ke);for(let Ke=0;Ke<ae.locationSize;Ke++)P(ae.location+Ke,Ce/ae.locationSize,Ye,oe,Ce*$e,Ce/ae.locationSize*Ke*$e,et)}}else if(_e!==void 0){const oe=_e[Re];if(oe!==void 0)switch(oe.length){case 2:s.vertexAttrib2fv(ae.location,oe);break;case 3:s.vertexAttrib3fv(ae.location,oe);break;case 4:s.vertexAttrib4fv(ae.location,oe);break;default:s.vertexAttrib1fv(ae.location,oe)}}}}C()}function T(){K();for(const O in a){const V=a[O];for(const j in V){const q=V[j];for(const J in q)g(q[J].object),delete q[J];delete V[j]}delete a[O]}}function R(O){if(a[O.id]===void 0)return;const V=a[O.id];for(const j in V){const q=V[j];for(const J in q)g(q[J].object),delete q[J];delete V[j]}delete a[O.id]}function G(O){for(const V in a){const j=a[V];if(j[O.id]===void 0)continue;const q=j[O.id];for(const J in q)g(q[J].object),delete q[J];delete j[O.id]}}function K(){Z(),u=!0,h!==l&&(h=l,m(h.object))}function Z(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:f,reset:K,resetDefaultState:Z,dispose:T,releaseStatesOfGeometry:R,releaseStatesOfProgram:G,initAttributes:S,enableAttribute:E,disableUnusedAttributes:C}}function uO(s,e,t,n){const i=n.isWebGL2;let r;function o(h){r=h}function a(h,u){s.drawArrays(r,h,u),t.update(u,r,1)}function l(h,u,f){if(f===0)return;let p,m;if(i)p=s,m="drawArraysInstanced";else if(p=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[m](r,h,u,f),t.update(u,r,f)}this.setMode=o,this.render=a,this.renderInstances=l}function dO(s,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const P=e.get("EXT_texture_filter_anisotropic");n=s.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(P){if(P==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";P="mediump"}return P==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&s.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const h=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,f=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),p=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=s.getParameter(s.MAX_TEXTURE_SIZE),g=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),v=s.getParameter(s.MAX_VERTEX_ATTRIBS),y=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),x=s.getParameter(s.MAX_VARYING_VECTORS),w=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),S=p>0,E=o||e.has("OES_texture_float"),A=S&&E,C=o?s.getParameter(s.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:h,getMaxAnisotropy:i,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:u,maxTextures:f,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:g,maxAttributes:v,maxVertexUniforms:y,maxVaryings:x,maxFragmentUniforms:w,vertexTextures:S,floatFragmentTextures:E,floatVertexTextures:A,maxSamples:C}}function fO(s){const e=this;let t=null,n=0,i=!1,r=!1;const o=new $s,a=new Ot,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,p){const m=f.length!==0||p||n!==0||i;return i=p,n=f.length,m},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(f,p){t=u(f,p,0)},this.setState=function(f,p,m){const g=f.clippingPlanes,v=f.clipIntersection,y=f.clipShadows,x=s.get(f);if(!i||g===null||g.length===0||r&&!y)r?u(null):h();else{const w=r?0:n,S=w*4;let E=x.clippingState||null;l.value=E,E=u(g,p,S,m);for(let A=0;A!==S;++A)E[A]=t[A];x.clippingState=E,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=w}};function h(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(f,p,m,g){const v=f!==null?f.length:0;let y=null;if(v!==0){if(y=l.value,g!==!0||y===null){const x=m+v*4,w=p.matrixWorldInverse;a.getNormalMatrix(w),(y===null||y.length<x)&&(y=new Float32Array(x));for(let S=0,E=m;S!==v;++S,E+=4)o.copy(f[S]).applyMatrix4(w,a),o.normal.toArray(y,E),y[E+3]=o.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,y}}function pO(s){let e=new WeakMap;function t(o,a){return a===zc?o.mapping=ro:a===Vc&&(o.mapping=so),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===zc||a===Vc)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const h=new mw(l.height/2);return h.fromEquirectangularTexture(s,o),e.set(o,h),o.addEventListener("dispose",i),t(h.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}class xf extends gf{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=h*this.view.offsetX,o=r+h*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const hl=4,zy=[.125,.215,.35,.446,.526,.582],Vo=20,xm=new xf,Vy=new ct;let ym=null;const Uo=(1+Math.sqrt(5))/2,Wa=1/Uo,ky=[new X(1,1,1),new X(-1,1,1),new X(1,1,-1),new X(-1,1,-1),new X(0,Uo,Wa),new X(0,Uo,-Wa),new X(Wa,0,Uo),new X(-Wa,0,Uo),new X(Uo,Wa,0),new X(-Uo,Wa,0)];class G0{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){ym=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Wy(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Hy(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ym),e.scissorTest=!1,qu(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ro||e.mapping===so?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ym=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Sn,minFilter:Sn,generateMipmaps:!1,type:vl,format:Vi,colorSpace:yr,depthBuffer:!1},i=Gy(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Gy(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=mO(r)),this._blurMaterial=gO(r,e,t)}return i}_compileMaterial(e){const t=new qn(this._lodPlanes[0],e);this._renderer.compile(t,xm)}_sceneToCubeUV(e,t,n,i){const a=new jn(90,1,t,n),l=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],u=this._renderer,f=u.autoClear,p=u.toneMapping;u.getClearColor(Vy),u.toneMapping=Br,u.autoClear=!1;const m=new ho({name:"PMREM.Background",side:di,depthWrite:!1,depthTest:!1}),g=new qn(new uo,m);let v=!1;const y=e.background;y?y.isColor&&(m.color.copy(y),e.background=null,v=!0):(m.color.copy(Vy),v=!0);for(let x=0;x<6;x++){const w=x%3;w===0?(a.up.set(0,l[x],0),a.lookAt(h[x],0,0)):w===1?(a.up.set(0,0,l[x]),a.lookAt(0,h[x],0)):(a.up.set(0,l[x],0),a.lookAt(0,0,h[x]));const S=this._cubeSize;qu(i,w*S,x>2?S:0,S,S),u.setRenderTarget(i),v&&u.render(g,a),u.render(e,a)}g.geometry.dispose(),g.material.dispose(),u.toneMapping=p,u.autoClear=f,e.background=y}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===ro||e.mapping===so;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=Wy()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Hy());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new qn(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;qu(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,xm)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const r=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),o=ky[(i-1)%ky.length];this._blur(e,i-1,i,r,o)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,a){const l=this._renderer,h=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,f=new qn(this._lodPlanes[i],h),p=h.uniforms,m=this._sizeLods[n]-1,g=isFinite(r)?Math.PI/(2*m):2*Math.PI/(2*Vo-1),v=r/g,y=isFinite(r)?1+Math.floor(u*v):Vo;y>Vo&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Vo}`);const x=[];let w=0;for(let P=0;P<Vo;++P){const L=P/v,T=Math.exp(-L*L/2);x.push(T),P===0?w+=T:P<y&&(w+=2*T)}for(let P=0;P<x.length;P++)x[P]=x[P]/w;p.envMap.value=e.texture,p.samples.value=y,p.weights.value=x,p.latitudinal.value=o==="latitudinal",a&&(p.poleAxis.value=a);const{_lodMax:S}=this;p.dTheta.value=g,p.mipInt.value=S-n;const E=this._sizeLods[i],A=3*E*(i>S-hl?i-S+hl:0),C=4*(this._cubeSize-E);qu(t,A,C,3*E,2*E),l.setRenderTarget(t),l.render(f,xm)}}function mO(s){const e=[],t=[],n=[];let i=s;const r=s-hl+1+zy.length;for(let o=0;o<r;o++){const a=Math.pow(2,i);t.push(a);let l=1/a;o>s-hl?l=zy[o-s+hl-1]:o===0&&(l=0),n.push(l);const h=1/(a-2),u=-h,f=1+h,p=[u,u,f,u,f,f,u,u,f,f,u,f],m=6,g=6,v=3,y=2,x=1,w=new Float32Array(v*g*m),S=new Float32Array(y*g*m),E=new Float32Array(x*g*m);for(let C=0;C<m;C++){const P=C%3*2/3-1,L=C>2?0:-1,T=[P,L,0,P+2/3,L,0,P+2/3,L+1,0,P,L,0,P+2/3,L+1,0,P,L+1,0];w.set(T,v*g*C),S.set(p,y*g*C);const R=[C,C,C,C,C,C];E.set(R,x*g*C)}const A=new Bt;A.setAttribute("position",new tn(w,v)),A.setAttribute("uv",new tn(S,y)),A.setAttribute("faceIndex",new tn(E,x)),e.push(A),i>hl&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function Gy(s,e,t){const n=new vr(s,e,t);return n.texture.mapping=Al,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function qu(s,e,t,n,i){s.viewport.set(e,t,n,i),s.scissor.set(e,t,n,i)}function gO(s,e,t){const n=new Float32Array(Vo),i=new X(0,1,0);return new kr({name:"SphericalGaussianBlur",defines:{n:Vo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Og(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:_s,depthTest:!1,depthWrite:!1})}function Hy(){return new kr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Og(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:_s,depthTest:!1,depthWrite:!1})}function Wy(){return new kr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Og(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:_s,depthTest:!1,depthWrite:!1})}function Og(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function _O(s){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,h=l===zc||l===Vc,u=l===ro||l===so;if(h||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let f=e.get(a);return t===null&&(t=new G0(s)),f=h?t.fromEquirectangular(a,f):t.fromCubemap(a,f),e.set(a,f),f.texture}else{if(e.has(a))return e.get(a).texture;{const f=a.image;if(h&&f&&f.height>0||u&&f&&i(f)){t===null&&(t=new G0(s));const p=h?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,p),a.addEventListener("dispose",r),p.texture}else return null}}}return a}function i(a){let l=0;const h=6;for(let u=0;u<h;u++)a[u]!==void 0&&l++;return l===h}function r(a){const l=a.target;l.removeEventListener("dispose",r);const h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function xO(s){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=s.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function yO(s,e,t,n){const i={},r=new WeakMap;function o(f){const p=f.target;p.index!==null&&e.remove(p.index);for(const g in p.attributes)e.remove(p.attributes[g]);for(const g in p.morphAttributes){const v=p.morphAttributes[g];for(let y=0,x=v.length;y<x;y++)e.remove(v[y])}p.removeEventListener("dispose",o),delete i[p.id];const m=r.get(p);m&&(e.remove(m),r.delete(p)),n.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,t.memory.geometries--}function a(f,p){return i[p.id]===!0||(p.addEventListener("dispose",o),i[p.id]=!0,t.memory.geometries++),p}function l(f){const p=f.attributes;for(const g in p)e.update(p[g],s.ARRAY_BUFFER);const m=f.morphAttributes;for(const g in m){const v=m[g];for(let y=0,x=v.length;y<x;y++)e.update(v[y],s.ARRAY_BUFFER)}}function h(f){const p=[],m=f.index,g=f.attributes.position;let v=0;if(m!==null){const w=m.array;v=m.version;for(let S=0,E=w.length;S<E;S+=3){const A=w[S+0],C=w[S+1],P=w[S+2];p.push(A,C,C,P,P,A)}}else{const w=g.array;v=g.version;for(let S=0,E=w.length/3-1;S<E;S+=3){const A=S+0,C=S+1,P=S+2;p.push(A,C,C,P,P,A)}}const y=new(hw(p)?Fg:Ng)(p,1);y.version=v;const x=r.get(f);x&&e.remove(x),r.set(f,y)}function u(f){const p=r.get(f);if(p){const m=f.index;m!==null&&p.version<m.version&&h(f)}else h(f);return r.get(f)}return{get:a,update:l,getWireframeAttribute:u}}function vO(s,e,t,n){const i=n.isWebGL2;let r;function o(p){r=p}let a,l;function h(p){a=p.type,l=p.bytesPerElement}function u(p,m){s.drawElements(r,m,a,p*l),t.update(m,r,1)}function f(p,m,g){if(g===0)return;let v,y;if(i)v=s,y="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[y](r,m,a,p*l,g),t.update(m,r,g)}this.setMode=o,this.setIndex=h,this.render=u,this.renderInstances=f}function SO(s){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,o,a){switch(t.calls++,o){case s.TRIANGLES:t.triangles+=a*(r/3);break;case s.LINES:t.lines+=a*(r/2);break;case s.LINE_STRIP:t.lines+=a*(r-1);break;case s.LINE_LOOP:t.lines+=a*r;break;case s.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function bO(s,e){return s[0]-e[0]}function wO(s,e){return Math.abs(e[1])-Math.abs(s[1])}function MO(s,e,t){const n={},i=new Float32Array(8),r=new WeakMap,o=new Qt,a=[];for(let h=0;h<8;h++)a[h]=[h,0];function l(h,u,f){const p=h.morphTargetInfluences;if(e.isWebGL2===!0){const m=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,g=m!==void 0?m.length:0;let v=r.get(u);if(v===void 0||v.count!==g){let O=function(){K.dispose(),r.delete(u),u.removeEventListener("dispose",O)};v!==void 0&&v.texture.dispose();const w=u.morphAttributes.position!==void 0,S=u.morphAttributes.normal!==void 0,E=u.morphAttributes.color!==void 0,A=u.morphAttributes.position||[],C=u.morphAttributes.normal||[],P=u.morphAttributes.color||[];let L=0;w===!0&&(L=1),S===!0&&(L=2),E===!0&&(L=3);let T=u.attributes.position.count*L,R=1;T>e.maxTextureSize&&(R=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const G=new Float32Array(T*R*4*g),K=new pf(G,T,R,g);K.type=Dr,K.needsUpdate=!0;const Z=L*4;for(let V=0;V<g;V++){const j=A[V],q=C[V],J=P[V],se=T*R*4*V;for(let _e=0;_e<j.count;_e++){const Re=_e*Z;w===!0&&(o.fromBufferAttribute(j,_e),G[se+Re+0]=o.x,G[se+Re+1]=o.y,G[se+Re+2]=o.z,G[se+Re+3]=0),S===!0&&(o.fromBufferAttribute(q,_e),G[se+Re+4]=o.x,G[se+Re+5]=o.y,G[se+Re+6]=o.z,G[se+Re+7]=0),E===!0&&(o.fromBufferAttribute(J,_e),G[se+Re+8]=o.x,G[se+Re+9]=o.y,G[se+Re+10]=o.z,G[se+Re+11]=J.itemSize===4?o.w:1)}}v={count:g,texture:K,size:new He(T,R)},r.set(u,v),u.addEventListener("dispose",O)}let y=0;for(let w=0;w<p.length;w++)y+=p[w];const x=u.morphTargetsRelative?1:1-y;f.getUniforms().setValue(s,"morphTargetBaseInfluence",x),f.getUniforms().setValue(s,"morphTargetInfluences",p),f.getUniforms().setValue(s,"morphTargetsTexture",v.texture,t),f.getUniforms().setValue(s,"morphTargetsTextureSize",v.size)}else{const m=p===void 0?0:p.length;let g=n[u.id];if(g===void 0||g.length!==m){g=[];for(let S=0;S<m;S++)g[S]=[S,0];n[u.id]=g}for(let S=0;S<m;S++){const E=g[S];E[0]=S,E[1]=p[S]}g.sort(wO);for(let S=0;S<8;S++)S<m&&g[S][1]?(a[S][0]=g[S][0],a[S][1]=g[S][1]):(a[S][0]=Number.MAX_SAFE_INTEGER,a[S][1]=0);a.sort(bO);const v=u.morphAttributes.position,y=u.morphAttributes.normal;let x=0;for(let S=0;S<8;S++){const E=a[S],A=E[0],C=E[1];A!==Number.MAX_SAFE_INTEGER&&C?(v&&u.getAttribute("morphTarget"+S)!==v[A]&&u.setAttribute("morphTarget"+S,v[A]),y&&u.getAttribute("morphNormal"+S)!==y[A]&&u.setAttribute("morphNormal"+S,y[A]),i[S]=C,x+=C):(v&&u.hasAttribute("morphTarget"+S)===!0&&u.deleteAttribute("morphTarget"+S),y&&u.hasAttribute("morphNormal"+S)===!0&&u.deleteAttribute("morphNormal"+S),i[S]=0)}const w=u.morphTargetsRelative?1:1-x;f.getUniforms().setValue(s,"morphTargetBaseInfluence",w),f.getUniforms().setValue(s,"morphTargetInfluences",i)}}return{update:l}}function EO(s,e,t,n){let i=new WeakMap;function r(l){const h=n.render.frame,u=l.geometry,f=e.get(l,u);return i.get(f)!==h&&(e.update(f),i.set(f,h)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,s.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,s.ARRAY_BUFFER)),f}function o(){i=new WeakMap}function a(l){const h=l.target;h.removeEventListener("dispose",a),t.remove(h.instanceMatrix),h.instanceColor!==null&&t.remove(h.instanceColor)}return{update:r,dispose:o}}const _w=new bn,xw=new pf,yw=new Lg,vw=new uh,Xy=[],Yy=[],jy=new Float32Array(16),qy=new Float32Array(9),$y=new Float32Array(4);function Rl(s,e,t){const n=s[0];if(n<=0||n>0)return s;const i=e*t;let r=Xy[i];if(r===void 0&&(r=new Float32Array(i),Xy[i]=r),e!==0){n.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,s[o].toArray(r,a)}return r}function Nn(s,e){if(s.length!==e.length)return!1;for(let t=0,n=s.length;t<n;t++)if(s[t]!==e[t])return!1;return!0}function Fn(s,e){for(let t=0,n=e.length;t<n;t++)s[t]=e[t]}function yf(s,e){let t=Yy[e];t===void 0&&(t=new Int32Array(e),Yy[e]=t);for(let n=0;n!==e;++n)t[n]=s.allocateTextureUnit();return t}function AO(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function TO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Nn(t,e))return;s.uniform2fv(this.addr,e),Fn(t,e)}}function CO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Nn(t,e))return;s.uniform3fv(this.addr,e),Fn(t,e)}}function RO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Nn(t,e))return;s.uniform4fv(this.addr,e),Fn(t,e)}}function PO(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Nn(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),Fn(t,e)}else{if(Nn(t,n))return;$y.set(n),s.uniformMatrix2fv(this.addr,!1,$y),Fn(t,n)}}function IO(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Nn(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),Fn(t,e)}else{if(Nn(t,n))return;qy.set(n),s.uniformMatrix3fv(this.addr,!1,qy),Fn(t,n)}}function LO(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Nn(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),Fn(t,e)}else{if(Nn(t,n))return;jy.set(n),s.uniformMatrix4fv(this.addr,!1,jy),Fn(t,n)}}function NO(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function FO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Nn(t,e))return;s.uniform2iv(this.addr,e),Fn(t,e)}}function OO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Nn(t,e))return;s.uniform3iv(this.addr,e),Fn(t,e)}}function DO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Nn(t,e))return;s.uniform4iv(this.addr,e),Fn(t,e)}}function UO(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function BO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Nn(t,e))return;s.uniform2uiv(this.addr,e),Fn(t,e)}}function zO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Nn(t,e))return;s.uniform3uiv(this.addr,e),Fn(t,e)}}function VO(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Nn(t,e))return;s.uniform4uiv(this.addr,e),Fn(t,e)}}function kO(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTexture2D(e||_w,i)}function GO(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||yw,i)}function HO(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||vw,i)}function WO(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||xw,i)}function XO(s){switch(s){case 5126:return AO;case 35664:return TO;case 35665:return CO;case 35666:return RO;case 35674:return PO;case 35675:return IO;case 35676:return LO;case 5124:case 35670:return NO;case 35667:case 35671:return FO;case 35668:case 35672:return OO;case 35669:case 35673:return DO;case 5125:return UO;case 36294:return BO;case 36295:return zO;case 36296:return VO;case 35678:case 36198:case 36298:case 36306:case 35682:return kO;case 35679:case 36299:case 36307:return GO;case 35680:case 36300:case 36308:case 36293:return HO;case 36289:case 36303:case 36311:case 36292:return WO}}function YO(s,e){s.uniform1fv(this.addr,e)}function jO(s,e){const t=Rl(e,this.size,2);s.uniform2fv(this.addr,t)}function qO(s,e){const t=Rl(e,this.size,3);s.uniform3fv(this.addr,t)}function $O(s,e){const t=Rl(e,this.size,4);s.uniform4fv(this.addr,t)}function ZO(s,e){const t=Rl(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function KO(s,e){const t=Rl(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function JO(s,e){const t=Rl(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function QO(s,e){s.uniform1iv(this.addr,e)}function eD(s,e){s.uniform2iv(this.addr,e)}function tD(s,e){s.uniform3iv(this.addr,e)}function nD(s,e){s.uniform4iv(this.addr,e)}function iD(s,e){s.uniform1uiv(this.addr,e)}function rD(s,e){s.uniform2uiv(this.addr,e)}function sD(s,e){s.uniform3uiv(this.addr,e)}function oD(s,e){s.uniform4uiv(this.addr,e)}function aD(s,e,t){const n=this.cache,i=e.length,r=yf(t,i);Nn(n,r)||(s.uniform1iv(this.addr,r),Fn(n,r));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||_w,r[o])}function lD(s,e,t){const n=this.cache,i=e.length,r=yf(t,i);Nn(n,r)||(s.uniform1iv(this.addr,r),Fn(n,r));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||yw,r[o])}function cD(s,e,t){const n=this.cache,i=e.length,r=yf(t,i);Nn(n,r)||(s.uniform1iv(this.addr,r),Fn(n,r));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||vw,r[o])}function hD(s,e,t){const n=this.cache,i=e.length,r=yf(t,i);Nn(n,r)||(s.uniform1iv(this.addr,r),Fn(n,r));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||xw,r[o])}function uD(s){switch(s){case 5126:return YO;case 35664:return jO;case 35665:return qO;case 35666:return $O;case 35674:return ZO;case 35675:return KO;case 35676:return JO;case 5124:case 35670:return QO;case 35667:case 35671:return eD;case 35668:case 35672:return tD;case 35669:case 35673:return nD;case 5125:return iD;case 36294:return rD;case 36295:return sD;case 36296:return oD;case 35678:case 36198:case 36298:case 36306:case 35682:return aD;case 35679:case 36299:case 36307:return lD;case 35680:case 36300:case 36308:case 36293:return cD;case 36289:case 36303:case 36311:case 36292:return hD}}class dD{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=XO(t.type)}}class fD{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=uD(t.type)}}class pD{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const a=i[r];a.setValue(e,t[a.id],n)}}}const vm=/(\w+)(\])?(\[|\.)?/g;function Zy(s,e){s.seq.push(e),s.map[e.id]=e}function mD(s,e,t){const n=s.name,i=n.length;for(vm.lastIndex=0;;){const r=vm.exec(n),o=vm.lastIndex;let a=r[1];const l=r[2]==="]",h=r[3];if(l&&(a=a|0),h===void 0||h==="["&&o+2===i){Zy(t,h===void 0?new dD(a,s,e):new fD(a,s,e));break}else{let f=t.map[a];f===void 0&&(f=new pD(a),Zy(t,f)),t=f}}}class Wd{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const r=e.getActiveUniform(t,i),o=e.getUniformLocation(t,r.name);mD(r,o,this)}}setValue(e,t,n,i){const r=this.map[t];r!==void 0&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const o=e[i];o.id in t&&n.push(o)}return n}}function Ky(s,e,t){const n=s.createShader(e);return s.shaderSource(n,t),s.compileShader(n),n}let gD=0;function _D(s,e){const t=s.split(`
`),n=[],i=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=i;o<r;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function xD(s){switch(s){case yr:return["Linear","( value )"];case It:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",s),["Linear","( value )"]}}function Jy(s,e,t){const n=s.getShaderParameter(e,s.COMPILE_STATUS),i=s.getShaderInfoLog(e).trim();if(n&&i==="")return"";const r=/ERROR: 0:(\d+)/.exec(i);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+i+`

`+_D(s.getShaderSource(e),o)}else return i}function yD(s,e){const t=xD(e);return"vec4 "+s+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function vD(s,e){let t;switch(e){case Fb:t="Linear";break;case Ob:t="Reinhard";break;case Db:t="OptimizedCineon";break;case Ub:t="ACESFilmic";break;case Bb:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function SD(s){return[s.extensionDerivatives||s.envMapCubeUVHeight||s.bumpMap||s.normalMapTangentSpace||s.clearcoatNormalMap||s.flatShading||s.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(s.extensionFragDepth||s.logarithmicDepthBuffer)&&s.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",s.extensionDrawBuffers&&s.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(s.extensionShaderTextureLOD||s.envMap||s.transmission)&&s.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Lc).join(`
`)}function bD(s){const e=[];for(const t in s){const n=s[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function wD(s,e){const t={},n=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const r=s.getActiveAttrib(e,i),o=r.name;let a=1;r.type===s.FLOAT_MAT2&&(a=2),r.type===s.FLOAT_MAT3&&(a=3),r.type===s.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:s.getAttribLocation(e,o),locationSize:a}}return t}function Lc(s){return s!==""}function Qy(s,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ev(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const MD=/^[ \t]*#include +<([\w\d./]+)>/gm;function H0(s){return s.replace(MD,ED)}function ED(s,e){const t=Ft[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return H0(t)}const AD=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function tv(s){return s.replace(AD,TD)}function TD(s,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function nv(s){let e="precision "+s.precision+` float;
precision `+s.precision+" int;";return s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function CD(s){let e="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===_g?e="SHADOWMAP_TYPE_PCF":s.shadowMapType===db?e="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===Fr&&(e="SHADOWMAP_TYPE_VSM"),e}function RD(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case ro:case so:e="ENVMAP_TYPE_CUBE";break;case Al:e="ENVMAP_TYPE_CUBE_UV";break}return e}function PD(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case so:e="ENVMAP_MODE_REFRACTION";break}return e}function ID(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case ch:e="ENVMAP_BLENDING_MULTIPLY";break;case Lb:e="ENVMAP_BLENDING_MIX";break;case Nb:e="ENVMAP_BLENDING_ADD";break}return e}function LD(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function ND(s,e,t,n){const i=s.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=CD(t),h=RD(t),u=PD(t),f=ID(t),p=LD(t),m=t.isWebGL2?"":SD(t),g=bD(r),v=i.createProgram();let y,x,w=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(Lc).join(`
`),y.length>0&&(y+=`
`),x=[m,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(Lc).join(`
`),x.length>0&&(x+=`
`)):(y=[nv(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Lc).join(`
`),x=[m,nv(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",t.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Br?"#define TONE_MAPPING":"",t.toneMapping!==Br?Ft.tonemapping_pars_fragment:"",t.toneMapping!==Br?vD("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ft.encodings_pars_fragment,yD("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Lc).join(`
`)),o=H0(o),o=Qy(o,t),o=ev(o,t),a=H0(a),a=Qy(a,t),a=ev(a,t),o=tv(o),a=tv(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,x=["#define varying in",t.glslVersion===V0?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===V0?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const S=w+y+o,E=w+x+a,A=Ky(i,i.VERTEX_SHADER,S),C=Ky(i,i.FRAGMENT_SHADER,E);if(i.attachShader(v,A),i.attachShader(v,C),t.index0AttributeName!==void 0?i.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(v,0,"position"),i.linkProgram(v),s.debug.checkShaderErrors){const T=i.getProgramInfoLog(v).trim(),R=i.getShaderInfoLog(A).trim(),G=i.getShaderInfoLog(C).trim();let K=!0,Z=!0;if(i.getProgramParameter(v,i.LINK_STATUS)===!1)if(K=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(i,v,A,C);else{const O=Jy(i,A,"vertex"),V=Jy(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(v,i.VALIDATE_STATUS)+`

Program Info Log: `+T+`
`+O+`
`+V)}else T!==""?console.warn("THREE.WebGLProgram: Program Info Log:",T):(R===""||G==="")&&(Z=!1);Z&&(this.diagnostics={runnable:K,programLog:T,vertexShader:{log:R,prefix:y},fragmentShader:{log:G,prefix:x}})}i.deleteShader(A),i.deleteShader(C);let P;this.getUniforms=function(){return P===void 0&&(P=new Wd(i,v)),P};let L;return this.getAttributes=function(){return L===void 0&&(L=wD(i,v)),L},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=gD++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=A,this.fragmentShader=C,this}let FD=0;class OD{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new DD(e),t.set(e,n)),n}}class DD{constructor(e){this.id=FD++,this.code=e,this.usedTimes=0}}function UD(s,e,t,n,i,r,o){const a=new mf,l=new OD,h=[],u=i.isWebGL2,f=i.logarithmicDepthBuffer,p=i.vertexTextures;let m=i.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(T){return T===0?"uv":`uv${T}`}function y(T,R,G,K,Z){const O=K.fog,V=Z.geometry,j=T.isMeshStandardMaterial?K.environment:null,q=(T.isMeshStandardMaterial?t:e).get(T.envMap||j),J=q&&q.mapping===Al?q.image.height:null,se=g[T.type];T.precision!==null&&(m=i.getMaxPrecision(T.precision),m!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",m,"instead."));const _e=V.morphAttributes.position||V.morphAttributes.normal||V.morphAttributes.color,Re=_e!==void 0?_e.length:0;let ae=0;V.morphAttributes.position!==void 0&&(ae=1),V.morphAttributes.normal!==void 0&&(ae=2),V.morphAttributes.color!==void 0&&(ae=3);let ve,oe,Ce,Ie;if(se){const at=xr[se];ve=at.vertexShader,oe=at.fragmentShader}else ve=T.vertexShader,oe=T.fragmentShader,l.update(T),Ce=l.getVertexShaderID(T),Ie=l.getFragmentShaderID(T);const ke=s.getRenderTarget(),Ye=Z.isInstancedMesh===!0,$e=!!T.map,et=!!T.matcap,Ke=!!q,W=!!T.aoMap,Le=!!T.lightMap,Q=!!T.bumpMap,he=!!T.normalMap,fe=!!T.displacementMap,De=!!T.emissiveMap,je=!!T.metalnessMap,qe=!!T.roughnessMap,it=T.anisotropy>0,ot=T.clearcoat>0,_t=T.iridescence>0,H=T.sheen>0,U=T.transmission>0,we=it&&!!T.anisotropyMap,We=ot&&!!T.clearcoatMap,Ge=ot&&!!T.clearcoatNormalMap,Je=ot&&!!T.clearcoatRoughnessMap,nt=_t&&!!T.iridescenceMap,N=_t&&!!T.iridescenceThicknessMap,F=H&&!!T.sheenColorMap,k=H&&!!T.sheenRoughnessMap,ee=!!T.specularMap,ne=!!T.specularColorMap,ye=!!T.specularIntensityMap,ue=U&&!!T.transmissionMap,Ue=U&&!!T.thicknessMap,Ze=!!T.gradientMap,Y=!!T.alphaMap,Ve=T.alphaTest>0,me=!!T.extensions,xe=!!V.attributes.uv1,Pe=!!V.attributes.uv2,Qe=!!V.attributes.uv3;return{isWebGL2:u,shaderID:se,shaderType:T.type,shaderName:T.name,vertexShader:ve,fragmentShader:oe,defines:T.defines,customVertexShaderID:Ce,customFragmentShaderID:Ie,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:m,instancing:Ye,instancingColor:Ye&&Z.instanceColor!==null,supportsVertexTextures:p,outputColorSpace:ke===null?s.outputColorSpace:ke.isXRRenderTarget===!0?ke.texture.colorSpace:yr,map:$e,matcap:et,envMap:Ke,envMapMode:Ke&&q.mapping,envMapCubeUVHeight:J,aoMap:W,lightMap:Le,bumpMap:Q,normalMap:he,displacementMap:p&&fe,emissiveMap:De,normalMapObjectSpace:he&&T.normalMapType===Qb,normalMapTangentSpace:he&&T.normalMapType===co,metalnessMap:je,roughnessMap:qe,anisotropy:it,anisotropyMap:we,clearcoat:ot,clearcoatMap:We,clearcoatNormalMap:Ge,clearcoatRoughnessMap:Je,iridescence:_t,iridescenceMap:nt,iridescenceThicknessMap:N,sheen:H,sheenColorMap:F,sheenRoughnessMap:k,specularMap:ee,specularColorMap:ne,specularIntensityMap:ye,transmission:U,transmissionMap:ue,thicknessMap:Ue,gradientMap:Ze,opaque:T.transparent===!1&&T.blending===Yo,alphaMap:Y,alphaTest:Ve,combine:T.combine,mapUv:$e&&v(T.map.channel),aoMapUv:W&&v(T.aoMap.channel),lightMapUv:Le&&v(T.lightMap.channel),bumpMapUv:Q&&v(T.bumpMap.channel),normalMapUv:he&&v(T.normalMap.channel),displacementMapUv:fe&&v(T.displacementMap.channel),emissiveMapUv:De&&v(T.emissiveMap.channel),metalnessMapUv:je&&v(T.metalnessMap.channel),roughnessMapUv:qe&&v(T.roughnessMap.channel),anisotropyMapUv:we&&v(T.anisotropyMap.channel),clearcoatMapUv:We&&v(T.clearcoatMap.channel),clearcoatNormalMapUv:Ge&&v(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Je&&v(T.clearcoatRoughnessMap.channel),iridescenceMapUv:nt&&v(T.iridescenceMap.channel),iridescenceThicknessMapUv:N&&v(T.iridescenceThicknessMap.channel),sheenColorMapUv:F&&v(T.sheenColorMap.channel),sheenRoughnessMapUv:k&&v(T.sheenRoughnessMap.channel),specularMapUv:ee&&v(T.specularMap.channel),specularColorMapUv:ne&&v(T.specularColorMap.channel),specularIntensityMapUv:ye&&v(T.specularIntensityMap.channel),transmissionMapUv:ue&&v(T.transmissionMap.channel),thicknessMapUv:Ue&&v(T.thicknessMap.channel),alphaMapUv:Y&&v(T.alphaMap.channel),vertexTangents:!!V.attributes.tangent&&(he||it),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!V.attributes.color&&V.attributes.color.itemSize===4,vertexUv1s:xe,vertexUv2s:Pe,vertexUv3s:Qe,pointsUvs:Z.isPoints===!0&&!!V.attributes.uv&&($e||Y),fog:!!O,useFog:T.fog===!0,fogExp2:O&&O.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:f,skinning:Z.isSkinnedMesh===!0,morphTargets:V.morphAttributes.position!==void 0,morphNormals:V.morphAttributes.normal!==void 0,morphColors:V.morphAttributes.color!==void 0,morphTargetsCount:Re,morphTextureStride:ae,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:T.dithering,shadowMapEnabled:s.shadowMap.enabled&&G.length>0,shadowMapType:s.shadowMap.type,toneMapping:T.toneMapped?s.toneMapping:Br,useLegacyLights:s.useLegacyLights,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===Or,flipSided:T.side===di,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:me&&T.extensions.derivatives===!0,extensionFragDepth:me&&T.extensions.fragDepth===!0,extensionDrawBuffers:me&&T.extensions.drawBuffers===!0,extensionShaderTextureLOD:me&&T.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:T.customProgramCacheKey()}}function x(T){const R=[];if(T.shaderID?R.push(T.shaderID):(R.push(T.customVertexShaderID),R.push(T.customFragmentShaderID)),T.defines!==void 0)for(const G in T.defines)R.push(G),R.push(T.defines[G]);return T.isRawShaderMaterial===!1&&(w(R,T),S(R,T),R.push(s.outputColorSpace)),R.push(T.customProgramCacheKey),R.join()}function w(T,R){T.push(R.precision),T.push(R.outputColorSpace),T.push(R.envMapMode),T.push(R.envMapCubeUVHeight),T.push(R.mapUv),T.push(R.alphaMapUv),T.push(R.lightMapUv),T.push(R.aoMapUv),T.push(R.bumpMapUv),T.push(R.normalMapUv),T.push(R.displacementMapUv),T.push(R.emissiveMapUv),T.push(R.metalnessMapUv),T.push(R.roughnessMapUv),T.push(R.anisotropyMapUv),T.push(R.clearcoatMapUv),T.push(R.clearcoatNormalMapUv),T.push(R.clearcoatRoughnessMapUv),T.push(R.iridescenceMapUv),T.push(R.iridescenceThicknessMapUv),T.push(R.sheenColorMapUv),T.push(R.sheenRoughnessMapUv),T.push(R.specularMapUv),T.push(R.specularColorMapUv),T.push(R.specularIntensityMapUv),T.push(R.transmissionMapUv),T.push(R.thicknessMapUv),T.push(R.combine),T.push(R.fogExp2),T.push(R.sizeAttenuation),T.push(R.morphTargetsCount),T.push(R.morphAttributeCount),T.push(R.numDirLights),T.push(R.numPointLights),T.push(R.numSpotLights),T.push(R.numSpotLightMaps),T.push(R.numHemiLights),T.push(R.numRectAreaLights),T.push(R.numDirLightShadows),T.push(R.numPointLightShadows),T.push(R.numSpotLightShadows),T.push(R.numSpotLightShadowsWithMaps),T.push(R.shadowMapType),T.push(R.toneMapping),T.push(R.numClippingPlanes),T.push(R.numClipIntersection),T.push(R.depthPacking)}function S(T,R){a.disableAll(),R.isWebGL2&&a.enable(0),R.supportsVertexTextures&&a.enable(1),R.instancing&&a.enable(2),R.instancingColor&&a.enable(3),R.matcap&&a.enable(4),R.envMap&&a.enable(5),R.normalMapObjectSpace&&a.enable(6),R.normalMapTangentSpace&&a.enable(7),R.clearcoat&&a.enable(8),R.iridescence&&a.enable(9),R.alphaTest&&a.enable(10),R.vertexColors&&a.enable(11),R.vertexAlphas&&a.enable(12),R.vertexUv1s&&a.enable(13),R.vertexUv2s&&a.enable(14),R.vertexUv3s&&a.enable(15),R.vertexTangents&&a.enable(16),R.anisotropy&&a.enable(17),T.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.skinning&&a.enable(4),R.morphTargets&&a.enable(5),R.morphNormals&&a.enable(6),R.morphColors&&a.enable(7),R.premultipliedAlpha&&a.enable(8),R.shadowMapEnabled&&a.enable(9),R.useLegacyLights&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.transmission&&a.enable(15),R.sheen&&a.enable(16),R.opaque&&a.enable(17),R.pointsUvs&&a.enable(18),T.push(a.mask)}function E(T){const R=g[T.type];let G;if(R){const K=xr[R];G=fw.clone(K.uniforms)}else G=T.uniforms;return G}function A(T,R){let G;for(let K=0,Z=h.length;K<Z;K++){const O=h[K];if(O.cacheKey===R){G=O,++G.usedTimes;break}}return G===void 0&&(G=new ND(s,R,T,r),h.push(G)),G}function C(T){if(--T.usedTimes===0){const R=h.indexOf(T);h[R]=h[h.length-1],h.pop(),T.destroy()}}function P(T){l.remove(T)}function L(){l.dispose()}return{getParameters:y,getProgramCacheKey:x,getUniforms:E,acquireProgram:A,releaseProgram:C,releaseShaderCache:P,programs:h,dispose:L}}function BD(){let s=new WeakMap;function e(r){let o=s.get(r);return o===void 0&&(o={},s.set(r,o)),o}function t(r){s.delete(r)}function n(r,o,a){s.get(r)[o]=a}function i(){s=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function zD(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function iv(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function rv(){const s=[];let e=0;const t=[],n=[],i=[];function r(){e=0,t.length=0,n.length=0,i.length=0}function o(f,p,m,g,v,y){let x=s[e];return x===void 0?(x={id:f.id,object:f,geometry:p,material:m,groupOrder:g,renderOrder:f.renderOrder,z:v,group:y},s[e]=x):(x.id=f.id,x.object=f,x.geometry=p,x.material=m,x.groupOrder=g,x.renderOrder=f.renderOrder,x.z=v,x.group=y),e++,x}function a(f,p,m,g,v,y){const x=o(f,p,m,g,v,y);m.transmission>0?n.push(x):m.transparent===!0?i.push(x):t.push(x)}function l(f,p,m,g,v,y){const x=o(f,p,m,g,v,y);m.transmission>0?n.unshift(x):m.transparent===!0?i.unshift(x):t.unshift(x)}function h(f,p){t.length>1&&t.sort(f||zD),n.length>1&&n.sort(p||iv),i.length>1&&i.sort(p||iv)}function u(){for(let f=e,p=s.length;f<p;f++){const m=s[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:n,transparent:i,init:r,push:a,unshift:l,finish:u,sort:h}}function VD(){let s=new WeakMap;function e(n,i){const r=s.get(n);let o;return r===void 0?(o=new rv,s.set(n,[o])):i>=r.length?(o=new rv,r.push(o)):o=r[i],o}function t(){s=new WeakMap}return{get:e,dispose:t}}function kD(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new X,color:new ct};break;case"SpotLight":t={position:new X,direction:new X,color:new ct,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new X,color:new ct,distance:0,decay:0};break;case"HemisphereLight":t={direction:new X,skyColor:new ct,groundColor:new ct};break;case"RectAreaLight":t={color:new ct,position:new X,halfWidth:new X,halfHeight:new X};break}return s[e.id]=t,t}}}function GD(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new He};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new He};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new He,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=t,t}}}let HD=0;function WD(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function XD(s,e){const t=new kD,n=GD(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)i.probe.push(new X);const r=new X,o=new Pt,a=new Pt;function l(u,f){let p=0,m=0,g=0;for(let G=0;G<9;G++)i.probe[G].set(0,0,0);let v=0,y=0,x=0,w=0,S=0,E=0,A=0,C=0,P=0,L=0;u.sort(WD);const T=f===!0?Math.PI:1;for(let G=0,K=u.length;G<K;G++){const Z=u[G],O=Z.color,V=Z.intensity,j=Z.distance,q=Z.shadow&&Z.shadow.map?Z.shadow.map.texture:null;if(Z.isAmbientLight)p+=O.r*V*T,m+=O.g*V*T,g+=O.b*V*T;else if(Z.isLightProbe)for(let J=0;J<9;J++)i.probe[J].addScaledVector(Z.sh.coefficients[J],V);else if(Z.isDirectionalLight){const J=t.get(Z);if(J.color.copy(Z.color).multiplyScalar(Z.intensity*T),Z.castShadow){const se=Z.shadow,_e=n.get(Z);_e.shadowBias=se.bias,_e.shadowNormalBias=se.normalBias,_e.shadowRadius=se.radius,_e.shadowMapSize=se.mapSize,i.directionalShadow[v]=_e,i.directionalShadowMap[v]=q,i.directionalShadowMatrix[v]=Z.shadow.matrix,E++}i.directional[v]=J,v++}else if(Z.isSpotLight){const J=t.get(Z);J.position.setFromMatrixPosition(Z.matrixWorld),J.color.copy(O).multiplyScalar(V*T),J.distance=j,J.coneCos=Math.cos(Z.angle),J.penumbraCos=Math.cos(Z.angle*(1-Z.penumbra)),J.decay=Z.decay,i.spot[x]=J;const se=Z.shadow;if(Z.map&&(i.spotLightMap[P]=Z.map,P++,se.updateMatrices(Z),Z.castShadow&&L++),i.spotLightMatrix[x]=se.matrix,Z.castShadow){const _e=n.get(Z);_e.shadowBias=se.bias,_e.shadowNormalBias=se.normalBias,_e.shadowRadius=se.radius,_e.shadowMapSize=se.mapSize,i.spotShadow[x]=_e,i.spotShadowMap[x]=q,C++}x++}else if(Z.isRectAreaLight){const J=t.get(Z);J.color.copy(O).multiplyScalar(V),J.halfWidth.set(Z.width*.5,0,0),J.halfHeight.set(0,Z.height*.5,0),i.rectArea[w]=J,w++}else if(Z.isPointLight){const J=t.get(Z);if(J.color.copy(Z.color).multiplyScalar(Z.intensity*T),J.distance=Z.distance,J.decay=Z.decay,Z.castShadow){const se=Z.shadow,_e=n.get(Z);_e.shadowBias=se.bias,_e.shadowNormalBias=se.normalBias,_e.shadowRadius=se.radius,_e.shadowMapSize=se.mapSize,_e.shadowCameraNear=se.camera.near,_e.shadowCameraFar=se.camera.far,i.pointShadow[y]=_e,i.pointShadowMap[y]=q,i.pointShadowMatrix[y]=Z.shadow.matrix,A++}i.point[y]=J,y++}else if(Z.isHemisphereLight){const J=t.get(Z);J.skyColor.copy(Z.color).multiplyScalar(V*T),J.groundColor.copy(Z.groundColor).multiplyScalar(V*T),i.hemi[S]=J,S++}}w>0&&(e.isWebGL2||s.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=tt.LTC_FLOAT_1,i.rectAreaLTC2=tt.LTC_FLOAT_2):s.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=tt.LTC_HALF_1,i.rectAreaLTC2=tt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=p,i.ambient[1]=m,i.ambient[2]=g;const R=i.hash;(R.directionalLength!==v||R.pointLength!==y||R.spotLength!==x||R.rectAreaLength!==w||R.hemiLength!==S||R.numDirectionalShadows!==E||R.numPointShadows!==A||R.numSpotShadows!==C||R.numSpotMaps!==P)&&(i.directional.length=v,i.spot.length=x,i.rectArea.length=w,i.point.length=y,i.hemi.length=S,i.directionalShadow.length=E,i.directionalShadowMap.length=E,i.pointShadow.length=A,i.pointShadowMap.length=A,i.spotShadow.length=C,i.spotShadowMap.length=C,i.directionalShadowMatrix.length=E,i.pointShadowMatrix.length=A,i.spotLightMatrix.length=C+P-L,i.spotLightMap.length=P,i.numSpotLightShadowsWithMaps=L,R.directionalLength=v,R.pointLength=y,R.spotLength=x,R.rectAreaLength=w,R.hemiLength=S,R.numDirectionalShadows=E,R.numPointShadows=A,R.numSpotShadows=C,R.numSpotMaps=P,i.version=HD++)}function h(u,f){let p=0,m=0,g=0,v=0,y=0;const x=f.matrixWorldInverse;for(let w=0,S=u.length;w<S;w++){const E=u[w];if(E.isDirectionalLight){const A=i.directional[p];A.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(x),p++}else if(E.isSpotLight){const A=i.spot[g];A.position.setFromMatrixPosition(E.matrixWorld),A.position.applyMatrix4(x),A.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(x),g++}else if(E.isRectAreaLight){const A=i.rectArea[v];A.position.setFromMatrixPosition(E.matrixWorld),A.position.applyMatrix4(x),a.identity(),o.copy(E.matrixWorld),o.premultiply(x),a.extractRotation(o),A.halfWidth.set(E.width*.5,0,0),A.halfHeight.set(0,E.height*.5,0),A.halfWidth.applyMatrix4(a),A.halfHeight.applyMatrix4(a),v++}else if(E.isPointLight){const A=i.point[m];A.position.setFromMatrixPosition(E.matrixWorld),A.position.applyMatrix4(x),m++}else if(E.isHemisphereLight){const A=i.hemi[y];A.direction.setFromMatrixPosition(E.matrixWorld),A.direction.transformDirection(x),y++}}}return{setup:l,setupView:h,state:i}}function sv(s,e){const t=new XD(s,e),n=[],i=[];function r(){n.length=0,i.length=0}function o(f){n.push(f)}function a(f){i.push(f)}function l(f){t.setup(n,f)}function h(f){t.setupView(n,f)}return{init:r,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:l,setupLightsView:h,pushLight:o,pushShadow:a}}function YD(s,e){let t=new WeakMap;function n(r,o=0){const a=t.get(r);let l;return a===void 0?(l=new sv(s,e),t.set(r,[l])):o>=a.length?(l=new sv(s,e),a.push(l)):l=a[o],l}function i(){t=new WeakMap}return{get:n,dispose:i}}class Dg extends ri{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Kb,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Ug extends ri{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const jD=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,qD=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function $D(s,e,t){let n=new _f;const i=new He,r=new He,o=new Qt,a=new Dg({depthPacking:Jb}),l=new Ug,h={},u=t.maxTextureSize,f={[ys]:di,[di]:ys,[Or]:Or},p=new kr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new He},radius:{value:4}},vertexShader:jD,fragmentShader:qD}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const g=new Bt;g.setAttribute("position",new tn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new qn(g,p),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_g;let x=this.type;this.render=function(A,C,P){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||A.length===0)return;const L=s.getRenderTarget(),T=s.getActiveCubeFace(),R=s.getActiveMipmapLevel(),G=s.state;G.setBlending(_s),G.buffers.color.setClear(1,1,1,1),G.buffers.depth.setTest(!0),G.setScissorTest(!1);const K=x!==Fr&&this.type===Fr,Z=x===Fr&&this.type!==Fr;for(let O=0,V=A.length;O<V;O++){const j=A[O],q=j.shadow;if(q===void 0){console.warn("THREE.WebGLShadowMap:",j,"has no shadow.");continue}if(q.autoUpdate===!1&&q.needsUpdate===!1)continue;i.copy(q.mapSize);const J=q.getFrameExtents();if(i.multiply(J),r.copy(q.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(r.x=Math.floor(u/J.x),i.x=r.x*J.x,q.mapSize.x=r.x),i.y>u&&(r.y=Math.floor(u/J.y),i.y=r.y*J.y,q.mapSize.y=r.y)),q.map===null||K===!0||Z===!0){const _e=this.type!==Fr?{minFilter:vn,magFilter:vn}:{};q.map!==null&&q.map.dispose(),q.map=new vr(i.x,i.y,_e),q.map.texture.name=j.name+".shadowMap",q.camera.updateProjectionMatrix()}s.setRenderTarget(q.map),s.clear();const se=q.getViewportCount();for(let _e=0;_e<se;_e++){const Re=q.getViewport(_e);o.set(r.x*Re.x,r.y*Re.y,r.x*Re.z,r.y*Re.w),G.viewport(o),q.updateMatrices(j,_e),n=q.getFrustum(),E(C,P,q.camera,j,this.type)}q.isPointLightShadow!==!0&&this.type===Fr&&w(q,P),q.needsUpdate=!1}x=this.type,y.needsUpdate=!1,s.setRenderTarget(L,T,R)};function w(A,C){const P=e.update(v);p.defines.VSM_SAMPLES!==A.blurSamples&&(p.defines.VSM_SAMPLES=A.blurSamples,m.defines.VSM_SAMPLES=A.blurSamples,p.needsUpdate=!0,m.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new vr(i.x,i.y)),p.uniforms.shadow_pass.value=A.map.texture,p.uniforms.resolution.value=A.mapSize,p.uniforms.radius.value=A.radius,s.setRenderTarget(A.mapPass),s.clear(),s.renderBufferDirect(C,null,P,p,v,null),m.uniforms.shadow_pass.value=A.mapPass.texture,m.uniforms.resolution.value=A.mapSize,m.uniforms.radius.value=A.radius,s.setRenderTarget(A.map),s.clear(),s.renderBufferDirect(C,null,P,m,v,null)}function S(A,C,P,L){let T=null;const R=P.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(R!==void 0)T=R;else if(T=P.isPointLight===!0?l:a,s.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0){const G=T.uuid,K=C.uuid;let Z=h[G];Z===void 0&&(Z={},h[G]=Z);let O=Z[K];O===void 0&&(O=T.clone(),Z[K]=O),T=O}if(T.visible=C.visible,T.wireframe=C.wireframe,L===Fr?T.side=C.shadowSide!==null?C.shadowSide:C.side:T.side=C.shadowSide!==null?C.shadowSide:f[C.side],T.alphaMap=C.alphaMap,T.alphaTest=C.alphaTest,T.map=C.map,T.clipShadows=C.clipShadows,T.clippingPlanes=C.clippingPlanes,T.clipIntersection=C.clipIntersection,T.displacementMap=C.displacementMap,T.displacementScale=C.displacementScale,T.displacementBias=C.displacementBias,T.wireframeLinewidth=C.wireframeLinewidth,T.linewidth=C.linewidth,P.isPointLight===!0&&T.isMeshDistanceMaterial===!0){const G=s.properties.get(T);G.light=P}return T}function E(A,C,P,L,T){if(A.visible===!1)return;if(A.layers.test(C.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&T===Fr)&&(!A.frustumCulled||n.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,A.matrixWorld);const K=e.update(A),Z=A.material;if(Array.isArray(Z)){const O=K.groups;for(let V=0,j=O.length;V<j;V++){const q=O[V],J=Z[q.materialIndex];if(J&&J.visible){const se=S(A,J,L,T);s.renderBufferDirect(P,null,K,se,A,q)}}}else if(Z.visible){const O=S(A,Z,L,T);s.renderBufferDirect(P,null,K,O,A,null)}}const G=A.children;for(let K=0,Z=G.length;K<Z;K++)E(G[K],C,P,L,T)}}function ZD(s,e,t){const n=t.isWebGL2;function i(){let Y=!1;const Ve=new Qt;let me=null;const xe=new Qt(0,0,0,0);return{setMask:function(Pe){me!==Pe&&!Y&&(s.colorMask(Pe,Pe,Pe,Pe),me=Pe)},setLocked:function(Pe){Y=Pe},setClear:function(Pe,Qe,ie,at,ce){ce===!0&&(Pe*=at,Qe*=at,ie*=at),Ve.set(Pe,Qe,ie,at),xe.equals(Ve)===!1&&(s.clearColor(Pe,Qe,ie,at),xe.copy(Ve))},reset:function(){Y=!1,me=null,xe.set(-1,0,0,0)}}}function r(){let Y=!1,Ve=null,me=null,xe=null;return{setTest:function(Pe){Pe?ke(s.DEPTH_TEST):Ye(s.DEPTH_TEST)},setMask:function(Pe){Ve!==Pe&&!Y&&(s.depthMask(Pe),Ve=Pe)},setFunc:function(Pe){if(me!==Pe){switch(Pe){case Eb:s.depthFunc(s.NEVER);break;case Ab:s.depthFunc(s.ALWAYS);break;case Tb:s.depthFunc(s.LESS);break;case $d:s.depthFunc(s.LEQUAL);break;case Cb:s.depthFunc(s.EQUAL);break;case Rb:s.depthFunc(s.GEQUAL);break;case Pb:s.depthFunc(s.GREATER);break;case Ib:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}me=Pe}},setLocked:function(Pe){Y=Pe},setClear:function(Pe){xe!==Pe&&(s.clearDepth(Pe),xe=Pe)},reset:function(){Y=!1,Ve=null,me=null,xe=null}}}function o(){let Y=!1,Ve=null,me=null,xe=null,Pe=null,Qe=null,ie=null,at=null,ce=null;return{setTest:function(wt){Y||(wt?ke(s.STENCIL_TEST):Ye(s.STENCIL_TEST))},setMask:function(wt){Ve!==wt&&!Y&&(s.stencilMask(wt),Ve=wt)},setFunc:function(wt,be,Et){(me!==wt||xe!==be||Pe!==Et)&&(s.stencilFunc(wt,be,Et),me=wt,xe=be,Pe=Et)},setOp:function(wt,be,Et){(Qe!==wt||ie!==be||at!==Et)&&(s.stencilOp(wt,be,Et),Qe=wt,ie=be,at=Et)},setLocked:function(wt){Y=wt},setClear:function(wt){ce!==wt&&(s.clearStencil(wt),ce=wt)},reset:function(){Y=!1,Ve=null,me=null,xe=null,Pe=null,Qe=null,ie=null,at=null,ce=null}}}const a=new i,l=new r,h=new o,u=new WeakMap,f=new WeakMap;let p={},m={},g=new WeakMap,v=[],y=null,x=!1,w=null,S=null,E=null,A=null,C=null,P=null,L=null,T=!1,R=null,G=null,K=null,Z=null,O=null;const V=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let j=!1,q=0;const J=s.getParameter(s.VERSION);J.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\d)/.exec(J)[1]),j=q>=1):J.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),j=q>=2);let se=null,_e={};const Re=s.getParameter(s.SCISSOR_BOX),ae=s.getParameter(s.VIEWPORT),ve=new Qt().fromArray(Re),oe=new Qt().fromArray(ae);function Ce(Y,Ve,me,xe){const Pe=new Uint8Array(4),Qe=s.createTexture();s.bindTexture(Y,Qe),s.texParameteri(Y,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(Y,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let ie=0;ie<me;ie++)n&&(Y===s.TEXTURE_3D||Y===s.TEXTURE_2D_ARRAY)?s.texImage3D(Ve,0,s.RGBA,1,1,xe,0,s.RGBA,s.UNSIGNED_BYTE,Pe):s.texImage2D(Ve+ie,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,Pe);return Qe}const Ie={};Ie[s.TEXTURE_2D]=Ce(s.TEXTURE_2D,s.TEXTURE_2D,1),Ie[s.TEXTURE_CUBE_MAP]=Ce(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Ie[s.TEXTURE_2D_ARRAY]=Ce(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),Ie[s.TEXTURE_3D]=Ce(s.TEXTURE_3D,s.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),h.setClear(0),ke(s.DEPTH_TEST),l.setFunc($d),fe(!1),De(u0),ke(s.CULL_FACE),Q(_s);function ke(Y){p[Y]!==!0&&(s.enable(Y),p[Y]=!0)}function Ye(Y){p[Y]!==!1&&(s.disable(Y),p[Y]=!1)}function $e(Y,Ve){return m[Y]!==Ve?(s.bindFramebuffer(Y,Ve),m[Y]=Ve,n&&(Y===s.DRAW_FRAMEBUFFER&&(m[s.FRAMEBUFFER]=Ve),Y===s.FRAMEBUFFER&&(m[s.DRAW_FRAMEBUFFER]=Ve)),!0):!1}function et(Y,Ve){let me=v,xe=!1;if(Y)if(me=g.get(Ve),me===void 0&&(me=[],g.set(Ve,me)),Y.isWebGLMultipleRenderTargets){const Pe=Y.texture;if(me.length!==Pe.length||me[0]!==s.COLOR_ATTACHMENT0){for(let Qe=0,ie=Pe.length;Qe<ie;Qe++)me[Qe]=s.COLOR_ATTACHMENT0+Qe;me.length=Pe.length,xe=!0}}else me[0]!==s.COLOR_ATTACHMENT0&&(me[0]=s.COLOR_ATTACHMENT0,xe=!0);else me[0]!==s.BACK&&(me[0]=s.BACK,xe=!0);xe&&(t.isWebGL2?s.drawBuffers(me):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(me))}function Ke(Y){return y!==Y?(s.useProgram(Y),y=Y,!0):!1}const W={[zo]:s.FUNC_ADD,[pb]:s.FUNC_SUBTRACT,[mb]:s.FUNC_REVERSE_SUBTRACT};if(n)W[m0]=s.MIN,W[g0]=s.MAX;else{const Y=e.get("EXT_blend_minmax");Y!==null&&(W[m0]=Y.MIN_EXT,W[g0]=Y.MAX_EXT)}const Le={[gb]:s.ZERO,[_b]:s.ONE,[xb]:s.SRC_COLOR,[xg]:s.SRC_ALPHA,[Mb]:s.SRC_ALPHA_SATURATE,[bb]:s.DST_COLOR,[vb]:s.DST_ALPHA,[yb]:s.ONE_MINUS_SRC_COLOR,[yg]:s.ONE_MINUS_SRC_ALPHA,[wb]:s.ONE_MINUS_DST_COLOR,[Sb]:s.ONE_MINUS_DST_ALPHA};function Q(Y,Ve,me,xe,Pe,Qe,ie,at){if(Y===_s){x===!0&&(Ye(s.BLEND),x=!1);return}if(x===!1&&(ke(s.BLEND),x=!0),Y!==fb){if(Y!==w||at!==T){if((S!==zo||C!==zo)&&(s.blendEquation(s.FUNC_ADD),S=zo,C=zo),at)switch(Y){case Yo:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case d0:s.blendFunc(s.ONE,s.ONE);break;case f0:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case p0:s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Y);break}else switch(Y){case Yo:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case d0:s.blendFunc(s.SRC_ALPHA,s.ONE);break;case f0:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case p0:s.blendFunc(s.ZERO,s.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Y);break}E=null,A=null,P=null,L=null,w=Y,T=at}return}Pe=Pe||Ve,Qe=Qe||me,ie=ie||xe,(Ve!==S||Pe!==C)&&(s.blendEquationSeparate(W[Ve],W[Pe]),S=Ve,C=Pe),(me!==E||xe!==A||Qe!==P||ie!==L)&&(s.blendFuncSeparate(Le[me],Le[xe],Le[Qe],Le[ie]),E=me,A=xe,P=Qe,L=ie),w=Y,T=!1}function he(Y,Ve){Y.side===Or?Ye(s.CULL_FACE):ke(s.CULL_FACE);let me=Y.side===di;Ve&&(me=!me),fe(me),Y.blending===Yo&&Y.transparent===!1?Q(_s):Q(Y.blending,Y.blendEquation,Y.blendSrc,Y.blendDst,Y.blendEquationAlpha,Y.blendSrcAlpha,Y.blendDstAlpha,Y.premultipliedAlpha),l.setFunc(Y.depthFunc),l.setTest(Y.depthTest),l.setMask(Y.depthWrite),a.setMask(Y.colorWrite);const xe=Y.stencilWrite;h.setTest(xe),xe&&(h.setMask(Y.stencilWriteMask),h.setFunc(Y.stencilFunc,Y.stencilRef,Y.stencilFuncMask),h.setOp(Y.stencilFail,Y.stencilZFail,Y.stencilZPass)),qe(Y.polygonOffset,Y.polygonOffsetFactor,Y.polygonOffsetUnits),Y.alphaToCoverage===!0?ke(s.SAMPLE_ALPHA_TO_COVERAGE):Ye(s.SAMPLE_ALPHA_TO_COVERAGE)}function fe(Y){R!==Y&&(Y?s.frontFace(s.CW):s.frontFace(s.CCW),R=Y)}function De(Y){Y!==hb?(ke(s.CULL_FACE),Y!==G&&(Y===u0?s.cullFace(s.BACK):Y===ub?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):Ye(s.CULL_FACE),G=Y}function je(Y){Y!==K&&(j&&s.lineWidth(Y),K=Y)}function qe(Y,Ve,me){Y?(ke(s.POLYGON_OFFSET_FILL),(Z!==Ve||O!==me)&&(s.polygonOffset(Ve,me),Z=Ve,O=me)):Ye(s.POLYGON_OFFSET_FILL)}function it(Y){Y?ke(s.SCISSOR_TEST):Ye(s.SCISSOR_TEST)}function ot(Y){Y===void 0&&(Y=s.TEXTURE0+V-1),se!==Y&&(s.activeTexture(Y),se=Y)}function _t(Y,Ve,me){me===void 0&&(se===null?me=s.TEXTURE0+V-1:me=se);let xe=_e[me];xe===void 0&&(xe={type:void 0,texture:void 0},_e[me]=xe),(xe.type!==Y||xe.texture!==Ve)&&(se!==me&&(s.activeTexture(me),se=me),s.bindTexture(Y,Ve||Ie[Y]),xe.type=Y,xe.texture=Ve)}function H(){const Y=_e[se];Y!==void 0&&Y.type!==void 0&&(s.bindTexture(Y.type,null),Y.type=void 0,Y.texture=void 0)}function U(){try{s.compressedTexImage2D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function we(){try{s.compressedTexImage3D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function We(){try{s.texSubImage2D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Ge(){try{s.texSubImage3D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Je(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function nt(){try{s.compressedTexSubImage3D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function N(){try{s.texStorage2D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function F(){try{s.texStorage3D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function k(){try{s.texImage2D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function ee(){try{s.texImage3D.apply(s,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function ne(Y){ve.equals(Y)===!1&&(s.scissor(Y.x,Y.y,Y.z,Y.w),ve.copy(Y))}function ye(Y){oe.equals(Y)===!1&&(s.viewport(Y.x,Y.y,Y.z,Y.w),oe.copy(Y))}function ue(Y,Ve){let me=f.get(Ve);me===void 0&&(me=new WeakMap,f.set(Ve,me));let xe=me.get(Y);xe===void 0&&(xe=s.getUniformBlockIndex(Ve,Y.name),me.set(Y,xe))}function Ue(Y,Ve){const xe=f.get(Ve).get(Y);u.get(Ve)!==xe&&(s.uniformBlockBinding(Ve,xe,Y.__bindingPointIndex),u.set(Ve,xe))}function Ze(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),n===!0&&(s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null)),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),p={},se=null,_e={},m={},g=new WeakMap,v=[],y=null,x=!1,w=null,S=null,E=null,A=null,C=null,P=null,L=null,T=!1,R=null,G=null,K=null,Z=null,O=null,ve.set(0,0,s.canvas.width,s.canvas.height),oe.set(0,0,s.canvas.width,s.canvas.height),a.reset(),l.reset(),h.reset()}return{buffers:{color:a,depth:l,stencil:h},enable:ke,disable:Ye,bindFramebuffer:$e,drawBuffers:et,useProgram:Ke,setBlending:Q,setMaterial:he,setFlipSided:fe,setCullFace:De,setLineWidth:je,setPolygonOffset:qe,setScissorTest:it,activeTexture:ot,bindTexture:_t,unbindTexture:H,compressedTexImage2D:U,compressedTexImage3D:we,texImage2D:k,texImage3D:ee,updateUBOMapping:ue,uniformBlockBinding:Ue,texStorage2D:N,texStorage3D:F,texSubImage2D:We,texSubImage3D:Ge,compressedTexSubImage2D:Je,compressedTexSubImage3D:nt,scissor:ne,viewport:ye,reset:Ze}}function KD(s,e,t,n,i,r,o){const a=i.isWebGL2,l=i.maxTextures,h=i.maxCubemapSize,u=i.maxTextureSize,f=i.maxSamples,p=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,m=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap;let v;const y=new WeakMap;let x=!1;try{x=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function w(H,U){return x?new OffscreenCanvas(H,U):qc("canvas")}function S(H,U,we,We){let Ge=1;if((H.width>We||H.height>We)&&(Ge=We/Math.max(H.width,H.height)),Ge<1||U===!0)if(typeof HTMLImageElement<"u"&&H instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&H instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&H instanceof ImageBitmap){const Je=U?Jd:Math.floor,nt=Je(Ge*H.width),N=Je(Ge*H.height);v===void 0&&(v=w(nt,N));const F=we?w(nt,N):v;return F.width=nt,F.height=N,F.getContext("2d").drawImage(H,0,0,nt,N),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+H.width+"x"+H.height+") to ("+nt+"x"+N+")."),F}else return"data"in H&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+H.width+"x"+H.height+")."),H;return H}function E(H){return k0(H.width)&&k0(H.height)}function A(H){return a?!1:H.wrapS!==ii||H.wrapT!==ii||H.minFilter!==vn&&H.minFilter!==Sn}function C(H,U){return H.generateMipmaps&&U&&H.minFilter!==vn&&H.minFilter!==Sn}function P(H){s.generateMipmap(H)}function L(H,U,we,We,Ge=!1){if(a===!1)return U;if(H!==null){if(s[H]!==void 0)return s[H];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+H+"'")}let Je=U;return U===s.RED&&(we===s.FLOAT&&(Je=s.R32F),we===s.HALF_FLOAT&&(Je=s.R16F),we===s.UNSIGNED_BYTE&&(Je=s.R8)),U===s.RG&&(we===s.FLOAT&&(Je=s.RG32F),we===s.HALF_FLOAT&&(Je=s.RG16F),we===s.UNSIGNED_BYTE&&(Je=s.RG8)),U===s.RGBA&&(we===s.FLOAT&&(Je=s.RGBA32F),we===s.HALF_FLOAT&&(Je=s.RGBA16F),we===s.UNSIGNED_BYTE&&(Je=We===It&&Ge===!1?s.SRGB8_ALPHA8:s.RGBA8),we===s.UNSIGNED_SHORT_4_4_4_4&&(Je=s.RGBA4),we===s.UNSIGNED_SHORT_5_5_5_1&&(Je=s.RGB5_A1)),(Je===s.R16F||Je===s.R32F||Je===s.RG16F||Je===s.RG32F||Je===s.RGBA16F||Je===s.RGBA32F)&&e.get("EXT_color_buffer_float"),Je}function T(H,U,we){return C(H,we)===!0||H.isFramebufferTexture&&H.minFilter!==vn&&H.minFilter!==Sn?Math.log2(Math.max(U.width,U.height))+1:H.mipmaps!==void 0&&H.mipmaps.length>0?H.mipmaps.length:H.isCompressedTexture&&Array.isArray(H.image)?U.mipmaps.length:1}function R(H){return H===vn||H===Zd||H===Nc?s.NEAREST:s.LINEAR}function G(H){const U=H.target;U.removeEventListener("dispose",G),Z(U),U.isVideoTexture&&g.delete(U)}function K(H){const U=H.target;U.removeEventListener("dispose",K),V(U)}function Z(H){const U=n.get(H);if(U.__webglInit===void 0)return;const we=H.source,We=y.get(we);if(We){const Ge=We[U.__cacheKey];Ge.usedTimes--,Ge.usedTimes===0&&O(H),Object.keys(We).length===0&&y.delete(we)}n.remove(H)}function O(H){const U=n.get(H);s.deleteTexture(U.__webglTexture);const we=H.source,We=y.get(we);delete We[U.__cacheKey],o.memory.textures--}function V(H){const U=H.texture,we=n.get(H),We=n.get(U);if(We.__webglTexture!==void 0&&(s.deleteTexture(We.__webglTexture),o.memory.textures--),H.depthTexture&&H.depthTexture.dispose(),H.isWebGLCubeRenderTarget)for(let Ge=0;Ge<6;Ge++)s.deleteFramebuffer(we.__webglFramebuffer[Ge]),we.__webglDepthbuffer&&s.deleteRenderbuffer(we.__webglDepthbuffer[Ge]);else{if(s.deleteFramebuffer(we.__webglFramebuffer),we.__webglDepthbuffer&&s.deleteRenderbuffer(we.__webglDepthbuffer),we.__webglMultisampledFramebuffer&&s.deleteFramebuffer(we.__webglMultisampledFramebuffer),we.__webglColorRenderbuffer)for(let Ge=0;Ge<we.__webglColorRenderbuffer.length;Ge++)we.__webglColorRenderbuffer[Ge]&&s.deleteRenderbuffer(we.__webglColorRenderbuffer[Ge]);we.__webglDepthRenderbuffer&&s.deleteRenderbuffer(we.__webglDepthRenderbuffer)}if(H.isWebGLMultipleRenderTargets)for(let Ge=0,Je=U.length;Ge<Je;Ge++){const nt=n.get(U[Ge]);nt.__webglTexture&&(s.deleteTexture(nt.__webglTexture),o.memory.textures--),n.remove(U[Ge])}n.remove(U),n.remove(H)}let j=0;function q(){j=0}function J(){const H=j;return H>=l&&console.warn("THREE.WebGLTextures: Trying to use "+H+" texture units while this GPU supports only "+l),j+=1,H}function se(H){const U=[];return U.push(H.wrapS),U.push(H.wrapT),U.push(H.wrapR||0),U.push(H.magFilter),U.push(H.minFilter),U.push(H.anisotropy),U.push(H.internalFormat),U.push(H.format),U.push(H.type),U.push(H.generateMipmaps),U.push(H.premultiplyAlpha),U.push(H.flipY),U.push(H.unpackAlignment),U.push(H.colorSpace),U.join()}function _e(H,U){const we=n.get(H);if(H.isVideoTexture&&ot(H),H.isRenderTargetTexture===!1&&H.version>0&&we.__version!==H.version){const We=H.image;if(We===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(We.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{$e(we,H,U);return}}t.bindTexture(s.TEXTURE_2D,we.__webglTexture,s.TEXTURE0+U)}function Re(H,U){const we=n.get(H);if(H.version>0&&we.__version!==H.version){$e(we,H,U);return}t.bindTexture(s.TEXTURE_2D_ARRAY,we.__webglTexture,s.TEXTURE0+U)}function ae(H,U){const we=n.get(H);if(H.version>0&&we.__version!==H.version){$e(we,H,U);return}t.bindTexture(s.TEXTURE_3D,we.__webglTexture,s.TEXTURE0+U)}function ve(H,U){const we=n.get(H);if(H.version>0&&we.__version!==H.version){et(we,H,U);return}t.bindTexture(s.TEXTURE_CUBE_MAP,we.__webglTexture,s.TEXTURE0+U)}const oe={[kc]:s.REPEAT,[ii]:s.CLAMP_TO_EDGE,[Gc]:s.MIRRORED_REPEAT},Ce={[vn]:s.NEAREST,[Zd]:s.NEAREST_MIPMAP_NEAREST,[Nc]:s.NEAREST_MIPMAP_LINEAR,[Sn]:s.LINEAR,[vg]:s.LINEAR_MIPMAP_NEAREST,[oo]:s.LINEAR_MIPMAP_LINEAR},Ie={[tw]:s.NEVER,[lw]:s.ALWAYS,[nw]:s.LESS,[rw]:s.LEQUAL,[iw]:s.EQUAL,[aw]:s.GEQUAL,[sw]:s.GREATER,[ow]:s.NOTEQUAL};function ke(H,U,we){if(we?(s.texParameteri(H,s.TEXTURE_WRAP_S,oe[U.wrapS]),s.texParameteri(H,s.TEXTURE_WRAP_T,oe[U.wrapT]),(H===s.TEXTURE_3D||H===s.TEXTURE_2D_ARRAY)&&s.texParameteri(H,s.TEXTURE_WRAP_R,oe[U.wrapR]),s.texParameteri(H,s.TEXTURE_MAG_FILTER,Ce[U.magFilter]),s.texParameteri(H,s.TEXTURE_MIN_FILTER,Ce[U.minFilter])):(s.texParameteri(H,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(H,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),(H===s.TEXTURE_3D||H===s.TEXTURE_2D_ARRAY)&&s.texParameteri(H,s.TEXTURE_WRAP_R,s.CLAMP_TO_EDGE),(U.wrapS!==ii||U.wrapT!==ii)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),s.texParameteri(H,s.TEXTURE_MAG_FILTER,R(U.magFilter)),s.texParameteri(H,s.TEXTURE_MIN_FILTER,R(U.minFilter)),U.minFilter!==vn&&U.minFilter!==Sn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),U.compareFunction&&(s.texParameteri(H,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(H,s.TEXTURE_COMPARE_FUNC,Ie[U.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const We=e.get("EXT_texture_filter_anisotropic");if(U.magFilter===vn||U.minFilter!==Nc&&U.minFilter!==oo||U.type===Dr&&e.has("OES_texture_float_linear")===!1||a===!1&&U.type===vl&&e.has("OES_texture_half_float_linear")===!1)return;(U.anisotropy>1||n.get(U).__currentAnisotropy)&&(s.texParameterf(H,We.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(U.anisotropy,i.getMaxAnisotropy())),n.get(U).__currentAnisotropy=U.anisotropy)}}function Ye(H,U){let we=!1;H.__webglInit===void 0&&(H.__webglInit=!0,U.addEventListener("dispose",G));const We=U.source;let Ge=y.get(We);Ge===void 0&&(Ge={},y.set(We,Ge));const Je=se(U);if(Je!==H.__cacheKey){Ge[Je]===void 0&&(Ge[Je]={texture:s.createTexture(),usedTimes:0},o.memory.textures++,we=!0),Ge[Je].usedTimes++;const nt=Ge[H.__cacheKey];nt!==void 0&&(Ge[H.__cacheKey].usedTimes--,nt.usedTimes===0&&O(U)),H.__cacheKey=Je,H.__webglTexture=Ge[Je].texture}return we}function $e(H,U,we){let We=s.TEXTURE_2D;(U.isDataArrayTexture||U.isCompressedArrayTexture)&&(We=s.TEXTURE_2D_ARRAY),U.isData3DTexture&&(We=s.TEXTURE_3D);const Ge=Ye(H,U),Je=U.source;t.bindTexture(We,H.__webglTexture,s.TEXTURE0+we);const nt=n.get(Je);if(Je.version!==nt.__version||Ge===!0){t.activeTexture(s.TEXTURE0+we),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,U.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,U.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,U.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE);const N=A(U)&&E(U.image)===!1;let F=S(U.image,N,!1,u);F=_t(U,F);const k=E(F)||a,ee=r.convert(U.format,U.colorSpace);let ne=r.convert(U.type),ye=L(U.internalFormat,ee,ne,U.colorSpace);ke(We,U,k);let ue;const Ue=U.mipmaps,Ze=a&&U.isVideoTexture!==!0,Y=nt.__version===void 0||Ge===!0,Ve=T(U,F,k);if(U.isDepthTexture)ye=s.DEPTH_COMPONENT,a?U.type===Dr?ye=s.DEPTH_COMPONENT32F:U.type===ms?ye=s.DEPTH_COMPONENT24:U.type===Qs?ye=s.DEPTH24_STENCIL8:ye=s.DEPTH_COMPONENT16:U.type===Dr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),U.format===eo&&ye===s.DEPTH_COMPONENT&&U.type!==df&&U.type!==ms&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),U.type=ms,ne=r.convert(U.type)),U.format===$o&&ye===s.DEPTH_COMPONENT&&(ye=s.DEPTH_STENCIL,U.type!==Qs&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),U.type=Qs,ne=r.convert(U.type))),Y&&(Ze?t.texStorage2D(s.TEXTURE_2D,1,ye,F.width,F.height):t.texImage2D(s.TEXTURE_2D,0,ye,F.width,F.height,0,ee,ne,null));else if(U.isDataTexture)if(Ue.length>0&&k){Ze&&Y&&t.texStorage2D(s.TEXTURE_2D,Ve,ye,Ue[0].width,Ue[0].height);for(let me=0,xe=Ue.length;me<xe;me++)ue=Ue[me],Ze?t.texSubImage2D(s.TEXTURE_2D,me,0,0,ue.width,ue.height,ee,ne,ue.data):t.texImage2D(s.TEXTURE_2D,me,ye,ue.width,ue.height,0,ee,ne,ue.data);U.generateMipmaps=!1}else Ze?(Y&&t.texStorage2D(s.TEXTURE_2D,Ve,ye,F.width,F.height),t.texSubImage2D(s.TEXTURE_2D,0,0,0,F.width,F.height,ee,ne,F.data)):t.texImage2D(s.TEXTURE_2D,0,ye,F.width,F.height,0,ee,ne,F.data);else if(U.isCompressedTexture)if(U.isCompressedArrayTexture){Ze&&Y&&t.texStorage3D(s.TEXTURE_2D_ARRAY,Ve,ye,Ue[0].width,Ue[0].height,F.depth);for(let me=0,xe=Ue.length;me<xe;me++)ue=Ue[me],U.format!==Vi?ee!==null?Ze?t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,me,0,0,0,ue.width,ue.height,F.depth,ee,ue.data,0,0):t.compressedTexImage3D(s.TEXTURE_2D_ARRAY,me,ye,ue.width,ue.height,F.depth,0,ue.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ze?t.texSubImage3D(s.TEXTURE_2D_ARRAY,me,0,0,0,ue.width,ue.height,F.depth,ee,ne,ue.data):t.texImage3D(s.TEXTURE_2D_ARRAY,me,ye,ue.width,ue.height,F.depth,0,ee,ne,ue.data)}else{Ze&&Y&&t.texStorage2D(s.TEXTURE_2D,Ve,ye,Ue[0].width,Ue[0].height);for(let me=0,xe=Ue.length;me<xe;me++)ue=Ue[me],U.format!==Vi?ee!==null?Ze?t.compressedTexSubImage2D(s.TEXTURE_2D,me,0,0,ue.width,ue.height,ee,ue.data):t.compressedTexImage2D(s.TEXTURE_2D,me,ye,ue.width,ue.height,0,ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ze?t.texSubImage2D(s.TEXTURE_2D,me,0,0,ue.width,ue.height,ee,ne,ue.data):t.texImage2D(s.TEXTURE_2D,me,ye,ue.width,ue.height,0,ee,ne,ue.data)}else if(U.isDataArrayTexture)Ze?(Y&&t.texStorage3D(s.TEXTURE_2D_ARRAY,Ve,ye,F.width,F.height,F.depth),t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,F.width,F.height,F.depth,ee,ne,F.data)):t.texImage3D(s.TEXTURE_2D_ARRAY,0,ye,F.width,F.height,F.depth,0,ee,ne,F.data);else if(U.isData3DTexture)Ze?(Y&&t.texStorage3D(s.TEXTURE_3D,Ve,ye,F.width,F.height,F.depth),t.texSubImage3D(s.TEXTURE_3D,0,0,0,0,F.width,F.height,F.depth,ee,ne,F.data)):t.texImage3D(s.TEXTURE_3D,0,ye,F.width,F.height,F.depth,0,ee,ne,F.data);else if(U.isFramebufferTexture){if(Y)if(Ze)t.texStorage2D(s.TEXTURE_2D,Ve,ye,F.width,F.height);else{let me=F.width,xe=F.height;for(let Pe=0;Pe<Ve;Pe++)t.texImage2D(s.TEXTURE_2D,Pe,ye,me,xe,0,ee,ne,null),me>>=1,xe>>=1}}else if(Ue.length>0&&k){Ze&&Y&&t.texStorage2D(s.TEXTURE_2D,Ve,ye,Ue[0].width,Ue[0].height);for(let me=0,xe=Ue.length;me<xe;me++)ue=Ue[me],Ze?t.texSubImage2D(s.TEXTURE_2D,me,0,0,ee,ne,ue):t.texImage2D(s.TEXTURE_2D,me,ye,ee,ne,ue);U.generateMipmaps=!1}else Ze?(Y&&t.texStorage2D(s.TEXTURE_2D,Ve,ye,F.width,F.height),t.texSubImage2D(s.TEXTURE_2D,0,0,0,ee,ne,F)):t.texImage2D(s.TEXTURE_2D,0,ye,ee,ne,F);C(U,k)&&P(We),nt.__version=Je.version,U.onUpdate&&U.onUpdate(U)}H.__version=U.version}function et(H,U,we){if(U.image.length!==6)return;const We=Ye(H,U),Ge=U.source;t.bindTexture(s.TEXTURE_CUBE_MAP,H.__webglTexture,s.TEXTURE0+we);const Je=n.get(Ge);if(Ge.version!==Je.__version||We===!0){t.activeTexture(s.TEXTURE0+we),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,U.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,U.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,U.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE);const nt=U.isCompressedTexture||U.image[0].isCompressedTexture,N=U.image[0]&&U.image[0].isDataTexture,F=[];for(let me=0;me<6;me++)!nt&&!N?F[me]=S(U.image[me],!1,!0,h):F[me]=N?U.image[me].image:U.image[me],F[me]=_t(U,F[me]);const k=F[0],ee=E(k)||a,ne=r.convert(U.format,U.colorSpace),ye=r.convert(U.type),ue=L(U.internalFormat,ne,ye,U.colorSpace),Ue=a&&U.isVideoTexture!==!0,Ze=Je.__version===void 0||We===!0;let Y=T(U,k,ee);ke(s.TEXTURE_CUBE_MAP,U,ee);let Ve;if(nt){Ue&&Ze&&t.texStorage2D(s.TEXTURE_CUBE_MAP,Y,ue,k.width,k.height);for(let me=0;me<6;me++){Ve=F[me].mipmaps;for(let xe=0;xe<Ve.length;xe++){const Pe=Ve[xe];U.format!==Vi?ne!==null?Ue?t.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,xe,0,0,Pe.width,Pe.height,ne,Pe.data):t.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,xe,ue,Pe.width,Pe.height,0,Pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ue?t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,xe,0,0,Pe.width,Pe.height,ne,ye,Pe.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,xe,ue,Pe.width,Pe.height,0,ne,ye,Pe.data)}}}else{Ve=U.mipmaps,Ue&&Ze&&(Ve.length>0&&Y++,t.texStorage2D(s.TEXTURE_CUBE_MAP,Y,ue,F[0].width,F[0].height));for(let me=0;me<6;me++)if(N){Ue?t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,0,0,F[me].width,F[me].height,ne,ye,F[me].data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,ue,F[me].width,F[me].height,0,ne,ye,F[me].data);for(let xe=0;xe<Ve.length;xe++){const Qe=Ve[xe].image[me].image;Ue?t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,xe+1,0,0,Qe.width,Qe.height,ne,ye,Qe.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,xe+1,ue,Qe.width,Qe.height,0,ne,ye,Qe.data)}}else{Ue?t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,0,0,ne,ye,F[me]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,ue,ne,ye,F[me]);for(let xe=0;xe<Ve.length;xe++){const Pe=Ve[xe];Ue?t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,xe+1,0,0,ne,ye,Pe.image[me]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+me,xe+1,ue,ne,ye,Pe.image[me])}}}C(U,ee)&&P(s.TEXTURE_CUBE_MAP),Je.__version=Ge.version,U.onUpdate&&U.onUpdate(U)}H.__version=U.version}function Ke(H,U,we,We,Ge){const Je=r.convert(we.format,we.colorSpace),nt=r.convert(we.type),N=L(we.internalFormat,Je,nt,we.colorSpace);n.get(U).__hasExternalTextures||(Ge===s.TEXTURE_3D||Ge===s.TEXTURE_2D_ARRAY?t.texImage3D(Ge,0,N,U.width,U.height,U.depth,0,Je,nt,null):t.texImage2D(Ge,0,N,U.width,U.height,0,Je,nt,null)),t.bindFramebuffer(s.FRAMEBUFFER,H),it(U)?p.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,We,Ge,n.get(we).__webglTexture,0,qe(U)):(Ge===s.TEXTURE_2D||Ge>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&Ge<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,We,Ge,n.get(we).__webglTexture,0),t.bindFramebuffer(s.FRAMEBUFFER,null)}function W(H,U,we){if(s.bindRenderbuffer(s.RENDERBUFFER,H),U.depthBuffer&&!U.stencilBuffer){let We=s.DEPTH_COMPONENT16;if(we||it(U)){const Ge=U.depthTexture;Ge&&Ge.isDepthTexture&&(Ge.type===Dr?We=s.DEPTH_COMPONENT32F:Ge.type===ms&&(We=s.DEPTH_COMPONENT24));const Je=qe(U);it(U)?p.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Je,We,U.width,U.height):s.renderbufferStorageMultisample(s.RENDERBUFFER,Je,We,U.width,U.height)}else s.renderbufferStorage(s.RENDERBUFFER,We,U.width,U.height);s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,H)}else if(U.depthBuffer&&U.stencilBuffer){const We=qe(U);we&&it(U)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,We,s.DEPTH24_STENCIL8,U.width,U.height):it(U)?p.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,We,s.DEPTH24_STENCIL8,U.width,U.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,U.width,U.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,H)}else{const We=U.isWebGLMultipleRenderTargets===!0?U.texture:[U.texture];for(let Ge=0;Ge<We.length;Ge++){const Je=We[Ge],nt=r.convert(Je.format,Je.colorSpace),N=r.convert(Je.type),F=L(Je.internalFormat,nt,N,Je.colorSpace),k=qe(U);we&&it(U)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,k,F,U.width,U.height):it(U)?p.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,k,F,U.width,U.height):s.renderbufferStorage(s.RENDERBUFFER,F,U.width,U.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function Le(H,U){if(U&&U.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(s.FRAMEBUFFER,H),!(U.depthTexture&&U.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(U.depthTexture).__webglTexture||U.depthTexture.image.width!==U.width||U.depthTexture.image.height!==U.height)&&(U.depthTexture.image.width=U.width,U.depthTexture.image.height=U.height,U.depthTexture.needsUpdate=!0),_e(U.depthTexture,0);const We=n.get(U.depthTexture).__webglTexture,Ge=qe(U);if(U.depthTexture.format===eo)it(U)?p.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,We,0,Ge):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,We,0);else if(U.depthTexture.format===$o)it(U)?p.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,We,0,Ge):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,We,0);else throw new Error("Unknown depthTexture format")}function Q(H){const U=n.get(H),we=H.isWebGLCubeRenderTarget===!0;if(H.depthTexture&&!U.__autoAllocateDepthBuffer){if(we)throw new Error("target.depthTexture not supported in Cube render targets");Le(U.__webglFramebuffer,H)}else if(we){U.__webglDepthbuffer=[];for(let We=0;We<6;We++)t.bindFramebuffer(s.FRAMEBUFFER,U.__webglFramebuffer[We]),U.__webglDepthbuffer[We]=s.createRenderbuffer(),W(U.__webglDepthbuffer[We],H,!1)}else t.bindFramebuffer(s.FRAMEBUFFER,U.__webglFramebuffer),U.__webglDepthbuffer=s.createRenderbuffer(),W(U.__webglDepthbuffer,H,!1);t.bindFramebuffer(s.FRAMEBUFFER,null)}function he(H,U,we){const We=n.get(H);U!==void 0&&Ke(We.__webglFramebuffer,H,H.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D),we!==void 0&&Q(H)}function fe(H){const U=H.texture,we=n.get(H),We=n.get(U);H.addEventListener("dispose",K),H.isWebGLMultipleRenderTargets!==!0&&(We.__webglTexture===void 0&&(We.__webglTexture=s.createTexture()),We.__version=U.version,o.memory.textures++);const Ge=H.isWebGLCubeRenderTarget===!0,Je=H.isWebGLMultipleRenderTargets===!0,nt=E(H)||a;if(Ge){we.__webglFramebuffer=[];for(let N=0;N<6;N++)we.__webglFramebuffer[N]=s.createFramebuffer()}else{if(we.__webglFramebuffer=s.createFramebuffer(),Je)if(i.drawBuffers){const N=H.texture;for(let F=0,k=N.length;F<k;F++){const ee=n.get(N[F]);ee.__webglTexture===void 0&&(ee.__webglTexture=s.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&H.samples>0&&it(H)===!1){const N=Je?U:[U];we.__webglMultisampledFramebuffer=s.createFramebuffer(),we.__webglColorRenderbuffer=[],t.bindFramebuffer(s.FRAMEBUFFER,we.__webglMultisampledFramebuffer);for(let F=0;F<N.length;F++){const k=N[F];we.__webglColorRenderbuffer[F]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,we.__webglColorRenderbuffer[F]);const ee=r.convert(k.format,k.colorSpace),ne=r.convert(k.type),ye=L(k.internalFormat,ee,ne,k.colorSpace,H.isXRRenderTarget===!0),ue=qe(H);s.renderbufferStorageMultisample(s.RENDERBUFFER,ue,ye,H.width,H.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+F,s.RENDERBUFFER,we.__webglColorRenderbuffer[F])}s.bindRenderbuffer(s.RENDERBUFFER,null),H.depthBuffer&&(we.__webglDepthRenderbuffer=s.createRenderbuffer(),W(we.__webglDepthRenderbuffer,H,!0)),t.bindFramebuffer(s.FRAMEBUFFER,null)}}if(Ge){t.bindTexture(s.TEXTURE_CUBE_MAP,We.__webglTexture),ke(s.TEXTURE_CUBE_MAP,U,nt);for(let N=0;N<6;N++)Ke(we.__webglFramebuffer[N],H,U,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+N);C(U,nt)&&P(s.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Je){const N=H.texture;for(let F=0,k=N.length;F<k;F++){const ee=N[F],ne=n.get(ee);t.bindTexture(s.TEXTURE_2D,ne.__webglTexture),ke(s.TEXTURE_2D,ee,nt),Ke(we.__webglFramebuffer,H,ee,s.COLOR_ATTACHMENT0+F,s.TEXTURE_2D),C(ee,nt)&&P(s.TEXTURE_2D)}t.unbindTexture()}else{let N=s.TEXTURE_2D;(H.isWebGL3DRenderTarget||H.isWebGLArrayRenderTarget)&&(a?N=H.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(N,We.__webglTexture),ke(N,U,nt),Ke(we.__webglFramebuffer,H,U,s.COLOR_ATTACHMENT0,N),C(U,nt)&&P(N),t.unbindTexture()}H.depthBuffer&&Q(H)}function De(H){const U=E(H)||a,we=H.isWebGLMultipleRenderTargets===!0?H.texture:[H.texture];for(let We=0,Ge=we.length;We<Ge;We++){const Je=we[We];if(C(Je,U)){const nt=H.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D,N=n.get(Je).__webglTexture;t.bindTexture(nt,N),P(nt),t.unbindTexture()}}}function je(H){if(a&&H.samples>0&&it(H)===!1){const U=H.isWebGLMultipleRenderTargets?H.texture:[H.texture],we=H.width,We=H.height;let Ge=s.COLOR_BUFFER_BIT;const Je=[],nt=H.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,N=n.get(H),F=H.isWebGLMultipleRenderTargets===!0;if(F)for(let k=0;k<U.length;k++)t.bindFramebuffer(s.FRAMEBUFFER,N.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+k,s.RENDERBUFFER,null),t.bindFramebuffer(s.FRAMEBUFFER,N.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+k,s.TEXTURE_2D,null,0);t.bindFramebuffer(s.READ_FRAMEBUFFER,N.__webglMultisampledFramebuffer),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,N.__webglFramebuffer);for(let k=0;k<U.length;k++){Je.push(s.COLOR_ATTACHMENT0+k),H.depthBuffer&&Je.push(nt);const ee=N.__ignoreDepthValues!==void 0?N.__ignoreDepthValues:!1;if(ee===!1&&(H.depthBuffer&&(Ge|=s.DEPTH_BUFFER_BIT),H.stencilBuffer&&(Ge|=s.STENCIL_BUFFER_BIT)),F&&s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,N.__webglColorRenderbuffer[k]),ee===!0&&(s.invalidateFramebuffer(s.READ_FRAMEBUFFER,[nt]),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[nt])),F){const ne=n.get(U[k]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,ne,0)}s.blitFramebuffer(0,0,we,We,0,0,we,We,Ge,s.NEAREST),m&&s.invalidateFramebuffer(s.READ_FRAMEBUFFER,Je)}if(t.bindFramebuffer(s.READ_FRAMEBUFFER,null),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),F)for(let k=0;k<U.length;k++){t.bindFramebuffer(s.FRAMEBUFFER,N.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+k,s.RENDERBUFFER,N.__webglColorRenderbuffer[k]);const ee=n.get(U[k]).__webglTexture;t.bindFramebuffer(s.FRAMEBUFFER,N.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+k,s.TEXTURE_2D,ee,0)}t.bindFramebuffer(s.DRAW_FRAMEBUFFER,N.__webglMultisampledFramebuffer)}}function qe(H){return Math.min(f,H.samples)}function it(H){const U=n.get(H);return a&&H.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&U.__useRenderToTexture!==!1}function ot(H){const U=o.render.frame;g.get(H)!==U&&(g.set(H,U),H.update())}function _t(H,U){const we=H.colorSpace,We=H.format,Ge=H.type;return H.isCompressedTexture===!0||H.format===Kd||we!==yr&&we!==no&&(we===It?a===!1?e.has("EXT_sRGB")===!0&&We===Vi?(H.format=Kd,H.minFilter=Sn,H.generateMipmaps=!1):U=Ig.sRGBToLinear(U):(We!==Vi||Ge!==xs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",we)),U}this.allocateTextureUnit=J,this.resetTextureUnits=q,this.setTexture2D=_e,this.setTexture2DArray=Re,this.setTexture3D=ae,this.setTextureCube=ve,this.rebindTextures=he,this.setupRenderTarget=fe,this.updateRenderTargetMipmap=De,this.updateMultisampleRenderTarget=je,this.setupDepthRenderbuffer=Q,this.setupFrameBufferTexture=Ke,this.useMultisampledRTT=it}function Sw(s,e,t){const n=t.isWebGL2;function i(r,o=no){let a;if(r===xs)return s.UNSIGNED_BYTE;if(r===bg)return s.UNSIGNED_SHORT_4_4_4_4;if(r===wg)return s.UNSIGNED_SHORT_5_5_5_1;if(r===zb)return s.BYTE;if(r===Vb)return s.SHORT;if(r===df)return s.UNSIGNED_SHORT;if(r===Sg)return s.INT;if(r===ms)return s.UNSIGNED_INT;if(r===Dr)return s.FLOAT;if(r===vl)return n?s.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===kb)return s.ALPHA;if(r===Vi)return s.RGBA;if(r===Gb)return s.LUMINANCE;if(r===Hb)return s.LUMINANCE_ALPHA;if(r===eo)return s.DEPTH_COMPONENT;if(r===$o)return s.DEPTH_STENCIL;if(r===Kd)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===Wb)return s.RED;if(r===Mg)return s.RED_INTEGER;if(r===Xb)return s.RG;if(r===Eg)return s.RG_INTEGER;if(r===Ag)return s.RGBA_INTEGER;if(r===Ud||r===Bd||r===zd||r===Vd)if(o===It)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===Ud)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Bd)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===zd)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Vd)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===Ud)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Bd)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===zd)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Vd)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===_0||r===x0||r===y0||r===v0)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===_0)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===x0)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===y0)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===v0)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===Yb)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===S0||r===b0)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===S0)return o===It?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===b0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===w0||r===M0||r===E0||r===A0||r===T0||r===C0||r===R0||r===P0||r===I0||r===L0||r===N0||r===F0||r===O0||r===D0)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===w0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===M0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===E0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===A0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===T0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===C0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===R0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===P0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===I0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===L0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===N0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===F0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===O0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===D0)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===kd)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===kd)return o===It?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(r===jb||r===U0||r===B0||r===z0)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(r===kd)return a.COMPRESSED_RED_RGTC1_EXT;if(r===U0)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===B0)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===z0)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Qs?n?s.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):s[r]!==void 0?s[r]:null}return{convert:i}}class bw extends jn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ul extends Yt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const JD={type:"move"};class Sm{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ul,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ul,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new X,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new X),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ul,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new X,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new X),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const a=this._targetRay,l=this._grip,h=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(h&&e.hand){o=!0;for(const v of e.hand.values()){const y=t.getJointPose(v,n),x=this._getHandJoint(h,v);y!==null&&(x.matrix.fromArray(y.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.matrixWorldNeedsUpdate=!0,x.jointRadius=y.radius),x.visible=y!==null}const u=h.joints["index-finger-tip"],f=h.joints["thumb-tip"],p=u.position.distanceTo(f.position),m=.02,g=.005;h.inputState.pinching&&p>m+g?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&p<=m-g&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&r!==null&&(i=r),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(JD)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=r!==null),h!==null&&(h.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new ul;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class ww extends bn{constructor(e,t,n,i,r,o,a,l,h,u){if(u=u!==void 0?u:eo,u!==eo&&u!==$o)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===eo&&(n=ms),n===void 0&&u===$o&&(n=Qs),super(null,i,r,o,a,l,u,n,h),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:vn,this.minFilter=l!==void 0?l:vn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class QD extends Ms{constructor(e,t){super();const n=this;let i=null,r=1,o=null,a="local-floor",l=1,h=null,u=null,f=null,p=null,m=null,g=null;const v=t.getContextAttributes();let y=null,x=null;const w=[],S=[];let E=null;const A=new jn;A.layers.enable(1),A.viewport=new Qt;const C=new jn;C.layers.enable(2),C.viewport=new Qt;const P=[A,C],L=new bw;L.layers.enable(1),L.layers.enable(2);let T=null,R=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(ae){E=ae},this.getController=function(ae){let ve=w[ae];return ve===void 0&&(ve=new Sm,w[ae]=ve),ve.getTargetRaySpace()},this.getControllerGrip=function(ae){let ve=w[ae];return ve===void 0&&(ve=new Sm,w[ae]=ve),ve.getGripSpace()},this.getHand=function(ae){let ve=w[ae];return ve===void 0&&(ve=new Sm,w[ae]=ve),ve.getHandSpace()};function G(ae){const ve=S.indexOf(ae.inputSource);if(ve===-1)return;const oe=w[ve];oe!==void 0&&(oe.update(ae.inputSource,ae.frame,h||o),oe.dispatchEvent({type:ae.type,data:ae.inputSource}))}function K(){i.removeEventListener("select",G),i.removeEventListener("selectstart",G),i.removeEventListener("selectend",G),i.removeEventListener("squeeze",G),i.removeEventListener("squeezestart",G),i.removeEventListener("squeezeend",G),i.removeEventListener("end",K),i.removeEventListener("inputsourceschange",Z);for(let ae=0;ae<w.length;ae++){const ve=S[ae];ve!==null&&(S[ae]=null,w[ae].disconnect(ve))}T=null,R=null,e.setRenderTarget(y),m=null,p=null,f=null,i=null,x=null,Re.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ae){r=ae,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ae){a=ae,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||o},this.setReferenceSpace=function(ae){h=ae},this.getBaseLayer=function(){return p!==null?p:m},this.getBinding=function(){return f},this.getFrame=function(){return g},this.getSession=function(){return i},this.setSession=async function(ae){if(i=ae,i!==null){if(y=e.getRenderTarget(),i.addEventListener("select",G),i.addEventListener("selectstart",G),i.addEventListener("selectend",G),i.addEventListener("squeeze",G),i.addEventListener("squeezestart",G),i.addEventListener("squeezeend",G),i.addEventListener("end",K),i.addEventListener("inputsourceschange",Z),v.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ve={antialias:i.renderState.layers===void 0?v.antialias:!0,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:r};m=new XRWebGLLayer(i,t,ve),i.updateRenderState({baseLayer:m}),x=new vr(m.framebufferWidth,m.framebufferHeight,{format:Vi,type:xs,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let ve=null,oe=null,Ce=null;v.depth&&(Ce=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ve=v.stencil?$o:eo,oe=v.stencil?Qs:ms);const Ie={colorFormat:t.RGBA8,depthFormat:Ce,scaleFactor:r};f=new XRWebGLBinding(i,t),p=f.createProjectionLayer(Ie),i.updateRenderState({layers:[p]}),x=new vr(p.textureWidth,p.textureHeight,{format:Vi,type:xs,depthTexture:new ww(p.textureWidth,p.textureHeight,oe,void 0,void 0,void 0,void 0,void 0,void 0,ve),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0});const ke=e.properties.get(x);ke.__ignoreDepthValues=p.ignoreDepthValues}x.isXRRenderTarget=!0,this.setFoveation(l),h=null,o=await i.requestReferenceSpace(a),Re.setContext(i),Re.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function Z(ae){for(let ve=0;ve<ae.removed.length;ve++){const oe=ae.removed[ve],Ce=S.indexOf(oe);Ce>=0&&(S[Ce]=null,w[Ce].disconnect(oe))}for(let ve=0;ve<ae.added.length;ve++){const oe=ae.added[ve];let Ce=S.indexOf(oe);if(Ce===-1){for(let ke=0;ke<w.length;ke++)if(ke>=S.length){S.push(oe),Ce=ke;break}else if(S[ke]===null){S[ke]=oe,Ce=ke;break}if(Ce===-1)break}const Ie=w[Ce];Ie&&Ie.connect(oe)}}const O=new X,V=new X;function j(ae,ve,oe){O.setFromMatrixPosition(ve.matrixWorld),V.setFromMatrixPosition(oe.matrixWorld);const Ce=O.distanceTo(V),Ie=ve.projectionMatrix.elements,ke=oe.projectionMatrix.elements,Ye=Ie[14]/(Ie[10]-1),$e=Ie[14]/(Ie[10]+1),et=(Ie[9]+1)/Ie[5],Ke=(Ie[9]-1)/Ie[5],W=(Ie[8]-1)/Ie[0],Le=(ke[8]+1)/ke[0],Q=Ye*W,he=Ye*Le,fe=Ce/(-W+Le),De=fe*-W;ve.matrixWorld.decompose(ae.position,ae.quaternion,ae.scale),ae.translateX(De),ae.translateZ(fe),ae.matrixWorld.compose(ae.position,ae.quaternion,ae.scale),ae.matrixWorldInverse.copy(ae.matrixWorld).invert();const je=Ye+fe,qe=$e+fe,it=Q-De,ot=he+(Ce-De),_t=et*$e/qe*je,H=Ke*$e/qe*je;ae.projectionMatrix.makePerspective(it,ot,_t,H,je,qe),ae.projectionMatrixInverse.copy(ae.projectionMatrix).invert()}function q(ae,ve){ve===null?ae.matrixWorld.copy(ae.matrix):ae.matrixWorld.multiplyMatrices(ve.matrixWorld,ae.matrix),ae.matrixWorldInverse.copy(ae.matrixWorld).invert()}this.updateCameraXR=function(ae){if(i===null)return ae;E&&(ae=E),L.near=C.near=A.near=ae.near,L.far=C.far=A.far=ae.far,(T!==L.near||R!==L.far)&&(i.updateRenderState({depthNear:L.near,depthFar:L.far}),T=L.near,R=L.far);const ve=ae.parent,oe=L.cameras;q(L,ve);for(let Ce=0;Ce<oe.length;Ce++)q(oe[Ce],ve);return oe.length===2?j(L,A,C):L.projectionMatrix.copy(A.projectionMatrix),E&&J(L,ve),L};function J(ae,ve){const oe=E;ve===null?oe.matrix.copy(ae.matrixWorld):(oe.matrix.copy(ve.matrixWorld),oe.matrix.invert(),oe.matrix.multiply(ae.matrixWorld)),oe.matrix.decompose(oe.position,oe.quaternion,oe.scale),oe.updateMatrixWorld(!0);const Ce=oe.children;for(let Ie=0,ke=Ce.length;Ie<ke;Ie++)Ce[Ie].updateMatrixWorld(!0);oe.projectionMatrix.copy(ae.projectionMatrix),oe.projectionMatrixInverse.copy(ae.projectionMatrixInverse),oe.isPerspectiveCamera&&(oe.fov=Sl*2*Math.atan(1/oe.projectionMatrix.elements[5]),oe.zoom=1)}this.getFoveation=function(){if(!(p===null&&m===null))return l},this.setFoveation=function(ae){l=ae,p!==null&&(p.fixedFoveation=ae),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=ae)};let se=null;function _e(ae,ve){if(u=ve.getViewerPose(h||o),g=ve,u!==null){const oe=u.views;m!==null&&(e.setRenderTargetFramebuffer(x,m.framebuffer),e.setRenderTarget(x));let Ce=!1;oe.length!==L.cameras.length&&(L.cameras.length=0,Ce=!0);for(let Ie=0;Ie<oe.length;Ie++){const ke=oe[Ie];let Ye=null;if(m!==null)Ye=m.getViewport(ke);else{const et=f.getViewSubImage(p,ke);Ye=et.viewport,Ie===0&&(e.setRenderTargetTextures(x,et.colorTexture,p.ignoreDepthValues?void 0:et.depthStencilTexture),e.setRenderTarget(x))}let $e=P[Ie];$e===void 0&&($e=new jn,$e.layers.enable(Ie),$e.viewport=new Qt,P[Ie]=$e),$e.matrix.fromArray(ke.transform.matrix),$e.matrix.decompose($e.position,$e.quaternion,$e.scale),$e.projectionMatrix.fromArray(ke.projectionMatrix),$e.projectionMatrixInverse.copy($e.projectionMatrix).invert(),$e.viewport.set(Ye.x,Ye.y,Ye.width,Ye.height),Ie===0&&(L.matrix.copy($e.matrix),L.matrix.decompose(L.position,L.quaternion,L.scale)),Ce===!0&&L.cameras.push($e)}}for(let oe=0;oe<w.length;oe++){const Ce=S[oe],Ie=w[oe];Ce!==null&&Ie!==void 0&&Ie.update(Ce,ve,h||o)}se&&se(ae,ve),ve.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:ve}),g=null}const Re=new gw;Re.setAnimationLoop(_e),this.setAnimationLoop=function(ae){se=ae},this.dispose=function(){}}}function eU(s,e){function t(y,x){y.matrixAutoUpdate===!0&&y.updateMatrix(),x.value.copy(y.matrix)}function n(y,x){x.color.getRGB(y.fogColor.value,dw(s)),x.isFog?(y.fogNear.value=x.near,y.fogFar.value=x.far):x.isFogExp2&&(y.fogDensity.value=x.density)}function i(y,x,w,S,E){x.isMeshBasicMaterial||x.isMeshLambertMaterial?r(y,x):x.isMeshToonMaterial?(r(y,x),f(y,x)):x.isMeshPhongMaterial?(r(y,x),u(y,x)):x.isMeshStandardMaterial?(r(y,x),p(y,x),x.isMeshPhysicalMaterial&&m(y,x,E)):x.isMeshMatcapMaterial?(r(y,x),g(y,x)):x.isMeshDepthMaterial?r(y,x):x.isMeshDistanceMaterial?(r(y,x),v(y,x)):x.isMeshNormalMaterial?r(y,x):x.isLineBasicMaterial?(o(y,x),x.isLineDashedMaterial&&a(y,x)):x.isPointsMaterial?l(y,x,w,S):x.isSpriteMaterial?h(y,x):x.isShadowMaterial?(y.color.value.copy(x.color),y.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function r(y,x){y.opacity.value=x.opacity,x.color&&y.diffuse.value.copy(x.color),x.emissive&&y.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(y.map.value=x.map,t(x.map,y.mapTransform)),x.alphaMap&&(y.alphaMap.value=x.alphaMap,t(x.alphaMap,y.alphaMapTransform)),x.bumpMap&&(y.bumpMap.value=x.bumpMap,t(x.bumpMap,y.bumpMapTransform),y.bumpScale.value=x.bumpScale,x.side===di&&(y.bumpScale.value*=-1)),x.normalMap&&(y.normalMap.value=x.normalMap,t(x.normalMap,y.normalMapTransform),y.normalScale.value.copy(x.normalScale),x.side===di&&y.normalScale.value.negate()),x.displacementMap&&(y.displacementMap.value=x.displacementMap,t(x.displacementMap,y.displacementMapTransform),y.displacementScale.value=x.displacementScale,y.displacementBias.value=x.displacementBias),x.emissiveMap&&(y.emissiveMap.value=x.emissiveMap,t(x.emissiveMap,y.emissiveMapTransform)),x.specularMap&&(y.specularMap.value=x.specularMap,t(x.specularMap,y.specularMapTransform)),x.alphaTest>0&&(y.alphaTest.value=x.alphaTest);const w=e.get(x).envMap;if(w&&(y.envMap.value=w,y.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=x.reflectivity,y.ior.value=x.ior,y.refractionRatio.value=x.refractionRatio),x.lightMap){y.lightMap.value=x.lightMap;const S=s.useLegacyLights===!0?Math.PI:1;y.lightMapIntensity.value=x.lightMapIntensity*S,t(x.lightMap,y.lightMapTransform)}x.aoMap&&(y.aoMap.value=x.aoMap,y.aoMapIntensity.value=x.aoMapIntensity,t(x.aoMap,y.aoMapTransform))}function o(y,x){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity,x.map&&(y.map.value=x.map,t(x.map,y.mapTransform))}function a(y,x){y.dashSize.value=x.dashSize,y.totalSize.value=x.dashSize+x.gapSize,y.scale.value=x.scale}function l(y,x,w,S){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity,y.size.value=x.size*w,y.scale.value=S*.5,x.map&&(y.map.value=x.map,t(x.map,y.uvTransform)),x.alphaMap&&(y.alphaMap.value=x.alphaMap,t(x.alphaMap,y.alphaMapTransform)),x.alphaTest>0&&(y.alphaTest.value=x.alphaTest)}function h(y,x){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity,y.rotation.value=x.rotation,x.map&&(y.map.value=x.map,t(x.map,y.mapTransform)),x.alphaMap&&(y.alphaMap.value=x.alphaMap,t(x.alphaMap,y.alphaMapTransform)),x.alphaTest>0&&(y.alphaTest.value=x.alphaTest)}function u(y,x){y.specular.value.copy(x.specular),y.shininess.value=Math.max(x.shininess,1e-4)}function f(y,x){x.gradientMap&&(y.gradientMap.value=x.gradientMap)}function p(y,x){y.metalness.value=x.metalness,x.metalnessMap&&(y.metalnessMap.value=x.metalnessMap,t(x.metalnessMap,y.metalnessMapTransform)),y.roughness.value=x.roughness,x.roughnessMap&&(y.roughnessMap.value=x.roughnessMap,t(x.roughnessMap,y.roughnessMapTransform)),e.get(x).envMap&&(y.envMapIntensity.value=x.envMapIntensity)}function m(y,x,w){y.ior.value=x.ior,x.sheen>0&&(y.sheenColor.value.copy(x.sheenColor).multiplyScalar(x.sheen),y.sheenRoughness.value=x.sheenRoughness,x.sheenColorMap&&(y.sheenColorMap.value=x.sheenColorMap,t(x.sheenColorMap,y.sheenColorMapTransform)),x.sheenRoughnessMap&&(y.sheenRoughnessMap.value=x.sheenRoughnessMap,t(x.sheenRoughnessMap,y.sheenRoughnessMapTransform))),x.clearcoat>0&&(y.clearcoat.value=x.clearcoat,y.clearcoatRoughness.value=x.clearcoatRoughness,x.clearcoatMap&&(y.clearcoatMap.value=x.clearcoatMap,t(x.clearcoatMap,y.clearcoatMapTransform)),x.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap,t(x.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),x.clearcoatNormalMap&&(y.clearcoatNormalMap.value=x.clearcoatNormalMap,t(x.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),x.side===di&&y.clearcoatNormalScale.value.negate())),x.iridescence>0&&(y.iridescence.value=x.iridescence,y.iridescenceIOR.value=x.iridescenceIOR,y.iridescenceThicknessMinimum.value=x.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=x.iridescenceThicknessRange[1],x.iridescenceMap&&(y.iridescenceMap.value=x.iridescenceMap,t(x.iridescenceMap,y.iridescenceMapTransform)),x.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=x.iridescenceThicknessMap,t(x.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),x.transmission>0&&(y.transmission.value=x.transmission,y.transmissionSamplerMap.value=w.texture,y.transmissionSamplerSize.value.set(w.width,w.height),x.transmissionMap&&(y.transmissionMap.value=x.transmissionMap,t(x.transmissionMap,y.transmissionMapTransform)),y.thickness.value=x.thickness,x.thicknessMap&&(y.thicknessMap.value=x.thicknessMap,t(x.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=x.attenuationDistance,y.attenuationColor.value.copy(x.attenuationColor)),x.anisotropy>0&&(y.anisotropyVector.value.set(x.anisotropy*Math.cos(x.anisotropyRotation),x.anisotropy*Math.sin(x.anisotropyRotation)),x.anisotropyMap&&(y.anisotropyMap.value=x.anisotropyMap,t(x.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=x.specularIntensity,y.specularColor.value.copy(x.specularColor),x.specularColorMap&&(y.specularColorMap.value=x.specularColorMap,t(x.specularColorMap,y.specularColorMapTransform)),x.specularIntensityMap&&(y.specularIntensityMap.value=x.specularIntensityMap,t(x.specularIntensityMap,y.specularIntensityMapTransform))}function g(y,x){x.matcap&&(y.matcap.value=x.matcap)}function v(y,x){const w=e.get(x).light;y.referencePosition.value.setFromMatrixPosition(w.matrixWorld),y.nearDistance.value=w.shadow.camera.near,y.farDistance.value=w.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function tU(s,e,t,n){let i={},r={},o=[];const a=t.isWebGL2?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(w,S){const E=S.program;n.uniformBlockBinding(w,E)}function h(w,S){let E=i[w.id];E===void 0&&(g(w),E=u(w),i[w.id]=E,w.addEventListener("dispose",y));const A=S.program;n.updateUBOMapping(w,A);const C=e.render.frame;r[w.id]!==C&&(p(w),r[w.id]=C)}function u(w){const S=f();w.__bindingPointIndex=S;const E=s.createBuffer(),A=w.__size,C=w.usage;return s.bindBuffer(s.UNIFORM_BUFFER,E),s.bufferData(s.UNIFORM_BUFFER,A,C),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,S,E),E}function f(){for(let w=0;w<a;w++)if(o.indexOf(w)===-1)return o.push(w),w;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function p(w){const S=i[w.id],E=w.uniforms,A=w.__cache;s.bindBuffer(s.UNIFORM_BUFFER,S);for(let C=0,P=E.length;C<P;C++){const L=E[C];if(m(L,C,A)===!0){const T=L.__offset,R=Array.isArray(L.value)?L.value:[L.value];let G=0;for(let K=0;K<R.length;K++){const Z=R[K],O=v(Z);typeof Z=="number"?(L.__data[0]=Z,s.bufferSubData(s.UNIFORM_BUFFER,T+G,L.__data)):Z.isMatrix3?(L.__data[0]=Z.elements[0],L.__data[1]=Z.elements[1],L.__data[2]=Z.elements[2],L.__data[3]=Z.elements[0],L.__data[4]=Z.elements[3],L.__data[5]=Z.elements[4],L.__data[6]=Z.elements[5],L.__data[7]=Z.elements[0],L.__data[8]=Z.elements[6],L.__data[9]=Z.elements[7],L.__data[10]=Z.elements[8],L.__data[11]=Z.elements[0]):(Z.toArray(L.__data,G),G+=O.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,T,L.__data)}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function m(w,S,E){const A=w.value;if(E[S]===void 0){if(typeof A=="number")E[S]=A;else{const C=Array.isArray(A)?A:[A],P=[];for(let L=0;L<C.length;L++)P.push(C[L].clone());E[S]=P}return!0}else if(typeof A=="number"){if(E[S]!==A)return E[S]=A,!0}else{const C=Array.isArray(E[S])?E[S]:[E[S]],P=Array.isArray(A)?A:[A];for(let L=0;L<C.length;L++){const T=C[L];if(T.equals(P[L])===!1)return T.copy(P[L]),!0}}return!1}function g(w){const S=w.uniforms;let E=0;const A=16;let C=0;for(let P=0,L=S.length;P<L;P++){const T=S[P],R={boundary:0,storage:0},G=Array.isArray(T.value)?T.value:[T.value];for(let K=0,Z=G.length;K<Z;K++){const O=G[K],V=v(O);R.boundary+=V.boundary,R.storage+=V.storage}if(T.__data=new Float32Array(R.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=E,P>0){C=E%A;const K=A-C;C!==0&&K-R.boundary<0&&(E+=A-C,T.__offset=E)}E+=R.storage}return C=E%A,C>0&&(E+=A-C),w.__size=E,w.__cache={},this}function v(w){const S={boundary:0,storage:0};return typeof w=="number"?(S.boundary=4,S.storage=4):w.isVector2?(S.boundary=8,S.storage=8):w.isVector3||w.isColor?(S.boundary=16,S.storage=12):w.isVector4?(S.boundary=16,S.storage=16):w.isMatrix3?(S.boundary=48,S.storage=48):w.isMatrix4?(S.boundary=64,S.storage=64):w.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",w),S}function y(w){const S=w.target;S.removeEventListener("dispose",y);const E=o.indexOf(S.__bindingPointIndex);o.splice(E,1),s.deleteBuffer(i[S.id]),delete i[S.id],delete r[S.id]}function x(){for(const w in i)s.deleteBuffer(i[w]);o=[],i={},r={}}return{bind:l,update:h,dispose:x}}function nU(){const s=qc("canvas");return s.style.display="block",s}class Mw{constructor(e={}){const{canvas:t=nU(),context:n=null,depth:i=!0,stencil:r=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:h=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:f=!1}=e;this.isWebGLRenderer=!0;let p;n!==null?p=n.getContextAttributes().alpha:p=o;const m=new Uint32Array(4),g=new Int32Array(4);let v=null,y=null;const x=[],w=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=It,this.useLegacyLights=!0,this.toneMapping=Br,this.toneMappingExposure=1;const S=this;let E=!1,A=0,C=0,P=null,L=-1,T=null;const R=new Qt,G=new Qt;let K=null;const Z=new ct(0);let O=0,V=t.width,j=t.height,q=1,J=null,se=null;const _e=new Qt(0,0,V,j),Re=new Qt(0,0,V,j);let ae=!1;const ve=new _f;let oe=!1,Ce=!1,Ie=null;const ke=new Pt,Ye=new He,$e=new X,et={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ke(){return P===null?q:1}let W=n;function Le(z,ge){for(let Te=0;Te<z.length;Te++){const de=z[Te],Ae=t.getContext(de,ge);if(Ae!==null)return Ae}return null}try{const z={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:h,powerPreference:u,failIfMajorPerformanceCaveat:f};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${hf}`),t.addEventListener("webglcontextlost",Ve,!1),t.addEventListener("webglcontextrestored",me,!1),t.addEventListener("webglcontextcreationerror",xe,!1),W===null){const ge=["webgl2","webgl","experimental-webgl"];if(S.isWebGL1Renderer===!0&&ge.shift(),W=Le(ge,z),W===null)throw Le(ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}W instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),W.getShaderPrecisionFormat===void 0&&(W.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(z){throw console.error("THREE.WebGLRenderer: "+z.message),z}let Q,he,fe,De,je,qe,it,ot,_t,H,U,we,We,Ge,Je,nt,N,F,k,ee,ne,ye,ue,Ue;function Ze(){Q=new xO(W),he=new dO(W,Q,e),Q.init(he),ye=new Sw(W,Q,he),fe=new ZD(W,Q,he),De=new SO(W),je=new BD,qe=new KD(W,Q,fe,je,he,ye,De),it=new pO(S),ot=new _O(S),_t=new NL(W,he),ue=new hO(W,Q,_t,he),H=new yO(W,_t,De,ue),U=new EO(W,H,_t,De),k=new MO(W,he,qe),nt=new fO(je),we=new UD(S,it,ot,Q,he,ue,nt),We=new eU(S,je),Ge=new VD,Je=new YD(Q,he),F=new cO(S,it,ot,fe,U,p,l),N=new $D(S,U,he),Ue=new tU(W,De,he,fe),ee=new uO(W,Q,De,he),ne=new vO(W,Q,De,he),De.programs=we.programs,S.capabilities=he,S.extensions=Q,S.properties=je,S.renderLists=Ge,S.shadowMap=N,S.state=fe,S.info=De}Ze();const Y=new QD(S,W);this.xr=Y,this.getContext=function(){return W},this.getContextAttributes=function(){return W.getContextAttributes()},this.forceContextLoss=function(){const z=Q.get("WEBGL_lose_context");z&&z.loseContext()},this.forceContextRestore=function(){const z=Q.get("WEBGL_lose_context");z&&z.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(z){z!==void 0&&(q=z,this.setSize(V,j,!1))},this.getSize=function(z){return z.set(V,j)},this.setSize=function(z,ge,Te=!0){if(Y.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=z,j=ge,t.width=Math.floor(z*q),t.height=Math.floor(ge*q),Te===!0&&(t.style.width=z+"px",t.style.height=ge+"px"),this.setViewport(0,0,z,ge)},this.getDrawingBufferSize=function(z){return z.set(V*q,j*q).floor()},this.setDrawingBufferSize=function(z,ge,Te){V=z,j=ge,q=Te,t.width=Math.floor(z*Te),t.height=Math.floor(ge*Te),this.setViewport(0,0,z,ge)},this.getCurrentViewport=function(z){return z.copy(R)},this.getViewport=function(z){return z.copy(_e)},this.setViewport=function(z,ge,Te,de){z.isVector4?_e.set(z.x,z.y,z.z,z.w):_e.set(z,ge,Te,de),fe.viewport(R.copy(_e).multiplyScalar(q).floor())},this.getScissor=function(z){return z.copy(Re)},this.setScissor=function(z,ge,Te,de){z.isVector4?Re.set(z.x,z.y,z.z,z.w):Re.set(z,ge,Te,de),fe.scissor(G.copy(Re).multiplyScalar(q).floor())},this.getScissorTest=function(){return ae},this.setScissorTest=function(z){fe.setScissorTest(ae=z)},this.setOpaqueSort=function(z){J=z},this.setTransparentSort=function(z){se=z},this.getClearColor=function(z){return z.copy(F.getClearColor())},this.setClearColor=function(){F.setClearColor.apply(F,arguments)},this.getClearAlpha=function(){return F.getClearAlpha()},this.setClearAlpha=function(){F.setClearAlpha.apply(F,arguments)},this.clear=function(z=!0,ge=!0,Te=!0){let de=0;if(z){let Ae=!1;if(P!==null){const rt=P.texture.format;Ae=rt===Ag||rt===Eg||rt===Mg}if(Ae){const rt=P.texture.type,ut=rt===xs||rt===ms||rt===df||rt===Qs||rt===bg||rt===wg,gt=F.getClearColor(),mt=F.getClearAlpha(),Mt=gt.r,ft=gt.g,At=gt.b,qt=je.get(P).__webglFramebuffer;ut?(m[0]=Mt,m[1]=ft,m[2]=At,m[3]=mt,W.clearBufferuiv(W.COLOR,qt,m)):(g[0]=Mt,g[1]=ft,g[2]=At,g[3]=mt,W.clearBufferiv(W.COLOR,qt,g))}else de|=W.COLOR_BUFFER_BIT}ge&&(de|=W.DEPTH_BUFFER_BIT),Te&&(de|=W.STENCIL_BUFFER_BIT),W.clear(de)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ve,!1),t.removeEventListener("webglcontextrestored",me,!1),t.removeEventListener("webglcontextcreationerror",xe,!1),Ge.dispose(),Je.dispose(),je.dispose(),it.dispose(),ot.dispose(),U.dispose(),ue.dispose(),Ue.dispose(),we.dispose(),Y.dispose(),Y.removeEventListener("sessionstart",wt),Y.removeEventListener("sessionend",be),Ie&&(Ie.dispose(),Ie=null),Et.stop()};function Ve(z){z.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),E=!0}function me(){console.log("THREE.WebGLRenderer: Context Restored."),E=!1;const z=De.autoReset,ge=N.enabled,Te=N.autoUpdate,de=N.needsUpdate,Ae=N.type;Ze(),De.autoReset=z,N.enabled=ge,N.autoUpdate=Te,N.needsUpdate=de,N.type=Ae}function xe(z){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",z.statusMessage)}function Pe(z){const ge=z.target;ge.removeEventListener("dispose",Pe),Qe(ge)}function Qe(z){ie(z),je.remove(z)}function ie(z){const ge=je.get(z).programs;ge!==void 0&&(ge.forEach(function(Te){we.releaseProgram(Te)}),z.isShaderMaterial&&we.releaseShaderCache(z))}this.renderBufferDirect=function(z,ge,Te,de,Ae,rt){ge===null&&(ge=et);const ut=Ae.isMesh&&Ae.matrixWorld.determinant()<0,gt=Cr(z,ge,Te,de,Ae);fe.setMaterial(de,ut);let mt=Te.index,Mt=1;de.wireframe===!0&&(mt=H.getWireframeAttribute(Te),Mt=2);const ft=Te.drawRange,At=Te.attributes.position;let qt=ft.start*Mt,nn=(ft.start+ft.count)*Mt;rt!==null&&(qt=Math.max(qt,rt.start*Mt),nn=Math.min(nn,(rt.start+rt.count)*Mt)),mt!==null?(qt=Math.max(qt,0),nn=Math.min(nn,mt.count)):At!=null&&(qt=Math.max(qt,0),nn=Math.min(nn,At.count));const Bn=nn-qt;if(Bn<0||Bn===1/0)return;ue.setup(Ae,de,gt,Te,mt);let Zn,ln=ee;if(mt!==null&&(Zn=_t.get(mt),ln=ne,ln.setIndex(Zn)),Ae.isMesh)de.wireframe===!0?(fe.setLineWidth(de.wireframeLinewidth*Ke()),ln.setMode(W.LINES)):ln.setMode(W.TRIANGLES);else if(Ae.isLine){let kt=de.linewidth;kt===void 0&&(kt=1),fe.setLineWidth(kt*Ke()),Ae.isLineSegments?ln.setMode(W.LINES):Ae.isLineLoop?ln.setMode(W.LINE_LOOP):ln.setMode(W.LINE_STRIP)}else Ae.isPoints?ln.setMode(W.POINTS):Ae.isSprite&&ln.setMode(W.TRIANGLES);if(Ae.isInstancedMesh)ln.renderInstances(qt,Bn,Ae.count);else if(Te.isInstancedBufferGeometry){const kt=Te._maxInstanceCount!==void 0?Te._maxInstanceCount:1/0,Wl=Math.min(Te.instanceCount,kt);ln.renderInstances(qt,Bn,Wl)}else ln.render(qt,Bn)},this.compile=function(z,ge){function Te(de,Ae,rt){de.transparent===!0&&de.side===Or&&de.forceSinglePass===!1?(de.side=di,de.needsUpdate=!0,wn(de,Ae,rt),de.side=ys,de.needsUpdate=!0,wn(de,Ae,rt),de.side=Or):wn(de,Ae,rt)}y=Je.get(z),y.init(),w.push(y),z.traverseVisible(function(de){de.isLight&&de.layers.test(ge.layers)&&(y.pushLight(de),de.castShadow&&y.pushShadow(de))}),y.setupLights(S.useLegacyLights),z.traverse(function(de){const Ae=de.material;if(Ae)if(Array.isArray(Ae))for(let rt=0;rt<Ae.length;rt++){const ut=Ae[rt];Te(ut,z,de)}else Te(Ae,z,de)}),w.pop(),y=null};let at=null;function ce(z){at&&at(z)}function wt(){Et.stop()}function be(){Et.start()}const Et=new gw;Et.setAnimationLoop(ce),typeof self<"u"&&Et.setContext(self),this.setAnimationLoop=function(z){at=z,Y.setAnimationLoop(z),z===null?Et.stop():Et.start()},Y.addEventListener("sessionstart",wt),Y.addEventListener("sessionend",be),this.render=function(z,ge){if(ge!==void 0&&ge.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(E===!0)return;z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),ge.parent===null&&ge.matrixWorldAutoUpdate===!0&&ge.updateMatrixWorld(),Y.enabled===!0&&Y.isPresenting===!0&&(ge=Y.updateCameraXR(ge)),z.isScene===!0&&z.onBeforeRender(S,z,ge,P),y=Je.get(z,w.length),y.init(),w.push(y),ke.multiplyMatrices(ge.projectionMatrix,ge.matrixWorldInverse),ve.setFromProjectionMatrix(ke),Ce=this.localClippingEnabled,oe=nt.init(this.clippingPlanes,Ce),v=Ge.get(z,x.length),v.init(),x.push(v),gn(z,ge,0,S.sortObjects),v.finish(),S.sortObjects===!0&&v.sort(J,se),oe===!0&&nt.beginShadows();const Te=y.state.shadowsArray;if(N.render(Te,z,ge),oe===!0&&nt.endShadows(),this.info.autoReset===!0&&this.info.reset(),this.info.render.frame++,F.render(v,z),y.setupLights(S.useLegacyLights),ge.isArrayCamera){const de=ge.cameras;for(let Ae=0,rt=de.length;Ae<rt;Ae++){const ut=de[Ae];Dn(v,z,ut,ut.viewport)}}else Dn(v,z,ge);P!==null&&(qe.updateMultisampleRenderTarget(P),qe.updateRenderTargetMipmap(P)),z.isScene===!0&&z.onAfterRender(S,z,ge),ue.resetDefaultState(),L=-1,T=null,w.pop(),w.length>0?y=w[w.length-1]:y=null,x.pop(),x.length>0?v=x[x.length-1]:v=null};function gn(z,ge,Te,de){if(z.visible===!1)return;if(z.layers.test(ge.layers)){if(z.isGroup)Te=z.renderOrder;else if(z.isLOD)z.autoUpdate===!0&&z.update(ge);else if(z.isLight)y.pushLight(z),z.castShadow&&y.pushShadow(z);else if(z.isSprite){if(!z.frustumCulled||ve.intersectsSprite(z)){de&&$e.setFromMatrixPosition(z.matrixWorld).applyMatrix4(ke);const ut=U.update(z),gt=z.material;gt.visible&&v.push(z,ut,gt,Te,$e.z,null)}}else if((z.isMesh||z.isLine||z.isPoints)&&(!z.frustumCulled||ve.intersectsObject(z))){z.isSkinnedMesh&&z.skeleton.frame!==De.render.frame&&(z.skeleton.update(),z.skeleton.frame=De.render.frame);const ut=U.update(z),gt=z.material;if(de&&(z.boundingSphere!==void 0?(z.boundingSphere===null&&z.computeBoundingSphere(),$e.copy(z.boundingSphere.center)):(ut.boundingSphere===null&&ut.computeBoundingSphere(),$e.copy(ut.boundingSphere.center)),$e.applyMatrix4(z.matrixWorld).applyMatrix4(ke)),Array.isArray(gt)){const mt=ut.groups;for(let Mt=0,ft=mt.length;Mt<ft;Mt++){const At=mt[Mt],qt=gt[At.materialIndex];qt&&qt.visible&&v.push(z,ut,qt,Te,$e.z,At)}}else gt.visible&&v.push(z,ut,gt,Te,$e.z,null)}}const rt=z.children;for(let ut=0,gt=rt.length;ut<gt;ut++)gn(rt[ut],ge,Te,de)}function Dn(z,ge,Te,de){const Ae=z.opaque,rt=z.transmissive,ut=z.transparent;y.setupLightsView(Te),oe===!0&&nt.setGlobalState(S.clippingPlanes,Te),rt.length>0&&$n(Ae,rt,ge,Te),de&&fe.viewport(R.copy(de)),Ae.length>0&&Un(Ae,ge,Te),rt.length>0&&Un(rt,ge,Te),ut.length>0&&Un(ut,ge,Te),fe.buffers.depth.setTest(!0),fe.buffers.depth.setMask(!0),fe.buffers.color.setMask(!0),fe.setPolygonOffset(!1)}function $n(z,ge,Te,de){const Ae=he.isWebGL2;Ie===null&&(Ie=new vr(1,1,{generateMipmaps:!0,type:Q.has("EXT_color_buffer_half_float")?vl:xs,minFilter:oo,samples:Ae&&a===!0?4:0})),S.getDrawingBufferSize(Ye),Ae?Ie.setSize(Ye.x,Ye.y):Ie.setSize(Jd(Ye.x),Jd(Ye.y));const rt=S.getRenderTarget();S.setRenderTarget(Ie),S.getClearColor(Z),O=S.getClearAlpha(),O<1&&S.setClearColor(16777215,.5),S.clear();const ut=S.toneMapping;S.toneMapping=Br,Un(z,Te,de),qe.updateMultisampleRenderTarget(Ie),qe.updateRenderTargetMipmap(Ie);let gt=!1;for(let mt=0,Mt=ge.length;mt<Mt;mt++){const ft=ge[mt],At=ft.object,qt=ft.geometry,nn=ft.material,Bn=ft.group;if(nn.side===Or&&At.layers.test(de.layers)){const Zn=nn.side;nn.side=di,nn.needsUpdate=!0,Zt(At,Te,de,qt,nn,Bn),nn.side=Zn,nn.needsUpdate=!0,gt=!0}}gt===!0&&(qe.updateMultisampleRenderTarget(Ie),qe.updateRenderTargetMipmap(Ie)),S.setRenderTarget(rt),S.setClearColor(Z,O),S.toneMapping=ut}function Un(z,ge,Te){const de=ge.isScene===!0?ge.overrideMaterial:null;for(let Ae=0,rt=z.length;Ae<rt;Ae++){const ut=z[Ae],gt=ut.object,mt=ut.geometry,Mt=de===null?ut.material:de,ft=ut.group;gt.layers.test(Te.layers)&&Zt(gt,ge,Te,mt,Mt,ft)}}function Zt(z,ge,Te,de,Ae,rt){z.onBeforeRender(S,ge,Te,de,Ae,rt),z.modelViewMatrix.multiplyMatrices(Te.matrixWorldInverse,z.matrixWorld),z.normalMatrix.getNormalMatrix(z.modelViewMatrix),Ae.onBeforeRender(S,ge,Te,de,z,rt),Ae.transparent===!0&&Ae.side===Or&&Ae.forceSinglePass===!1?(Ae.side=di,Ae.needsUpdate=!0,S.renderBufferDirect(Te,ge,de,Ae,z,rt),Ae.side=ys,Ae.needsUpdate=!0,S.renderBufferDirect(Te,ge,de,Ae,z,rt),Ae.side=Or):S.renderBufferDirect(Te,ge,de,Ae,z,rt),z.onAfterRender(S,ge,Te,de,Ae,rt)}function wn(z,ge,Te){ge.isScene!==!0&&(ge=et);const de=je.get(z),Ae=y.state.lights,rt=y.state.shadowsArray,ut=Ae.state.version,gt=we.getParameters(z,Ae.state,rt,ge,Te),mt=we.getProgramCacheKey(gt);let Mt=de.programs;de.environment=z.isMeshStandardMaterial?ge.environment:null,de.fog=ge.fog,de.envMap=(z.isMeshStandardMaterial?ot:it).get(z.envMap||de.environment),Mt===void 0&&(z.addEventListener("dispose",Pe),Mt=new Map,de.programs=Mt);let ft=Mt.get(mt);if(ft!==void 0){if(de.currentProgram===ft&&de.lightsStateVersion===ut)return cr(z,gt),ft}else gt.uniforms=we.getUniforms(z),z.onBuild(Te,gt,S),z.onBeforeCompile(gt,S),ft=we.acquireProgram(gt,mt),Mt.set(mt,ft),de.uniforms=gt.uniforms;const At=de.uniforms;(!z.isShaderMaterial&&!z.isRawShaderMaterial||z.clipping===!0)&&(At.clippingPlanes=nt.uniform),cr(z,gt),de.needsLights=As(z),de.lightsStateVersion=ut,de.needsLights&&(At.ambientLightColor.value=Ae.state.ambient,At.lightProbe.value=Ae.state.probe,At.directionalLights.value=Ae.state.directional,At.directionalLightShadows.value=Ae.state.directionalShadow,At.spotLights.value=Ae.state.spot,At.spotLightShadows.value=Ae.state.spotShadow,At.rectAreaLights.value=Ae.state.rectArea,At.ltc_1.value=Ae.state.rectAreaLTC1,At.ltc_2.value=Ae.state.rectAreaLTC2,At.pointLights.value=Ae.state.point,At.pointLightShadows.value=Ae.state.pointShadow,At.hemisphereLights.value=Ae.state.hemi,At.directionalShadowMap.value=Ae.state.directionalShadowMap,At.directionalShadowMatrix.value=Ae.state.directionalShadowMatrix,At.spotShadowMap.value=Ae.state.spotShadowMap,At.spotLightMatrix.value=Ae.state.spotLightMatrix,At.spotLightMap.value=Ae.state.spotLightMap,At.pointShadowMap.value=Ae.state.pointShadowMap,At.pointShadowMatrix.value=Ae.state.pointShadowMatrix);const qt=ft.getUniforms(),nn=Wd.seqWithValue(qt.seq,At);return de.currentProgram=ft,de.uniformsList=nn,ft}function cr(z,ge){const Te=je.get(z);Te.outputColorSpace=ge.outputColorSpace,Te.instancing=ge.instancing,Te.skinning=ge.skinning,Te.morphTargets=ge.morphTargets,Te.morphNormals=ge.morphNormals,Te.morphColors=ge.morphColors,Te.morphTargetsCount=ge.morphTargetsCount,Te.numClippingPlanes=ge.numClippingPlanes,Te.numIntersection=ge.numClipIntersection,Te.vertexAlphas=ge.vertexAlphas,Te.vertexTangents=ge.vertexTangents,Te.toneMapping=ge.toneMapping}function Cr(z,ge,Te,de,Ae){ge.isScene!==!0&&(ge=et),qe.resetTextureUnits();const rt=ge.fog,ut=de.isMeshStandardMaterial?ge.environment:null,gt=P===null?S.outputColorSpace:P.isXRRenderTarget===!0?P.texture.colorSpace:yr,mt=(de.isMeshStandardMaterial?ot:it).get(de.envMap||ut),Mt=de.vertexColors===!0&&!!Te.attributes.color&&Te.attributes.color.itemSize===4,ft=!!Te.attributes.tangent&&(!!de.normalMap||de.anisotropy>0),At=!!Te.morphAttributes.position,qt=!!Te.morphAttributes.normal,nn=!!Te.morphAttributes.color,Bn=de.toneMapped?S.toneMapping:Br,Zn=Te.morphAttributes.position||Te.morphAttributes.normal||Te.morphAttributes.color,ln=Zn!==void 0?Zn.length:0,kt=je.get(de),Wl=y.state.lights;if(oe===!0&&(Ce===!0||z!==T)){const zn=z===T&&de.id===L;nt.setState(de,z,zn)}let Mn=!1;de.version===kt.__version?(kt.needsLights&&kt.lightsStateVersion!==Wl.state.version||kt.outputColorSpace!==gt||Ae.isInstancedMesh&&kt.instancing===!1||!Ae.isInstancedMesh&&kt.instancing===!0||Ae.isSkinnedMesh&&kt.skinning===!1||!Ae.isSkinnedMesh&&kt.skinning===!0||kt.envMap!==mt||de.fog===!0&&kt.fog!==rt||kt.numClippingPlanes!==void 0&&(kt.numClippingPlanes!==nt.numPlanes||kt.numIntersection!==nt.numIntersection)||kt.vertexAlphas!==Mt||kt.vertexTangents!==ft||kt.morphTargets!==At||kt.morphNormals!==qt||kt.morphColors!==nn||kt.toneMapping!==Bn||he.isWebGL2===!0&&kt.morphTargetsCount!==ln)&&(Mn=!0):(Mn=!0,kt.__version=de.version);let Xr=kt.currentProgram;Mn===!0&&(Xr=wn(de,ge,Ae));let Xl=!1,Ts=!1,da=!1;const Tn=Xr.getUniforms(),Yr=kt.uniforms;if(fe.useProgram(Xr.program)&&(Xl=!0,Ts=!0,da=!0),de.id!==L&&(L=de.id,Ts=!0),Xl||T!==z){if(Tn.setValue(W,"projectionMatrix",z.projectionMatrix),he.logarithmicDepthBuffer&&Tn.setValue(W,"logDepthBufFC",2/(Math.log(z.far+1)/Math.LN2)),T!==z&&(T=z,Ts=!0,da=!0),de.isShaderMaterial||de.isMeshPhongMaterial||de.isMeshToonMaterial||de.isMeshStandardMaterial||de.envMap){const zn=Tn.map.cameraPosition;zn!==void 0&&zn.setValue(W,$e.setFromMatrixPosition(z.matrixWorld))}(de.isMeshPhongMaterial||de.isMeshToonMaterial||de.isMeshLambertMaterial||de.isMeshBasicMaterial||de.isMeshStandardMaterial||de.isShaderMaterial)&&Tn.setValue(W,"isOrthographic",z.isOrthographicCamera===!0),(de.isMeshPhongMaterial||de.isMeshToonMaterial||de.isMeshLambertMaterial||de.isMeshBasicMaterial||de.isMeshStandardMaterial||de.isShaderMaterial||de.isShadowMaterial||Ae.isSkinnedMesh)&&Tn.setValue(W,"viewMatrix",z.matrixWorldInverse)}if(Ae.isSkinnedMesh){Tn.setOptional(W,Ae,"bindMatrix"),Tn.setOptional(W,Ae,"bindMatrixInverse");const zn=Ae.skeleton;zn&&(he.floatVertexTextures?(zn.boneTexture===null&&zn.computeBoneTexture(),Tn.setValue(W,"boneTexture",zn.boneTexture,qe),Tn.setValue(W,"boneTextureSize",zn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const fa=Te.morphAttributes;if((fa.position!==void 0||fa.normal!==void 0||fa.color!==void 0&&he.isWebGL2===!0)&&k.update(Ae,Te,Xr),(Ts||kt.receiveShadow!==Ae.receiveShadow)&&(kt.receiveShadow=Ae.receiveShadow,Tn.setValue(W,"receiveShadow",Ae.receiveShadow)),de.isMeshGouraudMaterial&&de.envMap!==null&&(Yr.envMap.value=mt,Yr.flipEnvMap.value=mt.isCubeTexture&&mt.isRenderTargetTexture===!1?-1:1),Ts&&(Tn.setValue(W,"toneMappingExposure",S.toneMappingExposure),kt.needsLights&&Rr(Yr,da),rt&&de.fog===!0&&We.refreshFogUniforms(Yr,rt),We.refreshMaterialUniforms(Yr,de,q,j,Ie),Wd.upload(W,kt.uniformsList,Yr,qe)),de.isShaderMaterial&&de.uniformsNeedUpdate===!0&&(Wd.upload(W,kt.uniformsList,Yr,qe),de.uniformsNeedUpdate=!1),de.isSpriteMaterial&&Tn.setValue(W,"center",Ae.center),Tn.setValue(W,"modelViewMatrix",Ae.modelViewMatrix),Tn.setValue(W,"normalMatrix",Ae.normalMatrix),Tn.setValue(W,"modelMatrix",Ae.matrixWorld),de.isShaderMaterial||de.isRawShaderMaterial){const zn=de.uniformsGroups;for(let pa=0,Wf=zn.length;pa<Wf;pa++)if(he.isWebGL2){const Yl=zn[pa];Ue.update(Yl,Xr),Ue.bind(Yl,Xr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Xr}function Rr(z,ge){z.ambientLightColor.needsUpdate=ge,z.lightProbe.needsUpdate=ge,z.directionalLights.needsUpdate=ge,z.directionalLightShadows.needsUpdate=ge,z.pointLights.needsUpdate=ge,z.pointLightShadows.needsUpdate=ge,z.spotLights.needsUpdate=ge,z.spotLightShadows.needsUpdate=ge,z.rectAreaLights.needsUpdate=ge,z.hemisphereLights.needsUpdate=ge}function As(z){return z.isMeshLambertMaterial||z.isMeshToonMaterial||z.isMeshPhongMaterial||z.isMeshStandardMaterial||z.isShadowMaterial||z.isShaderMaterial&&z.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(z,ge,Te){je.get(z.texture).__webglTexture=ge,je.get(z.depthTexture).__webglTexture=Te;const de=je.get(z);de.__hasExternalTextures=!0,de.__hasExternalTextures&&(de.__autoAllocateDepthBuffer=Te===void 0,de.__autoAllocateDepthBuffer||Q.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),de.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(z,ge){const Te=je.get(z);Te.__webglFramebuffer=ge,Te.__useDefaultFramebuffer=ge===void 0},this.setRenderTarget=function(z,ge=0,Te=0){P=z,A=ge,C=Te;let de=!0,Ae=null,rt=!1,ut=!1;if(z){const mt=je.get(z);mt.__useDefaultFramebuffer!==void 0?(fe.bindFramebuffer(W.FRAMEBUFFER,null),de=!1):mt.__webglFramebuffer===void 0?qe.setupRenderTarget(z):mt.__hasExternalTextures&&qe.rebindTextures(z,je.get(z.texture).__webglTexture,je.get(z.depthTexture).__webglTexture);const Mt=z.texture;(Mt.isData3DTexture||Mt.isDataArrayTexture||Mt.isCompressedArrayTexture)&&(ut=!0);const ft=je.get(z).__webglFramebuffer;z.isWebGLCubeRenderTarget?(Ae=ft[ge],rt=!0):he.isWebGL2&&z.samples>0&&qe.useMultisampledRTT(z)===!1?Ae=je.get(z).__webglMultisampledFramebuffer:Ae=ft,R.copy(z.viewport),G.copy(z.scissor),K=z.scissorTest}else R.copy(_e).multiplyScalar(q).floor(),G.copy(Re).multiplyScalar(q).floor(),K=ae;if(fe.bindFramebuffer(W.FRAMEBUFFER,Ae)&&he.drawBuffers&&de&&fe.drawBuffers(z,Ae),fe.viewport(R),fe.scissor(G),fe.setScissorTest(K),rt){const mt=je.get(z.texture);W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_CUBE_MAP_POSITIVE_X+ge,mt.__webglTexture,Te)}else if(ut){const mt=je.get(z.texture),Mt=ge||0;W.framebufferTextureLayer(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,mt.__webglTexture,Te||0,Mt)}L=-1},this.readRenderTargetPixels=function(z,ge,Te,de,Ae,rt,ut){if(!(z&&z.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let gt=je.get(z).__webglFramebuffer;if(z.isWebGLCubeRenderTarget&&ut!==void 0&&(gt=gt[ut]),gt){fe.bindFramebuffer(W.FRAMEBUFFER,gt);try{const mt=z.texture,Mt=mt.format,ft=mt.type;if(Mt!==Vi&&ye.convert(Mt)!==W.getParameter(W.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const At=ft===vl&&(Q.has("EXT_color_buffer_half_float")||he.isWebGL2&&Q.has("EXT_color_buffer_float"));if(ft!==xs&&ye.convert(ft)!==W.getParameter(W.IMPLEMENTATION_COLOR_READ_TYPE)&&!(ft===Dr&&(he.isWebGL2||Q.has("OES_texture_float")||Q.has("WEBGL_color_buffer_float")))&&!At){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ge>=0&&ge<=z.width-de&&Te>=0&&Te<=z.height-Ae&&W.readPixels(ge,Te,de,Ae,ye.convert(Mt),ye.convert(ft),rt)}finally{const mt=P!==null?je.get(P).__webglFramebuffer:null;fe.bindFramebuffer(W.FRAMEBUFFER,mt)}}},this.copyFramebufferToTexture=function(z,ge,Te=0){const de=Math.pow(2,-Te),Ae=Math.floor(ge.image.width*de),rt=Math.floor(ge.image.height*de);qe.setTexture2D(ge,0),W.copyTexSubImage2D(W.TEXTURE_2D,Te,0,0,z.x,z.y,Ae,rt),fe.unbindTexture()},this.copyTextureToTexture=function(z,ge,Te,de=0){const Ae=ge.image.width,rt=ge.image.height,ut=ye.convert(Te.format),gt=ye.convert(Te.type);qe.setTexture2D(Te,0),W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,Te.flipY),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Te.premultiplyAlpha),W.pixelStorei(W.UNPACK_ALIGNMENT,Te.unpackAlignment),ge.isDataTexture?W.texSubImage2D(W.TEXTURE_2D,de,z.x,z.y,Ae,rt,ut,gt,ge.image.data):ge.isCompressedTexture?W.compressedTexSubImage2D(W.TEXTURE_2D,de,z.x,z.y,ge.mipmaps[0].width,ge.mipmaps[0].height,ut,ge.mipmaps[0].data):W.texSubImage2D(W.TEXTURE_2D,de,z.x,z.y,ut,gt,ge.image),de===0&&Te.generateMipmaps&&W.generateMipmap(W.TEXTURE_2D),fe.unbindTexture()},this.copyTextureToTexture3D=function(z,ge,Te,de,Ae=0){if(S.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const rt=z.max.x-z.min.x+1,ut=z.max.y-z.min.y+1,gt=z.max.z-z.min.z+1,mt=ye.convert(de.format),Mt=ye.convert(de.type);let ft;if(de.isData3DTexture)qe.setTexture3D(de,0),ft=W.TEXTURE_3D;else if(de.isDataArrayTexture)qe.setTexture2DArray(de,0),ft=W.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,de.flipY),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,de.premultiplyAlpha),W.pixelStorei(W.UNPACK_ALIGNMENT,de.unpackAlignment);const At=W.getParameter(W.UNPACK_ROW_LENGTH),qt=W.getParameter(W.UNPACK_IMAGE_HEIGHT),nn=W.getParameter(W.UNPACK_SKIP_PIXELS),Bn=W.getParameter(W.UNPACK_SKIP_ROWS),Zn=W.getParameter(W.UNPACK_SKIP_IMAGES),ln=Te.isCompressedTexture?Te.mipmaps[0]:Te.image;W.pixelStorei(W.UNPACK_ROW_LENGTH,ln.width),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,ln.height),W.pixelStorei(W.UNPACK_SKIP_PIXELS,z.min.x),W.pixelStorei(W.UNPACK_SKIP_ROWS,z.min.y),W.pixelStorei(W.UNPACK_SKIP_IMAGES,z.min.z),Te.isDataTexture||Te.isData3DTexture?W.texSubImage3D(ft,Ae,ge.x,ge.y,ge.z,rt,ut,gt,mt,Mt,ln.data):Te.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),W.compressedTexSubImage3D(ft,Ae,ge.x,ge.y,ge.z,rt,ut,gt,mt,ln.data)):W.texSubImage3D(ft,Ae,ge.x,ge.y,ge.z,rt,ut,gt,mt,Mt,ln),W.pixelStorei(W.UNPACK_ROW_LENGTH,At),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,qt),W.pixelStorei(W.UNPACK_SKIP_PIXELS,nn),W.pixelStorei(W.UNPACK_SKIP_ROWS,Bn),W.pixelStorei(W.UNPACK_SKIP_IMAGES,Zn),Ae===0&&de.generateMipmaps&&W.generateMipmap(ft),fe.unbindTexture()},this.initTexture=function(z){z.isCubeTexture?qe.setTextureCube(z,0):z.isData3DTexture?qe.setTexture3D(z,0):z.isDataArrayTexture||z.isCompressedArrayTexture?qe.setTexture2DArray(z,0):qe.setTexture2D(z,0),fe.unbindTexture()},this.resetState=function(){A=0,C=0,P=null,fe.reset(),ue.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ur}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===It?to:Cg}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===to?It:yr}}class Ew extends Mw{}Ew.prototype.isWebGL1Renderer=!0;class vf{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ct(e),this.density=t}clone(){return new vf(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Sf{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new ct(e),this.near=t,this.far=n}clone(){return new Sf(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Aw extends Yt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class bf{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Yc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Gi()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ci=new X;class Zo{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)ci.fromBufferAttribute(this,t),ci.applyMatrix4(e),this.setXYZ(t,ci.x,ci.y,ci.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ci.fromBufferAttribute(this,t),ci.applyNormalMatrix(e),this.setXYZ(t,ci.x,ci.y,ci.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ci.fromBufferAttribute(this,t),ci.transformDirection(e),this.setXYZ(t,ci.x,ci.y,ci.z);return this}setX(e,t){return this.normalized&&(t=Dt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Dt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Dt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Dt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ki(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ki(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ki(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ki(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array),i=Dt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Dt(t,this.array),n=Dt(n,this.array),i=Dt(i,this.array),r=Dt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new tn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Zo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Bg extends ri{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ct(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Xa;const pc=new X,Ya=new X,ja=new X,qa=new He,mc=new He,Tw=new Pt,$u=new X,gc=new X,Zu=new X,ov=new He,bm=new He,av=new He;class Cw extends Yt{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",Xa===void 0){Xa=new Bt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new bf(t,5);Xa.setIndex([0,1,2,0,2,3]),Xa.setAttribute("position",new Zo(n,3,0,!1)),Xa.setAttribute("uv",new Zo(n,2,3,!1))}this.geometry=Xa,this.material=e!==void 0?e:new Bg,this.center=new He(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ya.setFromMatrixScale(this.matrixWorld),Tw.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ja.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ya.multiplyScalar(-ja.z);const n=this.material.rotation;let i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;Ku($u.set(-.5,-.5,0),ja,o,Ya,i,r),Ku(gc.set(.5,-.5,0),ja,o,Ya,i,r),Ku(Zu.set(.5,.5,0),ja,o,Ya,i,r),ov.set(0,0),bm.set(1,0),av.set(1,1);let a=e.ray.intersectTriangle($u,gc,Zu,!1,pc);if(a===null&&(Ku(gc.set(-.5,.5,0),ja,o,Ya,i,r),bm.set(0,1),a=e.ray.intersectTriangle($u,Zu,gc,!1,pc),a===null))return;const l=e.ray.origin.distanceTo(pc);l<e.near||l>e.far||t.push({distance:l,point:pc.clone(),uv:Wo.getInterpolation(pc,$u,gc,Zu,ov,bm,av,new He),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Ku(s,e,t,n,i,r){qa.subVectors(s,t).addScalar(.5).multiply(n),i!==void 0?(mc.x=r*qa.x-i*qa.y,mc.y=i*qa.x+r*qa.y):mc.copy(qa),s.copy(e),s.x+=mc.x,s.y+=mc.y,s.applyMatrix4(Tw)}const Ju=new X,lv=new X;class Rw extends Yt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const r=t[n];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Ju.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Ju);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ju.setFromMatrixPosition(e.matrixWorld),lv.setFromMatrixPosition(this.matrixWorld);const n=Ju.distanceTo(lv)/e.zoom;t[0].object.visible=!0;let i,r;for(i=1,r=t.length;i<r;i++){let o=t[i].distance;if(t[i].object.visible&&(o-=o*t[i].hysteresis),n>=o)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const cv=new X,hv=new Qt,uv=new Qt,iU=new X,dv=new Pt,$a=new X,wm=new wr,fv=new Pt,Mm=new Tl;class Pw extends qn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Pt,this.bindMatrixInverse=new Pt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Gr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)$a.fromBufferAttribute(t,n),this.applyBoneTransform(n,$a),this.boundingBox.expandByPoint($a)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new wr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)$a.fromBufferAttribute(t,n),this.applyBoneTransform(n,$a),this.boundingSphere.expandByPoint($a)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),wm.copy(this.boundingSphere),wm.applyMatrix4(i),e.ray.intersectsSphere(wm)!==!1&&(fv.copy(i).invert(),Mm.copy(e.ray).applyMatrix4(fv),!(this.boundingBox!==null&&Mm.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Mm)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Qt,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;hv.fromBufferAttribute(i.attributes.skinIndex,e),uv.fromBufferAttribute(i.attributes.skinWeight,e),cv.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=uv.getComponent(r);if(o!==0){const a=hv.getComponent(r);dv.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(iU.copy(cv).applyMatrix4(dv),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class zg extends Yt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class gl extends bn{constructor(e=null,t=1,n=1,i,r,o,a,l,h=vn,u=vn,f,p){super(null,o,a,l,h,u,i,r,f,p),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const pv=new Pt,rU=new Pt;class wf{constructor(e=[],t=[]){this.uuid=Gi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Pt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Pt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:rU;pv.multiplyMatrices(a,t[r]),pv.toArray(n,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new wf(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=cw(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new gl(t,e,e,Vi,Dr);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const r=e.bones[n];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new zg),this.bones.push(o),this.boneInverses.push(new Pt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const o=t[i];e.bones.push(o.uuid);const a=n[i];e.boneInverses.push(a.toArray())}return e}}class wl extends tn{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Za=new Pt,mv=new Pt,Qu=[],gv=new Gr,sU=new Pt,_c=new qn,xc=new wr;let Iw=class extends qn{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new wl(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,sU)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Gr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Za),gv.copy(e.boundingBox).applyMatrix4(Za),this.boundingBox.union(gv)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new wr),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Za),xc.copy(e.boundingSphere).applyMatrix4(Za),this.boundingSphere.union(xc)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(_c.geometry=this.geometry,_c.material=this.material,_c.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),xc.copy(this.boundingSphere),xc.applyMatrix4(n),e.ray.intersectsSphere(xc)!==!1))for(let r=0;r<i;r++){this.getMatrixAt(r,Za),mv.multiplyMatrices(n,Za),_c.matrixWorld=mv,_c.raycast(e,Qu);for(let o=0,a=Qu.length;o<a;o++){const l=Qu[o];l.instanceId=r,l.object=this,t.push(l)}Qu.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new wl(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};class pi extends ri{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ct(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _v=new X,xv=new X,yv=new Pt,Em=new Tl,ed=new wr;class ao extends Yt{constructor(e=new Bt,t=new pi){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)_v.fromBufferAttribute(t,i-1),xv.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=_v.distanceTo(xv);e.setAttribute("lineDistance",new dt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),ed.copy(n.boundingSphere),ed.applyMatrix4(i),ed.radius+=r,e.ray.intersectsSphere(ed)===!1)return;yv.copy(i).invert(),Em.copy(e.ray).applyMatrix4(yv);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,h=new X,u=new X,f=new X,p=new X,m=this.isLineSegments?2:1,g=n.index,y=n.attributes.position;if(g!==null){const x=Math.max(0,o.start),w=Math.min(g.count,o.start+o.count);for(let S=x,E=w-1;S<E;S+=m){const A=g.getX(S),C=g.getX(S+1);if(h.fromBufferAttribute(y,A),u.fromBufferAttribute(y,C),Em.distanceSqToSegment(h,u,p,f)>l)continue;p.applyMatrix4(this.matrixWorld);const L=e.ray.origin.distanceTo(p);L<e.near||L>e.far||t.push({distance:L,point:f.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this})}}else{const x=Math.max(0,o.start),w=Math.min(y.count,o.start+o.count);for(let S=x,E=w-1;S<E;S+=m){if(h.fromBufferAttribute(y,S),u.fromBufferAttribute(y,S+1),Em.distanceSqToSegment(h,u,p,f)>l)continue;p.applyMatrix4(this.matrixWorld);const C=e.ray.origin.distanceTo(p);C<e.near||C>e.far||t.push({distance:C,point:f.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}const vv=new X,Sv=new X;class Hr extends ao{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)vv.fromBufferAttribute(t,i),Sv.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+vv.distanceTo(Sv);e.setAttribute("lineDistance",new dt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Lw extends ao{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Vg extends ri{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ct(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const bv=new Pt,W0=new Tl,td=new wr,nd=new X;class Nw extends Yt{constructor(e=new Bt,t=new Vg){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),td.copy(n.boundingSphere),td.applyMatrix4(i),td.radius+=r,e.ray.intersectsSphere(td)===!1)return;bv.copy(i).invert(),W0.copy(e.ray).applyMatrix4(bv);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,h=n.index,f=n.attributes.position;if(h!==null){const p=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let g=p,v=m;g<v;g++){const y=h.getX(g);nd.fromBufferAttribute(f,y),wv(nd,y,l,i,e,t,this)}}else{const p=Math.max(0,o.start),m=Math.min(f.count,o.start+o.count);for(let g=p,v=m;g<v;g++)nd.fromBufferAttribute(f,g),wv(nd,g,l,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function wv(s,e,t,n,i,r,o){const a=W0.distanceSqToPoint(s);if(a<t){const l=new X;W0.closestPointToPoint(s,l),l.applyMatrix4(n);const h=i.ray.origin.distanceTo(l);if(h<i.near||h>i.far)return;r.push({distance:h,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class oU extends bn{constructor(e,t,n,i,r,o,a,l,h){super(e,t,n,i,r,o,a,l,h),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Sn,this.magFilter=r!==void 0?r:Sn,this.generateMipmaps=!1;const u=this;function f(){u.needsUpdate=!0,e.requestVideoFrameCallback(f)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(f)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class aU extends bn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=vn,this.minFilter=vn,this.generateMipmaps=!1,this.needsUpdate=!0}}class kg extends bn{constructor(e,t,n,i,r,o,a,l,h,u,f,p){super(null,o,a,l,h,u,i,r,f,p),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class lU extends kg{constructor(e,t,n,i,r,o){super(e,t,n,r,o),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=ii}}class cU extends bn{constructor(e,t,n,i,r,o,a,l,h){super(e,t,n,i,r,o,a,l,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Mr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;t?o=t:o=e*n[r-1];let a=0,l=r-1,h;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),h=n[i]-o,h<0)a=i+1;else if(h>0)l=i-1;else{l=i;break}if(i=l,n[i]===o)return i/(r-1);const u=n[i],p=n[i+1]-u,m=(o-u)/p;return(i+m)/(r-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),a=this.getPoint(r),l=t||(o.isVector2?new He:new X);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new X,i=[],r=[],o=[],a=new X,l=new Pt;for(let m=0;m<=e;m++){const g=m/e;i[m]=this.getTangentAt(g,new X)}r[0]=new X,o[0]=new X;let h=Number.MAX_VALUE;const u=Math.abs(i[0].x),f=Math.abs(i[0].y),p=Math.abs(i[0].z);u<=h&&(h=u,n.set(1,0,0)),f<=h&&(h=f,n.set(0,1,0)),p<=h&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),o[0].crossVectors(i[0],r[0]);for(let m=1;m<=e;m++){if(r[m]=r[m-1].clone(),o[m]=o[m-1].clone(),a.crossVectors(i[m-1],i[m]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(mn(i[m-1].dot(i[m]),-1,1));r[m].applyMatrix4(l.makeRotationAxis(a,g))}o[m].crossVectors(i[m],r[m])}if(t===!0){let m=Math.acos(mn(r[0].dot(r[e]),-1,1));m/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(m=-m);for(let g=1;g<=e;g++)r[g].applyMatrix4(l.makeRotationAxis(i[g],m*g)),o[g].crossVectors(i[g],r[g])}return{tangents:i,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Mf extends Mr{constructor(e=0,t=0,n=1,i=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const n=t||new He,i=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(o?r=0:r=i),this.aClockwise===!0&&!o&&(r===i?r=-i:r=r-i);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),h=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),f=Math.sin(this.aRotation),p=l-this.aX,m=h-this.aY;l=p*u-m*f+this.aX,h=p*f+m*u+this.aY}return n.set(l,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Fw extends Mf{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Gg(){let s=0,e=0,t=0,n=0;function i(r,o,a,l){s=r,e=a,t=-3*r+3*o-2*a-l,n=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,h){i(o,a,h*(a-r),h*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,h,u,f){let p=(o-r)/h-(a-r)/(h+u)+(a-o)/u,m=(a-o)/u-(l-o)/(u+f)+(l-a)/f;p*=u,m*=u,i(o,a,p,m)},calc:function(r){const o=r*r,a=o*r;return s+e*r+t*o+n*a}}}const id=new X,Am=new Gg,Tm=new Gg,Cm=new Gg;class Ow extends Mr{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new X){const n=t,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let h,u;this.closed||a>0?h=i[(a-1)%r]:(id.subVectors(i[0],i[1]).add(i[0]),h=id);const f=i[a%r],p=i[(a+1)%r];if(this.closed||a+2<r?u=i[(a+2)%r]:(id.subVectors(i[r-1],i[r-2]).add(i[r-1]),u=id),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let g=Math.pow(h.distanceToSquared(f),m),v=Math.pow(f.distanceToSquared(p),m),y=Math.pow(p.distanceToSquared(u),m);v<1e-4&&(v=1),g<1e-4&&(g=v),y<1e-4&&(y=v),Am.initNonuniformCatmullRom(h.x,f.x,p.x,u.x,g,v,y),Tm.initNonuniformCatmullRom(h.y,f.y,p.y,u.y,g,v,y),Cm.initNonuniformCatmullRom(h.z,f.z,p.z,u.z,g,v,y)}else this.curveType==="catmullrom"&&(Am.initCatmullRom(h.x,f.x,p.x,u.x,this.tension),Tm.initCatmullRom(h.y,f.y,p.y,u.y,this.tension),Cm.initCatmullRom(h.z,f.z,p.z,u.z,this.tension));return n.set(Am.calc(l),Tm.calc(l),Cm.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new X().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Mv(s,e,t,n,i){const r=(n-e)*.5,o=(i-t)*.5,a=s*s,l=s*a;return(2*t-2*n+r+o)*l+(-3*t+3*n-2*r-o)*a+r*s+t}function hU(s,e){const t=1-s;return t*t*e}function uU(s,e){return 2*(1-s)*s*e}function dU(s,e){return s*s*e}function Dc(s,e,t,n){return hU(s,e)+uU(s,t)+dU(s,n)}function fU(s,e){const t=1-s;return t*t*t*e}function pU(s,e){const t=1-s;return 3*t*t*s*e}function mU(s,e){return 3*(1-s)*s*s*e}function gU(s,e){return s*s*s*e}function Uc(s,e,t,n,i){return fU(s,e)+pU(s,t)+mU(s,n)+gU(s,i)}class Hg extends Mr{constructor(e=new He,t=new He,n=new He,i=new He){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new He){const n=t,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Uc(e,i.x,r.x,o.x,a.x),Uc(e,i.y,r.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Dw extends Mr{constructor(e=new X,t=new X,n=new X,i=new X){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new X){const n=t,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Uc(e,i.x,r.x,o.x,a.x),Uc(e,i.y,r.y,o.y,a.y),Uc(e,i.z,r.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ef extends Mr{constructor(e=new He,t=new He){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new He){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new He){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Uw extends Mr{constructor(e=new X,t=new X){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new X){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new X){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Wg extends Mr{constructor(e=new He,t=new He,n=new He){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new He){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(Dc(e,i.x,r.x,o.x),Dc(e,i.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Xg extends Mr{constructor(e=new X,t=new X,n=new X){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new X){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(Dc(e,i.x,r.x,o.x),Dc(e,i.y,r.y,o.y),Dc(e,i.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Yg extends Mr{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new He){const n=t,i=this.points,r=(i.length-1)*e,o=Math.floor(r),a=r-o,l=i[o===0?o:o-1],h=i[o],u=i[o>i.length-2?i.length-1:o+1],f=i[o>i.length-3?i.length-1:o+2];return n.set(Mv(a,l.x,h.x,u.x,f.x),Mv(a,l.y,h.y,u.y,f.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new He().fromArray(i))}return this}}var jg=Object.freeze({__proto__:null,ArcCurve:Fw,CatmullRomCurve3:Ow,CubicBezierCurve:Hg,CubicBezierCurve3:Dw,EllipseCurve:Mf,LineCurve:Ef,LineCurve3:Uw,QuadraticBezierCurve:Wg,QuadraticBezierCurve3:Xg,SplineCurve:Yg});class Bw extends Mr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ef(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const o=i[r]-n,a=this.curves[r],l=a.getLength(),h=l===0?0:1-o/l;return a.getPointAt(h,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let h=0;h<l.length;h++){const u=l[h];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new jg[i.type]().fromJSON(i))}return this}}class $c extends Bw{constructor(e){super(),this.type="Path",this.currentPoint=new He,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Ef(this.currentPoint.clone(),new He(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new Wg(this.currentPoint.clone(),new He(e,t),new He(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const a=new Hg(this.currentPoint.clone(),new He(e,t),new He(n,i),new He(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Yg(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,a,l){const h=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+h,t+u,n,i,r,o,a,l),this}absellipse(e,t,n,i,r,o,a,l){const h=new Mf(e,t,n,i,r,o,a,l);if(this.curves.length>0){const f=h.getPoint(0);f.equals(this.currentPoint)||this.lineTo(f.x,f.y)}this.curves.push(h);const u=h.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Pl extends Bt{constructor(e=[new He(0,-.5),new He(.5,0),new He(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=mn(i,0,Math.PI*2);const r=[],o=[],a=[],l=[],h=[],u=1/t,f=new X,p=new He,m=new X,g=new X,v=new X;let y=0,x=0;for(let w=0;w<=e.length-1;w++)switch(w){case 0:y=e[w+1].x-e[w].x,x=e[w+1].y-e[w].y,m.x=x*1,m.y=-y,m.z=x*0,v.copy(m),m.normalize(),l.push(m.x,m.y,m.z);break;case e.length-1:l.push(v.x,v.y,v.z);break;default:y=e[w+1].x-e[w].x,x=e[w+1].y-e[w].y,m.x=x*1,m.y=-y,m.z=x*0,g.copy(m),m.x+=v.x,m.y+=v.y,m.z+=v.z,m.normalize(),l.push(m.x,m.y,m.z),v.copy(g)}for(let w=0;w<=t;w++){const S=n+w*u*i,E=Math.sin(S),A=Math.cos(S);for(let C=0;C<=e.length-1;C++){f.x=e[C].x*E,f.y=e[C].y,f.z=e[C].x*A,o.push(f.x,f.y,f.z),p.x=w/t,p.y=C/(e.length-1),a.push(p.x,p.y);const P=l[3*C+0]*E,L=l[3*C+1],T=l[3*C+0]*A;h.push(P,L,T)}}for(let w=0;w<t;w++)for(let S=0;S<e.length-1;S++){const E=S+w*e.length,A=E,C=E+e.length,P=E+e.length+1,L=E+1;r.push(A,C,L),r.push(P,L,C)}this.setIndex(r),this.setAttribute("position",new dt(o,3)),this.setAttribute("uv",new dt(a,2)),this.setAttribute("normal",new dt(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pl(e.points,e.segments,e.phiStart,e.phiLength)}}class dh extends Pl{constructor(e=1,t=1,n=4,i=8){const r=new $c;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new dh(e.radius,e.length,e.capSegments,e.radialSegments)}}class fh extends Bt{constructor(e=1,t=32,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],o=[],a=[],l=[],h=new X,u=new He;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let f=0,p=3;f<=t;f++,p+=3){const m=n+f/t*i;h.x=e*Math.cos(m),h.y=e*Math.sin(m),o.push(h.x,h.y,h.z),a.push(0,0,1),u.x=(o[p]/e+1)/2,u.y=(o[p+1]/e+1)/2,l.push(u.x,u.y)}for(let f=1;f<=t;f++)r.push(f,f+1,0);this.setIndex(r),this.setAttribute("position",new dt(o,3)),this.setAttribute("normal",new dt(a,3)),this.setAttribute("uv",new dt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class na extends Bt{constructor(e=1,t=1,n=1,i=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const h=this;i=Math.floor(i),r=Math.floor(r);const u=[],f=[],p=[],m=[];let g=0;const v=[],y=n/2;let x=0;w(),o===!1&&(e>0&&S(!0),t>0&&S(!1)),this.setIndex(u),this.setAttribute("position",new dt(f,3)),this.setAttribute("normal",new dt(p,3)),this.setAttribute("uv",new dt(m,2));function w(){const E=new X,A=new X;let C=0;const P=(t-e)/n;for(let L=0;L<=r;L++){const T=[],R=L/r,G=R*(t-e)+e;for(let K=0;K<=i;K++){const Z=K/i,O=Z*l+a,V=Math.sin(O),j=Math.cos(O);A.x=G*V,A.y=-R*n+y,A.z=G*j,f.push(A.x,A.y,A.z),E.set(V,P,j).normalize(),p.push(E.x,E.y,E.z),m.push(Z,1-R),T.push(g++)}v.push(T)}for(let L=0;L<i;L++)for(let T=0;T<r;T++){const R=v[T][L],G=v[T+1][L],K=v[T+1][L+1],Z=v[T][L+1];u.push(R,G,Z),u.push(G,K,Z),C+=6}h.addGroup(x,C,0),x+=C}function S(E){const A=g,C=new He,P=new X;let L=0;const T=E===!0?e:t,R=E===!0?1:-1;for(let K=1;K<=i;K++)f.push(0,y*R,0),p.push(0,R,0),m.push(.5,.5),g++;const G=g;for(let K=0;K<=i;K++){const O=K/i*l+a,V=Math.cos(O),j=Math.sin(O);P.x=T*j,P.y=y*R,P.z=T*V,f.push(P.x,P.y,P.z),p.push(0,R,0),C.x=V*.5+.5,C.y=j*.5*R+.5,m.push(C.x,C.y),g++}for(let K=0;K<i;K++){const Z=A+K,O=G+K;E===!0?u.push(O,O+1,Z):u.push(O+1,O,Z),L+=3}h.addGroup(x,L,E===!0?1:2),x+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new na(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ph extends na{constructor(e=1,t=1,n=32,i=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,n,i,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new ph(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Es extends Bt{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];a(i),h(n),u(),this.setAttribute("position",new dt(r,3)),this.setAttribute("normal",new dt(r.slice(),3)),this.setAttribute("uv",new dt(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(w){const S=new X,E=new X,A=new X;for(let C=0;C<t.length;C+=3)m(t[C+0],S),m(t[C+1],E),m(t[C+2],A),l(S,E,A,w)}function l(w,S,E,A){const C=A+1,P=[];for(let L=0;L<=C;L++){P[L]=[];const T=w.clone().lerp(E,L/C),R=S.clone().lerp(E,L/C),G=C-L;for(let K=0;K<=G;K++)K===0&&L===C?P[L][K]=T:P[L][K]=T.clone().lerp(R,K/G)}for(let L=0;L<C;L++)for(let T=0;T<2*(C-L)-1;T++){const R=Math.floor(T/2);T%2===0?(p(P[L][R+1]),p(P[L+1][R]),p(P[L][R])):(p(P[L][R+1]),p(P[L+1][R+1]),p(P[L+1][R]))}}function h(w){const S=new X;for(let E=0;E<r.length;E+=3)S.x=r[E+0],S.y=r[E+1],S.z=r[E+2],S.normalize().multiplyScalar(w),r[E+0]=S.x,r[E+1]=S.y,r[E+2]=S.z}function u(){const w=new X;for(let S=0;S<r.length;S+=3){w.x=r[S+0],w.y=r[S+1],w.z=r[S+2];const E=y(w)/2/Math.PI+.5,A=x(w)/Math.PI+.5;o.push(E,1-A)}g(),f()}function f(){for(let w=0;w<o.length;w+=6){const S=o[w+0],E=o[w+2],A=o[w+4],C=Math.max(S,E,A),P=Math.min(S,E,A);C>.9&&P<.1&&(S<.2&&(o[w+0]+=1),E<.2&&(o[w+2]+=1),A<.2&&(o[w+4]+=1))}}function p(w){r.push(w.x,w.y,w.z)}function m(w,S){const E=w*3;S.x=e[E+0],S.y=e[E+1],S.z=e[E+2]}function g(){const w=new X,S=new X,E=new X,A=new X,C=new He,P=new He,L=new He;for(let T=0,R=0;T<r.length;T+=9,R+=6){w.set(r[T+0],r[T+1],r[T+2]),S.set(r[T+3],r[T+4],r[T+5]),E.set(r[T+6],r[T+7],r[T+8]),C.set(o[R+0],o[R+1]),P.set(o[R+2],o[R+3]),L.set(o[R+4],o[R+5]),A.copy(w).add(S).add(E).divideScalar(3);const G=y(A);v(C,R+0,w,G),v(P,R+2,S,G),v(L,R+4,E,G)}}function v(w,S,E,A){A<0&&w.x===1&&(o[S]=w.x-1),E.x===0&&E.z===0&&(o[S]=A/2/Math.PI+.5)}function y(w){return Math.atan2(w.z,-w.x)}function x(w){return Math.atan2(-w.y,Math.sqrt(w.x*w.x+w.z*w.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Es(e.vertices,e.indices,e.radius,e.details)}}class mh extends Es{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new mh(e.radius,e.detail)}}const rd=new X,sd=new X,Rm=new X,od=new Wo;class zw extends Bt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),r=Math.cos(jo*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,h=[0,0,0],u=["a","b","c"],f=new Array(3),p={},m=[];for(let g=0;g<l;g+=3){o?(h[0]=o.getX(g),h[1]=o.getX(g+1),h[2]=o.getX(g+2)):(h[0]=g,h[1]=g+1,h[2]=g+2);const{a:v,b:y,c:x}=od;if(v.fromBufferAttribute(a,h[0]),y.fromBufferAttribute(a,h[1]),x.fromBufferAttribute(a,h[2]),od.getNormal(Rm),f[0]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,f[1]=`${Math.round(y.x*i)},${Math.round(y.y*i)},${Math.round(y.z*i)}`,f[2]=`${Math.round(x.x*i)},${Math.round(x.y*i)},${Math.round(x.z*i)}`,!(f[0]===f[1]||f[1]===f[2]||f[2]===f[0]))for(let w=0;w<3;w++){const S=(w+1)%3,E=f[w],A=f[S],C=od[u[w]],P=od[u[S]],L=`${E}_${A}`,T=`${A}_${E}`;T in p&&p[T]?(Rm.dot(p[T].normal)<=r&&(m.push(C.x,C.y,C.z),m.push(P.x,P.y,P.z)),p[T]=null):L in p||(p[L]={index0:h[w],index1:h[S],normal:Rm.clone()})}}for(const g in p)if(p[g]){const{index0:v,index1:y}=p[g];rd.fromBufferAttribute(a,v),sd.fromBufferAttribute(a,y),m.push(rd.x,rd.y,rd.z),m.push(sd.x,sd.y,sd.z)}this.setAttribute("position",new dt(m,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class qo extends $c{constructor(e){super(e),this.uuid=Gi(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new $c().fromJSON(i))}return this}}const _U={triangulate:function(s,e,t=2){const n=e&&e.length,i=n?e[0]*t:s.length;let r=Vw(s,0,i,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,h,u,f,p,m;if(n&&(r=bU(s,e,r,t)),s.length>80*t){a=h=s[0],l=u=s[1];for(let g=t;g<i;g+=t)f=s[g],p=s[g+1],f<a&&(a=f),p<l&&(l=p),f>h&&(h=f),p>u&&(u=p);m=Math.max(h-a,u-l),m=m!==0?32767/m:0}return Zc(r,o,t,a,l,m,0),o}};function Vw(s,e,t,n,i){let r,o;if(i===NU(s,e,t,n)>0)for(r=e;r<t;r+=n)o=Ev(r,s[r],s[r+1],o);else for(r=t-n;r>=e;r-=n)o=Ev(r,s[r],s[r+1],o);return o&&Af(o,o.next)&&(Jc(o),o=o.next),o}function Ko(s,e){if(!s)return s;e||(e=s);let t=s,n;do if(n=!1,!t.steiner&&(Af(t,t.next)||un(t.prev,t,t.next)===0)){if(Jc(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Zc(s,e,t,n,i,r,o){if(!s)return;!o&&r&&TU(s,n,i,r);let a=s,l,h;for(;s.prev!==s.next;){if(l=s.prev,h=s.next,r?yU(s,n,i,r):xU(s)){e.push(l.i/t|0),e.push(s.i/t|0),e.push(h.i/t|0),Jc(s),s=h.next,a=h.next;continue}if(s=h,s===a){o?o===1?(s=vU(Ko(s),e,t),Zc(s,e,t,n,i,r,2)):o===2&&SU(s,e,t,n,i,r):Zc(Ko(s),e,t,n,i,r,1);break}}}function xU(s){const e=s.prev,t=s,n=s.next;if(un(e,t,n)>=0)return!1;const i=e.x,r=t.x,o=n.x,a=e.y,l=t.y,h=n.y,u=i<r?i<o?i:o:r<o?r:o,f=a<l?a<h?a:h:l<h?l:h,p=i>r?i>o?i:o:r>o?r:o,m=a>l?a>h?a:h:l>h?l:h;let g=n.next;for(;g!==e;){if(g.x>=u&&g.x<=p&&g.y>=f&&g.y<=m&&dl(i,a,r,l,o,h,g.x,g.y)&&un(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function yU(s,e,t,n){const i=s.prev,r=s,o=s.next;if(un(i,r,o)>=0)return!1;const a=i.x,l=r.x,h=o.x,u=i.y,f=r.y,p=o.y,m=a<l?a<h?a:h:l<h?l:h,g=u<f?u<p?u:p:f<p?f:p,v=a>l?a>h?a:h:l>h?l:h,y=u>f?u>p?u:p:f>p?f:p,x=X0(m,g,e,t,n),w=X0(v,y,e,t,n);let S=s.prevZ,E=s.nextZ;for(;S&&S.z>=x&&E&&E.z<=w;){if(S.x>=m&&S.x<=v&&S.y>=g&&S.y<=y&&S!==i&&S!==o&&dl(a,u,l,f,h,p,S.x,S.y)&&un(S.prev,S,S.next)>=0||(S=S.prevZ,E.x>=m&&E.x<=v&&E.y>=g&&E.y<=y&&E!==i&&E!==o&&dl(a,u,l,f,h,p,E.x,E.y)&&un(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;S&&S.z>=x;){if(S.x>=m&&S.x<=v&&S.y>=g&&S.y<=y&&S!==i&&S!==o&&dl(a,u,l,f,h,p,S.x,S.y)&&un(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;E&&E.z<=w;){if(E.x>=m&&E.x<=v&&E.y>=g&&E.y<=y&&E!==i&&E!==o&&dl(a,u,l,f,h,p,E.x,E.y)&&un(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function vU(s,e,t){let n=s;do{const i=n.prev,r=n.next.next;!Af(i,r)&&kw(i,n,n.next,r)&&Kc(i,r)&&Kc(r,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(r.i/t|0),Jc(n),Jc(n.next),n=s=r),n=n.next}while(n!==s);return Ko(n)}function SU(s,e,t,n,i,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&PU(o,a)){let l=Gw(o,a);o=Ko(o,o.next),l=Ko(l,l.next),Zc(o,e,t,n,i,r,0),Zc(l,e,t,n,i,r,0);return}a=a.next}o=o.next}while(o!==s)}function bU(s,e,t,n){const i=[];let r,o,a,l,h;for(r=0,o=e.length;r<o;r++)a=e[r]*n,l=r<o-1?e[r+1]*n:s.length,h=Vw(s,a,l,n,!1),h===h.next&&(h.steiner=!0),i.push(RU(h));for(i.sort(wU),r=0;r<i.length;r++)t=MU(i[r],t);return t}function wU(s,e){return s.x-e.x}function MU(s,e){const t=EU(s,e);if(!t)return e;const n=Gw(t,s);return Ko(n,n.next),Ko(t,t.next)}function EU(s,e){let t=e,n=-1/0,i;const r=s.x,o=s.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const p=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(p<=r&&p>n&&(n=p,i=t.x<t.next.x?t:t.next,p===r))return i}t=t.next}while(t!==e);if(!i)return null;const a=i,l=i.x,h=i.y;let u=1/0,f;t=i;do r>=t.x&&t.x>=l&&r!==t.x&&dl(o<h?r:n,o,l,h,o<h?n:r,o,t.x,t.y)&&(f=Math.abs(o-t.y)/(r-t.x),Kc(t,s)&&(f<u||f===u&&(t.x>i.x||t.x===i.x&&AU(i,t)))&&(i=t,u=f)),t=t.next;while(t!==a);return i}function AU(s,e){return un(s.prev,s,e.prev)<0&&un(e.next,s,s.next)<0}function TU(s,e,t,n){let i=s;do i.z===0&&(i.z=X0(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==s);i.prevZ.nextZ=null,i.prevZ=null,CU(i)}function CU(s){let e,t,n,i,r,o,a,l,h=1;do{for(t=s,s=null,r=null,o=0;t;){for(o++,n=t,a=0,e=0;e<h&&(a++,n=n.nextZ,!!n);e++);for(l=h;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),r?r.nextZ=i:s=i,i.prevZ=r,r=i;t=n}r.nextZ=null,h*=2}while(o>1);return s}function X0(s,e,t,n,i){return s=(s-t)*i|0,e=(e-n)*i|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function RU(s){let e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function dl(s,e,t,n,i,r,o,a){return(i-o)*(e-a)>=(s-o)*(r-a)&&(s-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(i-o)*(n-a)}function PU(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!IU(s,e)&&(Kc(s,e)&&Kc(e,s)&&LU(s,e)&&(un(s.prev,s,e.prev)||un(s,e.prev,e))||Af(s,e)&&un(s.prev,s,s.next)>0&&un(e.prev,e,e.next)>0)}function un(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function Af(s,e){return s.x===e.x&&s.y===e.y}function kw(s,e,t,n){const i=ld(un(s,e,t)),r=ld(un(s,e,n)),o=ld(un(t,n,s)),a=ld(un(t,n,e));return!!(i!==r&&o!==a||i===0&&ad(s,t,e)||r===0&&ad(s,n,e)||o===0&&ad(t,s,n)||a===0&&ad(t,e,n))}function ad(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function ld(s){return s>0?1:s<0?-1:0}function IU(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&kw(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function Kc(s,e){return un(s.prev,s,s.next)<0?un(s,e,s.next)>=0&&un(s,s.prev,e)>=0:un(s,e,s.prev)<0||un(s,s.next,e)<0}function LU(s,e){let t=s,n=!1;const i=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==s);return n}function Gw(s,e){const t=new Y0(s.i,s.x,s.y),n=new Y0(e.i,e.x,e.y),i=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function Ev(s,e,t,n){const i=new Y0(s,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Jc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Y0(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function NU(s,e,t,n){let i=0;for(let r=e,o=t-n;r<t;r+=n)i+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return i}class zr{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5}static isClockWise(e){return zr.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Av(e),Tv(n,e);let o=e.length;t.forEach(Av);for(let l=0;l<t.length;l++)i.push(o),o+=t[l].length,Tv(n,t[l]);const a=_U.triangulate(n,i);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function Av(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function Tv(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class gh extends Bt{constructor(e=new qo([new He(.5,.5),new He(-.5,.5),new He(-.5,-.5),new He(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let a=0,l=e.length;a<l;a++){const h=e[a];o(h)}this.setAttribute("position",new dt(i,3)),this.setAttribute("uv",new dt(r,2)),this.computeVertexNormals();function o(a){const l=[],h=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,f=t.depth!==void 0?t.depth:1;let p=t.bevelEnabled!==void 0?t.bevelEnabled:!0,m=t.bevelThickness!==void 0?t.bevelThickness:.2,g=t.bevelSize!==void 0?t.bevelSize:m-.1,v=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const x=t.extrudePath,w=t.UVGenerator!==void 0?t.UVGenerator:FU;let S,E=!1,A,C,P,L;x&&(S=x.getSpacedPoints(u),E=!0,p=!1,A=x.computeFrenetFrames(u,!1),C=new X,P=new X,L=new X),p||(y=0,m=0,g=0,v=0);const T=a.extractPoints(h);let R=T.shape;const G=T.holes;if(!zr.isClockWise(R)){R=R.reverse();for(let W=0,Le=G.length;W<Le;W++){const Q=G[W];zr.isClockWise(Q)&&(G[W]=Q.reverse())}}const Z=zr.triangulateShape(R,G),O=R;for(let W=0,Le=G.length;W<Le;W++){const Q=G[W];R=R.concat(Q)}function V(W,Le,Q){return Le||console.error("THREE.ExtrudeGeometry: vec does not exist"),W.clone().addScaledVector(Le,Q)}const j=R.length,q=Z.length;function J(W,Le,Q){let he,fe,De;const je=W.x-Le.x,qe=W.y-Le.y,it=Q.x-W.x,ot=Q.y-W.y,_t=je*je+qe*qe,H=je*ot-qe*it;if(Math.abs(H)>Number.EPSILON){const U=Math.sqrt(_t),we=Math.sqrt(it*it+ot*ot),We=Le.x-qe/U,Ge=Le.y+je/U,Je=Q.x-ot/we,nt=Q.y+it/we,N=((Je-We)*ot-(nt-Ge)*it)/(je*ot-qe*it);he=We+je*N-W.x,fe=Ge+qe*N-W.y;const F=he*he+fe*fe;if(F<=2)return new He(he,fe);De=Math.sqrt(F/2)}else{let U=!1;je>Number.EPSILON?it>Number.EPSILON&&(U=!0):je<-Number.EPSILON?it<-Number.EPSILON&&(U=!0):Math.sign(qe)===Math.sign(ot)&&(U=!0),U?(he=-qe,fe=je,De=Math.sqrt(_t)):(he=je,fe=qe,De=Math.sqrt(_t/2))}return new He(he/De,fe/De)}const se=[];for(let W=0,Le=O.length,Q=Le-1,he=W+1;W<Le;W++,Q++,he++)Q===Le&&(Q=0),he===Le&&(he=0),se[W]=J(O[W],O[Q],O[he]);const _e=[];let Re,ae=se.concat();for(let W=0,Le=G.length;W<Le;W++){const Q=G[W];Re=[];for(let he=0,fe=Q.length,De=fe-1,je=he+1;he<fe;he++,De++,je++)De===fe&&(De=0),je===fe&&(je=0),Re[he]=J(Q[he],Q[De],Q[je]);_e.push(Re),ae=ae.concat(Re)}for(let W=0;W<y;W++){const Le=W/y,Q=m*Math.cos(Le*Math.PI/2),he=g*Math.sin(Le*Math.PI/2)+v;for(let fe=0,De=O.length;fe<De;fe++){const je=V(O[fe],se[fe],he);ke(je.x,je.y,-Q)}for(let fe=0,De=G.length;fe<De;fe++){const je=G[fe];Re=_e[fe];for(let qe=0,it=je.length;qe<it;qe++){const ot=V(je[qe],Re[qe],he);ke(ot.x,ot.y,-Q)}}}const ve=g+v;for(let W=0;W<j;W++){const Le=p?V(R[W],ae[W],ve):R[W];E?(P.copy(A.normals[0]).multiplyScalar(Le.x),C.copy(A.binormals[0]).multiplyScalar(Le.y),L.copy(S[0]).add(P).add(C),ke(L.x,L.y,L.z)):ke(Le.x,Le.y,0)}for(let W=1;W<=u;W++)for(let Le=0;Le<j;Le++){const Q=p?V(R[Le],ae[Le],ve):R[Le];E?(P.copy(A.normals[W]).multiplyScalar(Q.x),C.copy(A.binormals[W]).multiplyScalar(Q.y),L.copy(S[W]).add(P).add(C),ke(L.x,L.y,L.z)):ke(Q.x,Q.y,f/u*W)}for(let W=y-1;W>=0;W--){const Le=W/y,Q=m*Math.cos(Le*Math.PI/2),he=g*Math.sin(Le*Math.PI/2)+v;for(let fe=0,De=O.length;fe<De;fe++){const je=V(O[fe],se[fe],he);ke(je.x,je.y,f+Q)}for(let fe=0,De=G.length;fe<De;fe++){const je=G[fe];Re=_e[fe];for(let qe=0,it=je.length;qe<it;qe++){const ot=V(je[qe],Re[qe],he);E?ke(ot.x,ot.y+S[u-1].y,S[u-1].x+Q):ke(ot.x,ot.y,f+Q)}}}oe(),Ce();function oe(){const W=i.length/3;if(p){let Le=0,Q=j*Le;for(let he=0;he<q;he++){const fe=Z[he];Ye(fe[2]+Q,fe[1]+Q,fe[0]+Q)}Le=u+y*2,Q=j*Le;for(let he=0;he<q;he++){const fe=Z[he];Ye(fe[0]+Q,fe[1]+Q,fe[2]+Q)}}else{for(let Le=0;Le<q;Le++){const Q=Z[Le];Ye(Q[2],Q[1],Q[0])}for(let Le=0;Le<q;Le++){const Q=Z[Le];Ye(Q[0]+j*u,Q[1]+j*u,Q[2]+j*u)}}n.addGroup(W,i.length/3-W,0)}function Ce(){const W=i.length/3;let Le=0;Ie(O,Le),Le+=O.length;for(let Q=0,he=G.length;Q<he;Q++){const fe=G[Q];Ie(fe,Le),Le+=fe.length}n.addGroup(W,i.length/3-W,1)}function Ie(W,Le){let Q=W.length;for(;--Q>=0;){const he=Q;let fe=Q-1;fe<0&&(fe=W.length-1);for(let De=0,je=u+y*2;De<je;De++){const qe=j*De,it=j*(De+1),ot=Le+he+qe,_t=Le+fe+qe,H=Le+fe+it,U=Le+he+it;$e(ot,_t,H,U)}}}function ke(W,Le,Q){l.push(W),l.push(Le),l.push(Q)}function Ye(W,Le,Q){et(W),et(Le),et(Q);const he=i.length/3,fe=w.generateTopUV(n,i,he-3,he-2,he-1);Ke(fe[0]),Ke(fe[1]),Ke(fe[2])}function $e(W,Le,Q,he){et(W),et(Le),et(he),et(Le),et(Q),et(he);const fe=i.length/3,De=w.generateSideWallUV(n,i,fe-6,fe-3,fe-2,fe-1);Ke(De[0]),Ke(De[1]),Ke(De[3]),Ke(De[1]),Ke(De[2]),Ke(De[3])}function et(W){i.push(l[W*3+0]),i.push(l[W*3+1]),i.push(l[W*3+2])}function Ke(W){r.push(W.x),r.push(W.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return OU(t,n,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];n.push(a)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new jg[i.type]().fromJSON(i)),new gh(n,e.options)}}const FU={generateTopUV:function(s,e,t,n,i){const r=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],h=e[i*3],u=e[i*3+1];return[new He(r,o),new He(a,l),new He(h,u)]},generateSideWallUV:function(s,e,t,n,i,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],h=e[n*3],u=e[n*3+1],f=e[n*3+2],p=e[i*3],m=e[i*3+1],g=e[i*3+2],v=e[r*3],y=e[r*3+1],x=e[r*3+2];return Math.abs(a-u)<Math.abs(o-h)?[new He(o,1-l),new He(h,1-f),new He(p,1-g),new He(v,1-x)]:[new He(a,1-l),new He(u,1-f),new He(m,1-g),new He(y,1-x)]}};function OU(s,e,t){if(t.shapes=[],Array.isArray(s))for(let n=0,i=s.length;n<i;n++){const r=s[n];t.shapes.push(r.uuid)}else t.shapes.push(s.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class _h extends Es{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _h(e.radius,e.detail)}}class Il extends Es{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Il(e.radius,e.detail)}}class xh extends Bt{constructor(e=.5,t=1,n=32,i=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const a=[],l=[],h=[],u=[];let f=e;const p=(t-e)/i,m=new X,g=new He;for(let v=0;v<=i;v++){for(let y=0;y<=n;y++){const x=r+y/n*o;m.x=f*Math.cos(x),m.y=f*Math.sin(x),l.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,u.push(g.x,g.y)}f+=p}for(let v=0;v<i;v++){const y=v*(n+1);for(let x=0;x<n;x++){const w=x+y,S=w,E=w+n+1,A=w+n+2,C=w+1;a.push(S,E,C),a.push(E,A,C)}}this.setIndex(a),this.setAttribute("position",new dt(l,3)),this.setAttribute("normal",new dt(h,3)),this.setAttribute("uv",new dt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xh(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class yh extends Bt{constructor(e=new qo([new He(0,.5),new He(-.5,-.5),new He(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)h(e);else for(let u=0;u<e.length;u++)h(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new dt(i,3)),this.setAttribute("normal",new dt(r,3)),this.setAttribute("uv",new dt(o,2));function h(u){const f=i.length/3,p=u.extractPoints(t);let m=p.shape;const g=p.holes;zr.isClockWise(m)===!1&&(m=m.reverse());for(let y=0,x=g.length;y<x;y++){const w=g[y];zr.isClockWise(w)===!0&&(g[y]=w.reverse())}const v=zr.triangulateShape(m,g);for(let y=0,x=g.length;y<x;y++){const w=g[y];m=m.concat(w)}for(let y=0,x=m.length;y<x;y++){const w=m[y];i.push(w.x,w.y,0),r.push(0,0,1),o.push(w.x,w.y)}for(let y=0,x=v.length;y<x;y++){const w=v[y],S=w[0]+f,E=w[1]+f,A=w[2]+f;n.push(S,E,A),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return DU(t,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const o=t[e.shapes[i]];n.push(o)}return new yh(n,e.curveSegments)}}function DU(s,e){if(e.shapes=[],Array.isArray(s))for(let t=0,n=s.length;t<n;t++){const i=s[t];e.shapes.push(i.uuid)}else e.shapes.push(s.uuid);return e}class Ll extends Bt{constructor(e=1,t=32,n=16,i=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let h=0;const u=[],f=new X,p=new X,m=[],g=[],v=[],y=[];for(let x=0;x<=n;x++){const w=[],S=x/n;let E=0;x===0&&o===0?E=.5/t:x===n&&l===Math.PI&&(E=-.5/t);for(let A=0;A<=t;A++){const C=A/t;f.x=-e*Math.cos(i+C*r)*Math.sin(o+S*a),f.y=e*Math.cos(o+S*a),f.z=e*Math.sin(i+C*r)*Math.sin(o+S*a),g.push(f.x,f.y,f.z),p.copy(f).normalize(),v.push(p.x,p.y,p.z),y.push(C+E,1-S),w.push(h++)}u.push(w)}for(let x=0;x<n;x++)for(let w=0;w<t;w++){const S=u[x][w+1],E=u[x][w],A=u[x+1][w],C=u[x+1][w+1];(x!==0||o>0)&&m.push(S,E,C),(x!==n-1||l<Math.PI)&&m.push(E,A,C)}this.setIndex(m),this.setAttribute("position",new dt(g,3)),this.setAttribute("normal",new dt(v,3)),this.setAttribute("uv",new dt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ll(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class vh extends Es{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new vh(e.radius,e.detail)}}class Sh extends Bt{constructor(e=1,t=.4,n=12,i=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],l=[],h=[],u=new X,f=new X,p=new X;for(let m=0;m<=n;m++)for(let g=0;g<=i;g++){const v=g/i*r,y=m/n*Math.PI*2;f.x=(e+t*Math.cos(y))*Math.cos(v),f.y=(e+t*Math.cos(y))*Math.sin(v),f.z=t*Math.sin(y),a.push(f.x,f.y,f.z),u.x=e*Math.cos(v),u.y=e*Math.sin(v),p.subVectors(f,u).normalize(),l.push(p.x,p.y,p.z),h.push(g/i),h.push(m/n)}for(let m=1;m<=n;m++)for(let g=1;g<=i;g++){const v=(i+1)*m+g-1,y=(i+1)*(m-1)+g-1,x=(i+1)*(m-1)+g,w=(i+1)*m+g;o.push(v,y,w),o.push(y,x,w)}this.setIndex(o),this.setAttribute("position",new dt(a,3)),this.setAttribute("normal",new dt(l,3)),this.setAttribute("uv",new dt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class bh extends Bt{constructor(e=1,t=.4,n=64,i=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const a=[],l=[],h=[],u=[],f=new X,p=new X,m=new X,g=new X,v=new X,y=new X,x=new X;for(let S=0;S<=n;++S){const E=S/n*r*Math.PI*2;w(E,r,o,e,m),w(E+.01,r,o,e,g),y.subVectors(g,m),x.addVectors(g,m),v.crossVectors(y,x),x.crossVectors(v,y),v.normalize(),x.normalize();for(let A=0;A<=i;++A){const C=A/i*Math.PI*2,P=-t*Math.cos(C),L=t*Math.sin(C);f.x=m.x+(P*x.x+L*v.x),f.y=m.y+(P*x.y+L*v.y),f.z=m.z+(P*x.z+L*v.z),l.push(f.x,f.y,f.z),p.subVectors(f,m).normalize(),h.push(p.x,p.y,p.z),u.push(S/n),u.push(A/i)}}for(let S=1;S<=n;S++)for(let E=1;E<=i;E++){const A=(i+1)*(S-1)+(E-1),C=(i+1)*S+(E-1),P=(i+1)*S+E,L=(i+1)*(S-1)+E;a.push(A,C,L),a.push(C,P,L)}this.setIndex(a),this.setAttribute("position",new dt(l,3)),this.setAttribute("normal",new dt(h,3)),this.setAttribute("uv",new dt(u,2));function w(S,E,A,C,P){const L=Math.cos(S),T=Math.sin(S),R=A/E*S,G=Math.cos(R);P.x=C*(2+G)*.5*L,P.y=C*(2+G)*T*.5,P.z=C*Math.sin(R)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bh(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class wh extends Bt{constructor(e=new Xg(new X(-1,-1,0),new X(-1,1,0),new X(1,1,0)),t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new X,l=new X,h=new He;let u=new X;const f=[],p=[],m=[],g=[];v(),this.setIndex(g),this.setAttribute("position",new dt(f,3)),this.setAttribute("normal",new dt(p,3)),this.setAttribute("uv",new dt(m,2));function v(){for(let S=0;S<t;S++)y(S);y(r===!1?t:0),w(),x()}function y(S){u=e.getPointAt(S/t,u);const E=o.normals[S],A=o.binormals[S];for(let C=0;C<=i;C++){const P=C/i*Math.PI*2,L=Math.sin(P),T=-Math.cos(P);l.x=T*E.x+L*A.x,l.y=T*E.y+L*A.y,l.z=T*E.z+L*A.z,l.normalize(),p.push(l.x,l.y,l.z),a.x=u.x+n*l.x,a.y=u.y+n*l.y,a.z=u.z+n*l.z,f.push(a.x,a.y,a.z)}}function x(){for(let S=1;S<=t;S++)for(let E=1;E<=i;E++){const A=(i+1)*(S-1)+(E-1),C=(i+1)*S+(E-1),P=(i+1)*S+E,L=(i+1)*(S-1)+E;g.push(A,C,L),g.push(C,P,L)}}function w(){for(let S=0;S<=t;S++)for(let E=0;E<=i;E++)h.x=S/t,h.y=E/i,m.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new wh(new jg[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Hw extends Bt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new X,r=new X;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let h=0,u=l.length;h<u;++h){const f=l[h],p=f.start,m=f.count;for(let g=p,v=p+m;g<v;g+=3)for(let y=0;y<3;y++){const x=a.getX(g+y),w=a.getX(g+(y+1)%3);i.fromBufferAttribute(o,x),r.fromBufferAttribute(o,w),Cv(i,r,n)===!0&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let h=0;h<3;h++){const u=3*a+h,f=3*a+(h+1)%3;i.fromBufferAttribute(o,u),r.fromBufferAttribute(o,f),Cv(i,r,n)===!0&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new dt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Cv(s,e,t){const n=`${s.x},${s.y},${s.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${s.x},${s.y},${s.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var Rv=Object.freeze({__proto__:null,BoxGeometry:uo,CapsuleGeometry:dh,CircleGeometry:fh,ConeGeometry:ph,CylinderGeometry:na,DodecahedronGeometry:mh,EdgesGeometry:zw,ExtrudeGeometry:gh,IcosahedronGeometry:_h,LatheGeometry:Pl,OctahedronGeometry:Il,PlaneGeometry:Cl,PolyhedronGeometry:Es,RingGeometry:xh,ShapeGeometry:yh,SphereGeometry:Ll,TetrahedronGeometry:vh,TorusGeometry:Sh,TorusKnotGeometry:bh,TubeGeometry:wh,WireframeGeometry:Hw});class Ww extends ri{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ct(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Xw extends kr{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class qg extends ri{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ct(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Yw extends qg{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new He(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return mn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ct(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ct(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ct(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class jw extends ri{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ct(16777215),this.specular=new ct(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ch,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class qw extends ri{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ct(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class $w extends ri{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Zw extends ri{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ch,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Kw extends ri{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ct(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Jw extends pi{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function rr(s,e,t){return $g(s)?new s.constructor(s.subarray(e,t!==void 0?t:s.length)):s.slice(e,t)}function Xo(s,e,t){return!s||!t&&s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function $g(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function Qw(s){function e(i,r){return s[i]-s[r]}const t=s.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function j0(s,e,t){const n=s.length,i=new s.constructor(n);for(let r=0,o=0;o!==n;++r){const a=t[r]*e;for(let l=0;l!==e;++l)i[o++]=s[a+l]}return i}function Zg(s,e,t,n){let i=1,r=s[0];for(;r!==void 0&&r[n]===void 0;)r=s[i++];if(r===void 0)return;let o=r[n];if(o!==void 0)if(Array.isArray(o))do o=r[n],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=s[i++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[n],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=s[i++];while(r!==void 0);else do o=r[n],o!==void 0&&(e.push(r.time),t.push(o)),r=s[i++];while(r!==void 0)}function UU(s,e,t,n,i=30){const r=s.clone();r.name=e;const o=[];for(let l=0;l<r.tracks.length;++l){const h=r.tracks[l],u=h.getValueSize(),f=[],p=[];for(let m=0;m<h.times.length;++m){const g=h.times[m]*i;if(!(g<t||g>=n)){f.push(h.times[m]);for(let v=0;v<u;++v)p.push(h.values[m*u+v])}}f.length!==0&&(h.times=Xo(f,h.times.constructor),h.values=Xo(p,h.values.constructor),o.push(h))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r}function BU(s,e=0,t=s,n=30){n<=0&&(n=30);const i=t.tracks.length,r=e/n;for(let o=0;o<i;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const h=s.tracks.find(function(x){return x.name===a.name&&x.ValueTypeName===l});if(h===void 0)continue;let u=0;const f=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=f/3);let p=0;const m=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=m/3);const g=a.times.length-1;let v;if(r<=a.times[0]){const x=u,w=f-u;v=rr(a.values,x,w)}else if(r>=a.times[g]){const x=g*f+u,w=x+f-u;v=rr(a.values,x,w)}else{const x=a.createInterpolant(),w=u,S=f-u;x.evaluate(r),v=rr(x.resultBuffer,w,S)}l==="quaternion"&&new Ei().fromArray(v).normalize().conjugate().toArray(v);const y=h.times.length;for(let x=0;x<y;++x){const w=x*m+p;if(l==="quaternion")Ei.multiplyQuaternionsFlat(h.values,w,v,0,h.values,w);else{const S=m-p*2;for(let E=0;E<S;++E)h.values[w+E]-=v[E]}}}return s.blendMode=Tg,s}const zU={arraySlice:rr,convertArray:Xo,isTypedArray:$g,getKeyframeOrder:Qw,sortedArray:j0,flattenJSON:Zg,subclip:UU,makeClipAdditive:BU};class Mh{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let a=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(!(e>=r)){const a=t[1];e<a&&(n=2,r=a);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class eM extends Mh{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ko,endingEnd:ko}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,a=i[r],l=i[o];if(a===void 0)switch(this.getSettings_().endingStart){case Go:r=e,a=2*t-n;break;case Xc:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Go:o=e,l=2*n-t;break;case Xc:o=1,l=n+i[1]-i[0];break;default:o=e-1,l=t}const h=(n-t)*.5,u=this.valueSize;this._weightPrev=h/(t-a),this._weightNext=h/(l-n),this._offsetPrev=r*u,this._offsetNext=o*u}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,h=l-a,u=this._offsetPrev,f=this._offsetNext,p=this._weightPrev,m=this._weightNext,g=(n-t)/(i-t),v=g*g,y=v*g,x=-p*y+2*p*v-p*g,w=(1+p)*y+(-1.5-2*p)*v+(-.5+p)*g+1,S=(-1-m)*y+(1.5+m)*v+.5*g,E=m*y-m*v;for(let A=0;A!==a;++A)r[A]=x*o[u+A]+w*o[h+A]+S*o[l+A]+E*o[f+A];return r}}class Kg extends Mh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,h=l-a,u=(n-t)/(i-t),f=1-u;for(let p=0;p!==a;++p)r[p]=o[h+p]*f+o[l+p]*u;return r}}class tM extends Mh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Er{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Xo(t,this.TimeBufferType),this.values=Xo(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Xo(e.times,Array),values:Xo(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new tM(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Kg(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new eM(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Hc:t=this.InterpolantFactoryMethodDiscrete;break;case Wc:t=this.InterpolantFactoryMethodLinear;break;case Gd:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Hc;case this.InterpolantFactoryMethodLinear:return Wc;case this.InterpolantFactoryMethodSmooth:return Gd}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;o!==-1&&n[o]>t;)--o;if(++o,r!==0||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=rr(n,r,o),this.values=rr(this.values,r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(i!==void 0&&$g(i))for(let a=0,l=i.length;a!==l;++a){const h=i[a];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,h),e=!1;break}}return e}optimize(){const e=rr(this.times),t=rr(this.values),n=this.getValueSize(),i=this.getInterpolation()===Gd,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const h=e[a],u=e[a+1];if(h!==u&&(a!==1||h!==e[0]))if(i)l=!0;else{const f=a*n,p=f-n,m=f+n;for(let g=0;g!==n;++g){const v=t[f+g];if(v!==t[p+g]||v!==t[m+g]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const f=a*n,p=o*n;for(let m=0;m!==n;++m)t[p+m]=t[f+m]}++o}}if(r>0){e[o]=e[r];for(let a=r*n,l=o*n,h=0;h!==n;++h)t[l+h]=t[a+h];++o}return o!==e.length?(this.times=rr(e,0,o),this.values=rr(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=rr(this.times,0),t=rr(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Er.prototype.TimeBufferType=Float32Array;Er.prototype.ValueBufferType=Float32Array;Er.prototype.DefaultInterpolation=Wc;class ia extends Er{}ia.prototype.ValueTypeName="bool";ia.prototype.ValueBufferType=Array;ia.prototype.DefaultInterpolation=Hc;ia.prototype.InterpolantFactoryMethodLinear=void 0;ia.prototype.InterpolantFactoryMethodSmooth=void 0;class Jg extends Er{}Jg.prototype.ValueTypeName="color";class Qc extends Er{}Qc.prototype.ValueTypeName="number";class nM extends Mh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(i-t);let h=e*a;for(let u=h+a;h!==u;h+=4)Ei.slerpFlat(r,0,o,h-a,o,h,l);return r}}class Nl extends Er{InterpolantFactoryMethodLinear(e){return new nM(this.times,this.values,this.getValueSize(),e)}}Nl.prototype.ValueTypeName="quaternion";Nl.prototype.DefaultInterpolation=Wc;Nl.prototype.InterpolantFactoryMethodSmooth=void 0;class ra extends Er{}ra.prototype.ValueTypeName="string";ra.prototype.ValueBufferType=Array;ra.prototype.DefaultInterpolation=Hc;ra.prototype.InterpolantFactoryMethodLinear=void 0;ra.prototype.InterpolantFactoryMethodSmooth=void 0;class eh extends Er{}eh.prototype.ValueTypeName="vector";class th{constructor(e,t=-1,n,i=ff){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Gi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(kU(n[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(Er.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],h=[];l.push((a+r-1)%r,a,(a+1)%r),h.push(0,1,0);const u=Qw(l);l=j0(l,1,u),h=j0(h,1,u),!i&&l[0]===0&&(l.push(r),h.push(h[0])),o.push(new Qc(".morphTargetInfluences["+t[a].name+"]",l,h).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const h=e[a],u=h.name.match(r);if(u&&u.length>1){const f=u[1];let p=i[f];p||(i[f]=p=[]),p.push(h)}}const o=[];for(const a in i)o.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(f,p,m,g,v){if(m.length!==0){const y=[],x=[];Zg(m,y,x,g),y.length!==0&&v.push(new f(p,y,x))}},i=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const h=e.hierarchy||[];for(let f=0;f<h.length;f++){const p=h[f].keys;if(!(!p||p.length===0))if(p[0].morphTargets){const m={};let g;for(g=0;g<p.length;g++)if(p[g].morphTargets)for(let v=0;v<p[g].morphTargets.length;v++)m[p[g].morphTargets[v]]=-1;for(const v in m){const y=[],x=[];for(let w=0;w!==p[g].morphTargets.length;++w){const S=p[g];y.push(S.time),x.push(S.morphTarget===v?1:0)}i.push(new Qc(".morphTargetInfluence["+v+"]",y,x))}l=m.length*o}else{const m=".bones["+t[f].name+"]";n(eh,m+".position",p,"pos",i),n(Nl,m+".quaternion",p,"rot",i),n(eh,m+".scale",p,"scl",i)}}return i.length===0?null:new this(r,l,i,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function VU(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Qc;case"vector":case"vector2":case"vector3":case"vector4":return eh;case"color":return Jg;case"quaternion":return Nl;case"bool":case"boolean":return ia;case"string":return ra}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function kU(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=VU(s.type);if(s.times===void 0){const t=[],n=[];Zg(s.keys,t,n,"value"),s.times=t,s.values=n}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const Jo={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class Qg{constructor(e,t,n){const i=this;let r=!1,o=0,a=0,l;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,r===!1&&i.onStart!==void 0&&i.onStart(u,o,a),r=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,f){return h.push(u,f),this},this.removeHandler=function(u){const f=h.indexOf(u);return f!==-1&&h.splice(f,2),this},this.getHandler=function(u){for(let f=0,p=h.length;f<p;f+=2){const m=h[f],g=h[f+1];if(m.global&&(m.lastIndex=0),m.test(u))return g}return null}}}const iM=new Qg;let Xi=class{constructor(e){this.manager=e!==void 0?e:iM,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};const ls={};class GU extends Error{constructor(e,t){super(e),this.response=t}}let vs=class extends Xi{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Jo.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(ls[e]!==void 0){ls[e].push({onLoad:t,onProgress:n,onError:i});return}ls[e]=[],ls[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const u=ls[e],f=h.body.getReader(),p=h.headers.get("Content-Length")||h.headers.get("X-File-Size"),m=p?parseInt(p):0,g=m!==0;let v=0;const y=new ReadableStream({start(x){w();function w(){f.read().then(({done:S,value:E})=>{if(S)x.close();else{v+=E.byteLength;const A=new ProgressEvent("progress",{lengthComputable:g,loaded:v,total:m});for(let C=0,P=u.length;C<P;C++){const L=u[C];L.onProgress&&L.onProgress(A)}x.enqueue(E),w()}})}}});return new Response(y)}else throw new GU(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(l){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return h.json();default:if(a===void 0)return h.text();{const f=/charset="?([^;"\s]*)"?/i.exec(a),p=f&&f[1]?f[1].toLowerCase():void 0,m=new TextDecoder(p);return h.arrayBuffer().then(g=>m.decode(g))}}}).then(h=>{Jo.add(e,h);const u=ls[e];delete ls[e];for(let f=0,p=u.length;f<p;f++){const m=u[f];m.onLoad&&m.onLoad(h)}}).catch(h=>{const u=ls[e];if(u===void 0)throw this.manager.itemError(e),h;delete ls[e];for(let f=0,p=u.length;f<p;f++){const m=u[f];m.onError&&m.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};class HU extends Xi{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new vs(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=th.parse(e[n]);t.push(i)}return t}}class WU extends Xi{constructor(e){super(e)}load(e,t,n,i){const r=this,o=[],a=new kg,l=new vs(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let h=0;function u(f){l.load(e[f],function(p){const m=r.parse(p,!0);o[f]={width:m.width,height:m.height,format:m.format,mipmaps:m.mipmaps},h+=1,h===6&&(m.mipmapCount===1&&(a.minFilter=Sn),a.image=o,a.format=m.format,a.needsUpdate=!0,t&&t(a))},n,i)}if(Array.isArray(e))for(let f=0,p=e.length;f<p;++f)u(f);else l.load(e,function(f){const p=r.parse(f,!0);if(p.isCubemap){const m=p.mipmaps.length/p.mipmapCount;for(let g=0;g<m;g++){o[g]={mipmaps:[]};for(let v=0;v<p.mipmapCount;v++)o[g].mipmaps.push(p.mipmaps[g*p.mipmapCount+v]),o[g].format=p.format,o[g].width=p.width,o[g].height=p.height}a.image=o}else a.image.width=p.width,a.image.height=p.height,a.mipmaps=p.mipmaps;p.mipmapCount===1&&(a.minFilter=Sn),a.format=p.format,a.needsUpdate=!0,t&&t(a)},n,i);return a}}class nh extends Xi{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Jo.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=qc("img");function l(){u(),Jo.add(e,this),t&&t(this),r.manager.itemEnd(e)}function h(f){u(),i&&i(f),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",h,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class XU extends Xi{constructor(e){super(e)}load(e,t,n,i){const r=new uh;r.colorSpace=It;const o=new nh(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(h){o.load(e[h],function(u){r.images[h]=u,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let h=0;h<e.length;++h)l(h);return r}}class YU extends Xi{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new gl,a=new vs(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){const h=r.parse(l);h&&(h.image!==void 0?o.image=h.image:h.data!==void 0&&(o.image.width=h.width,o.image.height=h.height,o.image.data=h.data),o.wrapS=h.wrapS!==void 0?h.wrapS:ii,o.wrapT=h.wrapT!==void 0?h.wrapT:ii,o.magFilter=h.magFilter!==void 0?h.magFilter:Sn,o.minFilter=h.minFilter!==void 0?h.minFilter:Sn,o.anisotropy=h.anisotropy!==void 0?h.anisotropy:1,h.colorSpace!==void 0?o.colorSpace=h.colorSpace:h.encoding!==void 0&&(o.encoding=h.encoding),h.flipY!==void 0&&(o.flipY=h.flipY),h.format!==void 0&&(o.format=h.format),h.type!==void 0&&(o.type=h.type),h.mipmaps!==void 0&&(o.mipmaps=h.mipmaps,o.minFilter=oo),h.mipmapCount===1&&(o.minFilter=Sn),h.generateMipmaps!==void 0&&(o.generateMipmaps=h.generateMipmaps),o.needsUpdate=!0,t&&t(o,h))},n,i),o}}class jU extends Xi{constructor(e){super(e)}load(e,t,n,i){const r=new bn,o=new nh(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}}class fo extends Yt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ct(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class rM extends fo{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ct(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Pm=new Pt,Pv=new X,Iv=new X;class e_{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new He(512,512),this.map=null,this.mapPass=null,this.matrix=new Pt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new _f,this._frameExtents=new He(1,1),this._viewportCount=1,this._viewports=[new Qt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Pv.setFromMatrixPosition(e.matrixWorld),t.position.copy(Pv),Iv.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Iv),t.updateMatrixWorld(),Pm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Pm),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Pm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class qU extends e_{constructor(){super(new jn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=Sl*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class sM extends fo{constructor(e,t,n=0,i=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.target=new Yt,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new qU}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Lv=new Pt,yc=new X,Im=new X;class $U extends e_{constructor(){super(new jn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new He(4,2),this._viewportCount=6,this._viewports=[new Qt(2,1,1,1),new Qt(0,1,1,1),new Qt(3,1,1,1),new Qt(1,1,1,1),new Qt(3,0,1,1),new Qt(1,0,1,1)],this._cubeDirections=[new X(1,0,0),new X(-1,0,0),new X(0,0,1),new X(0,0,-1),new X(0,1,0),new X(0,-1,0)],this._cubeUps=[new X(0,1,0),new X(0,1,0),new X(0,1,0),new X(0,1,0),new X(0,0,1),new X(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),yc.setFromMatrixPosition(e.matrixWorld),n.position.copy(yc),Im.copy(n.position),Im.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Im),n.updateMatrixWorld(),i.makeTranslation(-yc.x,-yc.y,-yc.z),Lv.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Lv)}}class oM extends fo{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new $U}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class ZU extends e_{constructor(){super(new xf(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class aM extends fo{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.target=new Yt,this.shadow=new ZU}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class lM extends fo{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class cM extends fo{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class hM{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new X)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*i)),t.addScaledVector(o[5],1.092548*(i*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(n*r)),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*i),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*i),t.addScaledVector(o[5],2*.429043*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class Tf extends fo{constructor(e=new hM,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Cf extends Xi{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,o=new vs(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const i=Cf.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new ct().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(i.uniforms[r]={},o.type){case"t":i.uniforms[r].value=n(o.value);break;case"c":i.uniforms[r].value=new ct().setHex(o.value);break;case"v2":i.uniforms[r].value=new He().fromArray(o.value);break;case"v3":i.uniforms[r].value=new X().fromArray(o.value);break;case"v4":i.uniforms[r].value=new Qt().fromArray(o.value);break;case"m3":i.uniforms[r].value=new Ot().fromArray(o.value);break;case"m4":i.uniforms[r].value=new Pt().fromArray(o.value);break;default:i.uniforms[r].value=o.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new He().fromArray(r)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new He().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:Ww,SpriteMaterial:Bg,RawShaderMaterial:Xw,ShaderMaterial:kr,PointsMaterial:Vg,MeshPhysicalMaterial:Yw,MeshStandardMaterial:qg,MeshPhongMaterial:jw,MeshToonMaterial:qw,MeshNormalMaterial:$w,MeshLambertMaterial:Zw,MeshDepthMaterial:Dg,MeshDistanceMaterial:Ug,MeshBasicMaterial:ho,MeshMatcapMaterial:Kw,LineDashedMaterial:Jw,LineBasicMaterial:pi,Material:ri};return new t[e]}}class q0{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class uM extends Bt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class dM extends Xi{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new vs(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(m,g){if(t[g]!==void 0)return t[g];const y=m.interleavedBuffers[g],x=r(m,y.buffer),w=cl(y.type,x),S=new bf(w,y.stride);return S.uuid=y.uuid,t[g]=S,S}function r(m,g){if(n[g]!==void 0)return n[g];const y=m.arrayBuffers[g],x=new Uint32Array(y).buffer;return n[g]=x,x}const o=e.isInstancedBufferGeometry?new uM:new Bt,a=e.data.index;if(a!==void 0){const m=cl(a.type,a.array);o.setIndex(new tn(m,1))}const l=e.data.attributes;for(const m in l){const g=l[m];let v;if(g.isInterleavedBufferAttribute){const y=i(e.data,g.data);v=new Zo(y,g.itemSize,g.offset,g.normalized)}else{const y=cl(g.type,g.array),x=g.isInstancedBufferAttribute?wl:tn;v=new x(y,g.itemSize,g.normalized)}g.name!==void 0&&(v.name=g.name),g.usage!==void 0&&v.setUsage(g.usage),g.updateRange!==void 0&&(v.updateRange.offset=g.updateRange.offset,v.updateRange.count=g.updateRange.count),o.setAttribute(m,v)}const h=e.data.morphAttributes;if(h)for(const m in h){const g=h[m],v=[];for(let y=0,x=g.length;y<x;y++){const w=g[y];let S;if(w.isInterleavedBufferAttribute){const E=i(e.data,w.data);S=new Zo(E,w.itemSize,w.offset,w.normalized)}else{const E=cl(w.type,w.array);S=new tn(E,w.itemSize,w.normalized)}w.name!==void 0&&(S.name=w.name),v.push(S)}o.morphAttributes[m]=v}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const f=e.data.groups||e.data.drawcalls||e.data.offsets;if(f!==void 0)for(let m=0,g=f.length;m!==g;++m){const v=f[m];o.addGroup(v.start,v.count,v.materialIndex)}const p=e.data.boundingSphere;if(p!==void 0){const m=new X;p.center!==void 0&&m.fromArray(p.center),o.boundingSphere=new wr(m,p.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class KU extends Xi{constructor(e){super(e)}load(e,t,n,i){const r=this,o=this.path===""?q0.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new vs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let h=null;try{h=JSON.parse(l)}catch(f){i!==void 0&&i(f),console.error("THREE:ObjectLoader: Can't parse "+e+".",f.message);return}const u=h.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(h,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?q0.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const r=new vs(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,function(){t!==void 0&&t(h)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),h=this.parseObject(e.object,r,l,a,n),u=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,u),t!==void 0){let f=!1;for(const p in o)if(o[p].data instanceof HTMLImageElement){f=!0;break}f===!1&&t(h)}return h}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,i,a,o,t),h=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,h),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const r=new qo().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(r){r.isBone&&(i[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=new wf().fromJSON(e[r],i);n[a.uuid]=a}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new dM;for(let r=0,o=e.length;r<o;r++){let a;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(l);break;default:l.type in Rv?a=Rv[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const r=new Cf;r.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];n[l.uuid]===void 0&&(n[l.uuid]=r.parse(l)),i[l.uuid]=n[l.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],r=th.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function o(l){return n.manager.itemStart(l),r.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const h=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:n.resourcePath+h;return o(u)}else return l.data?{data:cl(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new Qg(t);r=new nh(l),r.setCrossOrigin(this.crossOrigin);for(let h=0,u=e.length;h<u;h++){const f=e[h],p=f.url;if(Array.isArray(p)){const m=[];for(let g=0,v=p.length;g<v;g++){const y=p[g],x=a(y);x!==null&&(x instanceof HTMLImageElement?m.push(x):m.push(new gl(x.data,x.width,x.height)))}i[f.uuid]=new Ho(m)}else{const m=a(f.url);i[f.uuid]=new Ho(m)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await i.loadAsync(l)}else return o.data?{data:cl(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){i=new nh(this.manager),i.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],h=l.url;if(Array.isArray(h)){const u=[];for(let f=0,p=h.length;f<p;f++){const m=h[f],g=await r(m);g!==null&&(g instanceof HTMLImageElement?u.push(g):u.push(new gl(g.data,g.width,g.height)))}n[l.uuid]=new Ho(u)}else{const u=await r(l.url);n[l.uuid]=new Ho(u)}}}return n}parseTextures(e,t){function n(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const i={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],h=l.data;let u;Array.isArray(h)?(u=new uh,h.length===6&&(u.needsUpdate=!0)):(h&&h.data?u=new gl:u=new bn,h&&(u.needsUpdate=!0)),u.source=l,u.uuid=a.uuid,a.name!==void 0&&(u.name=a.name),a.mapping!==void 0&&(u.mapping=n(a.mapping,JU)),a.channel!==void 0&&(u.channel=a.channel),a.offset!==void 0&&u.offset.fromArray(a.offset),a.repeat!==void 0&&u.repeat.fromArray(a.repeat),a.center!==void 0&&u.center.fromArray(a.center),a.rotation!==void 0&&(u.rotation=a.rotation),a.wrap!==void 0&&(u.wrapS=n(a.wrap[0],Nv),u.wrapT=n(a.wrap[1],Nv)),a.format!==void 0&&(u.format=a.format),a.internalFormat!==void 0&&(u.internalFormat=a.internalFormat),a.type!==void 0&&(u.type=a.type),a.colorSpace!==void 0&&(u.colorSpace=a.colorSpace),a.encoding!==void 0&&(u.encoding=a.encoding),a.minFilter!==void 0&&(u.minFilter=n(a.minFilter,Fv)),a.magFilter!==void 0&&(u.magFilter=n(a.magFilter,Fv)),a.anisotropy!==void 0&&(u.anisotropy=a.anisotropy),a.flipY!==void 0&&(u.flipY=a.flipY),a.generateMipmaps!==void 0&&(u.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(u.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(u.compareFunction=a.compareFunction),a.userData!==void 0&&(u.userData=a.userData),i[a.uuid]=u}return i}parseObject(e,t,n,i,r){let o;function a(p){return t[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",p),t[p]}function l(p){if(p!==void 0){if(Array.isArray(p)){const m=[];for(let g=0,v=p.length;g<v;g++){const y=p[g];n[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),m.push(n[y])}return m}return n[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",p),n[p]}}function h(p){return i[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",p),i[p]}let u,f;switch(e.type){case"Scene":o=new Aw,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new ct(e.background):o.background=h(e.background)),e.environment!==void 0&&(o.environment=h(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new Sf(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new vf(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new jn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new xf(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new lM(e.color,e.intensity);break;case"DirectionalLight":o=new aM(e.color,e.intensity);break;case"PointLight":o=new oM(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new cM(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new sM(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new rM(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new Tf().fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),f=l(e.material),o=new Pw(u,f),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),f=l(e.material),o=new qn(u,f);break;case"InstancedMesh":u=a(e.geometry),f=l(e.material);const p=e.count,m=e.instanceMatrix,g=e.instanceColor;o=new Iw(u,f,p),o.instanceMatrix=new wl(new Float32Array(m.array),16),g!==void 0&&(o.instanceColor=new wl(new Float32Array(g.array),g.itemSize));break;case"LOD":o=new Rw;break;case"Line":o=new ao(a(e.geometry),l(e.material));break;case"LineLoop":o=new Lw(a(e.geometry),l(e.material));break;case"LineSegments":o=new Hr(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new Nw(a(e.geometry),l(e.material));break;case"Sprite":o=new Cw(l(e.material));break;case"Group":o=new ul;break;case"Bone":o=new zg;break;default:o=new Yt}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const p=e.children;for(let m=0;m<p.length;m++)o.add(this.parseObject(p[m],t,n,i,r))}if(e.animations!==void 0){const p=e.animations;for(let m=0;m<p.length;m++){const g=p[m];o.animations.push(r[g])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const p=e.levels;for(let m=0;m<p.length;m++){const g=p[m],v=o.getObjectByProperty("uuid",g.object);v!==void 0&&o.addLevel(v,g.distance,g.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}}const JU={UVMapping:uf,CubeReflectionMapping:ro,CubeRefractionMapping:so,EquirectangularReflectionMapping:zc,EquirectangularRefractionMapping:Vc,CubeUVReflectionMapping:Al},Nv={RepeatWrapping:kc,ClampToEdgeWrapping:ii,MirroredRepeatWrapping:Gc},Fv={NearestFilter:vn,NearestMipmapNearestFilter:Zd,NearestMipmapLinearFilter:Nc,LinearFilter:Sn,LinearMipmapNearestFilter:vg,LinearMipmapLinearFilter:oo};class QU extends Xi{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Jo.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Jo.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){i&&i(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}let cd;class t_{static getContext(){return cd===void 0&&(cd=new(window.AudioContext||window.webkitAudioContext)),cd}static setContext(e){cd=e}}class e4 extends Xi{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new vs(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const h=l.slice(0);t_.getContext().decodeAudioData(h,function(f){t(f)},a)}catch(h){a(h)}},n,i);function a(l){i?i(l):console.error(l),r.manager.itemError(e)}}}class t4 extends Tf{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const i=new ct().set(e),r=new ct().set(t),o=new X(i.r,i.g,i.b),a=new X(r.r,r.g,r.b),l=Math.sqrt(Math.PI),h=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(h)}}class n4 extends Tf{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=new ct().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const Ov=new Pt,Dv=new Pt,Ro=new Pt;class i4{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new jn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new jn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Ro.copy(e.projectionMatrix);const i=t.eyeSep/2,r=i*t.near/t.focus,o=t.near*Math.tan(jo*t.fov*.5)/t.zoom;let a,l;Dv.elements[12]=-i,Ov.elements[12]=i,a=-o*t.aspect+r,l=o*t.aspect+r,Ro.elements[0]=2*t.near/(l-a),Ro.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Ro),a=-o*t.aspect-r,l=o*t.aspect-r,Ro.elements[0]=2*t.near/(l-a),Ro.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Ro)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Dv),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Ov)}}class fM{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Uv(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Uv();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Uv(){return(typeof performance>"u"?Date:performance).now()}const Po=new X,Bv=new Ei,r4=new X,Io=new X;class s4 extends Yt{constructor(){super(),this.type="AudioListener",this.context=t_.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new fM}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Po,Bv,r4),Io.set(0,0,-1).applyQuaternion(Bv),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Po.x,i),t.positionY.linearRampToValueAtTime(Po.y,i),t.positionZ.linearRampToValueAtTime(Po.z,i),t.forwardX.linearRampToValueAtTime(Io.x,i),t.forwardY.linearRampToValueAtTime(Io.y,i),t.forwardZ.linearRampToValueAtTime(Io.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(Po.x,Po.y,Po.z),t.setOrientation(Io.x,Io.y,Io.z,n.x,n.y,n.z)}}class pM extends Yt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Lo=new X,zv=new Ei,o4=new X,No=new X;class a4 extends pM{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Lo,zv,o4),No.set(0,0,1).applyQuaternion(zv);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Lo.x,n),t.positionY.linearRampToValueAtTime(Lo.y,n),t.positionZ.linearRampToValueAtTime(Lo.z,n),t.orientationX.linearRampToValueAtTime(No.x,n),t.orientationY.linearRampToValueAtTime(No.y,n),t.orientationZ.linearRampToValueAtTime(No.z,n)}else t.setPosition(Lo.x,Lo.y,Lo.z),t.setOrientation(No.x,No.y,No.z)}}class l4{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class mM{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,o;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==i;++a)n[r+a]=n[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(n,r,0,a,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(n,i,l,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let l=t,h=t+t;l!==h;++l)if(n[l]!==n[l+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){Ei.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;Ei.multiplyQuaternionsFlat(e,o,e,t,e,n),Ei.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let a=0;a!==r;++a){const l=t+a;e[l]=e[l]*o+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const a=t+o;e[a]=e[a]+e[n+o]*i}}}const n_="\\[\\]\\.:\\/",c4=new RegExp("["+n_+"]","g"),i_="[^"+n_+"]",h4="[^"+n_.replace("\\.","")+"]",u4=/((?:WC+[\/:])*)/.source.replace("WC",i_),d4=/(WCOD+)?/.source.replace("WCOD",h4),f4=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",i_),p4=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",i_),m4=new RegExp("^"+u4+d4+f4+p4+"$"),g4=["material","materials","bones","map"];class _4{constructor(e,t,n){const i=n||Wt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Wt{constructor(e,t,n){this.path=t,this.parsedPath=n||Wt.parseTrackName(t),this.node=Wt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Wt.Composite(e,t,n):new Wt(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(c4,"")}static parseTrackName(e){const t=m4.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const r=n.nodeName.substring(i+1);g4.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Wt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let h=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===h){h=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const o=e[i];if(o===void 0){const h=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Wt.Composite=_4;Wt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Wt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Wt.prototype.GetterByBindingType=[Wt.prototype._getValue_direct,Wt.prototype._getValue_array,Wt.prototype._getValue_arrayElement,Wt.prototype._getValue_toArray];Wt.prototype.SetterByBindingTypeAndVersioning=[[Wt.prototype._setValue_direct,Wt.prototype._setValue_direct_setNeedsUpdate,Wt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Wt.prototype._setValue_array,Wt.prototype._setValue_array_setNeedsUpdate,Wt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Wt.prototype._setValue_arrayElement,Wt.prototype._setValue_arrayElement_setNeedsUpdate,Wt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Wt.prototype._setValue_fromArray,Wt.prototype._setValue_fromArray_setNeedsUpdate,Wt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class x4{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Gi(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let a,l=e.length,h=this.nCachedObjects_;for(let u=0,f=arguments.length;u!==f;++u){const p=arguments[u],m=p.uuid;let g=t[m];if(g===void 0){g=l++,t[m]=g,e.push(p);for(let v=0,y=o;v!==y;++v)r[v].push(new Wt(p,n[v],i[v]))}else if(g<h){a=e[g];const v=--h,y=e[v];t[y.uuid]=g,e[g]=y,t[m]=v,e[v]=p;for(let x=0,w=o;x!==w;++x){const S=r[x],E=S[v];let A=S[g];S[g]=E,A===void 0&&(A=new Wt(p,n[x],i[x])),S[v]=A}}else e[g]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],h=l.uuid,u=t[h];if(u!==void 0&&u>=r){const f=r++,p=e[f];t[p.uuid]=u,e[u]=p,t[h]=f,e[f]=l;for(let m=0,g=i;m!==g;++m){const v=n[m],y=v[f],x=v[u];v[u]=y,v[f]=x}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const h=arguments[a],u=h.uuid,f=t[u];if(f!==void 0)if(delete t[u],f<r){const p=--r,m=e[p],g=--o,v=e[g];t[m.uuid]=f,e[f]=m,t[v.uuid]=p,e[p]=v,e.pop();for(let y=0,x=i;y!==x;++y){const w=n[y],S=w[p],E=w[g];w[f]=S,w[p]=E,w.pop()}}else{const p=--o,m=e[p];p>0&&(t[m.uuid]=f),e[f]=m,e.pop();for(let g=0,v=i;g!==v;++g){const y=n[g];y[f]=y[p],y.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(i!==void 0)return r[i];const o=this._paths,a=this._parsedPaths,l=this._objects,h=l.length,u=this.nCachedObjects_,f=new Array(h);i=r.length,n[e]=i,o.push(e),a.push(t),r.push(f);for(let p=u,m=l.length;p!==m;++p){const g=l[p];f[p]=new Wt(g,e,t)}return f}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],h=e[a];t[h]=n,o[n]=l,o.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}}class gM{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,a=new Array(o),l={endingStart:ko,endingEnd:ko};for(let h=0;h!==o;++h){const u=r[h].createInterpolant(null);a[h]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=$b,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const i=this._clip.duration,r=e._clip.duration,o=r/i,a=i/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,h=a.sampleValues;return l[0]=r,l[1]=r+n,h[0]=e/o,h[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*n;l<0||n===0?t=0:(this._startTime=null,t=n*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case Tg:for(let u=0,f=l.length;u!==f;++u)l[u].evaluate(o),h[u].accumulateAdditive(a);break;case ff:default:for(let u=0,f=l.length;u!==f;++u)l[u].evaluate(o),h[u].accumulate(i,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=n===Zb;if(e===0)return r===-1?i:o&&(r&1)===1?t-i:i;if(n===qb){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),i>=t||i<0){const a=Math.floor(i/t);i-=t*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const h=e<0;this._setEndings(h,!h,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(o&&(r&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Go,i.endingEnd=Go):(e?i.endingStart=this.zeroSlopeAtStart?Go:ko:i.endingStart=Xc,t?i.endingEnd=this.zeroSlopeAtEnd?Go:ko:i.endingEnd=Xc)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=n,this}}const y4=new Float32Array(1);class v4 extends Ms{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,a=e._interpolants,l=n.uuid,h=this._bindingsByRootAndName;let u=h[l];u===void 0&&(u={},h[l]=u);for(let f=0;f!==r;++f){const p=i[f],m=p.name;let g=u[m];if(g!==void 0)++g.referenceCount,o[f]=g;else{if(g=o[f],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,l,m));continue}const v=t&&t._propertyBindings[f].binding.parsedPath;g=new mM(Wt.create(n,m,v),p.ValueTypeName,p.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,l,m),o[f]=g}a[f].resultBuffer=g.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],l=a.knownActions,h=l[l.length-1],u=e._byClipCacheIndex;h._byClipCacheIndex=u,l[u]=h,l.pop(),e._byClipCacheIndex=null;const f=a.actionByRoot,p=(e._localRoot||this._root).uuid;delete f[p],l.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];o===void 0&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,a=o[i],l=t[t.length-1],h=e._cacheIndex;l._cacheIndex=h,t[h]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new Kg(new Float32Array(2),new Float32Array(2),1,y4),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o=typeof e=="string"?th.findByName(i,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let h=null;if(n===void 0&&(o!==null?n=o.blendMode:n=ff),l!==void 0){const f=l.actionByRoot[r];if(f!==void 0&&f.blendMode===n)return f;h=l.knownActions[0],o===null&&(o=h._clip)}if(o===null)return null;const u=new gM(this,o,t,n);return this._bindAction(u,h),this._addInactiveAction(u,a,r),u}existingAction(e,t){const n=t||this._root,i=n.uuid,r=typeof e=="string"?th.findByName(n,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let h=0;h!==n;++h)t[h]._update(i,e,r,o);const a=this._bindings,l=this._nActiveBindings;for(let h=0;h!==l;++h)a[h].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){const o=r.knownActions;for(let a=0,l=o.length;a!==l;++a){const h=o[a];this._deactivateAction(h);const u=h._cacheIndex,f=t[t.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,f._cacheIndex=u,t[u]=f,t.pop(),this._removeInactiveBindingsForAction(h)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class r_{constructor(e){this.value=e}clone(){return new r_(this.value.clone===void 0?this.value:this.value.clone())}}let S4=0;class b4 extends Ms{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:S4++}),this.name="",this.usage=Yc,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++)this.uniforms.push(t[n].clone());return this}clone(){return new this.constructor().copy(this)}}class w4 extends bf{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class M4{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class E4{constructor(e,t,n=0,i=1/0){this.ray=new Tl(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new mf,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return $0(e,this,n,t),n.sort(Vv),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)$0(e[i],this,n,t);return n.sort(Vv),n}}function Vv(s,e){return s.distance-e.distance}function $0(s,e,t,n){if(s.layers.test(e.layers)&&s.raycast(e,t),n===!0){const i=s.children;for(let r=0,o=i.length;r<o;r++)$0(i[r],e,t,!0)}}class A4{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(mn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class T4{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const kv=new He;class C4{constructor(e=new He(1/0,1/0),t=new He(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=kv.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,kv).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Gv=new X,hd=new X;class R4{constructor(e=new X,t=new X){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Gv.subVectors(e,this.start),hd.subVectors(this.end,this.start);const n=hd.dot(hd);let r=hd.dot(Gv)/n;return t&&(r=mn(r,0,1)),r}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Hv=new X;class P4 extends Yt{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Bt,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const h=o/l*Math.PI*2,u=a/l*Math.PI*2;i.push(Math.cos(h),Math.sin(h),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new dt(i,3));const r=new pi({fog:!1,toneMapped:!1});this.cone=new Hr(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Hv.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Hv),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ks=new X,ud=new Pt,Lm=new Pt;class I4 extends Hr{constructor(e){const t=_M(e),n=new Bt,i=[],r=[],o=new ct(0,0,1),a=new ct(0,1,0);for(let h=0;h<t.length;h++){const u=t[h];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new dt(i,3)),n.setAttribute("color",new dt(r,3));const l=new pi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Lm.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(ud.multiplyMatrices(Lm,a.matrixWorld),ks.setFromMatrixPosition(ud),i.setXYZ(o,ks.x,ks.y,ks.z),ud.multiplyMatrices(Lm,a.parent.matrixWorld),ks.setFromMatrixPosition(ud),i.setXYZ(o+1,ks.x,ks.y,ks.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function _M(s){const e=[];s.isBone===!0&&e.push(s);for(let t=0;t<s.children.length;t++)e.push.apply(e,_M(s.children[t]));return e}class L4 extends qn{constructor(e,t,n){const i=new Ll(t,4,2),r=new ho({wireframe:!0,fog:!1,toneMapped:!1});super(i,r),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const N4=new X,Wv=new ct,Xv=new ct;class F4 extends Yt{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new Il(t);i.rotateY(Math.PI*.5),this.material=new ho({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(r.count*3);i.setAttribute("color",new tn(o,3)),this.add(new qn(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Wv.copy(this.light.color),Xv.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const r=n<i/2?Wv:Xv;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(N4.setFromMatrixPosition(this.light.matrixWorld).negate())}}class O4 extends Hr{constructor(e=10,t=10,n=4473924,i=8947848){n=new ct(n),i=new ct(i);const r=t/2,o=e/t,a=e/2,l=[],h=[];for(let p=0,m=0,g=-a;p<=t;p++,g+=o){l.push(-a,0,g,a,0,g),l.push(g,0,-a,g,0,a);const v=p===r?n:i;v.toArray(h,m),m+=3,v.toArray(h,m),m+=3,v.toArray(h,m),m+=3,v.toArray(h,m),m+=3}const u=new Bt;u.setAttribute("position",new dt(l,3)),u.setAttribute("color",new dt(h,3));const f=new pi({vertexColors:!0,toneMapped:!1});super(u,f),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class D4 extends Hr{constructor(e=10,t=16,n=8,i=64,r=4473924,o=8947848){r=new ct(r),o=new ct(o);const a=[],l=[];if(t>1)for(let f=0;f<t;f++){const p=f/t*(Math.PI*2),m=Math.sin(p)*e,g=Math.cos(p)*e;a.push(0,0,0),a.push(m,0,g);const v=f&1?r:o;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let f=0;f<n;f++){const p=f&1?r:o,m=e-e/n*f;for(let g=0;g<i;g++){let v=g/i*(Math.PI*2),y=Math.sin(v)*m,x=Math.cos(v)*m;a.push(y,0,x),l.push(p.r,p.g,p.b),v=(g+1)/i*(Math.PI*2),y=Math.sin(v)*m,x=Math.cos(v)*m,a.push(y,0,x),l.push(p.r,p.g,p.b)}}const h=new Bt;h.setAttribute("position",new dt(a,3)),h.setAttribute("color",new dt(l,3));const u=new pi({vertexColors:!0,toneMapped:!1});super(h,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Yv=new X,dd=new X,jv=new X;class U4 extends Yt{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new Bt;i.setAttribute("position",new dt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new pi({fog:!1,toneMapped:!1});this.lightPlane=new ao(i,r),this.add(this.lightPlane),i=new Bt,i.setAttribute("position",new dt([0,0,0,0,0,1],3)),this.targetLine=new ao(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Yv.setFromMatrixPosition(this.light.matrixWorld),dd.setFromMatrixPosition(this.light.target.matrixWorld),jv.subVectors(dd,Yv),this.lightPlane.lookAt(dd),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(dd),this.targetLine.scale.z=jv.length()}}const fd=new X,pn=new gf;class B4 extends Hr{constructor(e){const t=new Bt,n=new pi({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(g,v){l(g),l(v)}function l(g){i.push(0,0,0),r.push(0,0,0),o[g]===void 0&&(o[g]=[]),o[g].push(i.length/3-1)}t.setAttribute("position",new dt(i,3)),t.setAttribute("color",new dt(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const h=new ct(16755200),u=new ct(16711680),f=new ct(43775),p=new ct(16777215),m=new ct(3355443);this.setColors(h,u,f,p,m)}setColors(e,t,n,i,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;pn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),yn("c",t,e,pn,0,0,-1),yn("t",t,e,pn,0,0,1),yn("n1",t,e,pn,-n,-i,-1),yn("n2",t,e,pn,n,-i,-1),yn("n3",t,e,pn,-n,i,-1),yn("n4",t,e,pn,n,i,-1),yn("f1",t,e,pn,-n,-i,1),yn("f2",t,e,pn,n,-i,1),yn("f3",t,e,pn,-n,i,1),yn("f4",t,e,pn,n,i,1),yn("u1",t,e,pn,n*.7,i*1.1,-1),yn("u2",t,e,pn,-n*.7,i*1.1,-1),yn("u3",t,e,pn,0,i*2,-1),yn("cf1",t,e,pn,-n,0,1),yn("cf2",t,e,pn,n,0,1),yn("cf3",t,e,pn,0,-i,1),yn("cf4",t,e,pn,0,i,1),yn("cn1",t,e,pn,-n,0,-1),yn("cn2",t,e,pn,n,0,-1),yn("cn3",t,e,pn,0,-i,-1),yn("cn4",t,e,pn,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function yn(s,e,t,n,i,r,o){fd.set(i,r,o).unproject(n);const a=e[s];if(a!==void 0){const l=t.getAttribute("position");for(let h=0,u=a.length;h<u;h++)l.setXYZ(a[h],fd.x,fd.y,fd.z)}}const pd=new Gr;class z4 extends Hr{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),r=new Bt;r.setIndex(new tn(n,1)),r.setAttribute("position",new tn(i,3)),super(r,new pi({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&pd.setFromObject(this.object),pd.isEmpty())return;const t=pd.min,n=pd.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class V4 extends Hr{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new Bt;r.setIndex(new tn(n,1)),r.setAttribute("position",new dt(i,3)),super(r,new pi({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class k4 extends ao{constructor(e,t=1,n=16776960){const i=n,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Bt;o.setAttribute("position",new dt(r,3)),o.computeBoundingSphere(),super(o,new pi({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Bt;l.setAttribute("position",new dt(a,3)),l.computeBoundingSphere(),this.add(new qn(l,new ho({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const qv=new X;let md,Nm;class G4 extends Yt{constructor(e=new X(0,0,1),t=new X(0,0,0),n=1,i=16776960,r=n*.2,o=r*.2){super(),this.type="ArrowHelper",md===void 0&&(md=new Bt,md.setAttribute("position",new dt([0,0,0,0,1,0],3)),Nm=new na(0,.5,1,5,1),Nm.translate(0,-.5,0)),this.position.copy(t),this.line=new ao(md,new pi({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new qn(Nm,new ho({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{qv.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(qv,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class H4 extends Hr{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Bt;i.setAttribute("position",new dt(t,3)),i.setAttribute("color",new dt(n,3));const r=new pi({vertexColors:!0,toneMapped:!1});super(i,r),this.type="AxesHelper"}setColors(e,t,n){const i=new ct,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class W4{constructor(){this.type="ShapePath",this.color=new ct,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new $c,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(x){const w=[];for(let S=0,E=x.length;S<E;S++){const A=x[S],C=new qo;C.curves=A.curves,w.push(C)}return w}function n(x,w){const S=w.length;let E=!1;for(let A=S-1,C=0;C<S;A=C++){let P=w[A],L=w[C],T=L.x-P.x,R=L.y-P.y;if(Math.abs(R)>Number.EPSILON){if(R<0&&(P=w[C],T=-T,L=w[A],R=-R),x.y<P.y||x.y>L.y)continue;if(x.y===P.y){if(x.x===P.x)return!0}else{const G=R*(x.x-P.x)-T*(x.y-P.y);if(G===0)return!0;if(G<0)continue;E=!E}}else{if(x.y!==P.y)continue;if(L.x<=x.x&&x.x<=P.x||P.x<=x.x&&x.x<=L.x)return!0}}return E}const i=zr.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,l;const h=[];if(r.length===1)return a=r[0],l=new qo,l.curves=a.curves,h.push(l),h;let u=!i(r[0].getPoints());u=e?!u:u;const f=[],p=[];let m=[],g=0,v;p[g]=void 0,m[g]=[];for(let x=0,w=r.length;x<w;x++)a=r[x],v=a.getPoints(),o=i(v),o=e?!o:o,o?(!u&&p[g]&&g++,p[g]={s:new qo,p:v},p[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:v[0]});if(!p[0])return t(r);if(p.length>1){let x=!1,w=0;for(let S=0,E=p.length;S<E;S++)f[S]=[];for(let S=0,E=p.length;S<E;S++){const A=m[S];for(let C=0;C<A.length;C++){const P=A[C];let L=!0;for(let T=0;T<p.length;T++)n(P.p,p[T].p)&&(S!==T&&w++,L?(L=!1,f[T].push(P)):x=!0);L&&f[S].push(P)}}w>0&&x===!1&&(m=f)}let y;for(let x=0,w=p.length;x<w;x++){l=p[x].s,h.push(l),y=m[x];for(let S=0,E=y.length;S<E;S++)l.holes.push(y[S].h)}return h}}class X4 extends uo{constructor(e,t,n,i,r,o){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,i,r,o)}}class Y4 extends dh{constructor(e,t,n,i){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,i)}}class j4 extends fh{constructor(e,t,n,i){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,i)}}class q4 extends ph{constructor(e,t,n,i,r,o,a){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,i,r,o,a)}}let $4=class extends na{constructor(e,t,n,i,r,o,a,l){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,i,r,o,a,l)}};class Z4 extends mh{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class K4 extends gh{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class J4 extends _h{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class Q4 extends Pl{constructor(e,t,n,i){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,i)}}class eB extends Il{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class tB extends Cl{constructor(e,t,n,i){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,i)}}class nB extends Es{constructor(e,t,n,i){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,i)}}class iB extends xh{constructor(e,t,n,i,r,o){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,i,r,o)}}class rB extends yh{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class sB extends Ll{constructor(e,t,n,i,r,o,a){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,i,r,o,a)}}class oB extends vh{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class aB extends Sh{constructor(e,t,n,i,r){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,i,r)}}class lB extends bh{constructor(e,t,n,i,r,o){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,i,r,o)}}class cB extends wh{constructor(e,t,n,i,r){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,i,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:hf}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=hf);const hB=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Ub,AddEquation:zo,AddOperation:Nb,AdditiveAnimationBlendMode:Tg,AdditiveBlending:d0,AlphaFormat:kb,AlwaysCompare:lw,AlwaysDepth:Ab,AlwaysStencilFunc:ew,AmbientLight:lM,AmbientLightProbe:n4,AnimationAction:gM,AnimationClip:th,AnimationLoader:HU,AnimationMixer:v4,AnimationObjectGroup:x4,AnimationUtils:zU,ArcCurve:Fw,ArrayCamera:bw,ArrowHelper:G4,Audio:pM,AudioAnalyser:l4,AudioContext:t_,AudioListener:s4,AudioLoader:e4,AxesHelper:H4,BackSide:di,BasicDepthPacking:Kb,BasicShadowMap:sI,Bone:zg,BooleanKeyframeTrack:ia,Box2:C4,Box3:Gr,Box3Helper:V4,BoxBufferGeometry:X4,BoxGeometry:uo,BoxHelper:z4,BufferAttribute:tn,BufferGeometry:Bt,BufferGeometryLoader:dM,ByteType:zb,Cache:Jo,Camera:gf,CameraHelper:B4,CanvasTexture:cU,CapsuleBufferGeometry:Y4,CapsuleGeometry:dh,CatmullRomCurve3:Ow,CineonToneMapping:Db,CircleBufferGeometry:j4,CircleGeometry:fh,ClampToEdgeWrapping:ii,Clock:fM,Color:ct,ColorKeyframeTrack:Jg,ColorManagement:ir,CompressedArrayTexture:lU,CompressedTexture:kg,CompressedTextureLoader:WU,ConeBufferGeometry:q4,ConeGeometry:ph,CubeCamera:pw,CubeReflectionMapping:ro,CubeRefractionMapping:so,CubeTexture:uh,CubeTextureLoader:XU,CubeUVReflectionMapping:Al,CubicBezierCurve:Hg,CubicBezierCurve3:Dw,CubicInterpolant:eM,CullFaceBack:u0,CullFaceFront:ub,CullFaceFrontBack:rI,CullFaceNone:hb,Curve:Mr,CurvePath:Bw,CustomBlending:fb,CustomToneMapping:Bb,CylinderBufferGeometry:$4,CylinderGeometry:na,Cylindrical:T4,Data3DTexture:Lg,DataArrayTexture:pf,DataTexture:gl,DataTextureLoader:YU,DataUtils:xL,DecrementStencilOp:_I,DecrementWrapStencilOp:yI,DefaultLoadingManager:iM,DepthFormat:eo,DepthStencilFormat:$o,DepthTexture:ww,DirectionalLight:aM,DirectionalLightHelper:U4,DiscreteInterpolant:tM,DisplayP3ColorSpace:Rg,DodecahedronBufferGeometry:Z4,DodecahedronGeometry:mh,DoubleSide:Or,DstAlphaFactor:vb,DstColorFactor:bb,DynamicCopyUsage:FI,DynamicDrawUsage:CI,DynamicReadUsage:II,EdgesGeometry:zw,EllipseCurve:Mf,EqualCompare:iw,EqualDepth:Cb,EqualStencilFunc:wI,EquirectangularReflectionMapping:zc,EquirectangularRefractionMapping:Vc,Euler:hh,EventDispatcher:Ms,ExtrudeBufferGeometry:K4,ExtrudeGeometry:gh,FileLoader:vs,Float16BufferAttribute:ML,Float32BufferAttribute:dt,Float64BufferAttribute:EL,FloatType:Dr,Fog:Sf,FogExp2:vf,FramebufferTexture:aU,FrontSide:ys,Frustum:_f,GLBufferAttribute:M4,GLSL1:DI,GLSL3:V0,GreaterCompare:sw,GreaterDepth:Pb,GreaterEqualCompare:aw,GreaterEqualDepth:Rb,GreaterEqualStencilFunc:TI,GreaterStencilFunc:EI,GridHelper:O4,Group:ul,HalfFloatType:vl,HemisphereLight:rM,HemisphereLightHelper:F4,HemisphereLightProbe:t4,IcosahedronBufferGeometry:J4,IcosahedronGeometry:_h,ImageBitmapLoader:QU,ImageLoader:nh,ImageUtils:Ig,IncrementStencilOp:gI,IncrementWrapStencilOp:xI,InstancedBufferAttribute:wl,InstancedBufferGeometry:uM,InstancedInterleavedBuffer:w4,InstancedMesh:Iw,Int16BufferAttribute:bL,Int32BufferAttribute:wL,Int8BufferAttribute:yL,IntType:Sg,InterleavedBuffer:bf,InterleavedBufferAttribute:Zo,Interpolant:Mh,InterpolateDiscrete:Hc,InterpolateLinear:Wc,InterpolateSmooth:Gd,InvertStencilOp:vI,KeepStencilOp:Hd,KeyframeTrack:Er,LOD:Rw,LatheBufferGeometry:Q4,LatheGeometry:Pl,Layers:mf,LessCompare:nw,LessDepth:Tb,LessEqualCompare:rw,LessEqualDepth:$d,LessEqualStencilFunc:MI,LessStencilFunc:bI,Light:fo,LightProbe:Tf,Line:ao,Line3:R4,LineBasicMaterial:pi,LineCurve:Ef,LineCurve3:Uw,LineDashedMaterial:Jw,LineLoop:Lw,LineSegments:Hr,LinearEncoding:Cg,LinearFilter:Sn,LinearInterpolant:Kg,LinearMipMapLinearFilter:hI,LinearMipMapNearestFilter:cI,LinearMipmapLinearFilter:oo,LinearMipmapNearestFilter:vg,LinearSRGBColorSpace:yr,LinearToneMapping:Fb,Loader:Xi,LoaderUtils:q0,LoadingManager:Qg,LoopOnce:qb,LoopPingPong:Zb,LoopRepeat:$b,LuminanceAlphaFormat:Hb,LuminanceFormat:Gb,MOUSE:nI,Material:ri,MaterialLoader:Cf,MathUtils:ZI,Matrix3:Ot,Matrix4:Pt,MaxEquation:g0,Mesh:qn,MeshBasicMaterial:ho,MeshDepthMaterial:Dg,MeshDistanceMaterial:Ug,MeshLambertMaterial:Zw,MeshMatcapMaterial:Kw,MeshNormalMaterial:$w,MeshPhongMaterial:jw,MeshPhysicalMaterial:Yw,MeshStandardMaterial:qg,MeshToonMaterial:qw,MinEquation:m0,MirroredRepeatWrapping:Gc,MixOperation:Lb,MultiplyBlending:p0,MultiplyOperation:ch,NearestFilter:vn,NearestMipMapLinearFilter:lI,NearestMipMapNearestFilter:aI,NearestMipmapLinearFilter:Nc,NearestMipmapNearestFilter:Zd,NeverCompare:tw,NeverDepth:Eb,NeverStencilFunc:SI,NoBlending:_s,NoColorSpace:no,NoToneMapping:Br,NormalAnimationBlendMode:ff,NormalBlending:Yo,NotEqualCompare:ow,NotEqualDepth:Ib,NotEqualStencilFunc:AI,NumberKeyframeTrack:Qc,Object3D:Yt,ObjectLoader:KU,ObjectSpaceNormalMap:Qb,OctahedronBufferGeometry:eB,OctahedronGeometry:Il,OneFactor:_b,OneMinusDstAlphaFactor:Sb,OneMinusDstColorFactor:wb,OneMinusSrcAlphaFactor:yg,OneMinusSrcColorFactor:yb,OrthographicCamera:xf,PCFShadowMap:_g,PCFSoftShadowMap:db,PMREMGenerator:G0,Path:$c,PerspectiveCamera:jn,Plane:$s,PlaneBufferGeometry:tB,PlaneGeometry:Cl,PlaneHelper:k4,PointLight:oM,PointLightHelper:L4,Points:Nw,PointsMaterial:Vg,PolarGridHelper:D4,PolyhedronBufferGeometry:nB,PolyhedronGeometry:Es,PositionalAudio:a4,PropertyBinding:Wt,PropertyMixer:mM,QuadraticBezierCurve:Wg,QuadraticBezierCurve3:Xg,Quaternion:Ei,QuaternionKeyframeTrack:Nl,QuaternionLinearInterpolant:nM,RED_GREEN_RGTC2_Format:B0,RED_RGTC1_Format:jb,REVISION:hf,RGBADepthPacking:Jb,RGBAFormat:Vi,RGBAIntegerFormat:Ag,RGBA_ASTC_10x10_Format:F0,RGBA_ASTC_10x5_Format:I0,RGBA_ASTC_10x6_Format:L0,RGBA_ASTC_10x8_Format:N0,RGBA_ASTC_12x10_Format:O0,RGBA_ASTC_12x12_Format:D0,RGBA_ASTC_4x4_Format:w0,RGBA_ASTC_5x4_Format:M0,RGBA_ASTC_5x5_Format:E0,RGBA_ASTC_6x5_Format:A0,RGBA_ASTC_6x6_Format:T0,RGBA_ASTC_8x5_Format:C0,RGBA_ASTC_8x6_Format:R0,RGBA_ASTC_8x8_Format:P0,RGBA_BPTC_Format:kd,RGBA_ETC2_EAC_Format:b0,RGBA_PVRTC_2BPPV1_Format:v0,RGBA_PVRTC_4BPPV1_Format:y0,RGBA_S3TC_DXT1_Format:Bd,RGBA_S3TC_DXT3_Format:zd,RGBA_S3TC_DXT5_Format:Vd,RGB_ETC1_Format:Yb,RGB_ETC2_Format:S0,RGB_PVRTC_2BPPV1_Format:x0,RGB_PVRTC_4BPPV1_Format:_0,RGB_S3TC_DXT1_Format:Ud,RGFormat:Xb,RGIntegerFormat:Eg,RawShaderMaterial:Xw,Ray:Tl,Raycaster:E4,RectAreaLight:cM,RedFormat:Wb,RedIntegerFormat:Mg,ReinhardToneMapping:Ob,RepeatWrapping:kc,ReplaceStencilOp:mI,ReverseSubtractEquation:mb,RingBufferGeometry:iB,RingGeometry:xh,SIGNED_RED_GREEN_RGTC2_Format:z0,SIGNED_RED_RGTC1_Format:U0,SRGBColorSpace:It,Scene:Aw,ShaderChunk:Ft,ShaderLib:xr,ShaderMaterial:kr,ShadowMaterial:Ww,Shape:qo,ShapeBufferGeometry:rB,ShapeGeometry:yh,ShapePath:W4,ShapeUtils:zr,ShortType:Vb,Skeleton:wf,SkeletonHelper:I4,SkinnedMesh:Pw,Source:Ho,Sphere:wr,SphereBufferGeometry:sB,SphereGeometry:Ll,Spherical:A4,SphericalHarmonics3:hM,SplineCurve:Yg,SpotLight:sM,SpotLightHelper:P4,Sprite:Cw,SpriteMaterial:Bg,SrcAlphaFactor:xg,SrcAlphaSaturateFactor:Mb,SrcColorFactor:xb,StaticCopyUsage:NI,StaticDrawUsage:Yc,StaticReadUsage:PI,StereoCamera:i4,StreamCopyUsage:OI,StreamDrawUsage:RI,StreamReadUsage:LI,StringKeyframeTrack:ra,SubtractEquation:pb,SubtractiveBlending:f0,TOUCH:iI,TangentSpaceNormalMap:co,TetrahedronBufferGeometry:oB,TetrahedronGeometry:vh,Texture:bn,TextureLoader:jU,TorusBufferGeometry:aB,TorusGeometry:Sh,TorusKnotBufferGeometry:lB,TorusKnotGeometry:bh,Triangle:Wo,TriangleFanDrawMode:fI,TriangleStripDrawMode:dI,TrianglesDrawMode:uI,TubeBufferGeometry:cB,TubeGeometry:wh,TwoPassDoubleSide:oI,UVMapping:uf,Uint16BufferAttribute:Ng,Uint32BufferAttribute:Fg,Uint8BufferAttribute:vL,Uint8ClampedBufferAttribute:SL,Uniform:r_,UniformsGroup:b4,UniformsLib:tt,UniformsUtils:fw,UnsignedByteType:xs,UnsignedInt248Type:Qs,UnsignedIntType:ms,UnsignedShort4444Type:bg,UnsignedShort5551Type:wg,UnsignedShortType:df,VSMShadowMap:Fr,Vector2:He,Vector3:X,Vector4:Qt,VectorKeyframeTrack:eh,VideoTexture:oU,WebGL1Renderer:Ew,WebGL3DRenderTarget:aL,WebGLArrayRenderTarget:oL,WebGLCoordinateSystem:Ur,WebGLCubeRenderTarget:mw,WebGLMultipleRenderTargets:lL,WebGLRenderTarget:vr,WebGLRenderer:Mw,WebGLUtils:Sw,WebGPUCoordinateSystem:jc,WireframeGeometry:Hw,WrapAroundEnding:Xc,ZeroCurvatureEnding:ko,ZeroFactor:gb,ZeroSlopeEnding:Go,ZeroStencilOp:pI,_SRGBAFormat:Kd,sRGBEncoding:to},Symbol.toStringTag,{value:"Module"}));/*! Miew - 3D Molecular Viewer v0.11.0 Copyright (c) 2015-2024 EPAM Systems, Inc. */var uB={89:s=>{var e=function(){var t=function(me,xe,Pe,Qe){for(Pe=Pe||{},Qe=me.length;Qe--;Pe[me[Qe]]=xe);return Pe},n=[1,60],i=[1,62],r=[1,63],o=[1,65],a=[1,66],l=[1,67],h=[1,68],u=[1,69],f=[1,80],p=[1,72],m=[1,73],g=[1,74],v=[1,75],y=[1,99],x=[1,76],w=[1,100],S=[1,79],E=[1,51],A=[1,81],C=[1,82],P=[1,84],L=[1,83],T=[1,85],R=[1,96],G=[1,97],K=[1,98],Z=[1,86],O=[1,87],V=[1,64],j=[1,70],q=[1,71],J=[1,77],se=[1,78],_e=[1,53],Re=[1,54],ae=[1,55],ve=[1,61],oe=[1,88],Ce=[1,89],Ie=[1,90],ke=[1,91],Ye=[1,92],$e=[1,93],et=[1,94],Ke=[1,95],W=[1,101],Le=[1,102],Q=[1,103],he=[1,104],fe=[1,105],De=[1,56],je=[1,57],qe=[1,58],it=[1,59],ot=[1,115],_t=[1,111],H=[1,114],U=[1,112],we=[1,113],We=[1,118],Ge=[1,117],Je=[1,134],nt=[1,149],N=[1,150],F=[1,157],k=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],ee=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,71,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],ne=[5,6,7,9,13,15,17,18,19,20,23,25,26,27,30,33,34,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,82,83,84,85,86,87,88,89,90,91,92,93,94,95],ye=[5,70,72],ue=[5,74],Ue=[71,101],Ze={trace:function(){},yy:{},symbols_:{error:2,Program:3,Command:4,EOF:5,RESET:6,BUILD:7,ALL:8,HELP:9,Path:10,MOTM:11,OneArgCommand:12,GET:13,STRING:14,SET:15,Value:16,SET_SAVE:17,SET_RESTORE:18,SET_RESET:19,PRESET:20,AddRepresentation:21,EditRepresentation:22,REMOVE:23,RepresentationReference:24,HIDE:25,SHOW:26,LIST:27,EXPAND_KEY:28,SELECTOR_KEY:29,SELECT:30,AS:31,WordAll:32,SELECTOR:33,WITHIN:34,NUMBER:35,OF:36,MATERIAL:37,IDENTIFIER:38,ModeCMD:39,ColorCMD:40,VIEW:41,BASE_64:42,UNIT:43,DSSP:44,SCALE:45,ROTATE:46,AxesList:47,TRANSLATE:48,CENTER:49,GetURLBranch:50,Screenshot:51,LINE:52,ArgList:53,LISTOBJ:54,REMOVEOBJ:55,URL:56,VIEW_KEY:57,SCREENSHOT:58,LOAD:59,Url:60,FILE_KEY:61,ADD:62,Description:63,REP:64,MODE:65,COLOR:66,Descriptor:67,RepresentationOwnProperty:68,RepresentationOwnPropertyOpts:69,DESC_KEY:70,"=":71,DESC_KEY_OPTS:72,AxesArg:73,DESC_KEY_AXES:74,Arg:75,PathWoDescKey:76,HEX:77,BOOL:78,Word:79,CommandSetWoDESC_KEY:80,DescKeys:81,CLEAR:82,FILE_LIST:83,FILE_REGISTER:84,FILE_DELETE:85,PRESET_ADD:86,PRESET_DELETE:87,PRESET_UPDATE:88,PRESET_RENAME:89,PRESET_OPEN:90,CREATE_SCENARIO:91,RESET_SCENARIO:92,DELETE_SCENARIO:93,ADD_SCENARIO_ITEM:94,LIST_SCENARIO:95,PDB_KEY:96,DELAY_KEY:97,PRST_KEY:98,DESCRIPTION_KEY:99,CommandSet:100,".":101,PresetPath:102,"/":103,HexOrNumber:104,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"RESET",7:"BUILD",8:"ALL",9:"HELP",11:"MOTM",13:"GET",14:"STRING",15:"SET",17:"SET_SAVE",18:"SET_RESTORE",19:"SET_RESET",20:"PRESET",23:"REMOVE",25:"HIDE",26:"SHOW",27:"LIST",28:"EXPAND_KEY",29:"SELECTOR_KEY",30:"SELECT",31:"AS",33:"SELECTOR",34:"WITHIN",35:"NUMBER",36:"OF",37:"MATERIAL",38:"IDENTIFIER",41:"VIEW",42:"BASE_64",43:"UNIT",44:"DSSP",45:"SCALE",46:"ROTATE",48:"TRANSLATE",49:"CENTER",52:"LINE",54:"LISTOBJ",55:"REMOVEOBJ",56:"URL",57:"VIEW_KEY",58:"SCREENSHOT",59:"LOAD",61:"FILE_KEY",62:"ADD",64:"REP",65:"MODE",66:"COLOR",70:"DESC_KEY",71:"=",72:"DESC_KEY_OPTS",74:"DESC_KEY_AXES",77:"HEX",78:"BOOL",82:"CLEAR",83:"FILE_LIST",84:"FILE_REGISTER",85:"FILE_DELETE",86:"PRESET_ADD",87:"PRESET_DELETE",88:"PRESET_UPDATE",89:"PRESET_RENAME",90:"PRESET_OPEN",91:"CREATE_SCENARIO",92:"RESET_SCENARIO",93:"DELETE_SCENARIO",94:"ADD_SCENARIO_ITEM",95:"LIST_SCENARIO",96:"PDB_KEY",97:"DELAY_KEY",98:"PRST_KEY",99:"DESCRIPTION_KEY",101:".",103:"/"},productions_:[0,[3,2],[3,1],[4,1],[4,1],[4,2],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,2],[4,2],[4,1],[4,2],[4,2],[4,2],[4,4],[4,2],[4,6],[4,2],[4,1],[4,1],[4,1],[4,2],[4,2],[4,1],[4,2],[4,1],[4,2],[4,2],[4,2],[4,1],[4,2],[4,1],[4,1],[4,3],[4,3],[4,4],[4,4],[4,1],[4,2],[50,1],[50,2],[50,2],[50,3],[50,3],[51,1],[51,2],[51,3],[12,2],[12,2],[12,2],[21,1],[21,2],[21,2],[21,3],[22,2],[22,3],[39,2],[39,3],[40,2],[40,3],[24,1],[24,1],[63,1],[63,2],[63,3],[63,4],[67,1],[67,1],[67,2],[68,3],[69,3],[47,1],[47,2],[73,2],[53,1],[53,2],[75,3],[16,1],[16,1],[16,1],[16,1],[16,1],[79,1],[79,1],[32,1],[32,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[100,1],[100,1],[76,1],[76,3],[76,3],[10,1],[10,1],[10,3],[10,3],[10,3],[60,1],[102,1],[102,3],[104,1],[104,1]],performAction:function(xe,Pe,Qe,ie,at,ce,wt){var be=ce.length-1;switch(at){case 1:return ce[be-1];case 3:this.$=ie.miew.reset(!1),ie.ClearContext(),ie.miew.resetReps("empty");break;case 4:this.$=ie.miew.rebuild();break;case 5:this.$=ie.miew.rebuildAll(),ie.miew.rebuild();break;case 6:this.$=ie.echo(ie.utils.help().toString());break;case 7:this.$=ie.echo(ie.utils.help(ce[be]).toString());break;case 8:this.$=ie.miew.motm();break;case 10:case 11:this.$=ie.utils.propagateProp(ce[be]),ie.echo(ie.miew.get(ce[be]).toString());break;case 12:case 13:this.$=ie.miew.set(ce[be-1],ie.utils.propagateProp(ce[be-1],ce[be]));break;case 14:this.$=ie.miew.saveSettings();break;case 15:this.$=ie.miew.restoreSettings();break;case 16:this.$=ie.miew.resetSettings();break;case 17:this.$=ie.miew.resetReps();break;case 18:this.$=ie.miew.applyPreset(ce[be]);break;case 21:this.$=ie.miew.repRemove(ce[be]),ie.representations.remove(ce[be]);break;case 22:this.$=ie.miew.repHide(ce[be]);break;case 23:this.$=ie.miew.repHide(ce[be],!1);break;case 24:this.$=ie.echo(ie.utils.listRep(ie.miew,ie.representations,ce[be],"-e"));break;case 25:this.$=ie.echo(ie.utils.list(ie.miew,ie.representations));break;case 26:this.$=ie.echo(ie.utils.list(ie.miew,ie.representations,ce[be]));break;case 27:this.$=ie.echo(ie.utils.listSelector(ie.miew,ie.Context));break;case 28:this.$=ie.miew.select(ie.utils.checkArg(ce[be-1].toLowerCase(),ce[be],!0));break;case 29:this.$=ie.Context[ce[be].toLowerCase()]=ie.utils.checkArg(ce[be-3].toLowerCase(),ce[be-2],!0),ie.miew.select(ie.Context[ce[be].toLowerCase()]);break;case 30:this.$=ie.miew.rep(ie.miew.repCurrent(),{selector:ie.utils.checkArg(ce[be-1].toLowerCase(),ce[be])});break;case 31:this.$=ie.Context[ce[be].toLowerCase()]=ie.miew.within(ie.utils.checkArg("select",ce[be-2],!0),Number(ce[be-4]));break;case 32:this.$=ie.miew.rep(ie.miew.repCurrent(),{material:ie.utils.checkArg(ce[be-1].toLowerCase(),ce[be].toUpperCase())});break;case 35:this.$=ie.echo(ie.miew.view());break;case 36:case 37:this.$=ie.miew.view(ce[be]);break;case 38:this.$=ie.echo(ie.miew.changeUnit());break;case 39:this.$=ie.echo(ie.miew.changeUnit(ce[be]));break;case 40:this.$=ie.miew.dssp();break;case 41:this.$=ie.miew.scale(ce[be]);break;case 42:for(var Et=0,gn=ce[be].length;Et<gn;Et++)ie.miew.rotate(ce[be][Et].x*Math.PI/180,ce[be][Et].y*Math.PI/180,ce[be][Et].z*Math.PI/180);break;case 43:for(var Et=0,gn=ce[be].length;Et<gn;Et++)ie.miew.translate(ce[be][Et].x||0,ce[be][Et].y||0,ce[be][Et].z||0);break;case 44:this.$=ie.miew.center();break;case 45:this.$=ie.miew.center(ce[be]);break;case 48:case 49:this.$=ie.miew.addObject({type:"line",params:[ce[be-1],ce[be]]},!0);break;case 50:case 51:this.$=ie.miew.addObject({type:"line",params:[ce[be-2],ce[be-1]],opts:ce[be].toJSO(ie.utils,"objects","line")},!0);break;case 52:this.$=ie.echo(ie.utils.listObjs(ie.miew));break;case 53:this.$=ie.miew.removeObject(ce[be]);break;case 54:this.$=ie.echo(ie.miew.getURL({view:!1,settings:!1}));break;case 55:this.$=ie.echo(ie.miew.getURL({view:!1,settings:!0}));break;case 56:this.$=ie.echo(ie.miew.getURL({view:!0,settings:!1}));break;case 57:case 58:this.$=ie.echo(ie.miew.getURL({view:!0,settings:!0}));break;case 59:this.$=ie.miew.screenshotSave();break;case 60:this.$=ie.miew.screenshotSave("",Number(ce[be]));break;case 61:this.$=ie.miew.screenshotSave("",Number(ce[be-1]),Number(ce[be]));break;case 62:case 63:case 64:this.$=ie.utils.load(ie.miew,ce[be]),ie.representations.clear();break;case 65:this.$=ie.echo(ie.representations.add(ie.miew.repAdd()));break;case 66:this.$=ie.echo(ie.representations.add(ce[be],ie.miew.repAdd()));break;case 67:this.$=ie.echo(ie.representations.add(ie.miew.repAdd(ce[be])));break;case 68:this.$=ie.echo(ie.representations.add(ce[be-1],ie.miew.repAdd(ce[be])));break;case 69:this.$=ie.miew.rep(ce[be]),ie.miew.repCurrent(ce[be]);break;case 70:this.$=ie.miew.rep(ce[be-1],ce[be]),ie.miew.repCurrent(ce[be-1]);break;case 71:this.$=ie.miew.rep(ie.miew.repCurrent(),{mode:ie.utils.checkArg(ce[be-1].toLowerCase(),ce[be].toUpperCase())});break;case 72:this.$=ie.miew.rep(ie.miew.repCurrent(),{mode:new Array(ie.utils.checkArg(ce[be-2].toLowerCase(),ce[be-1].toUpperCase()),ce[be].toJSO(ie.utils,ce[be-2],ce[be-1].toUpperCase()))});break;case 73:this.$=ie.miew.rep(ie.miew.repCurrent(),{colorer:ie.utils.checkArg(ce[be-1].toLowerCase(),ce[be].toUpperCase())});break;case 74:this.$=ie.miew.rep(ie.miew.repCurrent(),{colorer:new Array(ie.utils.checkArg(ce[be-2].toLowerCase(),ce[be-1].toUpperCase()),ce[be].toJSO(ie.utils,ce[be-2],ce[be-1].toUpperCase()))});break;case 75:this.$=Number(ie.representations.get(ce[be]));break;case 76:case 92:this.$=Number(ce[be]);break;case 77:this.$=ce[be];break;case 78:this.$=ie._.assign(ce[be-1],ce[be]);break;case 79:this.$=ie._.assign(ce[be-2],ce[be-1],ce[be]);break;case 80:this.$=ie._.assign(ce[be-3],ce[be-2],ce[be-1],ce[be]);break;case 81:case 82:this.$=ie.CreateObjectPair(ce[be].key,ce[be].val);break;case 83:this.$=ie.CreateObjectPair(ce[be-1].key,new Array(ce[be-1].val,ce[be].toJSO(ie.utils,ce[be-1].key,ce[be-1].val)));break;case 84:case 85:this.$=Object.create({key:ie.keyRemap(ce[be-2]),val:ie.utils.checkArg(ce[be-2],ce[be])});break;case 86:this.$=[ce[be]];break;case 87:this.$=ce[be-1].concat(ce[be]);break;case 88:this.$=ie.CreateObjectPair(ce[be-1].toLowerCase(),Number(ce[be]));break;case 89:this.$=new ie.ArgList(ce[be]);break;case 90:this.$=ce[be-1].append(ce[be]);break;case 91:this.$=new ie.Arg(ce[be-2],ce[be]);break;case 93:this.$=parseInt(ce[be]);break;case 94:this.$=JSON.parse(ce[be]);break;case 95:case 96:this.$=String(ce[be]);break;case 157:case 158:case 161:case 162:case 163:this.$=ce[be-2]+ce[be-1]+ce[be];break;case 166:this.$=ce[be-2]=ce[be-2]+ce[be-1]+ce[be];break}},table:[{3:1,4:2,5:[1,3],6:[1,4],7:[1,5],9:[1,6],11:[1,7],12:8,13:[1,9],15:[1,10],17:[1,11],18:[1,12],19:[1,13],20:[1,14],21:15,22:16,23:[1,17],25:[1,18],26:[1,19],27:[1,20],30:[1,21],33:[1,22],34:[1,23],37:[1,24],39:25,40:26,41:[1,27],43:[1,28],44:[1,29],45:[1,30],46:[1,31],48:[1,32],49:[1,33],50:34,51:35,52:[1,36],54:[1,37],55:[1,38],56:[1,44],58:[1,45],59:[1,39],62:[1,40],64:[1,41],65:[1,42],66:[1,43]},{1:[3]},{5:[1,46]},{1:[2,2]},{5:[2,3]},{5:[2,4],8:[1,47]},{5:[2,6],6:n,7:i,9:r,10:48,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,70:_e,72:Re,74:ae,79:49,80:52,81:50,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,96:De,97:je,98:qe,99:it},{5:[2,8]},{5:[2,9]},{6:n,7:i,9:r,10:106,13:o,14:[1,107],15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,70:_e,72:Re,74:ae,79:49,80:52,81:50,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,96:De,97:je,98:qe,99:it},{6:n,7:i,9:r,10:108,13:o,14:[1,109],15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,70:_e,72:Re,74:ae,79:49,80:52,81:50,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,96:De,97:je,98:qe,99:it},{5:[2,14]},{5:[2,15]},{5:[2,16]},{5:[2,17],14:ot,16:110,35:_t,38:H,77:U,78:we},{5:[2,19]},{5:[2,20]},{24:116,35:We,38:Ge},{24:119,35:We,38:Ge},{24:120,35:We,38:Ge},{5:[2,25],24:121,28:[1,122],29:[1,123],35:We,38:Ge},{14:[1,124]},{14:[1,125]},{35:[1,126]},{38:[1,127]},{5:[2,33]},{5:[2,34]},{5:[2,35],14:[1,128],42:[1,129]},{5:[2,38],35:[1,130]},{5:[2,40]},{35:[1,131]},{47:132,73:133,74:Je},{47:135,73:133,74:Je},{5:[2,44],14:[1,136]},{5:[2,46]},{5:[2,47]},{6:n,7:i,9:r,10:138,13:o,14:[1,137],15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,70:_e,72:Re,74:ae,79:49,80:52,81:50,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,96:De,97:je,98:qe,99:it},{5:[2,52]},{35:[1,139]},{14:[1,143],38:[1,141],60:140,61:[1,142]},{5:[2,65],38:[1,144],63:145,67:146,68:147,69:148,70:nt,72:N},{24:151,35:We,38:Ge},{38:[1,152]},{38:[1,153]},{5:[2,54],29:[1,154],57:[1,155]},{5:[2,59],35:[1,156]},{1:[2,1]},{5:[2,5]},{5:[2,7],101:F},t(k,[2,159]),t(k,[2,160]),t(ee,[2,97]),t(ee,[2,98]),t(k,[2,147]),t(k,[2,148]),t(k,[2,149]),t(k,[2,150]),t(k,[2,151]),t(k,[2,152]),t(k,[2,153]),t(ee,[2,101]),t(ee,[2,102]),t(ee,[2,103]),t(ee,[2,104]),t(ee,[2,105]),t(ee,[2,106]),t(ee,[2,107]),t(ee,[2,108]),t(ee,[2,109]),t(ee,[2,110]),t(ee,[2,111]),t(ee,[2,112]),t(ee,[2,113]),t(ee,[2,114]),t(ee,[2,115]),t(ee,[2,116]),t(ee,[2,117]),t(ee,[2,118]),t(ee,[2,119]),t(ee,[2,120]),t(ee,[2,121]),t(ee,[2,122]),t(ee,[2,123]),t(ee,[2,124]),t(ee,[2,125]),t(ee,[2,126]),t(ee,[2,127]),t(ee,[2,128]),t(ee,[2,129]),t(ee,[2,130]),t(ee,[2,131]),t(ee,[2,132]),t(ee,[2,133]),t(ee,[2,134]),t(ee,[2,135]),t(ee,[2,136]),t(ee,[2,137]),t(ee,[2,138]),t(ee,[2,139]),t(ee,[2,140]),t(ee,[2,141]),t(ee,[2,142]),t(ee,[2,143]),t(ee,[2,144]),t(ee,[2,145]),t(ee,[2,146]),{5:[2,10],101:F},{5:[2,11]},{14:ot,16:158,35:_t,38:H,77:U,78:we,101:F},{14:ot,16:159,35:_t,38:H,77:U,78:we},{5:[2,18]},t(ne,[2,92]),t(ne,[2,93]),t(ne,[2,94]),t(ne,[2,95]),t(ne,[2,96]),{5:[2,21]},t(ye,[2,75]),t(ye,[2,76]),{5:[2,22]},{5:[2,23]},{5:[2,24]},{5:[2,26]},{5:[2,27]},{5:[2,28],31:[1,160]},{5:[2,30]},{36:[1,161]},{5:[2,32]},{5:[2,36]},{5:[2,37]},{5:[2,39]},{5:[2,41]},{5:[2,42],73:162,74:Je},t(ue,[2,86]),{35:[1,163]},{5:[2,43],73:162,74:Je},{5:[2,45]},{14:[1,164]},{6:n,7:i,9:r,10:165,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,70:_e,72:Re,74:ae,79:49,80:52,81:50,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,96:De,97:je,98:qe,99:it,101:F},{5:[2,53]},{5:[2,62]},{5:[2,63]},{5:[2,64]},{5:[2,164]},{5:[2,66],63:166,67:146,68:147,69:148,70:nt,72:N},{5:[2,67]},{5:[2,77],67:167,68:147,69:148,70:nt,72:N},t(ye,[2,81]),t(ye,[2,82],{80:52,53:168,75:169,76:170,79:171,6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe}),{71:[1,172]},{71:[1,173]},{5:[2,69],63:174,67:146,68:147,69:148,70:nt,72:N},{5:[2,71],6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,53:175,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,75:169,76:170,79:171,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe},{5:[2,73],6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,53:176,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,75:169,76:170,79:171,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe},{5:[2,55],57:[1,177]},{5:[2,56],29:[1,178]},{5:[2,60],35:[1,179]},{6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,35:[1,181],37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,70:_e,72:Re,74:ae,79:180,80:52,81:182,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,96:De,97:je,98:qe,99:it},{5:[2,12]},{5:[2,13]},{6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,32:183,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,70:_e,72:Re,74:ae,79:184,80:52,81:185,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,96:De,97:je,98:qe,99:it},{14:[1,186]},t(ue,[2,87]),t(ue,[2,88]),{5:[2,48],6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,53:187,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,75:169,76:170,79:171,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe},{5:[2,49],6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,53:188,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,75:169,76:170,79:171,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,101:F},{5:[2,68]},{5:[2,78],67:189,68:147,69:148,70:nt,72:N},t(ye,[2,83],{80:52,76:170,79:171,75:190,6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe}),t(ne,[2,89]),{71:[1,191],101:[1,192]},t(Ue,[2,156]),{14:ot,16:193,35:_t,38:H,77:U,78:we},{14:ot,16:194,35:_t,38:H,77:U,78:we},{5:[2,70]},{5:[2,72],6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,75:190,76:170,79:171,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe},{5:[2,74],6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,75:190,76:170,79:171,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe},{5:[2,57]},{5:[2,58]},{5:[2,61]},t(k,[2,161]),t(k,[2,162]),t(k,[2,163]),{5:[2,29]},{5:[2,99]},{5:[2,100]},{31:[1,195]},{5:[2,50],6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,75:190,76:170,79:171,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe},{5:[2,51],6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,75:190,76:170,79:171,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe},{5:[2,79],67:196,68:147,69:148,70:nt,72:N},t(ne,[2,90]),{14:ot,16:197,35:_t,38:H,77:U,78:we},{6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,33:x,34:w,35:[1,199],37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,79:198,80:52,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe},t(ye,[2,84]),t(ne,[2,85]),{6:n,7:i,9:r,13:o,15:a,17:l,18:h,19:u,20:f,23:p,25:m,26:g,27:v,30:y,32:200,33:x,34:w,37:S,38:E,41:A,43:C,45:P,46:L,49:T,52:R,54:G,55:K,56:Z,58:O,59:V,62:j,64:q,65:J,66:se,70:_e,72:Re,74:ae,79:184,80:52,81:185,82:ve,83:oe,84:Ce,85:Ie,86:ke,87:Ye,88:$e,89:et,90:Ke,91:W,92:Le,93:Q,94:he,95:fe,96:De,97:je,98:qe,99:it},{5:[2,80]},t(ne,[2,91]),t(Ue,[2,157]),t(Ue,[2,158]),{5:[2,31]}],defaultActions:{3:[2,2],4:[2,3],7:[2,8],8:[2,9],11:[2,14],12:[2,15],13:[2,16],15:[2,19],16:[2,20],25:[2,33],26:[2,34],29:[2,40],34:[2,46],35:[2,47],37:[2,52],46:[2,1],47:[2,5],107:[2,11],110:[2,18],116:[2,21],119:[2,22],120:[2,23],121:[2,24],122:[2,26],123:[2,27],125:[2,30],127:[2,32],128:[2,36],129:[2,37],130:[2,39],131:[2,41],136:[2,45],139:[2,53],140:[2,62],141:[2,63],142:[2,64],143:[2,164],145:[2,67],158:[2,12],159:[2,13],166:[2,68],174:[2,70],177:[2,57],178:[2,58],179:[2,61],183:[2,29],184:[2,99],185:[2,100],196:[2,80],200:[2,31]},parseError:function(xe,Pe){if(Pe.recoverable)this.trace(xe);else{var Qe=new Error(xe);throw Qe.hash=Pe,Qe}},parse:function(xe){var Pe=this,Qe=[0],ie=[],at=[null],ce=[],wt=this.table,be="",Et=0,gn=0,Dn=2,$n=1,Un=ce.slice.call(arguments,1),Zt=Object.create(this.lexer),wn={yy:{}};for(var cr in this.yy)Object.prototype.hasOwnProperty.call(this.yy,cr)&&(wn.yy[cr]=this.yy[cr]);Zt.setInput(xe,wn.yy),wn.yy.lexer=Zt,wn.yy.parser=this,typeof Zt.yylloc>"u"&&(Zt.yylloc={});var Cr=Zt.yylloc;ce.push(Cr);var Rr=Zt.options&&Zt.options.ranges;typeof wn.yy.parseError=="function"?this.parseError=wn.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function As(){var ft;return ft=ie.pop()||Zt.lex()||$n,typeof ft!="number"&&(ft instanceof Array&&(ie=ft,ft=ie.pop()),ft=Pe.symbols_[ft]||ft),ft}for(var z,ge,Te,de,Ae={},rt,ut,gt,mt;;){if(ge=Qe[Qe.length-1],this.defaultActions[ge]?Te=this.defaultActions[ge]:((z===null||typeof z>"u")&&(z=As()),Te=wt[ge]&&wt[ge][z]),typeof Te>"u"||!Te.length||!Te[0]){var Mt="";mt=[];for(rt in wt[ge])this.terminals_[rt]&&rt>Dn&&mt.push("'"+this.terminals_[rt]+"'");Zt.showPosition?Mt="Parse error on line "+(Et+1)+`:
`+Zt.showPosition()+`
Expecting `+mt.join(", ")+", got '"+(this.terminals_[z]||z)+"'":Mt="Parse error on line "+(Et+1)+": Unexpected "+(z==$n?"end of input":"'"+(this.terminals_[z]||z)+"'"),this.parseError(Mt,{text:Zt.match,token:this.terminals_[z]||z,line:Zt.yylineno,loc:Cr,expected:mt})}if(Te[0]instanceof Array&&Te.length>1)throw new Error("Parse Error: multiple actions possible at state: "+ge+", token: "+z);switch(Te[0]){case 1:Qe.push(z),at.push(Zt.yytext),ce.push(Zt.yylloc),Qe.push(Te[1]),z=null,gn=Zt.yyleng,be=Zt.yytext,Et=Zt.yylineno,Cr=Zt.yylloc;break;case 2:if(ut=this.productions_[Te[1]][1],Ae.$=at[at.length-ut],Ae._$={first_line:ce[ce.length-(ut||1)].first_line,last_line:ce[ce.length-1].last_line,first_column:ce[ce.length-(ut||1)].first_column,last_column:ce[ce.length-1].last_column},Rr&&(Ae._$.range=[ce[ce.length-(ut||1)].range[0],ce[ce.length-1].range[1]]),de=this.performAction.apply(Ae,[be,gn,Et,wn.yy,Te[1],at,ce].concat(Un)),typeof de<"u")return de;ut&&(Qe=Qe.slice(0,-1*ut*2),at=at.slice(0,-1*ut),ce=ce.slice(0,-1*ut)),Qe.push(this.productions_[Te[1]][0]),at.push(Ae.$),ce.push(Ae._$),gt=wt[Qe[Qe.length-2]][Qe[Qe.length-1]],Qe.push(gt);break;case 3:return!0}}return!0}},Y=function(){var me={EOF:1,parseError:function(Pe,Qe){if(this.yy.parser)this.yy.parser.parseError(Pe,Qe);else throw new Error(Pe)},setInput:function(xe,Pe){return this.yy=Pe||this.yy||{},this._input=xe,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var xe=this._input[0];this.yytext+=xe,this.yyleng++,this.offset++,this.match+=xe,this.matched+=xe;var Pe=xe.match(/(?:\r\n?|\n).*/g);return Pe?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),xe},unput:function(xe){var Pe=xe.length,Qe=xe.split(/(?:\r\n?|\n)/g);this._input=xe+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-Pe),this.offset-=Pe;var ie=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),Qe.length-1&&(this.yylineno-=Qe.length-1);var at=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:Qe?(Qe.length===ie.length?this.yylloc.first_column:0)+ie[ie.length-Qe.length].length-Qe[0].length:this.yylloc.first_column-Pe},this.options.ranges&&(this.yylloc.range=[at[0],at[0]+this.yyleng-Pe]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(xe){this.unput(this.match.slice(xe))},pastInput:function(){var xe=this.matched.substr(0,this.matched.length-this.match.length);return(xe.length>20?"...":"")+xe.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var xe=this.match;return xe.length<20&&(xe+=this._input.substr(0,20-xe.length)),(xe.substr(0,20)+(xe.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var xe=this.pastInput(),Pe=new Array(xe.length+1).join("-");return xe+this.upcomingInput()+`
`+Pe+"^"},test_match:function(xe,Pe){var Qe,ie,at;if(this.options.backtrack_lexer&&(at={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(at.yylloc.range=this.yylloc.range.slice(0))),ie=xe[0].match(/(?:\r\n?|\n).*/g),ie&&(this.yylineno+=ie.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:ie?ie[ie.length-1].length-ie[ie.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+xe[0].length},this.yytext+=xe[0],this.match+=xe[0],this.matches=xe,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(xe[0].length),this.matched+=xe[0],Qe=this.performAction.call(this,this.yy,this,Pe,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),Qe)return Qe;if(this._backtrack){for(var ce in at)this[ce]=at[ce];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var xe,Pe,Qe,ie;this._more||(this.yytext="",this.match="");for(var at=this._currentRules(),ce=0;ce<at.length;ce++)if(Qe=this._input.match(this.rules[at[ce]]),Qe&&(!Pe||Qe[0].length>Pe[0].length)){if(Pe=Qe,ie=ce,this.options.backtrack_lexer){if(xe=this.test_match(Qe,at[ce]),xe!==!1)return xe;if(this._backtrack){Pe=!1;continue}else return!1}else if(!this.options.flex)break}return Pe?(xe=this.test_match(Pe,at[ie]),xe!==!1?xe:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var Pe=this.next();return Pe||this.lex()},begin:function(Pe){this.conditionStack.push(Pe)},popState:function(){var Pe=this.conditionStack.length-1;return Pe>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(Pe){return Pe=this.conditionStack.length-1-Math.abs(Pe||0),Pe>=0?this.conditionStack[Pe]:"INITIAL"},pushState:function(Pe){this.begin(Pe)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(Pe,Qe,ie,at){switch(ie){case 0:break;case 1:return"";case 2:return"";case 3:return 42;case 4:return 35;case 5:return 77;case 6:return 78;case 7:return 78;case 8:return 8;case 9:return 6;case 10:return 82;case 11:return 7;case 12:return 9;case 13:return 59;case 14:return 13;case 15:return 15;case 16:return 17;case 17:return 18;case 18:return 19;case 19:return 20;case 20:return 11;case 21:return 62;case 22:return 64;case 23:return 23;case 24:return 25;case 25:return 26;case 26:return 27;case 27:return 30;case 28:return 34;case 29:return 33;case 30:return 65;case 31:return 66;case 32:return 37;case 33:return 41;case 34:return 43;case 35:return 52;case 36:return 54;case 37:return 55;case 38:return 46;case 39:return 48;case 40:return 45;case 41:return 49;case 42:return 56;case 43:return 58;case 44:return 44;case 45:return 83;case 46:return 84;case 47:return 85;case 48:return 86;case 49:return 87;case 50:return 88;case 51:return 89;case 52:return 90;case 53:return 91;case 54:return 92;case 55:return 93;case 56:return 94;case 57:return 95;case 58:return 70;case 59:return 70;case 60:return 72;case 61:return 72;case 62:return 74;case 63:return 74;case 64:return 74;case 65:return 31;case 66:return 36;case 67:return 96;case 68:return 97;case 69:return 98;case 70:return 99;case 71:return Qe.yytext=Pe.utils.unquoteString(Qe.yytext),14;case 72:return 38;case 73:return 5;case 74:return 101;case 75:return 103;case 76:return"\\";case 77:return 28;case 78:return 61;case 79:return 29;case 80:return 57;case 81:return 71}},rules:[/^(?:\s+)/i,/^(?:[#].*)/i,/^(?:\/\/.*)/i,/^(?:([_A-Z0-9\/\+]+==))/i,/^(?:-?[0-9]+(\.[0-9]+)?\b)/i,/^(?:0[xX][0-9A-F]+\b)/i,/^(?:false\b)/i,/^(?:true\b)/i,/^(?:all\b)/i,/^(?:reset\b)/i,/^(?:clear\b)/i,/^(?:build\b)/i,/^(?:help\b)/i,/^(?:load\b)/i,/^(?:get\b)/i,/^(?:set\b)/i,/^(?:set_save\b)/i,/^(?:set_restore\b)/i,/^(?:set_reset\b)/i,/^(?:preset\b)/i,/^(?:motm\b)/i,/^(?:add\b)/i,/^(?:rep\b)/i,/^(?:remove\b)/i,/^(?:hide\b)/i,/^(?:show\b)/i,/^(?:list\b)/i,/^(?:select\b)/i,/^(?:within\b)/i,/^(?:selector\b)/i,/^(?:mode\b)/i,/^(?:color\b)/i,/^(?:material\b)/i,/^(?:view\b)/i,/^(?:unit\b)/i,/^(?:line\b)/i,/^(?:listobj\b)/i,/^(?:removeobj\b)/i,/^(?:rotate\b)/i,/^(?:translate\b)/i,/^(?:scale\b)/i,/^(?:center\b)/i,/^(?:url\b)/i,/^(?:screenshot\b)/i,/^(?:dssp\b)/i,/^(?:file_list\b)/i,/^(?:file_register\b)/i,/^(?:file_delete\b)/i,/^(?:preset_add\b)/i,/^(?:preset_delete\b)/i,/^(?:preset_update\b)/i,/^(?:preset_rename\b)/i,/^(?:preset_open\b)/i,/^(?:create_scenario\b)/i,/^(?:reset_scenario\b)/i,/^(?:delete_scenario\b)/i,/^(?:add_scenario_item\b)/i,/^(?:list_scenario\b)/i,/^(?:s\b)/i,/^(?:mt\b)/i,/^(?:m\b)/i,/^(?:c\b)/i,/^(?:x\b)/i,/^(?:y\b)/i,/^(?:z\b)/i,/^(?:as\b)/i,/^(?:of\b)/i,/^(?:pdb\b)/i,/^(?:delay\b)/i,/^(?:prst\b)/i,/^(?:desc\b)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:\.)/i,/^(?:\/)/i,/^(?:\\)/i,/^(?:-e\b)/i,/^(?:-f\b)/i,/^(?:-s\b)/i,/^(?:-v\b)/i,/^(?:=)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81],inclusive:!0}}};return me}();Ze.lexer=Y;function Ve(){this.yy={}}return Ve.prototype=Ze,Ze.Parser=Ve,new Ve}();s.exports={parser:e}},99:s=>{var e=function(){var t=function(E,A,C,P){for(C=C||{},P=E.length;P--;C[E[P]]=A);return C},n=[1,4],i=[1,5],r=[1,6],o=[1,7],a=[1,8],l=[1,9],h=[1,11],u=[1,12],f=[5,7,8,11],p=[1,17],m=[1,22],g=[1,20],v=[1,21],y=[5,7,8,11,19],x={trace:function(){},yy:{},symbols_:{error:2,Program:3,Expression:4,EOF:5,Selector:6,OR:7,AND:8,NOT:9,"(":10,")":11,SELECTOR:12,NAMED_SELECTOR:13,SELECTOR_RANGED:14,RangeList:15,SELECTOR_NAMED:16,NameList:17,Range:18,",":19,NUMBER:20,":":21,Name:22,IDENTIFIER:23,STRING:24,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"OR",8:"AND",9:"NOT",10:"(",11:")",12:"SELECTOR",13:"NAMED_SELECTOR",14:"SELECTOR_RANGED",16:"SELECTOR_NAMED",19:",",20:"NUMBER",21:":",23:"IDENTIFIER",24:"STRING"},productions_:[0,[3,2],[4,1],[4,3],[4,3],[4,2],[4,3],[6,1],[6,1],[6,2],[6,2],[15,1],[15,3],[18,1],[18,3],[17,1],[17,3],[22,1],[22,1],[22,1]],performAction:function(A,C,P,L,T,R,G){var K=R.length-1;switch(T){case 1:return R[K-1];case 3:this.$=L.keyword("or")(R[K-2],R[K]);break;case 4:this.$=L.keyword("and")(R[K-2],R[K]);break;case 5:this.$=L.keyword("not")(R[K]);break;case 6:this.$=R[K-1];break;case 7:this.$=L.keyword(R[K])();break;case 8:this.$=L.GetSelector(R[K].toLowerCase().slice(1,R[K].length));break;case 9:case 10:this.$=L.keyword(R[K-1])(R[K]);break;case 11:this.$=new L.RangeList(R[K]);break;case 12:case 16:this.$=R[K-2].append(R[K]);break;case 13:this.$=new L.Range(Number(R[K]));break;case 14:this.$=new L.Range(Number(R[K-2]),Number(R[K]));break;case 15:this.$=new L.ValueList(R[K]);break}},table:[{3:1,4:2,6:3,9:n,10:i,12:r,13:o,14:a,16:l},{1:[3]},{5:[1,10],7:h,8:u},t(f,[2,2]),{4:13,6:3,9:n,10:i,12:r,13:o,14:a,16:l},{4:14,6:3,9:n,10:i,12:r,13:o,14:a,16:l},t(f,[2,7]),t(f,[2,8]),{15:15,18:16,20:p},{17:18,20:m,22:19,23:g,24:v},{1:[2,1]},{4:23,6:3,9:n,10:i,12:r,13:o,14:a,16:l},{4:24,6:3,9:n,10:i,12:r,13:o,14:a,16:l},t(f,[2,5]),{7:h,8:u,11:[1,25]},t(f,[2,9],{19:[1,26]}),t(y,[2,11]),t(y,[2,13],{21:[1,27]}),t(f,[2,10],{19:[1,28]}),t(y,[2,15]),t(y,[2,17]),t(y,[2,18]),t(y,[2,19]),t([5,7,11],[2,3],{8:u}),t(f,[2,4]),t(f,[2,6]),{18:29,20:p},{20:[1,30]},{20:m,22:31,23:g,24:v},t(y,[2,12]),t(y,[2,14]),t(y,[2,16])],defaultActions:{10:[2,1]},parseError:function(A,C){if(C.recoverable)this.trace(A);else{var P=new Error(A);throw P.hash=C,P}},parse:function(A){var C=this,P=[0],L=[],T=[null],R=[],G=this.table,K="",Z=0,O=0,V=2,j=1,q=R.slice.call(arguments,1),J=Object.create(this.lexer),se={yy:{}};for(var _e in this.yy)Object.prototype.hasOwnProperty.call(this.yy,_e)&&(se.yy[_e]=this.yy[_e]);J.setInput(A,se.yy),se.yy.lexer=J,se.yy.parser=this,typeof J.yylloc>"u"&&(J.yylloc={});var Re=J.yylloc;R.push(Re);var ae=J.options&&J.options.ranges;typeof se.yy.parseError=="function"?this.parseError=se.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function ve(){var Q;return Q=L.pop()||J.lex()||j,typeof Q!="number"&&(Q instanceof Array&&(L=Q,Q=L.pop()),Q=C.symbols_[Q]||Q),Q}for(var oe,Ce,Ie,ke,Ye={},$e,et,Ke,W;;){if(Ce=P[P.length-1],this.defaultActions[Ce]?Ie=this.defaultActions[Ce]:((oe===null||typeof oe>"u")&&(oe=ve()),Ie=G[Ce]&&G[Ce][oe]),typeof Ie>"u"||!Ie.length||!Ie[0]){var Le="";W=[];for($e in G[Ce])this.terminals_[$e]&&$e>V&&W.push("'"+this.terminals_[$e]+"'");J.showPosition?Le="Parse error on line "+(Z+1)+`:
`+J.showPosition()+`
Expecting `+W.join(", ")+", got '"+(this.terminals_[oe]||oe)+"'":Le="Parse error on line "+(Z+1)+": Unexpected "+(oe==j?"end of input":"'"+(this.terminals_[oe]||oe)+"'"),this.parseError(Le,{text:J.match,token:this.terminals_[oe]||oe,line:J.yylineno,loc:Re,expected:W})}if(Ie[0]instanceof Array&&Ie.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Ce+", token: "+oe);switch(Ie[0]){case 1:P.push(oe),T.push(J.yytext),R.push(J.yylloc),P.push(Ie[1]),oe=null,O=J.yyleng,K=J.yytext,Z=J.yylineno,Re=J.yylloc;break;case 2:if(et=this.productions_[Ie[1]][1],Ye.$=T[T.length-et],Ye._$={first_line:R[R.length-(et||1)].first_line,last_line:R[R.length-1].last_line,first_column:R[R.length-(et||1)].first_column,last_column:R[R.length-1].last_column},ae&&(Ye._$.range=[R[R.length-(et||1)].range[0],R[R.length-1].range[1]]),ke=this.performAction.apply(Ye,[K,O,Z,se.yy,Ie[1],T,R].concat(q)),typeof ke<"u")return ke;et&&(P=P.slice(0,-1*et*2),T=T.slice(0,-1*et),R=R.slice(0,-1*et)),P.push(this.productions_[Ie[1]][0]),T.push(Ye.$),R.push(Ye._$),Ke=G[P[P.length-2]][P[P.length-1]],P.push(Ke);break;case 3:return!0}}return!0}},w=function(){var E={EOF:1,parseError:function(C,P){if(this.yy.parser)this.yy.parser.parseError(C,P);else throw new Error(C)},setInput:function(A,C){return this.yy=C||this.yy||{},this._input=A,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var A=this._input[0];this.yytext+=A,this.yyleng++,this.offset++,this.match+=A,this.matched+=A;var C=A.match(/(?:\r\n?|\n).*/g);return C?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),A},unput:function(A){var C=A.length,P=A.split(/(?:\r\n?|\n)/g);this._input=A+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-C),this.offset-=C;var L=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),P.length-1&&(this.yylineno-=P.length-1);var T=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:P?(P.length===L.length?this.yylloc.first_column:0)+L[L.length-P.length].length-P[0].length:this.yylloc.first_column-C},this.options.ranges&&(this.yylloc.range=[T[0],T[0]+this.yyleng-C]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(A){this.unput(this.match.slice(A))},pastInput:function(){var A=this.matched.substr(0,this.matched.length-this.match.length);return(A.length>20?"...":"")+A.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var A=this.match;return A.length<20&&(A+=this._input.substr(0,20-A.length)),(A.substr(0,20)+(A.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var A=this.pastInput(),C=new Array(A.length+1).join("-");return A+this.upcomingInput()+`
`+C+"^"},test_match:function(A,C){var P,L,T;if(this.options.backtrack_lexer&&(T={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(T.yylloc.range=this.yylloc.range.slice(0))),L=A[0].match(/(?:\r\n?|\n).*/g),L&&(this.yylineno+=L.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:L?L[L.length-1].length-L[L.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+A[0].length},this.yytext+=A[0],this.match+=A[0],this.matches=A,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(A[0].length),this.matched+=A[0],P=this.performAction.call(this,this.yy,this,C,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),P)return P;if(this._backtrack){for(var R in T)this[R]=T[R];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var A,C,P,L;this._more||(this.yytext="",this.match="");for(var T=this._currentRules(),R=0;R<T.length;R++)if(P=this._input.match(this.rules[T[R]]),P&&(!C||P[0].length>C[0].length)){if(C=P,L=R,this.options.backtrack_lexer){if(A=this.test_match(P,T[R]),A!==!1)return A;if(this._backtrack){C=!1;continue}else return!1}else if(!this.options.flex)break}return C?(A=this.test_match(C,T[L]),A!==!1?A:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var C=this.next();return C||this.lex()},begin:function(C){this.conditionStack.push(C)},popState:function(){var C=this.conditionStack.length-1;return C>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(C){return C=this.conditionStack.length-1-Math.abs(C||0),C>=0?this.conditionStack[C]:"INITIAL"},pushState:function(C){this.begin(C)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(C,P,L,T){switch(L){case 0:break;case 1:return 20;case 2:return 7;case 3:return 8;case 4:return 9;case 5:return 12;case 6:return 16;case 7:return 14;case 8:return 10;case 9:return 11;case 10:return 19;case 11:return 21;case 12:return"<=";case 13:return">=";case 14:return"<";case 15:return">";case 16:return P.yytext=P.yytext.substr(1,P.yyleng-2),24;case 17:return 13;case 18:return 23;case 19:return 5;case 20:return"INVALID"}},rules:[/^(?:\s+)/i,/^(?:(-?(?:[1-9][0-9]+|[0-9]))\b)/i,/^(?:OR\b)/i,/^(?:AND\b)/i,/^(?:NOT\b)/i,/^(?:((ALL|NONE|HETATM|PROTEIN|BASIC|ACIDIC|CHARGED|POLAR|NONPOLAR|AROMATIC|NUCLEIC|PURINE|PYRIMIDINE|WATER|POLARH|NONPOLARH))\b)/i,/^(?:((NAME|ELEM|TYPE|RESIDUE|ICODE|CHAIN|ALTLOC))\b)/i,/^(?:((SERIAL|SEQUENCE|RESIDX))\b)/i,/^(?:\()/i,/^(?:\))/i,/^(?:,)/i,/^(?::)/i,/^(?:<=)/i,/^(?:>=)/i,/^(?:<)/i,/^(?:>)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:(@[_A-Z0-9]+))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:.)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],inclusive:!0}}};return E}();x.lexer=w;function S(){this.yy={}}return S.prototype=x,x.Parser=S,new S}();s.exports={parser:e}},690:function(s,e){(function(){var t,n,i,r,o,a,l,h,u,f,p,m,g,v,y,x,w,S,E,A,C,P,L,T,R,G,K=Object.prototype.hasOwnProperty,Z=function(O,V){for(var j in V)K.call(V,j)&&(O[j]=V[j]);function q(){this.constructor=O}return q.prototype=V.prototype,O.prototype=new q,O.__super__=V.prototype,O};i={METHOD_NEAREST:"nearest",METHOD_LINEAR:"linear",METHOD_CUBIC:"cubic",METHOD_LANCZOS:"lanczos",METHOD_SINC:"sinc",CLIP_CLAMP:"clamp",CLIP_ZERO:"zero",CLIP_PERIODIC:"periodic",CLIP_MIRROR:"mirror",CUBIC_TENSION_DEFAULT:0,CUBIC_TENSION_CATMULL_ROM:0},m={method:i.METHOD_CUBIC,cubicTension:i.CUBIC_TENSION_DEFAULT,clip:i.CLIP_CLAMP,scaleTo:0,sincFilterSize:2,sincWindow:void 0},u=function(O,V){return Math.max(0,Math.min(O,V-1))},p=function(O,V){return O=O%V,O<0&&(O+=V),O},f=function(O,V){var j;return j=2*(V-1),O=p(O,j),O>V-1&&(O=j-O),O},t=function(){function O(V,j){if(this.array=V.slice(0),this.length=this.array.length,!(this.clipHelper={clamp:this.clipHelperClamp,zero:this.clipHelperZero,periodic:this.clipHelperPeriodic,mirror:this.clipHelperMirror}[j.clip]))throw"Invalid clip: "+j.clip}return O.prototype.getClippedInput=function(V){return 0<=V&&V<this.length?this.array[V]:this.clipHelper(V)},O.prototype.clipHelperClamp=function(V){return this.array[u(V,this.length)]},O.prototype.clipHelperZero=function(V){return 0},O.prototype.clipHelperPeriodic=function(V){return this.array[p(V,this.length)]},O.prototype.clipHelperMirror=function(V){return this.array[f(V,this.length)]},O.prototype.interpolate=function(V){throw"Subclasses of AbstractInterpolator must override the interpolate() method."},O}(),o=function(O){Z(V,O);function V(){V.__super__.constructor.apply(this,arguments)}return V.prototype.interpolate=function(j){return this.getClippedInput(Math.round(j))},V}(t),r=function(O){Z(V,O);function V(){V.__super__.constructor.apply(this,arguments)}return V.prototype.interpolate=function(j){var q;return q=Math.floor(j),j-=q,(1-j)*this.getClippedInput(q)+j*this.getClippedInput(q+1)},V}(t),n=function(O){Z(V,O);function V(j,q){this.tangentFactor=1-Math.max(-1,Math.min(1,q.cubicTension)),V.__super__.constructor.apply(this,arguments)}return V.prototype.getTangent=function(j){return this.tangentFactor*(this.getClippedInput(j+1)-this.getClippedInput(j-1))/2},V.prototype.interpolate=function(j){var q,J,se,_e,Re;return q=Math.floor(j),J=[this.getTangent(q),this.getTangent(q+1)],se=[this.getClippedInput(q),this.getClippedInput(q+1)],j-=q,_e=j*j,Re=j*_e,(2*Re-3*_e+1)*se[0]+(Re-2*_e+j)*J[0]+(-2*Re+3*_e)*se[1]+(Re-_e)*J[1]},V}(t),P=Math.sin,a=Math.PI,L=function(O){return O===0?1:P(a*O)/(a*O)},w=function(O){return function(V){return L(V/O)}},E=function(O){return function(V){return L(V)*O(V)}},l=function(O){Z(V,O);function V(j,q){if(V.__super__.constructor.apply(this,arguments),this.a=q.sincFilterSize,!q.sincWindow)throw"No sincWindow provided";this.kernel=E(q.sincWindow)}return V.prototype.interpolate=function(j){var q,J,se,_e,Re;for(q=Math.floor(j),se=0,J=_e=q-this.a+1,Re=q+this.a;_e<=Re?J<=Re:J>=Re;_e<=Re?J++:J--)se+=this.kernel(j-J)*this.getClippedInput(J);return se},V}(t),g=function(O,V){var j,q,J,se;for(se=[],q=0,J=O.length;q<J;q++)j=O[q],se.push(j[V]);return se},S=function(O,V,j){var q,J;return j.join==="0,1"?O:(q=V/(j[1]-j[0]),J=j[0],function(se){return O(q*(se-J))})},v=function(O){return Object.prototype.toString.call(O).slice(8,-1)},R=function(O){if(isNaN(O))throw"NaN in Smooth() input";if(v(O)!=="Number")throw"Non-number in Smooth() input";if(!isFinite(O))throw"Infinity in Smooth() input"},G=function(O,V){var j,q,J;if(v(O)!=="Array")throw"Non-vector in Smooth() input";if(O.length!==V)throw"Inconsistent dimension in Smooth() input";for(q=0,J=O.length;q<J;q++)j=O[q],R(j)},y=function(O){return v(O)==="Number"&&isFinite(O)&&!isNaN(O)},A=function(O){var V;switch(V="scaleTo param must be number or array of two numbers",v(O)){case"Number":if(!y(O))throw V;O=[0,O];break;case"Array":if(O.length!==2||!(y(O[0])&&y(O[1])))throw V;break;default:throw V}return O},C=function(O){var V,j,q;V={};for(j in O)K.call(O,j)&&(q=O[j],V[j]=q);return V},h=function(O,V){var j,q,J,se,_e,Re,ae,ve,oe,Ce,Ie;V==null&&(V={}),oe={},V=C(V),oe.config=C(V),V.scaleTo==null&&(V.scaleTo=V.period),V.sincFilterSize==null&&(V.sincFilterSize=V.lanczosFilterSize);for(ae in m)K.call(m,ae)&&(Ie=m[ae],V[ae]==null&&(V[ae]=Ie));if(!(_e={nearest:o,linear:r,cubic:n,lanczos:l,sinc:l}[V.method]))throw"Invalid method: "+V.method;if(V.method==="lanczos"&&(V.sincWindow=w(V.sincFilterSize)),O.length<2)throw"Array must have at least two elements";oe.count=O.length,Ce=function(){var ke,Ye,$e,et;switch(v(O[0])){case"Number":if(oe.dimension="scalar",h.deepValidation)for(ke=0,$e=O.length;ke<$e;ke++)ve=O[ke],R(ve);return se=new _e(O,V),function(Ke){return se.interpolate(Ke)};case"Array":if(oe.dimension=q=O[0].length,!q)throw"Vectors must be non-empty";if(h.deepValidation)for(Ye=0,et=O.length;Ye<et;Ye++)Ie=O[Ye],G(Ie,q);return Re=function(){var Ke;for(Ke=[],J=0;0<=q?J<q:J>q;0<=q?J++:J--)Ke.push(new _e(g(O,J),V));return Ke}(),function(Ke){var W,Le,Q,he;for(he=[],Le=0,Q=Re.length;Le<Q;Le++)W=Re[Le],he.push(W.interpolate(Ke));return he};default:throw"Invalid element type: "+v(O[0])}}(),V.clip==="periodic"?j=O.length:j=O.length-1,V.scaleTo||(V.scaleTo=j),oe.domain=A(V.scaleTo),Ce=S(Ce,j,oe.domain),oe.domain.sort();for(ae in oe)K.call(oe,ae)&&(Ie=oe[ae],Ce[ae]=Ie);return Ce};for(x in i)K.call(i,x)&&(T=i[x],h[x]=T);h.deepValidation=!0,(e!==null?e:window).Smooth=h}).call(this)},660:function(s,e){var t,n,i;(function(r,o){n=[e],t=o,i=typeof t=="function"?t.apply(e,n):t,i!==void 0&&(s.exports=i)})(this,function(r){function o(N,F,k){for(var ee=(N.byteLength,0),ne=k.length;ne>ee;ee++){var ye=k.charCodeAt(ee);if(128>ye)N.setUint8(F++,ye>>>0&127|0);else if(2048>ye)N.setUint8(F++,ye>>>6&31|192),N.setUint8(F++,ye>>>0&63|128);else if(65536>ye)N.setUint8(F++,ye>>>12&15|224),N.setUint8(F++,ye>>>6&63|128),N.setUint8(F++,ye>>>0&63|128);else{if(!(1114112>ye))throw new Error("bad codepoint "+ye);N.setUint8(F++,ye>>>18&7|240),N.setUint8(F++,ye>>>12&63|128),N.setUint8(F++,ye>>>6&63|128),N.setUint8(F++,ye>>>0&63|128)}}}function a(N){for(var F=0,k=0,ee=N.length;ee>k;k++){var ne=N.charCodeAt(k);if(128>ne)F+=1;else if(2048>ne)F+=2;else if(65536>ne)F+=3;else{if(!(1114112>ne))throw new Error("bad codepoint "+ne);F+=4}}return F}function l(N,F,k){var ee=typeof N;if(ee==="string"){var ne=a(N);if(32>ne)return F.setUint8(k,160|ne),o(F,k+1,N),1+ne;if(256>ne)return F.setUint8(k,217),F.setUint8(k+1,ne),o(F,k+2,N),2+ne;if(65536>ne)return F.setUint8(k,218),F.setUint16(k+1,ne),o(F,k+3,N),3+ne;if(4294967296>ne)return F.setUint8(k,219),F.setUint32(k+1,ne),o(F,k+5,N),5+ne}if(N instanceof Uint8Array){var ne=N.byteLength,ye=new Uint8Array(F.buffer);if(256>ne)return F.setUint8(k,196),F.setUint8(k+1,ne),ye.set(N,k+2),2+ne;if(65536>ne)return F.setUint8(k,197),F.setUint16(k+1,ne),ye.set(N,k+3),3+ne;if(4294967296>ne)return F.setUint8(k,198),F.setUint32(k+1,ne),ye.set(N,k+5),5+ne}if(ee==="number"){if(!isFinite(N))throw new Error("Number not finite: "+N);if(Math.floor(N)!==N)return F.setUint8(k,203),F.setFloat64(k+1,N),9;if(N>=0){if(128>N)return F.setUint8(k,N),1;if(256>N)return F.setUint8(k,204),F.setUint8(k+1,N),2;if(65536>N)return F.setUint8(k,205),F.setUint16(k+1,N),3;if(4294967296>N)return F.setUint8(k,206),F.setUint32(k+1,N),5;throw new Error("Number too big 0x"+N.toString(16))}if(N>=-32)return F.setInt8(k,N),1;if(N>=-128)return F.setUint8(k,208),F.setInt8(k+1,N),2;if(N>=-32768)return F.setUint8(k,209),F.setInt16(k+1,N),3;if(N>=-2147483648)return F.setUint8(k,210),F.setInt32(k+1,N),5;throw new Error("Number too small -0x"+(-N).toString(16).substr(1))}if(N===null)return F.setUint8(k,192),1;if(ee==="boolean")return F.setUint8(k,N?195:194),1;if(ee==="object"){var ne,Ze=0,ue=Array.isArray(N);if(ue)ne=N.length;else{var Ue=Object.keys(N);ne=Ue.length}var Ze;if(16>ne?(F.setUint8(k,ne|(ue?144:128)),Ze=1):65536>ne?(F.setUint8(k,ue?220:222),F.setUint16(k+1,ne),Ze=3):4294967296>ne&&(F.setUint8(k,ue?221:223),F.setUint32(k+1,ne),Ze=5),ue)for(var Y=0;ne>Y;Y++)Ze+=l(N[Y],F,k+Ze);else for(var Y=0;ne>Y;Y++){var Ve=Ue[Y];Ze+=l(Ve,F,k+Ze),Ze+=l(N[Ve],F,k+Ze)}return Ze}throw new Error("Unknown type "+ee)}function h(N){var F=typeof N;if(F==="string"){var k=a(N);if(32>k)return 1+k;if(256>k)return 2+k;if(65536>k)return 3+k;if(4294967296>k)return 5+k}if(N instanceof Uint8Array){var k=N.byteLength;if(256>k)return 2+k;if(65536>k)return 3+k;if(4294967296>k)return 5+k}if(F==="number"){if(Math.floor(N)!==N)return 9;if(N>=0){if(128>N)return 1;if(256>N)return 2;if(65536>N)return 3;if(4294967296>N)return 5;throw new Error("Number too big 0x"+N.toString(16))}if(N>=-32)return 1;if(N>=-128)return 2;if(N>=-32768)return 3;if(N>=-2147483648)return 5;throw new Error("Number too small -0x"+N.toString(16).substr(1))}if(F==="boolean"||N===null)return 1;if(F==="object"){var k,ee=0;if(Array.isArray(N)){k=N.length;for(var ne=0;k>ne;ne++)ee+=h(N[ne])}else{var ye=Object.keys(N);k=ye.length;for(var ne=0;k>ne;ne++){var ue=ye[ne];ee+=h(ue)+h(N[ue])}}if(16>k)return 1+ee;if(65536>k)return 3+ee;if(4294967296>k)return 5+ee;throw new Error("Array or object too long 0x"+k.toString(16))}throw new Error("Unknown type "+F)}function u(N){var F=new ArrayBuffer(h(N)),k=new DataView(F);return l(N,k,0),new Uint8Array(F)}function f(N,F,k){return F?new N(F.buffer,F.byteOffset,F.byteLength/(k||1)):void 0}function p(N){return f(DataView,N)}function m(N){return f(Uint8Array,N)}function g(N){return f(Int8Array,N)}function v(N){return f(Int32Array,N,4)}function y(N){return f(Float32Array,N,4)}function x(N,F){var k=N.length/2;F||(F=new Int16Array(k));for(var ee=0,ne=0;k>ee;++ee,ne+=2)F[ee]=N[ne]<<8^N[ne+1]<<0;return F}function w(N,F){var k=N.length;F||(F=new Uint8Array(2*k));for(var ee=p(F),ne=0;k>ne;++ne)ee.setInt16(2*ne,N[ne]);return m(F)}function S(N,F){var k=N.length/4;F||(F=new Int32Array(k));for(var ee=0,ne=0;k>ee;++ee,ne+=4)F[ee]=N[ne]<<24^N[ne+1]<<16^N[ne+2]<<8^N[ne+3]<<0;return F}function E(N,F){var k=N.length;F||(F=new Uint8Array(4*k));for(var ee=p(F),ne=0;k>ne;++ne)ee.setInt32(4*ne,N[ne]);return m(F)}function A(N,F){var k=N.length;F||(F=new Float32Array(k/4));for(var ee=p(F),ne=p(N),ye=0,ue=0,Ue=k/4;Ue>ye;++ye,ue+=4)ee.setFloat32(ue,ne.getFloat32(ue),!0);return F}function C(N,F,k){var ee=N.length,ne=1/F;k||(k=new Float32Array(ee));for(var ye=0;ee>ye;++ye)k[ye]=N[ye]*ne;return k}function P(N,F,k){var ee=N.length;k||(k=new Int32Array(ee));for(var ne=0;ee>ne;++ne)k[ne]=Math.round(N[ne]*F);return k}function L(N,F){var k,ee;if(!F){var ne=0;for(k=0,ee=N.length;ee>k;k+=2)ne+=N[k+1];F=new N.constructor(ne)}var ye=0;for(k=0,ee=N.length;ee>k;k+=2)for(var ue=N[k],Ue=N[k+1],Ze=0;Ue>Ze;++Ze)F[ye]=ue,++ye;return F}function T(N){if(N.length===0)return new Int32Array;var F,k,ee=2;for(F=1,k=N.length;k>F;++F)N[F-1]!==N[F]&&(ee+=2);var ne=new Int32Array(ee),ye=0,ue=1;for(F=1,k=N.length;k>F;++F)N[F-1]!==N[F]?(ne[ye]=N[F-1],ne[ye+1]=ue,ue=1,ye+=2):++ue;return ne[ye]=N[N.length-1],ne[ye+1]=ue,ne}function R(N,F){var k=N.length;F||(F=new N.constructor(k)),k&&(F[0]=N[0]);for(var ee=1;k>ee;++ee)F[ee]=N[ee]+F[ee-1];return F}function G(N,F){var k=N.length;F||(F=new N.constructor(k)),F[0]=N[0];for(var ee=1;k>ee;++ee)F[ee]=N[ee]-N[ee-1];return F}function K(N,F){var k,ee,ne=N instanceof Int8Array?127:32767,ye=-ne-1,ue=N.length;if(!F){var Ue=0;for(k=0;ue>k;++k)N[k]<ne&&N[k]>ye&&++Ue;F=new Int32Array(Ue)}for(k=0,ee=0;ue>k;){for(var Ze=0;N[k]===ne||N[k]===ye;)Ze+=N[k],++k;Ze+=N[k],++k,F[ee]=Ze,++ee}return F}function Z(N,F){var k,ee=32767,ne=-ee-1,ye=N.length,ue=0;for(k=0;ye>k;++k){var Ue=N[k];Ue===0?++ue:ue+=Ue===ee||Ue===ne?2:Ue>0?Math.ceil(Ue/ee):Math.ceil(Ue/ne)}var Ze=new Int16Array(ue),Y=0;for(k=0;ye>k;++k){var Ue=N[k];if(Ue>=0)for(;Ue>=ee;)Ze[Y]=ee,++Y,Ue-=ee;else for(;ne>=Ue;)Ze[Y]=ne,++Y,Ue-=ne;Ze[Y]=Ue,++Y}return Ze}function O(N,F){return R(L(N),F)}function V(N){return T(G(N))}function j(N,F,k){return C(L(N,v(k)),F,k)}function q(N,F){return T(P(N,F))}function J(N,F,k){return C(R(N,v(k)),F,k)}function se(N,F,k){return G(P(N,F),k)}function _e(N,F,k){return C(K(N,v(k)),F,k)}function Re(N,F,k){var ee=K(N,v(k));return J(ee,F,y(ee))}function ae(N,F,k){return Z(se(N,F))}function ve(ye){var F=p(ye),k=F.getInt32(0),ee=F.getInt32(4),ne=ye.subarray(8,12),ye=ye.subarray(12);return[k,ye,ee,ne]}function oe(N,F,k,ee){var ne=new ArrayBuffer(12+ee.byteLength),ye=new Uint8Array(ne),ue=new DataView(ne);return ue.setInt32(0,N),ue.setInt32(4,F),k&&ye.set(k,8),ye.set(ee,12),ye}function Ce(N){var F=N.length,k=m(N);return oe(2,F,void 0,k)}function Ie(N){var F=N.length,k=E(N);return oe(4,F,void 0,k)}function ke(N,F){var k=N.length/F,ee=E([F]),ne=m(N);return oe(5,k,ee,ne)}function Ye(N){var F=N.length,k=E(T(N));return oe(6,F,void 0,k)}function $e(N){var F=N.length,k=E(V(N));return oe(8,F,void 0,k)}function et(N,F){var k=N.length,ee=E([F]),ne=E(q(N,F));return oe(9,k,ee,ne)}function Ke(N,F){var k=N.length,ee=E([F]),ne=w(ae(N,F));return oe(10,k,ee,ne)}function W(N){var F={};return H.forEach(function(k){N[k]!==void 0&&(F[k]=N[k])}),N.bondAtomList&&(F.bondAtomList=Ie(N.bondAtomList)),N.bondOrderList&&(F.bondOrderList=Ce(N.bondOrderList)),F.xCoordList=Ke(N.xCoordList,1e3),F.yCoordList=Ke(N.yCoordList,1e3),F.zCoordList=Ke(N.zCoordList,1e3),N.bFactorList&&(F.bFactorList=Ke(N.bFactorList,100)),N.atomIdList&&(F.atomIdList=$e(N.atomIdList)),N.altLocList&&(F.altLocList=Ye(N.altLocList)),N.occupancyList&&(F.occupancyList=et(N.occupancyList,100)),F.groupIdList=$e(N.groupIdList),F.groupTypeList=Ie(N.groupTypeList),N.secStructList&&(F.secStructList=Ce(N.secStructList)),N.insCodeList&&(F.insCodeList=Ye(N.insCodeList)),N.sequenceIndexList&&(F.sequenceIndexList=$e(N.sequenceIndexList)),F.chainIdList=ke(N.chainIdList,4),N.chainNameList&&(F.chainNameList=ke(N.chainNameList,4)),F}function Le(N){function F(Ze){for(var Y={},Ve=0;Ze>Ve;Ve++){var me=ye();Y[me]=ye()}return Y}function k(Ze){var Y=N.subarray(ue,ue+Ze);return ue+=Ze,Y}function ee(Ze){var Y=N.subarray(ue,ue+Ze);ue+=Ze;var Ve=65535;if(Ze>Ve){for(var me=[],xe=0;xe<Y.length;xe+=Ve)me.push(String.fromCharCode.apply(null,Y.subarray(xe,xe+Ve)));return me.join("")}return String.fromCharCode.apply(null,Y)}function ne(Ze){for(var Y=new Array(Ze),Ve=0;Ze>Ve;Ve++)Y[Ve]=ye();return Y}function ye(){var Ze,Y,Ve=N[ue];if(!(128&Ve))return ue++,Ve;if((240&Ve)===128)return Y=15&Ve,ue++,F(Y);if((240&Ve)===144)return Y=15&Ve,ue++,ne(Y);if((224&Ve)===160)return Y=31&Ve,ue++,ee(Y);if((224&Ve)===224)return Ze=Ue.getInt8(ue),ue++,Ze;switch(Ve){case 192:return ue++,null;case 194:return ue++,!1;case 195:return ue++,!0;case 196:return Y=Ue.getUint8(ue+1),ue+=2,k(Y);case 197:return Y=Ue.getUint16(ue+1),ue+=3,k(Y);case 198:return Y=Ue.getUint32(ue+1),ue+=5,k(Y);case 202:return Ze=Ue.getFloat32(ue+1),ue+=5,Ze;case 203:return Ze=Ue.getFloat64(ue+1),ue+=9,Ze;case 204:return Ze=N[ue+1],ue+=2,Ze;case 205:return Ze=Ue.getUint16(ue+1),ue+=3,Ze;case 206:return Ze=Ue.getUint32(ue+1),ue+=5,Ze;case 208:return Ze=Ue.getInt8(ue+1),ue+=2,Ze;case 209:return Ze=Ue.getInt16(ue+1),ue+=3,Ze;case 210:return Ze=Ue.getInt32(ue+1),ue+=5,Ze;case 217:return Y=Ue.getUint8(ue+1),ue+=2,ee(Y);case 218:return Y=Ue.getUint16(ue+1),ue+=3,ee(Y);case 219:return Y=Ue.getUint32(ue+1),ue+=5,ee(Y);case 220:return Y=Ue.getUint16(ue+1),ue+=3,ne(Y);case 221:return Y=Ue.getUint32(ue+1),ue+=5,ne(Y);case 222:return Y=Ue.getUint16(ue+1),ue+=3,F(Y);case 223:return Y=Ue.getUint32(ue+1),ue+=5,F(Y)}throw new Error("Unknown type 0x"+Ve.toString(16))}var ue=0,Ue=new DataView(N.buffer);return ye()}function Q(N,F,k,ee){switch(N){case 1:return A(F);case 2:return g(F);case 3:return x(F);case 4:return S(F);case 5:return m(F);case 6:return L(S(F),new Uint8Array(k));case 7:return L(S(F));case 8:return O(S(F));case 9:return j(S(F),S(ee)[0]);case 10:return Re(x(F),S(ee)[0]);case 11:return C(x(F),S(ee)[0]);case 12:return _e(x(F),S(ee)[0]);case 13:return _e(g(F),S(ee)[0]);case 14:return K(x(F));case 15:return K(g(F))}}function he(N,F){F=F||{};var k=F.ignoreFields,ee={};return we.forEach(function(ne){var ye=k?k.indexOf(ne)!==-1:!1,ue=N[ne];ye||ue===void 0||(ue instanceof Uint8Array?ee[ne]=Q.apply(null,ve(ue)):ee[ne]=ue)}),ee}function fe(N){return String.fromCharCode.apply(null,N).replace(/\0/g,"")}function De(N,F,k){k=k||{};var ee,ne,ye,ue,Ue,Ze,Y=k.firstModelOnly,Ve=F.onModel,me=F.onChain,xe=F.onGroup,Pe=F.onAtom,Qe=F.onBond,ie=0,at=0,ce=0,wt=0,be=0,Et=-1,gn=N.chainNameList,Dn=N.secStructList,$n=N.insCodeList,Un=N.sequenceIndexList,Zt=N.atomIdList,wn=N.bFactorList,cr=N.altLocList,Cr=N.occupancyList,Rr=N.bondAtomList,As=N.bondOrderList;for(ee=0,ne=N.chainsPerModel.length;ne>ee&&!(Y&&ie>0);++ee){var z=N.chainsPerModel[ie];for(Ve&&Ve({chainCount:z,modelIndex:ie}),ye=0;z>ye;++ye){var ge=N.groupsPerChain[at];if(me){var Te=fe(N.chainIdList.subarray(4*at,4*at+4)),de=null;gn&&(de=fe(gn.subarray(4*at,4*at+4))),me({groupCount:ge,chainIndex:at,modelIndex:ie,chainId:Te,chainName:de})}for(ue=0;ge>ue;++ue){var Ae=N.groupList[N.groupTypeList[ce]],rt=Ae.atomNameList.length;if(xe){var ut=null;Dn&&(ut=Dn[ce]);var gt=null;N.insCodeList&&(gt=String.fromCharCode($n[ce]));var mt=null;Un&&(mt=Un[ce]),xe({atomCount:rt,groupIndex:ce,chainIndex:at,modelIndex:ie,groupId:N.groupIdList[ce],groupType:N.groupTypeList[ce],groupName:Ae.groupName,singleLetterCode:Ae.singleLetterCode,chemCompType:Ae.chemCompType,secStruct:ut,insCode:gt,sequenceIndex:mt})}for(Ue=0;rt>Ue;++Ue){if(Pe){var Mt=null;Zt&&(Mt=Zt[wt]);var ft=null;wn&&(ft=wn[wt]);var At=null;cr&&(At=String.fromCharCode(cr[wt]));var qt=null;Cr&&(qt=Cr[wt]),Pe({atomIndex:wt,groupIndex:ce,chainIndex:at,modelIndex:ie,atomId:Mt,element:Ae.elementList[Ue],atomName:Ae.atomNameList[Ue],formalCharge:Ae.formalChargeList[Ue],xCoord:N.xCoordList[wt],yCoord:N.yCoordList[wt],zCoord:N.zCoordList[wt],bFactor:ft,altLoc:At,occupancy:qt})}wt+=1}if(Qe){var nn=Ae.bondAtomList;for(Ue=0,Ze=Ae.bondOrderList.length;Ze>Ue;++Ue)Qe({atomIndex1:wt-rt+nn[2*Ue],atomIndex2:wt-rt+nn[2*Ue+1],bondOrder:Ae.bondOrderList[Ue]})}ce+=1}at+=1}if(be=Et+1,Et=wt-1,Qe&&Rr)for(Ue=0,Ze=Rr.length;Ze>Ue;Ue+=2){var Bn=Rr[Ue],Zn=Rr[Ue+1];(Bn>=be&&Et>=Bn||Zn>=be&&Et>=Zn)&&Qe({atomIndex1:Bn,atomIndex2:Zn,bondOrder:As?As[Ue/2]:null})}ie+=1}}function je(N){return u(W(N))}function qe(N,F){N instanceof ArrayBuffer&&(N=new Uint8Array(N));var k;return k=N instanceof Uint8Array?Le(N):N,he(k,F)}function it(N,F,k,ee){function ne(){try{var ue=qe(ye.response);k(ue)}catch(Ue){ee(Ue)}}var ye=new XMLHttpRequest;ye.addEventListener("load",ne,!0),ye.addEventListener("error",ee,!0),ye.responseType="arraybuffer",ye.open("GET",F+N.toUpperCase()),ye.send()}function ot(N,F,k){it(N,Je,F,k)}function _t(N,F,k){it(N,nt,F,k)}var H=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],U=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],we=H.concat(U),We="v1.1.0dev",Ge="//mmtf.rcsb.org/v1.0/",Je=Ge+"full/",nt=Ge+"reduced/";r.encode=je,r.decode=qe,r.traverse=De,r.fetch=ot,r.fetchReduced=_t,r.version=We,r.fetchUrl=Je,r.fetchReducedUrl=nt,r.encodeMsgpack=u,r.encodeMmtf=W,r.decodeMsgpack=Le,r.decodeMmtf=he})}},$v={};function Ai(s){var e=$v[s];if(e!==void 0)return e.exports;var t=$v[s]={exports:{}};return uB[s].call(t.exports,t,t.exports,Ai),t.exports}Ai.n=s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return Ai.d(e,{a:e}),e};Ai.d=(s,e)=>{for(var t in e)Ai.o(e,t)&&!Ai.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})};Ai.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);var xM={};Ai.d(xM,{A:()=>y9});var dB=s=>{var e={};return Ai.d(e,s),e};const Me=dB({default:()=>tI}),b=hB;var Qd=function(){return Qd=Object.assign||function(s){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])}return s},Qd.apply(this,arguments)},fB={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",fadeColor:"transparent",animation:"spinner-line-fade-default",rotate:0,direction:1,speed:1,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:"0 0 1px transparent",position:"absolute"},pB=function(){function s(e){e===void 0&&(e={}),this.opts=Qd(Qd({},fB),e)}return s.prototype.spin=function(e){return this.stop(),this.el=document.createElement("div"),this.el.className=this.opts.className,this.el.setAttribute("role","progressbar"),this.el.style.position=this.opts.position,this.el.style.width="0",this.el.style.zIndex=this.opts.zIndex.toString(),this.el.style.left=this.opts.left,this.el.style.top=this.opts.top,this.el.style.transform="scale(".concat(this.opts.scale,")"),e&&e.insertBefore(this.el,e.firstChild||null),mB(this.el,this.opts),this},s.prototype.stop=function(){return this.el&&(this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},s}();function Zv(s,e){return typeof s=="string"?s:s[e%s.length]}function mB(s,e){var t=Math.round(e.corners*e.width*500)/1e3+"px",n="none";e.shadow===!0?n="0 2px 4px #000":typeof e.shadow=="string"&&(n=e.shadow);for(var i=gB(n),r=0;r<e.lines;r++){var o=~~(360/e.lines*r+e.rotate),a=document.createElement("div");a.style.position="absolute",a.style.top="".concat(-e.width/2,"px"),a.style.width=e.length+e.width+"px",a.style.height=e.width+"px",a.style.background=Zv(e.fadeColor,r),a.style.borderRadius=t,a.style.transformOrigin="left",a.style.transform="rotate(".concat(o,"deg) translateX(").concat(e.radius,"px)");var l=r*e.direction/e.lines/e.speed;l-=1/e.speed;var h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.background=Zv(e.color,r),h.style.borderRadius=t,h.style.boxShadow=_B(i,o),h.style.animation="".concat(1/e.speed,"s linear ").concat(l,"s infinite ").concat(e.animation),a.appendChild(h),s.appendChild(a)}}function gB(s){for(var e=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,t=[],n=0,i=s.split(",");n<i.length;n++){var r=i[n],o=r.match(e);if(o!==null){var a=+o[2],l=+o[5],h=o[4],u=o[7];a===0&&!h&&(h=u),l===0&&!u&&(u=h),h===u&&t.push({prefix:o[1]||"",x:a,y:l,xUnits:h,yUnits:u,end:o[8]})}}return t}function _B(s,e){for(var t=[],n=0,i=s;n<i.length;n++){var r=i[n],o=xB(r.x,r.y,e);t.push(r.prefix+o[0]+r.xUnits+" "+o[1]+r.yUnits+r.end)}return t.join(", ")}function xB(s,e,t){var n=t*Math.PI/180,i=Math.sin(n),r=Math.cos(n);return[Math.round((s*r+e*i)*1e3)/1e3,Math.round((-s*i+e*r)*1e3)/1e3]}class Qo{constructor(){this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Qo.now(),this.oldTime=this.startTime,this.running=!0}stop(){this.getElapsedTime(),this.running=!1}getElapsedTime(){return this.update(),this.elapsedTime}update(){let e=0;if(this.running){const t=Qo.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}}Qo.now=function(){const s=typeof window<"u"&&window.performance;return s&&s.now?s.now.bind(s):Date.now}();const{now:Kv}=Qo;function Jv(s,e,t){const n=document.createElement(s);return n.id=e,n.style.cssText=t,n}class yB{constructor(){this.domElement=Jv("div","stats","padding:8px"),this._text=Jv("p","fps","margin:0;color:silver;font-size:large"),this.domElement.appendChild(this._text),this._startTime=Kv(),this._prevTime=this._startTime,this._deltas=new Array(20),this._index=0,this._total=0,this._count=0}end(){const e=Kv(),t=e-this._startTime;return this._count<this._deltas.length?this._count++:this._total-=this._deltas[this._index],this._total+=t,this._deltas[this._index]=t,this._index=(this._index+1)%this._deltas.length,this.ms=this._total/this._count,this.fps=1e3/this.ms,e>this._prevTime+1e3&&(this._text.textContent=this.fps.toPrecision(2),this._prevTime=e),e}update(){this._startTime=this.end()}show(e){e===void 0&&(e=!0),this.domElement.style.display=e?"block":"none"}}const vB=yB;function Fm(s,e){return!s||s===e}function Rf(){this._handlers={}}Rf.prototype.addEventListener=function(s,e,t){let n=this._handlers[s];n||(this._handlers[s]=[],n=this._handlers[s]);const i=[e,t];function r(o){return o[0]===i[0]&&o[1]===i[1]}Me.default.find(n,r)===void 0&&n.push(i)};Rf.prototype.removeEventListener=function(s,e,t){const n=this;Me.default.forEach(n._handlers,(i,r)=>{Me.default.remove(i,o=>Fm(s,r)&&Fm(e,o[0])&&Fm(t,o[1]||n))}),this._handlers=Me.default.omitBy(n._handlers,i=>i.length===0)};Rf.prototype.dispatchEvent=function(s){const e=this;Me.default.forEach(this._handlers[s.type],t=>{const n=t[1]||e;t[0].apply(n,[s])})};const Yi=Rf,Sr={debug:0,info:1,report:2,warn:3,error:4};function fi(){Yi.call(this),this.console=!1,this._priority=Sr.warn}fi.prototype=Object.create(Yi.prototype);fi.prototype.constructor=fi;fi.prototype.instantiate=function(){return new fi};function yM(s){if(!Me.default.isNumber(s))throw new Error("Wrong log level specified!");return s}Object.defineProperty(fi.prototype,"level",{get(){return Me.default.findKey(Sr,s=>s===this._priority)},set(s){this._priority=yM(Sr[s])}});fi.prototype.levels=function(){return Object.keys(Sr)};fi.prototype.message=function(s,e){const t=yM(Sr[s]);this._message(t,e)};fi.prototype.debug=function(s){this._message(Sr.debug,s)};fi.prototype.info=function(s){this._message(Sr.info,s)};fi.prototype.report=function(s){this._message(Sr.report,s)};fi.prototype.warn=function(s){this._message(Sr.warn,s)};fi.prototype.error=function(s){this._message(Sr.error,s)};fi.prototype._message=function(s,e){if(s<this._priority)return;const t=Me.default.findKey(Sr,n=>n===s);if(e=String(e),this.console){const n=`miew:${t}: ${e}`;t==="error"?console.error(n):t==="warn"?console.warn(n):console.log(n)}this.dispatchEvent({type:"message",level:t,message:e})};const In=new fi,Z0={DEFAULT:0,SAFARI:1};function SB(s,e){const t=n=>String.fromCharCode(parseInt(n.substr(1),16));return encodeURIComponent(s).replace(e,t).replace(/%20/g,"+")}function K0(s){return decodeURIComponent(s.replace(/\+/g," "))}function vM(s){s=s||window.location.search;const e=s.substring(s.indexOf("?")+1),t=/([^&=]+)=?([^&]*)/g,n=[];let i;for(;(i=t.exec(e))!==null;)n.push([K0(i[1]),K0(i[2])]);return n}function bB(s){const e={},t=vM(s);for(let n=0;n<t.length;++n){const[i,r]=t[n];e[i]=r}return e}function wB(s){if(typeof URL<"u")try{return typeof window<"u"?new URL(s,window.location).href:new URL(s).href}catch{}if(typeof document<"u"){const e=document.createElement("a");return e.href=s,e.href}return s}function MB(s){const e=[];for(let n=0,i=s.length;n<i;++n)e[e.length]=s[n].charCodeAt(0).toString(16);const t=e.join("|");return new RegExp(`%(?:${t})`,"gi")}function EB(s,e,t){const n=document.createElement(s);let i,r;if(e){const o=Object.keys(e);for(i=0,r=o.length;i<r;++i){const a=o[i];n.setAttribute(a,e[a])}}if(t)for(t instanceof Array||(t=[t]),i=0,r=t.length;i<r;++i){const o=t[i];typeof o=="string"?n.appendChild(document.createTextNode(o)):o instanceof HTMLElement&&n.appendChild(o)}return n}function AB(s,e,t,n){return s.prototype=Me.default.assign(Object.create(e.prototype),{constructor:s},t),n&&Me.default.assign(s,n),s}function J0(s,e){let t=s,n,i;if(s instanceof Array)for(t=new Array(s.length),n=0,i=s.length;n<i;++n)t[n]=J0(s[n]);else if(s instanceof Object){t=Object.create(s);const r=Object.keys(s);for(n=0,i=r.length;n<i;++n){const o=r[n],a=s[o],l=J0(a);l!==a&&(t[o]=l)}e&&Object.keys(t).length>0&&(t=Object.create(t))}return t}function TB(s){return`#${`0000000${s.toString(16)}`.substr(-6)}`}function s_(s){let e=!1;this.enable=function(r){e=r};let t=0;const n=Object.keys(s);function i(r,o){return function(){const a=s_.spaces.substr(0,t*2);e&&In.debug(`${a+o} {`),t++;for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];const f=r.apply(this,h);return t--,e&&In.debug(`${a}} // ${o}`),f}}for(let r=0,o=n.length;r<o;++r){const a=n[r],l=s[a];l instanceof Function&&a!=="constructor"&&(s[a]=i(l,a))}}s_.spaces="                                                                                          ";class SM extends Error{constructor(e){super(),this.name="OutOfMemoryError",this.message=e}}function CB(s,e){let t=null;try{t=new s(e)}catch(n){throw n instanceof RangeError?new SM(n.message):n}return t}function bM(s){const e=new Uint8Array(s);let t="";for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return window.btoa(t)}function o_(s){const e=window.atob(s),t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)t[n]=e[n].charCodeAt(0);return t.buffer}function RB(s,e){return bM(new e(s).buffer)}function PB(s,e){return Array.prototype.slice.call(new e(o_(s)))}function IB(s,e){const t=[];if(e&&s){const n=Object.keys(s);for(let i=0;i<n.length;++i){const r=n[i],o=s[r];!(o instanceof Object)&&typeof e[r]<"u"&&e[r]!==o&&t.push(`${r}:${o}`)}if(t.length>0)return`!${t.join()}`}return""}function Q0(s){if(Me.default.isPlainObject(s))return!0;const e=s&&Object.getPrototypeOf(s);return!!e&&!e.hasOwnProperty("constructor")&&Q0(e)}function wM(s,e){const t={};return Me.default.forIn(s,(n,i)=>{const r=e[i];if(Q0(n)&&Q0(r)){const o=wM(n,r);Me.default.isEmpty(o)||(t[i]=o)}else Me.default.isEqual(n,r)||(t[i]=n)}),t}function LB(s,e){function t(n,i){Me.default.forIn(n,(r,o)=>{const a=i+(i.length>0?".":"");r instanceof Object?t(r,a+o):r!==void 0&&e(r,a+o)})}t(s,"")}function NB(s){return Me.default.isString(s)?`"${s.replace(/"/g,'\\"')}"`:s}function FB(s){if(!Me.default.isString(s))return s;if(s[0]==='"'&&s[s.length-1]==='"')return s=s.slice(1,s.length-1),s.replace(/\\"/g,'"');if(s[0]==="'"&&s[s.length-1]==="'")return s=s.slice(1,s.length-1),s.replace(/\\'/g,"'");throw new SyntaxError("Incorrect string format, can't unqute it")}function MM(s){return s.slice(Math.max(0,s.lastIndexOf("."))||1/0)}function OB(s){const e=MM(s);return[s.slice(0,s.length-e.length),e]}function Qv(s){const e=s.split(/[:;,]/),t=e.length;return t>=3&&e[t-2]==="base64"?new Blob([o_(e[t-1])]):null}function DB(){return navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&navigator.userAgent.indexOf("CriOS")===-1&&navigator.userAgent.indexOf("FxiOS")===-1?Z0.SAFARI:Z0.DEFAULT}function UB(s){typeof window<"u"&&window.open().document.write(`<body style="margin:0"><img src="${s}" /></body>`)}function BB(s,e){if(!(!s||s.substr(0,5)!=="data:")){if(e||(e=["screenshot-",+new Date,".png"].join("")),typeof window<"u"&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(Qv(s),e);else if(typeof document<"u"){const t=document.createElement("a");t.download=e,t.innerHTML="download",t.href=window.URL.createObjectURL(Qv(s)),document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}function zB(s,e,t){const n=new Blob([s]);if(e||(e=["data",+new Date].join("")),t?e+=`.${t}`:e+=n.type||".bin",typeof window<"u"&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(n,e);else if(typeof document<"u"){const i=document.createElement("a");i.download=e,i.innerHTML="download",i.href=window.URL.createObjectURL(n),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}function VB(s,e,t,n){for(let i=0,r=t.length;i<r;++i)for(let o=0;o<n;++o)e[i*n+o]=s[t[i]*n+o]}function kB(s){const e=s.cloneNode(!0);return e.worldPos=s.worldPos,e}const GB=/^[a-zA-Z0-9_]*$/,eS=['"',"",'"'];function HB(s){return GB.test(s)?s:(eS[1]=s,eS.join(""))}function WB(s,e){const t=new s.constructor(s.length+e.length);return t.set(s),t.set(e,s.length),t}function XB(s){if(s.length<=0)return null;const e=s.reduce((n,i)=>n+i.length,0),t=new s[0].constructor(e);for(let n=0,i=0;n<s.length;n++){const r=s[n].length;t.set(s[n],i),i+=r}return t}const Oe={browserType:Z0,encodeQueryComponent:SB,decodeQueryComponent:K0,getUrlParameters:vM,getUrlParametersAsDict:bB,resolveURL:wB,generateRegExp:MB,createElement:EB,deriveClass:AB,deriveDeep:J0,hexColor:TB,DebugTracer:s_,OutOfMemoryError:SM,allocateTyped:CB,bytesFromBase64:o_,bytesToBase64:bM,arrayFromBase64:PB,arrayToBase64:RB,compareOptionsWithDefaults:IB,objectsDiff:wM,forInRecursive:LB,enquoteString:NB,unquoteString:FB,getBrowser:DB,shotOpen:UB,shotDownload:BB,copySubArrays:VB,shallowCloneNode:kB,correctSelectorIdentifier:HB,getFileExtension:MM,splitFileName:OB,download:zB,concatTypedArraysUnsafe:WB,mergeTypedArraysUnsafe:XB};class YB extends Yi{constructor(){super(),this._shouldCancel=!1}cancel(){this._shouldCancel=!0,this.dispatchEvent({type:"cancel"})}shouldCancel(){return this._shouldCancel}notify(e){this.dispatchEvent({type:"notification",slaveEvent:e})}}const tS=0,vc={modes:{BS:{atom:.23,bond:.15,space:.5,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},VW:{polyComplexity:{poor:4,low:6,medium:8,high:16,ultra:32}},LN:{multibond:!0,showarom:!0,offsarom:.2,chunkarom:10,atom:.23,lineWidth:2},LC:{bond:.2,space:0,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},SA:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},SE:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},QS:{isoValue:.5,gaussLim:{poor:1.5,low:2,medium:2.5,high:3,ultra:4},scale:1,wireframe:!1,gridSpacing:{poor:2,low:1.5,medium:1,high:.5,ultra:.25},subset:"",zClip:!1},CS:{probeRadius:1.4,isoValue:1.5,wireframe:!1,probePositions:30,polyComplexity:{poor:.5,low:1,medium:1.5,high:1.75,ultra:2},subset:"",zClip:!1},TR:{radius:.3,polyComplexity:{poor:12,low:16,medium:32,high:64,ultra:64}},TU:{radius:.3,heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},CA:{radius:.3,depth:.25,ss:{helix:{width:1,arrow:2},strand:{width:1,arrow:2}},heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},TX:{template:"{{Chain}}.{{Residue}}{{Sequence}}.{{Name}}",horizontalAlign:"center",verticalAlign:"middle",dx:0,dy:0,dz:1,fg:"none",bg:"0x202020",showBg:!0},VD:{kSigma:1,kSigmaMed:2,kSigmaMax:4,frame:!0,isoMode:!1,polyComplexity:{poor:2,low:3,medium:4,high:8,ultra:10}}},colorers:{EL:{carbon:-1},UN:{color:16777215},CO:{subset:"charged",color:16711680,baseColor:16777215},CB:{color:9474192,factor:.6},SQ:{gradient:"rainbow"},TM:{gradient:"temp",min:5,max:40},OC:{gradient:"reds"},HY:{gradient:"blue-red"},MO:{gradient:"rainbow"}},antialias:!0,camFov:45,camNear:.5,camFar:100,camDistance:2.5,radiusToFit:1,fogNearFactor:.5,fogFarFactor:1,fogAlpha:1,fogColor:0,fogColorEnable:!1,palette:"JM",resolution:"medium",autoResolution:!1,autoPreset:!0,preset:"default",presets:{default:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],empty:[],wire:[{mode:"LN",colorer:"EL",selector:"all",material:"SF"}],small:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],macro:[{mode:"CA",colorer:"SS",selector:"not hetatm",material:"SF"},{mode:"BS",colorer:"EL",selector:"hetatm and not water",material:"SF"}]},objects:{line:{color:4294967295,dashSize:.3,gapSize:.05}},bg:{color:2105376,transparent:!1},draft:{clipPlane:!1,clipPlaneFactor:.5,clipPlaneSpeed:3e-5},plugins:{},axes:!0,fog:!0,fps:!0,zSprites:!0,isoSurfaceFakeOpacity:!0,suspendRender:!0,nowater:!1,autobuild:!0,fxaa:!0,outline:{on:!1,color:0,threshold:.1,thickness:1},ao:!1,shadow:{on:!1,type:"random",radius:1},autoRotation:0,maxfps:30,fbxprec:4,autoRotationAxisFixed:!0,zooming:!0,picking:!0,pick:"atom",editing:!1,aromatic:!1,singleUnit:!0,stereo:"NONE",interpolateViews:!0,transparency:"prepass",translationSpeed:2,debug:{example:3.5,text:"hello!",good:!0,ssaoKernelRadius:.7,ssaoFactor:.7,stereoBarrel:.25},use:{multiFile:!1}};function EM(){Yi.call(this),this.old=null,this.now={},this._changed={},this.reset()}Oe.deriveClass(EM,Yi,{defaults:vc,set(s,e){if(Me.default.isString(s))Me.default.get(this.now,s)!==e&&(Me.default.set(this.now,s,e),this._notifyChange(s,e));else{const t=Oe.objectsDiff(s,this.now);Me.default.isEmpty(t)||(Me.default.merge(this.now,t),this._notifyChanges(t))}},get(s,e){return Me.default.get(this.now,s,e)},reset(){const s=Oe.objectsDiff(vc,this.now);this.now=Me.default.cloneDeep(vc),this.old=null,this._notifyChanges(s),this._changed={}},checkpoint(){this.old=Me.default.cloneDeep(this.now),this._changed={}},_notifyChange(s,e){this._changed[s]=!0,this.dispatchEvent({type:`change:${s}`,value:e})},_notifyChanges(s){Oe.forInRecursive(s,(e,t)=>{this._notifyChange(t,e)})},changed(){if(!this.old)return[];const{old:s,now:e}=this;return Me.default.filter(Object.keys(this._changed),n=>Me.default.get(s,n)!==Me.default.get(e,n))},applyDiffs(s){if(s.hasOwnProperty("VERSION")&&s.VERSION!==tS)throw new Error("Settings version does not match!");delete s.VERSION,this.reset(),this.set(s)},getDiffs(s){const e=Oe.objectsDiff(this.now,vc);return s&&(e.VERSION=tS),e},setPluginOpts(s,e){vc.plugins[s]=Me.default.cloneDeep(e),this.now.plugins[s]=Me.default.cloneDeep(e)}});const pe=new EM;let Yn=0;function AM(s){return!(!s||s==="0"||Me.default.isString(s)&&s.toLowerCase()==="false")}const a_={string:String,number:Number,boolean:AM},jB="=",l_="!",TM=":",CM=",",RM="$;@/?";function qB(){return Oe.generateRegExp(RM+":,")}function $B(){return Oe.generateRegExp(RM+" ")}const ZB=qB();function nS(s){return Oe.encodeQueryComponent(s,ZB)}const KB=$B();function iS(s){return Oe.encodeQueryComponent(s,KB)}function Xd(s){let{reps:e}=s;if(!e){const{presets:t}=pe.now;let n=s.preset||pe.now.preset;e=t[n],e||(In.warn(`Unknown preset "${n}"`),[n]=Object.keys(t),e=t[n]),s.preset=n,s.reps=Oe.deriveDeep(e,!0)}}function gd(s,e,t){Xd(s);const n=s.reps[Yn];n.hasOwnProperty(e)&&(Yn=s.reps.length,s.reps[Yn]=Oe.deriveDeep(n,!0)),t!==void 0&&(s.reps[Yn][e]=t)}function JB(s,e,t){s._objects===void 0&&(s._objects=[]);const[n,i]=t,r={type:n,params:e};i!==void 0&&(r.opts=i),s._objects[s._objects.length]=r}function QB(s,e){const t=s.indexOf(",");return t>=0?(e.push(s.substr(t+1).split(",")),s.substr(0,t)):s}function _d(s,e,t){if(s){const n=s.indexOf(l_),i=QB(s.substr(0,n>=0?n:void 0),t);if(n>=0){const r=s.substr(n+1).split(CM);if(s=i,e){const o=e[s],a=Oe.deriveDeep(o,!0);r.forEach(l=>{const h=l.split(TM,2),u=decodeURIComponent(h[0]),f=decodeURIComponent(h[1]),p=a_[typeof Me.default.get(o,u)];p?Me.default.set(a,u,p(f)):In.warn(`Unknown argument "${u}" for option "${s}"`)}),Object.keys(a).length>0&&(s=[s,a])}}else s=i}return s}const rS={l:"load",load:String,t:"type",type:String,v:"view",view:String,u:"unit",unit:Number,menu:AM,o:"object",object(s,e){const t=[];let n=_d(s,pe.defaults.objects,t);Array.isArray(n)||(n=[n]),JB(e,t[0],n)},p:"preset",preset(s,e){e.preset=s,e.reps=null,Xd(e)},r:"rep",rep(s,e){Xd(e),Yn=Number(s),Yn=Yn<=e.reps.length?Yn<0?0:Yn:e.reps.length,Yn===e.reps.length&&(e.reps[Yn]=Yn>0?Oe.deriveDeep(e.reps[Yn-1],!0):Oe.deriveDeep(pe.defaults.presets.default[0],!0))},s:"select",select(s,e){gd(e,"selector",s)},m:"mode",mode(s,e){gd(e,"mode",_d(s,pe.defaults.modes))},c:"color",color(s,e){gd(e,"colorer",_d(s,pe.defaults.colorers))},mt:"material",material(s,e){gd(e,"material",_d(s,pe.defaults.materials))},dup(s,e){Xd(e);const{reps:t}=e,n=t[Yn];Yn=t.length,t[Yn]=Oe.deriveDeep(n,!0)},ar:"autoResolution"};function PM(s){Yn=0;const e={};for(let t=0,n=s.length;t<n;++t){const i=s[t];let r=i[0];const o=i[1];let a=rS[r];for(;Me.default.isString(a);)r=a,a=rS[r];if(a){if(Me.default.isFunction(a)){const l=a(o,e);l!==void 0&&(e[r]=l)}}else{const l=a_[typeof Me.default.get(pe.defaults,r)];l?Me.default.set(e,`settings.${r}`,l(o)):In.warn(`Unknown option "${r}"`)}}return e}function e5(s){return PM(Oe.getUrlParameters(`?${s||""}`))}function t5(s){return PM(Oe.getUrlParameters(s))}function IM(s){const e=[];let t=0;return Oe.forInRecursive(s,(n,i)=>{e[t++]=iS(i)+TM+iS(n)}),e.join(CM)}function Om(s){return Me.default.isArray(s)?s.length<2?s[0]:`${s[0]}${l_}${IM(s[1])}`:s}function n5(s){if(!s||!s.type)return;let e=s.type;return Me.default.isArray(s.params)&&s.params.length>0&&(e+=`,${s.params.join(",")}`),s.opts&&(e+=l_+IM(s.opts)),e}function i5(s){const e=[];let t=0;function n(a,l){l!=null&&(e[t++]=nS(a)+jB+nS(l))}function i(a){if(a)for(let l=0,h=a.length;l<h;++l)Me.default.isEmpty(a[l])||(n("r",l),n("s",a[l].selector),n("m",Om(a[l].mode)),n("c",Om(a[l].colorer)),n("mt",Om(a[l].material)))}function r(a){if(a)for(let l=0,h=a.length;l<h;++l)n("o",n5(a[l]))}n("l",s.load),n("u",s.unit),n("p",s.preset),i(s.reps),r(s._objects),n("v",s.view),Oe.forInRecursive(s.settings,(a,l)=>{l!=="preset"&&n(l,a)});let o="";if(typeof window<"u"){const{location:a}=window;o=`${a.protocol}//${a.host}${a.pathname}`}return e.length>0&&(o+=`?${e.join("&")}`),o}function LM(s){const e=[];let t=0;return Oe.forInRecursive(s,(n,i)=>{e[t++]=`${i}=${Oe.enquoteString(n)}`}),e.join(" ")}function Dm(s){return Me.default.isArray(s)?s.length<2?s[0]:`${s[0]} ${LM(s[1])}`:s}function r5(s){if(!s||!s.type)return;let e=s.type;return Me.default.isArray(s.params)&&s.params.length>0&&(e+=` ${s.params.map(Oe.enquoteString).join(" ")}`),s.opts&&(e+=` ${LM(s.opts)}`),e}function s5(s,e){const t=[];let n=0;function i(r,o){o!=null&&(t[n++]=r+o)}return Me.default.isEmpty(s)?null:(i("",e),i("s=",Oe.enquoteString(s.selector)),i("m=",Dm(s.mode)),i("c=",Dm(s.colorer)),i("mt=",Dm(s.material)),t.join(" "))}function o5(s){const e=[];let t=0;function n(o,a,l){if(a!=null){const h=typeof a=="string"&&l?'"':"";e[t++]=`${o} ${h}${a}${h}`.trim()}}function i(o){if(o)for(let a=0,l=o.length;a<l;++a)n("rep",s5(o[a],a))}function r(o){if(o)for(let a=0,l=o.length;a<l;++a)n("",r5(o[a]))}return n("set","autobuild false"),n("load",s.load,!0),n("unit",s.unit),n("preset",s.preset),i(s.reps),r(s._objects),Oe.forInRecursive(s.settings,(o,a)=>{a!=="preset"&&n(`set ${a}`,o,!0)}),n("view",s.view),n("set","autobuild true"),e.join(`
`)}const c_={fromURL:t5,fromAttr:e5,adapters:a_,toURL:i5,toScript:o5},Bc=class Bc{constructor(e,t,n,i,r,o,a,l,h,u,f){this.index=-1,this.residue=e,this.name=t,this.element=n,this.position=i,this.role=r,this.mask=1,this.het=o,this.serial=a,this.location=(l||" ").charCodeAt(0),this.occupancy=h||1,this.temperature=u,this.charge=f,this.hydrogenCount=-1,this.radicalCount=0,this.valence=-1,this.bonds=[],this.flags=0,n.name==="H"?this.flags|=Bc.Flags.HYDROGEN:n.name==="C"&&(this.flags|=Bc.Flags.CARBON)}isHet(){return this.het}isHydrogen(){return this.element.number===1}getVisualName(){const{name:e}=this;return e.length>0?e:this.element.name.trim()}forEachBond(e){const{bonds:t}=this;for(let n=0,i=t.length;n<i;++n)e(t[n])}getFullName(){let e="";return this.residue!==null&&(this.residue._chain!==null&&(e+=`${this.residue._chain.getName()}.`),e+=`${this.residue._sequence}.`),e+=this.name,e}};lt(Bc,"Flags",{CARBON:1,HYDROGEN:8,NONPOLARH:4104});let eg=Bc;const Vr=eg,Fe=class Fe{constructor(e,t,n,i,r,o,a){this.number=e,this.name=t,this.fullName=n,this.weight=i,this.radius=r,this.radiusBonding=o,this.hydrogenValency=a}};lt(Fe,"Constants",{U1:1,Lead:2,U2:3,Wing:4,U18:18}),lt(Fe,"Role",{N:Fe.Constants.U1,CA:Fe.Constants.Lead,C:Fe.Constants.U2,O:Fe.Constants.Wing,SG:Fe.Constants.U18}),lt(Fe,"ByAtomicNumber",[null,new Fe(1,"H","Hydrogen",1.008,1.2,.23,[1]),new Fe(2,"HE","Helium",4.003,1.4,.93,[0]),new Fe(3,"LI","Lithium",6.941,1.82,.68,[1]),new Fe(4,"BE","Beryllium",9.012,1.7,.35,[2]),new Fe(5,"B","Boron",10.81,2.08,.83,[3]),new Fe(6,"C","Carbon",12.011,1.95,.68,[4]),new Fe(7,"N","Nitrogen",14.007,1.85,.68,[3,5]),new Fe(8,"O","Oxygen",15.999,1.7,.68,[2,4]),new Fe(9,"F","Fluorine",18.998,1.73,.64,[1]),new Fe(10,"NE","Neon",20.18,1.54,1.12,[0]),new Fe(11,"NA","Sodium",22.99,2.27,.97,[1]),new Fe(12,"MG","Magnesium",24.305,1.73,1.1,[2]),new Fe(13,"AL","Aluminum",26.981,2.05,1.35,[3]),new Fe(14,"SI","Silicon",28.086,2.1,1.2,[4]),new Fe(15,"P","Phosphorus",30.974,2.08,.75,[3,5]),new Fe(16,"S","Sulfur",32.07,2,1.02,[2,4,6]),new Fe(17,"CL","Chlorine",35.453,1.97,.99,[1,3,5,7]),new Fe(18,"AR","Argon",39.948,1.88,1.57,[0]),new Fe(19,"K","Potassium",39.1,2.75,1.33,[1]),new Fe(20,"CA","Calcium",40.08,1.973,.99,[2]),new Fe(21,"SC","Scandium",44.956,1.7,1.44,[0]),new Fe(22,"TI","Titanium",47.88,1.7,1.47,[0]),new Fe(23,"V","Vanadium",50.941,1.7,1.33,[0]),new Fe(24,"CR","Chromium",52,1.7,1.35,[0]),new Fe(25,"MN","Manganese",54.938,1.7,1.35,[0]),new Fe(26,"FE","Iron",55.847,1.7,1.34,[0]),new Fe(27,"CO","Cobalt",58.93,1.7,1.33,[0]),new Fe(28,"NI","Nickel",58.69,1.63,1.5,[0]),new Fe(29,"CU","Copper",63.55,1.4,1.52,[0]),new Fe(30,"ZN","Zinc",65.39,1.39,1.45,[0]),new Fe(31,"GA","Gallium",69.72,1.87,1.22,[3]),new Fe(32,"GE","Germanium",72.61,1.7,1.17,[4]),new Fe(33,"AS","Arsenic",74.92,1.85,1.21,[3,5]),new Fe(34,"SE","Selenium",78.96,1.9,1.22,[2,4,6]),new Fe(35,"BR","Bromine",79.9,2.1,1.21,[1,3,5,7]),new Fe(36,"KR","Krypton",83.8,2.02,1.91,[0]),new Fe(37,"RB","Rubidium",85.47,1.7,1.47,[1]),new Fe(38,"SR","Strontium",87.62,1.7,1.12,[2]),new Fe(39,"Y","Yttrium",88.91,1.7,1.78,[0]),new Fe(40,"ZR","Zirconium",91.22,1.7,1.56,[0]),new Fe(41,"NB","Niobium",92.91,1.7,1.48,[0]),new Fe(42,"MO","Molybdenum",95.94,1.7,1.47,[0]),new Fe(43,"TC","Technetium",98.91,1.7,1.35,[0]),new Fe(44,"RU","Ruthenium",101.07,1.7,1.4,[0]),new Fe(45,"RH","Rhodium",102.91,1.7,1.45,[0]),new Fe(46,"PD","Palladium",106.42,1.63,1.5,[0]),new Fe(47,"AG","Silver",107.87,1.72,1.59,[0]),new Fe(48,"CD","Cadmium",112.41,1.58,1.69,[0]),new Fe(49,"IN","Indium",114.82,1.93,1.63,[3]),new Fe(50,"SN","Tin",118.71,2.17,1.46,[2,4]),new Fe(51,"SB","Antimony",121.75,2.2,1.46,[3,5]),new Fe(52,"TE","Tellurium",127.6,2.06,1.47,[2,4,6]),new Fe(53,"I","Iodine",126.91,2.15,1.4,[1,3,5,7]),new Fe(54,"XE","Xenon",131.29,2.16,1.98,[0]),new Fe(55,"CS","Cesium",132.91,1.7,1.67,[1]),new Fe(56,"BA","Barium",137.33,1.7,1.34,[2]),new Fe(57,"LA","Lanthanum",138.91,1.7,1.87,[0]),new Fe(58,"CE","Cerium",140.12,1.7,1.83,[0]),new Fe(59,"PR","Praseodymium",140.91,1.7,1.82,[0]),new Fe(60,"ND","Neodymium",144.24,1.7,1.81,[0]),new Fe(61,"PM","Promethium",144.9,1.7,1.8,[0]),new Fe(62,"SM","Samarium",150.36,1.7,1.8,[0]),new Fe(63,"EU","Europium",151.96,1.7,1.99,[0]),new Fe(64,"GD","Gadolinium",157.25,1.7,1.79,[0]),new Fe(65,"TB","Terbium",158.93,1.7,1.76,[0]),new Fe(66,"DY","Dysprosium",162.5,1.7,1.75,[0]),new Fe(67,"HO","Holmium",164.93,1.7,1.74,[0]),new Fe(68,"ER","Erbium",167.26,1.7,1.73,[0]),new Fe(69,"TM","Thulium",168.93,1.7,1.72,[0]),new Fe(70,"YB","Ytterbium",173.04,1.7,1.94,[0]),new Fe(71,"LU","Lutetium",174.97,1.7,1.72,[0]),new Fe(72,"HF","Hafnium",178.49,1.7,1.57,[0]),new Fe(73,"TA","Tantalum",180.95,1.7,1.43,[0]),new Fe(74,"W","Tungsten",183.85,1.7,1.37,[0]),new Fe(75,"RE","Rhenium",186.21,1.7,1.35,[0]),new Fe(76,"OS","Osmium",190.2,1.7,1.37,[0]),new Fe(77,"IR","Iridium",192.22,1.7,1.32,[0]),new Fe(78,"PT","Platinum",195.08,1.72,1.5,[0]),new Fe(79,"AU","Gold",196.97,1.66,1.5,[0]),new Fe(80,"HG","Mercury",200.59,1.55,1.7,[0]),new Fe(81,"TL","Thallium",204.38,1.96,1.55,[1,3]),new Fe(82,"PB","Lead",207.2,2.02,1.54,[2,4]),new Fe(83,"BI","Bismuth",208.98,1.7,1.54,[3,5]),new Fe(84,"PO","Polonium",210,1.7,1.68,[2,4,6]),new Fe(85,"AT","Astatine",210,1.7,1.7,[1,3,5,7]),new Fe(86,"RN","Radon",222,1.7,2.4,[0]),new Fe(87,"FR","Francium",223,1.7,2,[1]),new Fe(88,"RA","Radium",226.03,1.7,1.9,[2]),new Fe(89,"AC","Actinium",227.03,1.7,1.88,[0]),new Fe(90,"TH","Thorium",232.04,1.7,1.79,[0]),new Fe(91,"PA","Protactinium",231.04,1.7,1.61,[0]),new Fe(92,"U","Uranium",238.03,1.86,1.58,[0]),new Fe(93,"NP","Neptunium",237.05,1.7,1.55,[0]),new Fe(94,"PU","Plutonium",239.1,1.7,1.53,[0]),new Fe(95,"AM","Americium",243.1,1.7,1.51,[0]),new Fe(96,"CM","Curium",247.1,1.7,1.5,[0]),new Fe(97,"BK","Berkelium",247.1,1.7,1.5,[0]),new Fe(98,"CF","Californium",252.1,1.7,1.5,[0]),new Fe(99,"ES","Einsteinium",252.1,1.7,1.5,[0]),new Fe(100,"FM","Fermium",257.1,1.7,1.5,[0]),new Fe(101,"MD","Mendelevium",256.1,1.7,1.5,[0]),new Fe(102,"NO","Nobelium",259.1,1.7,1.5,[0]),new Fe(103,"LR","Lawrencium",260.1,1.7,1.5,[0]),new Fe(104,"RF","Rutherfordium",261,1.7,1.6,[0]),new Fe(105,"DB","Dubnium",262,1.7,1.6,[0]),new Fe(106,"SG","Seaborgium",263,1.7,1.6,[0]),new Fe(107,"BH","Bohrium",262,1.7,1.6,[0]),new Fe(108,"HS","Hassium",265,1.7,1.6,[0]),new Fe(109,"MT","Meitnerium",268,1.7,1.6,[0])]),lt(Fe,"ByName",{D:new Fe(1,"D","Deuterium",2.014,1.2,.23,[1]),T:new Fe(1,"T","Tritium",3.016,1.2,.23,[1])});let gs=Fe;(function(){const s=gs.ByAtomicNumber,e=gs.ByName;for(let t=0,n=s.length;t<n;++t){const i=s[t];i&&(e[i.name]=i)}})();gs.getByName=function(s){let e=gs.ByName[s];return e||(e=gs.ByName[s]=new gs(0,s,"Unknown",0,1,.01,[0])),e};const ih=gs,NM={UNKNOWN:0,COVALENT:1,AROMATIC:2};function a5(s){return s.position}class h_{constructor(e,t,n,i,r){if(this._left=e,this._right=t,this._fixed=r,this._index=-1,e>t)throw new Error("In a bond atom indices must be in increasing order");this._order=n,this._type=i}getLeft(){return this._left}getRight(){return this._right}getOrder(){return this._order}calcLength(){return this._left.position.distanceTo(this._right.position)}_forEachNeighbour(e,t){const{bonds:n}=e;for(let i=0,r=n.length;i<r;++i)t(n[i]._left!==e?n[i]._left:n[i]._right)}forEachLevelOne(e){const t=this._left,n=this._right;this._forEachNeighbour(t,i=>{i!==n&&e(i)}),this._forEachNeighbour(n,i=>{i!==t&&e(i)})}forEachLevelTwo(e){const t=this._left,n=this._right,i=this;i._forEachNeighbour(t,r=>{r!==n&&i._forEachNeighbour(r,o=>{o!==t&&e(o)})}),i._forEachNeighbour(n,r=>{r!==t&&i._forEachNeighbour(r,o=>{o!==n&&e(o)})})}_fixDir(e,t,n){let i=0,r=0;const o=e.clone();function a(u){o.copy(n(u)),o.sub(e),t.dot(o)>0?++i:++r}function l(u){u.element.name==="C"&&a(u)}const h=[[this.forEachLevelOne,l],[this.forEachLevelOne,a],[this.forEachLevelTwo,l],[this.forEachLevelTwo,a]];for(let u=0;u<h.length;++u){if(h[u][0].call(this,h[u][1]),r>i)return t.multiplyScalar(-1);if(r<i)return t}return t}calcNormalDir(e){const t=this._left,n=this._right;let i=t,r=n;e=e===void 0?a5:e,t.bonds.length>n.bonds.length&&(i=n,r=t);let o=i,a=0;const{bonds:l}=r;for(let p=0,m=l.length;p<m;++p){let g=l[p]._left;l[p]._left===r&&(g=l[p]._right),g.bonds.length>a&&g!==i&&(o=g,a=g.bonds.length)}const h=e(r),u=e(i).clone().sub(h),f=e(o).clone().sub(h);return f.crossVectors(u,f),f.lengthSq()<1e-4&&f.set(0,1,0),u.normalize(),f.normalize(),u.crossVectors(f,u),u.lengthSq()<1e-4&&u.set(0,1,0),u.normalize(),this._fixDir(h,u,e)}}lt(h_,"BondType",NM);h_.prototype.BondType=NM;const Eh=h_,l5=["C3'","C3*","P","H5T","H3T"],sS=["OP1","O1P"],oS=["OP2","O2P"],c5=["C3'","C3*","C1","C1'","C1*","P"],xd=[{types:["A","DA","G","DG"],atoms:["N1"]},{types:["C","DC"],atoms:["N3"]},{types:["T","DT","U","DU"],atoms:["O4"]}];class h5{constructor(e,t,n,i){this._chain=e,this._component=null,this._type=t,this._sequence=n,this._icode=i,this._mask=1,this._index=-1,this._atoms=[],this._secondary=null,this._firstAtom=null,this._leadAtom=null,this._wingAtom=null,this._lastAtom=null,this._controlPoint=null,this._midPoint=null,this._wingVector=null,this._cylinders=null,this._isValid=!0,this._het=!1,this._molecule=null,this.temperature=null,this.occupancy=null}getChain(){return this._chain}getMolecule(){return this._molecule}getType(){return this._type}getSequence(){return this._sequence}getSecondary(){return this._secondary}getICode(){return this._icode}addAtom(e,t,n,i,r,o,a,l,h,u){const f=new Vr(this,e,t,n,i,r,o,a,l,h,u);return this._chain.getComplex().addAtom(f),this._atoms.push(f),this._het=this._het||r,f}getAtomCount(){return this._atoms.length}forEachAtom(e){const t=this._atoms;for(let n=0,i=t.length;n<i&&!e(t[n]);++n);}_findAtomByName(e){let t=null;return this.forEachAtom(n=>n.name===e?(t=n,!0):!1),t}_findFirstAtomInList(e){let t=null;for(let n=0;n<e.length;++n)if(t=this._findAtomByName(e[n]),t!==null)return t;return t}collectMask(){let e=4294967295;const t=this._atoms;for(let n=0,i=t.length;n<i;++n)e&=t[n].mask;this._mask=e}getCylinderTargetList(){const e=this._type._name;for(let t=0,n=xd.length;t<n;++t)for(let i=0,r=xd[t].types.length;i<r;++i)if(e===xd[t].types[i])return xd[t].atoms;return null}_detectLeadWing(e,t,n){const i=this._findFirstAtomInList(l5);let r=this._findFirstAtomInList(sS),o=this._findFirstAtomInList(oS);if(r===null&&t!==null&&(r=t._findFirstAtomInList(sS)),o===null&&t!==null&&(o=t._findFirstAtomInList(oS)),i===null||r===null||o===null)return;e._leadAtom=i,e._controlPoint=n(i),e._wingVector=n(o).clone().sub(n(r)),e._isValid=!0;const a=this._findFirstAtomInList(c5),l=this.getCylinderTargetList(),h=l!==null?this._findFirstAtomInList(l):null;a===null||h===null||(e._cylinders=[n(a),n(h)])}calcWing(e,t,n,i){const r=t.clone().sub(e),o=e.clone().sub(n);return o.crossVectors(r,o),o.crossVectors(r,o).normalize(),i!==null&&i.length()>1e-4&&o.length()>1e-4&&Math.abs(i.angleTo(o))>Math.PI/2&&o.negate(),o}_innerFinalize(e,t,n,i,r,o){const a=t===null,l=o(this._leadAtom),h=new b.Vector3(l.x,l.y,l.z);if(r){this._detectLeadWing(i,n,o);return}if(a)i._midPoint=o(this._firstAtom).clone();else{const u=t._controlPoint;i._midPoint=u.clone().lerp(h,.5),i._wingVector=this.calcWing(u,h,o(e._wingAtom),t._wingVector)}i._controlPoint=h}_finalize2(e,t,n){this._innerFinalize(e,e,t,this,n,i=>i.position)}isConnected(e){if(this._chain!==e._chain)return!1;if(this===e)return!0;let t=!1;return this.forEachAtom(n=>{const{bonds:i}=n;for(let r=0,o=i.length;r<o;++r){const a=i[r];if(a._left.residue===e||a._right.residue===e)return t=!0,!0}return!1}),t}_finalize(){const e=this;[this._firstAtom]=this._atoms,this._lastAtom=this._atoms[this._atoms.length-1],this._leadAtom=null,this._wingAtom=null;let t=0,n=0,i=0,r=0;this.forEachAtom(o=>(e._leadAtom===null&&o.role===ih.Constants.Lead&&(e._leadAtom=o),e._wingAtom===null&&o.role===ih.Constants.Wing&&(e._wingAtom=o),o.temperature&&(n+=o.temperature,t++),o.occupancy&&(r+=o.occupancy,i++),e._leadAtom!==null&&e._wingAtom!==null)),t>0&&(this.temperature=n/t),i>0&&(this.occupancy=r/i),(this._leadAtom===null||this._wingAtom===null)&&(this._isValid=!1),this._leadAtom===null&&(this._leadAtom=this._firstAtom),this._wingAtom===null&&(this._wingAtom=this._lastAtom)}}const ef=h5,bt=class bt{constructor(e,t,n){this._name=e,this._fullName=t,this.letterCode=n,this.flags=0}getName(){return this._name}};lt(bt,"StandardTypes",{ALA:new bt("ALA","Alanine","A"),ARG:new bt("ARG","Arginine","R"),ASN:new bt("ASN","Asparagine","N"),ASP:new bt("ASP","Aspartic Acid","D"),CYS:new bt("CYS","Cysteine","C"),GLN:new bt("GLN","Glutamine","Q"),GLU:new bt("GLU","Glutamic Acid","E"),GLY:new bt("GLY","Glycine","G"),HIS:new bt("HIS","Histidine","H"),ILE:new bt("ILE","Isoleucine","I"),LEU:new bt("LEU","Leucine","L"),LYS:new bt("LYS","Lysine","K"),MET:new bt("MET","Methionine","M"),PHE:new bt("PHE","Phenylalanine","F"),PRO:new bt("PRO","Proline","P"),PYL:new bt("PYL","Pyrrolysine","O"),SEC:new bt("SEC","Selenocysteine","U"),SER:new bt("SER","Serine","S"),THR:new bt("THR","Threonine","T"),TRP:new bt("TRP","Tryptophan","W"),TYR:new bt("TYR","Tyrosine","Y"),VAL:new bt("VAL","Valine","V"),A:new bt("A","Adenine","A"),C:new bt("C","Cytosine","C"),G:new bt("G","Guanine","G"),I:new bt("I","Inosine","I"),T:new bt("T","Thymine","T"),U:new bt("U","Uracil","U"),DA:new bt("DA","Adenine","A"),DC:new bt("DC","Cytosine","C"),DG:new bt("DG","Guanine","G"),DI:new bt("DI","Inosine","I"),DT:new bt("DT","Thymine","T"),DU:new bt("DU","Uracil","U"),"+A":new bt("+A","Adenine","A"),"+C":new bt("+C","Cytosine","C"),"+G":new bt("+G","Guanine","G"),"+I":new bt("+I","Inosine","I"),"+T":new bt("+T","Thymine","T"),"+U":new bt("+U","Uracil","U"),WAT:new bt("WAT","Water",""),H2O:new bt("H2O","Water",""),HOH:new bt("HOH","Water",""),DOD:new bt("DOD","Water",""),UNK:new bt("UNK","Unknown",""),UNL:new bt("UNL","Unknown Ligand","")}),lt(bt,"Flags",{PROTEIN:1,BASIC:2,ACIDIC:4,POLAR:8,NONPOLAR:16,AROMATIC:32,NUCLEIC:256,PURINE:512,PYRIMIDINE:1024,DNA:2048,RNA:4096,WATER:65536});let Ml=bt;function or(s,e){for(let t=0,n=e.length;t<n;++t){const i=Ml.StandardTypes[e[t]];i&&(i.flags|=s)}}const{Flags:ar}=Ml;or(ar.WATER,["WAT","H2O","HOH","DOD"]);or(ar.PROTEIN,["ALA","ARG","ASN","ASP","CYS","GLY","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","PRO","PYL","SEC","SER","THR","TRP","TYR","VAL"]);or(ar.BASIC,["ARG","HIS","LYS"]);or(ar.ACIDIC,["ASP","GLU"]);or(ar.POLAR,["ASN","CYS","GLN","SER","THR","TYR"]);or(ar.NONPOLAR,["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL","GLY"]);or(ar.AROMATIC,["PHE","TRP","TYR"]);or(ar.NUCLEIC,["A","G","I","DA","DG","DI","+A","+G","+I","C","T","U","DC","DT","DU","+C","+T","+U"]);or(ar.PURINE,["A","G","I","DA","DG","DI","+A","+G","+I"]);or(ar.PYRIMIDINE,["C","T","U","DC","DT","DU","+C","+T","+U"]);or(ar.DNA,["DA","DG","DI","DC","DT","DU"]);or(ar.RNA,["A","G","I","C","T","U"]);const u5={ILE:4.5,VAL:4.2,LEU:3.8,PHE:2.8,CYS:2.5,MET:1.9,ALA:1.8,GLY:-.4,THR:-.7,SER:-.8,TRP:-.9,TYR:-1.3,PRO:-1.6,HIS:-3.2,GLU:-3.5,GLN:-3.5,ASP:-3.5,ASN:-3.5,LYS:-3.9,ARG:-4.5};function d5(s,e){const t=Object.keys(e);for(let n=0,i=t.length;n<i;++n){const r=t[n],o=e[r];Ml.StandardTypes[r][s]=o}}d5("hydrophobicity",u5);const Jt=Ml,Sc={UNKNOWN:0,PROTEIN:1,NUCLEIC:2};class f5{constructor(e,t){this._complex=e,this._name=t,this._mask=1,this._index=-1,this._residues=[],this.minSequence=Number.POSITIVE_INFINITY,this.maxSequence=Number.NEGATIVE_INFINITY}getComplex(){return this._complex}getName(){return this._name}getResidues(){return this._residues}_determineType(){const e=this._residues,{PROTEIN:t,NUCLEIC:n}=Jt.Flags;this.type=Sc.UNKNOWN;for(let i=0,r=e.length;i<r;++i){const{flags:o}=e[i]._type;if(o&n){this.type=Sc.NUCLEIC;break}else if(o&t){this.type=Sc.PROTEIN;break}}}findResidue(e,t){const n=this._residues;for(let i=0,r=n.length;i<r;++i){const o=n[i];if(o._sequence===e&&o._icode===t)return[o,i]}return null}_finalize(){this._determineType();const e=this._residues;let t=null;for(let n=0,i=e.length;n<i;++n){const r=n+1<i?e[n+1]:null,o=e[n];o._finalize2(t,r,this.type===Sc.NUCLEIC),t=o}if(e.length>1&&e[1]._wingVector){const n=e[1]._wingVector;e[0]._wingVector=new b.Vector3(n.x,n.y,n.z)}else e.length>0&&(e[0]._wingVector=new b.Vector3(1,0,0))}updateToFrame(e){const t=this._residues;let n=null,i=null;const r=e._residues,o=t.length;function a(l){return e.getAtomPos(l.index)}for(let l=0;l<o;++l){const h=t[l],u=r[h._index],f=l+1<o?t[l+1]:null;h._innerFinalize(n,i,f,u,this.type===Sc.NUCLEIC,a),n=h,i=u}r[t[0]._index]._wingVector=o>1?r[t[1]._index]._wingVector:new b.Vector3(1,0,0)}addResidue(e,t,n){let i=this._complex.getResidueType(e);i===null&&(i=this._complex.addResidueType(e));const r=new ef(this,i,t,n);return this._complex.addResidue(r),this._residues.push(r),i.flags&(Jt.Flags.NUCLEIC|Jt.Flags.PROTEIN)&&(this.maxSequence<t&&(this.maxSequence=t),this.minSequence>t&&(this.minSequence=t)),r}getResidueCount(){return this._residues.length}forEachResidue(e){const t=this._residues;for(let n=0,i=t.length;n<i;++n)e(t[n])}collectMask(){let e=4294967295;const t=this._residues;for(let n=0,i=t.length;n<i;++n)e&=t[n]._mask;this._mask=e}}const FM=f5;class po{constructor(e,t,n){this.type=e,this.generic=po.genericByType[this.type]||"loop",this.init=t,this.term=n}_finalize(e,t,n){if(this.init instanceof ef&&this.term instanceof ef)return;const i=n.splitUnifiedSerial(this.init),r=n.splitUnifiedSerial(this.term);for(let o=i.chain;o<=r.chain;o++)for(let a=i.serial;a<=r.serial;a++)for(let{iCode:l}=i;l<=r.iCode;l++){const h=n.getUnifiedSerial(o,a,l);t[h]&&(t[h]._secondary=this)}this.init=t[this.init],this.term=t[this.term]}}po.Type={STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",HELIX:"X",TURN_310:"3",TURN_ALPHA:"4",TURN_PI:"5",TURN:"T",BEND:"S",COIL:"C"};po.Generic={STRAND:"strand",HELIX:"helix",LOOP:"loop"};const bc=po.Type,wc=po.Generic;po.genericByType={[bc.STRAND]:wc.STRAND,[bc.HELIX_310]:wc.HELIX,[bc.HELIX_ALPHA]:wc.HELIX,[bc.HELIX_PI]:wc.HELIX,[bc.HELIX]:wc.HELIX};const Hi=po,Um=Hi.Type,OM={1:Um.HELIX_ALPHA,3:Um.HELIX_PI,5:Um.HELIX_310};class p5 extends Hi{constructor(e,t,n,i,r,o,a){super(OM[e]||Hi.Type.HELIX,t,n),this.serial=i,this.name=r,this.comment=o,this.length=a}}const tg=p5;class m5 extends Hi{constructor(e,t,n,i,r,o){super(Hi.Type.STRAND,t,n),this.sheet=e,this.sense=i,this.atomCur=r,this.atomPrev=o}_finalize(e,t,n){super._finalize(e,t,n);let i=this.atomCur;i!==null&&!Number.isNaN(i)&&(this.atomCur=e[i]),i=this.atomPrev,i!==null&&!Number.isNaN(i)&&(this.atomPrev=e[i])}}const u_=m5;class g5{constructor(e,t){this._name=e,this._width=t,this._strands=[]}getName(){return this._name}getWidth(){return this._width}addStrand(e){this._strands.push(e),this._width=this._strands.length}addEmptyStrand(){this._strands.push(new u_(null,null,null,null,null,null))}_finalize(e,t,n){const i=this._strands;for(let r=0,o=i.length;r<o;++r)i[r]._finalize(e,t,n);if(this._width||(this._width=i.length),i.length!==this._width)throw new Error(`Sheet ${this._name} is inconsistent.`)}}const DM=g5;class _5{constructor(e,t,n,i,r){this._id=e,this._name=t,this._position=n||new b.Vector3,this._atoms=i||[],this._charge=0,this._repeat=1,this._center=null,this.xmlNodeRef=r||null}getName(){return this._name}getPosition(){return this._position}getCentralPoint(){return this._center}_rebuildSGroupOnAtomChange(){if(this._center===null)return;const t=new b.Vector3(1e8,1e8,1e8),n=new b.Vector3(-1e8,-1e8,-1e8);for(let i=0,r=this._atoms.length;i<r;i++){const o=this._atoms[i].position;t.set(Math.min(t.x,o.x),Math.min(t.y,o.y),Math.min(t.z,o.z)),n.set(Math.max(n.x,o.x),Math.max(n.y,o.y),Math.max(n.z,o.z))}this._center.addVectors(t,n),this._center.multiplyScalar(.5)}}const x5=_5;var tf=Ai(99);class y5{constructor(e,t){this.min=e,this.max=typeof t>"u"?e:t}includes(e){return this.min<=e&&e<=this.max}toString(){const{min:e,max:t}=this;return e===t?String(e):[e,t].join(":")}toJSON(){return[this.min,this.max]}}class UM{constructor(e){if(e instanceof this.constructor)return e;e instanceof Array?this._values=e.slice(0):e?this._values=[e]:this._values=[]}append(e){const t=this._values;return t[t.length]=e,this}remove(e){const t=this._values,n=t.indexOf(e);return n>=0&&t.splice(n,1),this}toString(){return this._values.join(",")}toJSON(){const e=this._values,t=[];for(let n=0,i=e.length;n<i;++n){const r=e[n];t[n]=r.toJSON?r.toJSON():r}return t}}class BM extends UM{includes(e){const t=this._values;for(let n=0,i=t.length;n<i;++n)if(t[n].includes(e))return!0;return!1}}const Bm=[];class zM extends UM{constructor(e,t){const n=super(e);if(t){this.upperOnly=!0;const i=n._values;for(let r=0,o=i.length;r<o;++r){const a=i[r];typeof a=="string"&&(i[r]=a.toUpperCase())}}else this.upperOnly=!1;return n}includes(e){return this._values.indexOf(e)!==-1}toString(){const e=this._values;Bm.length=0;for(let t=0,n=e.length;t<n;++t)Bm[t]=Oe.correctSelectorIdentifier(String(e[t]));return Bm.join(",")}_validate(e){return this.upperOnly&&typeof e=="string"?e.toUpperCase():e}append(e){return super.append(this._validate(e)),this}remove(e){return super.remove(this._validate(e)),this}}class lr{toString(){return this.keyword}toJSON(){return[this.name]}}lr.prototype.name="Error";lr.prototype.keyword="error";class VM extends lr{constructor(e){super(),this.list=e}toString(){return`${this.keyword} ${this.list}`}toJSON(){return[this.name,this.list.toJSON()]}}class Pf extends VM{constructor(e){super(new BM(e))}}class sa extends VM{constructor(e,t){super(new zM(e,!t))}}class If extends lr{includesAtom(e){return!1}}If.prototype.name="None";If.prototype.keyword="none";class d_ extends lr{includesAtom(e){return!0}}d_.prototype.name="All";d_.prototype.keyword="all";const ng=new If;class f_ extends lr{constructor(e){super(),this.rhs=e||ng}toString(){const e=this.rhs.priority&&this.rhs.priority>this.priority?`(${this.rhs})`:this.rhs;return`${this.keyword} ${e}`}toJSON(){return[this.name,this.rhs.toJSON()]}}f_.prototype.priority=1;class Lf extends lr{constructor(e,t){super(),this.lhs=e||ng,this.rhs=t||ng}toString(){const e=this.lhs.priority&&this.lhs.priority>this.priority?`(${this.lhs})`:this.lhs,t=this.rhs.priority&&this.rhs.priority>this.priority?`(${this.rhs})`:this.rhs;return`${e} ${this.keyword} ${t}`}toJSON(){return[this.name,this.lhs.toJSON(),this.rhs.toJSON()]}}Lf.prototype.priority=1e3;const rh={};function si(s,e){const t=s.toLowerCase();e.prototype.keyword=t,e.prototype.name=s;const n=function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return new e(...r)};return n.SelectorClass=e,rh[t]=n,e}si("Serial",class extends Pf{includesAtom(e){return this.list.includes(e.serial)}});si("Name",class extends sa{includesAtom(e){return this.list.includes(e.name)}});si("AltLoc",class extends sa{includesAtom(e){return this.list.includes(String.fromCharCode(e.location))}});si("Elem",class extends sa{includesAtom(e){return this.list.includes(e.element.name)}});si("Residue",class extends sa{includesAtom(e){return this.list.includes(e.residue._type._name)}});si("Sequence",class extends Pf{includesAtom(e){return this.list.includes(e.residue._sequence)}});si("ICode",class extends sa{constructor(e){super(e,!0)}includesAtom(e){return this.list.includes(e.residue._icode)}});si("ResIdx",class extends Pf{includesAtom(e){return this.list.includes(e.residue._index)}});si("Chain",class extends sa{constructor(e){super(e,!0)}includesAtom(e){return this.list.includes(e.residue._chain._name)}});si("Hetatm",class extends lr{includesAtom(e){return e.het}});si("PolarH",class extends lr{includesAtom(e){return(e.flags&Vr.Flags.NONPOLARH)===Vr.Flags.HYDROGEN}});si("NonPolarH",class extends lr{includesAtom(e){return(e.flags&Vr.Flags.NONPOLARH)===Vr.Flags.NONPOLARH}});si("All",d_);si("None",If);const kM=rh.none();function p_(s,e,t){return t.prototype.priority=e,si(s,t)}p_("Not",1,class extends f_{includesAtom(e){return!this.rhs.includesAtom(e)}});p_("And",2,class extends Lf{includesAtom(e){return this.lhs.includesAtom(e)&&this.rhs.includesAtom(e)}});p_("Or",3,class extends Lf{includesAtom(e){return this.lhs.includesAtom(e)||this.rhs.includesAtom(e)}});function Ar(s,e){return si(e,class extends lr{includesAtom(t){return(t.residue._type.flags&s)!==0}})}Ar(Jt.Flags.PROTEIN,"Protein");Ar(Jt.Flags.BASIC,"Basic");Ar(Jt.Flags.ACIDIC,"Acidic");Ar(Jt.Flags.BASIC|Jt.Flags.ACIDIC,"Charged");Ar(Jt.Flags.POLAR,"Polar");Ar(Jt.Flags.NONPOLAR,"NonPolar");Ar(Jt.Flags.AROMATIC,"Aromatic");Ar(Jt.Flags.NUCLEIC,"Nucleic");Ar(Jt.Flags.PURINE,"Purine");Ar(Jt.Flags.PYRIMIDINE,"Pyrimidine");Ar(Jt.Flags.WATER,"Water");const Ln=Object.create(rh);Ln.Selector=lr;Ln.RangeListSelector=Pf;Ln.ValueListSelector=sa;Ln.Range=y5;Ln.RangeList=BM;Ln.ValueList=zM;Ln.PrefixOperator=f_;Ln.InfixOperator=Lf;Ln.Context=Object.create({});Ln.GetSelector=function(s){if(!Ln.Context.hasOwnProperty(s))throw{message:`selector ${s} is not registered`};return Ln.Context[s]||kM};Ln.ClearContext=function(){Object.keys(Ln.Context).forEach(s=>{delete Ln.Context[s]})};Ln.keyword=function(s){return rh[s.toLowerCase()]||rh.none};Ln.parse=function(s){const e={};try{e.selector=tf.parser.parse(s)}catch(t){e.selector=kM,e.error=t.message}return e};tf.parser.yy=Ln;tf.parser.yy.parseError=tf.parser.parseError;const ea=Ln;class v5{constructor(e){this._complex=e,this._selector=ea.keyword("All")(),this._boundaries={boundingBox:new b.Box3,boundingSphere:new b.Sphere}}computeBoundaries(){const e=this._complex._atoms,t=e.length,n=this._selector,{boundingBox:i}=this._boundaries;if(i.makeEmpty(),t===1){i.expandByPoint(e[0].position);const a=new b.Vector3;i.getCenter(a);const l=2*e[0].element.radius;i.setFromCenterAndSize(a,new b.Vector3(l,l,l))}else for(let a=0;a<t;++a)n.includesAtom(e[a])&&i.expandByPoint(e[a].position);let r=0;const o=new b.Vector3;if(i.getCenter(o),t===1)this._boundaries.boundingSphere.set(o,e[0].element.radius);else{for(let a=0;a<t;++a){if(!n.includesAtom(e[a]))continue;const l=e[a].position,h=o.distanceToSquared(l);r<h&&(r=h)}this._boundaries.boundingSphere.set(o,Math.sqrt(r))}}getTransforms(){return[]}getSelector(){return this._selector}getBoundaries(){return this._boundaries}finalize(){}}const GM=v5;class S5 extends GM{constructor(e){super(e),this.chains=[],this.matrices=[]}computeBoundaries(){super.computeBoundaries();const{matrices:e}=this,t=this._boundaries.boundingSphere.center,n=this._boundaries.boundingSphere.radius,i=this._boundaries.boundingBox=new b.Box3;i.makeEmpty();for(let a=0,l=e.length;a<l;++a)i.expandByPoint(t.clone().applyMatrix4(e[a]));const r=i.max.distanceTo(i.min)/2+n,o=new b.Vector3;i.getCenter(o),this._boundaries.boundingSphere=new b.Sphere().set(o,r),i.max.addScalar(n),i.min.subScalar(n)}addChain(e){this.chains[this.chains.length]=e}addMatrix(e){this.matrices[this.matrices.length]=e}getTransforms(){return this.matrices}finalize(){this.chains.length>0?this._selector=ea.keyword("Chain")(this.chains):this._selector=ea.keyword("None")()}}const m_=S5;class b5{constructor(e){this._complex=e,this._index=-1,this._residueIndices=[],this._cycles=[],this._subDivs=[],this._residueCount=0}getResidues(){return this._complex._residues}getResidueCount(){return this._residueCount}forEachResidue(e){const t=this._complex._residues,n=this._residueIndices;for(let i=0,r=n.length;i<r;++i)for(let o=n[i].start,a=n[i].end;o<=a;++o)e(t[o])}setSubDivs(e){this._subDivs=e;let t=0;const n=[];let i=0;for(let r=0,o=e.length;r<o;++r)if(r===o-1||e[r].end+1!==e[r+1].start){const{start:a}=e[t],{end:l}=e[r];n[n.length]={start:a,end:l},i+=l-a+1,t=r+1}this._residueIndices=n,this._residueCount=i}getComplex(){return this._complex}forEachBond(e){const t=this._complex._bonds;for(let n=0,i=t.length;n<i;++n){const r=t[n];r._left.residue._component===this&&e(r)}}update(){this.forEachCycle(e=>{e.update()})}forEachAtom(e){this.forEachResidue(t=>{t.forEachAtom(e)})}addCycle(e){this._cycles.push(e)}forEachCycle(e){const t=this._cycles;for(let n=0,i=t.length;n<i;++n)e(t[n])}markResidues(){const e=this;e.forEachResidue(t=>{t._component=e})}_forEachSubChain(e,t){const n=this._complex._residues,i=this._subDivs;for(let r=0,o=i.length;r<o;++r)for(let a=i[r].start,l=i[r].end;a<=l;++a){const h=n[a];if(e&h._mask&&h._isValid){let u=a+1;for(;u<=l;++u){const f=n[u];if(!(e&f._mask&&f._isValid))break}t(r,a,u-1),a=u}}}getMaskedSequences(e){const t=[];let n=0;return this._forEachSubChain(e,(i,r,o)=>{t[n++]={start:r,end:o}}),t}getMaskedSubdivSequences(e){const t=[];let n=-1,i=-1;const r=this._subDivs;return this._forEachSubChain(e,(o,a,l)=>{i!==o&&(++n,t[n]={arr:[],boundaries:r[o]},i=o),t[n].arr[t[n].arr.length]={start:a,end:l}}),t}}const aS=b5,Mc=32,zm=1024*1024,Vm=4,w5=14,km=-1,M5=89237;class E5{constructor(e){this.numPairs=0,this.numMaxPairs=e,this.intBuffer=Oe.allocateTyped(Int32Array,e*Vm);for(let t=0;t<e*Vm;t++)this.intBuffer[t]=km;this.hashBuffer=Oe.allocateTyped(Int32Array,zm*Mc);for(let t=0;t<zm*Mc;t++)this.hashBuffer[t]=km}destroy(){this.intBuffer=null,this.hashBuffer=null}addPair(e,t){const n=e<t?e:t,i=e>t?e:t,r=n+(i<<w5);let a=(n+i*M5&zm-1)*Mc,l=0;for(;l<Mc;l++){const h=this.hashBuffer[a+l];if(h===km)break;if(h===r)return!1}if(l>=Mc)throw new Error("addPair: increase cMaxPairsForHashCode");if(this.hashBuffer[a+l]=r,this.numPairs>=this.numMaxPairs)throw new Error("addPair: increase num pairs");return a=this.numPairs*Vm,this.intBuffer[a]=n,this.intBuffer[a+1]=i,this.intBuffer[a+2]=r,this.numPairs++,!0}}const HM=E5,A5=4,lS=32,cS=.45,T5=.001;function hS(s){const{element:e}=s;if(e)return e.radiusBonding;throw new Error("_getBondingRadius: Logic error.")}function C5(s){return!s.isHet()||s.bonds&&s.bonds.length===0}class R5{constructor(e){this._complex=e,this._maxRad=1.8;const t=this._complex.getDefaultBoundaries().boundingBox;this._vBoxMin=t.min.clone(),this._vBoxMax=t.max.clone(),this._pairCollection=null}_addExistingPairs(){const e=this._complex.getAtoms(),t=e.length;let n=0;const i=this._pairCollection;for(;n<t;n++){const{bonds:r}=e[n],o=r.length;for(let a=0;a<o;a++){const l=r[a];l._left.index===n&&i.addPair(n,l._right.index)}}return 0}_findPairs(){const e=this._complex.getVoxelWorld();if(e===null)return;const t=this._complex._atoms,n=t.length,i=this;let r,o,a,l,h;const u=function(f){if(o&&f.isHydrogen())return;const p=f.location;if(l!==lS&&p!==lS&&l!==p)return;const m=a.distanceToSquared(f.position),g=f.element.radiusBonding,v=r+g+cS;m>v*v||m<T5||i._pairCollection.addPair(h.index,f.index)};for(let f=0;f<n;++f)h=t[f],C5(h)&&(r=h.element.radiusBonding,o=h.isHydrogen(),a=h.position,l=h.location,e.forEachAtomWithinRadius(a,2*this._maxRad+cS,u))}_addPairs(){const e=this._complex._atoms;for(let t=0,n=0;t<this._pairCollection.numPairs;t++,n+=4){const i=this._pairCollection.intBuffer[n],r=this._pairCollection.intBuffer[n+1];this._addPair(e[i],e[r])}}_addPair(e,t){const n=e.bonds,i=e.index,r=t.index;for(let h=0,u=n.length;h<u;++h){const f=n[h];if(f._left.index===r||f._right.index===r)return}const o=i<r?e:t,a=i<r?t:e,l=this._complex.addBond(o,a,0,Eh.BondType.UNKNOWN,!1);n.push(l),t.bonds.push(l)}build(){this._buildInner()}_buildInner(){const e=this._complex._atoms;if(!(e.length<2)){if(e[0].index<0)throw new Error("AutoBond: Atoms in complex were not indexed.");this._calcBoundingBox(),this._pairCollection=new HM(e.length*A5),this._addExistingPairs(),this._findPairs(),this._addPairs()}}_calcBoundingBox(){const e=this._complex._atoms,t=e.length;let n=hS(e[0]);for(let i=1;i<t;++i)n=Math.max(n,hS(e[i]));this._vBoxMax.addScalar(n),this._vBoxMin.addScalar(-n),this._maxRad=n*1.2}destroy(){this._pairCollection&&this._pairCollection.destroy()}}const P5=R5,I5=.1,g_=Eh.BondType.AROMATIC,uS=[ih.ByName.C.number,ih.ByName.N.number],L5=function(){const s=new b.Vector3,e=new b.Vector3,t=new b.Vector3;return function(n,i){return s.copy(n).normalize(),e.copy(i).normalize(),t.crossVectors(s,e),t.length()>I5?!1:s.dot(e)>=0}}();function dS(s,e){let t=0;for(;t<s.length&&s[t]<e;)++t;s.splice(t,0,e)}function fS(s,e){return s._left===e?s._right:s._left}function N5(s,e){const t=s.dot(e)/Math.sqrt(s.lengthSq()*e.lengthSq());return b.MathUtils.clamp(t,-1,1)}function F5(s){s._type=g_}class O5{constructor(e){this.atoms=e,this.update()}update(){const{atoms:e}=this,t=new b.Vector3,n=e.length;for(let i=0;i<n;++i)t.add(e[i].position);t.multiplyScalar(1/n),this.center=t,this.radius=t.distanceTo(e[0].position.clone().lerp(e[1].position,.5))}forEachBond(e){const{atoms:t}=this,n=t.length;let i=t[0],r;function o(a){(a._left===r||a._right===r)&&e(a)}for(let a=0;a<n;++a)r=t[(a+1)%n],i.forEachBond(o),i=r}}function pS(s){return s._type===g_}function D5(s){if(s.type===g_)return!0;const e=uS.indexOf(s._right.element.number),t=uS.indexOf(s._left.element.number);return e!==-1&&t!==-1}function U5(s){return s.length>3}function B5(s){return console.assert(s.length>2),!0}class z5{constructor(e){this._complex=e;const t=new Array(e._bonds.length),n=new Array(e._bonds.length);for(let i=0,r=t.length;i<r;++i)t[i]=[],n[i]=!1;this._bondsData=t,this._bondMarks=n,this._resetCycles()}_resetCycles(){this._cycles=[],this._currIdx=-1}_haveSameCycle(e,t,n){const i=e[t._index],r=e[n._index],o=i.length,a=r.length;let l=0,h=0;for(;l<o&&h<a;){if(i[l]===r[h])return!0;i[l]>r[h]?++h:++l}return!1}_tryBond(e,t,n){const i=[],r=this._bondsData,o=fS(e,t),a=t.position.clone().sub(o.position),l=this._currStart,h=this,u=this._bondMarks;let f=this._checkBond;u[e._index]=!0,f=f===void 0?pS:f,t.forEachBond(p=>{if(!f(p)||p===e||u[p._index]||h._haveSameCycle(r,e,p))return;const m=fS(p,t),g=m.position.clone().sub(t.position),v=m===l?-2:1-N5(a,g),y=g.cross(a);if(!L5(y,n))return;let x=0;for(;x<i.length&&i[x].val<v;)++x;i.splice(x,0,{bond:p,val:v,dir:y})});for(let p=0,m=i.length;p<m;++p){const{bond:g}=i[p],v=g._left===t?g._right:g._left;if(v===l)return++this._currIdx,this._cycles.push([t]),u[e._index]=!1,!0;if(this._tryBond(g,v,i[p].dir))return dS(r[g._index],this._currIdx),this._cycles[this._currIdx].push(t),u[e._index]=!1,!0}return u[e._index]=!1,!1}_startCycle(e){this._currStart=e._left,this._tryBond(e,e._right,new b.Vector3)&&(dS(this._bondsData[e._index],this._currIdx),this._cycles[this._currIdx].push(e._left))}_findLoops(e,t){this._checkBond=e;const n=this._complex,i=this;n.forEachComponent(r=>{i._resetCycles(),r.forEachBond(a=>{e(a)&&i._startCycle(a)});const o=i._cycles;for(let a=0,l=o.length;a<l;++a){const h=o[a];if(!t(h))continue;const u=new O5(h);u.forEachBond(F5),r.addCycle(u)}})}markCycles(){this._findLoops(pS,U5)}detectCycles(){this._findLoops(D5,B5)}}const V5=z5;function k5(s,e,t,n){const i=t-s.z,r=n-s.z,o=Math.sqrt(Math.max(e*e-i*i,0)),a=Math.sqrt(Math.max(e*e-r*r,0)),l=Math.min(o,a);let h;return t<=s.z&&n>=s.z?h=e:h=Math.max(o,a),[l,h]}function G5(s,e,t,n){const i=t-s.y,r=n-s.y,o=Math.sqrt(Math.max(e*e-i*i,0)),a=Math.sqrt(Math.max(e*e-r*r,0)),l=Math.min(o,a);let h;return t<=s.y&&n>=s.y?h=e:h=Math.max(o,a),[l,h]}const Xn=class Xn{constructor(e,t){this._box=e.clone();const n=new b.Vector3;e.getSize(n),this._count=n.clone().divide(t).floor().max(new b.Vector3(1,1,1)),this._last=this._count.clone().subScalar(1),this._cellSize=n.clone().divide(this._count),this._cellInnerR=.5*Math.min(Math.min(this._cellSize.x,this._cellSize.y),this._cellSize.z),this._cellOuterR=.5*Math.sqrt(this._cellSize.dot(this._cellSize));const i=this._count.x*this._count.y*this._count.z;this._voxels=Oe.allocateTyped(Int32Array,i);for(let r=0;r<i;++r)this._voxels[r]=-1;this._atoms=[]}addAtoms(e){const t=this;let n=this._atoms.length;this._atoms.length+=2*e.getAtomCount(),e.forEachAtom(i=>{const r=t._findVoxel(i.position);t._atoms[n]=i,t._atoms[n+1]=t._voxels[r],t._voxels[r]=n,n+=2})}_findVoxel(e){const t=Xn._zero,n=Xn._voxel;return n.copy(e).sub(this._box.min).divide(this._cellSize).floor().clamp(t,this._last),n.x+this._count.x*(n.y+this._count.y*n.z)}_forEachAtomInVoxel(e,t){for(let n=this._voxels[e];n>=0;n=this._atoms[n+1])t(this._atoms[n])}_forEachVoxelWithinRadius(e,t,n){const i=Xn._xRange,r=Xn._yRange,o=Xn._zRange;if(t/this._cellInnerR<10){this._forEachVoxelWithinRadiusSimple(e,t,n);return}let a,l,h,u,f,p,m,g;o.set(e.z-t,e.z+t),o.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor().clampScalar(0,this._count.z-1);for(let v=o.x;v<=o.y;++v){f=[this._box.min.z+v*this._cellSize.z,this._box.min.z+(v+1)*this._cellSize.z],g=e.z-t<=f[0]&&f[1]<=e.z+t,a=k5(e,t,f[0],f[1]),r.set(e.y-a[1],e.y+a[1]),r.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor().clampScalar(0,this._count.y-1);for(let y=r.x;y<=r.y;++y){u=[this._box.min.y+y*this._cellSize.y,this._box.min.y+(y+1)*this._cellSize.y],m=e.y-a[0]<=u[0]&&u[1]<=e.y+a[0],l=G5(e,a[1],u[0],u[1]),i.set(e.x-l[1],e.x+l[1]),i.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor().clampScalar(0,this._count.x-1);for(let{x}=i;x<=i.y;++x)h=[this._box.min.x+x*this._cellSize.x,this._box.min.x+(x+1)*this._cellSize.x],p=e.x-l[0]<=h[0]&&h[1]<=e.x+l[0],n(x+this._count.x*(y+this._count.y*v),p&&m&&g)}}}_forEachVoxelWithinRadiusSimple(e,t,n){const i=Xn._xRange,r=Xn._yRange,o=Xn._zRange,a=Xn._vCenter,l=(t+this._cellOuterR)*(t+this._cellOuterR);let h=-1;t>this._cellOuterR&&(h=(t-this._cellOuterR)*(t-this._cellOuterR)),i.set(e.x-t,e.x+t),i.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor(),i.x=Math.min(Math.max(i.x,0),this._count.x-1),i.y=Math.min(Math.max(i.y,0),this._count.x-1),r.set(e.y-t,e.y+t),r.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor(),r.x=Math.min(Math.max(r.x,0),this._count.y-1),r.y=Math.min(Math.max(r.y,0),this._count.y-1),o.set(e.z-t,e.z+t),o.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor(),o.x=Math.min(Math.max(o.x,0),this._count.z-1),o.y=Math.min(Math.max(o.y,0),this._count.z-1);for(let u=o.x;u<=o.y;++u){const f=[this._box.min.z+u*this._cellSize.z,this._box.min.z+(u+1)*this._cellSize.z];a.z=.5*(f[0]+f[1]);for(let p=r.x;p<=r.y;++p){const m=[this._box.min.y+p*this._cellSize.y,this._box.min.y+(p+1)*this._cellSize.y];a.y=.5*(m[0]+m[1]);for(let{x:g}=i;g<=i.y;++g){const v=[this._box.min.x+g*this._cellSize.x,this._box.min.x+(g+1)*this._cellSize.x];a.x=.5*(v[0]+v[1]);const y=e.distanceToSquared(a);y<=l&&n(g+this._count.x*(p+this._count.y*u),y<=h)}}}}forEachAtomWithinRadius(e,t,n){const i=this,r=t*t;i._forEachVoxelWithinRadius(e,t,(o,a)=>{a?i._forEachAtomInVoxel(o,n):i._forEachAtomInVoxel(o,l=>{e.distanceToSquared(l.position)<=r&&n(l)})})}forEachAtomWithinDistFromMasked(e,t,n,i){this._forEachAtomWithinDistFromGroup(r=>{e.forEachAtom(o=>{o.mask&t&&r(o)})},n,i)}forEachAtomWithinDistFromSelected(e,t,n,i){this._forEachAtomWithinDistFromGroup(r=>{e.forEachAtom(o=>{t.includesAtom(o)&&r(o)})},n,i)}_forEachAtomWithinDistFromGroup(e,t,n){const i=this,r=t*t,o=[],a=[];let l=0;e(f=>{i._forEachVoxelWithinRadius(f.position,t,(p,m)=>{m?o[p]=-1:typeof o[p]>"u"?(a.push(f),a.push(-1),o[p]=l,l+=2):o[p]!==-1&&(a.push(f),a.push(o[p]),o[p]=l,l+=2)})});let h;const u=function(f){if(!(typeof o[h]>"u")){if(l=o[h],l===-1){n(f);return}for(;l>=0;l=a[l+1])if(f.position.distanceToSquared(a[l].position)<r){n(f);break}}};for(h in o)o.hasOwnProperty(h)&&i._forEachAtomInVoxel(h,u)}};lt(Xn,"_zero",new b.Vector3(0,0,0)),lt(Xn,"_voxel",new b.Vector3),lt(Xn,"_xRange",new b.Vector2),lt(Xn,"_yRange",new b.Vector2),lt(Xn,"_zRange",new b.Vector2),lt(Xn,"_vCenter",new b.Vector3);let ig=Xn;const WM=ig,yd=.5,Gm=-9.9,mS=-.5,vd=-27.888,H5=5,W5=1e3;class X5{constructor(e){this._complex=e,this._hbonds=[],this._complex._residues.length>W5?this._buildVW():this._build()}isBond(e,t){if(this._hbonds[e]){const[n,i]=this._hbonds[e].acceptor;if(n&&n.residue===t&&n.energy<mS||i&&i.residue===t&&i.energy<mS)return!0}return!1}_build(){const e=this;for(let t=0;t<this._complex._residues.length-1;++t){const n=this._complex._residues[t];if(!(n.getType().flags&Jt.Flags.PROTEIN))continue;let i=null;t>0&&this._complex._residues[t-1].getType().flags&Jt.Flags.PROTEIN&&n._sequence===this._complex._residues[t-1]._sequence+1&&(i=this._complex._residues[t-1]);for(let r=t+1;r<this._complex._residues.length;++r){const o=this._complex._residues[r];if(!(o.getType().flags&Jt.Flags.PROTEIN))continue;let a=null;this._complex._residues[r-1].getType().flags&Jt.Flags.PROTEIN&&o._sequence===this._complex._residues[r-1]._sequence+1&&(a=this._complex._residues[r-1]),e._calcHBondEnergy(i,n,o),r!==t+1&&e._calcHBondEnergy(a,o,n)}}}_buildVW(){const e=this,t=this._complex._residues;let n,i;const r=this._complex.getVoxelWorld();if(r===null)return;const o=new HM(this._complex._residues.length*this._complex._residues.length/2);function a(l){const h=l.residue;if(h._index===n._index||!(h.getType().flags&Jt.Flags.PROTEIN)||!o.addPair(n._index,h._index))return;let u=h._index>0?t[h._index-1]:null;u&&(!(u.getType().flags&Jt.Flags.PROTEIN)||h._sequence!==u._sequence+1)&&(u=null),e._calcHBondEnergy(i,n,h),h._index!==n._index+1&&e._calcHBondEnergy(u,h,n)}for(let l=0;l<t.length-1;++l)n=t[l],n.getType().flags&Jt.Flags.PROTEIN&&(i=l>0?t[l-1]:null,i&&(!(i.getType().flags&Jt.Flags.PROTEIN)||n._sequence!==i._sequence+1)&&(i=null),r.forEachAtomWithinRadius(this._residueGetCAlpha(n),H5,a))}_residueGetCAlpha(e){for(let t=0;t<e._atoms.length;++t){const{name:n}=e._atoms[t];if(n==="CA"||n==="C1")return e._atoms[t].position}return null}_residueGetCO(e){let t=null,n=null;return e.forEachAtom(i=>{i.name==="C"?t=i.position:i.name==="O"&&(n=i.position)}),[t,n]}_residueGetNH(e,t){const[n,i]=this._residueGetCO(e);let r;if(t.forEachAtom(o=>{o.name==="N"&&(r=o.position)}),n&&i&&r){const o=n.clone();return o.sub(i),o.multiplyScalar(1/o.length()),o.add(r),[r,o]}return[null,null]}_calcHBondEnergy(e,t,n){let i=0;if(e===null)return i;if(t.getType().getName()!=="PRO"){const[a,l]=this._residueGetNH(e,t),[h,u]=this._residueGetCO(n);if(a===null||l===null||h===null||u===null)return i;const f=l.distanceTo(u),p=l.distanceTo(h),m=a.distanceTo(h),g=a.distanceTo(u);f<yd||p<yd||m<yd||g<yd?i=Gm:i=vd/f-vd/p+vd/m-vd/g,i=Math.round(i*1e3)/1e3,i<Gm&&(i=Gm)}typeof this._hbonds[t._index]>"u"&&(this._hbonds[t._index]={donor:[],acceptor:[]});const r=this._hbonds[t._index];r.acceptor.length<2&&r.acceptor.push({residue:n._index,energy:i}),r.acceptor.length>1&&(i<r.acceptor[0].energy?(r.acceptor[1].residue=r.acceptor[0].residue,r.acceptor[1].energy=r.acceptor[0].energy,r.acceptor[0].residue=n._index,r.acceptor[0].energy=i):i<r.acceptor[1].energy&&(r.acceptor[1].residue=n._index,r.acceptor[1].energy=i)),typeof this._hbonds[n._index]>"u"&&(this._hbonds[n._index]={donor:[],acceptor:[]});const o=this._hbonds[n._index];return o.donor.length<2&&o.donor.push({residue:t._index,energy:i}),o.donor.length>1&&(i<o.donor[0].energy?(o.donor[1].residue=o.donor[0].residue,o.donor[1].energy=o.donor[0].energy,o.donor[0].residue=t._index,o.donor[0].energy=i):i<o.donor[1].energy&&(o.donor[1].residue=t._index,o.donor[1].energy=i)),i}}const cs=Object.freeze({NO_BRIDGE:0,PARALLEL:1,ANTI_PARALLEL:2}),Fo=Object.freeze({START:1,MIDDLE:2,END:3,START_AND_END:4}),Bi=Object.freeze({STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",TURN:"T",BEND:"S",LOOP:" "});class __{constructor(e){this._complex=e,this._build()}_build(){const e=this;this._hbonds=new X5(this._complex),this._ss=[],this._sheet=[],this._betaPartners=[],this._bend=[];for(let t=0;t<this._complex.getResidues().length;++t)this._betaPartners[t]=[];this._helixFlags=[],this._helixFlags[3]=[],this._helixFlags[4]=[],this._helixFlags[5]=[],this._chainLengths=[];for(let t=0;t<this._complex._chains.length;++t){const n=this._complex._chains[t].getResidues();let i=0;for(;i<n.length&&n[i].getType().flags&Jt.Flags.PROTEIN;++i);this._chainLengths[t]=i}this._buildBetaSheets();for(let t=0;t<this._complex._chains.length;++t)e._buildAlphaHelices(this._complex._chains[t].getResidues(),this._chainLengths[t],!1)}_buildAlphaHelices(e,t,n){for(let i=3;i<=5&&!(e.length<i);++i)for(let r=0;r+i<t;++r)if(this._hbonds.isBond(e[r+i]._index,e[r]._index)){this._helixFlags[i][e[r+i]._index]=Fo.END;for(let o=r+1;o<r+i;++o)typeof this._helixFlags[i][e[o]._index]>"u"&&(this._helixFlags[i][e[o]._index]=Fo.MIDDLE);this._helixFlags[i][e[r]._index]===Fo.END?this._helixFlags[i][e[r]._index]=Fo.START_AND_END:this._helixFlags[i][e[r]._index]=Fo.START}for(let i=2;i<t-2;++i){const r=this._kappa(e[i-2],e[i],e[i+2]);this._bend[e[i]._index]=r!==360&&r>70}for(let i=1;i+4<t;++i)if(this._isHelixStart(e[i]._index,4)&&this._isHelixStart(e[i-1]._index,4))for(let r=i;r<=i+3;++r)this._ss[e[r]._index]=Bi.HELIX_ALPHA;for(let i=1;i+3<t;++i)if(this._isHelixStart(e[i]._index,3)&&this._isHelixStart(e[i-1]._index,3)){let r=!0;for(let o=i;r&&o<=i+2;++o)r=typeof this._ss[e[o]._index]>"u"||this._ss[e[o]._index]===Bi.HELIX_310;if(r)for(let o=i;o<=i+2;++o)this._ss[e[o]._index]=Bi.HELIX_310}for(let i=1;i+5<t;++i)if(this._isHelixStart(e[i]._index,5)&&this._isHelixStart(e[i-1]._index,5)){let r=!0;for(let o=i;r&&o<=i+4;++o)r=typeof this._ss[e[o]._index]>"u"||this._ss[e[o]._index]===Bi.HELIX_PI||n&&this._ss[e[o]._index]===Bi.HELIX_ALPHA;if(r)for(let o=i;o<=i+4;++o)this._ss[e[o]._index]=Bi.HELIX_PI}for(let i=1;i+1<t;++i)if(typeof this._ss[e[i]._index]>"u"){let r=!1;for(let o=3;o<=5&&!r;++o)for(let a=1;a<o&&!r;++a)r=i>=a&&this._isHelixStart(e[i-a]._index,o);r?this._ss[e[i]._index]=Bi.TURN:this._bend[e[i]._index]&&(this._ss[e[i]._index]=Bi.BEND)}}_residueGetCAlpha(e){for(let t=0;t<e._atoms.length;++t){const{name:n}=e._atoms[t];if(n==="CA"||n==="C1")return e._atoms[t].position}return null}_cosinusAngle(e,t,n,i){const r=e.clone().sub(t),o=n.clone().sub(i);let a=0;const l=r.dot(r)*o.dot(o);return l>0&&(a=r.dot(o)/Math.sqrt(l)),a}_kappa(e,t,n){const i=this._residueGetCAlpha(t),r=this._residueGetCAlpha(e),o=this._residueGetCAlpha(n);if(i===null||r===null||o===null)return 180;const a=this._cosinusAngle(i,r,o,i),l=Math.sqrt(1-a*a);return Math.atan2(l,a)*180/Math.PI}_isHelixStart(e,t){return this._helixFlags[t][e]===Fo.START||this._helixFlags[t][e]===Fo.START_AND_END}_buildBetaSheets(){const e=[];for(let r=0;r<this._complex._chains.length;++r){const o=this._chainLengths[r];if(o<=4)continue;const a=this._complex._chains[r].getResidues();for(let l=r;l<this._complex._chains.length;++l){const h=this._chainLengths[l];if(h<=4)continue;const u=this._complex._chains[l].getResidues();for(let f=1;f+1<o;++f){const p=a[f];let m=1;for(l===r&&(m=f+3);m+1<h;++m){const g=u[m],v=this._testBridge(a,f,u,m);if(v===cs.NO_BRIDGE)continue;let y=!1;for(const x of e)if(!(v!==x.type||p._index!==x.i[x.i.length-1]+1)){if(v===cs.PARALLEL&&x.j[x.j.length-1]+1===g._index){x.i.push(p._index),x.j.push(g._index),y=!0;break}if(v===cs.ANTI_PARALLEL&&x.j[0]-1===g._index){x.i.push(p._index),x.j.unshift(g._index),y=!0;break}}y||e.push({type:v,i:[p._index],chainI:p.getChain()._index,j:[g._index],chainJ:g.getChain()._index})}}}}e.sort((r,o)=>r.chainI<o.chainI||r.chainI===o.chainI&&r.i[0]<o.i[0]?-1:1);for(let r=0;r<e.length;++r)for(let o=r+1;o<e.length;++o){const a=e[r].i[0],l=e[r].i[e[r].i.length-1],h=e[r].j[0],u=e[r].j[e[r].j.length-1],f=e[o].i[0],p=e[o].i[e[o].i.length-1],m=e[o].j[0],g=e[o].j[e[o].j.length-1];if(e[r].type!==e[o].type||this._hasChainBreak(Math.min(a,f),Math.max(l,p))||this._hasChainBreak(Math.min(h,m),Math.max(u,g))||f-l>=6||l>=f&&a<=p)continue;let v=!1;e[r].type===cs.PARALLEL?v=m-u<6&&f-l<3||m-u<3:v=h-g<6&&f-l<3||h-g<3,v&&(e[r].i=e[r].i.concat(e[o].i),e[r].type===cs.PARALLEL?e[r].j=e[r].j.concat(e[o].j):e[r].j=e[o].j.concat(e[r].j),e.splice(o--,1))}const t=new Set;for(let r=0;r<e.length;++r)t.add(e[r]);let n=1,i=0;for(;t.size>0;){let r=t.values().next().value;t.delete(r);const o=new Set;o.add(r);let a;do{a=new Set;for(const l of o.values())for(const h of t.values())this._areBridgesLinked(l,h)&&a.add(h);for(r of a.values())o.add(r),t.delete(r)}while(a.size>0);for(r of o.values())r.ladder=i,r.sheet=n,r.link=o,++i;++n}for(let r=0;r<e.length;++r){const o=e[r];let a=0,l=0;for(let u=0;u<o.i.length;++u)if(this._betaPartners[o.i[u]][0]){a=1;break}for(let u=0;u<o.j.length;++u)if(this._betaPartners[o.j[u]][0]){l=1;break}let h=Bi.BRIDGE;if(o.i.length>1&&(h=Bi.STRAND),o.type===cs.PARALLEL){let u=0;for(let f=0;f<o.i.length;++f)this._betaPartners[o.i[f]][a]={residue:o.j[u++],ladder:o.ladder,parallel:!0};u=0;for(let f=0;f<o.j.length;++f)this._betaPartners[o.j[f]][l]={residue:o.i[u++],ladder:o.ladder,parallel:!0}}else{let u=o.j.length-1;for(let f=0;f<o.i.length;++f)this._betaPartners[o.i[f]][a]={residue:o.j[u--],ladder:o.ladder,parallel:!1};u=o.i.length-1;for(let f=0;f<o.j.length;++f)this._betaPartners[o.j[f]][l]={residue:o.i[u--],ladder:o.ladder,parallel:!1}}for(let u=o.i[0];u<=o.i[o.i.length-1];++u)this._ss[u]!==Bi.STRAND&&(this._ss[u]=h,this._sheet[u]=o.sheet);for(let u=o.j[0];u<=o.j[o.j.length-1];++u)this._ss[u]!==Bi.STRAND&&(this._ss[u]=h,this._sheet[u]=o.sheet)}}_testBridge(e,t,n,i){let r=cs.NO_BRIDGE;const o=e[t-1]._index,a=e[t]._index,l=e[t+1]._index,h=n[i-1]._index,u=n[i]._index,f=n[i+1]._index,p=this._hbonds.isBond.bind(this._hbonds);return p(l,u)&&p(u,o)||p(f,a)&&p(a,h)?r=cs.PARALLEL:(p(l,h)&&p(f,o)||p(u,a)&&p(a,u))&&(r=cs.ANTI_PARALLEL),r}_areBridgesLinked(e,t){const n=new Set(e.i),i=new Set(e.j);for(const r of t.i)if(n.has(r)||i.has(r))return!0;for(const r of t.j)if(n.has(r)||i.has(r))return!0;return!1}_hasChainBreak(e,t){for(let n=e+1;n<=t;++n)if(this._complex._residues[n]._sequence!==this._complex._residues[n-1]._sequence+1)return!0;return!1}}__.StructureType=Bi;const Hm=5,{StructureType:Ks}=__,Sd=Hi.Type,Y5={[Ks.HELIX_ALPHA]:1,[Ks.HELIX_PI]:3,[Ks.HELIX_310]:5},j5={[Ks.BRIDGE]:Sd.BRIDGE,[Ks.TURN]:Sd.TURN,[Ks.BEND]:Sd.BEND,[Ks.LOOP]:Sd.COIL};class x_{constructor(){this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._residueTypes=Object.create(Jt.StandardTypes),this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[],this._molecules=[],this._maskNeedsUpdate=!1,this.metadata={},this.symmetry=[],this.units=[new GM(this)],this._currentUnit=0}addAtom(e){const t=this._atoms.length;return this._atoms.push(e),t}addSheet(e){const t=this._sheets.length;return this._sheets.push(e),t}addHelix(e){const t=this._helices.length;return this._helices.push(e),t}getAtoms(){return this._atoms}getBonds(){return this._bonds}getAtomCount(){return this._atoms.length}addResidue(e){const t=this._residues.length;return this._residues.push(e),t}updateToFrame(e){this.forEachChain(t=>{t.updateToFrame(e)})}addResidueType(e){return this._residueTypes[e]=new Jt(e,"Unknown","")}getResidueCount(){return this._residues.length}getResidues(){return this._residues}getSGroupCount(){return this._sgroups.length}getSGroups(){return this._sgroups}getAtomByFullname(e){const t=e.split(".");if(t.length!==3)return null;const n=t[0],i=parseInt(t[1],10);if(Number.isNaN(i))return null;const r=t[2].toUpperCase();let o=null;return this.forEachChain(a=>{o||a._name.localeCompare(n)===0&&a.forEachResidue(l=>{o||l._sequence===i&&l.forEachAtom(h=>{o||r.localeCompare(h.name)===0&&(o=h)})})}),o}addChain(e){const t=new FM(this,e);return this._chains.push(t),t}getChain(e){for(let t=0,n=this._chains.length;t<n;++t){const i=this._chains[t];if(i.getName()===e)return i}return null}getChainCount(){return this._chains.length}getMolecules(){return this._molecules}getMoleculeCount(){return this._molecules.length}forEachAtom(e){const t=this._atoms;for(let n=0,i=t.length;n<i;++n)e(t[n])}forEachBond(e){const t=this._bonds;for(let n=0,i=t.length;n<i;++n)e(t[n])}forEachResidue(e){const t=this._residues;for(let n=0,i=t.length;n<i;++n)e(t[n])}forEachChain(e){const t=this._chains;for(let n=0,i=t.length;n<i;++n)e(t[n])}forEachMolecule(e){const t=this._molecules,n=t.length;for(let i=0;i<n;++i)e(t[i])}forEachSGroup(e){const t=this._sgroups;for(let n=0,i=t.length;n<i;++n)e(t[n])}forEachComponent(e){const t=this._components;for(let n=0,i=t.length;n<i;++n)e(t[n])}forEachVisibleComponent(e){const t=this._components;for(let n=0,i=t.length;n<i;++n)e(t[n])}addBond(e,t,n,i,r){const o=new Eh(e,t,n,i,r);return this._bonds.push(o),o}getBondCount(){return this._bonds.length}getResidueType(e){return this._residueTypes[e]||null}getUnifiedSerial(e,t,n){return t+n*65536+e*16777216}splitUnifiedSerial(e){const i=Math.floor(e/16777216),r=e-i*16777216,o=Math.floor(r/65536),a=r-o*65536;return{chain:i,serial:a,iCode:o}}_fillCmpEdit(){const e=this,t=this._components;function n(){const i=new aS(e);return i._index=t.length,t[i._index]=i,i}this.forEachChain(i=>{const r=i._residues,o=r.length;if(o<1)return;let a=n(),l=r[0]._index;for(let h=0;h<o;++h){const u=r[h];u._component=a;const f=h===o-1?null:r[h+1];(!f||!u.isConnected(f)||u._index!==f._index-1)&&(a.setSubDivs([{start:l,end:u._index}]),f&&(l=f._index,a=n()))}})}_fillCmpNoedit(){const e=new aS(this);e._index=0;const t=this._residues,n=t.length;if(n===0)return;const i=[];let r=0;for(let o=0;o<n;++o){const a=t[o];a._component=e;const l=o===n-1?null:t[o+1];(!l||!a.isConnected(l))&&(i[i.length]={start:r,end:o},l&&(r=o+1))}e.setSubDivs(i),this._components[e._index]=e}_fillComponents(e){e?this._fillCmpEdit():this._fillCmpNoedit()}getCurrentUnit(){return this._currentUnit}getDefaultBoundaries(){return this.units[0].getBoundaries()}getBoundaries(){return this.units[this._currentUnit].getBoundaries()}getTransforms(){return this.units[this._currentUnit].getTransforms()}getSelector(){return this.units[this._currentUnit].getSelector()}resetCurrentUnit(){this._currentUnit=0,this.setCurrentUnit(1)}setCurrentUnit(e){return e!=null&&e!==this._currentUnit&&e>=0&&e<this.units.length?(this._currentUnit=e,!0):!1}_computeBounds(){const{units:e}=this;for(let t=0,n=e.length;t<n;++t)e[t].computeBoundaries()}onAtomPositionChanged(){this.forEachChain(e=>{e._finalize()}),this.forEachComponent(e=>{e.update()}),this._computeBounds(),this._finalizeBonds(),this.forEachSGroup(e=>{e._rebuildSGroupOnAtomChange()})}update(){this._maskNeedsUpdate&&(this.updateStructuresMask(),this._maskNeedsUpdate=!1)}_finalizeBonds(){const e=this.getBonds(),t=e.length;for(let n=0;n<t;++n)e[n]._index=n}finalize(e){e=e||{};const t=this._bonds;let n,i;for(n=t.length-1;n>=0;n--){const g=t[n];g._left===null||g._right===null?t.splice(n,1):(g._left.bonds.push(g),g._right.bonds.push(g))}const r=this._residues;for(n=0,i=r.length;n<i;++n)r[n]._finalize();this.forEachChain(g=>{g._finalize()});const{units:o}=this;for(n=0,i=o.length;n<i;++n)o[n].finalize();this.setCurrentUnit(1);const a={};for(n=0,i=r.length;n<i;++n){const g=r[n];a[this.getUnifiedSerial(g.getChain().getName().charCodeAt(0),g.getSequence(),g.getICode().charCodeAt(0))]=g}const{structures:l}=this;for(n=0,i=l.length;n<i;++n)l[n]._finalize(e.serialAtomMap,a,this);const h=this._helices;for(n=0,i=h.length;n<i;++n)h[n]._finalize(e.serialAtomMap,a,this);const u=this._sheets;for(n=0,i=u.length;n<i;++n)u[n]._finalize(e.serialAtomMap,a,this);this._computeBounds();const f=this._atoms;for(n=0,i=f.length;n<i;++n){const g=f[n];g.index=n}if(e.needAutoBonding){const g=new P5(this);g.build(),g.destroy()}const p=this._chains;for(n=0,i=p.length;n<i;++n)p[n]._index=n;for(n=0,i=r.length;n<i;++n)r[n]._index=n;for(n=0,i=f.length;n<i;++n){const g=f[n];if(g.flags&Vr.Flags.HYDROGEN&&g.bonds.length===1){const v=g.bonds[0];(v._left!==g&&v._left||v._right).flags&Vr.Flags.CARBON&&(g.flags|=Vr.Flags.NONPOLARH)}}this._finalizeBonds(),this._fillComponents(e.enableEditing);const m=new V5(this);m.markCycles(),e.detectAromaticLoops&&m.detectCycles(),this._finalizeMolecules()}_finalizeMolecules(){for(let e=0;e<this._molecules.length;e++){const t=this._molecules[e],n=t.residues.length;for(let i=0;i<n;i++){const r=t.residues[i];r._molecule=t}}}updateStructuresMask(){const e=t=>t.collectMask();this.forEachResidue(e),this.forEachChain(e),this.forEachMolecule(e)}countAtomsByMask(e){let t=0;return this.forEachAtom(n=>{n.mask&e&&t++}),t}getNumAtomsBySelector(e){let t=0;return this.forEachAtom(n=>{e.includesAtom(n)&&t++}),t}resetAtomMask(e){this.forEachAtom(t=>{t.mask=e})}markAtoms(e,t){const n=t,i=~n;let r=0;const o=ea.keyword("And")(e,this.getSelector());return this.forEachAtom(a=>{o.includesAtom(a)?(a.mask|=n,r++):a.mask&=i}),this._maskNeedsUpdate=!0,r}markAtomsAdditionally(e,t){const n=t;let i=0;return this.forEachAtom(r=>{e.includesAtom(r)&&(r.mask&t)!==t&&(r.mask|=n,i++)}),i}clearAtomBits(e){const t=~e;this.forEachAtom(i=>{i.mask&=t});const n=i=>{i._mask&=t};this.forEachAtom(n),this.forEachResidue(n),this.forEachChain(n),this.forEachMolecule(n)}getAtomNames(){if(this.hasOwnProperty("_atomNames"))return this._atomNames;const e={};return this.forEachAtom(t=>{e[t.name]=1}),this._atomNames=Object.keys(e),this._atomNames}getElements(){if(this.hasOwnProperty("_elements"))return this._elements;const e={};return this.forEachAtom(t=>{e[t.element.name]=1}),this._elements=Object.keys(e),this._elements}getResidueNames(){if(this.hasOwnProperty("_residueNames"))return this._residueNames;const e={};return this.forEachResidue(t=>{e[t._type._name]=1}),this._residueNames=Object.keys(e),this._residueNames}getChainNames(){if(this.hasOwnProperty("_chainNames"))return this._chainNames;const e={};return this.forEachChain(t=>{e[t._name]=1}),this._chainNames=Object.keys(e),this._chainNames}getAltLocNames(){if(this.hasOwnProperty("_altlocNames"))return this._altlocNames;const e={};return this.forEachAtom(t=>{e[String.fromCharCode(t.location)]=1}),this._altlocNames=Object.keys(e),this._altlocNames}getVoxelWorld(){if(!this.hasOwnProperty("_voxelWorld"))try{this._voxelWorld=new WM(this.getDefaultBoundaries().boundingBox,new b.Vector3(Hm,Hm,Hm)),this._voxelWorld.addAtoms(this)}catch{In.warn("Unable to create voxel world"),this._voxelWorld=null}return this._voxelWorld}addElement(e,t,n,i){const{length:r}=e;for(let o=0;o<r;++o){const a=e[o];i(a,n),t.push(a)}}joinComplexes(e){this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[];const t=this;let n=0,i=0,r=0,o=0,a=0;function l(g,v){g.serial+=v,g.index+=v}function h(g,v){g._index+=v}function u(g,v){g._index+=v}function f(g,v){g._complex=t,g._index+=v}function p(g,v){g._complex=t,g._index+=v}function m(){}for(let g=0;g<e.length;++g){const v=e[g];this.addElement(v._atoms,this._atoms,n,l),this.addElement(v._bonds,this._bonds,i,h),this.addElement(v._residues,this._residues,r,u),this.addElement(v._chains,this._chains,o,f),this.addElement(v._sheets,this._sheets,0,m),this.addElement(v._helices,this._helices,0,m),this.addElement(v._sgroups,this._sgroups,0,m),this.addElement(v._components,this._components,a,p),this.addElement(v.structures,this.structures,0,m);for(const y in v._residueTypes)v._residueTypes.hasOwnProperty(y)&&(this._residueTypes[y]=v._residueTypes[y]);n+=v._atoms.length,i+=v._bonds.length,r+=v._residues.length,o+=v._chains.length,a+=v._components.length}this._computeBounds()}dssp(){const e=new __(this),t=this.structures=[],n=this._helices=[],i=this._sheets=[],r=u=>{let f=i[u];return f||(f=i[u]=new DM(String(u),0)),f};let o,a,l=0,h=null;for(let u=0,f=this._residues.length;u<f;++u){const p=e._ss[u],m=this._residues[u],g=e._sheet[u];if(p===o&&g===a){m._secondary=h,h&&(h.term=m),h instanceof tg&&h.length++;continue}const v=Y5[p],y=j5[p];if(p===Ks.STRAND){const x=r(g);h=new u_(x,m,m,0,null,null),x.addStrand(h)}else v!==void 0?(l++,h=new tg(v,m,m,l,String(l),"",1),n.push(h)):y!==void 0?h=new Hi(y,m,m):h=null;h&&t.push(h),m._secondary=h,o=p,a=g}this._sheets=i.filter(u=>!0)}}x_.prototype.id="Complex";x_.prototype.name="";const y_=x_;function gS(s){let e=2;for(s=s-1>>1;s;)e<<=1,s>>=1;return e}class Nf{constructor(e,t,n,i,r,o){switch(this._box=n.clone(),this._dimVec=Math.max(Math.floor(i||1),1),this._volumeInfo=o,t instanceof Array?[this._dimX,this._dimY,this._dimZ]=t:(this._dimX=t.x,this._dimY=t.y,this._dimZ=t.z),this._dimX=Math.max(Math.floor(this._dimX),1),this._dimY=Math.max(Math.floor(this._dimY),1),this._dimZ=Math.max(Math.floor(this._dimZ),1),this._rowElements=this._dimVec*this._dimX,this._planeElements=this._rowElements*this._dimY,this._totalElements=this._planeElements*this._dimZ,this._data=r||Oe.allocateTyped(e,this._totalElements),this._dimVec){case 1:break;case 2:this.getValue=function(a,l,h){const u=a*this._dimVec+l*this._rowElements+h*this._planeElements;return[this._data[u],this._data[u+1]]},this.setValue=function(a,l,h,u,f){const p=a*this._dimVec+l*this._rowElements+h*this._planeElements;this._data[p]=u,this._data[p+1]=f},this.addValue=function(a,l,h,u,f){const p=a*this._dimVec+l*this._rowElements+h*this._planeElements;this._data[p]+=u,this._data[p+1]+=f};break;case 3:this.getValue=function(a,l,h){const u=a*this._dimVec+l*this._rowElements+h*this._planeElements;return[this._data[u],this._data[u+1],this._data[u+2]]},this.setValue=function(a,l,h,u,f,p){const m=a*this._dimVec+l*this._rowElements+h*this._planeElements;this._data[m]=u,this._data[m+1]=f,this._data[m+2]=p},this.addValue=function(a,l,h,u,f,p){const m=a*this._dimVec+l*this._rowElements+h*this._planeElements;this._data[m]+=u,this._data[m+1]+=f,this._data[m+2]+=p};break;default:throw new Error("Volume: invalid vector dimension")}}getValue(e,t,n){return this._data[e+t*this._rowElements+n*this._planeElements]}setValue(e,t,n,i){this._data[e+t*this._rowElements+n*this._planeElements]=i}addValue(e,t,n,i){this._data[e+t*this._rowElements+n*this._planeElements]+=i}getDimensions(){return[this._dimX,this._dimY,this._dimZ]}getBox(){return this._box}getVolumeInfo(){return this._volumeInfo}getCellSize(){const e=new b.Vector3;this._box.getSize(e);const t=new b.Vector3;return t.x=this._dimX>1?e.x/(this._dimX-1):0,t.y=this._dimY>1?e.y/(this._dimY-1):0,t.z=this._dimZ>1?e.z/(this._dimZ-1):0,t}computeGradient(){if(this._dimVec!==1)return null;const e=new Nf(Float32Array,[this._dimX,this._dimY,this._dimZ],this._box,3),t=this.getCellSize(),n=new b.Vector3(-.5/t.x,-.5/t.y,-.5/t.z);function i(u,f,p){return Math.min(p,Math.max(f,u))}const r=this._dimX,o=this._dimY,a=this._dimZ,l=this._data;function h(u,f,p){return l[p*r*o+f*r+u]}for(let u=0;u<a;++u){const f=i(u-1,0,a-1),p=i(u+1,0,a-1);for(let m=0;m<o;++m){const g=i(m-1,0,o-1),v=i(m+1,0,o-1);for(let y=0;y<r;++y){const x=i(y-1,0,r-1),w=i(y+1,0,r-1);e.setValue(y,m,u,(h(w,m,u)-h(x,m,u))*n.x,(h(y,v,u)-h(y,g,u))*n.y,(h(y,m,p)-h(y,m,f))*n.z)}}}return e}normalize(){const e=this._data;let t=e[0],n=e[0];for(let r=1;r<e.length;++r)t=Math.min(t,e[r]),n=Math.max(n,e[r]);const i=1/(n-t);if(i!==0)for(let r=0;r<e.length;++r)e[r]=i*(e[r]-t)}getTiledTextureStride(){return[this._dimX+2,this._dimY+2]}buildTiledTexture(){let e=Math.ceil(Math.sqrt(this._dimZ*this._dimY/this._dimX)),t=e*(this._dimX+2)-1;t=gS(t),e=Math.floor(t/(this._dimX+2));const n=Math.ceil(this._dimZ/e);let i=n*(this._dimY+2)-1;i=gS(i);const r=new Uint8Array(t*i);let o,a;for(let h=0;h<n;++h)for(let u=0;u<this._dimY;++u){o=h*e*this._planeElements+u*this._rowElements,a=t*(h*(this._dimY+2)+u);for(let f=0;f<e;++f){for(let p=0;p<this._dimX;++p)r[a++]=255*this._data[o++];r[a++]=255*this._data[o-1],f<e-1&&(o+=this._planeElements-this._rowElements,r[a++]=255*this._data[o])}}for(let h=0;h<n;++h){o=t*(h*(this._dimY+2)+this._dimY-1),a=o+t;for(let u=0;u<t;++u)r[a++]=r[o++];if(h<n-1){o=t*(h+1)*(this._dimY+2),a=o-t;for(let u=0;u<t;++u)r[a++]=r[o++]}}const l=new b.DataTexture(r,t,i,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.ClampToEdgeWrapping,b.ClampToEdgeWrapping,b.LinearFilter,b.LinearFilter);return l.needsUpdate=!0,l}getData(){return this._data}getDirectIdx(e,t,n){return e*this._dimVec+t*this._rowElements+n*this._planeElements}getStrideX(){return this._dimVec}getStrideY(){return this._rowElements}getStrideZ(){return this._planeElements}}Nf.prototype.id="Volume";const XM=Nf;class q5{constructor(e,t,n){this.complex=e,this.name=t||"",this.residues=[],this.mask=1,this.index=n||-1}forEachResidue(e){const{residues:t}=this;for(let n=0,i=t.length;n<i;++n)e(t[n])}collectMask(){let e=4294967295;const{residues:t}=this;for(let n=0,i=t.length;n<i;++n)e&=t[n]._mask;this.mask=e}}const $5=q5,On={Atom:Vr,Element:ih,Bond:Eh,Residue:ef,ResidueType:Jt,Chain:FM,Helix:tg,Strand:u_,Sheet:DM,SGroup:x5,Assembly:m_,Complex:y_,Volume:XM,VoxelWorld:WM,selectors:ea,Molecule:$5};class v_ extends b.Object3D{constructor(e){super();const t=this;this._element=e,this._element.style.position="absolute",this.addEventListener("removed",()=>{t._element.parentNode!==null&&t._element.parentNode.removeChild(t._element)})}getElement(){return this._element}setTransparency(e){const t=this.getElement();if(t===null)return;if(e===1){t.style.display="none";return}t.style.display="inline";const n=1-e,i=n.toString(),r=n*100;t.style.opacity=i,t.style.filter=`alpha(opacity=${r})`}clone(){const e=new v_(this._element);return e.copy(this),e}}const S_=v_;class Z5 extends b.Group{raycast(e,t){if(!this.visible)return;const{children:n}=this;for(let i=0,r=n.length;i<r;++i)n[i].raycast(e,t)}enableSubset(e,t){const{children:n}=this;for(let i=0,r=n.length;i<r;++i)n[i].enableSubset&&n[i].enableSubset(e,t)}disableSubset(e,t){const{children:n}=this;for(let i=0,r=n.length;i<r;++i)n[i].disableSubset&&n[i].disableSubset(e,t)}isEmpty(){return this.children.length===0}updateToFrame(e){const{children:t}=this;for(let n=0,i=t.length;n<i;++n)t[n].updateToFrame&&t[n].updateToFrame(e)}getSubset(e,t){const n=[],{children:i}=this;for(let r=0,o=i.length;r<o;++r)i[r].getSubset&&Array.prototype.push.apply(n,i[r].getSubset(e,t));return n}}const oa=Z5,mo=`uniform mat4 projectionMatrix;\r
uniform mat4 modelViewMatrix;\r
\r
attribute vec2 uv;\r
attribute vec3 position;\r
\r
varying vec2 vUv;\r
\r
void main() {\r
  vUv = uv;\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r
}\r
`,K5=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform float opacity;\r
\r
void main() {\r
  vec4 color = texture2D(srcTex, vUv);\r
  gl_FragColor = vec4(color.xyz, color.a * opacity);\r
}\r
`,J5=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform float coef;\r
\r
void main() {\r
  vec2 uv = vUv * 2.0 - 1.0;\r
  float r2 = dot(uv, uv);\r
  vec2 tc = uv * (1.0 + coef * r2);\r
  if (!all(lessThan(abs(tc), vec2(1.0))))\r
    discard;\r
  tc = 0.5 * (tc + 1.0);\r
  gl_FragColor = texture2D(srcTex, tc);\r
}\r
`,rg={DEFAULT:0,VOLUME:1,TRANSPARENT:2,PREPASS_TRANSPARENT:3,VOLUME_BFPLANE:4,COLOR_FROM_POSITION:5,SHADOWMAP:6},_S=[rg.DEFAULT,rg.TRANSPARENT];b.Object3D.prototype.resetTransform=function(){this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1)};b.Object3D.prototype.updateMatrixWorldRecursive=function(){this.parent!=null&&this.parent.updateMatrixWorldRecursive(),this.updateMatrixWorld()};b.Object3D.prototype.addSavingWorldTransform=function(){const s=new b.Matrix4;return function(e){e instanceof b.Object3D&&(s.copy(this.matrixWorld).invert(),s.multiply(e.matrixWorld),e.matrix.copy(s),e.matrix.decompose(e.position,e.quaternion,e.scale),this.add(e))}}();b.WebGLRenderer.prototype.renderDummyQuad=function(){const s=new b.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1}),e=new b.Scene,t=new b.Mesh(new b.PlaneGeometry(.01,.01),s);e.add(t);const n=new b.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4);return n.position.z=100,function(){this.render(e,n)}}();b.WebGLRenderer.prototype.renderScreenQuad=function(){const s=new b.Scene,e=new b.Mesh(new b.PlaneGeometry(1,1));s.add(e);const t=new b.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4);return t.position.z=100,function(n){e.material=n,this.render(s,t)}}();b.Matrix4.prototype.isIdentity=function(){const s=new b.Matrix4;return function(){return s.equals(this)}}();b.Matrix4.prototype.applyToPointsArray=function(s,e,t){if(!s||!e||e<3)return s;t=t||0;const n=this.elements;for(let i=0;i<s.length;i+=e){const r=s[i],o=s[i+1],a=s[i+2],l=1/(n[3]*r+n[7]*o+n[11]*a+n[15]);s[i]=(n[0]*r+n[4]*o+n[8]*a+n[12]*t)*l,s[i+1]=(n[1]*r+n[5]*o+n[9]*a+n[13]*t)*l,s[i+2]=(n[2]*r+n[6]*o+n[10]*a+n[14]*t)*l}return s};class YM extends b.RawShaderMaterial{constructor(e){e.uniforms===void 0&&(e.uniforms={}),e.uniforms.srcTex={type:"t",value:null},e.vertexShader=mo,e.transparent=!1,e.depthTest=!1,e.depthWrite=!1,super(e)}}b.WebGLRenderer.prototype.renderScreenQuadFromTex=function(){const s=new YM({uniforms:{opacity:{type:"f",value:1}},fragmentShader:K5,transparent:!0});return function(e,t){s.uniforms.srcTex.value=e,s.transparent=t<1,s.uniforms.opacity.value=t,this.renderScreenQuad(s)}}();b.WebGLRenderer.prototype.renderScreenQuadFromTexWithDistortion=function(){const s=new YM({uniforms:{coef:{type:"f",value:1}},fragmentShader:J5});return function(e,t){s.uniforms.srcTex.value=e,s.uniforms.coef.value=t,this.renderScreenQuad(s)}}();b.PerspectiveCamera.prototype.setMinimalFov=function(s){this.aspect>=1?this.fov=s:this.fov=b.MathUtils.radToDeg(2*Math.atan(Math.tan(b.MathUtils.degToRad(s)*.5)/this.aspect))};b.StereoCamera.prototype.updateHalfSized=function(s,e){const t=s.aspect,n=s.fov;s.aspect=t/2,s.setMinimalFov(e),s.updateProjectionMatrix(),this.update(s),s.aspect=t,s.fov=n,s.updateProjectionMatrix()};b.PerspectiveCamera.prototype.setDistanceToFit=function(s,e){this.position.z=s/Math.sin(.5*b.MathUtils.degToRad(e))};b.Raycaster.prototype.intersectVisibleObject=function(s,e,t,n){const i=this.intersectObject(s,!1);if(i.length===0)return null;const r=Math.min(e.near,t);let o,a=i[0];const l=new b.Vector3;for(o=0;o<i.length&&(a=i[o],l.copy(a.point),l.applyMatrix4(e.matrixWorldInverse),!(l.z<=-r));++o);if(o===i.length)return null;const h=Math.min(e.far,n);return l.copy(a.point),l.applyMatrix4(e.matrixWorldInverse),l.z<=-h?null:a};b.Matrix4.prototype.extractScale=function(){const s=new b.Vector3;return function(e){e===void 0&&(In.debug("extractScale(): new is too expensive operation to do it on-the-fly"),e=s.clone());const t=this.elements;return e.x=s.set(t[0],t[1],t[2]).length(),e.y=s.set(t[4],t[5],t[6]).length(),e.z=s.set(t[8],t[9],t[10]).length(),this.determinant()<0&&(e.x=-e.x),e}}();function Q5(s,e,t){const n=s.clone().lerp(e,.5),i=new b.Matrix4;i.makeScale(t,s.distanceTo(e),t);const r=new b.Matrix4;r.makeRotationX(Math.PI/2);const o=new b.Matrix4,a=new b.Vector3(0,1,0);return o.lookAt(n,e,a),o.multiply(r),o.multiply(i),o.setPosition(n),o}function ez(s,e,t,n){const i=new b.Matrix4;i.makeScale(n.x,n.y,0);const r=new b.Matrix4;return r.lookAt(s,e,t),r.multiply(i),r.setPosition(s),r}function tz(s){let e=!1;return s.traverse(t=>{(t.hasOwnProperty("geometry")||t instanceof S_)&&(e=!0)}),e}function nz(s,e,t){function n(o){let l=0,h=o,u=1;for(;Math.abs(h-l)>1e-5;)u=1+t*h,l=h,h=o/(u*u);return 1/u}const i=new b.PlaneGeometry(2,2,s,e),r=i.getAttribute("position");for(let o=0;o<r.count;++o){const a=r.array[3*o],l=r.array[3*o+1],h=n(a*a+l*l);r.setXY(o,h*a,h*l)}return i}b.BufferAttribute.prototype.copyAtList=function(s,e){console.assert(this.itemSize===s.itemSize,"DEBUG: BufferAttribute.copyAtList buffers have different item size.");const{itemSize:t}=this;for(let n=0,i=e.length;n<i;++n)for(let r=0;r<t;++r)this.array[n*t+r]=s.array[e[n]*t+r];return this};function iz(s,e,t,n){t=typeof t<"u"?t:0,n=typeof n<"u"?n:s.length;for(let i=t;i<n;++i)s[i]=e}function rz(s){const{children:e}=s;for(let t=0,n=e.length;t<n;++t){const i=e[t];i.parent=null,i.dispatchEvent({type:"removed"})}s.children=[]}function jM(s){s.traverse(e=>{(e instanceof b.Mesh||e instanceof b.LineSegments||e instanceof b.Line)&&e.geometry.dispose()}),rz(s)}function sz(s){jM(s),s.parent?s.parent.remove(s):s.dispatchEvent({type:"removed"})}function oz(s){for(let e=0;e<_S.length;e++)if((s.layers.mask>>_S[e]&1)===1)return!0;return!1}function az(s,e){const t=+(e!=="BA");s.traverse(n=>{n.isGroup&&(n.renderOrder=t)})}function lz(s){s.traverse(e=>{"material"in e&&(e.material=e.material.clone(!0),e.material.setValues({depthFunc:b.LessEqualDepth,overrideColor:!0,fog:!1,lights:!1,shadowmap:!1}),e.material.setUberOptions({fixedColor:new b.Color(16776960),zOffset:-1e-6}))})}function cz(s,e,t){const n=t||new b.Vector3;return n.set(0,0,0),n.addScaledVector(s,.5),n.addScaledVector(e,.5),n}const hz=b.InstancedBufferGeometry.prototype.copy;b.InstancedBufferGeometry.prototype.copy=function(s){hz.call(this,s),this.instanceCount===void 0&&(this.instanceCount=1/0)};const yt={calcCylinderMatrix:Q5,calcChunkMatrix:ez,groupHasGeometryToRender:tz,buildDistorionMesh:nz,RCGroup:oa,fillArray:iz,clearTree:jM,destroyObject:sz,belongToSelectLayers:oz,processObjRenderOrder:az,applySelectionMaterial:lz,getMiddlePoint:cz,LAYERS:rg},uz={boundingBox:new b.Box3(new b.Vector3(-1,-1,-1),new b.Vector3(1,1,1)),boundingSphere:new b.Sphere(new b.Vector3(0,0,0),1)};class dz extends yt.RCGroup{constructor(e,t){super(e,t),this.name=e,this._dataSource=t}release(){this.parent&&this.parent.remove(this)}getDataSource(){return this._dataSource}getBoundaries(){return uz}}const sh=dz;function xS(s){return s==null||Array.isArray(s)?s:[s]}class fl{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["id"];this._list=[],this._dict={},this._indices=[...t],this._indices.forEach(n=>{this._dict[n]={}}),e.forEach(n=>this.register(n))}static registerInList(e,t){e.includes(t)||e.push(t)}static unregisterFromList(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}static registerInDict(e,t,n){t.forEach(i=>{i=i.toLowerCase();const r=e[i]=e[i]||[];r.includes(n)||r.push(n)})}static unregisterFromDict(e,t,n){t.forEach(i=>{i=i.toLowerCase();const r=e[i];if(r){const o=r.indexOf(n);o!==-1&&r.splice(o,1),r.length===0&&delete e[i]}})}register(e){fl.registerInList(this._list,e),this._indices.forEach(t=>{fl.registerInDict(this._dict[t],xS(e[t]),e)})}unregister(e){fl.unregisterFromList(this._list,e),this._indices.forEach(t=>{fl.unregisterFromDict(this._dict[t],xS(e[t]),e)})}get all(){return[...this._list]}get first(){return this._list[0]}keys(e){return Object.keys(this._dict[e||this._indices[0]])}get(e,t){const n=this._dict[t||this._indices[0]];if(n){const i=n[e&&e.toLowerCase()];return i&&i.length>0?i[0]:void 0}}}const aa=fl;function fz(s){Object.defineProperties(s,{logger:{get(){return this.context&&this.context.logger?this.context.logger:In}},settings:{get(){return this.context&&this.context.settings?this.context.settings:pe}}})}const Ah=fz,af=class af{constructor(e,t){this._position=e,this._radius=t}raycast(e){const t=af._sphere;t.set(this._position,this._radius);const n=new b.Vector3;return e.ray.intersectSphere(t,n)?{distance:e.ray.origin.distanceTo(n),point:n}:null}};lt(af,"_sphere",new b.Sphere);let sg=af;const pz=s=>class extends s{constructor(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];super(...n),this._objects=new Array(e),this.boundingSphere=null,this.boundingBox=null}setSphere(e,t,n){this._objects[e]=new sg(t,n)}raycast(e,t){for(let n=0,i=this._objects.length;n<i;++n){const r=this._objects[n].raycast(e);r&&(r.chunkIdx=n,t.push(r))}}computeBoundingBox(){const e=this._objects;let{boundingBox:t}=this;t===null&&(this.boundingBox=t=new b.Box3),t.makeEmpty();for(let n=0,i=e.length;n<i;++n)t.expandByPoint(e[n]._position)}computeBoundingSphere(){this.computeBoundingBox();const e=this._objects,{boundingBox:t}=this;let n=0;const i=new b.Vector3;t.getCenter(i);for(let r=0,o=e.length;r<o;++r){const a=e[r]._position,l=i.distanceToSquared(a);n<l&&(n=l)}this.boundingSphere===null&&(this.boundingSphere=new b.Sphere),this.boundingSphere.set(i,Math.sqrt(n))}},b_=pz,bd=new b.Color,wd=4,Md=3,{copySubArrays:yS}=Oe;function mz(s,e,t,n,i){s[e]=t,s[e+1]=n,s[e+2]=i}function gz(s,e,t,n,i,r){s[e]=t,s[e+1]=n,s[e+2]=i,s[e+3]=r}class _z extends b_(b.InstancedBufferGeometry){constructor(e,t,n){super(e),this._sphGeometry=n?new b.PlaneGeometry(2,2,1,1):new b.SphereBufferGeometry(1,t*2,t,0,Math.PI*2,0,Math.PI),this._init(e,this._sphGeometry)}setItem(e,t,n){gz(this._offsets,e*wd,t.x,t.y,t.z,n),this.setSphere(e,t,n)}setColor(e,t){bd.set(t),mz(this._colors,e*Md,bd.r,bd.g,bd.b)}startUpdate(){return!0}finishUpdate(){this.getAttribute("offset").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}finalize(){this.finishUpdate(),this.computeBoundingSphere()}setOpacity(e,t){const n=this._alpha;for(let i=0,r=e.length;i<r;++i)n[e[i]]=t;this.getAttribute("alphaColor").needsUpdate=!0}getSubset(e){const t=e.length,n=new b.InstancedBufferGeometry;return this._init.call(n,t,this._sphGeometry),yS(this._offsets,n._offsets,e,wd),yS(this._colors,n._colors,e,Md),n.boundingSphere=this.boundingSphere,n.boundingBox=this.boundingBox,[n]}_init(e,t){this.copy(t),this._offsets=Oe.allocateTyped(Float32Array,e*wd),this._colors=Oe.allocateTyped(Float32Array,e*Md);const n=this._alpha=Oe.allocateTyped(Float32Array,e);Me.default.fill(n,1),this.setAttribute("offset",new b.InstancedBufferAttribute(this._offsets,wd,!1,1)),this.setAttribute("color",new b.InstancedBufferAttribute(this._colors,Md,!1,1)),this.setAttribute("alphaColor",new b.InstancedBufferAttribute(n,1,!1,1))}}const qM=_z,xz=65535,Gs=3,Ed=new b.Color;class w_ extends b.BufferGeometry{constructor(e,t){if(super(),this.constructor===w_)throw new Error("Can not instantiate abstract class!");this._chunkGeo=e,this._init(e,t)}startUpdate(){return!0}finishUpdate(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("normal").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}setColor(e,t){Ed.set(t);const n=this._colors,i=this._chunkSize;for(let r=e*i,o=r+i;r<o;++r){const a=r*Gs;n[a]=Ed.r,n[a+1]=Ed.g,n[a+2]=Ed.b}}finalize(){this.finishUpdate(),this.computeBoundingSphere()}setOpacity(e,t){const n=this._alpha,i=this._chunkSize;for(let r=0,o=e.length;r<o;++r){const a=e[r]*i;Me.default.fill(n,t,a,a+i)}this.getAttribute("alphaColor").needsUpdate=!0}raycast(e,t){const n=[],i=new b.Mesh;i.geometry=this,i.raycast(e,n);const r=this._chunkGeo.index.count/3;for(let o=0,a=n.length;o<a;++o)n[o].hasOwnProperty("faceIndex")&&(n[o].chunkIdx=Math.floor(n[o].faceIndex/r),t.push(n[o]))}getSubset(e){const t=e.length,n=new b.BufferGeometry;this._init.call(n,this._chunkGeo,t);const i=this._positions,r=this._normals,o=this._colors,a=n._positions,l=n._normals,h=n._colors,u=this._chunkSize*Gs;for(let f=0,p=e.length;f<p;++f){const m=f*u,g=e[f]*u,v=g+u;a.set(i.subarray(g,v),m),l.set(r.subarray(g,v),m),h.set(o.subarray(g,v),m)}return n.boundingSphere=this.boundingSphere,n.boundingBox=this.boundingBox,[n]}_init(e,t){const n=this._chunkSize=e.attributes.position.count,i=e.index.array,r=i.length,o=this._chunkSize*t,a=o>xz,l=r*t,h=this._index=Oe.allocateTyped(a?Uint32Array:Uint16Array,l);this._positions=Oe.allocateTyped(Float32Array,o*Gs),this._normals=Oe.allocateTyped(Float32Array,o*Gs),this._colors=Oe.allocateTyped(Float32Array,o*Gs);const u=this._alpha=Oe.allocateTyped(Float32Array,o);Me.default.fill(u,1);for(let f=0;f<t;++f){const p=f*r,m=f*n;h.set(i,p);for(let g=0;g<r;++g)h[p+g]+=m}this.setIndex(new b.BufferAttribute(this._index,1)),this.setAttribute("position",new b.BufferAttribute(this._positions,Gs)),this.setAttribute("normal",new b.BufferAttribute(this._normals,Gs)),this.setAttribute("color",new b.BufferAttribute(this._colors,Gs)),this.setAttribute("alphaColor",new b.BufferAttribute(u,1))}}const Ff=w_,Wm=3;class yz extends b_(Ff){constructor(e,t){const n=new b.SphereBufferGeometry(1,t*2,t,0,Math.PI*2,0,Math.PI);super(e,n,e);const i=this._normals,r=n.attributes.normal.array,o=this._chunkSize;this._chunkPos=this._chunkGeo.attributes.position.array,this._tmpPositions=Oe.allocateTyped(Float32Array,o*Wm);for(let a=0;a<e;++a)i.set(r,o*Wm*a)}setItem(e,t,n){const i=this._tmpPositions,r=this._chunkSize,o=this._chunkPos;for(let a=0;a<r;++a){const l=a*3;i[l]=t.x+o[l]*n,i[l+1]=t.y+o[l+1]*n,i[l+2]=t.z+o[l+2]*n}this._positions.set(i,r*e*Wm),this.setSphere(e,t,n)}}const vz=yz,Ka=3,Ja=new b.Vector3,Qa=new b.Vector3,vS=new b.Matrix3;class Sz extends Ff{constructor(e,t){const n=new b.CylinderGeometry(1,1,1,Math.max(3,t),2,!0);super(n,2*e);const i=this._chunkSize;this._chunkPos=this._chunkGeo.attributes.position.array,this._chunkNorms=this._chunkGeo.attributes.normal.array,this._tmpVector=Oe.allocateTyped(Float32Array,i*Ka)}setItem(e,t,n,i){const r=this._chunkSize,o=r*2*e*Ka,a=o+r*Ka,l=this._tmpVector,h=this._chunkPos,u=this._chunkNorms;Ja.lerpVectors(t,n,.5);const f=yt.calcCylinderMatrix(t,Ja,i);vS.getNormalMatrix(f);let p;for(let m=0;m<r;++m)p=m*Ka,Qa.fromArray(h,p),Qa.applyMatrix4(f),Qa.toArray(l,p);this._positions.set(l,o),Ja.sub(t);for(let m=0;m<r;++m)p=m*Ka,l[p]+=Ja.x,l[p+1]+=Ja.y,l[p+2]+=Ja.z;this._positions.set(l,a);for(let m=0;m<r;++m)p=m*Ka,Qa.fromArray(u,p),Qa.applyMatrix3(vS),Qa.toArray(l,p);this._normals.set(l,o),this._normals.set(l,a)}setColor(e,t,n){const i=2*e;super.setColor(i,t);const r=i+1;super.setColor(r,n)}}const M_=Sz,bz=65536,Ec=3;class E_ extends b.BufferGeometry{constructor(e,t,n,i,r,o){super();const a=0,l=2*Math.PI;this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o};const h=o===!1&&e>0,u=o===!1&&t>0,f=(r+1)*i+h*(i+1)+u*(i+1),p=(2*r+h+u)*i,m=n/2,g=new b.BufferAttribute(Oe.allocateTyped(Float32Array,f*3),3),v=new b.BufferAttribute(Oe.allocateTyped(Float32Array,f*3),3),y=new b.Uint16BufferAttribute(Oe.allocateTyped(Uint16Array,p*Ec),1),x=new b.BufferAttribute(Oe.allocateTyped(Float32Array,f*2),2);console.assert(f<bz,"DEBUG: Cylinder Geometry has too many vertices (65536 max).");let w=0,S=0;const E=-(t-e)/n;for(let A=0;A<=r;A++){if(A!==r)for(let L=0;L<i;L++){const T=w+L,R=w+i+L,G=w+i+(L+1)%i,K=w+(L+1)%i;y.setXYZ(S*Ec,T,K,R),S++,y.setXYZ(S*Ec,R,K,G),S++}const C=A/r,P=C*(t-e)+e;for(let L=0;L<i;L++){const T=L/i,R=P*Math.sin(T*l+a),G=C*n-m,K=P*Math.cos(T*l+a),Z=new b.Vector3(R,Math.sqrt(R*R+K*K)*E,K).normalize();g.setXYZ(w,R,G,K),v.setXYZ(w,Z.x,Z.y,Z.z),x.setXY(w,T,C),++w}}if(h){const A=w,C=w+i;for(let P=0;P<i;++P){const L=w-i;g.setXYZ(w,g.getX(L),g.getY(L),g.getZ(L)),v.setXYZ(w,0,1,0),x.setXY(w,1,1);const T=A+(P+1)%i;y.setXYZ(S*Ec,w,T,C),S++,w++}g.setXYZ(w,0,m,0),v.setXYZ(w,0,1,0),x.setXY(w,1,1),++w}if(u){const A=w,C=w+i;for(let P=0;P<i;++P){const L=P;g.setXYZ(w,g.getX(L),g.getY(L),g.getZ(L)),v.setXYZ(w,0,-1,0),x.setXY(w,0,0);const T=A+(P+1)%i;y.setXYZ(S*Ec,T,w,C),S++,w++}g.setXYZ(w,0,-m,0),v.setXYZ(w,0,-1,0),x.setXY(w,0,0)}this.setIndex(y),this.setAttribute("position",g),this.setAttribute("normal",v),this.setAttribute("uv",x)}clone(){const{parameters:e}=this;return new E_(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded)}}const wz=E_,Hs=new b.Color,SS=new b.Matrix4,Pn=4,fs=3,{copySubArrays:Ws}=Oe;function bS(s,e,t,n,i){s[e]=t,s[e+1]=n,s[e+2]=i}function el(s,e,t,n,i,r){s[e]=t,s[e+1]=n,s[e+2]=i,s[e+3]=r}function Mz(s,e){return s-e}function Ez(s){s.sort(Mz);const e=[],t=[];for(let n=0,i=s.length;n<i;++n){const r=s[n],o=(r|0)%2===0,a={first:!1,second:!1};o?(a.first=!0,a.second=n+1<i&&s[n+1]===s[n]+1,a.second&&++n):a.second=!0,e.push(Math.floor(r/2)),t.push(a)}return{indices:e,cylinderInfo:t}}function Az(s,e,t){for(let n=0,i=s.length;n<i;++n){const r=s[n];r.first||(e[fs*n]=-.5),r.second||(t[fs*n]=-.5)}}class Tz extends b.InstancedBufferGeometry{constructor(e,t,n,i){super(),this._useZSprites=n,this._cylGeometry=n?new b.PlaneGeometry(2,2,1,1):new wz(1,1,1,Math.max(3,t),2,i),this._init(e,this._cylGeometry,this._useZSprites),this._collisionGeo=new M_(e,3)}setItem(e,t,n,i){const r=yt.calcCylinderMatrix(t,n,i);let o=r.elements;const a=e*Pn;this._collisionGeo.setItem(e,t,n,i),el(this._matVector1,a,o[0],o[4],o[8],o[12]),el(this._matVector2,a,o[1],o[5],o[9],o[13]),el(this._matVector3,a,o[2],o[6],o[10],o[14]),this._useZSprites&&(SS.copy(r).invert(),o=SS.elements,el(this._invmatVector1,a,o[0],o[4],o[8],o[12]),el(this._invmatVector2,a,o[1],o[5],o[9],o[13]),el(this._invmatVector3,a,o[2],o[6],o[10],o[14]))}setColor(e,t,n){const i=e*fs;Hs.set(t),bS(this._color1,i,Hs.r,Hs.g,Hs.b),Hs.set(n),bS(this._color2,i,Hs.r,Hs.g,Hs.b)}computeBoundingSphere(){this._collisionGeo.computeBoundingSphere(),this.boundingSphere=this._collisionGeo.boundingSphere}computeBoundingBox(){this._collisionGeo.computeBoundingBox(),this.boundingBox=this._collisionGeo.boundingBox}raycast(e,t){this._collisionGeo.raycast(e,t)}startUpdate(){return!0}finishUpdate(){this.getAttribute("matVector1").needsUpdate=!0,this.getAttribute("matVector2").needsUpdate=!0,this.getAttribute("matVector3").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("color2").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this._useZSprites&&(this.getAttribute("invmatVector1").needsUpdate=!0,this.getAttribute("invmatVector2").needsUpdate=!0,this.getAttribute("invmatVector3").needsUpdate=!0),this._collisionGeo.finishUpdate()}finalize(){this.finishUpdate(),this.computeBoundingSphere()}setOpacity(e,t){const n=this._alpha;for(let i=0,r=e.length;i<r;++i)n[Math.floor(e[i]/2)]=t;this.getAttribute("alphaColor").needsUpdate=!0}getSubset(e){const t=Ez(e),n=t.indices,i=n.length,r=new b.InstancedBufferGeometry;return this._init.call(r,i,this._cylGeometry,this._useZSprites),Ws(this._matVector1,r._matVector1,n,Pn),Ws(this._matVector2,r._matVector2,n,Pn),Ws(this._matVector3,r._matVector3,n,Pn),this._useZSprites&&(Ws(this._invmatVector1,r._invmatVector1,n,Pn),Ws(this._invmatVector2,r._invmatVector2,n,Pn),Ws(this._invmatVector3,r._invmatVector3,n,Pn)),Ws(this._color1,r._color1,n,fs),Ws(this._color2,r._color2,n,fs),Az(t.cylinderInfo,r._color1,r._color2),r.boundingSphere=this.boundingSphere,r.boundingBox=this.boundingBox,[r]}getGeoParams(){return this._cylGeometry.parameters}_init(e,t,n){this.copy(t),this._matVector1=Oe.allocateTyped(Float32Array,e*Pn),this._matVector2=Oe.allocateTyped(Float32Array,e*Pn),this._matVector3=Oe.allocateTyped(Float32Array,e*Pn),this._color1=Oe.allocateTyped(Float32Array,e*fs),this._color2=Oe.allocateTyped(Float32Array,e*fs);const i=this._alpha=Oe.allocateTyped(Float32Array,e);Me.default.fill(i,1),this.setAttribute("matVector1",new b.InstancedBufferAttribute(this._matVector1,Pn,!1,1)),this.setAttribute("matVector2",new b.InstancedBufferAttribute(this._matVector2,Pn,!1,1)),this.setAttribute("matVector3",new b.InstancedBufferAttribute(this._matVector3,Pn,!1,1)),this.setAttribute("color",new b.InstancedBufferAttribute(this._color1,fs,!1,1)),this.setAttribute("color2",new b.InstancedBufferAttribute(this._color2,fs,!1,1)),this.setAttribute("alphaColor",new b.InstancedBufferAttribute(this._alpha,1,!1,1)),n&&(this._invmatVector1=Oe.allocateTyped(Float32Array,e*Pn),this._invmatVector2=Oe.allocateTyped(Float32Array,e*Pn),this._invmatVector3=Oe.allocateTyped(Float32Array,e*Pn),this.setAttribute("invmatVector1",new b.InstancedBufferAttribute(this._invmatVector1,Pn,!1,1)),this.setAttribute("invmatVector2",new b.InstancedBufferAttribute(this._invmatVector2,Pn,!1,1)),this.setAttribute("invmatVector3",new b.InstancedBufferAttribute(this._invmatVector3,Pn,!1,1)))}}const $M=Tz,ti=3,Xm=3,tl=new b.Vector3,nl=new b.Vector3,Ad=new b.Vector3,Cz=new b.Vector3(1,0,0),wS=new b.Vector3,MS=new b.Vector3;function Rz(s,e){const t=new b.BufferGeometry,n=s.length,i=n*e,r=i<=65536?Uint16Array:Uint32Array,o=(e-1)*n*2,a=new b.BufferAttribute(Oe.allocateTyped(r,o*Xm),1);let l=0,h=0;for(let f=0;f<e;f++){if(f!==e-1)for(let p=0;p<n;p++){const m=l+p,g=l+n+p,v=l+n+(p+1)%n,y=l+(p+1)%n;a.setXYZ(h*Xm,m,y,g),h++,a.setXYZ(h*Xm,g,y,v),h++}l+=n}t.setIndex(a);const u=Oe.allocateTyped(Float32Array,i*ti);return t.setAttribute("position",new b.BufferAttribute(u,ti)),t._positions=s,t}class Pz extends Ff{constructor(e,t,n){const i=Rz(e,t);super(i,n),this._ringsCount=t;const r=this._tmpShape=[];for(let o=0;o<e.length;++o)r[o]=new b.Vector3}setItem(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=this._chunkGeo._positions.length,o=this._ringsCount,a=r*this._ringsCount*e*ti;this._setPoints(t,r,o,a),n?this._setSlopeNormals(r,o,a):this._setBaseNormals(r,o,a),i&&this._addCut(r,o,a)}_setPoints(e,t,n,i){const r=this._tmpShape,o=this._positions,a=this._chunkGeo._positions;for(let l=0,h=i;l<n;++l){const u=e[l];for(let f=0;f<t;++f,h+=ti)r[f].copy(a[f]).applyMatrix4(u).toArray(o,h)}}_setBaseNormals(e,t,n){const i=e*ti;for(let r=0,o=n;r<t;++r,o+=i)this._countNormalsInRing(e,o,!1)}_setSlopeNormals(e,t,n){const i=this._normals,r=e*ti;let o=n;for(let a=0;a<e;++a,o+=ti)Cz.toArray(i,o);if(o-2*r>0)for(let a=0;a<e;++a,o+=ti)Ad.fromArray(i,o-2*r).toArray(i,o);else this._countNormalsInRing(e,o,!0,+r),o+=r;for(let a=2;a<t;++a,o+=r)this._countNormalsInRing(e,o,!0,-r)}_countNormalsInRing(e,t,n,i){const r=this._tmpShape,o=this._normals;r[0].fromArray(this._positions,t),r[e-1].fromArray(this._positions,t+(e-1)*ti);for(let a=0;a<e;++a,t+=ti)a<e-1&&r[a+1].fromArray(this._positions,t+ti),n?(MS.fromArray(this._positions,t+i),tl.subVectors(r[(a+e-1)%e],r[(a+1)%e]).normalize(),nl.subVectors(r[a],MS).normalize(),Ad.crossVectors(nl,tl).normalize().toArray(o,t)):(tl.subVectors(r[a],r[(a+e-1)%e]).normalize(),nl.subVectors(r[a],r[(a+1)%e]).normalize(),Ad.addVectors(tl,nl).normalize().toArray(o,t))}_addCut(e,t,n){if(e<3||t<2)return;const i=this._positions,r=this._normals,o=this._tmpShape,a=e*ti;o[0].fromArray(i,n),o[1].fromArray(i,n+ti),o[2].fromArray(i,n+2*ti),tl.subVectors(o[1],o[0]).normalize(),nl.subVectors(o[1],o[2]).normalize(),wS.crossVectors(tl,nl).normalize();let l=n;for(let h=0;h<e*2;++h,l+=ti)wS.toArray(r,l);if(t>2)for(let h=0;h<e;++h,l+=ti)Ad.fromArray(i,l-a).toArray(i,l)}}const Iz=Pz,Lz=65535,zi=4,hs=4,Xs=3,Ys=3,Ui=new b.Color,yi=new b.Vector3;function js(s,e,t,n,i){s[e]=t,s[e+1]=n,s[e+2]=i}function Td(s,e,t,n,i,r){s[e]=t,s[e+1]=n,s[e+2]=i,s[e+3]=r}function Cd(s,e,t,n){const i=e*zi,r=i+t*zi;return s.subarray(i*n,r*n)}class Nz extends b.BufferGeometry{constructor(e){super(),this._initVertices(e)}startUpdate(){return!0}finishUpdate(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this.getAttribute("direction").needsUpdate=!0}setColor(e,t){Ui.set(t);let n=e*zi*Ys;js(this._colors,n,Ui.r,Ui.g,Ui.b),n+=Ys,js(this._colors,n,Ui.r,Ui.g,Ui.b),n+=Ys,js(this._colors,n,Ui.r,Ui.g,Ui.b),n+=Ys,js(this._colors,n,Ui.r,Ui.g,Ui.b)}setSegment(e,t,n){yi.subVectors(t,n),yi.normalize();const i=this._positions,r=this._directions;let o=e*zi*hs,a=e*zi*Xs;Td(i,o,t.x,t.y,t.z,.5),js(r,a,yi.x,yi.y,yi.z),o+=hs,a+=Xs,Td(i,o,t.x,t.y,t.z,-.5),js(r,a,yi.x,yi.y,yi.z),o+=hs,a+=Xs,Td(i,o,n.x,n.y,n.z,.5),js(r,a,yi.x,yi.y,yi.z),o+=hs,a+=Xs,Td(i,o,n.x,n.y,n.z,-.5),js(r,a,yi.x,yi.y,yi.z)}setOpacity(e,t,n){const i=e*zi,r=t*zi;Me.default.fill(this.alpha,n,r,i),this.getAttribute("alphaColor").needsUpdate=!0}getSubsetSegments(e,t){return[Cd(this._positions,e,t,hs),Cd(this._directions,e,t,Xs)]}getSubsetColors(e,t){return Cd(this._colors,e,t,Ys)}getSubsetOpacities(e,t){return Cd(this._alpha,e,t,1)}getNumVertexPerSegment(){return zi}getPositionSize(){return hs}setSegments(e,t){const n=e*zi*hs;if(t instanceof Array&&t.length===2){this._positions.set(t[0],n);const i=e*zi*Xs;this._directions.set(t[1],i)}else this._positions.set(t,n)}setColors(e,t){const n=e*zi*Ys;this._colors.set(t,n)}_initVertices(e){this._buffersSize=e*zi;const t=this._buffersSize,n=t>Lz;this._index=Oe.allocateTyped(n?Uint32Array:Uint16Array,e*6),this._positions=Oe.allocateTyped(Float32Array,t*hs),this._colors=Oe.allocateTyped(Float32Array,t*Ys),this._directions=Oe.allocateTyped(Float32Array,t*Xs);const i=this._alpha=Oe.allocateTyped(Float32Array,t);Me.default.fill(i,1);const r=this._index;let o=0,a=0;for(let l=0;l<e;l++,o+=6,a+=zi)r[o]=a,r[o+1]=a+1,r[o+2]=a+3,r[o+3]=a,r[o+4]=a+2,r[o+5]=a+3;this.setIndex(new b.BufferAttribute(this._index,1)),this.setAttribute("position",new b.BufferAttribute(this._positions,hs)),this.setAttribute("color",new b.BufferAttribute(this._colors,Ys)),this.setAttribute("alphaColor",new b.BufferAttribute(i,1)),this.setAttribute("direction",new b.BufferAttribute(this._directions,Xs))}}const ZM=Nz;class Fz extends ZM{startUpdate(){return!0}computeBoundingSphere(){const{boundingBox:e}=this;let t=0;const n=new b.Vector3;e&&e.getCenter(n);const i=this._positions,r=this.boundingSphere||new b.Sphere,o=this._positions.length,a=new b.Vector3,l=this.getPositionSize();for(let h=0;h<o;h+=l){a.set(i[h],i[h+1],i[h+2]);const u=n.distanceToSquared(a);t<u&&(t=u)}r.set(n,Math.sqrt(t)),this.boundingSphere=r}computeBoundingBox(){const e=this._positions,t=new b.Box3,n=this._positions.length,i=new b.Vector3,r=this.getPositionSize();for(let o=0;o<n;o+=r)i.set(e[o],e[o+1],e[o+2]),t.expandByPoint(i);this.boundingBox=t}finalize(){this.finishUpdate(),this.computeBoundingSphere()}}const KM=Fz,Rd=3,il=new b.Vector3,ES=new b.Matrix3;class Oz extends Ff{constructor(e,t){const n=new b.CylinderGeometry(1,1,1,Math.max(3,t),2,!0);super(n,e);const i=this._chunkSize;this._chunkPos=this._chunkGeo.attributes.position.array,this._chunkNorms=this._chunkGeo.attributes.normal.array,this._tmpVector=Oe.allocateTyped(Float32Array,i*Rd)}setItem(e,t,n,i){const r=this._chunkSize,o=r*e*Rd,a=this._tmpVector,l=this._chunkPos,h=this._chunkNorms,u=yt.calcCylinderMatrix(t,n,i);ES.getNormalMatrix(u);let f;for(let p=0;p<r;++p)f=p*Rd,il.fromArray(l,f),il.applyMatrix4(u),il.toArray(a,f);this._positions.set(a,o);for(let p=0;p<r;++p)f=p*Rd,il.fromArray(h,f),il.applyMatrix3(ES),il.toArray(a,f);this._normals.set(a,o)}}const Dz=Oz,Uz=.1;class A_ extends KM{constructor(e,t,n){super(e*t),this._init(t),this._collisionGeo=n?new Dz(e*t,3):null}startUpdate(){return!0}computeBoundingSphere(){const e=this._collisionGeo;if(e){e.computeBoundingSphere(),this.boundingSphere=e.boundingSphere;return}super.computeBoundingSphere()}computeBoundingBox(){const e=this._collisionGeo;if(e){e.computeBoundingBox(),this.boundingBox=e.boundingBox;return}super.computeBoundingBox()}raycast(e,t){if(!this._collisionGeo)return;const i=this._chunkSize;this._collisionGeo.raycast(e,t);for(let r=0,o=t.length;r<o;++r){let{chunkIdx:a}=t[r];a!==void 0&&(a=a/i|0,t[r].chunkIdx=a)}}setColor(e,t){const n=this._chunkSize;for(let i=e*n,r=i+n;i<r;++i)super.setColor(i,t)}setSegment(e,t,n,i){const r=this._chunkSize,o=e*r+t;super.setSegment(o,n,i),this._collisionGeo&&this._collisionGeo.setItem(e*r+t,n,i,Uz)}finalize(){this.finishUpdate(),this.computeBoundingSphere()}setOpacity(e,t){const n=this._chunkSize;for(let i=0,r=e.length;i<r;++i){const o=e[i]*n;super.setOpacity(o,o+n-1,t)}}getSubset(e){const t=e.length,n=this._chunkSize,i=new A_(t,n,!1);for(let r=0,o=e.length;r<o;++r){const a=r*n,l=e[r]*n;i.setSegments(a,this.getSubsetSegments(l,n)),i.setColors(a,this.getSubsetColors(l,n))}return i.boundingSphere=this.boundingSphere,i.boundingBox=this.boundingBox,[i]}_init(e){this._chunkSize=e}}const JM=A_,Bz=.3,Ym=new b.Vector3;class T_ extends KM{constructor(e){super(e*2),this._init(e),this._collisionGeo=new M_(e,3)}setItem(e,t,n){this._collisionGeo.setItem(e,t,n,Bz);const i=2*e;Ym.lerpVectors(t,n,.5),super.setSegment(i,t,Ym),super.setSegment(i+1,Ym,n)}setColor(e,t,n){const i=2*e;super.setColor(i,t),super.setColor(i+1,n)}raycast(e,t){this._collisionGeo&&this._collisionGeo.raycast(e,t)}getSubset(e){const t=e.length,n=new T_(t,!1);for(let i=0,r=t;i<r;++i){const o=e[i];n.setSegments(i,this.getSubsetSegments(o,1)),n.setColors(i,this.getSubsetColors(o,1))}return n.boundingSphere=this.boundingSphere,n.boundingBox=this.boundingBox,[n]}_init(e){this._segCounts=e*2}}const zz=T_,Bo=[new b.Vector3(1,0,0),new b.Vector3(-1,0,0),new b.Vector3(0,1,0),new b.Vector3(0,-1,0),new b.Vector3(0,0,1),new b.Vector3(0,0,-1)],AS=Bo.length,Pd=new b.Vector3,Id=new b.Vector3;class Vz extends b_(JM){constructor(e){super(e,e,AS/2|0,!1)}setItem(e,t,n){this.setSphere(e,t,n);for(let i=0;i<AS/2;++i){const r=i*2;Pd.x=t.x+Bo[r].x*n,Pd.y=t.y+Bo[r].y*n,Pd.z=t.z+Bo[r].z*n;const o=r+1;Id.x=t.x+Bo[o].x*n,Id.y=t.y+Bo[o].y*n,Id.z=t.z+Bo[o].z*n,this.setSegment(e,i,Pd,Id)}}}const kz=Vz,TS=4,CS=3,Ld=new b.Color;class Gz extends b.BufferGeometry{constructor(e,t){super(),this._opts=t,this.zClip=this._opts.zClip,this._posRad=Oe.allocateTyped(Float32Array,e*TS),this._colors=Oe.allocateTyped(Float32Array,e*CS)}setItem(e,t,n){const i=this._posRad;let r=TS*e;i[r++]=t.x,i[r++]=t.y,i[r++]=t.z,i[r]=n}setColor(e,t){Ld.set(t);const n=this._colors;let i=CS*e;n[i++]=Ld.r,n[i++]=Ld.g,n[i]=Ld.b}finalize(){this.finishUpdate(),this.computeBoundingSphere()}finishUpdate(){this._build()}setOpacity(){}raycast(){}getSubset(){return[]}}const QM=Gz;class eE{constructor(){this.pointsValuesLinear=null,this.hasIntersection=null,this.bitsInside=null}create(e){const n=e*e*e;if(n>117440512)throw new Error("Too large cube dimension: lead to memory huge uasge");return this.pointsValuesLinear=Oe.allocateTyped(Float32Array,32*n),this.hasIntersection=Oe.allocateTyped(Int32Array,n),this.bitsInside=Oe.allocateTyped(Int32Array,n),0}destroy(){this.bitsInside=null,this.hasIntersection=null,this.pointsValuesLinear=null}}eE.prototype.striIndicesMarchCube=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];const tE=eE,RS=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0];function Hz(s,e,t){const n=s.getValue(e.x,e.y,e.z);t.set(n[0],n[1],n[2])}class Wz{constructor(){this._arrSize=8,this.p=new Array(this._arrSize),this.g=new Array(this._arrSize),this.val=new Array(this._arrSize);for(let e=0;e<this._arrSize;++e)this.p[e]=new b.Vector3,this.g[e]=new b.Vector3;this.cubeIndex=0}}class Xz{constructor(){this.a={p:new b.Vector3,n:new b.Vector3},this.b={p:new b.Vector3,n:new b.Vector3},this.c={p:new b.Vector3,n:new b.Vector3}}}function PS(s){const e=new Array(s);for(let t=0;t<s;++t)e[t]=new b.Vector3;return e}const ni=class ni{constructor(){this._numTriangles=0,this._numVertices=0,this._position=[],this._normals=[],this._colors=null,this._indices=[],this._volumetricData=null,this._xAxis=new b.Vector3,this._yAxis=new b.Vector3,this._zAxis=new b.Vector3,this._xDir=new b.Vector3,this._yDir=new b.Vector3,this._zDir=new b.Vector3}_prepareAxesAndDirs(){const t=this._volumetricData.getCellSize(),n=this._xAxis,i=this._yAxis,r=this._zAxis,o=this._xDir,a=this._yDir,l=this._zDir;n.set(t.x,0,0),i.set(0,t.y,0),r.set(0,0,t.z),o.set(1,0,0),a.set(0,1,0),l.set(0,0,1);const h=new b.Vector3;if(h.crossVectors(o,a),h.dot(l)<0&&(o.negate(),a.negate(),l.negate()),o.x<0||o.y<0||o.z<0||a.x<0||a.y<0||a.z<0||l.x<0||l.y<0||l.z<0)return!1;const u=f=>Math.abs(f)>Number.EPSILON;return!(u(n.y)||u(n.z)||u(i.x)||u(i.z)||u(r.x)||u(r.y))}_vertexInterp(e,t,n,i,r,o){const a=t.p[n],l=t.p[i],h=t.g[n],u=t.g[i],f=t.val[n],p=t.val[i],m=e-f,g=p-f;let v=0;Math.abs(g)>0&&(v=m/g),v=v>1?1:v,r.lerpVectors(a,l,v),o.lerpVectors(h,u,v)}_polygonize(e,t,n){const{cubeIndex:i}=e;let r=0;const o=ni._arrSize,a=ni._firstIndices,l=ni._secondIndices,h=ni._vertexList,u=ni._normalList;for(;r<o;++r)RS[i]&1<<r&&this._vertexInterp(t,e,a[r],l[r],h[r],u[r]);let f=0;const p=i*16,m=ni._triTable;for(r=0;m[p+r]!==-1;r+=3)n[f].a.p.copy(h[m[p+r]]),n[f].a.n.copy(u[m[p+r]]),n[f].b.p.copy(h[m[p+r+1]]),n[f].b.n.copy(u[m[p+r+1]]),n[f].c.p.copy(h[m[p+r+2]]),n[f].c.n.copy(u[m[p+r+2]]),++f;return f}_doGridPosNorms(e,t,n){const i=this._volumetricData,r=this._volumetricData.getData(),o=i.getDimensions(),a=o[0],l=o[1],h=o[2],u=t*i.getStrideX(),f=t*i.getStrideY(),p=t*i.getStrideZ(),m=new Wz,g=m.val,v=m.val.length,y=[new b.Vector3(0,0,0),new b.Vector3(t,0,0),new b.Vector3(t,t,0),new b.Vector3(0,t,0),new b.Vector3(0,0,t),new b.Vector3(t,0,t),new b.Vector3(t,t,t),new b.Vector3(0,t,t)],x=5,w=new Array(x);for(let T=0;T<x;++T)w[T]=new Xz;let S;const E=this,A=this._position,C=this._normals;n?S=function(){const T=new b.Vector3(E._xAxis.x,E._yAxis.y,E._zAxis.z);return function(R){const G=R.p.clone();G.multiply(T),A.push(G.add(E._origin)),C.push(R.n.clone())}}():S=function(){const T=new b.Matrix3;T.set(E._xAxis.x,E._yAxis.x,E._zAxis.x,E._xAxis.y,E._yAxis.y,E._zAxis.y,E._xAxis.z,E._yAxis.z,E._zAxis.z);const R=new b.Matrix3;return R.set(E._xDir.x,E._yDir.x,E._zDir.x,E._xDir.y,E._yDir.y,E._zDir.y,E._xDir.z,E._yDir.z,E._zDir.z),function(G){A.push(G.p.clone().applyMatrix3(T).add(E._origin)),C.push(G.n.clone().applyMatrix3(R))}}();const P=this._indices;let L=0;for(let T=0;T<h-t;T+=t)for(let R=0;R<l-t;R+=t){let G=i.getDirectIdx(0,R,T);for(let K=0;K<a-t;K+=t,G+=u){g[0]=r[G],g[1]=r[G+u],g[3]=r[G+f],g[2]=r[G+u+f],g[4]=r[G+p],g[5]=r[G+u+p],g[7]=r[G+f+p],g[6]=r[G+u+f+p];let Z=0,O=0;for(;O<v;++O)g[O]<e&&(Z|=1<<O);if(RS[Z]===0)continue;for(m.cubeIndex=Z,O=0;O<v;++O)m.p[O].set(K+y[O].x,R+y[O].y,T+y[O].z),Hz(this._gradient,m.p[O],m.g[O]);const V=this._polygonize(m,e,w);for(L+=V,O=0;O<V;++O)P.push(this._numTriangles*3),P.push(this._numTriangles*3+1),P.push(this._numTriangles*3+2),++this._numTriangles,S(w[O].a),S(w[O].b),S(w[O].c)}}return L}compute(e,t,n,i){this._volumetricData=e,this._origin=t,this._gradient=e.computeGradient(),this._doGridPosNorms(n,i,this._prepareAxesAndDirs())}_remapIndices(e,t){const n=this._indices,i=Oe.allocateTyped(Uint32Array,t);for(let r=0;r<t;++r)n[r]=e[n[r]],i[r]=n[r];this._indices=i}_remapVertices(e,t,n){const i=Oe.allocateTyped(Float32Array,n*3),r=Oe.allocateTyped(Float32Array,n*3);for(let o=0;o<n;++o){const a=e[o];i[o*3]=a.x,i[o*3+1]=a.y,i[o*3+2]=a.z;const l=t[o].normalize();r[o*3]=l.x,r[o*3+1]=l.y,r[o*3+2]=l.z}this._position=i,this._normals=r}vertexFusion(e,t){const n=this._indices.length,i=this._position,r=this._normals,o=i.length|0;if(n===0||o===0)return;const a=Oe.allocateTyped(Uint32Array,o);a[0]=0;let l=1,h=1;for(;h<o;++h){const u=l-e<0?0:l-e,f=u+t>l?l:u+t;let p=-1;for(let m=u;m<f;++m)if(Math.abs(i[h]-i[m])<Number.EPSILON){p=m;break}p!==-1?a[h]=p:(i[l].copy(i[h]),r[l].copy(r[h]),a[h]=l,++l)}this._remapIndices(a,n),this._remapVertices(i,r,l)}setColorVolTex(e,t,n,i){let r,o;const a=this._position.length/3,l=this._position,h=this._origin,u=this._volumetricData.getDimensions(),f=u[0]-1,p=u[1]-1,m=u[2]-1,g=e.getData(),v=e.getStrideX(),y=e.getStrideY(),x=e.getStrideZ();let w,S,E,A;i!==null&&(w=n.getData(),S=n.getStrideX(),E=n.getStrideY(),A=n.getStrideZ());const C=1/this._xAxis.x,P=1/this._yAxis.y,L=1/this._zAxis.z;let T=[],R=[];const G=Oe.allocateTyped(Float32Array,a*3);function K(j,q,J,se){se[0]=(1-j)*g[q]+j*g[J],se[1]=(1-j)*g[q+1]+j*g[J+1],se[2]=(1-j)*g[q+2]+j*g[J+2]}function Z(j,q,J,se){const _e=t[j];if(_e!=null){T[_e.index]=_e;const Re=q*J*se*w[j];typeof R[_e.index]>"u"?R[_e.index]=Re:R[_e.index]+=Re}}const O=Oe.allocateTyped(Int32Array,a);let V=0;for(r=0;r<a;r++){const j=r*3,q=(l[j]-h.x)*C,J=(l[j+1]-h.y)*P,se=(l[j+2]-h.z)*L,_e=Math.min(Math.max(q,0),f)|0,Re=Math.min(Math.max(J,0),p)|0,ae=Math.min(Math.max(se,0),m)|0,ve=q-_e,oe=J-Re,Ce=se-ae;if(i!=null){T=[],R=[],o=n.getDirectIdx(_e,Re,ae),Z(o,1-ve,1-oe,1-Ce),Z(o+S,ve,1-oe,1-Ce),Z(o+E,1-ve,oe,1-Ce),Z(o+S+E,ve,oe,1-Ce),Z(o+A,1-ve,1-oe,Ce),Z(o+S+A,ve,1-oe,Ce),Z(o+E+A,1-ve,oe,Ce),Z(o+S+E+A,ve,oe,Ce);let he=0,fe=-1;for(const De in R)R[De]>he&&(fe=De,he=R[De]);if(fe<0||!i.includesAtom(T[fe])){O[r]=-1;continue}}O[r]=V++;const Ie=_e<f?v:0,ke=Re<p?y:0,Ye=ae<m?x:0,$e=[0,0,0],et=[0,0,0],Ke=[0,0,0],W=[0,0,0];o=e.getDirectIdx(_e,Re,ae),K(ve,o,o+Ie,$e),K(ve,o+ke,o+Ie+ke,et),K(ve,o+Ye,o+Ie+Ye,Ke),K(ve,o+ke+Ye,o+Ie+ke+Ye,W);const Le=[0,0,0];Le[0]=(1-oe)*$e[0]+oe*et[0],Le[1]=(1-oe)*$e[1]+oe*et[1],Le[2]=(1-oe)*$e[2]+oe*et[2];const Q=[0,0,0];Q[0]=(1-oe)*Ke[0]+oe*W[0],Q[1]=(1-oe)*Ke[1]+oe*W[1],Q[2]=(1-oe)*Ke[2]+oe*W[2],G[j]=(1-Ce)*Le[0]+Ce*Q[0],G[j+1]=(1-Ce)*Le[1]+Ce*Q[1],G[j+2]=(1-Ce)*Le[2]+Ce*Q[2]}if(this._colors=G,i!=null){for(r=0;r<a;++r){const J=O[r];J<0||(this._position[J*3]=this._position[r*3],this._position[J*3+1]=this._position[r*3+1],this._position[J*3+2]=this._position[r*3+2],this._normals[J*3]=this._normals[r*3],this._normals[J*3+1]=this._normals[r*3+1],this._normals[J*3+2]=this._normals[r*3+2],this._colors[J*3]=this._colors[r*3],this._colors[J*3+1]=this._colors[r*3+1],this._colors[J*3+2]=this._colors[r*3+2])}const j=this._indices.length/3;let q=0;for(r=0;r<j;++r){const J=O[this._indices[3*r]],se=O[this._indices[3*r+1]],_e=O[this._indices[3*r+2]];J>=0&&se>=0&&_e>=0&&(this._indices[3*q]=J,this._indices[3*q+1]=se,this._indices[3*q+2]=_e,++q)}this._position=new Float32Array(this._position.buffer.slice(0,V*3*4)),this._normals=new Float32Array(this._normals.buffer.slice(0,V*3*4)),this._colors=new Float32Array(this._colors.buffer.slice(0,V*3*4)),this._indices=new Uint32Array(this._indices.buffer.slice(0,q*3*4))}}toMesh(){const e=new b.BufferGeometry;return e.setIndex(new b.BufferAttribute(this._indices,1)),e.setAttribute("position",new b.BufferAttribute(this._position,3)),e.setAttribute("normal",new b.BufferAttribute(this._normals,3)),e.setAttribute("color",new b.BufferAttribute(this._colors,3)),e.computeBoundingSphere(),e}};lt(ni,"_triTable",tE.prototype.striIndicesMarchCube),lt(ni,"_arrSize",12),lt(ni,"_firstIndices",[0,1,2,3,4,5,6,7,0,1,2,3]),lt(ni,"_secondIndices",[1,2,3,0,5,6,7,4,4,5,6,7]),lt(ni,"_vertexList",PS(ni._arrSize)),lt(ni,"_normalList",PS(ni._arrSize));let og=ni;const Yz=og;class jz extends QM{_build(){const e=this._opts;this.numVoxels=[128,128,128],this.xAxis=new b.Vector3(1,0,0),this.yAxis=new b.Vector3(0,1,0),this.zAxis=new b.Vector3(0,0,1),this.origin=new b.Vector3(0,0,0),this._visibilitySelector=e.visibilitySelector,this._calcSurface(e)}_findMinMax(e){const n=e.length/4,i=[e[0],e[1],e[2],e[3]],r=[e[0],e[1],e[2],e[3]];for(let o=1;o<n;++o){const a=o*4;for(let l=0;l<4;++l){const h=e[a+l];i[l]=Math.max(h,i[l]),r[l]=Math.min(h,r[l])}}return{maxPosRad:i,minPosRad:r}}_findNumVoxels(e,t){const{numVoxels:n}=this,i=this._findMinMax(e),r=i.minPosRad,o=i.maxPosRad;r[3]>4&&(t.gridSpacing*=r[3]);let a=t.radScale*o[3]*1.7,l=a;l=.65*Math.sqrt(4/3*Math.PI*l*l*l),a=Math.max(a,l);let h=0;for(;h<3;++h)r[h]-=a,o[h]+=a;for(h=0;h<3;++h)n[h]=Math.ceil((o[h]-r[h])/t.gridSpacing);return this.xAxis.x=(n[0]-1)*t.gridSpacing,this.yAxis.y=(n[1]-1)*t.gridSpacing,this.zAxis.z=(n[2]-1)*t.gridSpacing,[this.origin.x,this.origin.y,this.origin.z]=r,{bbox:i,dim:n}}_makeSurface(e,t){const n=new Yz;n.compute(e.volMap,this.origin,t.isoValue,1),n.vertexFusion(9,9),n._numTriangles>0?(n.setColorVolTex(e.volTexMap,e.atomMap,e.atomWeightMap,this._visibilitySelector),this.setIndex(new b.BufferAttribute(n._indices,1)),this.setAttribute("position",new b.BufferAttribute(n._position,3)),this.setAttribute("normal",new b.BufferAttribute(n._normals,3)),this.setAttribute("color",new b.BufferAttribute(n._colors,3))):this.setAttribute("position",new b.BufferAttribute(Oe.allocateTyped(Float32Array,0),3))}_calcSurface(e){const t={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};if(t.posRad.length===0)return;const n=this._findNumVoxels(t.posRad,e),i=new b.Box3(this.origin,new b.Vector3(this.xAxis.x,this.yAxis.y,this.zAxis.z).add(this.origin)),r=this._computeSurface(t,i,n,e);this._makeSurface(r,e)}}const nE=jz,{Volume:jm}=On;class qz extends nE{_computeSurface(e,t,n,i){this._shiftByOrigin(e.posRad);const r={volMap:new jm(Float32Array,this.numVoxels,t),volTexMap:new jm(Float32Array,this.numVoxels,t,3)};return this._visibilitySelector!=null&&(r.atomMap=[],r.atomWeightMap=new jm(Float32Array,this.numVoxels,t)),this.gaussdensity(r,e,null,i),r}gaussdensity(e,t,n,i){const r=t.posRad.length/4,{posRad:o,colors:a}=t,{numVoxels:l}=this,{radScale:h,gaussLim:u,gridSpacing:f}=i,p=1/i.isoValue,m=1/f,g=l[0]-1,v=l[1]-1,y=l[2]-1,{volMap:x,volTexMap:w}=e,S=x.getData(),E=x.getStrideX(),A=w.getData(),C=w.getStrideX();let P;this._visibilitySelector!=null&&(P=e.atomWeightMap.getData());const{atomMap:L}=e;for(let T=0;T<r;++T){const R=T*4,G=o[R+3]*h,K=n===null?1:n[T],Z=1/(2*G*G);let O=u*G;const V=O*O;O*=m;let j=o[R]*m;const q=Math.max(j-O|0,0),J=Math.min(j+O|0,g);j=o[R+1]*m;const se=Math.max(j-O|0,0),_e=Math.min(j+O|0,v);j=o[R+2]*m;const Re=Math.max(j-O|0,0),ae=Math.min(j+O|0,y);let ve=Re*f-o[R+2];for(let oe=Re;oe<=ae;++oe,ve+=f){let Ce=se*f-o[R+1];for(let Ie=se;Ie<=_e;++Ie,Ce+=f){const ke=Ce*Ce+ve*ve;if(ke>=V)continue;let Ye=x.getDirectIdx(q,Ie,oe),$e=w.getDirectIdx(q,Ie,oe),et=q*f-o[R];for(let Ke=q;Ke<=J;++Ke,et+=f,Ye+=E,$e+=C){const Le=-(et*et+ke)*Z;let Q=Math.exp(Le)*K;this._visibilitySelector!=null&&Q>P[Ye]&&(P[Ye]=Q,L[Ye]=t.atoms[T]),S[Ye]+=Q,Q*=p;const he=T*3;A[$e]+=Q*a[he],A[$e+1]+=Q*a[he+1],A[$e+2]+=Q*a[he+2]}}}}}_shiftByOrigin(e){const t=this.origin.x,n=this.origin.y,i=this.origin.z,r=4,o=e.length/r;for(let a=0;a<o;++a){const l=a*r;e[l]-=t,e[l+1]-=n,e[l+2]-=i}}}const $z=qz;function Zz(s,e,t,n){const r=s.length/4,o=e[0],a=e[1],l=e[2],h=t[0],u=t[1],f=t[2];function p(K,Z){return Math.floor((K-Z)/n)}const m=p(h,o)+1,g=p(u,a)+1,v=p(f,l)+1,y=m*g*v,x=g*v,w=function(K,Z,O){return(p(K,o)*g+p(Z,a))*v+p(O,l)},S=[];let E,A;for(E=0;E<r;E++){const K=4*E;A=w(s[K],s[K+1],s[K+2]),S[A]===void 0?S[A]=[E]:S[A].push(E)}const C=Oe.allocateTyped(Uint32Array,y),P=Oe.allocateTyped(Uint16Array,y),L=Oe.allocateTyped(Uint32Array,r);let T=0,R=0,G;for(E=0;E<y;E++){const K=C[E]=T,Z=S[E];if(Z!==void 0)for(G=0;G<Z.length;G++)L[T]=Z[G],T++;const O=T-K;P[E]=O,O>R&&(R=O)}this.neighbourListLength=27*R+1,this.withinRadii=function(K,Z,O,V,j){let q=0;const J=p(K,o),se=p(Z,a),_e=p(O,l),Re=Math.max(0,J-1),ae=Math.max(0,se-1),ve=Math.max(0,_e-1),oe=Math.min(m-1,J+1),Ce=Math.min(g-1,se+1),Ie=Math.min(v-1,_e+1);for(E=Re;E<=oe;++E){const ke=E*x;for(G=ae;G<=Ce;++G){const Ye=G*v;for(let $e=ve;$e<=Ie;++$e){A=ke+Ye+$e;const et=C[A],Ke=et+P[A];for(let W=et;W<Ke;W++){const Q=4*L[W],he=s[Q]-K,fe=s[Q+1]-Z,De=s[Q+2]-O,je=s[Q+3]+V;he*he+fe*fe+De*De<=je*je&&(j[q++]=L[W])}}}}j[q]=-1}}function Kz(s,e,t,n){const{posRad:r,colors:o,atoms:a}=s,l=r.length/4,{bbox:h}=e,u=h.minPosRad,f=h.maxPosRad;let p,m,g,v,y,x=-1,w,S,E,A,C=null,P=null,L=null,T,R,G,K,Z,O,V;const j=new b.Vector3(0,0,0),q=new b.Vector3(0,0,0),J=new b.Vector3(0,0,0);let se;function _e(Q,he,fe){const De=Oe.allocateTyped(Q,he);for(let je=0;je<he;++je)De[je]=fe;return De}function Re(Q,he,fe){for(let De=0;De<Q.length;De++)Q[De]=he+fe*De}function ae(){({scaleFactor:v}=t),{dim:w}=e,se=Math.min(5,2+Math.floor(g*v));const Q=w[0]*w[1]*w[2];S=_e(Float32Array,Q,-1001),E=Oe.allocateTyped(Float32Array,Q*3),A=Oe.allocateTyped(Float32Array,Q),L&&(C=Oe.allocateTyped(Float32Array,Q),P=[]),T=Oe.allocateTyped(Float32Array,w[0]),R=Oe.allocateTyped(Float32Array,w[1]),G=Oe.allocateTyped(Float32Array,w[2]),Re(T,u[0],1/v),Re(R,u[1],1/v),Re(G,u[2],1/v)}function ve(){let Q=0;const he=2*Math.PI/y;Z=Oe.allocateTyped(Float32Array,y),K=Oe.allocateTyped(Float32Array,y);for(let fe=0;fe<y;fe++)Z[fe]=Math.cos(Q),K[fe]=Math.sin(Q),Q+=he}function oe(){O=new Zz(r,u,f,2.01*m),V=new Int32Array(O.neighbourListLength)}function Ce(){({probeRadius:g,scaleFactor:v,probePositions:y,visibilitySelector:L}=t),p=Oe.allocateTyped(Float32Array,l),m=0;for(let Q=0;Q<l;++Q){const he=r[Q*4+3]+=g;he>m&&(m=he),p[Q]=he*he}ae(),ve(),oe(),x=-1}function Ie(Q,he,fe,De){const je=4*Q,qe=p[Q],it=r[je]-he,ot=r[je+1]-fe,_t=r[je+2]-De;return it*it+ot*ot+_t*_t<qe}function ke(Q,he,fe,De,je){let qe;if(x!==-1){if(qe=x,qe!==De&&qe!==je&&Ie(qe,Q,he,fe))return qe;x=-1}let it=0;for(qe=V[it];qe>=0;){if(qe!==De&&qe!==je&&Ie(qe,Q,he,fe))return x=qe,qe;qe=V[++it]}return x=-1,-1}function Ye(){const he=1.3333333333333333,fe=1/(2*he*he);for(let De=0;De<l;De++){const je=4*De,qe=r[je],it=r[je+1],ot=r[je+2],_t=r[je+3],H=p[De];O.withinRadii(qe,it,ot,_t,V);const U=Math.ceil(_t*v),we=Math.floor(v*(qe-u[0])),We=Math.floor(v*(it-u[1])),Ge=Math.floor(v*(ot-u[2])),Je=Math.max(0,we-U),nt=Math.max(0,We-U),N=Math.max(0,Ge-U),F=Math.min(w[0],we+U+2),k=Math.min(w[1],We+U+2),ee=Math.min(w[2],Ge+U+2),ne=De*3,ye=o[ne],ue=o[ne+1],Ue=o[ne+2];for(let Ze=N;Ze<ee;Ze++){const Y=G[Ze]-ot,Ve=w[1]*w[0]*Ze;for(let me=nt;me<k;me++){const xe=R[me]-it,Pe=Y*Y+xe*xe,Qe=Ve+w[0]*me;for(let ie=Je;ie<F;ie++){const at=ie+Qe,ce=T[ie]-qe,wt=Pe+ce*ce;if(wt<H){const be=Math.exp(-wt*fe),Et=at*3;E[Et]+=ye*be,E[Et+1]+=ue*be,E[Et+2]+=Ue*be,A[at]+=be,L!==null&&be>C[at]&&(C[at]=be,P[at]=a[De]),S[at]<0&&(S[at]=-S[at]);const gn=Math.sqrt(wt),Dn=_t/gn;let $n=ce*Dn,Un=xe*Dn,Zt=Y*Dn;if($n+=qe,Un+=it,Zt+=ot,ke($n,Un,Zt,De,-1)===-1){const wn=_t-gn;wn<S[at]&&(S[at]=wn)}}}}}}}function $e(Q,he){return Q.x=Q.y=Q.z=1,he.x!==0?Q.x=(he.y+he.z)/-he.x:he.y!==0?Q.y=(he.x+he.z)/-he.y:he.z!==0&&(Q.z=(he.x+he.y)/-he.z),Q}function et(Q,he){const fe=4*Q,De=4*he,je=r[fe],qe=r[fe+1],it=r[fe+2],ot=r[fe+3];let _t=j.x=r[De]-je,H=j.y=r[De+1]-qe,U=j.z=r[De+2]-it;const we=r[De+3];let We=_t*_t+H*H+U*U;const Ge=Math.sqrt(We),Je=(ot*ot+Ge*Ge-we*we)/(2*ot*Ge),nt=ot*Je;j.normalize(),$e(q,j),q.normalize(),J.crossVectors(j,q),J.normalize();const N=Math.sqrt(ot*ot-nt*nt);q.multiplyScalar(N),J.multiplyScalar(N),j.multiplyScalar(nt),j.x+=je,j.y+=qe,j.z+=it,x=-1;const F=se;for(let k=0;k<y;k++){const ee=Z[k],ne=K[k],ye=j.x+ee*q.x+ne*J.x,ue=j.y+ee*q.y+ne*J.y,Ue=j.z+ee*q.z+ne*J.z;if(ke(ye,ue,Ue,Q,he)===-1){const Ze=Math.floor(v*(ye-u[0])),Y=Math.floor(v*(ue-u[1])),Ve=Math.floor(v*(Ue-u[2])),me=Math.max(0,Ze-F),xe=Math.max(0,Y-F),Pe=Math.max(0,Ve-F),Qe=Math.min(w[0],Ze+F+2),ie=Math.min(w[1],Y+F+2),at=Math.min(w[2],Ve+F+2);for(let ce=Pe;ce<at;ce++){U=Ue-G[ce];const wt=w[1]*w[0]*ce;for(let be=xe;be<ie;be++){H=ue-R[be];const Et=U*U+H*H,gn=wt+w[0]*be;for(let Dn=me;Dn<Qe;Dn++){_t=ye-T[Dn],We=Et+_t*_t;const $n=Dn+gn,Un=S[$n];Un>0&&We<Un*Un&&(S[$n]=Math.sqrt(We))}}}}}}function Ke(){for(let Q=0;Q<l;Q++){const he=4*Q;O.withinRadii(r[he],r[he+1],r[he+2],r[he+3],V);let fe=0,De=V[fe];for(;De>=0;)Q<De&&et(Q,De),De=V[++fe]}}function W(){for(let Q=0,he=S.length;Q<he;Q++){S[Q]<0&&(S[Q]=0);let fe=A[Q];if(fe>0){fe=1/fe;const De=Q*3;E[De]*=fe,E[De+1]*=fe,E[De+2]*=fe}}}function Le(){console.time("ContactSurface.getVolume"),console.time("ContactSurface.init"),Ce(),console.timeEnd("ContactSurface.init"),console.time("ContactSurface.projectPoints"),Ye(),console.timeEnd("ContactSurface.projectPoints"),console.time("ContactSurface.projectTorii"),Ke(),console.timeEnd("ContactSurface.projectTorii"),W(),console.timeEnd("ContactSurface.getVolume")}this.build=function(){Le(),this.volTexMap=E,this.weightsMap=C,this.atomMap=P,this.volMap=S}}const Jz=Kz,{Volume:qm}=On;class Qz extends nE{_computeSurface(e,t,n,i){const r=new Jz(e,n,i);return r.build(),{volMap:new qm(Float32Array,this.numVoxels,t,1,r.volMap),volTexMap:new qm(Float32Array,this.numVoxels,t,3,r.volTexMap),atomMap:r.atomMap,atomWeightMap:new qm(Float32Array,this.numVoxels,t,1,r.weightsMap)}}}const eV=Qz;class tV{constructor(e,t){this.coord=new b.Vector3,this.coord.copy(e),this.radius=t,this.colorX=.99999,this.colorY=0,this.colorZ=0,this.atomType=0,this.srcAtom=null}}const nV=tV;class iV{constructor(e,t,n,i,r){this._numAtoms=e,this._atoms=t,this._vBoxMin=new b.Vector3,this._vBoxMax=new b.Vector3,this._vBoxMin.copy(n),this._vBoxMax.copy(i),this._probeRadius=r,this._atomsList=null,this._voxelList=null}createVoxels(){let e,t;const i=this._numAtoms|0,r=this._atoms,o=this._vBoxMax.x-this._vBoxMin.x,a=this._vBoxMax.y-this._vBoxMin.y,l=this._vBoxMax.z-this._vBoxMin.z;let h=o<a?o:a;h=l<h?l:h;let u=0,f=0,p;for(p=0;p<i;p++)t=(r[p].radius+this._probeRadius)*2,u=t>u?t:u,f+=t;let m=Math.floor(h/u);m<2&&(m=2),f/=i,this._numCells=m,this._aveRad=f,this._maxRad=u;const g=m,v=m*m,y=m*m*m,x=this._xScale=1/(this._vBoxMax.x-this._vBoxMin.x),w=this._yScale=1/(this._vBoxMax.y-this._vBoxMin.y),S=this._zScale=1/(this._vBoxMax.z-this._vBoxMin.z);let E=0;const A=x*m,C=w*m,P=S*m;for(p=0;p<i;p++){const R=(r[p].radius+this._probeRadius)*4.5*2;let G=Math.floor(A*R+.8),K=Math.floor(C*R+.8),Z=Math.floor(P*R+.8);G++,K++,Z++,E+=G*K*Z}this._voxelList=Oe.allocateTyped(Int32Array,y);const L=[];if(L.length=E,this._voxelList===null||L===null)return-1;for(p=0;p<y;p++)this._voxelList[p]=-1;for(e=0,p=0;p<i;p++){t=(r[p].radius+this._probeRadius)*4.5;let T=Math.floor((r[p].coord.x-this._vBoxMin.x-t)*m*x),R=Math.floor((r[p].coord.y-this._vBoxMin.y-t)*m*w),G=Math.floor((r[p].coord.z-this._vBoxMin.z-t)*m*S),K=Math.floor((r[p].coord.x-this._vBoxMin.x+t)*m*x),Z=Math.floor((r[p].coord.y-this._vBoxMin.y+t)*m*w),O=Math.floor((r[p].coord.z-this._vBoxMin.z+t)*m*S);T=T>=0?T:0,R=R>=0?R:0,G=G>=0?G:0,K=K<m?K:m-1,Z=Z<m?Z:m-1,O=O<m?O:m-1;for(let V=G;V<=O;V++)for(let j=R;j<=Z;j++)for(let q=T;q<=K;q++){const J=q+j*g+V*v;if(this._voxelList[J]<0){L[e*2+0]=p,L[e*2+1]=-1,this._voxelList[J]=e,e++;continue}const se=this._voxelList[J];this._voxelList[J]=e,L[e*2+0]=p,L[e*2+1]=se,e++}}return this._atomsList=Int32Array.from(L),0}destroyVoxels(){this._atomsList=null,this._voxelList=null,this._atoms=null,this._vertices=null,this._vBoxMin=null,this._vBoxMax=null}forEachRelatedAtom(e,t){const n=Math.floor((e.x-this._vBoxMin.x)*this._numCells*this._xScale),i=Math.floor((e.y-this._vBoxMin.y)*this._numCells*this._yScale),r=Math.floor((e.z-this._vBoxMin.z)*this._numCells*this._zScale),o=n+i*this._numCells+r*this._numCells*this._numCells,a=this._atoms;for(let l=this._voxelList[o];l>=0;l=this._atomsList[l*2+1]){const h=this._atomsList[l*2];t(a[h])}}getClosestAtom(e){let t=null,n=Number.MAX_VALUE;return this.forEachRelatedAtom(e,i=>{const r=e.distanceToSquared(i.coord);r<n&&(n=r,t=i)}),t}buildNormals(e,t,n){const i=this;let r=0,o=0,a=0,l=0,h,u=0,f=0,p=0,m=0,g=0;const v=2.5,y=.1,x=this._aveRad*v,w=x*x,S=-this._aveRad*y,E=function(A){const C=o-A.coord.x,P=a-A.coord.y,L=l-A.coord.z;if(h=C*C+P*P+L*L,h>w)return;const T=A.radius+i._probeRadius;m=h-T*T,m<0&&(m=-m),g=Math.exp(S*m),u+=C*g,f+=P*g,p+=L*g,r++};for(let A=0;A<e;A++)o=t[A].x,a=t[A].y,l=t[A].z,r=0,u=f=p=0,this.forEachRelatedAtom(t[A],E),h=u*u+f*f+p*p,r>0&&(m=1/Math.sqrt(h),u*=m,f*=m,p*=m),n[A].x=u,n[A].y=f,n[A].z=p;return 0}buildColors(e,t,n,i){const r=this;let o=0,a=0,l=0,h=0,u=0;const f=.8,p=i,m=p*p;let g=[],v=[],y=0;const x=function(w){const S=o-w.coord.x,E=a-w.coord.y,A=l-w.coord.z,C=S*S+E*E+A*A;if(C>m)return;const P=w.radius+r._probeRadius;h=C-P*P,h<0&&(h=-h),u=1/(f+h),g.push([w.colorX,w.colorY,w.colorZ]),v.push(u),y+=u};for(let w=0;w<e;w++){o=t[w].x,a=t[w].y,l=t[w].z,g=[],v=[],y=0,this.forEachRelatedAtom(t[w],x);for(let S=0;S<g.length;++S){const E=v[S]/y;n[w].x+=g[S][0]*E,n[w].y+=g[S][1]*E,n[w].z+=g[S][2]*E}}return 0}}const rV=iV;class sV{constructor(e,t,n){this._maxNumVertices=e,this._maxNumTriangles=t,this._vertices=new Array(e),this._normals=new Array(e),this._colors=null,n&&(this._colors=new Array(e)),this._indices=new Array(t*3),this._numVertices=0,this._numTriangles=0;let i;for(i=0;i<e;i++)this._vertices[i]=new b.Vector3,this._normals[i]=new b.Vector3;for(i=0;i<t*3;i++)this._indices[i]=-1;if(n)for(i=0;i<e;i++)this._colors[i]=new b.Vector3}destroy(){this._vertices=null,this._normals=null,this._indices=null}}const IS=sV,oV=3,$m=32768,{Element:aV}=On;class lV extends QM{_build(){this._innerBuild();const e=this.getGeo();this.destroy(),this._fromGeo(e)}_fromGeo(e){let t=null;const n=Oe.allocateTyped(Float32Array,3*e._numVertices),i=Oe.allocateTyped(Float32Array,3*e._numVertices);e._colors!==null&&(t=Oe.allocateTyped(Float32Array,3*e._numVertices));const r=Oe.allocateTyped(Uint32Array,3*e._numTriangles);for(let a=0,l=0;a<e._numVertices;a++)n[l+0]=e._vertices[a].x,n[l+1]=e._vertices[a].y,n[l+2]=e._vertices[a].z,i[l+0]=e._normals[a].x,i[l+1]=e._normals[a].y,i[l+2]=e._normals[a].z,l+=3;if(t!==null)for(let a=0,l=0;a<e._numVertices;a++,l+=3)t[l+0]=e._colors[a].x,t[l+1]=e._colors[a].y,t[l+2]=e._colors[a].z;const o=e._numTriangles*3;for(let a=0;a<o;a++)r[a]=e._indices[a];this.setIndex(new b.BufferAttribute(r,1)),this.setAttribute("position",new b.BufferAttribute(n,3)),this.setAttribute("normal",new b.BufferAttribute(i,3)),this.setAttribute("color",new b.BufferAttribute(t,3)),this.computeBoundingBox(),this.computeBoundingSphere(),e.destroy()}convertToAtomsColored(e,t){const{atoms:n,colors:i}=e;for(let r=0,o=n.length;r<o;r++){const a=n[r].position,{radius:l}=n[r].element;t[r]=new nV(a,l);const h=n[r].element.number;t[r].atomType=this.getType(h);let u=oV*r;t[r].colorX=i[u++],t[r].colorY=i[u++],t[r].colorZ=i[u],t[r].srcAtom=n[r]}}getGeo(){return this.geoOut}destroy(){this.atoms=null,this.hashLines=null,this.hashEntries=null}getBoundingBox(e,t,n){t.x=t.y=t.z=1e7,n.x=n.y=n.z=-1e7;const r=this.probeRadius*this.atomRadiusScale;let o=0;for(let a=0,l=e.length;a<l;a++){const h=e[a].coord,u=e[a].radius+r;o=u>o?u:o,h.x-u<t.x&&(t.x=h.x-u),h.y-u<t.y&&(t.y=h.y-u),h.z-u<t.z&&(t.z=h.z-u),h.x+u>n.x&&(n.x=h.x+u),h.y+u>n.y&&(n.y=h.y+u),h.z+u>n.z&&(n.z=h.z+u)}t.x-=o,t.y-=o,t.z-=o,n.x+=o,n.y+=o,n.z+=o}getCornerCoord(e,t,n,i,r,o,a){const l=1/(o-1),h=n*l,u=i*l,f=r*l;a.x=e.x*(1-h)+t.x*h,a.y=e.y*(1-u)+t.y*u,a.z=e.z*(1-f)+t.z*f}buildEdgePoint(e,t,n,i,r,o){if(n[e]^n[t]){const l=(0-i.pointsValuesLinear[r+24+e])/(i.pointsValuesLinear[r+24+t]-i.pointsValuesLinear[r+24+e]),h=i.pointsValuesLinear[r+e*3+0],u=i.pointsValuesLinear[r+e*3+1],f=i.pointsValuesLinear[r+e*3+2],p=i.pointsValuesLinear[r+t*3+0],m=i.pointsValuesLinear[r+t*3+1],g=i.pointsValuesLinear[r+t*3+2];o.x=h*(1-l)+p*l,o.y=u*(1-l)+m*l,o.z=f*(1-l)+g*l}}isTriangleVisible(e,t,n){const i=this.voxelWorld.getClosestAtom(e),r=this.voxelWorld.getClosestAtom(t),o=this.voxelWorld.getClosestAtom(n);return i===null||r===null||o===null||i.srcAtom===null||r.srcAtom===null||o.srcAtom===null?!1:this.visibilitySelector.includesAtom(i.srcAtom)&&this.visibilitySelector.includesAtom(r.srcAtom)&&this.visibilitySelector.includesAtom(o.srcAtom)}addTriangle(e,t,n){if(this.visibilitySelector&&!this.isTriangleVisible(e,t,n))return!0;const i=this.geoOut;if(i._numTriangles>=this.maxNumTriangles)return!1;const r=this.addVertexToGeo(i,e),o=this.addVertexToGeo(i,t),a=this.addVertexToGeo(i,n);if((r|o|a)<0)return!1;const l=3*i._numTriangles;return i._indices[l+0]=r,i._indices[l+1]=o,i._indices[l+2]=a,i._numTriangles++,!0}buildGeoFromCorners(e,t,n,i,r,o){const h=e-1,u=e,f=e*e,p=new Array(12);for(let x=0;x<12;x++)p[x]=new b.Vector3;const m=[];for(let x=0;x<8;x++)m[x]=1;const g=new b.Vector3;let v=0,y=0;for(let x=0;x<h;x++,y+=f){let w=0;for(let S=0;S<h;S++,w+=u)for(let E=0;E<h;E++){if(!o.hasIntersection[v]){v++;continue}const A=o.bitsInside[v];this.getCornerCoord(t,n,E,x,S,e,g);const C=v*32;for(let T=0,R=0;T<8;T++)o.pointsValuesLinear[C+R++]=g.x,o.pointsValuesLinear[C+R++]=g.y,o.pointsValuesLinear[C+R++]=g.z;o.pointsValuesLinear[C+3]+=r.x,o.pointsValuesLinear[C+2*3]+=r.x,o.pointsValuesLinear[C+5*3]+=r.x,o.pointsValuesLinear[C+6*3]+=r.x,o.pointsValuesLinear[C+2*3+2]+=r.z,o.pointsValuesLinear[C+3*3+2]+=r.z,o.pointsValuesLinear[C+6*3+2]+=r.z,o.pointsValuesLinear[C+7*3+2]+=r.z,o.pointsValuesLinear[C+4*3+1]+=r.y,o.pointsValuesLinear[C+5*3+1]+=r.y,o.pointsValuesLinear[C+6*3+1]+=r.y,o.pointsValuesLinear[C+7*3+1]+=r.y;const P=C+24;for(let T=0;T<8;++T)m[T]=o.pointsValuesLinear[P+T]<0?1:0;this.buildEdgePoint(0,1,m,o,C,p[0]),this.buildEdgePoint(1,2,m,o,C,p[1]),this.buildEdgePoint(2,3,m,o,C,p[2]),this.buildEdgePoint(3,0,m,o,C,p[3]),this.buildEdgePoint(4,5,m,o,C,p[4]),this.buildEdgePoint(5,6,m,o,C,p[5]),this.buildEdgePoint(6,7,m,o,C,p[6]),this.buildEdgePoint(7,4,m,o,C,p[7]),this.buildEdgePoint(0,4,m,o,C,p[8]),this.buildEdgePoint(1,5,m,o,C,p[9]),this.buildEdgePoint(2,6,m,o,C,p[10]),this.buildEdgePoint(3,7,m,o,C,p[11]);const L=A*16;for(let T=0,R=0;T<6;T++,R+=3){const G=o.striIndicesMarchCube[L+R];if(G<0)break;const K=o.striIndicesMarchCube[L+R+1],Z=o.striIndicesMarchCube[L+R+2];if(!this.addTriangle(p[G],p[K],p[Z]))return-2}v++}}return 0}getNumIntersectedCells(e,t,n,i){const r=e*e,o=8;let a=0,l=0,h=0;for(let u=0;u<t;u++,h+=r){let f=0;for(let p=0;p<t;p++,f+=e)for(let m=0;m<t;m++){const g=l*32+24,v=m+f+h;i.pointsValuesLinear[g]=n[v],i.pointsValuesLinear[g+1]=n[v+1],i.pointsValuesLinear[g+2]=n[v+e+1],i.pointsValuesLinear[g+3]=n[v+e],i.pointsValuesLinear[g+4]=n[r+v],i.pointsValuesLinear[g+5]=n[r+v+1],i.pointsValuesLinear[g+6]=n[r+v+e+1],i.pointsValuesLinear[g+7]=n[r+v+e];let y=0;for(let x=0;x<o;++x)i.pointsValuesLinear[g+x]<0&&(y|=1<<x);y===0||y===(1<<o)-1?i.hasIntersection[l]=!1:(i.hasIntersection[l]=!0,a++),i.bitsInside[l]=y,l++}}return a}getType(e){const t=[0,0,1,1,2,6,3,6,4,6,5,6,6,0,7,3,8,2,9,6,10,6,11,6,12,6,13,6,14,6,15,4,16,5,17,6,18,6,19,6,20,6,21,6,22,6,23,6,24,6,25,6,26,6,27,6,28,6,29,6,30,6,31,6,32,6,33,6,34,6,35,6,36,6,37,6,38,6,39,6,40,6,41,6,42,6,43,6,44,6,45,6,46,6,47,6,48,6,49,6,50,6,51,6,52,6,53,6,54,6,55,6,56,6,57,6,58,6,59,6,60,6,61,6,62,6,63,6,64,6,65,6,66,6,67,6,68,6,69,6,70,6,71,6,72,6,73,6,74,6,75,6,76,6,77,6,78,6,79,6,80,6,81,6,82,6,83,6,84,6,85,6,86,6,87,6,88,6,89,6,90,6,91,6,92,6,93,6,94,6,95,6,96,6,97,6,98,6,99,6,100,6,101,6,102,6,103,6,104,6,105,6,106,6,107,6,108,6,109,6];if(e<1||e>t.length/2||Object.keys(aV.ByAtomicNumber).length*2!==t.length)throw new Error("atomT.length  should be equal Element.ByAtomicNumber.length * 2");return t[e*2]}calculateGridCorners(e,t,n,i,r,o){const a=t*t,l=a*t,h=new b.Vector3,u=new b.Vector3,f=1e12;for(let v=0;v<l;v++)e[v]=f;const p=(t-1)/(i.x-n.x),m=(t-1)/(i.y-n.y),g=(t-1)/(i.z-n.z);for(let v=0,y=r.length;v<y;v++){const x=r[v],w=x.radius+o,S=(x.coord.x-w-n.x)*p,E=(x.coord.y-w-n.y)*m,A=(x.coord.z-w-n.z)*g,C=Math.floor(S),P=Math.floor(E),L=Math.floor(A);let T=Math.floor((x.coord.x+w-n.x)*p),R=Math.floor((x.coord.y+w-n.y)*m),G=Math.floor((x.coord.z+w-n.z)*g);T++,R++,G++,T=T<=t-1?T:t-1,R=R<=t-1?R:t-1,G=G<=t-1?G:t-1;for(let K=P;K<=R;K++){const Z=K*a;for(let O=L;O<=G;O++){const V=O*t;for(let j=C;j<=T;j++){const q=Z+V+j;this.getCornerCoord(n,i,j,K,O,t,h),u.x=h.x-x.coord.x,u.y=h.y-x.coord.y,u.z=h.z-x.coord.z;const se=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z)-w;se<e[q]&&(e[q]=se)}}}}}createVertexHash(e,t){if(this.hashLines=Oe.allocateTyped(Int32Array,$m*2),this.hashLines===null)return-1;for(let n=0,i=0;n<$m;n++)this.hashLines[i++]=0,this.hashLines[i++]=-1;if(this.maxNumVertices=e,this.maxNumTriangles=t,this.numHashEtriesAllocated=e,this.hashEntries=Oe.allocateTyped(Int32Array,2*this.numHashEtriesAllocated),this.hashEntries===null)return-1;for(let n=0,i=0;n<this.numHashEtriesAllocated;n++)this.hashEntries[i++]=-1,this.hashEntries[i++]=-1;return this.numHashEntryIndex=0,0}getNewHashEntry(){if(this.numHashEntryIndex<this.numHashEtriesAllocated){const e=this.numHashEntryIndex;return this.numHashEntryIndex++,e}return-1}addVertexToGeo(e,t){let n;const h=this.marCubeResoultion<<2,u=new b.Vector3,f=Math.floor(h*(t.x-this.vBoxMin.x)/(this.vBoxMax.x+.01-this.vBoxMin.x)),p=Math.floor(h*(t.y-this.vBoxMin.y)/(this.vBoxMax.y+.01-this.vBoxMin.y)),m=Math.floor(h*(t.z-this.vBoxMin.z)/(this.vBoxMax.z+.01-this.vBoxMin.z));let g=f*815851+m*37633+p*2453543;g&=$m-1;const v=g+g;if(this.vBoxMin!==null&&this.vBoxMax!==null)for(n=this.hashLines[v+1];n>=0;n=this.hashEntries[n*2+1]){const x=this.hashEntries[n*2+0];if(u.copy(e._vertices[x]),u.x-=t.x,u.y-=t.y,u.z-=t.z,u.x*u.x+u.y*u.y+u.z*u.z<1e-6)return x}if(e._numVertices>=this.maxNumVertices)return-1;const y=e._numVertices;if(e._vertices[y].copy(t),this.vBoxMin!==null&&this.vBoxMax!==null){if(n=this.getNewHashEntry(),n<0)return-1;const x=this.hashLines[v+1];this.hashLines[v+1]=n,this.hashEntries[n*2+0]=y,this.hashEntries[n*2+1]=x,this.hashLines[v+0]++}return e._numVertices++,y}modifyExcludedFromGeo(e,t,n,i,r,o){let a,l,h;function f(){h>0&&o[a]<0&&(o[a]=h),h>o[a]&&(o[a]=h)}const p=e*e,m=(e-1)/(i.x-n.x),g=(e-1)/(i.y-n.y),v=(e-1)/(i.z-n.z),y=t*2*(t*2),x=1/(e-1);for(let w=0;w<r._numVertices;w++){const S=r._vertices[w],E=t*1.1;let A=Math.floor((S.x-E-n.x)*m),C=Math.floor((S.y-E-n.y)*g),P=Math.floor((S.z-E-n.z)*v),L=Math.floor((S.x+E-n.x)*m),T=Math.floor((S.y+E-n.y)*g),R=Math.floor((S.z+E-n.z)*v);A=A>=0?A:0,C=C>=0?C:0,P=P>=0?P:0,L=L<=e-1?L:e-1,T=T<=e-1?T:e-1,R=R<=e-1?R:e-1;for(let G=C;G<=T;G++){const K=G*p;for(let Z=P;Z<=R;Z++){const O=Z*e;for(let V=A;V<=L;V++){a=K+O+V;let j=V*x;const q=n.x*(1-j)+i.x*j;j=G*x;const J=n.y*(1-j)+i.y*j;j=Z*x;const se=n.z*(1-j)+i.z*j,_e=q-S.x,Re=J-S.y,ae=se-S.z,ve=_e*_e+Re*Re+ae*ae;ve<y&&(l=Math.sqrt(ve),h=-(l-t),f())}}}}return 0}_innerBuild(){let e;const n={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};this.complex=this._opts.parent,this.atoms=n.atoms,this.meshResolution=this._opts.gridSpacing,this.atomRadiusScale=this._opts.radScale,this.colorMode=this._opts.colorMode,this.probeRadius=this._opts.probeRadius,this.useVertexColors=!0,this.excludeProbe=this._opts.excludeProbe,this.visibilitySelector=this._opts.visibilitySelector,this.geoOut=null,this.hashLines=null,this.hashEntries=null,this.numHashEtriesAllocated=0,this.numHashEntryIndex=0,this.maxNumVertices=0,this.maxNumTriangles=0;const i=new Array(this.atoms.length);this.convertToAtomsColored(n,i);const r=this.vBoxMin=new b.Vector3,o=this.vBoxMax=new b.Vector3;this.getBoundingBox(i,r,o);const a=this.marCubeResoultion=this.meshResolution*4,l=a,u=l*l*l,f=Oe.allocateTyped(Float32Array,u),p=this.probeRadius*this.atomRadiusScale;this.calculateGridCorners(f,l,r,o,i,p);const m=a-1,g=new tE;if(e=g.create(m),e<0)return e;const v=new b.Vector3;v.x=(o.x-r.x)/m,v.y=(o.y-r.y)/m,v.z=(o.z-r.z)/m;let y=this.getNumIntersectedCells(l,m,f,g),x=Math.floor(y*1.2),w=Math.floor(y*1.2*2);if(this.geoOut=new IS(x,w,this.useVertexColors),e=this.createVertexHash(x,w),e<0)return e;let S=p;if(this.excludeProbe&&(S=.01),this.voxelWorld=new rV(i.length,i,r,o,S),this.voxelWorld.createVoxels(),e=this.buildGeoFromCorners(a,r,o,f,v,g),this.excludeProbe){if(this.modifyExcludedFromGeo(l,p,r,o,this.geoOut,f),this.geoOut._vertices=null,this.geoOut._colors=null,this.geoOut._indices=null,this.geoOut._normals=null,this.geoOut._numVertices=0,this.geoOut._numTriangles=0,this.geoOut=null,y=this.getNumIntersectedCells(l,m,f,g),x=Math.floor(y*1.2),w=Math.floor(y*1.2*2),this.geoOut=new IS(x,w,this.useVertexColors),e=this.createVertexHash(x,w),e<0)return e;e=this.buildGeoFromCorners(l,r,o,f,v,g)}this.voxelWorld.buildNormals(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._normals);let E=6.5;return this.excludeProbe&&(E-=1.5),this.useVertexColors&&this.voxelWorld.buildColors(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._colors,E),this.voxelWorld.destroyVoxels(),this.voxelWorld=null,g.destroy(),e}}const cV=lV;function hV(s,e){const t=document.createElement("div");if(t.className=e,typeof s=="string"){const n=document.createElement("span");n.style.fontSize="150%";const i=s.split(`
`);for(let r=0,o=i.length;r<o;++r){const a=document.createElement("span"),l=document.createTextNode(i[r]);a.appendChild(l),n.appendChild(a),r<o-1&&n.appendChild(document.createElement("br"))}t.appendChild(n)}else t.appendChild(s);return t.worldPos=new b.Vector3,t}class uV extends Yi{constructor(e,t){super(),this._opts=t,this.items=[],this.needsUpdate=!1;let n=-50,i=-50;switch(t.horizontalAlign){case"left":n=0;break;case"right":n=-100;break}switch(t.verticalAlign){case"top":i=-100;break;case"bottom":i=0;break}const r=new b.Vector3(t.dx||0,t.dy||0,t.dz||0);this.userData={translation:`translate(${n}%, ${i}%)`,offset:r}}setItem(e,t,n){const i=this._opts,r=this.items[e]||hV(n,"label");r.worldPos.copy(t),r.style.textAlign=i.horizontalAlign,r.style.verticalAlign=i.verticalAlign,this.items[e]=r}setColor(e,t,n){const i=this.items[e];i.opts={color:t,background:n}}startUpdate(){return!0}finishUpdate(){this.needsUpdate=!0,this.dispatchEvent({type:"update"})}finalize(){this.finishUpdate()}raycast(){}setOpacity(){}getSubset(){return[]}}const dV=uV,Nr={InstancedSpheresGeometry:qM,SimpleSpheresGeometry:vz,Simple2CCylindersGeometry:M_,Instanced2CCylindersGeometry:$M,ExtrudedObjectsGeometry:Iz,ChunkedLinesGeometry:JM,TwoColorLinesGeometry:zz,CrossGeometry:kz,QuickSurfGeometry:$z,ContactSurfaceGeometry:eV,SSIsosurfaceGeometry:cV,LabelsGeometry:dV},fV=`float INSTANCED_SPRITE_OVERSCALE = 1.3;\r
\r
attribute vec3 normal;\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  varying vec3 viewNormal;\r
#endif\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  varying vec3 vNormal;\r
#endif\r
\r
#ifdef THICK_LINE\r
  attribute vec4 position; // W contains vert pos or neg offset\r
#else\r
  attribute vec3 position;\r
#endif\r
\r
varying vec3 vWorldPosition;\r
varying vec3 vViewPosition;\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  attribute float alphaColor;\r
  varying float alphaCol;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\r
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r
		varying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  attribute vec3 color;\r
  varying vec3 vColor;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  attribute vec3 color2;\r
  varying vec3 vColor2;\r
  attribute vec2 uv;\r
  #ifndef CYLINDER_SPRITE\r
    varying vec2 vUv;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_POS\r
  attribute vec4 offset;\r
  #ifdef SPHERE_SPRITE\r
    varying vec4 instOffset;\r
  varying vec4 spritePosEye;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  attribute vec4 matVector1;\r
  attribute vec4 matVector2;\r
  attribute vec4 matVector3;\r
  attribute vec4 invmatVector1;\r
  attribute vec4 invmatVector2;\r
  attribute vec4 invmatVector3;\r
\r
  #ifdef CYLINDER_SPRITE\r
    varying vec4 matVec1;\r
    varying vec4 matVec2;\r
    varying vec4 matVec3;\r
    varying vec4 invmatVec1;\r
    varying vec4 invmatVec2;\r
    varying vec4 invmatVec3;\r
    varying vec4 spritePosEye;\r
  #endif\r
#endif\r
\r
uniform mat4 modelViewMatrix; // optional\r
uniform mat4 projectionMatrix; // optional\r
uniform mat3 normalMatrix; // optional\r
uniform mat4 modelMatrix; // optional\r
\r
#ifdef DASHED_LINE\r
  attribute float lineDistance;\r
  varying float vLineDistance;\r
#endif\r
\r
#ifdef THICK_LINE\r
  attribute vec3 direction;\r
  uniform mat4 projMatrixInv;\r
  uniform vec2 viewport;\r
  uniform float lineWidth;\r
\r
  vec4 transform(vec4 coord){\r
    return projectionMatrix * modelViewMatrix * coord;\r
  }\r
\r
  vec2 project(vec4 device){\r
    vec3 device_normal = device.xyz/device.w;\r
    vec2 clip_pos = (device_normal*0.5+0.5).xy;\r
    return clip_pos * viewport;\r
  }\r
\r
  vec4 unproject(vec2 screen, float z, float w){\r
    vec2 clip_pos = screen/viewport;\r
    vec2 device_normal = clip_pos*2.0-1.0;\r
    return vec4(device_normal*w, z, w);\r
  }\r
#endif\r
\r
\r
/////////////////////////////////////////// Main ///////////////////////////////////////////////\r
void main() {\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  alphaCol = alphaColor;\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  vec3 objectNormal = vec3(\r
    dot(normal, matVector1.xyz),\r
    dot(normal, matVector2.xyz),\r
    dot(normal, matVector3.xyz));\r
#else\r
  vec3 objectNormal = vec3( normal );\r
#endif\r
\r
vec3 transformedNormal = normalMatrix * objectNormal;\r
\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  vNormal = normalize(transformedNormal);\r
#endif\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  viewNormal = normalize(mat3(modelViewMatrix)*objectNormal);\r
#endif\r
\r
  vec4 localPos = vec4(position.xyz, 1.0);\r
  vec4 worldPos = modelMatrix * localPos;\r
  vec4 mvPosition = modelViewMatrix * localPos;\r
\r
// make thick line offset\r
#ifdef THICK_LINE\r
   // get screen pos\r
   vec4 dPos = transform(vec4(position.xyz, 1.0));\r
   vec2 sPos = project(dPos);\r
   // move pos forward\r
   vec3 position2 = position.xyz + direction.xyz * 0.5;\r
   // get screen offset pos\r
   vec4 dPos2 = transform(vec4(position2.xyz, 1.0));\r
   vec2 sPos2 = project(dPos2);\r
   // screen line direction\r
   vec2 sDir = normalize(sPos2 - sPos);\r
   // vertex offset (orthogonal to line direction)\r
   vec2 offset1 = vec2(-sDir.y, sDir.x);\r
   // move screen vertex\r
   vec2 newPos = sPos + offset1 * position.w * lineWidth;\r
   // get moved pos in view space\r
   vec4 dNewPos =  unproject(newPos, dPos.z, dPos.w);\r
   mvPosition.xyz = (projMatrixInv * dNewPos).xyz;\r
#endif // THICK_LINE\r
\r
#ifdef INSTANCED_POS\r
  #ifdef SPHERE_SPRITE\r
    instOffset = offset;\r
\r
    vec4 posEye = modelViewMatrix * vec4( offset.xyz, 1.0 );\r
    float scale = length(modelViewMatrix[0]);\r
    mvPosition = posEye + vec4( position.xyz * offset.w * scale * INSTANCED_SPRITE_OVERSCALE, 0.0 );\r
    posEye.w = offset.w * scale;\r
\r
    spritePosEye = posEye;\r
 #else\r
    localPos = vec4( offset.xyz + position.xyz * offset.w, 1.0 );\r
    worldPos = modelMatrix * localPos;\r
    mvPosition = modelViewMatrix * localPos;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  #ifdef CYLINDER_SPRITE\r
    matVec1 = matVector1;\r
    matVec2 = matVector2;\r
    matVec3 = matVector3;\r
    invmatVec1 = invmatVector1;\r
    invmatVec2 = invmatVector2;\r
    invmatVec3 = invmatVector3;\r
\r
    // calculate eye coords of cylinder endpoints\r
    vec4 v = vec4(0, -0.5, 0, 1);\r
    vec4 p1 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r
    v.y = 0.5;\r
    vec4 p2 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r
\r
    // sprite is placed at the center of cylinder\r
    vec4 posEye;\r
    posEye.xyz = mix(p1.xyz, p2.xyz, 0.5);\r
    posEye.w = 1.0;\r
    spritePosEye = posEye;\r
\r
    // cylinder radius in eye space\r
    float rad = length(modelViewMatrix[0]) * length(vec3(matVector1.x, matVector2.x, matVector3.x));\r
    vec2 spriteSize;\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // In ortho projection we skip z coordinate\r
      // basic sprite size at screen plane (covers only cylinder axis)\r
      vec2 spriteSizeScreen = abs(p2.xy - p1.xy);\r
\r
      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * (spriteSizeScreen + 2.0 * rad);\r
    #else\r
      // basic sprite size at screen plane (covers only cylinder axis)\r
      vec2 spriteSizeScreen = abs(p2.xy / p2.z - p1.xy / p1.z);\r
\r
      // full sprite size in eye coords\r
      float minZ = min(abs(p1.z), abs(p2.z));\r
      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * abs(posEye.z) * (spriteSizeScreen + 2.0 * rad / minZ);\r
    #endif\r
\r
    mvPosition = posEye + vec4( position.xy * 0.5 * spriteSize, 0, 0 );\r
  #else\r
    localPos = vec4(dot(localPos, matVector1), dot(localPos, matVector2), dot(localPos, matVector3), 1.0);\r
    worldPos = modelMatrix * localPos;\r
    mvPosition = modelViewMatrix * localPos;\r
  #endif\r
#endif\r
\r
  gl_Position = projectionMatrix * mvPosition;\r
\r
  vWorldPosition = worldPos.xyz;\r
  vViewPosition = - mvPosition.xyz;\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
	  vec4 worldPosition;\r
	  // see THREE.WebGLProgram.unrollLoops\r
	  #pragma unroll_loop_start\r
	  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
      vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * vec4(vWorldPosition, 1.0);\r
      vDirectionalShadowNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(objectNormal, 0.0))).xyz;\r
	  }\r
	  #pragma unroll_loop_end\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  vColor = color.xyz;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  vColor2 = color2;\r
  #ifndef CYLINDER_SPRITE\r
    vUv = uv;\r
  #endif\r
#endif\r
\r
#ifdef DASHED_LINE\r
  vLineDistance = lineDistance;\r
#endif\r
}\r
`,pV=`#if defined (NORMALS_TO_G_BUFFER)\r
  #define fragColor gl_FragData[0]\r
#else\r
  #define fragColor gl_FragColor\r
#endif\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  varying float alphaCol;\r
#endif\r
\r
#ifdef COLOR_FROM_POS\r
  uniform mat4 world2colorMatrix;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\r
    uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ]; //only for sprites\r
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r
		varying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r
    vec4 vDirLightWorldCoord[ NUM_DIR_LIGHTS ];\r
    vec3 vDirLightWorldNormal[ NUM_DIR_LIGHTS ];\r
\r
    #ifdef SHADOWMAP_PCF_RAND\r
      // We use 4 instead uniform variable or define because this value is used in for(... i < value; ...) with\r
      // unroll_loop and unroll_loop has pattern:\r
      // /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g\r
      uniform vec2 samplesKernel[4]; // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
      uniform sampler2D noiseTex;\r
      uniform vec2 noiseTexelSize;\r
      uniform vec2 srcTexelSize;\r
      uniform mat4 projectionMatrix;\r
    #endif\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  varying vec3 vColor;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  varying vec3 vColor2;\r
  #ifndef CYLINDER_SPRITE\r
    varying vec2 vUv;\r
  #endif\r
#endif\r
\r
uniform vec3 diffuse;\r
uniform vec3 emissive;\r
uniform vec3 specular;\r
uniform float shininess;\r
uniform vec3 fixedColor;\r
uniform float opacity;\r
uniform float zClipValue;\r
uniform float clipPlaneValue;\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  varying vec3 viewNormal;\r
#endif\r
\r
#define RECIPROCAL_PI 0.31830988618\r
#define saturate(a) clamp( a, 0.0, 1.0 )\r
\r
#ifdef USE_FOG\r
  uniform vec3 fogColor;\r
  uniform float fogAlpha;\r
  uniform float fogNear;\r
  uniform float fogFar;\r
#endif\r
\r
varying vec3 vWorldPosition; // world position of the pixel (invalid when INSTANCED_SPRITE is defined)\r
varying vec3 vViewPosition;\r
\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  varying vec3 vNormal;\r
#endif\r
\r
/////////////////////////////////////////// ZSprites ////////////////////////////////////////////////\r
#if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r
  uniform float nearPlaneValue;\r
#endif\r
\r
#ifdef SPHERE_SPRITE\r
  varying vec4 spritePosEye;\r
#endif\r
\r
#if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
  uniform float zOffset;\r
\r
  #if !defined(USE_LIGHTS) || !defined(SHADOWMAP) || !defined(SHADOWMAP_PCF_RAND) || !(NUM_DIR_LIGHTS > 0)\r
    uniform mat4 projectionMatrix;\r
  #endif\r
\r
  float calcDepthForSprites(vec4 pixelPosEye, float zOffset, mat4 projMatrix) {\r
    vec4 pixelPosScreen = projMatrix * pixelPosEye;\r
    return 0.5 * (pixelPosScreen.z / pixelPosScreen.w + 1.0) + zOffset;\r
  }\r
#endif\r
\r
#ifdef SPHERE_SPRITE\r
  varying vec4 instOffset;\r
  uniform mat4 modelMatrix;\r
  uniform mat4 modelViewMatrix;\r
  uniform mat4 invModelViewMatrix;\r
  uniform mat3 normalMatrix;\r
\r
\r
  bool intersect_ray_sphere(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r
\r
    // intersect XZ-projected ray with circle\r
    float a = dot(ray, ray);\r
    float b = dot(ray, origin);\r
    float c = dot(origin, origin) - 1.0;\r
    float det = b * b - a * c;\r
    if (det < 0.0) return false;\r
    float t1 = (-b - sqrt(det)) / a;\r
    float t2 = (-b + sqrt(det)) / a;\r
\r
    // calculate both intersection points\r
    vec3 p1 = origin + ray * t1;\r
    vec3 p2 = origin + ray * t2;\r
\r
    // choose nearest point inside frustum\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // orthografic camera is used for dirLight sources. So in it for all spheres the point with smaller 't' is visible\r
      // t1 is always smaller than t2 (from calculations)\r
      point = p1;\r
      frontFaced = 1.0;\r
      return true;\r
    #else\r
      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r
      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r
      if (t1 >= 0.0) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (t2 >= 0.0) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #endif\r
\r
    return false;\r
  }\r
\r
  bool get_sphere_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r
    vec3 origin, ray;\r
\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // transform vector from sprite center to curPixel into sphere local coords\r
      origin = pixelPosEye.xyz - spritePosEye.xyz;\r
      origin = (invModelViewMatrix * vec4(origin, 0.0)).xyz / instOffset.w;\r
\r
      // transform camera orientation vector into sphere local coords\r
      ray = (invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\r
    #else\r
      // find point of intersection near plane by the ray from camera to curPixel\r
      vec4 v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r
\r
      // transform intersection point into sphere local coords\r
      v = invModelViewMatrix * v;\r
      origin = (v.xyz - instOffset.xyz) / instOffset.w;\r
\r
      // transform vector from camera pos to curPixel into sphere local coords\r
      ray = (invModelViewMatrix * vec4(pixelPosEye, 0.0)).xyz;\r
    #endif\r
    ray = normalize(ray);\r
\r
    return intersect_ray_sphere(origin, ray, point, frontFaced);\r
  }\r
#endif\r
\r
#ifdef CYLINDER_SPRITE\r
  varying vec4 matVec1;\r
  varying vec4 matVec2;\r
  varying vec4 matVec3;\r
  varying vec4 invmatVec1;\r
  varying vec4 invmatVec2;\r
  varying vec4 invmatVec3;\r
\r
  uniform mat4 modelMatrix;\r
  uniform mat4 modelViewMatrix;\r
  uniform mat4 invModelViewMatrix;\r
  uniform mat3 normalMatrix;\r
\r
  varying vec4 spritePosEye;\r
\r
  bool intersect_ray_cylinder(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r
\r
    // intersect XZ-projected ray with circle\r
    float a = dot(ray.xz, ray.xz);\r
    float b = dot(ray.xz, origin.xz);\r
    float c = dot(origin.xz, origin.xz) - 1.0;\r
    float det = b * b - a * c;\r
    if (det < 0.0) return false;\r
    float t1 = (-b - sqrt(det)) / a;\r
    float t2 = (-b + sqrt(det)) / a;\r
\r
    // calculate both intersection points\r
    vec3 p1 = origin + ray * t1;\r
    vec3 p2 = origin + ray * t2;\r
\r
    float halfHeight = 0.5;\r
\r
    // choose nearest point\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // orthografic camera is used for dirLight sources. So in it for all cylinders the point with smaller 't' is visible\r
      // if it is not outside of cylinnder (t1 is always smaller than t2).\r
      if (p1.y >= -halfHeight && p1.y <= halfHeight) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (p2.y >= -halfHeight && p2.y <= halfHeight) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #else\r
      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r
      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r
      if (t1 >= 0.0 && p1.y >= -halfHeight && p1.y <= halfHeight) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (t2 >= 0.0 && p2.y >= -halfHeight && p2.y <= halfHeight) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #endif\r
\r
    return false;\r
  }\r
\r
  bool get_cylinder_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r
    vec3 origin, ray;\r
    vec4 v;\r
\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // transform vector from sprite center to curPixel into cylinder local coords\r
      v = invModelViewMatrix * vec4(pixelPosEye.xyz - spritePosEye.xyz, 0.0);\r
      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
\r
      // transform camera orientation vector into cylinder local coords\r
      v = invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0);\r
      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
    #else\r
      // find point of intersection near plane by the ray from camera to curPixel\r
      v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r
\r
      // transform intersection point into cylinder local coords\r
      v = invModelViewMatrix * v;\r
      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
\r
      // transform vector from camera pos to curPixel into cylinder local coords\r
      v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\r
      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
    #endif\r
    ray = normalize(ray);\r
\r
    return intersect_ray_cylinder(origin, ray, point, frontFaced);\r
  }\r
#endif\r
\r
///////////////////////////////////// Pack and unpack ///////////////////////////////////////////////\r
const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r
const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r
\r
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r
\r
\r
const float ShiftRight8 = 1. / 256.;\r
\r
vec4 packDepthToRGBA( const in float v ) {\r
  vec4 r = vec4( fract( v * PackFactors ), v );\r
  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\r
  return r * PackUpscale;\r
}\r
\r
float unpackRGBAToDepth( const in vec4 v ) {\r
  return dot( v, UnpackFactors );\r
}\r
\r
////////////////////////////////////////// All Lighting /////////////////////////////////////////////////\r
#ifdef TOON_SHADING\r
  #define LOW_TOON_BORDER 0.0\r
  #define MEDIUM_TOON_BORDER 0.7\r
  #define HIGH_TOON_BORDER 1.0\r
\r
  #define MEDIUM_TOON_RANGE 0.5\r
  #define HIGH_TOON_RANGE 0.95\r
#endif\r
#if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r
  struct ReflectedLight {\r
    vec3 directDiffuse;\r
    vec3 directSpecular;\r
    vec3 indirectDiffuse;\r
  };\r
\r
  struct BlinnPhongMaterial {\r
    vec3  diffuseColor;\r
    vec3  specularColor;\r
    float specularShininess;\r
  };\r
\r
  struct GeometricContext {\r
    vec3 normal;\r
    vec3 viewDir;\r
  };\r
\r
  struct DirectionalLight {\r
    vec3 direction;\r
    vec3 color;\r
  };\r
  uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r
\r
  struct DirectionalLightShadow {\r
     vec2 shadowMapSize;\r
     float shadowBias;\r
     float shadowRadius;\r
   };\r
  uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHTS ];\r
\r
  uniform vec3 ambientLightColor;\r
\r
  /////////////////////////////////////////// Shadowmap ////////////////////////////////////////////////\r
\r
  #if defined(SHADOWMAP)\r
  	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\r
  		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r
  	}\r
\r
    float getShadow( sampler2D shadowMap, DirectionalLightShadow dirLight, vec4 shadowCoord, vec3 vViewPosition, vec3 vNormal ) {\r
   	  float shadow = 0.0;\r
\r
      // When shadows for sprites will appear use here for them normals as it done for G-buffer\r
      shadowCoord.xyz += dirLight.shadowBias * vNormal;\r
      shadowCoord.xyz /= shadowCoord.w;\r
\r
      bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r
      bool inFrustum = all( inFrustumVec );\r
      bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r
      bool frustumTest = all( frustumTestVec );\r
\r
      if ( frustumTest ) {\r
        #ifdef SHADOWMAP_BASIC\r
      	  shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r
      	#endif\r
\r
      	#ifdef SHADOWMAP_PCF_SHARP\r
      	  vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r
\r
            float dx0 = - texelSize.x * dirLight.shadowRadius;\r
            float dy0 = - texelSize.y * dirLight.shadowRadius;\r
            float dx1 = + texelSize.x * dirLight.shadowRadius;\r
            float dy1 = + texelSize.y * dirLight.shadowRadius;\r
\r
            shadow = (\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r
            ) * ( 1.0 / 9.0 );\r
        #endif\r
\r
        #ifdef SHADOWMAP_PCF_RAND\r
          vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r
\r
          vec4 vUv = ((projectionMatrix * vec4(vViewPosition, 1.0)) + 1.0) / 2.0;\r
          vec2 vUvNoise = vUv.xy / srcTexelSize * noiseTexelSize;\r
\r
          vec2 noiseVec = normalize(texture2D(noiseTex, vUvNoise).rg);\r
          mat2 mNoise = mat2(noiseVec.x, noiseVec.y, -noiseVec.y, noiseVec.x);\r
\r
          vec2 offset;\r
          #pragma unroll_loop_start\r
          for ( int i = 0; i < 4; i ++ ) { // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
            offset = mNoise * ( normalize( samplesKernel[ i ]) * texelSize * dirLight.shadowRadius );\r
            shadow +=  texture2DCompare( shadowMap, shadowCoord.xy + offset, shadowCoord.z );\r
          }\r
          #pragma unroll_loop_end\r
          shadow /= float( 4 ); // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
        #endif\r
      }\r
      return shadow;//(shadow != 1.0) ? 0.5 : 1.0;//vec4(shadow, shadow, shadow, 1.0);\r
   }\r
  #endif\r
\r
  /////////////////////////////////////////// Lighting /////////////////////////////////////////////////\r
\r
  vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\r
    return RECIPROCAL_PI * diffuseColor;\r
  } // validated\r
\r
  vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\r
    // Original approximation by Christophe Schlick '94\r
    //;float fresnel = pow( 1.0 - dotLH, 5.0 );\r
    // Optimized variant (presented by Epic at SIGGRAPH '13)\r
    float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\r
    return ( 1.0 - specularColor ) * fresnel + specularColor;\r
  } // validated\r
\r
  float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\r
    // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\r
    return 0.25;\r
  }\r
\r
  float D_BlinnPhong( const in float shininess, const in float dotNH ) {\r
    return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\r
  }\r
\r
  vec3 BRDF_Specular_BlinnPhong( const in DirectionalLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\r
    vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r
    float dotNH = saturate(dot( geometry.normal, halfDir ));\r
    float dotLH = saturate(dot( incidentLight.direction, halfDir ));\r
\r
    vec3 F = F_Schlick( specularColor, dotLH );\r
    float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\r
    float D = D_BlinnPhong( shininess, dotNH );\r
\r
    return F * ( G * D );\r
  } // validated\r
\r
  void RE_Direct_BlinnPhong( const in DirectionalLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight, float penumbra ) {\r
\r
    float dotNL = saturate( dot( geometry.normal, directLight.direction ));\r
    #ifdef TOON_SHADING\r
      if(dotNL < MEDIUM_TOON_RANGE){\r
        dotNL = LOW_TOON_BORDER;\r
      }\r
      else if(dotNL < HIGH_TOON_RANGE){\r
        dotNL = MEDIUM_TOON_BORDER;\r
      }\r
      else{\r
        dotNL = HIGH_TOON_BORDER;\r
      }\r
    #endif\r
\r
    vec3 irradiance = dotNL * directLight.color;\r
    reflectedLight.directDiffuse += penumbra * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r
    reflectedLight.directSpecular += penumbra * irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess );\r
  }\r
\r
  void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r
  }\r
\r
  vec3 calcLighting(const in GeometricContext geometry, const in BlinnPhongMaterial material, vec3 vViewPosition) {\r
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\r
    vec3 irradiance = ambientLightColor;\r
\r
    float shadowMask = 1.0;\r
    // see THREE.WebGLProgram.unrollLoops\r
  	#pragma unroll_loop_start\r
  	  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
  	    #ifdef SHADOWMAP\r
  	      shadowMask = getShadow( directionalShadowMap[ i ], directionalLightShadows[ i ], vDirLightWorldCoord[ i ], vViewPosition, vDirLightWorldNormal[ i ] );\r
        #endif\r
\r
  		  if ( shadowMask > 0.0 ) RE_Direct_BlinnPhong( directionalLights[ i ], geometry, material, reflectedLight, shadowMask );\r
  		}\r
  		#pragma unroll_loop_end\r
\r
    RE_IndirectDiffuse_BlinnPhong(irradiance, material, reflectedLight);\r
\r
    return saturate(reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular);\r
  }\r
#endif\r
\r
/////////////////////////////////////////// Dashed Line ///////////////////////////////////////////////\r
#ifdef DASHED_LINE\r
  uniform float dashedLineSize;\r
  uniform float dashedLinePeriod;\r
  varying float vLineDistance;\r
#endif\r
\r
/////////////////////////////////////////// Main ///////////////////////////////////////////////\r
void main() {\r
\r
#ifdef CLIP_PLANE\r
  if (vViewPosition.z < clipPlaneValue) discard;\r
#endif\r
\r
#ifdef ZCLIP\r
  if (vViewPosition.z < zClipValue) discard;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
  #if NUM_DIR_LIGHTS > 0\r
    // see THREE.WebGLProgram.unrollLoops\r
    #pragma unroll_loop_start\r
    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
      vDirLightWorldCoord[ i ] = vDirectionalShadowCoord[ i ];\r
      vDirLightWorldNormal[ i ] = vDirectionalShadowNormal[ i ];\r
    }\r
    #pragma unroll_loop_end\r
  #endif\r
#endif\r
\r
  vec4 pixelPosWorld = vec4(vWorldPosition, 1.0);\r
  vec4 pixelPosEye;\r
\r
#ifdef SPHERE_SPRITE\r
\r
  vec3 viewNormalSprites;\r
  float frontFaced = 1.0;\r
  vec3 normal;\r
\r
/* quick-and-dirty method\r
  normal.xy = ' + INSTANCED_SPRITE_OVERSCALE + ' * (2.0 * vUv - 1.0);\r
  float r2 = dot(normal.xy, normal.xy);\r
  if (r2 > 1.0) discard;\r
  float normalZ = sqrt(1.0 - r2);\r
  normal.z = normalZ;\r
  normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\r
  pixelPosEye = vec4(spritePosEye.xyz, 1.0);\r
  pixelPosEye.z += spritePosEye.w * normalZ;\r
*/\r
\r
  // ray-trace sphere surface\r
  {\r
    vec3 p;\r
    if (!get_sphere_point(-vViewPosition, p, frontFaced)) discard;\r
    vec4 v = vec4(instOffset.xyz + p * instOffset.w, 1.0);\r
    pixelPosWorld = modelMatrix * v;\r
    pixelPosEye = modelViewMatrix * v;\r
    normal = normalize(normalMatrix * p);\r
    #ifdef NORMALS_TO_G_BUFFER\r
      viewNormalSprites = normalize(mat3(modelViewMatrix)*p);\r
    #endif\r
\r
    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
      #if NUM_DIR_LIGHTS > 0\r
        // see THREE.WebGLProgram.unrollLoops\r
        #pragma unroll_loop_start\r
          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r
            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(p, 0.0))).xyz;\r
          }\r
        #pragma unroll_loop_end\r
      #endif\r
    #endif\r
  }\r
#endif\r
\r
#ifdef CYLINDER_SPRITE\r
  vec3 normal;\r
  vec3 viewNormalSprites;\r
  float frontFaced = 1.0;\r
  float cylinderY = 0.0;\r
\r
  // ray-trace cylinder surface\r
  {\r
    vec3 p;\r
    if (!get_cylinder_point(-vViewPosition, p, frontFaced)) discard;\r
\r
    cylinderY = 0.5 * (p.y + 1.0);\r
\r
    vec4 v = vec4(p, 1.0);\r
    v = vec4(dot(v, matVec1), dot(v, matVec2), dot(v, matVec3), 1.0);\r
    pixelPosWorld = modelMatrix * v;\r
    pixelPosEye = modelViewMatrix * v;\r
\r
    vec3 localNormal = normalize(vec3(p.x, 0.0, p.z));\r
    normal = vec3(\r
      dot(localNormal, matVec1.xyz),\r
      dot(localNormal, matVec2.xyz),\r
      dot(localNormal, matVec3.xyz));\r
    #ifdef NORMALS_TO_G_BUFFER\r
      viewNormalSprites = normalize(mat3(modelViewMatrix)*normal);\r
    #endif\r
\r
    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
      #if NUM_DIR_LIGHTS > 0\r
        // see THREE.WebGLProgram.unrollLoops\r
        #pragma unroll_loop_start\r
          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r
            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(normal, 0.0))).xyz;\r
          }\r
        #pragma unroll_loop_end\r
      #endif\r
    #endif\r
\r
    normal = normalize(normalMatrix * normal);\r
  }\r
#endif\r
\r
  #ifdef ATTR_COLOR\r
    vec3 vertexColor = vColor;\r
  #else\r
    vec3 vertexColor = vec3(1.0, 1.0, 1.0);\r
  #endif\r
\r
  #ifdef ATTR_COLOR2\r
    #ifdef CYLINDER_SPRITE\r
      float colorCoef = cylinderY; // cylinder parameter is calculated from ray-tracing\r
    #else\r
      float colorCoef = vUv.y; // cylinder parameter is interpolated as tex coord\r
    #endif\r
      // choose either color or color2\r
    vertexColor = mix(vColor2, vColor, step(0.5, colorCoef));\r
  #endif\r
\r
  // negative red component is a special condition\r
  if (vertexColor.x < 0.0) discard;\r
\r
  #ifdef DASHED_LINE\r
    if ( mod( vLineDistance, dashedLinePeriod ) > dashedLineSize ) discard;\r
  #endif\r
\r
  // transparency prepass writes only z, so we don't need to calc the color\r
  #ifdef PREPASS_TRANSP\r
    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
    #endif\r
    return;\r
  #endif\r
\r
    float totalOpacity = opacity;\r
\r
  #ifdef ATTR_ALPHA_COLOR\r
    totalOpacity *= alphaCol;\r
  #endif\r
\r
  // discard fully transparent pixels\r
  if (totalOpacity == 0.0) discard;\r
\r
  #ifdef FAKE_OPACITY\r
    // discard pixels in checker pattern\r
    vec2 dm_coord = floor(gl_FragCoord.xy);\r
    dm_coord = fract(dm_coord * 0.5);\r
    if (totalOpacity < 1.0 && (dm_coord.x < 0.5 ^^ dm_coord.y < 0.5)) discard;\r
    vec4 diffuseColor = vec4(diffuse, 1.0);\r
  #else\r
    vec4 diffuseColor = vec4(diffuse, totalOpacity);\r
  #endif\r
\r
  float flipNormal;\r
  #if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
    flipNormal = 1.0;\r
    #ifdef DOUBLE_SIDED\r
      flipNormal = float( gl_FrontFacing );\r
    #endif\r
    vec3 normal = normalize( vNormal ) * flipNormal;\r
  #endif\r
\r
    diffuseColor.rgb *= vertexColor;\r
\r
  #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
    gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
  #endif\r
\r
  #ifdef NORMALS_TO_G_BUFFER\r
    #if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r
      vec3 viewNormaInColor = viewNormalSprites;\r
    #else\r
      vec3 viewNormaInColor = viewNormal;\r
      float frontFaced = float( gl_FrontFacing );\r
    #endif\r
    // [-1, 1] -> [0, 1]\r
    viewNormaInColor = 0.5 * viewNormaInColor + 0.5;\r
    gl_FragData[1] = vec4(viewNormaInColor, frontFaced);\r
  #endif\r
\r
  #if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r
    vec3 viewDir;\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      viewDir = -pixelPosEye.xyz;\r
    #else\r
      viewDir = vViewPosition;\r
    #endif\r
    GeometricContext geometry = GeometricContext(normal, normalize( viewDir ));\r
    BlinnPhongMaterial material = BlinnPhongMaterial(diffuseColor.rgb, specular, shininess);\r
    vec3 outgoingLight = calcLighting(geometry, material, viewDir);\r
  #else\r
    vec3 outgoingLight = diffuseColor.rgb;\r
  #endif\r
\r
  #ifdef COLOR_FROM_DEPTH\r
    float depth = 0.0;\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
      depth = gl_FragDepthEXT;\r
    #else\r
      depth = gl_FragCoord.z;\r
    #endif\r
    fragColor = packDepthToRGBA(depth);\r
    return;\r
  #endif\r
\r
  #ifdef COLOR_FROM_POS\r
    fragColor = world2colorMatrix * pixelPosWorld;\r
  #else\r
    #ifdef OVERRIDE_COLOR\r
      fragColor = vec4(fixedColor, diffuseColor.a);\r
    #else\r
      fragColor = vec4(outgoingLight, diffuseColor.a);//vec4(vNormal, 1.0);\r
    #endif\r
\r
    #ifdef USE_FOG\r
      float viewDistance;\r
      #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
        viewDistance = abs(pixelPosEye.z);\r
      #else\r
        viewDistance = vViewPosition.z;\r
      #endif\r
      float fogFactor = smoothstep( fogNear, fogFar, viewDistance) * fogAlpha;\r
      #ifdef FOG_TRANSPARENT\r
        fragColor.a = fragColor.a * (1.0 - fogFactor);\r
      #else\r
        fragColor.rgb = mix( fragColor.rgb, fogColor, fogFactor );\r
      #endif\r
    #endif\r
\r
  #endif\r
}\r
`,iE={precision:"mediump",init(s){this.precision=s.capabilities.getMaxPrecision("highp")}},rE=4,sE=4,mV=new Uint8Array([24,52,0,255,254,145,0,255,122,0,0,255,7,170,0,255,34,214,0,255,173,8,0,255,86,249,0,255,160,4,0,255,226,46,0,255,224,211,0,255,3,157,0,255,174,247,0,255,12,182,0,255,220,216,0,255,1,109,0,255,253,154,0,255]),gV=b.RepeatWrapping,_V=b.RepeatWrapping,xV=b.NearestFilter,yV=b.NearestFilter,vV=b.UVMapping,oE=new b.DataTexture(mV,rE,sE,b.RGBAFormat,b.UnsignedByteType,vV,gV,_V,yV,xV,1);oE.needsUpdate=!0;const _l={noiseWidth:rE,noiseHeight:sE,noiseTexture:oE},SV=[new b.Vector2(-.541978,.840393),new b.Vector2(.125533,-.992089),new b.Vector2(.374329,.927296),new b.Vector2(-.105475,.994422)],bV=b.UniformsUtils.merge([b.UniformsLib.fog,b.UniformsLib.lights,{diffuse:{value:new b.Color(15658734)},opacity:{value:1},specular:{type:"c",value:new b.Color(1118481)},shininess:{type:"f",value:30},fixedColor:{type:"c",value:new b.Color(16777215)},zOffset:{type:"f",value:0},zClipValue:{type:"f",value:0},clipPlaneValue:{type:"f",value:0},nearPlaneValue:{type:"f",value:-.5},invModelViewMatrix:{type:"4fv",value:new b.Matrix4},world2colorMatrix:{type:"4fv",value:new b.Matrix4},dashedLineSize:{type:"f",value:.1},dashedLinePeriod:{type:"f",value:.2},projMatrixInv:{type:"4fv",value:new b.Matrix4},viewport:{type:"v2",value:new b.Vector2},lineWidth:{type:"f",value:2},fogAlpha:{type:"f",value:1},samplesKernel:{type:"v2v",value:null},noiseTex:{type:"t",value:null},noiseTexelSize:{type:"v2",value:null},srcTexelSize:{type:"v2",value:null}}]),wV=["shininess","opacity","zOffset","diffuse","specular","fixedColor","zClipCoef","zClipValue","clipPlaneValue","world2colorMatrix","dashedLineSize","dashedLinePeriod","projMatrixInv","viewport","lineWidth","fogAlpha","samplesKernel","noiseTex","noiseTexelSize","srcTexelSize"],MV={diffuse:new b.Color(16777215),specular:new b.Color(1118481),shininess:30,opacity:1,fixedColor:new b.Color(16777215),zOffset:0,zClipCoef:2,zClipValue:0,clipPlaneValue:0,world2colorMatrix:new b.Matrix4,dashedLineSize:.1,dashedLinePeriod:.3,projMatrixInv:new b.Matrix4,viewport:new b.Vector2(800,600),lineWidth:2,fogAlpha:1,samplesKernel:SV,noiseTex:_l.noiseTexture,noiseTexelSize:new b.Vector2(1/_l.noiseWidth,1/_l.noiseHeight),srcTexelSize:new b.Vector2(1/800,1/600),copy(s){this.diffuse.copy(s.diffuse),this.specular.copy(s.specular),this.shininess=s.shininess,this.opacity=s.opacity,this.fixedColor.copy(s.fixedColor),this.zOffset=s.zOffset,this.zClipCoef=s.zClipCoef,this.zClipValue=s.zClipValue,this.clipPlaneValue=s.clipPlaneValue,this.world2colorMatrix.copy(s.world2colorMatrix),this.dashedLineSize=s.dashedLineSize,this.dashedLinePeriod=s.dashedLinePeriod,this.projMatrixInv=s.projMatrixInv,this.viewport=s.viewport,this.lineWidth=s.lineWidth,this.toonShading=s.toonShading,this.fogAlpha=s.fogAlpha,this.samplesKernel=s.samplesKernel,this.noiseTex=s.noiseTex,this.noiseTexelSize=s.noiseTexelSize,this.srcTexelSize=s.srcTexelSize}};class oh extends b.RawShaderMaterial{constructor(e){super(e),this.fog=!0,this.instancedPos=!1,this.instancedMatrix=!1,this.attrColor=!1,this.attrColor2=!1,this.attrAlphaColor=!1,this.overrideColor=!1,this.sphereSprite=!1,this.cylinderSprite=!1,this.zClip=!1,this.clipPlane=!1,this.fakeOpacity=!1,this.prepassTransparancy=!1,this.colorFromPos=!1,this.shadowmap=!1,this.shadowmapType="random",this.colorFromDepth=!1,this.orthoCam=!1,this.dashedLine=!1,this.transparent=!0,this.thickLine=!1,this.fogTransparent=!1,this.normalsToGBuffer=!1,this.toonShading=!1,this.uberOptions=Object.create(oh.prototype.uberOptions),super.setValues({uniforms:b.UniformsUtils.clone(bV),vertexShader:this.precisionString()+fV,fragmentShader:this.precisionString()+pV,lights:!0,fog:!0,side:b.DoubleSide}),this.setValues(e)}precisionString(){const{precision:e}=iE;return`precision ${e} float;
precision ${e} int;

`}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=b.UniformsUtils.clone(e.uniforms),this.defines={...e.defines},this.extensions=e.extensions,this.fog=e.fog,this.instancedPos=e.instancedPos,this.instancedMatrix=e.instancedMatrix,this.attrColor=e.attrColor,this.attrColor2=e.attrColor2,this.attrAlphaColor=e.attrAlphaColor,this.overrideColor=e.overrideColor,this.sphereSprite=e.sphereSprite,this.cylinderSprite=e.cylinderSprite,this.zClip=e.zClip,this.clipPlane=e.clipPlane,this.fakeOpacity=e.fakeOpacity,this.colorFromPos=e.colorFromPos,this.shadowmap=e.shadowmap,this.shadowmapType=e.shadowmapType,this.colorFromDepth=e.colorFromDepth,this.orthoCam=e.orthoCam,this.prepassTransparancy=e.prepassTransparancy,this.dashedLine=e.dashedLine,this.thickLine=e.thickLine,this.fogTransparent=e.fogTransparent,this.normalsToGBuffer=e.normalsToGBuffer,this.toonShading=e.toonShading,this.uberOptions.copy(e.uberOptions),this}createInstance(){const e=new oh;return e.copy(this),e.uberOptions=Object.create(this.uberOptions),e}setValues(e){if(typeof e>"u")return;super.setValues(e);const t={},n={};this.fog&&(t.USE_FOG=1),this.instancedPos&&(t.INSTANCED_POS=1),this.instancedMatrix&&(t.INSTANCED_MATRIX=1),this.attrColor&&(t.ATTR_COLOR=1),this.attrColor2&&(t.ATTR_COLOR2=1),this.attrAlphaColor&&(t.ATTR_ALPHA_COLOR=1),this.overrideColor&&(t.OVERRIDE_COLOR=1),this.sphereSprite&&(t.SPHERE_SPRITE=1,n.fragDepth=!0),this.cylinderSprite&&(t.CYLINDER_SPRITE=1,n.fragDepth=!0),this.zClip&&(t.ZCLIP=1),this.clipPlane&&(t.CLIP_PLANE=1),this.fakeOpacity&&(t.FAKE_OPACITY=1),this.lights&&(t.USE_LIGHTS=1),this.colorFromPos&&(t.COLOR_FROM_POS=1),this.shadowmap&&(t.SHADOWMAP=1,this.shadowmapType==="pcf"?t.SHADOWMAP_PCF_SHARP=1:this.shadowmapType==="random"?t.SHADOWMAP_PCF_RAND=1:t.SHADOWMAP_BASIC=1),this.colorFromDepth&&(t.COLOR_FROM_DEPTH=1),this.orthoCam&&(t.ORTHOGRAPHIC_CAMERA=1),this.prepassTransparancy&&(t.PREPASS_TRANSP=1),this.dashedLine&&(t.DASHED_LINE=1),this.thickLine&&(t.THICK_LINE=1),this.fogTransparent&&(t.FOG_TRANSPARENT=1),this.normalsToGBuffer&&(n.drawBuffers=!0,t.NORMALS_TO_G_BUFFER=1),this.toonShading&&(t.TOON_SHADING=1),this.defines=t,this.extensions=n}setUberOptions(e){if(!(typeof e>"u"))for(const t in e)e.hasOwnProperty(t)&&(this.uberOptions[t]instanceof b.Color?this.uberOptions[t]=e[t].clone():this.uberOptions[t]=e[t])}clone(e){return e?this.createInstance():super.clone()}updateUniforms(){const e=this;wV.forEach(t=>{e.uniforms.hasOwnProperty(t)&&(e.uberOptions[t]instanceof b.Color||e.uberOptions[t]instanceof b.Matrix4?e.uniforms[t].value=e.uberOptions[t].clone():e.uniforms[t].value=e.uberOptions[t])})}}oh.prototype.uberOptions=MV;const Wr=oh;function ta(s){class e extends s{constructor(){super(...arguments),this.onBeforeRender=e.prototype.onBeforeRender}onBeforeRender(n,i,r,o,a,l){this._onBeforeRender(n,i,r,o,a,l),this._update()}_onBeforeRender(){}_update(){const{material:n}=this;n&&n instanceof Wr&&n.updateUniforms()}}return e}const LS=ta(b.Mesh);class EV extends LS{constructor(){super(...arguments),this.castShadow=!0,this.receiveShadow=!0}_onBeforeRender(e,t,n,i,r,o){LS.prototype._onBeforeRender.call(this,e,t,n);const{material:a}=this;a&&a.uniforms.invModelViewMatrix&&(this.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld),a.uniforms.invModelViewMatrix.value.copy(this.modelViewMatrix).invert(),a.uniforms.nearPlaneValue.value=n.near,a.uniformsNeedUpdate=!0)}}const aE=EV,NS=ta(b.Mesh),Zs=class Zs extends NS{constructor(e,t){super(e,t),this.castShadow=!0,this.receiveShadow=!0}_onBeforeRender(e,t,n){NS.prototype._onBeforeRender.call(this,e,t,n);const i=this.geometry,{material:r}=this;if(!i.zClip||!r.uberOptions)return;const o=.5,a=Zs._modelView,l=Zs._mvLength,h=Zs._center;a.multiplyMatrices(this.matrixWorld,n.matrixWorldInverse);const u=l.setFromMatrixColumn(a,0).length();h.copy(i.boundingSphere.center),this.localToWorld(h),r.uberOptions.zClipValue=n.position.z-h.z-u*(o*i.boundingSphere.radius)}};lt(Zs,"_mvLength",new b.Vector3),lt(Zs,"_center",new b.Vector3),lt(Zs,"_modelView",new b.Matrix4);let ag=Zs;const AV=ag;class TV extends b.Group{constructor(e,t){super(),this.geometry=e;const n=this;n.initialized=!1,this.geometry.addEventListener("update",()=>{n.update()})}init(){const{children:e}=this;for(let i=e.length-1;i>=0;--i)this.remove(e[i]);const{items:t,userData:n}=this.geometry;for(let i=0,r=t.length;i<r;++i){const o=t[i];if(!o)continue;const a=Oe.shallowCloneNode(o),l=new S_(a);l.userData=Me.default.clone(n);const h=l.getElement();h.style.visibility="visible",l.source=o,this.add(l)}this.initialized=!0}update(){if(!this.geometry.needsUpdate)return;const{children:t}=this;this.initialized||this.init();for(let n=0,i=t.length;n<i;++n){const r=t[n],o=r.source;r.position.copy(o.worldPos),r.userData.color=o.opts.color,r.userData.background=o.opts.background}}}const CV=TV,RV=ta(b.Mesh);class PV extends RV{constructor(e,t){super(e,t),this.castShadow=!0,this.receiveShadow=!0}}const IV=PV,LV=ta(b.Mesh),Zm=new b.Vector2;class NV extends LV{_onBeforeRender(e,t,n,i,r,o){const{material:a}=this;a.uberOptions&&(a.uberOptions.projMatrixInv.copy(n.projectionMatrix).invert(),e.getSize(Zm),a.uberOptions.viewport.set(Zm.width,Zm.height))}}const lE=NV,FV=ta(b.Mesh);class OV extends FV{constructor(){super(...arguments),this.castShadow=!0,this.receiveShadow=!0}}const DV=OV,sr={ZClipped:AV,ZSprite:aE,Text:CV,Line:ta(b.Line),LineSegments:ta(b.LineSegments),Mesh:IV,ThickLineMesh:lE,Instanced:DV};function Th(s,e){return function(t){t.setValues(s),t.setUberOptions(e)}}function FS(s,e){function t(n,i){return new Nr.Instanced2CCylindersGeometry(n,i,s,e)}return{Geometry:t,Object:s?sr.ZSprite:sr.Instanced,initMaterial:Th({instancedMatrix:!0,attrColor:!0,attrColor2:!0,attrAlphaColor:!0,cylinderSprite:s})}}function Km(s,e){const t=s.prototype instanceof ZM,n=e.lineWidth||0;return{Geometry:s,Object:t?sr.ThickLineMesh:sr.LineSegments,initMaterial:Th({lights:!1,attrColor:!0,attrAlphaColor:!0,thickLine:t},{lineWidth:n})}}function UV(s){return{Geometry:s,Object:sr.Mesh,initMaterial:Th({attrColor:!0,attrAlphaColor:!0})}}function Jm(s,e,t,n){const i={wireframe:!!n.wireframe,fakeOpacity:t.now.isoSurfaceFakeOpacity,zClip:n.zClip};return{Geometry:s,Object:sr.ZClipped,initMaterial:Th({attrColor:!0,attrAlphaColor:!1,wireframe:i.wireframe,fakeOpacity:i.fakeOpacity,zClip:i.zClip})}}class BV{static createSpheres(e,t){const n=t.now.zSprites;function i(r,o){return new Nr.InstancedSpheresGeometry(r,o,n)}return{Geometry:i,Object:n?sr.ZSprite:sr.Instanced,initMaterial:Th({instancedPos:!0,attrColor:!0,attrAlphaColor:!0,sphereSprite:n})}}static create2CClosedCylinders(e,t){return FS(!1,!1)}static create2CCylinders(e,t){return FS(t.now.zSprites,!0)}static create2CLines(e,t,n){return Km(Nr.TwoColorLinesGeometry,n)}static createCrosses(e,t,n){return Km(Nr.CrossGeometry,n)}static createExtrudedChains(e,t){return UV(Nr.ExtrudedObjectsGeometry)}static createChunkedLines(e,t,n){return Km(Nr.ChunkedLinesGeometry,n)}static createQuickSurface(e,t,n){return Jm(Nr.QuickSurfGeometry,e,t,n)}static createContactSurface(e,t,n){return Jm(Nr.ContactSurfaceGeometry,e,t,n)}static createSASSES(e,t,n){return Jm(Nr.SSIsosurfaceGeometry,e,t,n)}static createLabels(e,t){return{Geometry:Nr.LabelsGeometry,Object:sr.Text,initMaterial(){}}}}const vi=BV,pl=class pl extends b.Object3D{constructor(e,t,n,i){super(),this._geometry=e,this._geoParams=t;const r=n.createInstance();t.initMaterial(r),this._material=r,this._transforms=i.length>0?i:[new b.Matrix4];const o=this._createMeshes(e);for(let a=0,l=o.length;a<l;++a)this.add(o[a])}raycast(e,t){const n=pl._ray,i=pl._inverseMatrix,{children:r}=this;n.copy(e.ray);for(let o=0,a=r.length;o<a;++o){const l=r[o];if(!yt.belongToSelectLayers(l))continue;l.updateMatrixWorld();const h=l.matrixWorld;i.copy(h).invert(),e.ray.copy(n).applyMatrix4(i);const u=[];this._geometry.raycast(e,u);for(let f=0,p=u.length;f<p;++f){const m=u[f];m.point&&(m.point.applyMatrix4(h),m.distance=n.origin.distanceTo(m.point)),m.object=l,t[t.length]=m}}e.ray.copy(n)}getSubset(e){const t=this._geometry.getSubset(e),n=[];let i=0;for(let r=0,o=t.length;r<o;++r){const a=this._createMeshes(t[r]);for(let l=0,h=a.length;l<h;++l)n[i++]=a[l]}return n}_createMeshes(e){const t=this._transforms,n=this._geoParams.Object,i=this._material,r=[];for(let o=0,a=t.length;o<a;++o){const l=new n(e,i);l.applyMatrix4(t[o]),r[o]=l}return r}};lt(pl,"_inverseMatrix",new b.Matrix4),lt(pl,"_ray",new b.Ray);let lg=pl;const zV=lg;function VV(s,e){const t=[s].concat(e);return s.bind(...t)}class C_ extends oa{constructor(e,t,n,i,r,o,a){if(super(),this.constructor===C_)throw new Error("Can not instantiate abstract class!");this._selection=t,this._mode=i,this._colorer=n,this._chunksIdc=t.chunks,this._polyComplexity=o,this._geo=new(VV(e.Geometry,this._makeGeoArgs())),this._mesh=new zV(this._geo,e,a,r),this.add(this._mesh),this._build()}_makeGeoArgs(){throw new Error("ChemGroup subclass must override _makeGeoArgs() method")}getSubset(e,t){t=t!==void 0?t:!1;const n=this._calcChunksList(e,t);return n.length===0?[]:this._mesh.getSubset(n)}_changeSubsetOpacity(e,t,n){const i=this._calcChunksList(e,n);i.length!==0&&this._geo.setOpacity(i,t)}enableSubset(e,t){t=t!==void 0?t:!0,this._changeSubsetOpacity(e,1,t)}disableSubset(e,t){t=t!==void 0?t:!0,this._changeSubsetOpacity(e,0,t)}}const Of=C_;class kV extends Of{raycast(e,t){const{atoms:n}=this._selection,i=[];this._mesh.raycast(e,i);const r=this._chunksIdc;for(let o=0,a=i.length;o<a;++o){if(!i[o].hasOwnProperty("chunkIdx"))continue;const l=r[i[o].chunkIdx];l<n.length&&(i[o].atom=n[l],t.push(i[o]))}}_calcChunksList(e){const t=[],{atoms:n}=this._selection,i=this._chunksIdc;for(let r=0,o=i.length;r<o;++r)n[i[r]].mask&e&&t.push(r);return t}}const R_=kV;class GV extends R_{_makeGeoArgs(){return[this._selection.chunks.length,this._polyComplexity]}_build(){const e=this._selection.chunks,{atoms:t,parent:n}=this._selection,i=this._mode,r=this._colorer,o=this._geo;for(let a=0,l=e.length;a<l;++a){const h=t[e[a]];o.setItem(a,h.position,i.calcAtomRadius(h)),o.setColor(a,r.getAtomColor(h,n))}o.finalize()}updateToFrame(e){const t=this._selection.chunks,{atoms:n}=this._selection,i=this._mode,r=this._colorer,o=e.needsColorUpdate(r),a=this._geo;for(let l=0,h=t.length;l<h;++l){const u=n[t[l]];a.setItem(l,e.getAtomPos(t[l]),i.calcAtomRadius(u)),o&&a.setColor(l,e.getAtomColor(r,u))}a.finalize()}}const P_=GV;class HV extends P_{_makeGeoArgs(){const e=[],{atoms:t,chunks:n}=this._selection,i=n.length;for(let o=0;o<i;++o)e[o]=t[n[o]];const r=this._mode.getSurfaceOpts();return r.atoms=e,[i,r]}}const WV=HV;class XV extends P_{_makeGeoArgs(){const e=[],{atoms:t,chunks:n}=this._selection,i=n.length;for(let o=0;o<i;++o)e[o]=t[n[o]];const r=this._mode.getSurfaceOpts();return r.atoms=e,r.selection=this._selection,r.colorMode=this._colorer,[i,r]}}const YV=XV;function jV(s){let e=s>>16&255,t=s>>8&255,n=s&255;return .2126*e+.7152*t+.0722*n>127?(e=e*3/10,t=t*3/10,n=n*3/10):(e=255-(255-e)*3/10,t=255-(255-t)*3/10,n=255-(255-n)*3/10),e<<16|t<<8|n}function qV(s){const e=s>>16&255,t=s>>8&255,n=s&255;return 255-e<<16|255-t<<8|255-n}function OS(s){return s.name.getNode()!==null?s.name.getNode():s.getVisualName()}const DS={none(s){return s},adjust:jV,inverse:qV};function Nd(s,e){let t;if(DS.hasOwnProperty(e))t=Oe.hexColor(DS[e](s));else{const n=parseInt(e,16);!Number.isNaN(n)&&e.toLowerCase().startsWith("0x")?t=Oe.hexColor(n):t="#000000"}return t}const US={serial(s){return s.serial},name(s){return s.getVisualName()},elem(s){return s.element.name},residue(s){return s.residue.getType().getName()},sequence(s){return s.residue.getSequence()},chain(s){return s.residue.getChain().getName()},hetatm(s){return s.isHet()},water(s){return s.residue.getType().getName()==="HOH"||s.residue.getType().getName()==="WAT"}},BS=function(s,e){return e.replace(/\{\{(\s*\w+\s*)\}\}/g,t=>{let n=t.replace(/\s+/g,"");return n=n.substring(2,n.length-2).toLowerCase(),US.hasOwnProperty(n)?US[n](s):"null"})};class $V extends R_{_makeGeoArgs(){const e=this._mode.getLabelOpts();return[this._selection.chunks.length,e]}_build(){const e=this._mode.getLabelOpts(),t=this._selection.chunks,{atoms:n,parent:i}=this._selection,r=this._colorer,o=this._geo;for(let a=0,l=t.length;a<l;++a){const h=n[t[a]],u=e.template?BS(h,e.template):OS(h);if(!u)continue;const f=r.getAtomColor(h,i),p=parseInt(Nd(f,e.fg).substring(1),16),m=e.showBg?parseInt(Nd(f,e.bg).substring(1),16):"transparent";o.setItem(a,h.position,u),o.setColor(a,p,m)}o.finalize()}updateToFrame(e){const t=this._mode.getLabelOpts(),n=this._selection.chunks,{atoms:i}=this._selection,r=this._colorer,o=this._geo,a=e.needsColorUpdate(r);for(let l=0,h=n.length;l<h;++l){const u=i[n[l]],f=t.template?BS(u,t.template):OS(u);if(!f)continue;const p=e.getAtomColor(r,u),m=parseInt(Nd(p,t.fg).substring(1),16),g=t.showBg?parseInt(Nd(p,t.bg).substring(1),16):"transparent";o.setItem(l,e.getAtomPos(n[l]),f),a&&o.setColor(l,m,g)}o.finalize()}}const ZV=$V;function zS(s,e,t,n){const i=Math.sin(s);return e.clone().multiplyScalar(Math.sin((1-n)*s)/i).addScaledVector(t,Math.sin(n*s)/i)}class KV extends R_{_buildInner(e,t){const n=this._selection.chunks,i=new b.Vector3,r=new b.Vector3,o=this._segmentsHeight,a=1/o,l=this._colorer,{cycles:h,parent:u}=this._selection;let f=0,p=n[f];for(let m=0,g=h.length;m<g;++m){const v=h[m],y=v.atoms,x=[],w=[],{center:S}=v,E=v.radius-e,A=y.length;let C=0;const P=y[A-1].position;let L=y[C].position;i.subVectors(P,S),r.subVectors(L,S);const T=r.clone().cross(i).normalize();for(;C<A;++C){const R=i.angleTo(r);w[C]=zS(R,i,r,.5).normalize(),L=y[(C+1)%A].position,i.copy(r),r.subVectors(L,S)}for(C=0;C<A;++C){if(y[C].index!==p)continue;const R=w[C],G=w[(C+1)%A],K=l.getAtomColor(y[C],u),Z=R.angleTo(G);for(let O=0;O<=o;++O)x[O]=zS(Z,R,G,O*a).multiplyScalar(E).add(S);t(f++,K,x,S,T),p=n[f]}}}}const cE=KV;function JV(s,e){const t=[];for(let n=0;n<e;++n){const i=-2*n/e*Math.PI;t.push(new b.Vector3(Math.cos(i)*s,Math.sin(i)*s,0))}return t}const{calcChunkMatrix:QV}=yt;class ek extends cE{_build(){const e=this._segmentsHeight,t=this._mode.getAromRadius(),n=new b.Vector2(t,t),i=this._mode.calcStickRadius()+2*t,r=new b.Vector3,o=[],a=this._geo;this._buildInner(i,(l,h,u,f,p)=>{for(let m=0;m<=e;++m){const g=u[m],v=g.clone().sub(f).cross(p);r.addVectors(g,v),o[m]=QV(g,r,p,n)}a.setItem(l,o),a.setColor(l,h)}),a.finalize()}_makeGeoArgs(){return this._segmentsHeight=this._polyComplexity,[JV(1,this._polyComplexity),this._segmentsHeight+1,this._selection.chunks.length]}}const tk=ek;class nk extends cE{_build(){const e=this._geo,t=this._mode.getAromaticOffset();this._buildInner(t,(n,i,r)=>{let o=r[0];for(let a=1;a<=this._segmentsHeight;++a){const l=r[a];e.setSegment(n,a-1,o,l),o=l}e.setColor(n,i)}),e.finalize()}_makeGeoArgs(){return this._segmentsHeight=this._mode.getAromaticArcChunks(),[this._selection.chunks.length,this._segmentsHeight,!0]}}const ik=nk;class rk extends Of{raycast(e,t){const{residues:n}=this._selection,i=[];this._mesh.raycast(e,i);const r=this._chunksIdc;for(let o=0,a=i.length;o<a;++o){if(!i[o].hasOwnProperty("chunkIdx"))continue;const l=r[i[o].chunkIdx];l<n.length&&(i[o].residue=n[l],t.push(i[o]))}}_calcChunksList(e){const t=[],{residues:n}=this._selection,i=this._chunksIdc;for(let r=0,o=i.length;r<o;++r)n[i[r]]._mask&e&&t.push(r);return t}}const hE=rk;class sk extends hE{raycast(e,t){const{residues:n}=this._selection,i=[];this._mesh.raycast(e,i);const r=this._chunksIdc;for(let o=0,a=i.length;o<a;++o){if(!i[o].hasOwnProperty("chunkIdx"))continue;const l=r[Math.floor(i[o].chunkIdx/2)];l<n.length&&(i[o].residue=n[l],t.push(i[o]))}}_build(){const{residues:e,parent:t}=this._selection,n=this._colorer,i=this._geo,r=this._mode.calcStickRadius();let o=0;const a=this._selection.chunks;for(let l=0,h=a.length;l<h;++l){const u=e[a[l]],f=n.getResidueColor(u,t);this._processItem(o++,u._cylinders[0],u._cylinders[1],r,f)}i.finalize()}_calcChunksList(e){const t=[];let n=0;const{residues:i}=this._selection,r=this._chunksIdc;for(let o=0,a=r.length;o<a;++o)i[r[o]]._mask&e&&(t[n++]=2*o,t[n++]=2*o+1);return t}updateToFrame(e){const t=e.getResidues(),{parent:n}=this._selection,i=this._colorer,r=this._geo,o=this._mode.calcStickRadius();let a=0;const l=this._selection.chunks;for(let h=0,u=l.length;h<u;++h){const f=t[l[h]],p=i.getResidueColor(f,n);this._processItem(a++,f._cylinders[0],f._cylinders[1],o,p)}r.finishUpdate()}}const uE=sk;class ok extends uE{_makeGeoArgs(){return[this._selection.chunks.length,this._polyComplexity]}_processItem(e,t,n,i,r){const o=this._geo;o.setItem(e,t,n,i),o.setColor(e,r,r)}}const ak=ok;class lk extends uE{_makeGeoArgs(){return[this._selection.chunks.length*2,this._polyComplexity]}_processItem(e,t,n,i,r){const o=this._geo;let a=e*2;o.setItem(a,t,i),o.setColor(a,r),a++,o.setItem(a,n,i),o.setColor(a,r)}}const ck=lk;var Qm=Ai(690);const{ResidueType:hk}=On,uk=yt.calcChunkMatrix;function VS(s,e){const t=(0,Qm.Smooth)(s,{method:Qm.Smooth.METHOD_CUBIC,clip:Qm.Smooth.CLIP_CLAMP,cubicTension:e,scaleTo:1});return function(n,i){let r=i;r===null&&(r=function(l){return(l*(s.length-1-2)+1)/(s.length-1)});const o=r(n),a=t(o);return new b.Vector3(a[0],a[1],a[2])}}function Ac(s,e,t,n){if(!n._isValid){s[t]=s[t-1],e[t]=e[t-1];return}const i=n._controlPoint;s[t]=[i.x,i.y,i.z];const r=i.clone().add(n._wingVector);e[t]=[r.x,r.y,r.z]}function dk(s,e,t,n){const i=(n._type.flags&hk.Flags.NUCLEIC)!==0,r=i?"C5'":"N",o=i?"C3'":"C";let a,l;if(n.forEachAtom(h=>{const u=h.getVisualName();!a&&u===r?a=h.position:!l&&u===o&&(l=h.position)}),a&&l||(a=n._firstAtom.position,l=n._lastAtom.position),a&&l){const h=l.clone().sub(a),u=n._wingVector,f=n._controlPoint,p=f.clone().add(u),m=f.clone().sub(h),g=m.clone().add(u);s[t]=[m.x,m.y,m.z],e[t]=[g.x,g.y,g.z],++t,s[t]=[m.x,m.y,m.z],e[t]=[g.x,g.y,g.z],++t,s[t]=[f.x,f.y,f.z],e[t]=[p.x,p.y,p.z],++t;const v=f.clone().add(h),y=v.clone().add(u);s[t]=[v.x,v.y,v.z],e[t]=[y.x,y.y,y.z],++t,s[t]=[v.x,v.y,v.z],e[t]=[y.x,y.y,y.z]}}function fk(s,e,t,n){const i=n.start,r=n.end;function o(g){return g>i&&s[g-1]._isValid?g-1:g}function a(g){return g<r&&s[g+1]._isValid?g+1:g}const l=[],h=[];let u=0;function f(g,v){const y=s[g]._controlPoint.clone().lerp(s[v]._controlPoint,-.25),x=y.clone().add(s[g]._wingVector);h[u]=[y.x,y.y,y.z],l[u++]=[x.x,x.y,x.z],h[u]=[y.x,y.y,y.z],l[u++]=[x.x,x.y,x.z]}const p=o(e),m=a(t);if(p===m)return dk(h,l,u,s[e]),{centerPoints:h,topPoints:l};e===p?f(e,a(e)):(Ac(h,l,u++,s[o(p)]),Ac(h,l,u++,s[p]));for(let g=e;g<=t;++g)Ac(h,l,u++,s[g]);return m===a(m)?f(t,o(t)):(Ac(h,l,u++,s[m]),Ac(h,l,u,s[a(m)])),{centerPoints:h,topPoints:l}}class pk{constructor(e,t,n,i,r,o){const a=fk(e,t,n,o);this._topInterp=VS(a.topPoints,r),this._centerInterp=VS(a.centerPoints,r),this._shift=.5/(n-t+2),this._valueStep=(1-2*this._shift)/(2*(n-t+1)*(i-1)),this._segmentsCount=i}prepareMatrices(e,t,n){const i=this._segmentsCount,r=new Array(i),o=new b.Vector2(0,0),a=this._topInterp,l=this._centerInterp;let h=this._shift+this._valueStep*(i-1)*e;for(let u=0;u<i;++u){const f=Math.min(1,u/(i-1));o.lerpVectors(t,n,f);const p=a(h,null),m=l(h,null);h+=this._valueStep;const g=l(h,null);r[u]=uk(m.clone(),g.clone(),p.clone().sub(m),o)}return r}}const mk=pk;function gk(s,e){const t=[];for(let n=0;n<e;++n){const i=Math.PI/2-2*Math.PI*n/e;t.push(new b.Vector3(Math.cos(i)*s,Math.sin(i)*s,0))}return t}function kS(s,e,t,n,i,r){for(let o=0,a=s.length;o<a;++o){const l=s[o].arr,{boundaries:h}=s[o];for(let u=0,f=l.length;u<f;++u){const p=[l[u].start,l[u].end],m=new mk(e,p[0],p[1],t,n,h);let g=null;const v=l[u].start*2,y=l[u].end*2+1;let x=i.getResidueRadius(e[0],0);for(let w=v;w<=y;++w){const S=w/2|0,E=e[S],A=i.getResidueRadius(E,w%2),C=i.getResidueRadius(E,1+w%2),P=m.prepareMatrices(w-p[0]*2,A,C);P.unshift(g===null?P[0]:g);const L=A.x!==C.x||A.y!==C.y,T=A.x!==x.x||A.y!==x.y;r(E,P,L,T),g=P[t],x=C}}}}class _k extends hE{_makeGeoArgs(){const e=this._mode.getHeightSegmentsRatio();return this._segmentsHeight=this._polyComplexity*e|0,[gk(1,this._polyComplexity),this._segmentsHeight+1,this._selection.chunks.length*2]}_build(){const{residues:e,parent:t}=this._selection,n=this._mode,i=this._colorer,r=n.getTension(),o=this._geo;let a=0;const l=[];kS(this._selection.subdivs,e,this._segmentsHeight,r,n,function(h,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const m=i.getResidueColor(h,t);l[a]=h._index,o.setItem(a,u,f,p),o.setColor(a++,m)}),this._chunksIdc=l,o.finalize()}updateToFrame(e){const{parent:t}=this._selection,n=this._mode,i=this._colorer,r=n.getTension(),o=this._geo,a=e.getResidues();let l=0;const h=e.needsColorUpdate(i);kS(this._selection.subdivs,a,this._segmentsHeight,r,n,(u,f)=>{o.setItem(l,f),h&&o.setColor(l,i.getResidueColor(u,t)),l++}),o.finalize()}}const xk=_k;class yk extends Of{_makeGeoArgs(){const e=this._selection.subdivs;let t=0;for(let n=0,i=e.length;n<i;++n){const r=e[n].arr;for(let o=0,a=r.length;o<a;++o)t+=r[o].end-r[o].start}return[t,this._polyComplexity]}_build(){const{residues:e,parent:t}=this._selection,n=this._mode,i=this._colorer,r=this._geo;let o=0;const a=[],l=this._selection.subdivs,h=n.calcStickRadius();for(let u=0,f=l.length;u<f;++u){const p=l[u].arr;for(let m=0,g=p.length;m<g;++m){const v=p[m].start,y=p[m].end;let x=e[v];for(let w=v+1;w<=y;++w){const S=e[w];a[o]={first:x._index,second:S._index},r.setItem(o,x._controlPoint,S._controlPoint,h),r.setColor(o,i.getResidueColor(x,t),i.getResidueColor(S,t)),o++,x=S}}}this._chunksIdc=a,r.finalize()}updateToFrame(e){const t=e.getResidues(),{parent:n}=this._selection,i=this._mode,r=this._colorer,o=this._geo;let a=0;const l=this._selection.subdivs,h=i.calcStickRadius(),u=e.needsColorUpdate(r);for(let f=0,p=l.length;f<p;++f){const m=l[f].arr;for(let g=0,v=m.length;g<v;++g){const y=m[g].start,x=m[g].end;let w=t[y];for(let S=y+1;S<=x;++S){const E=t[S];o.setItem(a,w._controlPoint,E._controlPoint,h),u&&o.setColor(a,r.getResidueColor(w,n),r.getResidueColor(E,n)),a++,w=E}}}o.finalize()}raycast(e,t){const n=[],{residues:i}=this._selection;this._mesh.raycast(e,n);const r=this._chunksIdc;for(let o=0,a=n.length;o<a;++o){if(!n[o].hasOwnProperty("chunkIdx"))continue;const{chunkIdx:l}=n[o],h=r[Math.floor(l/2)],u=l%2===0?h.first:h.second;u<i.length&&(n[o].residue=i[u],t.push(n[o]))}}_calcChunksList(e){const t=[],n=this._chunksIdc,{residues:i}=this._selection;for(let r=0,o=n.length;r<o;++r){const a=n[r];i[a.first]._mask&e&&t.push(r*2),i[a.second]._mask&e&&t.push(r*2+1)}return t}}const vk=yk;function Sk(s){return s<2?1:s}class bk extends Of{_makeGeoArgs(){const e=this._mode.drawMultiorderBonds(),t=this._mode.showAromaticLoops(),n=this._selection.chunks,{bonds:i}=this._selection;let r=0;for(let o=0,a=n.length;o<a;++o)r+=this.getBondOrder(i[n[o]],e,t);return[r,this._polyComplexity]}getBondOrder(e,t,n){let i=1;return t&&(!n||e._type!==Eh.BondType.AROMATIC)&&(i=Sk(e._order)),i}raycast(e,t){const{bonds:n}=this._selection,i=[];this._mesh.raycast(e,i);const r=this._chunksIdc;for(let o=0,a=i.length;o<a;++o){if(!i[o].hasOwnProperty("chunkIdx"))continue;const{chunkIdx:l}=i[o],h=r[Math.floor(l/2)];if(h<n.length){const u=n[h];i[o].atom=l%2===0?u._left:u._right,t.push(i[o])}}}_calcChunksList(e,t){const n=[],{bonds:i}=this._selection,r=this._chunksIdc;for(let o=0,a=r.length;o<a;++o){const l=i[r[o]];l._left.mask&e&&(!t||l._right.mask&e)&&n.push(2*o),l._right.mask&e&&(!t||l._left.mask&e)&&n.push(2*o+1)}return n}}const dE=bk;class wk extends dE{_build(){const e=this._selection.chunks,{bonds:t,parent:n}=this._selection,i=this._mode,r=this._colorer,o=this._geo,a=i.drawMultiorderBonds(),l=i.showAromaticLoops(),h=i.calcStickRadius(),u=i.calcSpaceFraction();let f;const p=new b.Vector3,m=new b.Vector3;let g=0;const v=[];for(let y=0,x=e.length;y<x;++y){const w=t[e[y]],S=w._left,E=w._right,A=S.position,C=E.position;f=w.calcNormalDir();const P=this.getBondOrder(w,a,l),T=2*Math.min(i.calcAtomRadius(S),i.calcAtomRadius(E))/P,R=a?Math.min(h,T*.5*(1-u)):h;for(let G=0;G<P;++G){const K=T*(P%2===0?((G/2|0)+.5)*(1-2*(G%2)):((G+1)/2|0)*(-1+2*(G%2)));v[g]=w._index,p.copy(A),p.addScaledVector(f,K),m.copy(C),m.addScaledVector(f,K),o.setItem(g,p,m,R),o.setColor(g++,r.getAtomColor(S,n),r.getAtomColor(E,n))}}o.finalize(),this._chunksIdc=v}updateToFrame(e){const t=this._selection.chunks,{bonds:n}=this._selection,i=this._mode,r=this._colorer,o=this._geo,a=i.drawMultiorderBonds(),l=i.showAromaticLoops(),h=i.calcStickRadius(),u=i.calcSpaceFraction();let f;const p=new b.Vector3,m=new b.Vector3;let g=0;const v=e.needsColorUpdate(r);for(let y=0,x=t.length;y<x;++y){const w=n[t[y]],S=w._left,E=w._right,A=e.getAtomPos(S.index).clone(),C=e.getAtomPos(E.index);f=w.calcNormalDir();const P=this.getBondOrder(w,a,l),T=2*Math.min(i.calcAtomRadius(S),i.calcAtomRadius(E))/P,R=a?Math.min(h,T*.5*(1-u)):h;for(let G=0;G<P;++G){const K=T*(P%2===0?((G/2|0)+.5)*(1-2*(G%2)):((G+1)/2|0)*(-1+2*(G%2)));p.copy(A),p.addScaledVector(f,K),m.copy(C),m.addScaledVector(f,K),o.setItem(g,p,m,R),v&&o.setColor(g,e.getAtomColor(r,S),e.getAtomColor(r,E)),g++}}o.finalize()}}const Mk=wk,rl=.15;class Ek extends dE{_build(){const e=this._selection.chunks,{bonds:t,parent:n}=this._selection,i=this._mode,r=this._colorer,o=this._geo,a=i.drawMultiorderBonds(),l=i.showAromaticLoops(),h=new b.Vector3,u=new b.Vector3,f=new b.Vector3;let p=0;const m=[];for(let g=0,v=e.length;g<v;++g){const y=t[e[g]],x=y._left,w=y._right,S=x.position,E=w.position,A=x.bonds.length===1,C=w.bonds.length===1;h.subVectors(E,S);const P=h.length(),L=y.calcNormalDir(),T=this.getBondOrder(y,a,l);for(let R=0;R<T;++R){u.copy(S),f.copy(E);let G=T%2===0?((R/2|0)+.5)*(1-2*(R%2)):((R+1)/2|0)*(-1+2*(R%2));m[p]=y._index,T===2&&!A&&!C&&(G-=.5,G*=-1),!A&&!C&&T>1&&G!==0&&(u.lerpVectors(S,E,rl/P),f.lerpVectors(S,E,1-rl/P)),G*=rl,u.addScaledVector(L,G),f.addScaledVector(L,G),o.setItem(p,u,f),o.setColor(p++,r.getAtomColor(x,n),r.getAtomColor(w,n))}}o.finalize(),this._chunksIdc=m}updateToFrame(e){const t=this._selection.chunks,{bonds:n}=this._selection,i=this._mode,r=this._colorer,o=this._geo,a=i.drawMultiorderBonds(),l=i.showAromaticLoops(),h=new b.Vector3,u=new b.Vector3,f=new b.Vector3;let p=0;const m=e.needsColorUpdate(r);for(let g=0,v=t.length;g<v;++g){const y=n[t[g]],x=y._left,w=y._right,S=e.getAtomPos(x.index).clone(),E=e.getAtomPos(w.index),A=x.bonds.length===1,C=w.bonds.length===1;h.subVectors(E,S);const P=h.length(),L=y.calcNormalDir(),T=this.getBondOrder(y,a,l);for(let R=0;R<T;++R){u.copy(S),f.copy(E);let G=T%2===0?((R/2|0)+.5)*(1-2*(R%2)):((R+1)/2|0)*(-1+2*(R%2));T===2&&!A&&!C&&(G-=.5,G*=-1),!A&&!C&&T>1&&G!==0&&(u.lerpVectors(S,E,rl/P),f.lerpVectors(S,E,1-rl/P)),G*=rl,u.addScaledVector(L,G),f.addScaledVector(L,G),o.setItem(p,u,f),m&&o.setColor(p,e.getAtomColor(r,x),e.getAtomColor(r,w)),p++}}o.finalize()}}const Ak=Ek,Si={AtomsSphereGroup:P_,AtomsSurfaceGroup:WV,AtomsSASSESGroupStub:YV,AtomsTextGroup:ZV,AromaticTorusGroup:tk,AromaticLinesGroup:ik,NucleicCylindersGroup:ak,NucleicSpheresGroup:ck,ResiduesSubseqGroup:xk,ResiduesTraceGroup:vk,BondsCylinderGroup:Mk,BondsLinesGroup:Ak};class Tk extends oa{constructor(e,t,n,i,r,o,a,l){super();const h=this;this._complex=n,this._mode=r;const u=n.getAtoms(),f=n.getTransforms();n.forEachComponent(p=>{const m=[];let g=0;if(p.forEachAtom(y=>{h._checkAtom(y,a)&&(m[g++]=y.index)}),g===0)return;const v=new e(t,{atoms:u,chunks:m,parent:n},i,r,f,o,l);v._component=p,h.add(v)})}_checkAtom(e,t){return e.mask&t}getSubset(e,t){const n=[],{children:i}=this;let r=0;for(let o=0,a=i.length;o<a;++o)if(i[o].getSubset){const l=i[o].getSubset(e,t);for(let h=0,u=l.length;h<u;++h){const f=l[h];f._component=i[o]._component,n[r++]=f}}return n}}const fE=Tk;class Ck extends fE{_checkAtom(e,t){if(!(e.mask&t))return!1;const{bonds:n}=e;for(let i=0,r=n.length;i<r;++i)if(n[i]._left.mask&t&&n[i]._right.mask&t)return!1;return!0}}const Rk=Ck;class Pk extends oa{constructor(e,t,n,i,r,o,a,l){super();const h=this;this._complex=n;const u=n.getResidues(),f=n.getTransforms();n.forEachComponent(p=>{let m=0;const g=[];if(p.forEachResidue(y=>{h._checkResidue(y,a)&&(g[m++]=y._index)}),m===0)return;const v=new e(t,{residues:u,chunks:g,parent:n},i,r,f,o,l);v._component=p,h.add(v)})}checkResidue(e,t){return e._mask&t}getSubset(e,t){const n=[],{children:i}=this;let r=0;for(let o=0,a=i.length;o<a;++o)if(i[o].getSubset){const l=i[o].getSubset(e,t);for(let h=0,u=l.length;h<u;++h){const f=l[h];f._component=i[o]._component,n[r++]=f}}return n}}const pE=Pk;class Ik extends pE{_checkResidue(e,t){return t&e._mask&&e._cylinders!==null}}const Lk=Ik;class Nk extends oa{constructor(e,t,n,i,r,o,a,l){super();const h=this;this._complex=n;const u=n.getResidues(),f=n.getTransforms();n.forEachComponent(p=>{const m=p.getMaskedSubdivSequences(a);let g=0;const v=[];for(let x=0,w=m.length;x<w;++x){const S=m[x].arr;for(let E=0,A=S.length;E<A;++E)for(let C=S[E].start,P=S[E].end;C<=P;++C)v[g++]=u[C]._index}if(g===0)return;const y=new e(t,{residues:u,chunks:v,subdivs:m,parent:n},i,r,f,o,l);y._component=p,h.add(y)})}getSubset(e,t){const n=[],{children:i}=this;let r=0;for(let o=0,a=i.length;o<a;++o)if(i[o].getSubset){const l=i[o].getSubset(e,t);for(let h=0,u=l.length;h<u;++h){const f=l[h];f._component=i[o]._component,n[r++]=f}}return n}}const Fk=Nk;class Ok extends oa{constructor(e,t,n,i,r,o,a,l){super();const h=this;this._complex=n;const u=n.getBonds(),f=n.getTransforms();n.forEachComponent(p=>{const m=[];let g=0;if(p.forEachBond(y=>{const x=y._left,w=y._right;!(x.mask&a)||!(w.mask&a)||(m[g++]=y._index)}),g===0)return;const v=new e(t,{bonds:u,chunks:m,parent:n},i,r,f,o,l);v._component=p,h.add(v)})}getSubset(e,t){const n=[],{children:i}=this;let r=0;for(let o=0,a=i.length;o<a;++o)if(i[o].getSubset){const l=i[o].getSubset(e,t);for(let h=0,u=l.length;h<u;++h){const f=l[h];f._component=i[o]._component,n[r++]=f}}return n}}const Dk=Ok;class Uk extends oa{constructor(e,t,n,i,r,o,a,l){super();const h=this;this._complex=n;const u=n.getAtoms(),f=n.getTransforms();r.showAromaticLoops()&&n.forEachComponent(p=>{const m=[];let g=0;const v=[];let y=0;p.forEachCycle(w=>{const S=w.atoms;let E=0;for(let A=0,C=S.length;A<C;++A)S[A].mask&a&&(++E,m[g++]=S[A].index);E>0&&(v[y++]=w)});const x=new e(t,{cycles:v,atoms:u,chunks:m,parent:n},i,r,f,o,l);x._component=p,h.add(x)})}getSubset(e,t){const n=[],{children:i}=this;let r=0;for(let o=0,a=i.length;o<a;++o)if(i[o].getSubset){const l=i[o].getSubset(e,t);for(let h=0,u=l.length;h<u;++h){const f=l[h];f._component=i[o]._component,n[r++]=f}}return n}}const Bk=Uk,bi={Atoms:fE,OrphanAtoms:Rk,Residues:pE,Nucleic:Lk,Subseqs:Fk,Bonds:Dk,Aromatic:Bk};function wi(s,e,t){return function(n,i,r,o,a,l){return new e(t,s,n,i,r,o,a,l)}}class zk{static AtomsSpheres(e,t){const n=vi.createSpheres(e,t);return wi(n,bi.Atoms,Si.AtomsSphereGroup)}static OrphanedAtomsCrosses(e,t,n){const i=vi.createCrosses(e,t,n);return wi(i,bi.OrphanAtoms,Si.AtomsSphereGroup)}static BondsCylinders(e,t){const n=vi.create2CCylinders(e,t);return wi(n,bi.Bonds,Si.BondsCylinderGroup)}static BondsLines(e,t,n){const i=vi.create2CLines(e,t,n);return wi(i,bi.Bonds,Si.BondsLinesGroup)}static CartoonChains(e,t){const n=vi.createExtrudedChains(e,t);return wi(n,bi.Subseqs,Si.ResiduesSubseqGroup)}static TraceChains(e,t){const n=vi.create2CClosedCylinders(e,t);return wi(n,bi.Subseqs,Si.ResiduesTraceGroup)}static NucleicSpheres(e,t){const n=vi.createSpheres(e,t);return wi(n,bi.Nucleic,Si.NucleicSpheresGroup)}static NucleicCylinders(e,t){const n=vi.create2CCylinders(e,t);return wi(n,bi.Nucleic,Si.NucleicCylindersGroup)}static ALoopsTorus(e,t){const n=vi.createExtrudedChains(e,t);return wi(n,bi.Aromatic,Si.AromaticTorusGroup)}static ALoopsLines(e,t,n){const i=vi.createChunkedLines(e,t,n);return wi(i,bi.Aromatic,Si.AromaticLinesGroup)}static QuickSurfGeo(e,t,n){const i=vi.createQuickSurface(e,t,n);return wi(i,bi.Atoms,Si.AtomsSurfaceGroup)}static ContactSurfaceGeo(e,t,n){const i=vi.createContactSurface(e,t,n);return wi(i,bi.Atoms,Si.AtomsSurfaceGroup)}static SASSESSurfaceGeo(e,t,n){const i=vi.createSASSES(e,t,n);return wi(i,bi.Atoms,Si.AtomsSASSESGroupStub)}static TextLabelsGeo(e,t){const n=vi.createLabels(e,t);return wi(n,bi.Atoms,Si.AtomsTextGroup)}}const Vk=zk;class Fl{constructor(e){if(this.constructor===Fl)throw new Error("Can not instantiate abstract class!");this.opts=Me.default.merge(Oe.deriveDeep(this.settings.now.modes[this.id],!0),e)}identify(){const e=Oe.objectsDiff(this.opts,this.settings.now.modes[this.id]);return Me.default.isEmpty(e)?this.id:[this.id,e]}buildGeometry(e,t,n,i){const r=this.opts.polyComplexity?this.opts.polyComplexity[this.settings.now.resolution]:0,o=this.depGroups,a=o.length,l=new yt.RCGroup,h=this;for(let u=0;u<a;++u){let f=o[u],p={};Me.default.isArray(f)&&(p=f[1].call(this),[f]=f);const m=Vk[f](null,this.settings,p),g=new m(e,t,h,r,n,i);g.children.length>0&&l.add(g)}return l}}Ah(Fl.prototype);Fl.prototype.id="__";Fl.prototype.depGroups=[];const br=Fl;function kk(){return{lineWidth:this.opts.lineWidth}}class Ol extends br{constructor(e){super(e),this.depGroups=this.depGroups.slice(0);const t=this.depGroups;for(let n=0,i=t.length;n<i;++n)t[n]=[t[n],kk]}drawMultiorderBonds(){return this.opts.multibond}calcAtomRadius(){return this.opts.atom}getAromaticOffset(){return this.opts.offsarom}getAromaticArcChunks(){return this.opts.chunkarom}showAromaticLoops(){return this.opts.showarom}}lt(Ol,"id","LN");Ol.prototype.id="LN";Ol.prototype.name="Lines";Ol.prototype.shortName="Lines";Ol.prototype.depGroups=["ALoopsLines","BondsLines","OrphanedAtomsCrosses"];const Gk=Ol;class Dl extends br{calcAtomRadius(e){return this.opts.bond}calcStickRadius(){return this.opts.bond}calcSpaceFraction(){return this.opts.space}getAromRadius(){return this.opts.aromrad}showAromaticLoops(){return this.opts.showarom}drawMultiorderBonds(){return this.opts.multibond}}lt(Dl,"id","LC");Dl.prototype.id="LC";Dl.prototype.name="Licorice";Dl.prototype.shortName="Licorice";Dl.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];const Hk=Dl;class Ul extends br{calcAtomRadius(e){return e.element.radius*this.opts.atom}calcStickRadius(){return this.opts.bond}getAromRadius(){return this.opts.aromrad}showAromaticLoops(){return this.opts.showarom}calcSpaceFraction(){return this.opts.space}drawMultiorderBonds(){return this.opts.multibond}}lt(Ul,"id","BS");Ul.prototype.id="BS";Ul.prototype.name="Balls and Sticks";Ul.prototype.shortName="Balls";Ul.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];const Wk=Ul;class Bl extends br{calcAtomRadius(e){return e.element.radius}}lt(Bl,"id","VW");Bl.prototype.id="VW";Bl.prototype.name="Van der Waals";Bl.prototype.shortName="VDW";Bl.prototype.depGroups=["AtomsSpheres"];const Xk=Bl;class zl extends br{calcStickRadius(){return this.opts.radius}}lt(zl,"id","TR");zl.prototype.id="TR";zl.prototype.name="Trace";zl.prototype.shortName="Trace";zl.prototype.depGroups=["TraceChains"];const Yk=zl;class Vl extends br{getResidueRadius(e){return this.TUBE_RADIUS}getHeightSegmentsRatio(){return this.opts.heightSegmentsRatio}getTension(){return this.opts.tension}buildGeometry(e,t,n,i){const r=this.opts.radius;return this.TUBE_RADIUS=new b.Vector2(r,r),br.prototype.buildGeometry.call(this,e,t,n,i)}}lt(Vl,"id","TU");Vl.prototype.id="TU";Vl.prototype.name="Tube";Vl.prototype.shortName="Tube";Vl.prototype.depGroups=["CartoonChains"];const jk=Vl;class kl extends br{constructor(e){super(e),this.secCache={}}getResidueStartRadius(e){const t=e.getSecondary();if(!t||!t.generic)return this.TUBE_RADIUS;const n=this.secCache[t.generic];return n?t.term===e?n.start:n.center:this.TUBE_RADIUS}getResidueEndRadius(e){const t=e.getSecondary();if(t===null||!t.generic)return this.TUBE_RADIUS;const n=this.secCache[t.generic];return n?t.term===e?this.ARROW_END:n.center:this.TUBE_RADIUS}getResidueRadius(e,t){const n=this.getResidueStartRadius(e);if(t===0)return n;const i=this.getResidueEndRadius(e);return t===2?i:n.clone().lerp(i,t/2)}calcStickRadius(e){return this.opts.radius}getHeightSegmentsRatio(){return this.opts.heightSegmentsRatio}getTension(){return this.opts.tension}buildGeometry(e,t,n,i){const r=this.opts.radius,o=this.opts.depth;this.TUBE_RADIUS=new b.Vector2(r,r),this.ARROW_END=new b.Vector2(o,r);const a={},l=this.opts.ss;for(const h in l)a[h]={center:new b.Vector2(o,l[h].width),start:new b.Vector2(o,l[h].arrow)};return this.secCache=a,br.prototype.buildGeometry.call(this,e,t,n,i)}}lt(kl,"id","CA");kl.prototype.id="CA";kl.prototype.name="Cartoon";kl.prototype.shortName="Cartoon";kl.prototype.depGroups=["CartoonChains","NucleicSpheres","NucleicCylinders"];const qk=kl,{selectors:$k}=On;function Zk(){return{wireframe:this.opts.wireframe,zClip:this.opts.zClip}}class I_ extends br{constructor(e){super(e),this.depGroups=this.depGroups.slice(0);const t=this.surfaceNames,n=this.depGroups;for(let i=0,r=t.length;i<r;++i)n[n.length]=[t[i],Zk]}calcAtomRadius(e){return e.element.radius}getVisibilitySelector(){let e=null;if(this.opts.subset!==""){const t=$k.parse(this.opts.subset);t.error||(e=t.selector)}return e}}I_.prototype.isSurface=!0;I_.prototype.surfaceNames=[];const L_=I_;class Gl extends L_{getSurfaceOpts(){return{useBeads:!1,isoValue:this.opts.isoValue,gaussLim:this.opts.gaussLim[this.settings.now.resolution],radScale:this.opts.scale,gridSpacing:this.opts.gridSpacing[this.settings.now.resolution],zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}lt(Gl,"id","QS");Gl.prototype.id="QS";Gl.prototype.name="Quick Surface";Gl.prototype.shortName="Quick Surf";Gl.prototype.surfaceNames=["QuickSurfGeo"];const Kk=Gl;class la extends L_{constructor(e,t){super(t),this._excludeProbe=e}calcAtomRadius(e){return e.element.radius}getSurfaceOpts(){return{gridSpacing:this.opts.polyComplexity[this.settings.now.resolution],radScale:this._radScale,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector(),probeRadius:this.opts.probeRadius,excludeProbe:this._excludeProbe}}}la.prototype.id="SU";la.prototype.name="Surface";la.prototype.shortName="Surface";la.prototype.surfaceNames=["SASSESSurfaceGeo"];la.prototype._radScale=1;la.prototype._excludeProbe=!1;const mE=la;class Ch extends mE{constructor(e){super(!1,e)}}lt(Ch,"id","SA");Ch.prototype.id="SA";Ch.prototype.name="Solvent Accessible Surface";Ch.prototype.shortName="SAS";const Jk=Ch;class Rh extends mE{constructor(e){super(!0,e)}}lt(Rh,"id","SE");Rh.prototype.id="SE";Rh.prototype.name="Solvent Excluded Surface";Rh.prototype.shortName="SES";const Qk=Rh;class ca extends L_{getSurfaceOpts(){return{probeRadius:this.opts.probeRadius,radScale:this.opts.polyComplexity[this.settings.now.resolution],scaleFactor:this.opts.polyComplexity[this.settings.now.resolution],gridSpacing:1/this.opts.polyComplexity[this.settings.now.resolution],isoValue:this.opts.isoValue,probePositions:this.opts.probePositions,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}lt(ca,"id","CS");ca.prototype.id="CS";ca.prototype.name="Contact Surface";ca.prototype.shortName="Contact Surf";ca.prototype.isSurface=!0;ca.prototype.surfaceNames=["ContactSurfaceGeo"];const e6=ca;class Hl extends br{getTemplateOptions(){return this.opts.template}getLabelOpts(){return Me.default.merge(this.opts,{colors:!0,adjustColor:!0,transparent:!0})}}lt(Hl,"id","TX");Hl.prototype.id="TX";Hl.prototype.name="Text mode";Hl.prototype.shortName="Text";Hl.prototype.depGroups=["TextLabelsGeo"];const t6=Hl,n6=new aa([Gk,Hk,Wk,Xk,Yk,jk,qk,Kk,Jk,Qk,e6,t6]),Yd=n6;function GS(s,e,t){return s<=t?s<0?0:s:t}function i6(s,e,t){const n=1-t,i=s>>16&255,r=s>>8&255,o=s&255,a=e>>16&255,l=e>>8&255,h=e&255,u=n*i+t*a,f=n*r+t*l,p=n*o+t*h;return u<<16|f<<8|p}class N_{constructor(e,t){this.name=e||"Custom",this.id=t||"CP"}getElementColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const n=this.elementColors[e];return n===void 0&&!t?this.defaultElementColor:n}getResidueColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const n=this.residueColors[e];return n===void 0&&!t?this.defaultResidueColor:n}getChainColor(e){let t=e.charCodeAt(0);return t=((t<0?0:t>=256?t-256:t)&31)%this.chainColors.length,this.chainColors[t]}getSecondaryColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const n=this.secondaryColors[e];return n===void 0&&!t?this.defaultSecondaryColor:n}getSequentialColor(e){const{colors:t}=this,n=t.length;return e<0?t[e%n+n]:t[e%n]}getGradientColor(e,t){const n=this.gradients[t];if(!n)return this.defaultNamedColor;const i=n.length,r=e*(i-1);let o=Math.floor(r);const a=GS(o+1,0,i-1);return o=GS(o,0,i-1),i6(n[o],n[a],r-o)}getNamedColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const n=this.namedColors[e];return n===void 0&&!t?this.defaultNamedColor:n}}Me.default.assign(N_.prototype,{colors:[16777215,16711680,65280,255,8421504],minRangeColor:0,midRangeColor:8355711,maxRangeColor:16777215,defaultElementColor:16777215,elementColors:{},defaultResidueColor:16777215,residueColors:{},chainColors:[16777215],defaultSecondaryColor:16777215,secondaryColors:{},defaultGradientColor:0,defaultNamedColor:16777215,namedColorsArray:[["indianred",13458524],["lightcoral",15761536],["salmon",16416882],["darksalmon",15308410],["lightsalmon",16752762],["crimson",14423100],["red",16711680],["firebrick",11674146],["darkred",9109504],["pink",16761035],["lightpink",16758465],["hotpink",16738740],["deeppink",16716947],["mediumvioletred",13047173],["palevioletred",14381203],["coral",16744272],["tomato",16737095],["orangered",16729344],["darkorange",16747520],["orange",16753920],["gold",16766720],["yellow",16776960],["lightyellow",16777184],["lemonchiffon",16775885],["lightgoldenrodyellow",16448210],["papayawhip",16773077],["moccasin",16770229],["peachpuff",16767673],["palegoldenrod",15657130],["khaki",15787660],["darkkhaki",12433259],["lavender",15132410],["thistle",14204888],["plum",14524637],["violet",15631086],["orchid",14315734],["fuchsia",16711935],["magenta",16711935],["mediumorchid",12211667],["mediumpurple",9662683],["rebeccapurple",6697881],["blueviolet",9055202],["darkviolet",9699539],["darkorchid",10040012],["darkmagenta",9109643],["purple",8388736],["indigo",4915330],["slateblue",6970061],["mediumslateblue",8087790],["darkslateblue",4734347],["greenyellow",11403055],["chartreuse",8388352],["lawngreen",8190976],["lime",65280],["limegreen",3329330],["palegreen",10025880],["lightgreen",9498256],["mediumspringgreen",64154],["springgreen",65407],["mediumseagreen",3978097],["seagreen",3050327],["forestgreen",2263842],["green",32768],["darkgreen",25600],["yellowgreen",10145074],["olivedrab",7048739],["olive",8421376],["darkolivegreen",5597999],["mediumaquamarine",6737322],["darkseagreen",9419919],["lightseagreen",2142890],["darkcyan",35723],["teal",32896],["aqua",65535],["cyan",65535],["lightcyan",14745599],["paleturquoise",11529966],["aquamarine",8388564],["turquoise",4251856],["mediumturquoise",4772300],["darkturquoise",52945],["cadetblue",6266528],["steelblue",4620980],["lightsteelblue",11584734],["powderblue",11591910],["lightblue",11393254],["skyblue",8900331],["lightskyblue",8900346],["deepskyblue",49151],["dodgerblue",2003199],["cornflowerblue",6591981],["royalblue",4286945],["blue",255],["mediumblue",205],["darkblue",139],["navy",128],["midnightblue",1644912],["cornsilk",16775388],["blanchedalmond",16772045],["bisque",16770244],["navajowhite",16768685],["wheat",16113331],["burlywood",14596231],["tan",13808780],["rosybrown",12357519],["sandybrown",16032864],["goldenrod",14329120],["darkgoldenrod",12092939],["peru",13468991],["chocolate",13789470],["saddlebrown",9127187],["sienna",10506797],["brown",10824234],["maroon",8388608],["white",16777215],["snow",16775930],["honeydew",15794160],["mintcream",16121850],["azure",15794175],["aliceblue",15792383],["ghostwhite",16316671],["whitesmoke",16119285],["seashell",16774638],["beige",16119260],["oldlace",16643558],["floralwhite",16775920],["ivory",16777200],["antiquewhite",16444375],["linen",16445670],["lavenderblush",16773365],["mistyrose",16770273],["gainsboro",14474460],["lightgray",13882323],["silver",12632256],["darkgray",11119017],["gray",8421504],["dimgray",6908265],["lightslategray",7833753],["slategray",7372944],["darkslategray",3100495],["black",0]],namedColors:{},gradients:{rainbow:[255,65535,65280,16776960,16711680],temp:[255,32767,16777215,16744192,16711680],hot:[16777215,16744192,16711680],cold:[16777215,32767,255],"blue-red":[255,16777215,16711680],reds:[16777215,16711680],blues:[16777215,255]}});const{namedColorsArray:HS,namedColors:r6}=N_.prototype;for(let s=0,{length:e}=HS;s<e;++s){const[t,n]=HS[s];r6[t]=n}const F_=N_,gE=new F_("CPK","CP");gE.elementColors={H:16777215,C:2105376,N:2121983,O:15605776,F:65280,P:8397055,S:16776960,CL:47872,FE:13684944,CO:13684944,NI:13684944,CU:13684944,BR:34816,I:21760};const s6=gE,ha=new F_("Jmol","JM");ha.colors=[255,22015,44031,65535,65451,65365,65280,5635840,11271936,16776960,16755456,16733440,16711680,16711765,16711851,16711935,11206911,5570815];ha.elementColors={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:4366e3,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998};ha.defaultResidueColor=12492910;ha.residueColors={ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,A:10526975,C:16747595,G:16740464,I:8454143,T:10551200,U:16744576,DA:10526975,DC:16747595,DG:16740464,DI:8454143,DT:10551200,DU:16744576,"+A":10526975,"+C":16747595,"+G":16740464,"+I":8454143,"+T":10551200,"+U":16744576};ha.chainColors=[4294967295,4290826495,4289789872,4294951112,4294967168,4294951167,4289786096,4294955120,4293951616,4294303411,4278239231,4291648604,4284927402,4288335154,4293821166,4278243025,4278255487,4282168177,4278190219,4290623339,4278215680,4286578688,4286611456,4286578816,4278222976,4290283019,4289864226];const Tc=Hi.Type;ha.secondaryColors={[Tc.HELIX_ALPHA]:16711808,[Tc.HELIX_PI]:6291584,[Tc.HELIX_310]:10485888,[Tc.STRAND]:16762880,[Tc.TURN]:6324479,dna:11403518,rna:16580962};const o6=ha,Ss=new F_("VMD","VM");Ss.colors=[255,16711680,6316128,16744448,16776960,8421427,10066329,65280,16777215,16751001,4243648,10879142,8447590,15099571,8408320,8421568];Ss.defaultElementColor=8408320;Ss.elementColors={H:16777215,C:4243391,N:255,O:16711680,P:8421427,S:16776960};Ss.defaultResidueColor=4243648;Ss.residueColors={ALA:255,ARG:16777215,ASN:8421427,ASP:16711680,CYS:16776960,GLN:16744448,GLU:16751001,GLY:16777215,HIS:4243648,ILE:65280,LEU:16751001,LYS:4243648,MET:16776960,PHE:10879142,PRO:8408064,SER:16776960,THR:15099571,TRP:10066329,TYR:65280,VAL:8421427,A:255,C:16744448,G:16776960,T:10879142,U:65280,DA:255,DC:16744448,DG:16776960,DT:10879142,DU:65280,"+A":255,"+C":16744448,"+G":16776960,"+T":10879142,"+U":65280,WAT:4243648,H2O:4243648,HOH:4243648};Ss.chainColors=[16777215].concat(Ss.colors);const sl=Hi.Type;Ss.secondaryColors={[sl.HELIX_ALPHA]:10879142,[sl.HELIX_310]:255,[sl.HELIX_PI]:16711680,[sl.STRAND]:16776960,[sl.BRIDGE]:8421427,[sl.TURN]:4243648};const a6=Ss,l6=new aa([s6,o6,a6]),El=l6;class Df{constructor(e){if(this.constructor===Df)throw new Error("Can not instantiate abstract class!");this.opts=Me.default.merge(Oe.deriveDeep(pe.now.colorers[this.id],!0),e),this.palette=El.first}identify(){const e=Oe.objectsDiff(this.opts,pe.now.colorers[this.id]);return Me.default.isEmpty(e)?this.id:[this.id,e]}}Df.prototype.id="__";const ji=Df;class Ph extends ji{getAtomColor(e,t){const n=e.element.name;return n==="C"&&this.opts.carbon>=0?this.opts.carbon:this.palette.getElementColor(n)}getResidueColor(e,t){return this.palette.defaultResidueColor}}lt(Ph,"id","EL");Ph.prototype.id="EL";Ph.prototype.name="Element";Ph.prototype.shortName="Element";const c6=Ph;class Ih extends ji{getAtomColor(e,t){return this.getResidueColor(e.residue,t)}getResidueColor(e,t){return this.palette.getResidueColor(e._type._name)}}lt(Ih,"id","RT");Ih.prototype.id="RT";Ih.prototype.name="Residue Type";Ih.prototype.shortName="Residue";const h6=Ih;class Lh extends ji{getAtomColor(e,t){return this.getResidueColor(e.residue,t)}getResidueColor(e,t){const n=e._chain;if(n.minSequence===Number.POSITIVE_INFINITY&&n.maxSequence===Number.NEGATIVE_INFINITY)return this.palette.defaultNamedColor;const i=n.minSequence,r=n.maxSequence>i?n.maxSequence:i+1;return this.palette.getGradientColor((e._sequence-i)/(r-i),this.opts.gradient)}}lt(Lh,"id","SQ");Lh.prototype.id="SQ";Lh.prototype.name="Sequence";Lh.prototype.shortName="Sequence";const u6=Lh;class Nh extends ji{getAtomColor(e,t){return this.getResidueColor(e.residue,t)}getResidueColor(e,t){return this.palette.getChainColor(e.getChain()._name)}}lt(Nh,"id","CH");Nh.prototype.id="CH";Nh.prototype.name="Chain";Nh.prototype.shortName="Chain";const d6=Nh;class Fh extends ji{getAtomColor(e,t){return this.getResidueColor(e.residue,t)}getResidueColor(e,t){if(e._type.flags&Jt.Flags.DNA)return this.palette.getSecondaryColor("dna");if(e._type.flags&Jt.Flags.RNA)return this.palette.getSecondaryColor("rna");const n=e.getSecondary();if(n){let i=this.palette.getSecondaryColor(n.type,!0);return i===void 0&&(i=this.palette.getSecondaryColor(n.generic)),i}return this.palette.defaultSecondaryColor}}lt(Fh,"id","SS");Fh.prototype.id="SS";Fh.prototype.name="Secondary Structure";Fh.prototype.shortName="Structure";const _E=Fh;class Oh extends ji{getAtomColor(e,t){return this.opts.color}getResidueColor(e,t){return this.opts.color}}lt(Oh,"id","UN");Oh.prototype.id="UN";Oh.prototype.name="Uniform";Oh.prototype.shortName="Uniform";const f6=Oh;class Dh extends ji{constructor(e){super(e);const t=ea.parse(this.opts.subset);this._subsetCached=t.error?ea.none():t.selector}getAtomColor(e,t){return this._subsetCached.includesAtom(e)?this.opts.color:this.opts.baseColor}getResidueColor(e,t){const n=this._subsetCached,i=e._atoms;for(let r=0,o=i.length;r<o;++r)if(!n.includesAtom(i[r]))return this.opts.baseColor;return this.opts.color}}lt(Dh,"id","CO");Dh.prototype.id="CO";Dh.prototype.name="Conditional";Dh.prototype.shortName="Conditional";const p6=Dh;class Uh extends ji{getAtomColor(e,t){return this.palette.getChainColor(String.fromCharCode(e.location))}getResidueColor(e,t){return this.palette.defaultResidueColor}}lt(Uh,"id","CF");Uh.prototype.id="CF";Uh.prototype.name="Conformation";Uh.prototype.shortName="Conformation";const m6=Uh;class Bh extends ji{getAtomColor(e,t){const{opts:n}=this;let i=1;return e.temperature&&n?(n.min===n.max?i=e.temperature>n.max?1:0:i=(e.temperature-n.min)/(n.max-n.min),this.palette.getGradientColor(i,n.gradient)):this.palette.defaultGradientColor}getResidueColor(e,t){const{opts:n}=this;if(!n)return this.palette.defaultGradientColor;if(e.temperature){let i=0;return n.min===n.max?i=e.temperature>n.max?1:0:i=(e.temperature-n.min)/(n.max-n.min),this.palette.getGradientColor(i,n.gradient)}return this.palette.defaultGradientColor}}lt(Bh,"id","TM");Bh.prototype.id="TM";Bh.prototype.name="Temperature";Bh.prototype.shortName="Temperature";const g6=Bh;class zh extends ji{_getColorByOccupancy(e,t){if(e!==void 0){const n=1-e;return this.palette.getGradientColor(n,t.gradient)}return this.palette.defaultGradientColor}getAtomColor(e,t){const{opts:n}=this;return this._getColorByOccupancy(e.occupancy,n)}getResidueColor(e,t){const{opts:n}=this;return this._getColorByOccupancy(e.occupancy,n)}}lt(zh,"id","OC");zh.prototype.id="OC";zh.prototype.name="Occupancy";zh.prototype.shortName="Occupancy";const _6=zh;class Vh extends ji{getAtomColor(e,t){return this.getResidueColor(e.residue,t)}getResidueColor(e,t){let n=this.palette.defaultResidueColor;return e._type.hydrophobicity!==void 0&&(n=this.palette.getGradientColor((e._type.hydrophobicity- -4.5)/(4.5- -4.5),this.opts.gradient)),n}}lt(Vh,"id","HY");Vh.prototype.id="HY";Vh.prototype.name="Hydrophobicity";Vh.prototype.shortName="Hydrophobicity";const x6=Vh;class kh extends ji{getAtomColor(e,t){return this.getResidueColor(e.residue,t)}getResidueColor(e,t){const n=e._molecule,i=t.getMoleculeCount();return i>1?this.palette.getGradientColor((n.index-1)/(i-1),this.opts.gradient):this.palette.getGradientColor(0,this.opts.gradient)}}lt(kh,"id","MO");kh.prototype.id="MO";kh.prototype.name="Molecule";kh.prototype.shortName="Molecule";const y6=kh;function v6(s,e){const t=s>>16&255,n=s>>8&255,i=s&255,r=e*t,o=e*n,a=e*i;return r<<16|o<<8|a}class Gh extends ji{getAtomColor(e,t){const n=this.opts.color,i=v6(n,this.opts.factor);return e.flags&Vr.Flags.CARBON?n:i}getResidueColor(e,t){return this.opts.color}}lt(Gh,"id","CB");Gh.prototype.id="CB";Gh.prototype.name="Carbon";Gh.prototype.shortName="Carbon";const S6=Gh,b6=new aa([c6,h6,u6,d6,_E,f6,p6,m6,g6,_6,x6,y6,S6]),jd=b6;function Gn(s){return new b.Color(s,s,s)}const w6=[{id:"DF",name:"Diffuse",shortName:"Diffuse",uberOptions:{diffuse:Gn(1),specular:Gn(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"SF",name:"Soft Plastic",shortName:"Soft",uberOptions:{diffuse:Gn(1),specular:Gn(.1),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"PL",name:"Glossy Plastic",shortName:"Glossy",uberOptions:{diffuse:Gn(.56),specular:Gn(.28),shininess:100,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"ME",name:"Metal",shortName:"Metal",uberOptions:{diffuse:Gn(.56),specular:Gn(.55),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"TR",name:"Transparent",shortName:"Transparent",uberOptions:{diffuse:Gn(1),specular:Gn(0),shininess:1,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"GL",name:"Glass",shortName:"Glass",uberOptions:{diffuse:Gn(.5),specular:Gn(.65),shininess:100,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"BA",name:"Backdrop",shortName:"Backdrop",uberOptions:{diffuse:Gn(1),specular:Gn(0),shininess:1,opacity:1},values:{lights:!1,fog:!1,depthWrite:!1,transparent:!1,toonShading:!1}},{id:"TN",name:"Toon",shortName:"Toon",uberOptions:{diffuse:Gn(1),specular:Gn(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!0}},{id:"FL",name:"Flat",shortName:"Flat",uberOptions:{diffuse:Gn(1),specular:Gn(0),shininess:0,opacity:1},values:{lights:!1,fog:!0,depthWrite:!0,transparent:!1}}],M6=new aa(w6),xl=M6;function E6(s,e){const t=[];return s.traverse(n=>{for(let i=0;i<e.length;i++)if(n instanceof e[i]){t[t.length]=n;break}}),t}function O_(s,e,t){const n=s.material.createInstance();n.setValues(e);const i=new s.constructor(s.geometry,n);return i.material.needsUpdate=!0,i.applyMatrix4(s.matrix),i.layers.set(t),i}function Hh(s,e,t){const n=E6(s,e);for(let i=0,r=n.length;i<r;++i){const o=n[i];o.parent&&t(o)}}function A6(s,e){const t=e.length;if(t<1)return;const n=[b.Mesh,b.LineSegments,b.Line];Hh(s,n,i=>{i.applyMatrix4(e[0]);for(let r=1;r<t;++r){const o=new i.constructor(i.geometry,i.material);i.parent.add(o),o.applyMatrix4(e[r])}})}const T6=function(){const s={prepassTransparancy:!0,fakeOpacity:!1,transparent:!1,colorFromDepth:!1,lights:!1,shadowmap:!1,fog:!1};return function(e,t){t instanceof Wr&&Hh(e,[b.Mesh,b.LineSegments],n=>{n.material.setValues({prepassTransparancy:!1,fakeOpacity:!1}),n.material.needsUpdate=!0,n.layers.set(yt.LAYERS.TRANSPARENT);const i=O_(n,s,yt.LAYERS.PREPASS_TRANSPARENT);n.parent.add(i)})}}(),C6=function(){const s={colorFromPos:!0,transparent:!1,colorFromDepth:!1,lights:!1,shadowmap:!1,fog:!1,overrideColor:!1,fogTransparent:!1,attrColor:!1,attrColor2:!1,attrAlphaColor:!1,fakeOpacity:!1};return function(e,t){t instanceof Wr&&Hh(e,[b.Mesh,b.LineSegments],n=>{const i=O_(n,s,yt.LAYERS.COLOR_FROM_POSITION);n.parent.add(i)})}}(),R6=function(){const s={colorFromDepth:!0,orthoCam:!0,lights:!1,shadowmap:!1,fog:!1};return function(e,t){t instanceof Wr&&Hh(e,[b.Mesh,b.LineSegments],n=>{if(!n.receiveShadow&&n.material.shadowmap&&n.material.setValues({shadowmap:!1}),!n.material.lights||!n.castShadow||!yt.belongToSelectLayers(n))return;const i=O_(n,s,yt.LAYERS.SHADOWMAP);i.isShadowmapMesh=!0,n.parent.add(i)})}}();function P6(s,e){e instanceof Wr&&Hh(s,[b.Mesh,b.LineSegments],t=>{t.isShadowmapMesh&&t.parent.remove(t)})}function xE(s,e){function t(n){n instanceof b.Mesh&&e(n);for(let i=0,r=n.children.length;i<r;i++)t(n.children[i])}t(s)}function I6(s){const e=s.geometry;if(e instanceof b.InstancedBufferGeometry){const t=e.attributes;for(const n in t)if(t.hasOwnProperty(n)&&t[n]instanceof b.InstancedBufferAttribute){const i=t[n];return(e.index?e.index.array.length/3:0)*i.array.length/i.itemSize}return 0}return e instanceof b.BufferGeometry?e.index?e.index.array.length/3:0:e.faces?e.faces.length:0}function L6(s){let e=0;return xE(s,t=>{e+=I6(t)}),e}const yl={applyTransformsToMeshes:A6,processTransparentMaterial:T6,processColFromPosMaterial:C6,createShadowmapMaterial:R6,removeShadowmapMaterial:P6,forEachMeshInGroup:xE,countTriangles:L6},{selectors:N6}=On;class F6{constructor(e,t,n,i){const r={clipPlane:pe.now.draft.clipPlane,fogTransparent:pe.now.bg.transparent,shadowmap:pe.now.shadow.on,shadowmapType:pe.now.shadow.type};this.index=e,this.mode=t,this.colorer=n,this.selector=i,this.selectorString="",this.count=0,this.material=new Wr,this.material.setValues(r),this.material.setUberOptions({fogAlpha:pe.now.fogAlpha}),this.materialPreset=xl.first,this.needsRebuild=!0,this.visible=!0,this.setMode(t)}markAtoms(e){return this.count=e.markAtoms(this.selector,1<<this.index),this.needsRebuild=!0,this.count}unmarkAtoms(e){e.clearAtomBits(1<<this.index),this.count=0}setMode(e){this.mode=e}setMaterialPreset(e){this.materialPreset=e,this.material.setUberOptions(e.uberOptions),this.material.setValues(e.values)}reset(){this.geo=null,this.selectionGeo=null}buildGeometry(e){return this.reset(),this.needsRebuild=!1,pe.now.ao&&this.material.setValues({normalsToGBuffer:pe.now.ao}),this.geo=this.mode.buildGeometry(e,this.colorer,1<<this.index,this.material),this.material.uberOptions.opacity<.99&&pe.now.transparency==="prepass"&&yl.processTransparentMaterial(this.geo,this.material),this.geo.visible=this.visible,yt.processObjRenderOrder(this.geo,this.materialPreset.id),yl.processColFromPosMaterial(this.geo,this.material),pe.now.shadow.on&&yl.createShadowmapMaterial(this.geo,this.material),this.geo}buildSelectionGeometry(e){let t=null;if(this.geo&&"getSubset"in this.geo){const n=this.geo.getSubset(e);if(n&&n.length>0){t=new b.Group,t.matrixAutoUpdate=!1,t.matrix=this.geo.matrix;for(let i=0;i<n.length;i++){const r=n[i];t.add(r)}}}return t&&(t.visible=this.visible),this.selectionGeo=t,this.selectionGeo}compare(e){const t={},n=String(this.selector);(!e||n.valueOf()!==String(e.selector).valueOf())&&(t.selector=n);const i=this.mode.identify();(!e||Array.isArray(i)||i!==e.mode)&&(t.mode=i);const r=this.colorer.identify();return(!e||Array.isArray(r)||r!==e.colorer)&&(t.colorer=r),(!e||this.materialPreset.id!==e.material)&&(t.material=this.materialPreset.id),t}change(e,t,n,i){const r={};if(e.selector){const o=N6.parse(e.selector).selector,a=String(o);this.selectorString!==a&&(r.selector=a,this.selectorString=a,this.selector=o,this.markAtoms(t))}if(e.mode){const o=e.mode;Me.default.isEqual(this.mode.identify(),o)||(r.mode=o,this.setMode(n))}if(e.colorer){const o=e.colorer;Me.default.isEqual(this.colorer.identify(),o)||(r.colorer=o,this.colorer=i)}if(e.material){const o=e.material;Me.default.isEqual(this.materialPreset.id,o)||(r.material=o,this.setMaterialPreset(xl.get(e.material)))}return r}show(e){this.visible=e,this.geo&&(this.geo.visible=e),this.selectionGeo&&(this.selectionGeo.visible=e)}}const cg=F6;function yE(s,e,t){const{children:n}=s;if(n)for(let i=0,r=n.length;i<r;++i){const o=n[i];o._component===e&&t(o),o instanceof yt.RCGroup&&yE(o,e,t)}}function vE(){}class O6 extends vE{constructor(e){super(),this._complexVisual=e,this._inProgress=!1}begin(){const e=this._complexVisual.getComplex();this._componentTransforms=[];for(let t=0;t<e._components.length;++t){const n=e._components[t];this._componentTransforms[n._index]=new b.Object3D}return this._inProgress=!0,!0}apply(){if(!this._inProgress)return;const e=this._complexVisual.getComplex();for(let t=0;t<e._components.length;++t)this._bakeComponentTransform(e._components[t]);e.onAtomPositionChanged(),this._resetComponentTransform(),this._complexVisual.finalizeEdit()}discard(){this._inProgress&&(this._resetComponentTransform(),this._complexVisual.finalizeEdit())}getAltObj(){const e={objects:[],pivot:new b.Vector3(0,0,0)},t=this._complexVisual,n=t.getSelectedComponent();if(n===null)return e;const i=this._complexVisual.getSelectionGeo(),r=1<<t.getSelectionBit();let o,a,l,h;for(yE(t,n,p=>{e.objects.push(p)}),o=0;o<i.children.length;++o)for(l=i.children[o],a=0;a<l.children.length;++a)h=l.children[a],h.hasOwnProperty("_component")&&h._component===n&&e.objects.push(h);e.objects.push(this._componentTransforms[n._index]);const u=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),f=new b.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n.forEachResidue(p=>{const m=p._atoms;for(a=0;a<m.length;++a)m[a].mask&r&&(u.min(m[a].position),f.max(m[a].position))}),e.pivot.lerpVectors(u,f,.5),e}_bakeComponentTransform(e){const t=this._componentTransforms[e._index];t&&(!(t.position.x===0&&t.position.y===0&&t.position.z===0)||!(t.quaternion.x===0&&t.quaternion.y===0&&t.quaternion.z===0&&t.quaternion.w===1))&&(t.updateMatrix(),e.forEachResidue(n=>{const i=n._atoms;for(let r=0;r<i.length;++r)i[r].position.applyMatrix4(t.matrix)}))}_resetComponentTransform(){const e=this._complexVisual,t=this._complexVisual.getSelectionGeo();let n,i,r,o;for(n=0;n<this._componentTransforms.length;++n)o=this._componentTransforms[n],o.position.set(0,0,0),o.quaternion.set(0,0,0,1);for(n=0;n<e.children.length;++n)for(r=e.children[n],i=0;i<r.children.length;++i)o=r.children[i],o.hasOwnProperty("_component")&&(o.position.set(0,0,0),o.quaternion.set(0,0,0,1));for(n=0;n<t.children.length;++n)for(r=t.children[n],i=0;i<r.children.length;++i)o=r.children[i],o.hasOwnProperty("_component")&&(o.position.set(0,0,0),o.quaternion.set(0,0,0,1))}}class D6 extends vE{constructor(e){super(),this._complexVisual=e,this._inProgress=!1}begin(){const e=this._complexVisual,t=this._complexVisual.getSelectionGeo(),n=this._getSelectionBorderAtoms();if(n.length<1||n.length>2)return In.error("Can only edit fragments with one or two bound atoms."),!1;this._fragmentBoundAtoms=n;const i=1<<e.getSelectionBit();e.disableSubset(i,!0);for(let a=0;a<t.children.length;++a)t.children[a].visible=!1;const r=n[0].position.clone();n.length===2&&r.lerp(n[1].position,.5),this._fragmentGeo=new b.Group,e.add(this._fragmentGeo),this._fragmentGeo.position.copy(r),this._fragmentSelectionGeo=new b.Group,t.add(this._fragmentSelectionGeo),this._fragmentSelectionGeo.position.copy(r);const o=r.clone();o.negate();for(let a=0;a<e.children.length;++a){const l=e.children[a];if(!("getSubset"in l))continue;const h=new b.Group;this._fragmentGeo.add(h);const u=new b.Group;this._fragmentSelectionGeo.add(u);const f=l.getSubset(i,!0);for(let m=0;m<f.length;m++){const g=f[m];h.add(g),g.position.copy(o)}const p=l.getSubset(i,!0);for(let m=0;m<p.length;m++){const g=p[m];u.add(g),g.position.copy(o)}}return yt.applySelectionMaterial(this._fragmentSelectionGeo),this._inProgress=!0,!0}apply(){if(!this._inProgress)return;const e=this._complexVisual,t=e.getSelectionBit(),n=this._fragmentGeo.position,i=this._fragmentGeo.matrix.clone();i.multiply(new b.Matrix4().makeTranslation(-n.x,-n.y,-n.z)),this._bakeAtomTransform(i,1<<t),e.enableSubset(1<<t,!0),e.getComplex().onAtomPositionChanged(),e.finalizeEdit()}discard(){if(!this._inProgress)return;const e=this._complexVisual,t=this._complexVisual.getSelectionGeo();this._fragmentGeo.parent.remove(this._fragmentGeo),e.enableSubset(1<<e.getSelectionBit(),!0);for(let n=0;n<t.children.length;++n){const i=t.children[n];i.visible?t.remove(i):i.visible=!0}e.finalizeEdit()}isFreeRotationAllowed(){return this._fragmentBoundAtoms.length<2}getAltObj(){const e={objects:[],pivot:new b.Vector3(0,0,0)};e.objects.push(this._fragmentGeo,this._fragmentSelectionGeo);const t=this._fragmentBoundAtoms;if(t.length===1){if(t[0].bonds.length===1){const n=t[0].bonds[0];e.axis=new b.Vector3().subVectors(n._right.position,n._left.position),e.axis.normalize(),e.axis.transformDirection(this._complexVisual.matrixWorld)}}else t.length===2&&(e.axis=new b.Vector3().subVectors(t[1].position,t[0].position),e.axis.normalize(),e.axis.transformDirection(this._complexVisual.matrixWorld));return e}_getSelectionBorderAtoms(){const e=this._complexVisual.getComplex(),t=1<<this._complexVisual.getSelectionBit(),n={};e.forEachBond(o=>{o._left.mask&t?o._right.mask&t||(n[o._left.index]=1):o._right.mask&t&&(n[o._right.index]=1)});const i=[],r=Object.keys(n);for(let o=0,a=r.length;o<a;++o){const l=r[o];i.push(e._atoms[l])}return i}_bakeAtomTransform(e,t){this._complexVisual.getComplex().forEachAtom(n=>{n.mask&t&&n.position.applyMatrix4(e)})}}const WS={ComponentEditor:O6,FragmentEditor:D6},{selectors:hi}=On;function ol(s,e){Array.isArray(e)||(e=[e]);const[t,n]=e,i=s.get(t)||s.first;return new i(n)}class ah extends sh{constructor(e,t){super(e,t),this._complex=t,this._reprList=[],this._repr=null,this._reprListChanged=!0,this._selectionBit=0,this._reprUsedBits=0,this._selectionCount=0,this._selectionGeometry=new b.Group}getBoundaries(){return this._complex.getBoundaries()}release(){this._selectionGeometry.parent&&this._selectionGeometry.remove(this._selectionGeometry),sh.prototype.release.call(this)}getComplex(){return this._complex}getSelectionCount(){return this._selectionCount}getSelectionGeo(){return this._selectionGeometry}getSelectionBit(){return this._selectionBit}getEditor(){return this._editor}resetReps(e){this._complex&&this._complex.clearAtomBits(-1),this._reprListChanged=!0,this._reprUsedBits=0,this._reprList.length=e.length;for(let t=0,n=e.length;t<n;++t){const i=e[t];let r,o;typeof i.selector=="string"?(o=i.selector,{selector:r}=hi.parse(o)):typeof i.selector>"u"?(o=pe.now.presets.default[0].selector,{selector:r}=hi.parse(o)):({selector:r}=i,o=r.toString());const a=ol(Yd,i.mode),l=ol(jd,i.colorer),h=xl.get(i.material)||xl.first;this._reprList[t]=new cg(t,a,l,r),this._reprList[t].setMaterialPreset(h),this._reprList[t].selectorString=o,this._complex&&this._complex.markAtoms(r,1<<t),this._reprUsedBits|=1<<t}this._repr=e.length>0?this._reprList[0]:null,this._selectionBit=e.length,this._reprUsedBits|=1<<this._selectionBit,this._selectionCount=0,this._complex&&this._complex.update()}repCount(){return this._reprList.length}repCurrent(e){return e>=0&&e<this._reprList.length?this._repr=this._reprList[e]:e=this._reprList.indexOf(this._repr),e}rep(e,t){if(!t&&(e===void 0||e instanceof Object)&&(t=e,e=this.repCurrent()),e<0||e>this._reprList.length)return In.error(`Rep ${e} does not exist!`),null;if(e===this._reprList.length){const r=this.repAdd(t);return In.warn(`Rep ${e} does not exist! New representation was created.`),{desc:r.desc,index:e,status:"created"}}const n=this._reprList[e],i={selector:n.selectorString,mode:n.mode.identify(),colorer:n.colorer.identify(),material:n.materialPreset.id};if(t){const r=n.change(t,this._complex,ol(Yd,t.mode),ol(jd,t.colorer));if(!Me.default.isEmpty(r)){n.needsRebuild=!0;for(const o in r)r.hasOwnProperty(o)&&(i[o]=r[o],In.debug(`rep[${e}].${o} changed to ${r[o]}`));return r.mode&&n.mode.isSurface&&(pe.now.resolution==="ultra"||pe.now.resolution==="high")&&(In.report('Surface resolution was changed to "medium" to avoid hang-ups.'),pe.set("resolution","medium")),{desc:i,index:e,status:"changed"}}}return{desc:i,index:e,status:""}}repGet(e){return(e===void 0||e instanceof Object)&&(e=this.repCurrent()),e<0||e>=this._reprList.length?null:this._reprList[e]}_getFreeReprIdx(){let e=this._reprUsedBits;for(let t=0;t<=ah.NUM_REPRESENTATION_BITS;++t,e>>=1)if(!(e&1))return t;return-1}repAdd(e){if(this._reprList.length>=ah.NUM_REPRESENTATION_BITS)return null;const t=this._getFreeReprIdx();if(t<0)return null;const n=this.buildSelectorFromMask(1<<this._selectionBit),i=pe.now.presets.default[0],r=Me.default.merge({selector:i.selector,mode:i.mode,colorer:i.colorer,material:i.material},e),o=typeof r.selector=="string"?hi.parse(r.selector).selector:r.selector,a=new cg(this._selectionBit,ol(Yd,r.mode),ol(jd,r.colorer),o);return a.selectorString=o.toString(),a.setMaterialPreset(xl.get(r.material)),a.markAtoms(this._complex),this._reprList.push(a),this._selectionBit=t,this._reprUsedBits|=1<<this._selectionBit,this._complex.markAtoms(n,1<<this._selectionBit),{desc:r,index:this._reprList.length-1}}repRemove(e){e===void 0&&(e=this.repCurrent());let t=this._reprList.length;if(e<0||e>=t||t<=1)return;const n=this._reprList[e];n.unmarkAtoms(this._complex),this._reprUsedBits&=~(1<<n.index),this._reprList.splice(e,1),n===this._repr&&(--t,e=e<t?e:t-1,this._repr=this._reprList[e]),this._reprListChanged=!0}repHide(e,t){if(t===void 0&&(t=!0),e<0||e>=this._reprList.length)return;this._reprList[e].show(!t)}select(e,t){t?this._selectionCount+=this._complex.markAtomsAdditionally(e,1<<this._selectionBit):this._selectionCount=this._complex.markAtoms(e,1<<this._selectionBit),this._complex.updateStructuresMask(),this.rebuildSelectionGeometry()}resetSelectionMask(){this._selectionCount!==0&&(this._selectionCount=0,this._complex&&this._complex.clearAtomBits(1<<this._selectionBit))}updateSelectionMask(e){const t=this,{atom:n}=e;let{residue:i,chain:r,molecule:o}=e;const a=1<<this._selectionBit,l=~a;if(n)i=n.residue,r=i._chain,o=i._molecule,n.mask&a?(n.mask&=l,i._mask&=l,r._mask&=l,o&&(o.mask&=l),this._selectionCount--):(n.mask|=a,this._selectionCount++,i.collectMask(),r.collectMask(),o&&o.collectMask());else if(i)r=i._chain,o=i._molecule,i._mask&a?(i._mask&=l,r._mask&=l,i.forEachAtom(h=>{h.mask&a&&(h.mask&=l,t._selectionCount--)})):(i._mask|=a,i.forEachAtom(h=>{h.mask&a||(h.mask|=a,t._selectionCount++)}),r.collectMask(),o&&o.collectMask());else if(r||o){const h=r||o;h._mask&a?(h._mask&=l,h.forEachResidue(u=>{u._mask&a&&(u._mask&=l,u.forEachAtom(f=>{f.mask&a&&(f.mask&=l,t._selectionCount--)}),u._mask&=l)})):(h._mask|=a,h.forEachResidue(u=>{if(!(u._mask&a)){u._mask|=a,u.forEachAtom(p=>{p.mask&a||(p.mask|=a,t._selectionCount++)});const f=r?u.getMolecule():u.getChain();f&&f.collectMask()}}))}else this.resetSelectionMask()}expandSelection(){const e=this,t=1<<this._selectionBit,n=1<<31;this._complex.forEachBond(r=>{r._left.mask&t?r._right.mask&t||(r._right.mask|=n):r._right.mask&t&&(r._left.mask|=n)});const i=~n;this._complex.forEachAtom(r=>{r.mask&n&&(r.mask=r.mask&i|t,++e._selectionCount)}),this._complex.updateStructuresMask()}shrinkSelection(){const e=this,t=1<<this._selectionBit,n=1<<31;this._complex.forEachBond(r=>{r._left.mask&t?r._right.mask&t||(r._left.mask|=n):r._right.mask&t&&(r._right.mask|=n)}),this._complex.forEachAtom(r=>{r.mask&t&&r.bonds.length===1&&(r.mask|=n)});const i=~(t|n);this._complex.forEachAtom(r=>{r.mask&n&&(r.mask&=i,--e._selectionCount)}),this._complex.updateStructuresMask()}getSelectedComponent(){const e=1<<this._selectionBit;let t=null,n=!1;return this._complex.forEachAtom(i=>{i.mask&e&&(t===null?t=i.residue._component:t!==i.residue._component&&(n=!0))}),n?null:t}getSelectionCenter(e,t,n){e.set(0,0,0);let i=0;return this._complex.forEachAtom(r=>{t(r,n)&&(e.add(r.position),i++)}),i===0?!1:(e.divideScalar(i),e.applyMatrix4(this.matrix),!0)}needsRebuild(){if(this._reprListChanged)return!0;const e=this._reprList;for(let t=0,n=e.length;t<n;++t)if(e[t].needsRebuild)return!0;return!1}rebuild(){const e=this;return yt.clearTree(this),new Promise(t=>{const n=e._complex;if(!n){t();return}let i=!1;setTimeout(()=>{console.time("build");const r=e._reprList,o=El.get(pe.now.palette)||El.first;let a=!1;for(let l=0,h=r.length;l<h;++l){const u=r[l];if(u.colorer.palette=o,u.needsRebuild){u.reset();try{u.buildGeometry(n)}catch(f){if(f instanceof Oe.OutOfMemoryError)u.needsRebuild=!1,u.reset(),In.error(`Not enough memory to build geometry for representation ${u.index+1}`),i=!0;else throw f}}a=i||a||yt.groupHasGeometryToRender(u.geo),u.geo&&e.add(u.geo)}e._reprListChanged=!1,console.timeEnd("build"),t()},10)})}setNeedsRebuild(){const e=this._reprList;for(let t=0,n=e.length;t<n;++t)e[t].needsRebuild=!0}rebuildSelectionGeometry(){const e=1<<this._selectionBit;yt.clearTree(this._selectionGeometry);for(let t=0,n=this._reprList.length;t<n;++t){const r=this._reprList[t].buildSelectionGeometry(e);if(r){this._selectionGeometry.add(r);for(let o=0;o<r.children.length;o++){const a=r.children[o];if(this._editor&&this._editor._componentTransforms){const l=this._editor._componentTransforms[a._component._index];l&&(a.position.copy(l.position),a.quaternion.copy(l.quaternion))}}yt.applySelectionMaterial(r)}}}_buildSelectorFromSortedLists(e,t,n){const i=this._complex;function r(a){const l=[];let h=0,u=NaN,f=NaN;for(let p=0,m=a.length;p<m;++p){const g=a[p];g===f+1?f=g:(Number.isNaN(u)||(l[h++]=new hi.Range(u,f)),u=f=g)}return Number.isNaN(u)||(l[h]=new hi.Range(u,f)),l}let o=null;if(n.length===i._chains.length)o=hi.all();else{let a;if(n.length>0&&(a=hi.chain(n),o=o?hi.or(o,a):a),Object.keys(t).length>0)for(const l in t)t.hasOwnProperty(l)&&(a=hi.and(hi.chain(l),hi.residx(r(t[l]))),o=o?hi.or(o,a):a);e.length>0&&(a=hi.serial(r(e)),o=o?hi.or(o,a):a),o||(o=hi.none())}return o}buildSelectorFromMask(e){const t=this._complex,n=[],i={},r=[];return t.forEachChain(o=>{o._mask&e&&n.push(o._name)}),t.forEachResidue(o=>{if(o._mask&e&&!(o._chain._mask&e)){const a=o._chain._name;a in i?i[a].push(o._index):i[a]=[o._index]}}),t.forEachAtom(o=>{o.mask&e&&!(o.residue._mask&e)&&r.push(o.serial)}),this._buildSelectorFromSortedLists(r,i,n)}forSelectedResidues(e){const t=1<<this._selectionBit;this._complex.forEachResidue(n=>{n._mask&t&&e(n)})}beginComponentEdit(){if(this._editor)return null;const e=new WS.ComponentEditor(this);return e.begin()?(this._editor=e,e):null}beginFragmentEdit(){if(this._editor)return null;const e=new WS.FragmentEditor(this);return e.begin()?(this._editor=e,e):null}finalizeEdit(){this._editor=null}setMaterialValues(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;for(let i=0,r=this._reprList.length;i<r;++i){const o=this._reprList[i];o.material.setValues(e),t&&o.geo.traverse(a=>{a instanceof b.Mesh&&(a.material.setValues(e),n!==void 0&&n(a),a.material.needsUpdate=!0)})}}setUberOptions(e){for(let t=0,n=this._reprList.length;t<n;++t)this._reprList[t].material.setUberOptions(e)}within(e,t){const n=this._complex.getVoxelWorld();if(n===null)return!1;const i=1<<this._selectionBit;return this._complex.markAtoms(e,i),n&&n.forEachAtomWithinDistFromMasked(this._complex,i,Number(t),r=>{r.mask|=i}),this._selectionCount=this._complex.countAtomsByMask(i),this._complex.updateStructuresMask(),this.buildSelectorFromMask(i)}}ah.NUM_REPRESENTATION_BITS=30;const bs=ah,U6=`varying vec3 pos;\r
\r
void main() {\r
  // we're assuming local position is in [-0.5, 0.5]\r
  // we need to offset it to be represented in RGB\r
  pos = position.xyz + 0.5;\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
}`,B6=`varying vec3 pos;\r
\r
void main() {\r
  gl_FragColor = vec4(pos, 0.5);\r
}`,z6=`varying vec4 screenSpacePos;\r
\r
void main() {\r
  screenSpacePos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
  gl_Position = screenSpacePos;\r
}`,V6=`uniform mat4 projectionMatrix;\r
\r
// 3D volume texture\r
uniform vec3 volumeDim;    // volume dimensions, pixels\r
uniform sampler2D tileTex; // tiled texture containing all Z-slices of a 3D data\r
uniform vec2 tileTexSize;  // size of tiled texture, pixels\r
uniform vec2 tileStride;   // UV stride between slices in tile tex, pixels\r
\r
uniform vec3 boxAngles;//value of angles({x: alpha, y:beta, z:gamma}) types 1 - if angle is obtuse, 0 - if acute\r
uniform vec3 delta; //Projection box delta's from non-orthogonal origin axes; {x: XY, y : XZ, z: YZ}\r
\r
uniform vec3 _isoLevel0;\r
uniform float _flipV;\r
uniform sampler2D _BFLeft;\r
uniform sampler2D _BFRight;\r
uniform sampler2D _FFLeft;\r
uniform sampler2D _FFRight;\r
uniform sampler2D _WFFLeft;\r
uniform sampler2D _WFFRight;\r
\r
varying vec4 screenSpacePos;\r
\r
#define NO_COLOR vec4(0., 0., 0., 0.)\r
\r
vec4 sample3DTexture(vec3 texCoord) {\r
  // a pair of Z slices is determined by nearest slice border\r
  float zSliceBorder = floor(texCoord.z * volumeDim.z + 0.5);\r
  float zSliceNumber1 = max(zSliceBorder - 1.0, 0.0);\r
  float zSliceNumber2 = min(zSliceBorder, volumeDim.z - 1.0);\r
\r
  float rowTiles = floor(tileTexSize.x / tileStride.x);\r
\r
  // calculate coords in tile texture for both slices\r
  vec2 tileOffset = vec2(mod(zSliceNumber1, rowTiles), floor(zSliceNumber1 / rowTiles));\r
  vec2 texCoordSlice1 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r
  tileOffset = vec2(mod(zSliceNumber2, rowTiles), floor(zSliceNumber2 / rowTiles));\r
  vec2 texCoordSlice2 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r
\r
  // bilinear filtering\r
  vec4 colorSlice1 = texture2D(tileTex, texCoordSlice1);\r
  vec4 colorSlice2 = texture2D(tileTex, texCoordSlice2);\r
  float weightSlice2 = texCoord.z * volumeDim.z - (zSliceNumber1 + 0.5);\r
  return mix(colorSlice1, colorSlice2, weightSlice2);\r
}\r
\r
vec4 sample3DTextureInclined(vec3 boxCoord) { // delta:{ x: XY, y : XZ, z: YZ }\r
  vec3 textCoord = boxCoord;\r
  vec2 currDelta = mix(boxCoord.zz, vec2(1., 1.) - boxCoord.zz, boxAngles.yx) * delta.yz;\r
\r
  textCoord.y = (boxCoord.y  - currDelta.y) / (1. - delta.z);\r
  if (textCoord.y < 0.0 || textCoord.y > 1.0)\r
    return NO_COLOR;\r
\r
  currDelta.x += mix(textCoord.y, 1.0 - textCoord.y, boxAngles.z) * delta.x;\r
\r
  textCoord.x = (boxCoord.x - currDelta.x) / (1. - delta.x - delta.y);\r
  if (textCoord.x < 0.0 || textCoord.x > 1.0)\r
    return NO_COLOR;\r
\r
  return sample3DTexture(textCoord);\r
}\r
\r
float CalcColor(vec3 iter, vec3 dir) {\r
  float d = 1. / 128.;\r
  vec3 dx = vec3(d, 0.0, 0.0);\r
  vec3 dy = vec3(0.0, d, 0.0);\r
  vec3 dz = vec3(0.0, 0.0, d);\r
\r
  // #Opt: coordInc.x:(iter + dx).x > 1. ? 0.: sample3DTextureInclined(iter + dx).x,\r
  vec3 coordInc = mix(\r
    vec3(\r
      sample3DTextureInclined(iter + dx).x,\r
      sample3DTextureInclined(iter + dy).x,\r
      sample3DTextureInclined(iter + dz).x\r
    ),\r
    vec3(0. ,0. , 0.),\r
    vec3(floor((iter + dx).x), floor((iter + dy).y), floor((iter + dz).z))\r
  );\r
\r
  // #Opt: coordDec.x:(iter - dx).x < 0. ? 0.: sample3DTextureInclined(iter - dx).x,\r
  vec3 coordDec = mix(\r
    vec3(0. ,0. , 0.),\r
    vec3(\r
      sample3DTextureInclined(iter - dx).x,\r
      sample3DTextureInclined(iter - dy).x,\r
      sample3DTextureInclined(iter - dz).x\r
    ),\r
    vec3(ceil((iter - dx).x), ceil((iter - dy).y), ceil((iter - dz).z))\r
  );\r
\r
  vec3 N = normalize(coordInc - coordDec);\r
  float dif = max(0.0, dot(N, dir));\r
  return dif;\r
}\r
\r
vec3 AccuracyIso(vec3 left, vec3 right, float volLeft, float threshold) {\r
  for (int i = 0; i < 5; i++) {\r
    vec3 iterator = 0.5 * (left + right);\r
    float vol = sample3DTextureInclined(iterator).r;\r
    if ((volLeft - threshold) * (vol - threshold) < 0.)\r
      right = iterator;\r
    else\r
      left = iterator;\r
  }\r
  return 0.5 * (left + right);\r
}\r
\r
vec3 CorrectIso(vec3 left, vec3 right, float tr) {\r
  for (int j = 0; j < 5; j++) {\r
    vec3 iterator = 0.5 * (left + right);\r
    float vol = sample3DTextureInclined(iterator).r;\r
    if (vol < tr)\r
      right = iterator;\r
    else\r
      left = iterator;\r
  }\r
  return 0.5 * (left + right);\r
}\r
\r
vec4 GetIso1(vec3 start, vec3 back, float molDist, vec3 dir, float tr, int count) {\r
  float vol, stepSize = (float(count) + 2.) / float(STEPS_COUNT);\r
  vec3 step = stepSize * dir, iterator = start, left, right;\r
  vec4 acc = NO_COLOR;\r
\r
  for (int i = 0; i < STEPS_COUNT; i++) {\r
    iterator = iterator + step;\r
    vol = sample3DTextureInclined(iterator).r;\r
    if (length(iterator - back) <= stepSize || (vol > tr))\r
      break;\r
  }\r
\r
  if (vol > tr)\r
    acc = vec4(CorrectIso(iterator, iterator - step, tr).xyz, 1.);\r
\r
  return acc;\r
}\r
\r
float easeOut(float x0, float x1, float x) {\r
  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r
  return 1.0 - (1.0 - t) * (1.0 - t);\r
}\r
\r
float easeIn(float x0, float x1, float x) {\r
  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r
  return t * t;\r
}\r
\r
vec3 GetColSimple(float vol) {\r
  float t = easeOut(_isoLevel0.x, _isoLevel0.y, vol);\r
  float s = easeIn(_isoLevel0.y, _isoLevel0.z, vol);\r
  return vec3(0.5, 0.6, 0.7) * (1.0 - t) + 2.0 * vec3(s, 0, 0);\r
}\r
\r
vec4 VolRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  vec4 acc = NO_COLOR, iso;\r
  vec3 iterator = start, sumColor = vec3(0., 0., 0.);\r
  float stepSize, alpha, sumAlpha = 0.0, vol, curStepSize, molD;\r
  vec3 step, col, colOld, right;\r
  float tr0 = _isoLevel0.x;\r
  float dif, r, kd, finish;\r
  int count = 0, stopMol = 0;\r
\r
  for (int k = 0; k < 3; k++) {\r
    stepSize = (float(k) + 2.) / float(STEPS_COUNT);\r
    kd = 140. * tr0 * stepSize;\r
    r = 1. - kd;\r
    step = stepSize * dir;\r
    iso = GetIso1(iterator, back, molDist, dir, tr0, k);\r
    if (iso.a < 0.1 || length(iso.xyz - start) > molDist)\r
      break;\r
    iterator = iso.xyz;\r
    dif = 1.;// CalcColor(iterator, dir);\r
    colOld = GetColSimple(tr0);\r
    curStepSize = stepSize;\r
    for (int i = 0; i < STEPS_COUNT; i++) {\r
      iterator = iterator + step;\r
      molD = length(iterator - start);\r
      vol = sample3DTextureInclined(iterator).r;\r
      finish = distance(iterator, back) - stepSize;\r
      if (finish < 0.0 || vol < tr0 || (sumAlpha > 0.97) || molD > molDist)\r
        break;\r
      alpha = (1. - r);\r
      col = GetColSimple(vol);\r
      vol = sample3DTextureInclined(iterator - 0.5 * step).r;\r
      vec3 colMid = GetColSimple(vol);\r
      sumColor += (1. - sumAlpha) * (colOld + 4.* colMid + col) * alpha / 6.;\r
      sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r
      colOld = col;\r
    } // for i\r
\r
    if (finish < 0.0 || sumAlpha > 0.97)\r
      break;\r
\r
    if (molD > molDist) {\r
      curStepSize = stepSize - (molD - molDist);\r
      right = iterator - (molD - molDist) * dir;\r
      vol = sample3DTextureInclined(right).r;\r
    } else {\r
      vec3 left = iterator - step;\r
      right = CorrectIso(left, iterator, tr0);\r
      curStepSize = distance(left, right);\r
      vol = tr0;\r
    }\r
\r
    alpha = (1. - r) * curStepSize / stepSize;\r
    dif = 1.;// CalcColor(right, dir);\r
    col = GetColSimple(vol);\r
    vol = sample3DTextureInclined(iterator - 0.5 * curStepSize / stepSize * step).r;\r
    vec3 colMid = GetColSimple(vol);\r
    sumColor += (1. - sumAlpha) * (colOld + 4. * colMid + col) * alpha / 6.;\r
    sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r
\r
    if (molD > molDist)\r
      break;\r
  } // for k\r
  acc.rgb = 1. * sumColor / sumAlpha;\r
  acc.a = sumAlpha;\r
  return acc;\r
}\r
\r
vec4 VolRender1(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  float stepSize = 1.0 / float(STEPS_COUNT);\r
  float len = length(back - start);\r
  vec3 step = stepSize * dir;\r
  vec3 iterator = start;\r
  float acc = 0.0;\r
\r
  for (int i = 0; i < STEPS_COUNT; i++) {\r
    if (float(i) * stepSize > len)\r
      break;\r
    iterator = iterator + step;\r
    if (sample3DTextureInclined(iterator).r > _isoLevel0.x)\r
      acc += 10. * sample3DTextureInclined(iterator).r / float(STEPS_COUNT);\r
  }\r
\r
  return vec4(1.,1.,1., acc);\r
}\r
\r
vec4 IsoRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  vec4 tst = GetIso1(start, back, 2., dir, _isoLevel0.x, 0);\r
  vec4 col = NO_COLOR;\r
\r
  if (length(tst.xyz - start) < molDist && tst.a > 0.1) {\r
    float dif =  CalcColor(tst.xyz, dir);\r
    dif = 0.9 * dif * dif;\r
    col = vec4(dif, dif, dif, 1);\r
  }\r
  return col;\r
}\r
\r
vec4 VolRender2(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  return sample3DTexture(start);\r
}\r
\r
void main() {\r
  vec3 tc = screenSpacePos.xyz / screenSpacePos.w * 0.5 + 0.5;\r
\r
  if (_flipV > 0.0) {\r
    tc.y = 1.0 - tc.y;\r
  }\r
\r
  vec3 start;\r
  vec3 back;\r
  vec3 molBack;\r
  if (projectionMatrix[0][2] < 0.0) {\r
    start = texture2D(_FFLeft, tc.xy).xyz;\r
    back = texture2D(_BFLeft, tc.xy).xyz;\r
    molBack = texture2D(_WFFLeft, tc.xy).xyz;\r
  } else {\r
    start = texture2D(_FFRight, tc.xy).xyz;\r
    back = texture2D(_BFRight, tc.xy).xyz;\r
    molBack = texture2D(_WFFRight, tc.xy).xyz;\r
  }\r
\r
  vec3 dir = normalize(back - start);\r
\r
  float molDist = 2.0;\r
  if (length(molBack) > 0.001) {\r
    molDist = distance(start, molBack);\r
  }\r
\r
  #ifdef ISO_MODE\r
    gl_FragColor = IsoRender(start, back, molDist, dir);\r
  #else\r
    gl_FragColor = VolRender(start, back, molDist, dir);\r
  #endif\r
}\r
`,k6=`varying vec4 volPos;\r
uniform float aspectRatio;\r
uniform float farZ;\r
uniform float tanHalfFOV;\r
uniform mat4  matWorld2Volume;\r
\r
void main() {\r
  // rescale plane to fill in the whole far plane area seen from camera\r
  vec3 pos = position.xyz;\r
  pos.x = pos.x * tanHalfFOV * farZ * aspectRatio;\r
  pos.y = pos.y * tanHalfFOV * farZ;\r
  // common transformation\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\r
  // calc pos in volume CS\r
  volPos = matWorld2Volume * modelMatrix * vec4(pos, 1.0);\r
  // we're assuming local position is in [-0.5, 0.5]\r
  // we need to offset it to be represented in RGB\r
  volPos = volPos + 0.5;\r
  volPos.w = 0.5;\r
}\r
`,G6=`varying vec4 volPos;\r
\r
void main() {\r
  gl_FragColor = volPos;\r
}`,H6=b.UniformsUtils.merge([{volumeDim:{type:"v3",value:new b.Vector3(512,512,512)},tileTex:{type:"t",value:null},tileTexSize:{type:"v2",value:new b.Vector2(512,512)},tileStride:{type:"v2",value:new b.Vector2(512,512)},boxAngles:{type:"v3",value:new b.Vector3(1,1,1)},delta:{type:"v3",value:new b.Vector3(0,0,0)},_isoLevel0:{type:"v2",value:new b.Vector3(.5,.75,1)},_flipV:{type:"f",value:0},_BFLeft:{type:"t",value:null},_BFRight:{type:"t",value:null},_FFLeft:{type:"t",value:null},_FFRight:{type:"t",value:null},_WFFLeft:{type:"t",value:null},_WFFRight:{type:"t",value:null}}]);function SE(s,e){const t=b.UniformsUtils.clone(e);for(const n in s)t.hasOwnProperty(n)&&(t[n].value=s[n]);return t}function bE(s,e){return{uniforms:SE(s,{}),vertexShader:U6,fragmentShader:B6,transparent:!1,depthTest:!1,depthWrite:!1,side:e}}class W6 extends b.ShaderMaterial{constructor(e){const t=bE(e,b.BackSide);super(t)}}class wE{constructor(e,t,n,i){this.uniforms=SE(e,t),this.vertexShader=n,this.fragmentShader=i,this.transparent=!1,this.depthTest=!1,this.depthWrite=!1,this.side=b.FrontSide}}class X6 extends b.ShaderMaterial{constructor(e){const t=b.UniformsUtils.merge([{aspectRatio:{type:"f",value:0},farZ:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},matWorld2Volume:{type:"4fv",value:new b.Matrix4}}]),n=new wE(e,t,k6,G6);super(n)}}class Y6 extends b.ShaderMaterial{constructor(e){const t=bE(e,b.FrontSide);super(t)}}class j6 extends b.ShaderMaterial{constructor(e){const t=new wE(e,H6,z6,V6);t.transparent=!0,t.depthTest=!0,super(t),this.updateDefines()}updateDefines(){this.defines={ISO_MODE:pe.now.modes.VD.isoMode,STEPS_COUNT:pe.now.modes.VD.polyComplexity[pe.now.resolution]*100},this.needsUpdate=!0}}const nf={BackFacePosMaterial:W6,BackFacePosMaterialFarPlane:X6,FrontFacePosMaterial:Y6,VolumeMaterial:j6},An=class An extends b.Mesh{constructor(){const t=new b.BufferGeometry;super(t);lt(this,"volumeInfo",{});this.clipPlane=new b.Plane;const n=new b.Vector3(.5,.5,.5);this.size=n,this.cullFlag=[!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1],this.faces=[{indices:[],norm:new b.Vector3(0,0,-1)},{indices:[],norm:new b.Vector3(0,0,1)},{indices:[],norm:new b.Vector3(0,-1,0)},{indices:[],norm:new b.Vector3(0,1,0)},{indices:[],norm:new b.Vector3(-1,0,0)},{indices:[],norm:new b.Vector3(1,0,0)},{indices:[],norm:new b.Vector3(0,0,0)}],this.vertices=[new b.Vector3(-n.x,-n.y,-n.z),new b.Vector3(-n.x,n.y,-n.z),new b.Vector3(n.x,-n.y,-n.z),new b.Vector3(n.x,n.y,-n.z),new b.Vector3(-n.x,-n.y,n.z),new b.Vector3(-n.x,n.y,n.z),new b.Vector3(n.x,-n.y,n.z),new b.Vector3(n.x,n.y,n.z),new b.Vector3(0,0,0),new b.Vector3(0,0,0),new b.Vector3(0,0,0),new b.Vector3(0,0,0),new b.Vector3(0,0,0),new b.Vector3(0,0,0)],t.setAttribute("position",new b.BufferAttribute(new Float32Array(this.vertices.length*3),3)),this.name="VolumeMesh"}_updateVertices(){const t=An._corners,n=An._edges,i=An._edgeIntersections;let r;const o=this.clipPlane.normal,a=this.clipPlane.constant,l=this.vertices,{size:h}=this,u=[0,0,0,0,0,0,0,0],f=[1,1,1,1,1,1,1,1,1,1,1,1],p=new b.Vector3;let m=null;function g(){if(o.x===0)return 0;const P=-(o.dot(p)+a)/o.x;return-h.x<=P&&P<=h.x?(m.set(P,p.y,p.z),P===h.x?2:P===-h.x?-2:1):0}function v(){if(o.y===0)return 0;const P=-(o.dot(p)+a)/o.y;return-h.y<=P&&P<=h.y?(m.set(p.x,P,p.z),P===h.y?2:P===-h.y?-2:1):0}function y(){if(o.z===0)return 0;const P=-(o.dot(p)+a)/o.z;return-h.z<=P&&P<=h.z?(m.set(p.x,p.y,P),P===h.z?2:P===-h.z?-2:1):0}for(let P=0;P<12;++P){const L=n[P];m=i[P],p.set(L[2],L[3],L[4]),p.multiply(h);let T=0;L[2]===0&&(T=g()),L[3]===0&&(T=v()),L[4]===0&&(T=y()),T===-2?u[L[0]]=1:T===2?u[L[1]]=1:T===0&&(f[P]=0)}const x={indices:[],norm:o.clone().negate()};let w=8;for(r=0;r<8;++r)u[r]===1&&(l[w].set(t[r][0],t[r][1],t[r][2]).multiply(h),x.indices.push(w++),f[t[r][3]]=0,f[t[r][4]]=0,f[t[r][5]]=0);for(r=0;r<12;++r)f[r]===1&&(l[w].copy(i[r]),x.indices.push(w++));this.faces[6]=x;const S=new b.Vector3,E=new b.Vector3;for(this.clipPlane.coplanarPoint(E),r=0;r<l.length;++r)this.cullFlag[r]=!1,r<8?(S.subVectors(l[r],E),this.cullFlag[r]=o.dot(S)>=0):r<8+x.indices.length&&(this.cullFlag[r]=!0);const A=this.geometry.getAttribute("position");let C=0;for(r=0;r<l.length;++r)A.array[C++]=l[r].x,A.array[C++]=l[r].y,A.array[C++]=l[r].z;A.needsUpdate=!0}_collectVertices(t,n){let i;const r=this.vertices;for(t.indices=[],i=0;i<r.length;++i)this.cullFlag[i]&&n(r[i])&&t.indices.push(i)}_sortIndices(t,n){let i,r;const o=this.vertices,a=[],l=new b.Vector3;for(i=1;i<t.indices.length;++i)l.subVectors(o[t.indices[i]],o[t.indices[0]]),l.normalize(),l.cross(n),l.negate(),a[i]=t.norm.dot(l);for(i=1;i<t.indices.length-1;++i)for(r=i+1;r<t.indices.length;++r)if(a[r]<a[i]){let h=a[i];a[i]=a[r],a[r]=h,h=t.indices[i],t.indices[i]=t.indices[r],t.indices[r]=h}}_updateIndices(){let t,n,i;const r=this.vertices,{size:o}=this;this._collectVertices(this.faces[0],m=>m.z===-o.z),this._collectVertices(this.faces[1],m=>m.z===o.z),this._collectVertices(this.faces[2],m=>m.y===-o.y),this._collectVertices(this.faces[3],m=>m.y===o.y),this._collectVertices(this.faces[4],m=>m.x===-o.x),this._collectVertices(this.faces[5],m=>m.x===o.x);const a=new b.Vector3,l=new b.Vector3,h=new b.Vector3;for(n=0;n<this.faces.length;++n){if(i=this.faces[n],i.indices.length===0)continue;for(a.set(0,0,0),t=0;t<i.indices.length;++t)a.add(r[i.indices[t]]);a.multiplyScalar(1/i.indices.length),l.subVectors(r[i.indices[0]],a),l.normalize();const m=[];for(t=0;t<i.indices.length;++t)h.subVectors(r[i.indices[t]],a),m[t]=h.dot(l);for(t=1;t<i.indices.length;++t)if(m[t]<m[0]){let g=m[0];m[0]=m[t],m[t]=g,[g]=i.indices,i.indices[0]=i.indices[t],i.indices[t]=g}this._sortIndices(i,l)}let u=0;for(n=0;n<this.faces.length;++n)i=this.faces[n],i.indices.length>=3&&(u+=3*(i.indices.length-2));let f=0;const p=new Uint16Array(u);for(n=0;n<this.faces.length;++n)for(i=this.faces[n],t=0;t<i.indices.length-2;++t)p[f]=i.indices[0],p[f+1]=i.indices[t+1],p[f+2]=i.indices[t+2],f+=3;this.geometry.setIndex(new b.BufferAttribute(p,1))}setDataSource(t){const n=new nf.VolumeMaterial,i=t.getDimensions(),r=t.getTiledTextureStride(),o=t.buildTiledTexture(),a=t.getBox();n.uniforms.volumeDim.value.set(i[0],i[1],i[2]),n.uniforms.tileTex.value=o,n.uniforms.tileTexSize.value.set(o.image.width,o.image.height),n.uniforms.tileStride.value.set(r[0],r[1]),Object.assign(this.volumeInfo,t.getVolumeInfo());const l=this.volumeInfo;n.uniforms.delta.value.copy(l.delta),n.uniforms.boxAngles.value.set(l.obtuseAngle[0],l.obtuseAngle[1],l.obtuseAngle[2]),this.material=n,a.getSize(this.scale),a.getCenter(this.position)}_updateIsoLevel(){const{kSigma:t,kSigmaMed:n,kSigmaMax:i}=pe.now.modes.VD,r=this.volumeInfo,o=r.dmean-r.dmin,a=r.dmax-r.dmin,l=h=>(o+h*r.sd)/a;this.material.uniforms._isoLevel0.value.set(l(t),l(n),l(i))}rebuild(t){const n=An._nearClipPlaneOffset,i=An._pos,r=An._norm,o=An._norm4D,a=An._matrixWorldToLocal,l=An._clipPlane;this._updateIsoLevel(),t.getWorldDirection(r),t.getWorldPosition(i),i.addScaledVector(r,t.near+n),a.copy(this.matrixWorld).invert(),i.applyMatrix4(a),o.set(r.x,r.y,r.z,0),o.applyMatrix4(a),r.copy(o),r.normalize(),l.setFromNormalAndCoplanarPoint(r,i),this.clipPlane.equals(l)||(this.clipPlane=l.clone(),this._updateVertices(),this._updateIndices())}};lt(An,"_corners",[[-1,-1,-1,0,4,8],[1,-1,-1,0,5,9],[1,1,-1,1,5,10],[-1,1,-1,1,4,11],[-1,-1,1,2,6,8],[1,-1,1,2,7,9],[1,1,1,3,7,10],[-1,1,1,3,6,11]]),lt(An,"_edges",[[0,1,0,-1,-1],[2,3,0,1,-1],[4,5,0,-1,1],[6,7,0,1,1],[0,3,-1,0,-1],[1,2,1,0,-1],[4,7,-1,0,1],[5,6,1,0,1],[0,4,-1,-1,0],[1,5,1,-1,0],[2,6,-1,1,0],[3,7,1,1,0]]),lt(An,"_edgeIntersections",function(){const t=[];for(let n=0;n<12;++n)t.push(new b.Vector3);return t}()),lt(An,"_nearClipPlaneOffset",.2),lt(An,"_pos",new b.Vector3),lt(An,"_norm",new b.Vector3),lt(An,"_norm4D",new b.Vector4),lt(An,"_matrixWorldToLocal",new b.Matrix4),lt(An,"_clipPlane",new b.Plane);let hg=An;const q6=hg;function $6(s){const e=s.length,t=new Float32Array(e*3);for(let n=0;n<e;++n){const i=3*n,r=s[n];t[i]=r.x,t[i+1]=r.y,t[i+2]=r.z}return t}const lf=class lf{constructor(e,t){const{delta:n}=t,{obtuseAngle:i}=t,r=new b.Vector3;e.getSize(r),r.multiplyScalar(.5);const o=this._getBaseVertices(n,i),a=new b.BufferGeometry,l=[];for(let p=0;p<4;p++)l.push(o[p].clone().multiply(r)),l.push(o[(p+1)%4].clone().multiply(r));const h=new b.Vector3(2*r.x*(1-n.x-n.y),0,0);for(let p=0;p<8;p++)l.push(l[p].clone().add(h));for(let p=0;p<4;p++)l.push(l[p*2].clone()),l.push(l[p*2+8].clone());const u=new b.Vector3;e.getCenter(u),l.forEach(p=>p.add(u));const f=$6(l);a.setAttribute("position",new b.BufferAttribute(f,3)),this._lines=new b.LineSegments(a,new b.LineBasicMaterial({color:16777215})),this._lines.layers.set(yt.LAYERS.VOLUME)}_getBaseVertices(e,t){const n=lf._projectionTable,i=(o,a)=>{const l=e[n[o][0]];return(-.5*(a-1)+a*t[n[o][1]])*l};return[new b.Vector3(-1+2*(i("XZ",1)+i("XY",1)),-1+2*i("YZ",1),-1),new b.Vector3(-1+2*(i("XZ",-1)+i("XY",1)),-1+2*i("YZ",-1),1),new b.Vector3(-1+2*(i("XZ",-1)+i("XY",-1)),1-2*i("YZ",1),1),new b.Vector3(-1+2*(i("XZ",1)+i("XY",-1)),1-2*i("YZ",-1),-1)]}getMesh(){return this._lines}};lt(lf,"_projectionTable",{XY:["x",2],XZ:["y",1],YZ:["z",0]});let ug=lf;const Z6=ug;class K6{constructor(e,t,n){const i=this._initPlaneGeo(t,n),r=new nf.BackFacePosMaterialFarPlane;this._plane=new sr.Mesh(i,r),this._plane.frustumCulled=!1,this._plane.doubleSided=!0;const o=new b.Matrix4;this._plane._onBeforeRender=function(a,l,h,u,f,p){const{material:m}=this;if(!e||!m)return;const g=new b.Vector4(0,0,-(h.far-.1),1);g.applyMatrix4(h.matrixWorld),this.matrix.identity(),this.matrix.makeTranslation(g.x,g.y,g.z),this.matrixWorld.copy(this.matrix),this.modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,this.matrixWorld),this.normalMatrix.getNormalMatrix(this.modelViewMatrix);const v=e.matrixWorld;o.copy(v).invert(),m.uniforms.aspectRatio.value=h.aspect,m.uniforms.farZ.value=h.far,m.uniforms.tanHalfFOV.value=Math.tan(b.MathUtils.DEG2RAD*.5*h.fov),m.uniforms.matWorld2Volume.value=o},this._plane.layers.set(yt.LAYERS.VOLUME_BFPLANE)}_initPlaneGeo(e,t){const n=new b.BufferGeometry;e=e||1,t=t||1;const i=new Float32Array([-.5*e,.5*t,0,.5*e,.5*t,0,-.5*e,-.5*t,0,.5*e,-.5*t,0]);return n.setAttribute("position",new b.BufferAttribute(i,3)),n.setIndex([0,2,1,2,3,1]),n}getMesh(){return this._plane}}const J6=K6;class Q6 extends sh{constructor(e,t){super(e,t),this._mesh=new q6,this._mesh.setDataSource(t),this.add(this._mesh),this._frame=new Z6(this.getBoundaries().boundingBox,this._mesh.volumeInfo),this.add(this._frame.getMesh()),this.showFrame(pe.now.modes.VD.frame),this._farPlane=new J6(this._mesh,2,2),this.add(this._farPlane.getMesh())}getBoundaries(){const e=this._dataSource.getBox(),t=new b.Sphere;return e.getBoundingSphere(t),{boundingBox:e,boundingSphere:t}}getMesh(){return this._mesh}showFrame(e){this._frame.getMesh().material.visible=e}}const D_=Q6;class e8 extends aa{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];super(e,["types"])}find(e){let t=[];if(e.type)t=this._dict.types[e.type.toLowerCase()]||[];else if(e.source)return this._list.filter(n=>n.canProbablyLoad&&n.canProbablyLoad(e.source));return[...t]}}const t8=e8;class Uf extends Yi{constructor(e,t){super(),this._source=e,this._options=t||{},this._abort=!1,this._agent=null}load(){return Promise.reject(new Error("Loading from this source is not implemented"))}abort(){this._abort=!0,this._agent&&this._agent.abort()}static extractName(e){}}Ah(Uf.prototype);class ME extends Uf{constructor(e,t){super(e,t),t=this._options,this._binary=t.binary===!0}load(){return new Promise((e,t)=>{if(this._abort)throw new Error("Loading aborted");const n=this._source,i=this._agent=new FileReader;i.addEventListener("load",()=>{e(i.result)}),i.addEventListener("error",()=>{t(i.error)}),i.addEventListener("abort",()=>{t(new Error("Loading aborted"))}),i.addEventListener("progress",r=>{this.dispatchEvent(r)}),this._binary?i.readAsArrayBuffer(n):i.readAsText(n)})}static canProbablyLoad(e){return File&&e instanceof File||Blob&&e instanceof Blob}static extractName(e){return e&&e.name}}ME.types=["file","blob"];const n8=/^(https?|ftp):\/\//i;class EE extends Uf{constructor(e,t){super(e,t),t=this._options,this._binary=t.binary===!0}load(){return new Promise((e,t)=>{if(this._abort)throw new Error("Loading aborted");const n=this._source,i=this._agent=new XMLHttpRequest;i.addEventListener("load",()=>{i.status===200?e(i.response):t(new Error(`HTTP ${i.status} while fetching ${n}`))}),i.addEventListener("error",()=>{t(new Error("HTTP request failed"))}),i.addEventListener("abort",()=>{t(new Error("Loading aborted"))}),i.addEventListener("progress",r=>{this.dispatchEvent(r)}),i.open("GET",n),this._binary?i.responseType="arraybuffer":i.responseType="text",i.send()})}static canProbablyLoad(e){return Me.default.isString(e)&&n8.test(e)}static extractName(e){if(e){const t=(e.indexOf("?")+1||e.lastIndexOf("#")+1||e.length+1)-1;return e.slice(e.lastIndexOf("/",t)+1,t)}}}EE.types=["url"];class AE extends Uf{load(){return new Promise(e=>{if(this._abort)throw new Error("Loading aborted");e(this._source)})}static canProbablyLoad(e){return!1}}AE.types=["immediate"];const i8=new t8([ME,EE,AE]);class r8 extends aa{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];super(e,["formats","extensions"])}find(e){let t=[];return e.format?t=this._dict.formats[e.format.toLowerCase()]||[]:e.ext&&(t=this._dict.extensions[e.ext.toLowerCase()]||[]),t.length===0&&!e.format&&e.data?this._list.filter(n=>n.canProbablyParse&&n.canProbablyParse(e.data)):[...t]}}const s8=r8;class Wi{constructor(e,t){this._data=e,this._options=t||{},this._abort=!1}parseSync(){throw new Error("Parsing this type of data is not implemented")}parse(){return new Promise((e,t)=>{setTimeout(()=>{try{return this._abort?t(new Error("Parsing aborted")):e(this.parseSync())}catch(n){return t(n)}})})}getModel(){return this.model._parseHeader(this._data),this.model}abort(){this._abort=!0}}Ah(Wi.prototype);class TE{constructor(){this.matrices=[],this._matrix=null,this._matrixIndex=-1}parse(e){let t=this._matrix;if(e.readString(12,18)==="  SMTRY"){const n=e.readCharCode(19)-49,i=e.readString(20,80).trim().split(/\s+/),r=parseInt(i[0],10);(this._matrix===null||r!==this._matrixIndex)&&(this._matrixIndex=r,this._matrix=t=new b.Matrix4,this.matrices[this.matrices.length]=t);const{elements:o}=t;o[n]=parseFloat(i[1]),o[n+4]=parseFloat(i[2]),o[n+8]=parseFloat(i[3]),o[n+12]=parseFloat(i[4])}}}TE.prototype.id=290;const o8=TE,{Assembly:a8}=On;class CE{constructor(e){this._complex=e,this.assemblies=[],this._assembly=null,this._matrix=null,this._matrixIndex=-1}parse(e){let t=this._assembly,n=this._matrix;if(t&&e.readString(12,18)==="  BIOMT"){const i=e.readCharCode(19)-49,r=e.readString(20,80).trim().split(/\s+/),o=parseInt(r[0],10);(this._matrix===null||o!==this._matrixIndex)&&(this._matrixIndex=o,this._matrix=n=new b.Matrix4,t.addMatrix(n));const{elements:a}=n;a[i]=parseFloat(r[1]),a[i+4]=parseFloat(r[2]),a[i+8]=parseFloat(r[3]),a[i+12]=parseFloat(r[4])}else if(t&&e.readString(35,41)==="CHAINS:"){const i=e.readString(42,80).split(",");for(let r=0,o=i.length;r<o;++r){const a=i[r].trim();a.length>0&&t.addChain(a)}}else e.readString(12,23)==="BIOMOLECULE:"&&(this._matrix=null,this._matrixIndex=-1,this._assembly=t=new a8(this._complex),this.assemblies.push(t))}}CE.prototype.id=350;const l8=CE;class c8{constructor(e){this._data=e,this._start=0,this._nextCR=-1,this._nextLF=-1,this._next=-1,this._end=e.length,this.next()}readLine(){return this._data.slice(this._start,this._next)}readChar(e){return e=this._start+e-1,e<this._next?this._data[e]:" "}readCharCode(e){return e=this._start+e-1,e<this._next?this._data.charCodeAt(e):32}readString(e,t){const n=this._start+e-1,i=this._start+t;return this._data.slice(n,i<this._next?i:this._next)}readInt(e,t){return parseInt(this.readString(e,t),10)}readFloat(e,t){return parseFloat(this.readString(e,t))}end(){return this._start>=this._end}next(){const e=this._next+1;this._start=e<this._end?e:this._end,this._start>this._nextCR&&(this._nextCR=(this._data.indexOf("\r",this._start)+1||this._end+1)-1),this._start>this._nextLF&&(this._nextLF=(this._data.indexOf(`
`,this._start)+1||this._end+1)-1),this._next=this._nextCR+1<this._nextLF?this._nextCR:this._nextLF}}const RE=c8,{Complex:h8,Element:XS,Helix:u8,Sheet:d8,Strand:f8,Bond:Fd,Molecule:p8}=On,m8=6;function g8(s){const e=s.trim().length===4;return s.slice(0,e?1:2).trim()}const _8=/^(HEADER\s|COMPND\s|REMARK\s|ATOM {2}|HETATM|MODEL )/i,x8={290:o8,350:l8},hn=class hn extends Wi{constructor(e,t){super(e,t),this._complex=null,this._chain=null,this._residue=null,this._sheet=null,this._serialAtomMap=null,this._modelId=1,this._compaundFound=!1,this._biomoleculeFound=!1,this._allowedChainsIDs=null,this._lastMolId=-1,this._remarks={},this._remark=null,this._molecules=[],this._molecule=null,this._compndCurrToken="",this._options.fileType="pdb"}static canProbablyParse(e){return Me.default.isString(e)&&_8.test(e)}_finalize(){this._fixBondsArray(),this._fixChains();const e=this._remarks[290];this._complex.symmetry=Me.default.isUndefined(e)?[]:e.matrices;const t=this._remarks[350];this._complex.units=this._complex.units.concat(Me.default.isUndefined(t)?[]:t.assemblies),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}_finalizeMolecules(){const e={};let t;const n=this._complex._chains;for(t=0;t<n.length;++t){const i=n[t],r=i._name;e[r]=i}for(t=0;t<this._molecules.length;t++){const i=this._molecules[t];let r=[];for(let a=0;a<i._chains.length;a++){const l=i._chains[a],h=e[l];r=r.concat(h._residues.slice())}const o=new p8(this._complex,i._name,t+1);o.residues=r,this._complex._molecules[t]=o}}_fixChains(){const e={},t=this._complex;for(let n=0;n<t._chains.length;n++){const i=t._chains[n];e[i._name.charCodeAt(0)]=i}}_fixBondsArray(){const e=this._serialAtomMap={},t=this._complex,n=t._atoms;for(let o=0,a=n.length;o<a;++o){const l=n[o];e[l.serial]=l}const i=t._bonds,{logger:r}=this;for(let o=0,a=i.length;o<a;++o){const l=i[o];l._right<l._left&&r.debug("_fixBondsArray: Logic error."),l._left=e[l._left]||null,l._right=e[l._right]||null}}_parseATOM(e){if(this._modelId!==1)return;const t=e.readCharCode(1)===72,n=t?e.readInt(7,11):e.readInt(6,11);let i=e.readString(13,16);const r=e.readChar(17),o=e.readString(18,20).trim(),a=e.readChar(22),l=e.readInt(23,26),h=e.readChar(27),u=e.readFloat(31,38),f=e.readFloat(39,46),p=e.readFloat(47,54),m=e.readFloat(55,60),g=e.readFloat(61,66),v=e.readString(77,78).trim()||g8(i),y=e.readInt(79,80)||0;if(this.settings.now.nowater&&(o==="HOH"||o==="WAT"))return;i=i.trim();const x=XS.getByName(v),w=XS.Role[i];let S=this._chain;(!S||S.getName()!==a)&&(this._chain=S=this._complex.getChain(a)||this._complex.addChain(a),this._residue=null);let E=this._residue;(!E||E.getSequence()!==l||E.getICode()!==h)&&(this._residue=E=S.addResidue(o,l,h));const A=new b.Vector3(u,f,p);E.addAtom(i,x,A,w,t,n,r,m,g,y)}_parseENDMDL(){this._modelId+=1}_parseCONECT(e){const t=e.readInt(7,11),n=e.readInt(12,16),i=e.readInt(17,21),r=e.readInt(22,26),o=e.readInt(27,31),a=this._complex;n&&n>t&&a.addBond(t,n,0,Fd.BondType.UNKNOWN,!0),i&&i>t&&a.addBond(t,i,0,Fd.BondType.UNKNOWN,!0),r&&r>t&&a.addBond(t,r,0,Fd.BondType.UNKNOWN,!0),o&&o>t&&a.addBond(t,o,0,Fd.BondType.UNKNOWN,!0)}_parseCOMPND(e){const t=e.readString(11,80),n=t.indexOf(":");if(this._compndCurrToken=n>0?t.substring(0,n).trim():this._compndCurrToken,this._compndCurrToken==="MOL_ID")this._molecule={_index:"",_chains:[]},this._molecule._index=parseInt(t.substring(n+1,t.indexOf(";")),10),this._molecules.push(this._molecule);else if(this._compndCurrToken==="MOLECULE"&&this._molecule!=null)this._molecule._name=t.substring(n+1,t.indexOf(";")).trim();else if(this._compndCurrToken==="CHAIN"&&this._molecule!=null){let i=t.substring(n+1,80).trim();const r=i[i.length-1];(r===";"||r===",")&&(i=i.slice(0,-1)),i=i.replace(/\s+/g,"");const o=i.split(",");this._molecule._chains=this._molecule._chains.concat(o)}}_parseREMARK(e){const t=e.readInt(8,10);let n=this._remarks[t];if(Me.default.isUndefined(n)){const i=x8[t];Me.default.isFunction(i)&&(this._remarks[t]=n=new i(this._complex))}Me.default.isUndefined(n)||n.parse(e)}_parseHELIX(e){const t=[20,22,32,34];this._parseSTRUCTURE(e,t,n=>{this._complex.addHelix(n),this._complex.structures.push(n)})}_parseSHEET(e){const t=[22,23,33,34];this._parseSTRUCTURE(e,t,n=>{this._complex.addSheet(n)})}_parseSTRUCTURE(e,t,n){const h=e.readInt(8,10),u=e.readString(12,14).trim(),f=e.readString(41,70).trim(),p=e.readInt(72,76),m=e.readInt(39,40),g=e.readInt(15,16),v=e.readInt(42,45),y=e.readInt(57,60),x=e.readString(t[0],t[2]+1).charCodeAt(0),w=e.readString(t[2],t[2]+1).charCodeAt(0),S=e.readInt(t[1],t[1]+3);let E=e.readString(t[1]+4,t[1]+4),A=0;E.length>0&&(A=E.charCodeAt(0));const C=e.readInt(t[3],t[3]+3);E=e.readString(t[3]+4,t[3]+4);let P=0;E.length>0&&(P=E.charCodeAt(0));let L,T=this._sheet;if(e.readCharCode(1)===83){T!==null&&T.getName()!==u&&(T=null,this._sheet=null),T===null?(this._sheet=L=new d8(u,g),n(L)):L=T;const R=new f8(L,this._complex.getUnifiedSerial(x,S,A),this._complex.getUnifiedSerial(w,C,P),m,v,y);L.addStrand(R),this._complex.structures.push(R)}else L=new u8(m,this._complex.getUnifiedSerial(x,S,A),this._complex.getUnifiedSerial(w,C,P),h,u,f,p),n(L)}_parseHEADER(e){const{metadata:t}=this._complex;t.classification=e.readString(11,50).trim(),t.date=e.readString(51,59).trim();const n=e.readString(63,66).trim();t.id=n,n&&(this._complex.name=n),t.format="pdb"}_parseTITLE(e){const{metadata:t}=this._complex;t.title=t.title||[];const n=e.readInt(9,10)||1;t.title[n-1]=e.readString(11,80).trim()}parseSync(){const e=new RE(this._data),t=this._complex=new h8;for(;!e.end();){const n=e.readString(1,m8),i=hn.tagParsers[n];Me.default.isFunction(i)&&i.call(this,e),e.next()}if(this._finalize(),this._serialAtomMap=null,this._sheet=null,this._residue=null,this._chain=null,this._complex=null,t.getAtomCount()===0)throw new Error("The data does not contain valid atoms");return t}};lt(hn,"tagParsers",{HEADER:hn.prototype._parseHEADER,"TITLE ":hn.prototype._parseTITLE,"ATOM  ":hn.prototype._parseATOM,HETATM:hn.prototype._parseATOM,ENDMDL:hn.prototype._parseENDMDL,CONECT:hn.prototype._parseCONECT,COMPND:hn.prototype._parseCOMPND,REMARK:hn.prototype._parseREMARK,"HELIX ":hn.prototype._parseHELIX,"SHEET ":hn.prototype._parseSHEET,"ATOM 1":hn.prototype._parseATOM,"ATOM 2":hn.prototype._parseATOM,"ATOM 3":hn.prototype._parseATOM,"ATOM 4":hn.prototype._parseATOM,"ATOM 5":hn.prototype._parseATOM,"ATOM 6":hn.prototype._parseATOM,"ATOM 7":hn.prototype._parseATOM,"ATOM 8":hn.prototype._parseATOM,"ATOM 9":hn.prototype._parseATOM});let lh=hn;lh.formats=["pdb"];lh.extensions=[".pdb",".ent"];const y8=lh,{Complex:e0,Element:al,SGroup:v8,Bond:YS}=On,S8={A:0,S:1,D:2,T:3},b8=/\s*<\?xml\b[^?>]*\?>\s*<(?:cml|molecule)\b/i;class U_ extends Wi{constructor(e,t){super(e,t),this._complex=null,this._residue=null,this._serialAtomMap=null,this._modelId=1,this._lastMolId=-1,this._readOnlyOneMolecule=!1,this._options.fileType="cml"}static canProbablyParse(e){return Me.default.isString(e)&&b8.test(e)}_rebuidBondIndexes(e,t){const n=e.length;for(let i=0;i<n;i++){const r=e[i].id,o=t.length;for(let a=0;a<o;a++){const l=t[a].atomRefs2.split(" ");l[0]===r&&(t[a].start=i),l[1]===r&&(t[a].end=i)}}}_createSGroup(e,t){const n=new v8(e.id,e.fieldData,new b.Vector3(parseFloat(e.x),parseFloat(e.y),0),e.atomRefs,e);e.placement==="Relative"&&(n._center=new b.Vector3(0,0,0)),e.fieldName==="MDLBG_FRAGMENT_CHARGE"&&(n._charge=parseInt(e.fieldData,10)||0),e.fieldName==="MDLBG_FRAGMENT_COEFFICIENT"&&(n._repeat=parseInt(e.fieldData,10)||1),t.push(n)}_extractSGroup(e,t){if(Array.isArray(t)||(t=[]),e)if(Array.isArray(e)){const n=e.length;for(let i=0;i<n;i++)e[i].molecule&&(t=t.concat(this._extractSGroup(e[i].molecule))),this._createSGroup(e[i],t)}else e.molecule&&e.molecule&&(t=t.concat(this._extractSGroup(e.molecule))),this._createSGroup(e,t);return t}_extractSGroups(e,t){const n=this._extractSGroup(e),i=t.length;let r,o;for(r=0;r<i;r++){const v=t[r].id;for(o=0;o<n.length;o++)n[o]._atoms.split(" ")[0]===v&&(t[r].sgroupRef||(t[r].sgroupRef=[]),t[r].sgroupRef.push(n[o]))}let a={},l=null;const h=1e8,u=new b.Vector3(h,h,h),f=new b.Vector3(-h,-h,-h);function p(v){l=a[v],l&&n[o]._atoms.push(l.a)}function m(v){l=a[v],l&&(u.set(Math.min(u.x,l.x),Math.min(u.y,l.y),Math.min(u.z,l.z)),f.set(Math.max(f.x,l.x),Math.max(f.y,l.y),Math.max(f.z,l.z)),p(v))}for(r=0;r<t.length;r++)a[t[r].id]={},a[t[r].id].x=t[r].x2,t[r].x3&&(a[t[r].id].x=t[r].x3),a[t[r].id].x=parseFloat(a[t[r].id].x),a[t[r].id].y=t[r].y2,t[r].y3&&(a[t[r].id].y=t[r].y3),a[t[r].id].y=parseFloat(a[t[r].id].y),a[t[r].id].z="0.0",t[r].z3&&(a[t[r].id].z=t[r].z3),a[t[r].id].z=parseFloat(a[t[r].id].z),a[t[r].id].a=t[r];let g;for(o=0;o<n.length;o++)n[o]._center!==null?(u.set(h,h,h),f.set(-h,-h,-h),g=n[o]._atoms.split(" "),n[o]._atoms=[],g.forEach(m),n[o]._center.addVectors(u,f),n[o]._center.multiplyScalar(.5)):(g=n[o]._atoms.split(" "),n[o]._atoms=[],g.forEach(p));a=null}_traverseData(e){function t(r){return Object.prototype.toString.apply(r)==="[object Array]"}function n(r,o){if(r.nodeName==="#text"&&r.nodeValue.trim()==="")return;const a={};a.xmlNode=r;const l=o[r.nodeName];l?t(l)?o[r.nodeName].push(a):o[r.nodeName]=[l,a]:o[r.nodeName]=a;let h,u;if(r.attributes)for({length:h}=r.attributes,u=0;u<h;u++){const f=r.attributes[u];a[f.nodeName]=f.nodeValue}for({length:h}=r.childNodes,u=0;u<h;u++)n(r.childNodes[u],a)}const i={};return e.childNodes.length&&n(e.childNodes[0],i),i}_findSuitableMolecule(e,t){for(const n in e)if(n!=="xmlNode")if(n==="molecule"){if(e.molecule&&(e.molecule.atomArray&&e.molecule.atomArray.atom&&t.push(e),Array.isArray(e.molecule)))for(let i=0;i<e.molecule.length;i++)e.molecule[i].atomArray&&e.molecule[i].atomArray.atom&&t.push({molecule:e.molecule[i]})}else e[n]&&e[n]!==null&&typeof e[n]=="object"&&this._findSuitableMolecule(e[n],t)}_selectComponents(e){const n=new DOMParser().parseFromString(e,"application/xml"),i=this._traverseData(n);let r;const o=this;function a(u){let f=[];if(u.molecule&&u.molecule.atomArray&&u.molecule.atomArray.atom)Array.isArray(u.molecule.atomArray.atom)?f=u.molecule.atomArray.atom:f.push(u.molecule.atomArray.atom);else if(!u.molecule){const S={};return S.atomLabels=null,S.labelsCount=1,S}u.molecule.molecule&&o._extractSGroups(u.molecule.molecule,f);let p,m=f.length;for(let S=0;S<m;S++)p=f[S],p.edges=[];let g=[];u.molecule.bondArray&&u.molecule.bondArray.bond&&(Array.isArray(u.molecule.bondArray.bond)?g=u.molecule.bondArray.bond:g.push(u.molecule.bondArray.bond));let v;m=g.length,o._rebuidBondIndexes(f,g);function y(S){return v=g[S],p=f[v.start],!p||(p.edges.push(v.end),p=f[v.end],!p)?!1:(p.edges.push(v.start),!0)}for(let S=0;S<m;S++){if(!y(S))continue;const E=v.xmlNode.getAttribute("order"),A=parseInt(E,10);if(g[S].order=0,g[S].type=YS.BondType.UNKNOWN,A>1)g[S].order=A;else{const C=S8[E];C!==void 0&&(g[S].order=C,E==="A"&&(g[S].type=YS.BondType.AROMATIC))}}m=f.length;for(let S=0;S<m;S++)p=f[S],p.edges.sort();const x=o._breadWidthSearch(f,0),w={};return w.atoms=f,w.bonds=g,w.labels=x.atomLabels,w.count=Math.min(1,x.labelsCount),w.curr=-1,w.originalCML=n,w}i.cml?r=i.cml:r=i;const l=[],h=[];return this._findSuitableMolecule(r,h),this._readOnlyOneMolecule&&h.length>1&&h.splice(1,h.length-1),h.forEach(u=>{const f=a(u);f.atoms.length>0&&l.push(f)}),l}_packLabel(e,t){return(t<<16)+e}_unpackLabel(e){return{molId:e>>>16,compId:e&65535}}_breadWidthSearch(e,t){const n=new Array(e.length);let i;for(i=0;i<n.length;i++)n[i]=this._packLabel(0,t);const r=[];let o=0,a=e.length;for(;a>0;){o++;let h=-1;for(i=0;i<n.length;i++)if(this._unpackLabel(n[i]).compId===0){h=i;break}if(h<0)break;for(r.push(e[h]),n[h]=this._packLabel(o,t),a--;r.length>0;){const u=r.shift();if(u)for(let f=0;f<u.edges.length;f++)n[u.edges[f]]!==o&&(r.push(e[u.edges[f]]),n[u.edges[f]]=o,a--)}}const l={};return l.atomLabels=n,l.labelsCount=o,l}_parseBond(e,t,n,i){if(e>=0){const r=[Math.min(e,t),Math.max(e,t)];this._complex.addBond(r[0],r[1],n,i,!0)}}_fixBondsArray(){const e=this._serialAtomMap={},t=this._complex,n=t._atoms;for(let o=0,a=n.length;o<a;++o){const l=n[o];e[l.serial]=l}const i=t._bonds,{logger:r}=this;for(let o=0,a=i.length;o<a;++o){const l=i[o];l._right<l._left&&r.debug("_fixBondsArray: Logic error."),l._left=e[l._left]||null,l._right=e[l._right]||null}}_parseSet(e){const t=this._complex=new e0,n=e,i=n.curr,{atoms:r,labels:o}=n;let a=null,l,h;const u=r.length;function f(g){g.xmlNodeRef=a,a.x2&&(a.x3=a.x2,delete a.x2),a.y2&&(a.y3=a.y2,delete a.y2),a.z3||(a.z3="0.0"),a.complexAtom=g}let p={};const m=[];for(l=0;l<u;l++)m.push(l);for(m.sort((g,v)=>o[g]-o[v]),l=0;l<u;l++){const v=o[m[l]];if(this._unpackLabel(v).molId===this._unpackLabel(i).molId){a=r[m[l]];const y=a.elementType;if(a.sgroupRef){const x=a.sgroupRef.length;for(let w=0;w<x;++w)t._sgroups.push(a.sgroupRef[w])}if(a.x3||a.x2){const x=this._unpackLabel(v).compId,w=" ",S=x,E=" ";let A=x.toString();A.length===1&&(A=`0${A}`);const C=`N${A}`;let P=p[w];(!P||P.getName()!==w)&&(p[w]=P=this._complex.getChain(w)||this._complex.addChain(w),this._residue=null);let L=this._residue;(!L||L.getSequence()!==S||L.getICode()!==E)&&(this._residue=L=P.addResidue(C,S,E));let T=null;a.x3?T=new b.Vector3(parseFloat(a.x3),parseFloat(a.y3),parseFloat(a.z3)):a.x2&&(T=new b.Vector3(parseFloat(a.x2),parseFloat(a.y2),0));let R=al.ByName[a.elementType.toUpperCase()];R||(R=JSON.parse(JSON.stringify(al.ByName[Object.keys(al.ByName)[Object.keys(al.ByName).length-1]])),R.number+=1,R.name=a.elementType.toUpperCase(),R.fullName="Unknown",al.ByName[a.elementType.toUpperCase()]=R);const G=parseInt(a.id.replace(/[^0-9]/,""),10),K=L.addAtom(y,R,T,al.Role.SG,!0,G," ",1,0,0);a.hydrogenCount&&(K.hydrogenCount=parseInt(a.hydrogenCount,10)),a.mrvValence&&(K.valence=parseInt(a.mrvValence,10)),f(K)}}}for(p=null,l=0;l<n.bonds.length;l++){const g=n.bonds[l];if(this._unpackLabel(o[g.start]).molId===this._unpackLabel(i).molId&&this._unpackLabel(o[g.end]).molId===this._unpackLabel(i).molId){if(a=r[g.start],!a||!r[g.end])continue;this._parseBond(parseInt(a.id.replace(/[^0-9]/,""),10),parseInt(r[g.end].id.replace(/[^0-9]/,""),10),g.order,g.type)}}for(l=0;l<this._complex.getSGroupCount();l++){const g=this._complex.getSGroups()[l];for(h=0;h<g._atoms.length;h++)g._atoms[h]=g._atoms[h].complexAtom}for(l=0;l<u;l++)this._unpackLabel(o[l]).molId===this._unpackLabel(i).molId&&(a=r[l],a.complexAtom=null,delete a.complexAtom);return this._complex.originalCML=n.originalCML,this._fixBondsArray(),t.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._serialAtomMap=null,this._complex=null,t}parseSync(){const e=[],t=this;this._selectComponents(this._data).forEach(r=>{r.curr=2,r.count===0&&(r.count=1);for(let o=0;o<r.count;o++)r.curr=o+1,e.push(t._parseSet(r,!1))});let i=0;if(e.forEach(r=>{i+=r.getAtomCount()}),i<=0)throw new Error("The data does not contain valid atoms");if(e.length>1){const r=new e0;return r.joinComplexes(e),r.originalCML=e[0].originalCML,r}return e.length===1?e[0]:new e0}}U_.formats=["cml"];U_.extensions=[".cml"];const w8=U_;var M8=Ai(660),jS=Ai.n(M8);const{Complex:E8,Chain:A8,Atom:T8,Element:qS,Helix:C8,Sheet:R8,Strand:P8,Bond:I8,Assembly:L8,Molecule:N8}=On;class dg{constructor(e){this._original=Array.from(e),this._original.sort(),this._sum=0;for(let t=0;t<this._original.length;++t)this._sum+=this._original[t]}compare(e){const t=e.length;if(t!==this._original.length)return!1;let n=0,i;for(i=0;i<t;++i)n+=e[i];if(n!==this._sum)return!1;const r=Array.from(e);for(r.sort(),i=0;i<t;++i)if(r[i]!==this._original[i])return!1;return!0}}dg.prototype.constructor=dg;const qs=Hi.Type,F8=[qs.HELIX_PI,qs.BEND,qs.HELIX_ALPHA,qs.STRAND,qs.HELIX_310,qs.BRIDGE,qs.TURN,qs.COIL];function O8(s){return new Uint8Array(s,0,1)[0]}class Bf extends Wi{constructor(e,t){super(e,t),this._options.fileType="mmtf"}static canProbablyParse(e){return Me.default.isArrayBuffer(e)&&(O8(e)|1)===223}_onModel(e){}_onChain(e){if(e.modelIndex!==0)return;const t=new A8(this._complex,e.chainName);this._complex._chains[e.chainIndex]=t,t._index=e.chainIndex}_onGroup(e){if(e.modelIndex!==0||this.settings.now.nowater&&(e.groupName==="HOH"||e.groupName==="WAT"))return;const t=this._complex._chains[e.chainIndex],n=e.insCode.charCodeAt(0)?e.insCode:"",i=t.addResidue(e.groupName,e.groupId,n);i._index=e.groupIndex,this._updateSecStructure(this._complex,i,e)}_onAtom(e){if(e.modelIndex!==0)return;const t=e.altLoc.charCodeAt(0)?e.altLoc:"",n=new T8(e.groupIndex,e.atomName,qS.getByName(e.element.toUpperCase()),new b.Vector3(e.xCoord,e.yCoord,e.zCoord),qS.Role[e.atomName],!1,e.atomId,t,e.occupancy,e.bFactor,e.formalCharge);this._complex._atoms[e.atomIndex]=n,n.index=e.atomIndex,this._serialAtomMap[e.atomId]=n}_onBond(e){const t=Math.max(e.atomIndex1,e.atomIndex2);if(t>=this._complex._atoms.length)return;const n=Math.min(e.atomIndex1,e.atomIndex2);this._complex.addBond(this._complex._atoms[n],this._complex._atoms[t],e.bondOrder,I8.BondType.UNKNOWN,!0)}_updateSecStructure(e,t,n){const i=[3,-1,1,-1,5];if(!Me.default.isUndefined(n)&&n.secStruct===this._ssType){t._secondary=this._ssStruct,this._ssStruct&&(this._ssStruct.term=t);return}if(!Me.default.isUndefined(n)){const r=F8[n.secStruct];this._ssType=n.secStruct,this._ssStart=t;let o=null;switch(this._ssType){case-1:case 7:break;case 0:case 2:case 4:o=new C8(i[this._ssType],t,t,0,"","",0),e._helices.push(o);break;case 3:{const a=new R8("",0);e._sheets.push(a),o=new P8(a,t,t,0,null,null);break}default:r!==void 0&&(o=new Hi(r,t,t));break}this._ssStruct=o,t._secondary=o,o&&e.structures.push(o)}}_updateMolecules(e){const t=e.entityList;if(!t)return;const n=e.chainsPerModel[0];for(let i=0;i<t.length;i++){const r=t[i],o=r.chainIndexList;let a=[];for(let h=0;h<o.length;h++){const u=o[h];if(u>=n)continue;const f=this._complex._chains[u];a=a.concat(f._residues.slice())}const l=new N8(this._complex,r.description,i+1);l.residues=a,this._complex._molecules[i]=l}}_traverse(e){const t=this,{metadata:n}=this._complex;n.id=e.structureId,n.title=[],n.title[0]=e.title,n.date=e.releaseDate,n.format="mmtf";const i={onModel(r){t._onModel(r)},onChain(r){t._onChain(r)},onGroup(r){t._onGroup(r)},onAtom(r){t._onAtom(r)},onBond(r){t._onBond(r)}};this._ssType=-1,this._ssStruct=null,this._ssStart=null,jS().traverse(e,i),this._updateSecStructure(this._complex),this._updateMolecules(e)}_linkAtomsToResidues(){for(let e=0;e<this._complex._atoms.length;++e){const t=this._complex._atoms[e],n=this._complex._residues[t.residue];t.residue=n,n._atoms.push(t)}}_findSynonymousChains(){const e={};for(let t=0;t<this._complex._chains.length;++t){const n=this._complex._chains[t],i=n.getName();e.hasOwnProperty(i)||(e[i]=[]),e[i].push(n._index)}return e}_parseAssemblyInfo(e){let t,n,i;const r=[],{logger:o}=this;for(t=0;t<e.bioAssemblyList.length;++t){const a=e.bioAssemblyList[t];if(a.transformList.length===0)continue;const l=a.transformList[0].chainIndexList,h=new dg(l),u={};for(n=0;n<l.length;++n)u[this._complex._chains[l[n]].getName()]=1;const f=[];let p;for(p in u)u.hasOwnProperty(p)&&Array.prototype.push.apply(f,this._chainsByName[p]);h.compare(f)||o.debug("MMTF: Assembly is missing some of the synonymous chains. Skipping...");const m=new L8(this._complex);for(p in u)u.hasOwnProperty(p)&&m.addChain(p);for(m.addMatrix(new b.Matrix4().fromArray(a.transformList[0].matrix).transpose()),n=1;n<a.transformList.length;++n){const g=a.transformList[n];if(!h.compare(g.chainIndexList)){o.debug("MMTF: Chain lists differ for different transforms in one assembly. Skipping...");continue}const v=new b.Matrix4().fromArray(g.matrix).transpose();for(i=0;i<m.matrices.length&&!m.matrices[i].equals(v);++i);i===m.matrices.length&&m.addMatrix(v)}m.finalize(),r.push(m)}return r}_markHeteroAtoms(e){const t=e.chainsPerModel[0];for(let n=0;n<e.entityList.length;++n){const i=e.entityList[n];if(i.type!=="polymer")for(let r=0;r<i.chainIndexList.length;++r){const o=i.chainIndexList[r];if(o>=t)continue;const a=this._complex._chains[o];for(let l=0;l<a._residues.length;++l){const h=a._residues[l];for(let u=0;u<h._atoms.length;++u)h._atoms[u].het=!0}}}}_joinSynonymousChains(){let e,t;const n=[],i={};for(e=0;e<this._complex._chains.length;++e){const r=this._complex._chains[e],o=r.getName();if(!i.hasOwnProperty(o)){i[o]=r,r._index=n.length,n.push(r);continue}const a=i[o];for(t=0;t<r._residues.length;++t){const l=r._residues[t];a._residues.push(l),l._chain=a}}this._complex._chains=n}parseSync(){const e=jS().decode(this._data);return this._complex=new E8,this._serialAtomMap={},this._traverse(e),this._linkAtomsToResidues(),this._markHeteroAtoms(e),this._chainsByName=this._findSynonymousChains(),Array.prototype.push.apply(this._complex.units,this._parseAssemblyInfo(e)),this._joinSynonymousChains(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex}}Bf.formats=["mmtf"];Bf.extensions=[".mmtf"];Bf.binary=!0;const D8=Bf;class B_ extends Error{constructor(e,t,n){super(`data:${t}:${n}: ${e}`),Error.captureStackTrace&&Error.captureStackTrace(this,B_),this.name="ParsingError",this.parseLine=t,this.parseColumn=n}}const _r=B_;function Oo(s){return s===32||s===10||s===13||s===9}function t0(s,e,t){const n=e.length;let i=-1;for(;t<n&&(i=e.charCodeAt(t),!(i===s||i===10));)++t;return i===s?t:-1}function U8(s){let e=0,t=0;const n=s.length;let i=NaN,r=!0,o=1,a=1,l,h=0;const u={};let f={},p=[],m=0,g="",v=[],y=0,x;function w(){let A;if((i===46||i===63)&&(e+1>=n||Oo(s.charCodeAt(e+1)))){++a,++e;return}if(r&&i===59){t=e;let P=0;do{if(t=t0(10,s,t+1),t===-1)throw new _r("Unterminated text block found",o,a);++P}while(t+1<n&&s.charCodeAt(t+1)!==i||t+1>=n);return A=s.substring(e+1,t).replace(/\r/g,""),e=t+2,o+=P,a=1,r=!1,A}if(i===39||i===34){t=e;do if(t=t0(i,s,t+1),t===-1)throw new _r("Unterminated quoted string found",o,a);while(t+1<n&&!Oo(s.charCodeAt(t+1)));return A=s.substring(e+1,t),a+=t-e+1,e=t+1,A}for(t=e;t<n&&!Oo(s.charCodeAt(t));)++t;A=s.substring(e,t),a+=t-e,e=t;const C=Number(A);return Number.isNaN(C)?A:C}function S(A){p[m++]=A}function E(A){const C=y%m;return v[C].push(A),++y,A}for(;e<=n;){if(i=s.charCodeAt(e),i!==13)if(i===10)r=!0,++o,a=1;else{if(!(i===32||i===9))if(i===35){if(e=t0(10,s,e+1),e===-1)break;continue}else if(h===0)if((i===68||i===100)&&s.substr(e+1,4).toLowerCase()==="ata_"){for(t=e+5,l=t;t<n&&!Oo(s.charCodeAt(t));)++t;if(a+=t-e,e=t,l<e){u[s.substring(l,e)]=f={},h=1;continue}else throw new _r("Data block name missing",o,a)}else{if(Number.isNaN(i))break;throw new _r(`Unexpected character in state ${h}`,o,a)}else if(h===1)if((i===68||i===100)&&s.substr(e+1,4).toLowerCase()==="ata_"){h=0;continue}else if(i===95){for(t=e+1,l=t;t<n&&!Oo(s.charCodeAt(t));)++t;if(a+=t-e,e=t,l<e){g=s.substring(l,e),h=2;continue}else throw new _r("Tag name missing",o,a)}else if((i===76||i===108)&&s.substr(e+1,4).toLowerCase()==="oop_"){if(e+=5,a+=5,e<n&&!Oo(s.charCodeAt(e)))throw new _r(`Unexpected character in state ${h}`,o,a);p=[],m=0,v=[],y=0,h=3;continue}else{if(Number.isNaN(i))break;throw new _r(`Unexpected character in state ${h}`,o,a)}else if(h===2){if(Number.isNaN(i))break;x=w(),Me.default.set(f,g,x),h=1;continue}else if(h===3)if(i===95){for(t=e+1,l=t;t<n&&!Oo(s.charCodeAt(t));)++t;if(a+=t-e,e=t,l<e){S(s.substring(l,e));continue}else throw new _r("Tag name missing",o,a)}else{if(m>0){for(let A=0;A<m;++A)x=[],v[A]=x,Me.default.set(f,p[A],x);h=4;continue}throw new _r("Data tags are missing inside a loop",o,a)}else if(h===4){(i===68||i===100)&&s.substr(e+1,4).toLowerCase()==="ata_"?h=0:i===95||(i===76||i===108)&&s.substr(e+1,4).toLowerCase()==="oop_"?h=1:Number.isNaN(i)?h=0:E(w());continue}else throw new _r(`Unexpected internal state ${h}`,o,a);r=!1,++a}++e}if(h===2)throw new _r(`Unexpected end of file in state ${h}`,o,a);return u}const{Complex:B8,Element:$S,Helix:z8,Sheet:V8,Strand:k8,Assembly:G8,Molecule:H8}=On,n0=["auth_seq_id","Cartn_x","Cartn_y","Cartn_z","label_atom_id"],W8={helx:"helix",turn:"turn",strn:"strand"};function X8(s){const e=/[A-Za-z]+/.exec(s);return e?W8[e[0].toLowerCase()]:null}function Ct(s){return s==null||Me.default.isArray(s)?s:[s]}function Y8(s){const e=s.trim().length===4;return s.slice(0,e?1:2).trim()}class ZS extends Error{constructor(e){super(),this.name="AtomDataError",this.message=e}}function j8(s){if(!s)return null;const e=Ct(s.id),{matrix:t,vector:n}=s;if(!e||!t||!n)return null;const i=[];for(let r=0,o=e.length;r<o;++r){const a=new b.Matrix4,{elements:l}=a;for(let h=0;h<3;++h){const u=t[h+1];l[h]=Ct(u[1])[r],l[h+4]=Ct(u[2])[r],l[h+8]=Ct(u[3])[r],l[h+12]=Ct(n[h+1])[r]}i[e[r]]=a}return i}function q8(s,e){s=Me.default.isString(s)?s:`${s}`;const n=s.replace(/\)\s*\(/g,"!").replace(/[()']/g,"").split("!"),i=[];for(let l=0,h=n.length;l<h;++l){const u=n[l].split(","),f=[];let p=0;for(let m=0,g=u.length;m<g;++m){const v=u[m];if(v.includes("-")){const y=v.split("-");let x=parseInt(y[0],10);const w=parseInt(y[1],10);for(;x<=w;++x)f[p++]=e[x]}else f[p++]=e[v]}i.push(f)}const r=[];let o=0;function a(l,h){for(let u=0,f=i[l].length;u<f;++u){const p=h?h.clone():new b.Matrix4;p.multiplyMatrices(i[l][u],p),l===0?r[o++]=p:a(l-1,p)}}return a(i.length-1),r}class z_ extends Wi{constructor(e,t){super(e,t),this.asymDict={},this.molecules=[],this._options.fileType="cif"}static canProbablyParse(e){return Me.default.isString(e)&&/^\s*data_/i.test(e)}parseSync(){this.logger.info("Parsing CIF file..");const e=U8(this._data);return this._toComplex(e)}_toComplex(e){const t=new B8,n=e[Object.keys(e)[0]];return this._extractAtoms(t,n),this._extractSecondary(t,n),this._extractAssemblies(t,n),this._extractMolecules(t,n),this._extractMetadata(t,n),t.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing}),t}_extractMetadata(e,t){const{metadata:n}=e;n.id=t.entry.id,n.classification=t.struct_keywords.pdbx_keywords;const i=t.database_PDB_rev;n.date=i&&i.date_original?i.date_original:"",n.format="cif",n.title=[],n.title[0]=t.struct.title}_extractMolecules(e,t){const n=t.entity,i=Ct(n.pdbx_description),r=i.length;let o;for(o=0;o<r;o++)this.molecules[o]?this.molecules[o].name=i[o]:this.molecules[o]={name:i[o],residues:[]};const a=e.getMolecules();for(o=0;o<r;o++){const l=this.molecules[o];a[o]=new H8(e,l.name,o+1),a[o].residues=l.residues}}_extractAtoms(e,t){const n=t.atom_site;if(!n)throw new ZS("CIF parsing error: atom_site is not specified!");for(let R=0,G=n0.length;R<G;++R)if(!n[n0[R]])throw new ZS(`CIF parsing error: requires field ${n0[R]} not found!`);const{asymDict:i}=this,r=Ct(n.auth_seq_id),o=Ct(n.Cartn_x),a=Ct(n.Cartn_y),l=Ct(n.Cartn_z),h=Ct(n.label_atom_id),u=h.length,f=Ct(n.group_PDB)||[],p=Ct(n.auth_asym_id)||[],m=Ct(n.label_asym_id)||[],g=Ct(n.id)||[],v=Ct(n.pdbx_PDB_ins_code)||[],y=Ct(n.label_comp_id)||[],x=Ct(n.type_symbol)||[],w=Ct(n.B_iso_or_equiv)||[],S=Ct(n.occupancy)||[],E=Ct(n.pdbx_formal_charge)||[],A=Ct(n.label_alt_id)||[],C=Ct(n.pdbx_PDB_model_num)||[],P=Ct(n.label_entity_id)||[];let L=null,T=null;for(let R=0;R<u;++R){if((C[R]||1)!==1)continue;const K=String(p[R]||" ");(!L||L.getName()!==K)&&(L=e.getChain(K)||e.addChain(K)),i[String(m[R]||" ")]=K;const Z=r[R],O=String(v[R]||" "),V=String(y[R]||"");if(!T||T.getSequence()!==Z||T.getICode()!==O){T=L.addResidue(V,Z,O);const ke=P[R]-1;let Ye=this.molecules[ke];Ye||(this.molecules[ke]={name:"",residues:[]},Ye=this.molecules[ke]),Ye.residues.push(T)}const j=h[R],q=x[R]||Y8(j),J=$S.getByName(q),se=$S.Role[j.trim()],_e=new b.Vector3(o[R],a[R],l[R]),Re=f[R]==="HETATM"||!1,ae=g[R]||R,ve=w[R]||0,oe=S[R]||0,Ce=String(A[R]||""),Ie=E[R]||0;T.addAtom(j,J,_e,se,Re,ae,Ce,oe,ve,Ie)}}_extractSecondary(e,t){t.struct_conf&&this._extractConfs(e,t.struct_conf),t.struct_sheet_range&&this._extractSheets(e,t.struct_sheet_range)}_extractSheets(e,t){const{asymDict:n}=this;if(!t.sheet_id||!t.id||!t.beg_label_seq_id||!t.end_label_seq_id||!t.beg_label_asym_id)return;const i=e._sheets;function r(m){const g=i.length;for(let v=0;v<g;++v)if(i[v]._name===m)return i[v];return i[g]=new V8(m,0),i[g]}const o=Ct(t.sheet_id),a=Ct(t.id),l=Ct(t.beg_auth_seq_id),h=Ct(t.end_auth_seq_id),u=Ct(t.beg_label_asym_id),f=Ct(t.pdbx_beg_PDB_ins_code)||[],p=Ct(t.pdbx_end_PDB_ins_code)||[];for(let m=0,g=a.length;m<g;++m){const v=e.getChain(n[u[m]]),y=r(o[m]),x=l[m],w=h[m],S=f[m]||" ",E=p[m]||" ",A=v.findResidue(x,S),C=v.findResidue(w,E);if(!A||!C)continue;const P=new k8(y,A[0],C[0],0,null,null),L=v.getResidues();for(let T=A[1];T<=C[1];++T)L[T]._secondary=P;y.addStrand(P),e.structures.push(P)}}_extractConfs(e,t){const{asymDict:n}=this;if(!t.conf_type_id||!t.beg_label_seq_id||!t.end_label_seq_id||!t.beg_label_asym_id)return;const i=Ct(t.conf_type_id),r=Ct(t.beg_auth_seq_id),o=Ct(t.pdbx_beg_PDB_ins_code)||[],a=Ct(t.end_auth_seq_id),l=Ct(t.pdbx_end_PDB_ins_code)||[],h=Ct(t.details)||[],u=Ct(t.pdbx_PDB_helix_length)||[],f=Ct(t.pdbx_PDB_helix_class)||[],p=Ct(t.id)||[],m=Ct(t.beg_label_asym_id);for(let g=0,v=i.length;g<v;++g){const y=X8(i[g]);if(!y)continue;const x=p[g]||i[g],w=e.getChain(n[m[g]]),S=r[g],E=a[g],A=o[g]||" ",C=l[g]||" ",P=w.findResidue(S,A),L=w.findResidue(E,C);if(!P||!L)continue;const T=h[g]||"",R=u[g]||0,G=f[g]||" ";let K;if(y==="helix"){const O=e._helices.length;K=new z8(G,P[0],L[0],O,x,T,R),e.addHelix(K),e.structures.push(K)}else y==="turn"?(K=new Hi(Hi.Type.TURN,P[0],L[0]),e.structures.push(K)):K=null;if(!K)continue;const Z=w.getResidues();for(let O=P[1];O<=L[1];++O)Z[O]._secondary=K}}_extractAssemblies(e,t){const{asymDict:n}=this,i=t.pdbx_struct_assembly_gen;if(!i)return;const r=Ct(i.assembly_id),o=Ct(i.oper_expression),a=Ct(i.asym_id_list);if(!r||!o||!a)return;const l=j8(t.pdbx_struct_oper_list);if(l)for(let h=0,u=r.length;h<u;++h){const f=new G8(e),p=q8(o[h],l),m=a[h].split(",");for(let g=0,v=m.length;g<v;++g){const y=m[g].trim();y.length>0&&f.addChain(n[y])}f.matrices=p,e.units.push(f)}}}z_.formats=["cif","mmcif"];z_.extensions=[".cif",".mmcif"];const $8=z_,Xt={singular:0,vector:1,array:2,buffer:3};class Z8{constructor(){lt(this,"_xyz2crs",[]);lt(this,"_origin",new b.Vector3(0,0,0));this._header={},this._boxSize=new b.Vector3,this._boxStart=new b.Vector3,this._header.delta={},this._header.extent=[],this._header.nstart=[],this._header.grid=[],this._header.crs2xyz=[],this._header.cellDims=new b.Vector3,this._header.angles=[],this._header.origin=new b.Vector3(0,0,0),this._header.dmin=0,this._header.dmean=0,this._header.dmax=0}_typedCheck(){if(Me.default.isTypedArray(this._buff))this._buff=this._buff.buffer;else if(!Me.default.isArrayBuffer(this._buff))throw new TypeError("Expected ArrayBuffer or TypedArray")}_fillHeader(e,t){for(const n in e)if(e.hasOwnProperty(n))switch(e[n][0]){case Xt.singular:this._header[n]=t[e[n][1]][e[n][2]];break;case Xt.array:this._parseArray(this._header[n],t[e[n][1]],e[n][2]);break;case Xt.vector:this._parseVector(this._header[n],t[e[n][1]],e[n][2]);break;case Xt.buffer:this._header[n]=new Uint8Array(t[e[n][1]],[e[n][2]]*4,[e[n][3]]*4);break}}_parseVector(e,t,n){[e.x,e.y,e.z]=[t[n],t[n+1],t[n+2]]}_parseArray(e,t,n){e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}_parseHeader(e){}_setAxisIndices(){}_setOrigins(){}_getAxis(){const e=this._header,t=e.cellDims.x/e.grid[0],n=e.cellDims.y/e.grid[1],i=e.cellDims.z/e.grid[2],[r,o,a]=e.angles,l=Math.cos(o),h=(Math.cos(r)-Math.cos(o)*Math.cos(a))/Math.sin(a),u=Math.sqrt(1-l*l-h*h),f=new b.Vector3(t,0,0),p=new b.Vector3(Math.cos(a)*n,Math.sin(a)*n,0),m=new b.Vector3(l*i,h*i,u*i);return[f,p,m]}_getXYZdim(){return[this._header.extent[this._xyz2crs[0]],this._header.extent[this._xyz2crs[1]],this._header.extent[this._xyz2crs[2]]]}_getVolumeInfo(){const e=Me.default.pick(this._header,["dmean","dmin","dmax","sd","delta"]);return e.obtuseAngle=this._header.angles.map(t=>+(t>=Math.PI/2)),e}_setBoxParams(e,t,n){let i=0,r=0;const[o,a,l]=this._header.angles;l>=Math.PI/2&&(i+=Math.abs(t.x)),a>=Math.PI/2&&(i+=Math.abs(n.x)),o>=Math.PI/2&&(r+=Math.abs(n.y)),this._boxStart=new b.Vector3(this._origin.x-i,this._origin.y-r,this._origin.z),this._boxSize=new b.Vector3(Math.abs(e.x)+Math.abs(t.x)+Math.abs(n.x),Math.abs(t.y)+Math.abs(n.y),Math.abs(n.z));const h=(u,f)=>Math.abs(u[f])/this._boxSize[f];this._header.delta.x=h(t,"x"),this._header.delta.y=h(n,"x"),this._header.delta.z=h(n,"y")}_getXYZbox(){return new b.Box3(this._boxStart.clone(),this._boxStart.clone().add(this._boxSize))}_toXYZData(){}parse(e){return this._parseHeader(e),this._setOrigins(),new XM(Float32Array,this._getXYZdim(),this._getXYZbox(),1,this._toXYZData(),this._getVolumeInfo())}}const PE=Z8,K8={extent:[Xt.array,"u32",0],type:[Xt.singular,"u32",3],nstart:[Xt.array,"i32",4],grid:[Xt.array,"u32",7],cellDims:[Xt.vector,"f32",10],angles:[Xt.array,"f32",13],crs2xyz:[Xt.array,"i32",16],dmin:[Xt.singular,"f32",19],dmax:[Xt.singular,"f32",20],dmean:[Xt.singular,"f32",21],ispg:[Xt.singular,"u32",22],nsymbt:[Xt.singular,"u32",23],lksflg:[Xt.singular,"u32",24],customData:[Xt.buffer,"buffer",25,9],origin:[Xt.vector,"f32",34],map:[Xt.buffer,"buffer",52,1],machine:[Xt.singular,"u32",53],sd:[Xt.singular,"f32",54],nlabel:[Xt.singular,"f32",55],label:[Xt.buffer,"buffer",56,200]};class J8 extends PE{_parseHeader(e){this._buff=e,this._typedCheck();const t={};t.u32=new Uint32Array(this._buff,0,56),t.i32=new Int32Array(this._buff,0,56),t.f32=new Float32Array(this._buff,0,56),t.buffer=this._buff;const n=this._header;this._fillHeader(K8,t),n.angles.forEach((i,r,o)=>{o[r]*=Math.PI/180})}_setAxisIndices(){const e=this._header;e.cellDims.x===0&&e.cellDims.y===0&&e.cellDims.z===0&&e.cellDims.set(1,1,1);const{crs2xyz:t}=this._header;t[0]===0&&t[1]===0&&t[2]===0&&(t[0]=1,t[1]=2,t[2]=3);const n=this._xyz2crs;n[t[0]-1]=0,n[t[1]-1]=1,n[t[2]-1]=2}_setOrigins(){const[e,t,n]=this._getAxis();this._setAxisIndices();const i=this._header,r=this._xyz2crs;if(i.origin.x===0&&i.origin.y===0&&i.origin.z===0?(this._origin.addScaledVector(e,i.nstart[r[0]]),this._origin.addScaledVector(t,i.nstart[r[1]]),this._origin.addScaledVector(n,i.nstart[r[2]])):this._origin=i.origin,e.multiplyScalar(i.extent[r[0]]-1),t.multiplyScalar(i.extent[r[1]]-1),n.multiplyScalar(i.extent[r[2]]-1),i.type===2)this._data=new Float32Array(this._buff,1024+i.nsymbt,i.extent[0]*i.extent[1]*i.extent[2]);else throw new Error(`CCP4: Unsupported format ${i.type}`);this._setBoxParams(e,t,n)}_toXYZData(){const e=this._header,t=this._data,n=this._xyz2crs,i=new Float32Array(t.length),r=this._getXYZdim(),o=r[0],a=r[1];let l=0;const h=[];let u,f,p;for(h[2]=0;h[2]<e.extent[2];h[2]++)for(h[1]=0;h[1]<e.extent[1];h[1]++)for(h[0]=0;h[0]<e.extent[0];h[0]++,l++)u=h[n[0]],f=h[n[1]],p=h[n[2]],i[u+o*(f+a*p)]=t[l];return i}}class zf extends Wi{constructor(e,t){super(e,t),this._options.fileType="ccp4",this.model=new J8}static canProbablyParse(e){return!1}parseSync(){return this.model.parse(this._data)}}zf.formats=["ccp4"];zf.extensions=[".ccp4",".map",".mrc"];zf.binary=!0;const Q8=zf,{Complex:eG,Element:tG,Molecule:nG}=On;class fg extends Wi{constructor(e,t){super(e,t),this._complex=null,this._atomsInf=null,this._options.fileType="xyz",this._fileName=t.name}static canProbablyParse(e){return Me.default.isString(e)&&/^\s*\d+ *\n[^\n]*\n\s*\w{1,3}\s+-?\d/.test(e)}_parseToAtomsInf(e){const t=e.indexOf(`
`),n=parseInt(e.substring(0,t),10),i=e.indexOf(`
`,t+1);let r=e.slice(t+1,i).trim();r.length===0&&(r=this._fileName);const o=i+e.substring(i).search(/\S/);if(this._atomsInf=e.substring(o).split(/[\s,]*\n[\s,]*/),!Number.isNaN(n)&&this._atomsInf.length-1!==n){this._complex.error={message:"wrong number of atoms"};return}this._complex.metadata.format="xyz",this._complex.name=r}_parseAtomsInf(){const t=" ",a=this._complex.addChain("A").addResidue("UNK",1," ");for(let h=0;h<this._atomsInf.length-1;h++){const u=this._atomsInf[h].split(/[\s,]+/);if(u.length!==4){this._complex.error={message:"missed parameters"};break}const f=h+1,p=u[0],m=new b.Vector3(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])),g=tG.getByName(p);a.addAtom(p,g,m,void 0,!0,f,t,1,1,0)}const l=new nG(this._complex,this._complex.name,1);l.residues=a,this._complex._molecules[0]=l}parseSync(){const e=this._complex=new eG;if(this._parseToAtomsInf(this._data),this._parseAtomsInf(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex=null,this._atomsInf=null,e.error)throw new Error(e.error.message);return e}}lt(fg,"formats",["xyz"]),lt(fg,"extensions",[".xyz"]);const iG=fg,{Complex:rG,Element:sG}=On;class V_ extends Wi{constructor(e,t){super(e,t),this._options.fileType="pubchem+json"}static canProbablyParse(e){return Me.default.isString(e)&&e[0]==="{"}parseSync(){return this.logger.info("Parsing PubChem JSON file..."),this._toComplex(JSON.parse(this._data))}_toComplex(e){const t=new rG,n=e.PC_Compounds&&e.PC_Compounds[0];return n&&(this._extractAtoms(t,n),t.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing})),t}_extractAtoms(e,t){let n=t.atoms&&t.atoms.aid,i=n&&t.atoms.element;if(!i||n.length!==i.length)throw new Error("Unable to parse atom elements");i=Me.default.fromPairs(Me.default.zip(n,i));const r={},o=t.coords&&t.coords[0],a=o&&o.conformers&&o.conformers[0],l=a&&a.x,h=a&&a.y,u=a&&a.z||[];if(n=o&&o.aid,!n||!l||!h)throw new Error("Coordinates are not found in the file");const p=e.addChain(" ").addResidue("UNK",1," ");for(let y=0,x=n.length;y<x;++y){const w=n[y],S=sG.ByAtomicNumber[i[w]],E=new b.Vector3(l[y],h[y],u[y]||0);r[w]=p.addAtom(S.name,S,E,void 0,!0,w," ",1,0,0)}const m=t.bonds&&t.bonds.aid1,g=t.bonds&&t.bonds.aid2,v=t.bonds&&t.bonds.order||[];if(!(!m||!g||m.length!==g.length))for(let y=0,x=m.length;y<x;++y)e.addBond(r[m[y]],r[g[y]],v[y]||1,0,!0)}}V_.formats=["pubchem","pubchem+json","pc"];V_.extensions=[".json"];const oG=V_;class aG{constructor(e){this._strings=e.split(/\r?\n|\r/),this._currentStart=0,this._currentStringIndx=0}setStart(e){e>=this._strings.length?(this._currentStart=this._strings.length-1,this._currentStringIndx=this._strings.length-1):(this._currentStart=e,this._currentStringIndx=e)}getNextString(){return this._strings[++this._currentStringIndx]}getCurrentString(){return this._strings[this._currentStringIndx]}getStringFromStart(e){return this._currentStringIndx=this._currentStart+e,this._strings[this._currentStart+e]}findNextDataItem(){let e=this.getNextString(),t=!1;for(;!Me.default.isUndefined(e)&&e.trim()!=="$$$$";){if(e.match(/>\s+<(.*)>/)){t=!0;break}e=this.getNextString()}return t}findNextCompoundStart(){let e=this.getCurrentString();for(;!Me.default.isUndefined(e)&&e.trim()!=="$$$$";)e=this.getNextString();return this.setStart(++this._currentStringIndx),this.probablyHaveDataToParse()}probablyHaveDataToParse(){return this._currentStringIndx<this._strings.length-2}}const{Complex:lG,Element:cG,Bond:us,Molecule:hG}=On,uG=[0,3,2,1,0,-1,-2,-3],dG=[0,1,2,3,1,1,1,2],fG=[us.BondType.UNKNOWN,us.BondType.COVALENT,us.BondType.COVALENT,us.BondType.COVALENT,us.BondType.AROMATIC,us.BondType.UNKNOWN,us.BondType.AROMATIC,us.BondType.AROMATIC],pG=/.*(M\s\sEND).*|.*(^$$$$).*|.*>\s+<(.+)>.*/,mG=/.*($$$$).*|.*>\s+<(.+)>.*/,i0={SDF:"sdf",MOL:"mol"},gG=["PUBCHEM_IUPAC_TRADITIONAL_NAME",/PUBCHEM_(.+)_NAME/,/(.+)name/,/(.+)NAME/],_G=["PUBCHEM_COMPOUND_CID","id","ID",/.*CID/,/.*ID/,/.*id/],xG=["msg","MSG","message","title","description","desc"],r0=["name","id","title"],yG={name:gG,id:_G,title:xG};function vG(s){if(!s)return"A";const e=[];for(;s;)e.push(65+s%26),s=Math.trunc(s/26);return e.length>1&&(e.reverse(),e[0]-=1),String.fromCharCode(...e)}class k_ extends Wi{constructor(e,t){super(e,t),this._format="sdf",this._complex=null,this._chain=null,this._residue=null,this._molecules=null,this._metadata={},this._metadata.molecules=[],this._currentMolProps={},this._compoundIndx=-1,this._assemblies=[],this._atomsParsed=0,this._atomsIndexes=[]}canProbablyParse(e){return Me.default.isString(e)&&pG.test(e)}_parseHeader(e){const t={};t.name=e.getStringFromStart(0);const n=parseInt(e.getStringFromStart(1).substr(10,6).trim(),10);t.date=n.toString()||"",t.title=e.getStringFromStart(2),this._metadata.molecules.push(t)}_parseAtoms(e,t){let n,i=this._atomsParsed;const r=vG(this._compoundIndx),o="UNK",a=1;this._chain=this._complex.getChain(r)||this._complex.addChain(r),this._residue=this._chain.addResidue(o,a," ");for(let l=0;l<t;l++){n=e.getNextString(),i++;const h=parseFloat(n.substr(0,10)),u=parseFloat(n.substr(10,10)),f=parseFloat(n.substr(20,10)),p=uG[parseInt(n.substr(36,3),10)],m=new b.Vector3(h,u,f);let g=n.substr(31,3).trim().toUpperCase();const v=cG.getByName(g);this._atomsIndexes[g]||(this._atomsIndexes[g]=0),this._atomsIndexes[g]+=1,g+=this._atomsIndexes[g],this._residue.addAtom(g,v,m,void 0,!0,i," ",1,0,p)}}_parseBonds(e,t){let n;for(let i=0;i<t;i++){n=e.getNextString();let r=parseInt(n.substr(0,3),10)+this._atomsParsed,o=parseInt(n.substr(3,3),10)+this._atomsParsed;const a=parseInt(n.substr(6,3),10);r>o&&([r,o]=[o,r]),this._complex.addBond(r,o,dG[a]||1,fG[a]||us.BondType.UNKNOWN,!0)}}_parseMOL(e){this._compoundIndx++,this._parseHeader(e);const t=e.getStringFromStart(3),n=parseInt(t.substr(0,3),10),i=parseInt(t.substr(3,3),10);this._parseAtoms(e,n),this._parseBonds(e,i),this._atomsParsed+=n,this._metadata.molecules[this._compoundIndx]._residues=[],this._metadata.molecules[this._compoundIndx]._residues.push(this._residue)}_parseDataItem(e){const t=e.getCurrentString();let n=[],i=e.getNextString();for(;i.trim()!=="";)n.push(i),i=e.getNextString();n.length===1&&([n]=n),this._currentMolProps[t.replace(/[<>]/g,"").trim()]=n}_parseCompound(e){if(this._parseMOL(e),this._format===i0.SDF){for(this._currentMolProps={};e.findNextDataItem();)this._parseDataItem(e);if(Object.keys(this._currentMolProps).length!==0){const t=this._metadata.molecules[this._compoundIndx];t.props=this._currentMolProps,this._tryToUpdateMoleculeData(t)}}}_fixBondsArray(){const e=this._serialAtomMap,n=this._complex._bonds;for(let i=0;i<n.length;i++){const r=n[i];r._right<r._left&&console.log("_fixBondsArray: Logic error."),r._left=e[r._left]||null,r._right=e[r._right]||null}}_buildAssemblies(){const e=this._complex._chains;if(e.length===1)return this._assemblies;for(let t=0;t<e.length;t++){const n=new m_(this._complex),i=new b.Matrix4;n.addMatrix(i),n.addChain(e[t]._name),this._assemblies.push(n)}return this._assemblies}_buildMolecules(){this._complex._molecules=[];const{molecules:e}=this._metadata;for(let t=0;t<e.length;t++){const n=new hG(this._complex,e[t].name,t+1);n.residues=e[t]._residues,this._complex._molecules[t]=n}return this._complex._molecules}_searchTag(e,t){for(let n=0;n<t.length;n++)if(e instanceof RegExp&&e.test(t[n].tag)||e===t[n].tag)return t[n].data}_tryToFind(e,t){for(let n=0;n<e.length;n++){const i=this._searchTag(e[n],t);if(i)return i}}_tryToUpdateMoleculeData(e){let t=!1;for(let n=0;n<r0.length;n++){const i=yG[r0[n]],r=this._tryToFind(i,e.props);r&&(e[r0[n]]=r,t=!0)}return e.name=e.name||e.id,e.name.match(/^\d+$/)&&(e.name=`CID: ${e.name}`),t}_finalizeMetadata(){const{molecules:e}=this._metadata,{metadata:t}=this._complex,n=this._complex;if(e.length===1)n.name=e[0].name,t.title=e[0].title,t.date=e[0].date,t.properties=e[0].props;else if(e.length>1){t.molecules=[];for(let i=0;i<e.length;i++)t.molecules.push({name:e[i].name,date:e[i].date,title:e[i].title,properties:e[i].props})}}_finalize(){const e=this._serialAtomMap={},t=this._complex._atoms;for(let n=0;n<t.length;n++){const i=t[n];e[i.serial]=i}this._complex._finalizeBonds(),this._fixBondsArray(),this._finalizeMetadata(),this._buildAssemblies(),this._complex.units=this._complex.units.concat(this._assemblies),this._buildMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:!1,enableEditing:!1,serialAtomMap:this._serialAtomMap})}defineFormat(e){let t;return mG.test(e)?t=i0.SDF:t=i0.MOL,t}parseSync(){const e=this._complex=new lG,t=new aG(this._data);this._format=this.defineFormat(this._data),e.metadata.format=this._format;do this._parseCompound(t);while(t.findNextCompoundStart());return this._finalize(),e}}k_.formats=["mol","sdf"];k_.extensions=[".mol",".sdf"];const SG={nstart:[Xt.array,"i16",0],extent:[Xt.array,"i16",3],grid:[Xt.array,"i16",6],cellDims:[Xt.vector,"i16",9],angles:[Xt.array,"i16",12],div:[Xt.singular,"i16",15],adder:[Xt.singular,"i16",16],scaleFactor:[Xt.singular,"i16",17]};class bG extends PE{_parseHeader(e){this._buff=e,this._typedCheck();const t={};if(t.i16=new Int16Array(this._buff),t.i16[18]!==100)for(let i=0,r=t.i16.length;i<r;++i){const o=t.i16[i];t.i16[i]=(o&255)<<8|o>>8&255}if(t.i16[18]!==100)throw new Error("DSN6: Incorrect format ");const n=this._header;this._fillHeader(SG,t),n.cellDims.multiplyScalar(1/n.scaleFactor),n.angles.forEach((i,r,o)=>{o[r]*=Math.PI/180/n.scaleFactor}),n.div/=100}_setAxisIndices(){this._xyz2crs[0]=0,this._xyz2crs[1]=1,this._xyz2crs[2]=2}_setOrigins(){const e=this._header,[t,n,i]=this._getAxis();this._setAxisIndices(),this._origin.addScaledVector(t,e.nstart[0]),this._origin.addScaledVector(n,e.nstart[1]),this._origin.addScaledVector(i,e.nstart[2]),t.multiplyScalar(e.extent[0]),n.multiplyScalar(e.extent[1]),i.multiplyScalar(e.extent[2]),this._setBoxParams(t,n,i)}_pointCalculate(e,t,n,i,r,o,a){const l=this._header;if(r<l.extent[0]&&i<l.extent[1]&&n<l.extent[2]){const h=r+l.extent[0]*(i+l.extent[1]*n);e[h]=(t[o.counter]-l.adder)/l.div,++o.counter}else return o.counter+=8-a,!1;return!0}_blockCalculate(e,t,n,i,r,o){for(let a=0;a<8;++a){const l=8*n+a;for(let h=0;h<8;++h){const u=8*i+h;let f=!0,p=0;for(;f&&p<8;){const m=8*r+p;f=this._pointCalculate(e,t,l,u,m,o,p),p++}}}}_toXYZData(){const e=this._header,t=new Uint8Array(this._buff),n=new Float32Array(e.extent[0]*e.extent[1]*e.extent[2]),i=new b.Vector3(e.extent[0]/8,e.extent[1]/8,e.extent[2]/8),r={};r.counter=512;for(let o=0;o<i.z;++o)for(let a=0;a<i.y;++a)for(let l=0;l<i.x;++l)this._blockCalculate(n,t,o,a,l,r);return this._calculateInfoParams(n),n}_calculateInfoParams(e){this._header.dmean/=e.length;let t=0,n=e[0],i=e[0];for(let r=0;r<e.length;r++)t+=(this._header.dmean-e[r])**2,e[r]<n&&(n=e[r]),e[r]>i&&(i=e[r]);this._header.sd=Math.sqrt(t/e.length),this._header.dmax=i,this._header.dmin=n}}class Vf extends Wi{constructor(e,t){super(e,t),this._options.fileType="dsn6",this.model=new bG}static canParse(e,t){return e?e instanceof ArrayBuffer&&Wi.checkDataTypeOptions(t,"dsn6"):!1}static canProbablyParse(e){return!1}parseSync(){return this.model.parse(this._data)}}Vf.formats=["dsn6"];Vf.extensions=[".dsn6",".omap"];Vf.binary=!0;const wG=Vf;class MG extends RE{constructor(e){super(e),this._next=-1,this.next()}getNext(){return this._next}}const EG=MG,{Complex:AG,Element:KS,Molecule:TG}=On;class G_ extends Wi{constructor(e,t){super(e,t),this._time=null,this._numAtoms=null,this._residueNumber=null,this._residueName="",this._atomName="",this._atomNumber=null,this._atomPosition=[],this._atomVelocity=[],this._complex=null,this._molecules=[],this._molecule=null,this._options.filetype="gro"}canProbablyParse(e){return Me.default.isString(this._data)&&/^\s*[^\n]*\n\s*\d+ *\n\s*\d+[^\n\d]{3}\s*\w+\s*\d+\s*-?\d/.test(e)}_parseTitle(e){const{metadata:t}=this._complex;t.id=e.readLine().trim(),t.name=t.id.slice(t.id.lastIndexOf("\\")+1,t.id.lastIndexOf(".")),t.format="gro"}_parseNumberOfAtoms(e){if(this._numAtoms=e.readInt(0,e.getNext()),Number.isNaN(this._numAtoms))throw new Error("Line 2 is not representing atom number. Consider checking input file")}_parseAtom(e){this._residueNumber=e.readInt(1,5),this._residueName=e.readString(6,10).trim(),this._atomName=e.readString(11,15).trim(),this._atomNumber=e.readInt(16,20);const t=e.readFloat(21,28)*10,n=e.readFloat(29,36)*10,i=e.readFloat(37,45)*10;if(Number.isNaN(t)||Number.isNaN(n)||Number.isNaN(i)){this._complex.error={message:`Atom position is invalid in "${e.readLine()}"`};return}const r=KS.getByName(this._atomName[0]);if(r.fullName==="Unknown"){this._complex.error={message:`${this._atomName[0]} hasn't been recognised as an atom name.`};return}const o=KS.Role[this._atomName];let a=this._chain;a||(this._chain=a=this._complex.addChain("A"));let l=this._residue;(!l||l.getSequence()!==this._residueNumber)&&(this._residue=l=a.addResidue(this._residueName,this._residueNumber," ")),this._atomPosition=new b.Vector3(t,n,i),l.addAtom(this._atomName,r,this._atomPosition,o,!0,this._atomNumber," ",1,1,0)}_finalize(){const e=new TG(this._complex,this._complex.metadata.name,1);e.residues=this._chain._residues,e._chains=this._chain,this._complex._molecules[0]=e,this._molecules.push(e),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}parseSync(){const e=this._complex=new AG,t=new EG(this._data);let n=0;for(this._parseTitle(t),t.next(),this._parseNumberOfAtoms(t),t.next(),n=0;n<this._numAtoms&&!t.end();++n)this._parseAtom(t),t.next();if(n<this._numAtoms&&(this._complex.error={message:"File ended unexpectedly."}),e.error)throw new Error(e.error.message);return this._finalize(),this._atomPosition=null,this._complex=null,this._molecules=null,this._molecule=null,e}}G_.formats=["gro"];G_.extensions=[".gro"];const CG=G_,{Complex:RG,Element:JS,Bond:ds,Molecule:PG}=On,IG={un:0,1:1,2:2,3:3,ar:1,am:1,nc:0,du:1},LG={un:ds.BondType.UNKNOWN,1:ds.BondType.COVALENT,2:ds.BondType.COVALENT,3:ds.BondType.COVALENT,ar:ds.BondType.AROMATIC,am:ds.BondType.COVALENT,nc:ds.BondType.UNKNOWN,du:ds.BondType.COVALENT},NG=/\d+$/,IE=/\s+/;function QS(s){return s.trim().split(IE)}class H_ extends Wi{constructor(e,t){super(e,t),this._complex=null,this._chain=null,this._residue=null,this._compoundIndx=-1,this._molecules=[],this._molecule=null,this._currPosIdx=0,this._currStartIdx=0,this._serialAtomMap={},this._options.fileType="mol2"}_parseRawStrings(e){return e.split(/\r?\n|\r/)}_toStringFromStart(e,t){const n=this._currStartIdx+e;this._currPosIdx=n<t.length?n:this._currStartIdx}_toHeaderString(e,t){for(this._toStringFromStart(0,t);this._currPosIdx<t.length;){if(t[this._currPosIdx].match(`@<TRIPOS>${e}`))return;this._currPosIdx++}this._toStringFromStart(0,t)}_toStringFromHeader(e,t,n){this._toHeaderString(e,n);const i=this._currPosIdx+t;n[this._currPosIdx].match(`@<TRIPOS>${e}`)&&i<n.length&&(this._currPosIdx=i)}_setStart(e,t){e>=t.length?this._currStartIdx=this._currPosIdx=t.length-1:this._currStartIdx=this._currPosIdx=e}_probablyHaveDataToParse(e){return this._currPosIdx<e.length-2}_findNextCompoundStart(e){for(;this._currPosIdx<e.length&&e[this._currPosIdx].trim()!=="@<TRIPOS>MOLECULE>";)this._currPosIdx++;return this._setStart(++this._currPosIdx,e),this._probablyHaveDataToParse(e)}_parseMolecule(e){this._toHeaderString("MOLECULE",e);const{metadata:t}=this._complex;t.name=e[++this._currPosIdx],t.format="mol2",this._molecule={_index:"",_chains:[]},this._molecule._index=this._compoundIndx+1,this._molecules.push(this._molecule)}_parseAtoms(e,t){this._toHeaderString("ATOM",t);for(let n=0;n<e;n++){const i=QS(t[++this._currPosIdx]);if(i.length<6)throw new Error("MOL2 parsing error: Not enough information to create atom!");const r=parseInt(i[0],10),o=i[1],a=parseFloat(i[2]),l=parseFloat(i[3]),h=parseFloat(i[4]),u=i[5].split(".")[0].toUpperCase();let f=0;i.length>=9&&(f=parseFloat(i[8])||0);let p=this._chain;if(p||(this._chain=p=this._complex.getChain("A")||this._complex.addChain("A"),this._residue=null),!this._setResidue(i))continue;const m=!1,g=" ",v=1,y=0,x=JS.getByName(u),w=JS.Role[o],S=new b.Vector3(a,l,h);this._residue.addAtom(o,x,S,w,m,r,g,v,y,f)}}_setResidue(e){let t=1,n="UNK";if(e.length>=7&&(t=parseInt(e[6],10)),e.length>=8&&e[7]!=="<0>"&&(n=e[7].replace(NG,"")),this.settings.now.nowater&&(n==="HOH"||n==="WAT"))return!1;const i=this._residue,r=this._chain;return(!i||i.getSequence()!==t)&&(this._residue=r.addResidue(n,t,"A")),!0}_parseBonds(e,t){this._toHeaderString("BOND",t);for(let n=0;n<e;n++){const i=QS(t[++this._currPosIdx]);if(i.length<3)throw new Error("MOL2 parsing error: Missing information about bonds!");let r=parseInt(i[1],10),o=parseInt(i[2],10);const a=i[3];r>o&&([r,o]=[o,r]),this._complex.addBond(r,o,IG[a]||0,LG[a]||ds.BondType.UNKNOWN,!0)}}_fixSerialAtoms(){const e=this._complex._atoms;for(let t=0;t<e.length;t++){const n=e[t];this._serialAtomMap[n.serial]=n}}_fixBondsArray(){const e=this._serialAtomMap,t=this._complex;if(Object.keys(e).length===0)throw new Error("MOL2 parsing error: Missing atom information!");const n=t._bonds;for(let i=0;i<n.length;i++){const r=n[i];r._left=e[r._left]||null,r._right=e[r._right]||null}}_finalizeMolecules(){const e=this._complex._chains[0];this._complex._molecules=[];for(let t=0;t<this._molecules.length;t++){const n=this._molecules[t],i=e._residues,r=new PG(this._complex,n._name,t+1);r.residues=i,this._complex._molecules[t]=r}}_finalize(){this._complex._finalizeBonds(),this._fixSerialAtoms(),this._fixBondsArray(),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}_parseCompound(e){this._compoundIndx++,this._parseMolecule(e),this._toStringFromHeader("MOLECULE",2,e);const t=e[this._currPosIdx].trim().split(IE),n=t[0],i=t[1];this._parseAtoms(n,e),this._parseBonds(i,e)}parseSync(){const e=this._complex=new RG,t=this._parseRawStrings(this._data);do this._parseCompound(t);while(this._findNextCompoundStart(t));return this._finalize(),e}}H_.formats=["mol2"];H_.extensions=[".mol2",".ml2",".sy2"];const FG=H_,OG=new s8([y8,$8,D8,iG,w8,oG,k_,Q8,wG,CG,FG]);class DG extends aa{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];super(e,["formats"])}find(e){let t=[];return e.format&&(t=this._dict.formats[e.format.toLowerCase()]||[]),[...t]}}const UG=DG;class W_{constructor(e,t){this._source=e,this._options=t||{},this._abort=!1}exportSync(){throw new Error("Exporting to this source is not implemented")}export(){return new Promise((e,t)=>{setTimeout(()=>{try{return this._abort?t(new Error("Export aborted")):e(this.exportSync())}catch(n){return t(n)}})})}abort(){this._abort=!0}}Ah(W_.prototype);class BG{constructor(){this._resultArray=[],this._currentStr=-1,this._tag=null,this._fixedNumeration=!1,this._numeration=!1,this._tagStrNum=0}getResult(){return this.writeString(`
`,81,81),this._resultArray.join("")}_currentStrLength(){const e=this._resultArray[this._currentStr];return e?e.length:0}newTag(e,t){e?this._tag=e:this._tag=null,Me.default.isUndefined(t)?(this._numeration=!1,this._fixedNumeration=!1,this._tagStrNum=0):Me.default.isNumber(t)?(this._tagStrNum=t,this._numeration=!0,this._fixedNumeration=!0):Me.default.isBoolean(t)&&(this._tagStrNum=0,this._numeration=t,this._fixedNumeration=!1)}newString(e){this.writeString(`
`,81,81),this._currentStr++,this._resultArray.push(""),e?this.writeString(e,1,6):this._tag&&this.writeString(this._tag,1,6),this._numeration&&(this._fixedNumeration||this._tagStrNum++,this._tagStrNum!==1&&this.writeString(this._tagStrNum.toString(),10,8))}writeEntireString(e,t,n){t||(t=81);for(let i=0;i<e.length;i++)this._currentStrLength()===t&&i!==e.length-1&&(this.newString(),n&&this.writeString(n.tag,n.begin,n.end)),e[i]===`
`?this.newString():this.writeString(e[i])}writeString(e,t,n){let i=this._resultArray[this._currentStr],r;const o=i?i.length:0;if(Me.default.isUndefined(e))return;Me.default.isNumber(t)||(t=o+1),Me.default.isNumber(n)||(n=o+e.length),Me.default.isString(e)?r=e:r=e.toString();const a=t<n?n:t,l=t<n?t:n;if(r.length>Math.abs(t-n)+1&&(r=r.substr(0,Math.abs(t-n+1))),l>o+1)this._resultArray[this._currentStr]+=" ".repeat(l-o-1);else if(l<=o){const h=this._resultArray[this._currentStr];this._resultArray[this._currentStr]=h.slice(0,l-1)}if(n<t){const h=t-n+1;r=" ".repeat(h-r.length)+r}l===11&&this._numeration&&this._tagStrNum!==1&&(r=` ${r}`),this._resultArray[this._currentStr]+=r,i=this._resultArray[this._currentStr],a>i.length&&(this._resultArray[this._currentStr]+=" ".repeat(a-i.length))}writeBondsArray(e,t){const n=this._getSubArrays(e,4);for(let i=0;i<n.length;i++){this.newString(),this.writeString(t.serial,11,7);for(let r=0;r<n[i].length;r++){const o=n[i][r]._left.serial===t.serial?n[i][r]._right.serial:n[i][r]._left.serial;this.writeString(o,16+5*r,12+5*r)}}}_getSubArrays(e,t){const n=[];for(let i=0;i<e.length;i+=t)n.push(e.slice(i,i+t));return n}writeMatrix(e,t,n){for(let i=0;i<3;i++){this.newString(),this.writeString(n,14,18),this.writeString((i+1).toString(),19,19),this.writeString(t.toString(),23,20);for(let o=0;o<3;o++){const a=parseFloat(e.elements[i*4+o]).toFixed(6);this.writeString(a.toString(),33+o*10,24+o*10)}const r=parseFloat(e.elements[i*4+3]).toFixed(5);this.writeString(r.toString(),68,55)}}writeMatrices(e,t){if(!e)return;const n=new b.Matrix4;for(let i=0;i<e.length;i++)n.copy(e[i]).transpose(),this.writeMatrix(n,i+1,t)}}class X_ extends W_{constructor(e,t){super(e,t),this._tags=["HEADER","TITLE","COMPND","REMARK","HELIX","SHEET","ATOM and HETATM","CONECT"],this._result=null,this._tagExtractors={HEADER:this._extractHEADER,TITLE:this._extractTITLE,"ATOM and HETATM":this._extractATOM,CONECT:this._extractCONECT,COMPND:this._extractCOMPND,REMARK:this._extractREMARK,HELIX:this._extractHELIX,SHEET:this._extractSHEET},this._stringForRemark350=`COORDINATES FOR A COMPLETE MULTIMER REPRESENTING THE KNOWN
BIOLOGICALLY SIGNIFICANT OLIGOMERIZATION STATE OF THE
MOLECULE CAN BE GENERATED BY APPLYING BIOMT TRANSFORMATIONS
GIVEN BELOW.  BOTH NON-CRYSTALLOGRAPHIC AND
CRYSTALLOGRAPHIC OPERATIONS ARE GIVEN.`,this._stringForRemark290=`CRYSTALLOGRAPHIC SYMMETRY TRANSFORMATIONS
THE FOLLOWING TRANSFORMATIONS OPERATE ON THE ATOM/HETATM
RECORDS IN THIS ENTRY TO PRODUCE CRYSTALLOGRAPHICALLY
RELATED MOLECULES.`}exportSync(){const e=new BG;if(!this._source)return this._result;for(let t=0;t<this._tags.length;t++){const n=this._tags[t],i=this._tagExtractors[n];Me.default.isFunction(i)&&i.call(this,e)}return this._result=e.getResult(),this._result}_extractHEADER(e){if(!this._source.metadata)return;const{metadata:t}=this._source;e.newTag("HEADER"),e.newString(),t.classification&&e.writeString(t.classification,11,50),t.date&&e.writeString(t.date,51,59),t.id&&e.writeString(t.id,63,66)}_extractTITLE(e){if(!this._source.metadata)return;const{metadata:t}=this._source;if(t.title){e.newTag("TITLE",!0);for(let n=0;n<t.title.length;n++)e.newString(),e.writeString(t.title[n],11,80)}}_extractCONECT(e){if(!this._source._atoms)return;const t=this._source._atoms;e.newTag("CONECT");for(let n=0;n<t.length;n++){const i=t[n].bonds.filter(r=>r._fixed);i.length!==0&&e.writeBondsArray(i.reverse(),t[n])}}_extractSHEET(e){if(!this._source._sheets)return;e.newTag("SHEET");const t=this._source._sheets;for(let n=0;n<t.length;n++)if(t[n]._strands){const i=t[n]._strands;for(let r=0;r<i.length;r++)e.newString(),e.writeString(r+1,10,8),e.writeString(t[n]._name,14,12),e.writeString(i.length,16,15),e.writeString(i[r].init._type._name,18,20),e.writeString(i[r].init._chain._name,22,22),e.writeString(i[r].init._sequence,26,23),e.writeString(i[r].init._icode,27,27),e.writeString(i[r].term._type._name,29,31),e.writeString(i[r].init._chain._name,33,33),e.writeString(i[r].term._sequence,37,34),e.writeString(i[r].term._icode,38,38),e.writeString(i[r].sense,40,39)}}_extractHELIX(e){if(!this._source._helices)return;e.newTag("HELIX");const t=this._source._helices;for(let n=0;n<t.length;n++){const i=t[n],r=Me.default.invert(OM);e.newString(),e.writeString(i.serial,10,8),e.writeString(i.name,14,12),e.writeString(i.init._type._name,16,18),e.writeString(i.init._chain._name,20,20),e.writeString(i.init._sequence,25,22),e.writeString(i.init._icode,26,26),e.writeString(i.term._type._name,28,30),e.writeString(i.term._chain._name,32,32),e.writeString(i.term._sequence,37,34),e.writeString(i.term._icode,38,38),e.writeString(r[i.type],40,39),e.writeString(i.comment,41,70),e.writeString(i.length,76,72)}}_extractATOM(e){if(!this._source._atoms)return;const t=this._source._atoms;for(let n=0;n<t.length;n++){const i=t[n].het?"HETATM":"ATOM";e.newString(i);const r=t[n].element.name.length>1||t[n].name.length>3?13:14;e.writeString(t[n].serial,11,7),e.writeString(t[n].name,r,16),e.writeString(String.fromCharCode(t[n].location),17,17),e.writeString(t[n].residue._type._name,20,18),e.writeString(t[n].residue._chain._name,22,22),e.writeString(t[n].residue._sequence,26,23),e.writeString(t[n].residue._icode,27,27),e.writeString(t[n].position.x.toFixed(3),38,31),e.writeString(t[n].position.y.toFixed(3),46,39),e.writeString(t[n].position.z.toFixed(3),54,47),e.writeString(t[n].occupancy.toFixed(2),60,55),e.writeString(t[n].temperature.toFixed(2),66,61),e.writeString(t[n].element.name,78,77),t[n].charge&&e.writeString(t[n].charge,79,80)}}_extractCOMPND(e){if(!this._source._molecules)return;const t=this._source._molecules;e.newTag("COMPND",!0);for(let n=0;n<t.length;n++){const i=this._getMoleculeChains(t[n]);e.newString(),e.writeString(`MOL_ID: ${t[n].index};`,11,80),e.newString(),e.writeString(`MOLECULE: ${t[n].name};`,11,80),e.newString(),e.writeString("CHAIN: ",11,18);const r=`${i.join(", ")};`;e.writeEntireString(r,81)}}_extractREMARK(e){this._Remark290(e),this._Remark350(e)}_Remark290(e){if(this._source.symmetry&&this._source.symmetry.length!==0){const t=this._source.symmetry;e.newTag("REMARK",290),e.newString(),e.newString(),e.writeEntireString(this._stringForRemark290),e.writeMatrices(t,"SMTRY"),e.newString(),e.newString(),e.writeString("REMARK: NULL",11,80)}}_Remark350(e){if(!this._source.units)return;const{units:t}=this._source;let n=0;e.newTag("REMARK",350),e.newString(),e.newString(),e.writeEntireString(this._stringForRemark350);const i=t.filter(r=>r instanceof m_);for(let r=0;r<i.length;r++){e.newString(),e.newString(),n++,e.writeString(`BIOMOLECULE: ${n}`,11,80);const o=i[r].chains.join(", ");e.newString(),e.writeString("APPLY THE FOLLOWING TO CHAINS: "),e.writeEntireString(o,69,{tag:"AND CHAINS: ",begin:31,end:42});const{matrices:a}=i[r];e.writeMatrices(a,"BIOMT")}}_getMoleculeChains(e){function t(i){return i._chain._name}const n=e.residues.map(t);return n.filter((i,r)=>n.indexOf(i)===r)}}X_.formats=["pdb"];X_.SourceClass=y_;const ll=3,Cc=3,s0=4;function eb(s,e,t,n){t[n]=s[e],t[n+1]=s[e+1],t[n+2]=s[e+2]}function zG(s,e,t,n,i){t[n]=s[e],t[n+1]=s[e+1],t[n+2]=s[e+2],t[n+3]=i}const Rc=new b.Vector4;function tb(s,e,t,n,i){Rc.set(s[e],s[e+1],s[e+2],i.w),Rc.applyMatrix4(i.matrix),t[n]=Rc.x,t[n+1]=Rc.y,t[n+2]=Rc.z}function o0(s,e,t,n,i){if(!((e.array.length-e.start)/e.stride<t||(s.array.length-s.start)/s.stride<t))if(s.stride===e.stride)e.array.set(s.array,e.start);else{let r=e.start,o=s.start;for(let a=0;a<t;++a,r+=e.stride,o+=s.stride)n(s.array,o,e.array,r,i)}}class a0{constructor(){this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.lastPos=0,this.lastNorm=0,this.lastCol=0,this.lastIdx=0}init(e,t){this.positions=new Float32Array(e*ll),this.normals=new Float32Array(e*Cc),this.colors=new Float32Array(e*s0),this.indices=new Int32Array(t)}setPositions(e,t,n,i){const r={array:e,start:t,stride:i},o={array:this.positions,start:this.lastPos,stride:ll};o0(r,o,n,eb),this.lastPos+=n*ll}setTransformedPositions(e,t,n,i,r){let o=this.lastPos,a=t;const l={matrix:r,w:1};for(let h=0;h<n;++h,a+=i,o+=ll)tb(e,a,this.positions,o,l);this.lastPos+=n*ll}setNormals(e,t,n,i){const r={array:e,start:t,stride:i},o={array:this.normals,start:this.lastNorm,stride:Cc};o0(r,o,n,eb),this.lastNorm+=n*Cc}setTransformedNormals(e,t,n,i,r){let o=this.lastNorm,a=t;const l={matrix:r,w:0};for(let h=0;h<n;++h,a+=i,o+=Cc)tb(e,a,this.normals,o,l);this.lastNorm+=n*Cc}setColors(e,t,n,i){const r={array:e,start:t,stride:i},o={array:this.colors,start:this.lastCol,stride:s0};o0(r,o,n,zG,1),this.lastCol+=n*s0}setIndices(e,t,n){this.indices.set(e,this.lastIdx),this.lastIdx+=n}setShiftedIndices(e,t,n){const i=e.map(r=>r+n);this.setIndices(i,0,t)}getVerticesNumber(){return this.lastPos/ll}addInstance(e,t){const n=this.getVerticesNumber();this.setShiftedIndices(t.indices,t.indices.length,n);const i=t.itemSize;this.setTransformedPositions(t.positions,0,t.vertsCount,i.position,e),this.setTransformedNormals(t.normals,0,t.vertsCount,i.normal,e),this.setColors(t.colors,0,t.vertsCount,i.color)}}class LE{constructor(){this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.vertsCount=0,this.itemSize=null}init(e,t){const{attributes:n}=e;this.itemSize={position:n.position.itemSize,normal:n.normal.itemSize,color:n.color.itemSize}}}class nb extends LE{init(e,t){super.init(e,t);const{attributes:{position:n,normal:i},index:r}=e;this.vertsCount=n.count,this.positions=n.array,this.normals=i.array,this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this.indices=r.array}setColors(e){let t=0;for(let n=0,i=this.colors.length,r=this.itemSize.color;n<i;n+=r)this.colors[t++]=e.r,this.colors[t++]=e.g,this.colors[t++]=e.b}}class VG extends LE{constructor(){super(),this._cutRawStart=0,this._cutRawEnd=0,this._facesPerSlice=0}init(e,t){super.init(e,t);const{attributes:{position:n},index:i}=e;this.vertsCount=n.count+t.addPerCylinder,this._facesPerSlice=t.addPerCylinder,this.positions=new Float32Array(this.vertsCount*n.itemSize),this.normals=new Float32Array(this.vertsCount*this.itemSize.normal),this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this._extendVertices(e,t),this.indices=new Uint32Array(i.count),this._extendIndices(e,t)}_extendVertices(e,t){const{position:n}=e.attributes,{normal:i}=e.attributes,r=e.getGeoParams(),o=1;this._cutRawStart=o*r.radialSegments,this._cutRawEnd=this._cutRawStart+t.addPerCylinder;{let a=n.array.slice(0,this._cutRawEnd*n.itemSize);this.positions.set(a,0),a=i.array.slice(0,this._cutRawEnd*i.itemSize),this.normals.set(a,0)}{let a=n.array.slice(this._cutRawStart*n.itemSize,n.array.length);this.positions.set(a,this._cutRawEnd*n.itemSize),a=i.array.slice(this._cutRawStart*i.itemSize,i.array.length),this.normals.set(a,this._cutRawEnd*i.itemSize)}}_extendIndices(e,t){const{index:n}=e,r=t.addPerCylinder*6,o=t.addPerCylinder;let a=n.array.slice(r,n.count);a=a.map(l=>l+o),this.indices.set(n.array,0),this.indices.set(a,r)}_setColorRange(e,t,n,i){const r=i.length;for(let o=e;o<t;o+=r)n.set(i,o)}setColors(e,t){const n=this.itemSize.color,i=this._cutRawEnd*n,r=i*2;if(this._setColorRange(0,i,this.colors,e.toArray()),this._setColorRange(i,r,this.colors,t.toArray()),r<this.colors.length){const o=(this._facesPerSlice+1)*n,a=r+o;this._setColorRange(r,a,this.colors,t.toArray());const l=a+o;this._setColorRange(a,l,this.colors,e.toArray())}}}class kG{constructor(){this._materials=[],this._models=[]}process(e){this._extractModelsAndMaterials(e);const t=this._flattenModels();return{name:e.name,models:t,materials:this._materials}}_extractModelsAndMaterials(e){const t=new b.Layers;t.set(yt.LAYERS.DEFAULT),t.enable(yt.LAYERS.TRANSPARENT),e.traverse(n=>{n instanceof b.Mesh&&n.layers.test(t)&&this.checkExportAbility(n)&&(n.geometry.type==="InstancedBufferGeometry"?this._collectInstancedGeoInfo(n):this._collectGeoInfo(n))})}_reworkIndices(e){for(let n=2;n<e.length;n+=3)e[n]*=-1,e[n]--}_flattenModels(){let e=0;function t(i){return i+e}const n=[];for(let i=0,r=this._models.length;i<r;i++){const o=this._models[i];let a=[],l=[],h=[],u=[];e=0;for(let f=0;f<o.length;f++){const p=o[f];a.push(p.indices.map(t)),e+=p.getVerticesNumber(),l.push(p.positions),h.push(p.normals),u.push(p.colors)}a=Oe.mergeTypedArraysUnsafe(a),this._reworkIndices(a),l=Oe.mergeTypedArraysUnsafe(l),h=Oe.mergeTypedArraysUnsafe(h),u=Oe.mergeTypedArraysUnsafe(u),n.push({indices:a,positions:l,normals:h,colors:u,verticesCount:e})}return n}checkExportAbility(e){return e.geometry.attributes.position.count===0?!1:e instanceof aE?(In.warn("Currently we cannot export 'sprites' modes, like BS, WV, LC. Please turn of settings 'zSprites' and try again"),!1):e instanceof lE?(In.warn("Currently we cannot export Lines mode"),!1):!0}_collectGeoInfo(e){const{geometry:{attributes:{position:t,color:n,normal:i},index:r},matrix:o}=e,a=new a0,l=t.count;a.init(l,r.count),o.isIdentity()?(a.setPositions(t.array,0,l,t.itemSize),a.setNormals(i.array,0,l,i.itemSize)):(a.setTransformedPositions(t.array,0,l,t.itemSize,o),a.setTransformedNormals(i.array,0,l,i.itemSize,o)),a.setColors(n.array,0,l,n.itemSize),a.setIndices(r.array,0,r.count);const h=this._collectMaterialInfo(e);this._addToPool(a,h)}_collectSpheresInfo(e){const{geometry:{attributes:{position:t,color:n},index:i},matrix:r}=e,o=new a0,a=e.geometry.instanceCount,l=t.count,h=i.count;o.init(a*l,a*h);const u=new nb;u.init(e.geometry);const f=new b.Matrix4,p=new b.Matrix4,m=new b.Color;for(let v=0;v<a;++v){const y=v*n.itemSize;m.fromArray(n.array,y),u.setColors(m),this._getSphereInstanceMatrix(e.geometry,v,f),p.multiplyMatrices(r,f),o.addInstance(p,u)}const g=this._collectMaterialInfo(e);this._addToPool(o,g)}_collectCylindersInfo(e){const{geometry:{attributes:{position:t,color:n,color2:i},index:r},matrix:o}=e,a=new a0,l=e.geometry.instanceCount,h=new nb;h.init(e.geometry);const u=this._gatherCylindersColoringInfo(e.geometry);let f=null;u.needToSplit>0&&(f=new VG,f.init(e.geometry,u));const p=u.addPerCylinder*u.needToSplit,m=t.count,g=r.count;a.init(l*m+p,l*g);const v=new b.Matrix4,y=new b.Matrix4,x=new b.Color,w=new b.Color;let S={};for(let A=0;A<l;++A){const C=A*n.itemSize;u.is2Colored[A]?(x.fromArray(i.array,C),w.fromArray(n.array,C),f&&(f.setColors(x,w),S=f)):(x.fromArray(n.array,C),h.setColors(x),S=h),this._getCylinderInstanceMatrix(e.geometry,A,v),y.multiplyMatrices(o,v),a.addInstance(y,S)}const E=this._collectMaterialInfo(e);this._addToPool(a,E)}_addToPool(e,t){const n=this._checkExistingMaterial(t);n<0?(this._models.push([e]),this._materials.push(t)):this._models[n].push(e)}_checkExistingMaterial(e){return Me.default.findIndex(this._materials,t=>Me.default.isEqual(t,e))}_gatherCylindersColoringInfo(e){const t=e.instanceCount,n=e.attributes.color.array,i=e.attributes.color2.array,r=e.attributes.color.itemSize,o=new Array(t);let a=0,l=0;for(let f=0;f<t;f++,l+=r){const p=Math.abs(n[l]-i[l])>1e-7||Math.abs(n[l+1]-i[l+1])>1e-7||Math.abs(n[l+2]-i[l+2])>1e-7;o[f]=p,a+=p}const u=e.getGeoParams().radialSegments;return{is2Colored:o,needToSplit:a,addPerCylinder:u}}_collectInstancedGeoInfo(e){e.geometry instanceof qM?this._collectSpheresInfo(e):e.geometry instanceof $M&&this._collectCylindersInfo(e)}_collectMaterialInfo(e){const{uberOptions:t}=e.material;return{diffuse:t.diffuse.toArray(),opacity:t.opacity,shininess:t.shininess,specular:t.specular.toArray()}}_getCylinderInstanceMatrix(e,t,n){const i=e.attributes.matVector1.array,r=e.attributes.matVector2.array,o=e.attributes.matVector3.array,a=t*4;n.set(i[a],i[a+1],i[a+2],i[a+3],r[a],r[a+1],r[a+2],r[a+3],o[a],o[a+1],o[a+2],o[a+3],0,0,0,1)}_getSphereInstanceMatrix(e,t,n){const{offset:i}=e.attributes,r=t*i.itemSize,o=i.array[r],a=i.array[r+1],l=i.array[r+2],h=i.array[r+3];n.set(h,0,0,o,0,h,0,a,0,0,h,l,0,0,0,1)}}const GG=`
Definitions:  {
  Version: 100
  Count: 3
  ObjectType: "Model" {
    Count: 1
  }
  ObjectType: "Geometry" {
    Count: 1
  }
  ObjectType: "Material" {
    Count: 1
  }
  ObjectType: "Pose" {
    Count: 1
  }
  ObjectType: "GlobalSettings" {
    Count: 1
  }
} `,HG=`Properties60: {
      Property: "QuaternionInterpolate", "bool", "",0
      Property: "Visibility", "Visibility", "A",1
      Property: "Lcl Translation", "Lcl Translation", "A",0.000000000000000,0.000000000000000,-1789.238037109375000
      Property: "Lcl Rotation", "Lcl Rotation", "A",0.000009334667643,-0.000000000000000,0.000000000000000
      Property: "Lcl Scaling", "Lcl Scaling", "A",1.000000000000000,1.000000000000000,1.000000000000000
      Property: "RotationOffset", "Vector3D", "",0,0,0
      Property: "RotationPivot", "Vector3D", "",0,0,0
      Property: "ScalingOffset", "Vector3D", "",0,0,0
      Property: "ScalingPivot", "Vector3D", "",0,0,0
      Property: "TranslationActive", "bool", "",0
      Property: "TranslationMin", "Vector3D", "",0,0,0
      Property: "TranslationMax", "Vector3D", "",0,0,0
      Property: "TranslationMinX", "bool", "",0
      Property: "TranslationMinY", "bool", "",0
      Property: "TranslationMinZ", "bool", "",0
      Property: "TranslationMaxX", "bool", "",0
      Property: "TranslationMaxY", "bool", "",0
      Property: "TranslationMaxZ", "bool", "",0
      Property: "RotationOrder", "enum", "",0
      Property: "RotationSpaceForLimitOnly", "bool", "",0
      Property: "AxisLen", "double", "",10
      Property: "PreRotation", "Vector3D", "",0,0,0
      Property: "PostRotation", "Vector3D", "",0,0,0
      Property: "RotationActive", "bool", "",0
      Property: "RotationMin", "Vector3D", "",0,0,0
      Property: "RotationMax", "Vector3D", "",0,0,0
      Property: "RotationMinX", "bool", "",0
      Property: "RotationMinY", "bool", "",0
      Property: "RotationMinZ", "bool", "",0
      Property: "RotationMaxX", "bool", "",0
      Property: "RotationMaxY", "bool", "",0
      Property: "RotationMaxZ", "bool", "",0
      Property: "RotationStiffnessX", "double", "",0
      Property: "RotationStiffnessY", "double", "",0
      Property: "RotationStiffnessZ", "double", "",0
      Property: "MinDampRangeX", "double", "",0
      Property: "MinDampRangeY", "double", "",0
      Property: "MinDampRangeZ", "double", "",0
      Property: "MaxDampRangeX", "double", "",0
      Property: "MaxDampRangeY", "double", "",0
      Property: "MaxDampRangeZ", "double", "",0
      Property: "MinDampStrengthX", "double", "",0
      Property: "MinDampStrengthY", "double", "",0
      Property: "MinDampStrengthZ", "double", "",0
      Property: "MaxDampStrengthX", "double", "",0
      Property: "MaxDampStrengthY", "double", "",0
      Property: "MaxDampStrengthZ", "double", "",0
      Property: "PreferedAngleX", "double", "",0
      Property: "PreferedAngleY", "double", "",0
      Property: "PreferedAngleZ", "double", "",0
      Property: "InheritType", "enum", "",0
      Property: "ScalingActive", "bool", "",0
      Property: "ScalingMin", "Vector3D", "",1,1,1
      Property: "ScalingMax", "Vector3D", "",1,1,1
      Property: "ScalingMinX", "bool", "",0
      Property: "ScalingMinY", "bool", "",0
      Property: "ScalingMinZ", "bool", "",0
      Property: "ScalingMaxX", "bool", "",0
      Property: "ScalingMaxY", "bool", "",0
      Property: "ScalingMaxZ", "bool", "",0
      Property: "GeometricTranslation", "Vector3D", "",0,0,0
      Property: "GeometricRotation", "Vector3D", "",0,0,0
      Property: "GeometricScaling", "Vector3D", "",1,1,1
      Property: "LookAtProperty", "object", ""
      Property: "UpVectorProperty", "object", ""
      Property: "Show", "bool", "",1
      Property: "NegativePercentShapeSupport", "bool", "",1
      Property: "DefaultAttributeIndex", "int", "",0
      Property: "Color", "Color", "A+",0,0,0
      Property: "Size", "double", "",100
      Property: "Look", "enum", "",1
    }`,WG=`
    LayerElementMaterial: 0 {
      Version: 101
      Name: ""
      MappingInformationType: "AllSame"
      ReferenceInformationType: "Direct"
      Materials: 0
    }`,XG=`
    Layer: 0 {
      Version: 100
      LayerElement:  {
        Type: "LayerElementNormal"
        TypedIndex: 0
      }
      LayerElement:  {
        Type: "LayerElementColor"
        TypedIndex: 0
      }
      LayerElement:  {
        Type: "LayerElementMaterial"
        TypedIndex: 0
      }
    }`,YG=`GlobalSettings: {
    Version: 1000
    Properties60:  {
      Property: "UpAxis", "int", "",1
      Property: "UpAxisSign", "int", "",1
      Property: "FrontAxis", "int", "",2
      Property: "FrontAxisSign", "int", "",1
      Property: "CoordAxis", "int", "",0
      Property: "CoordAxisSign", "int", "",1
      Property: "UnitScaleFactor", "double", "",1
    }
  }`;class jG{constructor(){this._resultArray=[],this._info=null}getResult(e){return this._info=e,this._resultArray.push(this._writeHeader()),this._resultArray.push(this._writeDefinitions()),this._resultArray.push(this._writeObjects(e.models,e.materials)),this._resultArray.push(this._writeRelations()),this._resultArray.push(this._writeConnections()),this._info=null,this._resultArray.join("")}_writeHeader(){const n=new Date,i=1e3,r=`Miew FBX Exporter v${this._info.version}`;return`; FBX 6.1.0 project file
; Created by ${r} Copyright (c) 2015-2024 EPAM Systems, Inc.
; For support please contact miew@epam.com
; ----------------------------------------------------

FBXHeaderExtension:  {
  FBXHeaderVersion: 1003
  FBXVersion: 6100
  CreationTimeStamp:  {
    Version: ${i}
    Year: ${n.getFullYear()}
    Month: ${n.getMonth()+1}
    Day: ${n.getDate()}
    Hour: ${n.getHours()}
    Minute: ${n.getMinutes()}
    Second: ${n.getSeconds()}
    Millisecond: ${n.getMilliseconds()}
  }
  Creator: "${r}"
  OtherFlags:  {
    FlagPLE: 0
  }
}
CreationTime: "${n}"
Creator: "${r}"
`}_writeDefinitions(){return`
; Object definitions
;------------------------------------------------------------------

${GG}
`}_models(){let t="";const{models:n}=this._info;for(let i=0;i<n.length;++i){const r=n[i],o=r.verticesCount;t+=`
  Model: "Model::${this._info.name}_${i}", "Mesh" {
    Version: 232
    ${HG}
    ${this._verticesIndices(r.positions,r.indices)}
    ${this._normalLayer(r.normals)}
    ${this._colorLayer(r.colors,o)}
    ${WG}
    ${XG}
  }`}return t}_materials(){let t="";const{materials:n}=this._info;for(let i=0;i<n.length;++i){const r=n[i];t+=`
  Material: "Material::${this._info.name}_${i}_default", "" {
    Version: 102
    ShadingModel: "lambert"
    MultiLayer: 0
    ${this._materialProperties(r)}
  }`}return t}_writeObjects(){return`
; Object properties
;------------------------------------------------------------------

Objects:  {
  ${this._models()}
  ${this._materials()}
  ${YG}
}
`}_writeRelations(){let e="";for(let n=0;n<this._info.models.length;++n)e+=`
  Model: "Model::${this._info.name}_${n}", "Mesh" {
  }`;let t="";for(let n=0;n<this._info.materials.length;++n)t+=`
  Material: "Material::${this._info.name}_${n}_default", "" {
  }`;return`
; Object relations
;------------------------------------------------------------------

Relations:  {
  ${e}
  Model: "Model::Producer Perspective", "Camera" {
  }
  Model: "Model::Producer Top", "Camera" {
  }
  Model: "Model::Producer Bottom", "Camera" {
  }
  Model: "Model::Producer Front", "Camera" {
  }
  Model: "Model::Producer Back", "Camera" {
  }
  Model: "Model::Producer Right", "Camera" {
  }
  Model: "Model::Producer Left", "Camera" {
  }
  Model: "Model::Camera Switcher", "CameraSwitcher" {
  }
  ${t}
}`}_writeConnections(){let e="";const{name:t}=this._info;for(let i=0;i<this._info.models.length;++i)e+=`
  Connect: "OO", "Model::${t}_${i}", "Model::Scene"`;let n="";for(let i=0;i<this._info.materials.length;++i)n+=`
  Connect: "OO", "Material::${t}_${i}_default", "Model::${t}_${i}"`;return`
; Object connections
;------------------------------------------------------------------

Connections:  {
  ${e}
  ${n}
}`}_floatArrayToString(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].toFixed(6);return t.join(",")}_colorLayer(e,t){const r="",o=this._floatArrayToString(e),a=[...Array(t).keys()];return`
    LayerElementColor: 0 {
      Version: 101
      Name: "${r}"
      MappingInformationType: "ByVertice"
      ReferenceInformationType: "Direct"
      Colors: ${o}
      ColorIndex: ${a}
    }`}_normalLayer(e){const i="",r=this._floatArrayToString(e);return`
    LayerElementNormal: 0 {
      Version: 101
      Name: "${i}"
      MappingInformationType: "ByVertice"
      ReferenceInformationType: "Direct"
      Normals: ${r}
    }`}_verticesIndices(e,t){const r="Y",o="CullingOff",l=this._floatArrayToString(e);return`MultiLayer: 0
    MultiTake: 1
    Shading: ${r}
    Culling: "${o}"
    Vertices: ${l}
    PolygonVertexIndex: ${t}
    GeometryVersion: 124`}_materialProperties(e){return`Properties60:  {
      Property: "ShadingModel", "KString", "", "Lambert"
      Property: "MultiLayer", "bool", "",0
      Property: "EmissiveColor", "ColorRGB", "",0,0,0
      Property: "EmissiveFactor", "double", "",0.0000
      Property: "AmbientColor", "ColorRGB", "",1,1,1
      Property: "AmbientFactor", "double", "",0.0000
      Property: "DiffuseColor", "ColorRGB", "",${e.diffuse}
      Property: "DiffuseFactor", "double", "",1.0000
      Property: "Bump", "Vector3D", "",0,0,0
      Property: "TransparentColor", "ColorRGB", "",1,1,1
      Property: "TransparencyFactor", "double", "",0.0000
      Property: "SpecularColor", "ColorRGB", "",${e.specular}
      Property: "SpecularFactor", "double", "",1.0000
      Property: "ShininessExponent", "double", "",${e.shininess}
      Property: "ReflectionColor", "ColorRGB", "",0,0,0
      Property: "ReflectionFactor", "double", "",1
      Property: "Ambient", "ColorRGB", "",1,1,1
      Property: "Diffuse", "ColorRGB", "",${e.diffuse}
      Property: "Specular", "ColorRGB", "",${e.specular}
      Property: "Shininess", "double", "",${e.shininess}
      Property: "Opacity", "double", "",${e.opacity}
      Property: "Reflectivity", "double", "",0
    }`}}class Y_ extends W_{constructor(e,t){super(e,t),this._data=e,this._version=t.miewVersion||"0.0-UNSPECIFIED",this._extractor=new kG}exportSync(){const e=new jG;if(!this._source)return this._result;const t=this._extractor.process(this._data);return t.version=this._version,this._result=e.getResult(t),this._result}}Y_.formats=["fbx"];Y_.SourceClass=bs;const qG=new UG([X_,Y_]),lo={loaders:i8,parsers:OG,exporters:qG},Pc=new b.Color;class $G{constructor(){this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this._vector=new b.Vector3,this._viewMatrix=new b.Matrix4,this._projectionMatrix=new b.Matrix4,this._domElement=document.createElement("div"),this._domElement.style.overflow="hidden",this._domElement.style.position="absolute",this._domElement.style.top="0",this._domElement.style.zIndex="0",this._domElement.style.pointerEvents="none"}getElement(){return this._domElement}reset(){const e=this.getElement();for(;e.firstChild;)e.removeChild(e.firstChild)}setSize(e,t){this._width=e,this._height=t,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this._domElement.style.width=`${e}px`,this._domElement.style.height=`${t}px`}_renderObject(e,t,n){function i(o,a,l){return Pc.setHex(o),Pc.lerp(a,l),`#${Pc.getHexString()}`}function r(o){return Pc.setHex(o),`#${Pc.getHexString()}`}if(e instanceof S_){if(this._vector.setFromMatrixPosition(e.matrixWorld),e.userData!==void 0&&e.userData.offset!==void 0){const u=new b.Vector3(e.userData.offset.x,e.userData.offset.y,0);this._vector.add(u.multiplyScalar(e.matrixWorld.getMaxScaleOnAxis()))}this._vector.applyMatrix4(this._viewMatrix);const o=this._vector.z>-t.near?"hidden":"visible",a=1e4*(t.far- -this._vector.z)/(t.far-t.near),l=e.getElement();if(typeof n.fog>"u")l.style.color=r(e.userData.color),e.userData.background!=="transparent"&&(l.style.background=r(e.userData.background));else{const u=b.MathUtils.smoothstep(-this._vector.z,n.fog.near,n.fog.far);l.style.color=i(e.userData.color,n.fog.color,u),e.userData.background!=="transparent"&&(l.style.background=i(e.userData.background,n.fog.color,u))}this._vector.applyMatrix4(this._projectionMatrix);const h=`${e.userData!=={}?e.userData.translation:"translate(-50%, -50%) "}translate(${this._vector.x*this._widthHalf+this._widthHalf}px,${-this._vector.y*this._heightHalf+this._heightHalf}px)`;l.style.visibility=o,l.style.WebkitTransform=h,l.style.MozTransform=h,l.style.oTransform=h,l.style.transform=h,l.style.zIndex=Number(a).toFixed(0),l.parentNode!==this._domElement&&this._domElement.appendChild(l)}for(let o=0,a=e.children.length;o<a;o++)this._renderObject(e.children[o],t,n)}render(e,t){e.updateMatrixWorld(),t.parent===null&&t.updateMatrixWorld(),t.matrixWorldInverse.copy(t.matrixWorld).invert(),this._viewMatrix.copy(t.matrixWorldInverse),this._projectionMatrix.copy(t.projectionMatrix),this._renderObject(e,t,e)}}const ZG=$G;function NE(){try{if(window.top.location.href!==void 0)return window.top}catch{}return window}const j_=37,q_=38,$_=39,Z_=40,sn={NONE:-1,ROTATE:0,TRANSLATE:1,SCALE:2,TRANSLATE_PIVOT:3},KG=.1,pg=new b.Quaternion,Js=new b.Matrix4;function ws(s,e,t,n){this.objects=s,[this.object]=s,this.camera=e,this.pivot=t,this.axis=new b.Vector3(0,0,1),this.options=n,this.lastRotation={axis:new b.Vector3,angle:0}}ws.prototype._rotate=function(){const s=new b.Vector3,e=new b.Quaternion,t=new b.Vector3,n=new b.Matrix4;return function(i){const r=this.pivot.x===0&&this.pivot.y===0&&this.pivot.z===0;if(n.copy(this.object.matrix),r?n.multiply(Js.makeRotationFromQuaternion(i)):(n.multiply(Js.makeTranslation(this.pivot.x,this.pivot.y,this.pivot.z)),n.multiply(Js.makeRotationFromQuaternion(i)),n.multiply(Js.makeTranslation(-this.pivot.x,-this.pivot.y,-this.pivot.z))),n.decompose(s,e,t),!r)for(let o=0;o<this.objects.length;++o)this.objects[o].position.copy(s);for(let o=0;o<this.objects.length;++o)this.objects[o].quaternion.copy(e),this.objects[o].updateMatrix()}}();ws.prototype.setObjects=function(s){this.objects=s,[this.object]=s};ws.prototype.rotate=function(){const s={axis:new b.Vector3,angle:0};return function(e,t,n,i){this.mouse2rotation(s,t,n,i),e.setFromAxisAngle(s.axis,s.angle),s.angle&&this._rotate(e),this.lastRotation=s}}();ws.prototype.translate=function(){const s=new b.Vector3,e=new b.Vector3;return function(t){s.set(t.x/this.camera.projectionMatrix.elements[0],t.y/this.camera.projectionMatrix.elements[5],0);let n=s.length();s.normalize(),s.transformDirection(Js.copy(this.object.matrixWorld).invert()),e.copy(this.pivot),this.object.localToWorld(e),n*=Math.abs(e.z-this.camera.position.z),n/=this.object.matrixWorld.getMaxScaleOnAxis();for(let i=0;i<this.objects.length;++i)this.objects[i].translateOnAxis(s,n)}}();ws.prototype.update=function(){const s=new b.Vector3;return function(e,t){if(pe.now.autoRotation!==0)return pe.now.autoRotationAxisFixed||this.lastRotation.axis.length()===0?s.set(0,1,0).transformDirection(Js.copy(this.object.matrixWorld).invert()):s.copy(this.lastRotation.axis),this._rotate(pg.setFromAxisAngle(s,pe.now.autoRotation*e)),!0;if(this.options.intertia&&this.lastRotation.angle){const n=this.lastRotation.angle*(1-this.options.dynamicDampingFactor)**(40*t);if(Math.abs(n)<=this.options.intertiaThreshold)this.lastRotation.angle=0;else return this._rotate(pg.setFromAxisAngle(this.lastRotation.axis,n)),!0}return!1}}();ws.prototype.stop=function(){this.lastRotation.angle=0};ws.prototype.mouse2rotation=function(){const s=new b.Vector3,e=new b.Vector3,t=new b.Vector3,n=new b.Vector3,i=new b.Vector3,r=new b.Vector3,o=new b.Vector2;return function(a,l,h,u){if(u)a.axis.copy(this.axis),a.angle=this.options.axisRotateFactor*(h.y-l.y);else{o.subVectors(h,l);const f=o.length();if(f===0)return;s.copy(this.pivot),this.object.localToWorld(s),e.subVectors(this.camera.position,s),t.copy(e).normalize(),n.copy(this.camera.up).normalize(),i.crossVectors(n,t).normalize(),n.setLength(o.y),i.setLength(o.x),r.copy(n.add(i)),a.axis.crossVectors(r,e),a.angle=-f*this.options.rotateFactor}a.axis.transformDirection(Js.copy(this.object.matrixWorld).invert()),a.angle<0&&(a.axis.negate(),a.angle=-a.angle)}}();function zt(s,e,t,n,i){Yi.call(this);const r=this;this.object=s,this.objectPivot=e,this.camera=t,this.domElement=typeof n<"u"?n:document,this.getAltObj=i,this.enabled=!0,this.hotkeysEnabled=!0,this.screen={left:0,top:0,width:0,height:0},this.options={rotateFactor:Math.PI,axisRotateFactor:4*Math.PI,intertia:!0,dynamicDampingFactor:.1,intertiaThreshold:.001},this._state=sn.NONE,this._mousePrevPos=new b.Vector2,this._mouseCurPos=new b.Vector2,this._mainObj=new ws([this.object],this.camera,new b.Vector3(0,0,0),this.options),this._altObj=new ws([this.object],this.camera,new b.Vector3(0,0,0),this.options),this._affectedObj=this._mainObj,this._isAltObjFreeRotationAllowed=!0,this._isTranslationAllowed=!0,this._isKeysTranslatingObj=!1,this._pressedKeys=[],this._clock=new Qo,this._clock.start(),this._lastUpdateTime=this._clock.getElapsedTime(),this._listeners=[{obj:r.domElement,type:"mousedown",handler(o){r.mousedown(o)}},{obj:r.domElement,type:"mouseup",handler(o){r.mouseup(o)}},{obj:r.domElement,type:"mousemove",handler(o){r.mousemove(o)}},{obj:r.domElement,type:"mousewheel",handler(o){r.mousewheel(o)}},{obj:r.domElement,type:"DOMMouseScroll",handler(o){r.mousewheel(o)}},{obj:r.domElement,type:"mouseout",handler(o){r.mouseup(o)}},{obj:r.domElement,type:"touchstart",handler(o){r.touchstartend(o)}},{obj:r.domElement,type:"touchend",handler(o){r.touchstartend(o)}},{obj:r.domElement,type:"touchmove",handler(o){r.touchmove(o)}},{obj:r.getKeyBindObject(),type:"keydown",handler(o){r.keydownup(o)}},{obj:r.getKeyBindObject(),type:"keyup",handler(o){r.keydownup(o)}},{obj:window,type:"resize",handler(){r.handleResize()}},{obj:window,type:"blur",handler(){r.resetKeys()}},{obj:r.domElement,type:"contextmenu",handler(o){r.contextmenu(o)}}];for(let o=0;o<this._listeners.length;o++){const a=this._listeners[o];a.obj.addEventListener(a.type,a.handler)}this.handleResize(),this.resetKeys(),this.update()}zt.prototype=Object.create(Yi.prototype);zt.prototype.constructor=zt;zt.prototype.resetKeys=function(){this._pressedKeys[j_]=!1,this._pressedKeys[q_]=!1,this._pressedKeys[$_]=!1,this._pressedKeys[Z_]=!1};zt.prototype.contextmenu=function(s){s.stopPropagation(),s.preventDefault()};zt.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{const s=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=s.left+window.pageXOffset-e.clientLeft,this.screen.top=s.top+window.pageYOffset-e.clientTop,this.screen.width=s.width,this.screen.height=s.height}};zt.prototype.enable=function(s){this.enabled=s};zt.prototype.enableHotkeys=function(s){this.hotkeysEnabled=s};zt.prototype.allowTranslation=function(s){this._isTranslationAllowed=s};zt.prototype.allowAltObjFreeRotation=function(s){this._isAltObjFreeRotationAllowed=s};zt.prototype.keysTranslateObj=function(s){this._isKeysTranslatingObj=s};zt.prototype.isEditingAltObj=function(){return(this._state===sn.ROTATE||this._state===sn.TRANSLATE)&&this._affectedObj===this._altObj};zt.prototype.convertMouseToOnCircle=function(s,e,t){const n=Math.min(this.screen.width,this.screen.height);if(n===0){s.set(0,0);return}s.set((e-this.screen.width*.5-this.screen.left)/n,(.5*this.screen.height+this.screen.top-t)/n)};zt.prototype.convertMouseToViewport=function(s,e,t){if(this.screen.width===0||this.screen.height===0){s.set(0,0);return}s.set(2*(e-this.screen.width*.5-this.screen.left)/this.screen.width,2*(.5*this.screen.height+this.screen.top-t)/this.screen.height)};zt.prototype.stop=function(){this._mainObj.stop(),this._altObj.stop()};zt.prototype.rotateByMouse=function(){const s=new b.Quaternion;return function(e){this._affectedObj.rotate(s,this._mousePrevPos,this._mouseCurPos,e),this.dispatchEvent({type:"change",action:"rotate",quaternion:s})}}();zt.prototype.rotate=function(s){this.object.quaternion.multiply(s),this.dispatchEvent({type:"change",action:"rotate",quaternion:s})};zt.prototype.getOrientation=function(){return this.object.quaternion};zt.prototype.setOrientation=function(s){this.object.quaternion.copy(s)};zt.prototype.translate=function(){const s=new b.Vector2;return function(){s.subVectors(this._mouseCurPos,this._mousePrevPos),this._affectedObj.translate(s),this.dispatchEvent({type:"change",action:"translate"})}}();zt.prototype.getScale=function(){return this.object.scale.x};zt.prototype.setScale=function(s){this.object.scale.set(s,s,s)};zt.prototype.scale=function(s){s<=0||(this.setScale(this.object.scale.x*s),this.dispatchEvent({type:"change",action:"zoom",factor:s}))};zt.prototype.update=function(){const s=new b.Vector2;return function(){const e=this._clock.getElapsedTime(),t=e-this._lastUpdateTime;if(this._state===sn.NONE){const n=e-this._lastMouseMoveTime;(this._mainObj.update(t,n)||this._altObj.update(t,n))&&this.dispatchEvent({type:"change",action:"auto"})}if(this._isKeysTranslatingObj){const n=Number(this._pressedKeys[$_])-Number(this._pressedKeys[j_]),i=Number(this._pressedKeys[q_])-Number(this._pressedKeys[Z_]);if(n!==0||i!==0){const r=t,o=this.getAltObj();o.objects.length>0&&(this._altObj.setObjects(o.objects),this._altObj.pivot=o.pivot,"axis"in o?this._altObj.axis=o.axis.clone():this._altObj.axis.set(0,0,1),s.set(r*n,r*i),this._altObj.translate(s),this.dispatchEvent({type:"change",action:"translate"}))}}this._lastUpdateTime=e}}();zt.prototype.reset=function(){this._state=sn.NONE,this.object.quaternion.copy(pg.set(0,0,0,1))};zt.prototype.mousedown=function(s){if(!(this.enabled===!1||this._state!==sn.NONE)){if(s.preventDefault(),s.stopPropagation(),this._state===sn.NONE)if(s.button===0){this._affectedObj.stop();let e=!1;if(s.altKey){const t=this.getAltObj();e=t.objects.length>0,e&&(this._altObj.setObjects(t.objects),this._altObj.pivot=t.pivot,"axis"in t?this._altObj.axis=t.axis.clone():this._altObj.axis.set(0,0,1))}this._affectedObj=e?this._altObj:this._mainObj,this._state=e&&s.ctrlKey&&this._isTranslationAllowed?sn.TRANSLATE:sn.ROTATE}else s.button===2&&(this._state=sn.TRANSLATE_PIVOT);this._state===sn.ROTATE&&(this.convertMouseToOnCircle(this._mouseCurPos,s.pageX,s.pageY),this._mousePrevPos.copy(this._mouseCurPos)),(this._state===sn.TRANSLATE||this._state===sn.TRANSLATE_PIVOT)&&(this.convertMouseToViewport(this._mouseCurPos,s.pageX,s.pageY),this._mousePrevPos.copy(this._mouseCurPos))}};zt.prototype.mousemove=function(s){if(!(this.enabled===!1||this._state===sn.NONE))switch(s.preventDefault(),s.stopPropagation(),this._state){case sn.ROTATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,s.pageX,s.pageY),this.rotateByMouse(s.altKey&&!this._isAltObjFreeRotationAllowed||s.shiftKey),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case sn.TRANSLATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,s.pageX,s.pageY),this.translate();break;case sn.TRANSLATE_PIVOT:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,s.pageX,s.pageY),this.translatePivotByMouse();break}};zt.prototype.mousewheel=function(s){if(this.enabled===!1||!pe.now.zooming||this._state!==sn.NONE||s.shiftKey)return;s.preventDefault();let e=0;s.wheelDelta?e=s.wheelDelta/40:s.detail&&(e=-s.detail/3);let t=1+e*.05;t=Math.max(t,.01),this.scale(t)};zt.prototype.mouseup=function(s){this.enabled===!1||this._state===sn.NONE||(s.preventDefault(),s.stopPropagation(),this._state=sn.NONE,this._clock.getElapsedTime()-this._lastMouseMoveTime>KG&&this._affectedObj.stop())};zt.prototype.touchstartend=function(s){if(this.enabled!==!1)switch(s.preventDefault(),s.stopPropagation(),s.touches.length){case 1:this._state=sn.ROTATE,this.convertMouseToOnCircle(this._mouseCurPos,s.touches[0].pageX,s.touches[0].pageY),this._mousePrevPos.copy(this._mouseCurPos);break;case 2:{this._mainObj.stop(),this._altObj.stop(),this._state=sn.SCALE;const e=s.touches[0].pageX-s.touches[1].pageX,t=s.touches[0].pageY-s.touches[1].pageY;this._touchDistanceCur=this._touchDistanceStart=Math.sqrt(e*e+t*t),this._scaleStart=this.object.scale.x;break}default:this._state=sn.NONE}};zt.prototype.touchmove=function(s){if(!(this.enabled===!1||this._state===sn.NONE))switch(s.preventDefault(),s.stopPropagation(),this._state){case sn.ROTATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,s.touches[0].pageX,s.touches[0].pageY),this.rotateByMouse(!1),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case sn.SCALE:if(pe.now.zooming){const e=s.touches[0].pageX-s.touches[1].pageX,t=s.touches[0].pageY-s.touches[1].pageY;this._touchDistanceCur=Math.sqrt(e*e+t*t);const i=this._scaleStart*this._touchDistanceCur/this._touchDistanceStart/this.object.scale.x;this.scale(i)}break}};zt.prototype.keydownup=function(s){if(!(this.enabled===!1||this.hotkeysEnabled===!1))switch(s.keyCode){case j_:case q_:case $_:case Z_:this._pressedKeys[s.keyCode]=s.type==="keydown",s.preventDefault(),s.stopPropagation();break}};zt.prototype.getKeyBindObject=function(){return NE()};zt.prototype.dispose=function(){for(let s=0;s<this._listeners.length;s++){const e=this._listeners[s];e.obj.removeEventListener(e.type,e.handler)}};zt.prototype.translatePivotByMouse=function(){const s=new b.Vector2;return function(){s.subVectors(this._mouseCurPos,this._mousePrevPos),this.translatePivotInWorld(pe.now.translationSpeed*s.x,pe.now.translationSpeed*s.y,0)}}();zt.prototype.translatePivotInWorld=function(s,e,t){const n=this.objectPivot.position;n.applyMatrix4(this.object.matrixWorld),n.setX(n.x+s),n.setY(n.y+e),n.setZ(n.z+t),n.applyMatrix4(Js.copy(this.object.matrixWorld).invert()),this.dispatchEvent({type:"change",action:"translatePivot"})};zt.prototype.translatePivot=function(s,e,t){const n=this.objectPivot.position;n.setX(n.x+s),n.setY(n.y+e),n.setZ(n.z+t),this.dispatchEvent({type:"change",action:"translatePivot"})};zt.prototype.setPivot=function(s){this.objectPivot.position.copy(s),this.dispatchEvent({type:"change",action:"translatePivot"})};const JG=zt;function Ti(s,e,t){Yi.call(this);const n=this;this.gfxObj=s,this.camera=e,this.domElement=typeof t<"u"?t:document,this.screen={left:0,top:0,width:0,height:0},this._lastMousePos=new b.Vector2(0,0),this._mouseTotalDist=0,this._lastClickBeginTime=-1e3,this._lastClickPos=new b.Vector2(0,0),this._clickBeginTime=0,this._clock=new Qo,this._clock.start(),this._listeners=[{obj:n.domElement,type:"mousedown",handler(i){n.mousedown(i)}},{obj:n.domElement,type:"mouseup",handler(i){n.mouseup(i)}},{obj:n.domElement,type:"mousemove",handler(i){n.mousemove(i)}},{obj:n.domElement,type:"touchstart",handler(i){n.touchstart(i)}},{obj:n.domElement,type:"touchend",handler(i){n.touchend(i)}},{obj:window,type:"resize",handler(){n.handleResize()}}];for(let i=0;i<this._listeners.length;i++){const r=this._listeners[i];r.obj.addEventListener(r.type,r.handler)}this.handleResize()}Ti.prototype=Object.create(Yi.prototype);Ti.prototype.constructor=Ti;Ti.prototype.reset=function(){this.picked={},this.dispatchEvent({type:"newpick",obj:{}})};Ti.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{const s=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=s.left+window.pageXOffset-e.clientLeft,this.screen.top=s.top+window.pageYOffset-e.clientTop,this.screen.width=s.width,this.screen.height=s.height}};Ti.prototype.pickObject=function(s){if(!this.gfxObj){this.picked={},this.dispatchEvent({type:"newpick",obj:{}});return}const{gfxObj:e}=this,t=new b.Raycaster;t.ray.origin.setFromMatrixPosition(this.camera.matrixWorld),t.ray.direction.set(s.x,s.y,.5).unproject(this.camera).sub(t.ray.origin).normalize();const n=pe.now.draft.clipPlane&&this.clipPlaneValue?this.clipPlaneValue:1/0,i=pe.now.fog&&this.fogFarValue?this.fogFarValue:1/0,r=t.intersectVisibleObject(e,this.camera,n,i);if(!r){this.picked={},this.dispatchEvent({type:"newpick",obj:{}});return}let o={};if(r.residue||r.atom){const a=r.residue||r.atom.residue;pe.now.pick==="chain"?o={chain:a.getChain()}:pe.now.pick==="molecule"?o={molecule:a.getMolecule()}:r.residue||pe.now.pick==="residue"?o={residue:a}:r.atom&&(o={atom:r.atom})}this.picked=o,this.dispatchEvent({type:"newpick",obj:o})};Ti.prototype.getMouseInViewport=function(s,e){return new b.Vector2((s-this.screen.left)/this.screen.width*2-1,-(e-this.screen.top)/this.screen.height*2+1)};Ti.prototype.mousedown=function(s){s.preventDefault(),s.stopPropagation(),s.button===0&&(this._lastMousePos=this.getMouseInViewport(s.pageX,s.pageY),this._mouseTotalDist=0,this._clickBeginTime=this._clock.getElapsedTime())};Ti.prototype.mousemove=function(s){s.preventDefault(),s.stopPropagation();const e=this.getMouseInViewport(s.pageX,s.pageY);this._mouseTotalDist+=e.sub(this._lastMousePos).length()};Ti.prototype.mouseup=function(s){const e=this;if(s.preventDefault(),s.stopPropagation(),s.button===0&&this._mouseTotalDist<.01){const t=this._clock.getElapsedTime(),n=this.getMouseInViewport(s.pageX,s.pageY);if(t-this._lastClickBeginTime<.7&&new b.Vector2().subVectors(n,this._lastClickPos).length()<.01){this.dispatchEvent({type:"dblclick",obj:this.picked}),this._lastClickPos=n,this._lastClickBeginTime=-1e3;return}setTimeout(()=>{e.pickObject(n)},0),this._lastClickPos=n,this._lastClickBeginTime=this._clickBeginTime}};Ti.prototype.touchstart=function(s){s.preventDefault(),s.stopPropagation(),s.touches.length===1&&(this._lastTouchdownPos=this.getMouseInViewport(s.touches[0].pageX,s.touches[0].pageY))};Ti.prototype.touchend=function(s){const e=this;s.preventDefault(),s.stopPropagation(),s.touches.length===0&&s.changedTouches.length===1&&this.getMouseInViewport(s.changedTouches[0].pageX,s.changedTouches[0].pageY).sub(this._lastTouchdownPos).length()<.01&&setTimeout(()=>{e.pickObject(e._lastTouchdownPos)},0)};Ti.prototype.dispose=function(){for(let s=0;s<this._listeners.length;s++){const e=this._listeners[s];e.obj.removeEventListener(e.type,e.handler)}};const QG=Ti;class eH{constructor(e,t){this._target=e,this._targetCamera=t,this._camera=new b.PerspectiveCamera(t.fov,t.aspect,1,100),this._object=new b.AxesHelper(1),this._scene=new b.Scene,this._scene.add(this._object),this._full=new b.Vector2,this._update()}_update(){const{fov:e}=this._targetCamera,t=this._camera;t.aspect=this._targetCamera.aspect,t.setMinimalFov(e),t.setDistanceToFit(1,e),t.updateProjectionMatrix(),this._object.quaternion.copy(this._target.quaternion)}render(e){this._update(),e.getSize(this._full);const t=this._full.width*.25,n=this._full.height*.25,{autoClear:i}=e;e.autoClear=!1,e.setViewport(0,0,t,n),e.clear(!1,!0,!1),e.render(this._scene,this._camera),e.setViewport(0,0,this._full.width,this._full.height),e.autoClear=i}}const tH=eH,nH=12,iH=268435200,rH=8,sH=255,oH=12,aH=4293918720,lH=20,cH=1048575,hH=4026531840,uH=28,dH=1<<19,fH=1<<20,pH=1,mH=2,gH=["helix","strand"],ib=["fs","ps","ns","us"];function _H(s,e){const t=e._residues,n=t.length,i=new Uint8Array(n),r=e._atoms;for(let l=0,h=s.length;l<h;++l){const u=r[l];i[u.residue._index]=s[l]}const o=[];let a=0;for(;a<n;){if(i[a]!==0){const l=a,h=i[a];for(;a<n-1&&i[a+1]===h&&t[a].isConnected(t[a+1]);)++a;o.push({start:l,end:a,type:gH[h-1]})}++a}return o}function l0(s){return s>=dH?s-fH:s}const cf=class cf{constructor(e,t,n){this._complex=e,this._secondary=null,this.isLoading=!1,this._framesRange={start:0,end:-1},this.frameIsReady=!1,this._buffer=null,this._frameRequest=null,this._callbacks=n,typeof t=="function"?(this._framesRequestLength=1,this._downloadDataFn=t):this.parseBinaryData(t,!0),this.reset(),this.setFrame(0)}_prepareBuffer(e,t){if(e==null&&(e=0),t==null&&(t=e+this._framesRequestLength),this._framesCount!==void 0&&(t=Math.min(this._framesCount-1,t)),this._downloadDataFn){const n=this,i=function(o){if(n.isLoading=!1,n._callbacks&&typeof n._callbacks.onLoadStatusChanged=="function"&&n._callbacks.onLoadStatusChanged(),n._buffer={data:o,state:"ready",start:e,end:t},n._frameRequest!==null){const a=n._frameRequest;n._frameRequest=null,n.setFrame(a)}},r=function(){n.isLoading=!1,n._callbacks&&typeof n._callbacks.onError=="function"&&n._callbacks.onError("Streaming failed")};this._buffer||(this._buffer={}),this._buffer.state="downloading",this.isLoading=!0,n._callbacks&&typeof n._callbacks.onLoadStatusChanged=="function"&&n._callbacks.onLoadStatusChanged(),this._downloadDataFn({start:e,end:t+1},i,r)}}_parseBuffer(){if(this._buffer&&this._buffer.state==="ready"){this._framesRange={start:this._buffer.start,end:this._buffer.end},this.parseBinaryData(this._buffer.data,!1);let e=(this._buffer.end+1)%this._framesCount;if(e>=this._framesCount&&(e=0),this._buffer={state:"none"},this._prepareBuffer(e,e+this._framesRequestLength),this._frameRequest!==null){const t=this._frameRequest;this._frameRequest=null,this.setFrame(t)}}}parseBinaryData(e){const t=new DataView(e);let n=0;const i=t.getUint32(n,!0);n+=4;const r=t.getUint32(n,!0);this._framesCount=r,this._framesRange.end=this._framesRange.end>0?Math.min(this._framesRange.end,r-1):r-1,n+=4,this._atomsCount=i;const o=1024*1024;this._framesRequestLength=Math.ceil(o/(i*8));const a=this._framesRange.end-this._framesRange.start+1;if(i!==this._complex._atoms.length||e.byteLength!==nH+a*i*8)throw new Error;const l=this._complex;let h=t.getUint32(n,!0),u=0;for(;h>1e3&&u<ib.length-1;)h/=1e3,++u;this._timeStep=`${h.toString()} ${ib[u]}`,n+=4;const f=[],p=new Float32Array(a*i*3);let m=0;const g=new Int8Array(i);for(let v=0;v<a;++v){for(let y=0;y<i;++y){const x=t.getUint32(n,!0);n+=4;const w=t.getUint32(n,!0);n+=4;const S=(w&hH)>>>uH,E=l0((w&iH)>>>rH>>0),A=l0(((w&sH)<<oH|(x&aH)>>>lH)>>0),C=l0((x&cH)>>0);g[y]=0,S>0&&S<4?g[y]=pH:S===4&&(g[y]=mH),p[m++]=E/100,p[m++]=A/100,p[m++]=C/100}f.push(_H(g,l))}this._secondaryData=f,this._data=p}nextFrame(){this.setFrame((this._currFrame+1)%this._framesCount)}needsColorUpdate(e){return e instanceof _E}getAtomColor(e,t){return e.getResidueColor(this._residues[t.residue._index],this._complex)}getResidueColor(e,t){return e.getResidueColor(this._residues[t._index],this._complex)}_updateSecondary(){let e;const t=this._residues;let n=t.length;for(e=0;e<n;++e)t[e]._secondary=null;const i=this._secondaryData[this._currFrame-this._framesRange.start];for(e=0,n=i.length;e<n;++e){const r=i[e],{start:o,end:a}=r,l={_start:t[o],_end:t[a],type:r.type,generic:r.generic};for(let h=o;h<=a;++h)t[h]._secondary=l}}reset(){const e=this._complex._residues,t=e.length;this._residues=new Array(t);const n=this._residues,i=function(){return this._secondary};for(let r=0;r<t;++r)n[r]={_type:e[r]._type,_isValid:e[r]._isValid,_controlPoint:null,_wingVector:null,_secondary:null,getSecondary:i}}setFrame(e){if(this.frameIsReady=!1,e>=this._framesRange.start&&e<=this._framesRange.end)this._currFrame=e,this._cachedResidues=!1,this._updateSecondary(),this.frameIsReady=!0;else if(this._frameRequest=e,!this._buffer)this._prepareBuffer(e);else{const t=this;switch(this._buffer.state){case"none":this._prepareBuffer(e);break;case"ready":t._parseBuffer();break}}}disableEvents(){this._callbacks=null}getAtomPos(e){const t=cf._vec,n=this,i=n._data,r=(n._atomsCount*(n._currFrame-n._framesRange.start)+e)*3;return t.set(i[r],i[r+1],i[r+2]),t}getResidues(){return this._cachedResidues?this._residues:(this._complex.updateToFrame(this),this._residues)}};lt(cf,"_vec",new b.Vector3);let mg=cf;const xH=mg;class kf{constructor(e,t){if(this.constructor===kf)throw new Error("Can not instantiate abstract class!");this.params=e,this.opts=Me.default.merge(Oe.deriveDeep(pe.now.objects[this.type],!0),t),this.needsRebuild=!1,this._mesh=null,this.id=null}identify(){const e={type:this.type,params:this.params},t=Oe.objectsDiff(this.opts,pe.now.modes[this.id]);return Me.default.isEmpty(t)||(e.opts=t),e}toString(){const e=`o=${this.type},${this.params.join(",")}`,t=Oe.compareOptionsWithDefaults(this.opts,pe.defaults.objects[this.type]);return e+t}getGeometry(){return this._mesh}destroy(){this._mesh&&yt.destroyObject(this._mesh)}}kf.prototype.type="__";const yH=kf;class rf extends yH{constructor(e,t){if(super(e,t),e.length<2)throw new Error("Wrong number of argumets on line object creation!");[this._id1,this._id2]=e}_getAtomFromName(e,t){const n=" - Wrong atom format it must be '#CHAIN_NAME.#RESIDUE_NUMBER.#ATOM_NAME' (e.g. 'A.38.CO1')",i=e.getAtomByFullname(t);if(!i)throw new Error(t+n);return i}build(e){const t=new b.BufferGeometry;this._atom1=this._getAtomFromName(e,this._id1),this._atom2=this._getAtomFromName(e,this._id2);const n=this._atom1.position,i=this._atom2.position,r=new Float32Array([n.x,n.y,n.z,i.x,i.y,i.z]);t.setAttribute("position",new b.BufferAttribute(r,3)),t.computeBoundingBox(),this._line=new sr.Line(t,new Wr({lights:!1,overrideColor:!0,dashedLine:!0,fogTransparent:pe.now.bg.transparent})),this._line.computeLineDistances(),this._line.material.setUberOptions({fixedColor:new b.Color(this.opts.color),dashedLineSize:this.opts.dashSize,dashedLinePeriod:this.opts.dashSize+this.opts.gapSize}),this._line.material.updateUniforms(),this._line.raycast=function(a,l){},this._mesh=this._line;const o=e.getTransforms();o.length>0&&(this._mesh=new b.Group,this._mesh.add(this._line),yl.applyTransformsToMeshes(this._mesh,o))}updateToFrame(e){if(!this._atom1||!this._atom2||!this._line)return;const t=this._line.geometry;t.vertices[0].copy(e.getAtomPos(this._atom1.index)),t.vertices[1].copy(e.getAtomPos(this._atom2.index)),this._line.computeLineDistances(),t.computeBoundingSphere(),t.verticesNeedUpdate=!0}}rf.prototype.constructor=rf;rf.prototype.type="line";const rb=rf,vH=`precision highp float;\r
\r
uniform sampler2D srcTex;\r
uniform vec2 srcTexSize;\r
uniform vec2 thickness;\r
varying vec2 vUv;\r
\r
#ifdef DEPTH_OUTLINE\r
  uniform sampler2D srcDepthTex; //depthTexture\r
  uniform vec3 color;\r
  uniform float threshold;\r
#endif\r
\r
void main() {\r
\r
  vec2 pixelSize = thickness / srcTexSize;\r
\r
  #ifdef DEPTH_OUTLINE\r
    float c00 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,-pixelSize.y)).x;\r
    float c01 = texture2D(srcDepthTex, vUv + vec2(0,-pixelSize.y)).x;\r
    float c02 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,-pixelSize.y)).x;\r
    float c10 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,0)).x;\r
    float c12 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,0)).x;\r
    float c20 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,pixelSize.y)).x;\r
    float c21 = texture2D(srcDepthTex, vUv + vec2(0,pixelSize.y)).x;\r
    float c22 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,pixelSize.y)).x;\r
\r
    float horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r
    float vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r
\r
    float grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r
\r
    gl_FragColor = ( grad > threshold ) ? vec4(color.rgb, 1.0) : gl_FragColor = texture2D(srcTex, vUv);\r
\r
  #else\r
    vec4 c00 = texture2D(srcTex, vUv + vec2(-pixelSize.x,-pixelSize.y));\r
    vec4 c01 = texture2D(srcTex, vUv + vec2(0,-pixelSize.y));\r
    vec4 c02 = texture2D(srcTex, vUv + vec2(pixelSize.x,-pixelSize.y));\r
    vec4 c10 = texture2D(srcTex, vUv + vec2(-pixelSize.x,0));\r
    vec4 c12 = texture2D(srcTex, vUv + vec2(pixelSize.x,0));\r
    vec4 c20 = texture2D(srcTex, vUv + vec2(-pixelSize.x,pixelSize.y));\r
    vec4 c21 = texture2D(srcTex, vUv + vec2(0,pixelSize.y));\r
    vec4 c22 = texture2D(srcTex, vUv + vec2(pixelSize.x,pixelSize.y));\r
\r
    vec4 horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r
    vec4 vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r
\r
    vec4 grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r
    gl_FragColor = grad;\r
  #endif\r
}\r
`;class FE extends b.RawShaderMaterial{constructor(e){super(e);const t={uniforms:{srcTex:{type:"t",value:null},srcDepthTex:{type:"t",value:null},srcTexSize:{type:"v2",value:new b.Vector2(512,512)},color:{type:"v3",value:null},threshold:{type:"f",value:null},opacity:{type:"f",value:1},thickness:{type:"v2",value:new b.Vector2(1,1)}},vertexShader:mo,fragmentShader:vH,transparent:!0,depthTest:!1,depthWrite:!1};this.setValues(t)}copy(e){super.copy(e),this.depth=e.depth}setValues(e){if(typeof e>"u")return;super.setValues(e);const t={};this.depth&&(t.DEPTH_OUTLINE=1),this.defines=t}}FE.prototype.depth=!1;const OE=FE,SH=`precision highp float;\r
\r
// edge end finding algorithm parameters\r
#define FXAA_QUALITY_PS 8\r
#define FXAA_QUALITY_P0 1.0\r
#define FXAA_QUALITY_P1 1.5\r
#define FXAA_QUALITY_P2 2.0\r
#define FXAA_QUALITY_P3 2.0\r
#define FXAA_QUALITY_P4 2.0\r
#define FXAA_QUALITY_P5 2.0\r
#define FXAA_QUALITY_P6 4.0\r
#define FXAA_QUALITY_P7 12.0\r
// constants\r
float fxaaQualityEdgeThreshold = 0.125;\r
float fxaaQualityEdgeThresholdMin = 0.0625;\r
float fxaaQualitySubpix = 0.7; //0.65;\r
// global params\r
uniform sampler2D srcTex;\r
uniform vec2 srcTexelSize;\r
uniform vec3 bgColor;\r
// from vs\r
varying vec2 vUv;\r
//=====================================================================//\r
// calc luminance from rgb\r
//'float FxaaLuma(vec3 rgb) {return rgb.y * (0.587/0.299) + rgb.x; } // Lotte's idea about game luminance\r
float FxaaLuma(vec3 rgb) {return dot(rgb, vec3(0.299, 0.587, 0.114)); } // real luminance calculation\r
                                                                           // for non-real scene rendering\r
// texture sampling by pixel position(coords) and offset(in pixels)\r
 vec3 FxaaTex(sampler2D tex, vec2 pos, vec2 off,  vec2 res ) {\r
  #ifdef BG_TRANSPARENT\r
    vec4 color = texture2D( tex, pos + off * res );\r
    return mix(color.rgb, bgColor, 1.0 - color.a);\r
  #else\r
    return texture2D( tex, pos + off * res ).xyz;\r
  #endif\r
}\r
vec3 FxaaTexTop(sampler2D tex, vec2 pos) {\r
  #ifdef BG_TRANSPARENT\r
    vec4 color = texture2D( tex, pos );\r
    return mix(color.rgb, bgColor, 1.0 - color.a);\r
  #else\r
    return texture2D( tex, pos).xyz;\r
  #endif\r
}\r
vec4 FxaaTexTopAlpha(sampler2D tex, vec2 pos) {\r
  return texture2D( tex, pos);\r
}\r
\r
//=====================================================================//\r
void main() {\r
  // renaming\r
  vec2 posM = vUv;\r
  // get luminance for neighbours\r
  float lumaS = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, 1.0 ), srcTexelSize));\r
  float lumaE = FxaaLuma(FxaaTex(srcTex, posM, vec2( 1.0, 0.0 ), srcTexelSize));\r
  float lumaN = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, -1.0 ), srcTexelSize));\r
  float lumaW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, 0.0 ), srcTexelSize));\r
  float lumaM = FxaaLuma(FxaaTexTop(srcTex, posM));\r
  // find max and min luminance\r
  float rangeMax = max(max(lumaN, lumaW), max(lumaE, max(lumaS, lumaM)));\r
  float rangeMin = min(min(lumaN, lumaW), min(lumaE, min(lumaS, lumaM)));\r
  // calc maximum non-edge range\r
  float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\r
  float range = rangeMax - rangeMin;\r
  float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\r
  // exit when luma contrast is small (is not edge)\r
  if(range < rangeMaxClamped){\r
    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r
    return;\r
  }\r
  float subpixRcpRange = 1.0/range;\r
  // note: the sampling coordinates can be calculated in vertex shader but the approach doesn't affect performance\r
  // visibly, thus we decided to leave calculation here for better readability.\r
  // calc other neighbours luminance\r
  float lumaNE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0, -1.0 ), srcTexelSize));\r
  float lumaSW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0,  1.0 ), srcTexelSize));\r
  float lumaSE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0,  1.0 ), srcTexelSize));\r
  float lumaNW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, -1.0 ), srcTexelSize));\r
/*--------------span calculation and subpix amount calulation-----------------*/\r
  float lumaNS = lumaN + lumaS;\r
  float lumaWE = lumaW + lumaE;\r
  float subpixNSWE = lumaNS + lumaWE;\r
  float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\r
  float edgeVert1 = (-2.0 * lumaM) + lumaWE;\r
/*--------------------------------------------------------------------------*/\r
  float lumaNESE = lumaNE + lumaSE;\r
  float lumaNWNE = lumaNW + lumaNE;\r
  float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\r
  float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\r
/*--------------------------------------------------------------------------*/\r
  float lumaNWSW = lumaNW + lumaSW;\r
  float lumaSWSE = lumaSW + lumaSE;\r
  float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\r
  float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\r
  float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\r
  float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\r
  float edgeHorz = abs(edgeHorz3) + edgeHorz4;\r
  float edgeVert = abs(edgeVert3) + edgeVert4;\r
/*--------------------subpix amount calulation------------------------------*/\r
  float subpixNWSWNESE = lumaNWSW + lumaNESE;\r
  float lengthSign = srcTexelSize.x;\r
  bool horzSpan = edgeHorz >= edgeVert;\r
   // debug  code edge span visualization\r
/*'  if (horzSpan)\r
      gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\r
  else\r
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r
  return;*/\r
  float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\r
/*--------------------------------------------------------------------------*/\r
  if(!horzSpan) lumaN = lumaW;\r
  if(!horzSpan) lumaS = lumaE;\r
  if(horzSpan) lengthSign = srcTexelSize.y;\r
  float subpixB = (subpixA * (1.0/12.0)) - lumaM;\r
/*--------------------------------------------------------------------------*/\r
  float gradientN = lumaN - lumaM;\r
  float gradientS = lumaS - lumaM;\r
  float lumaNN = lumaN + lumaM;\r
  float lumaSS = lumaS + lumaM;\r
  bool pairN = abs(gradientN) >= abs(gradientS);\r
  float gradient = max(abs(gradientN), abs(gradientS));\r
  if(pairN) lengthSign = -lengthSign;\r
  float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\r
/*--------------------------------------------------------------------------*/\r
  vec2 posB;\r
  posB = posM;\r
  vec2 offNP;\r
  offNP.x = (!horzSpan) ? 0.0 : srcTexelSize.x;\r
  offNP.y = ( horzSpan) ? 0.0 : srcTexelSize.y;\r
  if(!horzSpan) posB.x += lengthSign * 0.5;\r
  if( horzSpan) posB.y += lengthSign * 0.5;\r
/*--------------------------------------------------------------------------*/\r
  vec2 posN;\r
  posN = posB - offNP * FXAA_QUALITY_P0;\r
  vec2 posP;\r
  posP = posB + offNP * FXAA_QUALITY_P0;\r
  float subpixD = ((-2.0)*subpixC) + 3.0;\r
  float lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN));\r
  float subpixE = subpixC * subpixC;\r
  float lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP));\r
/*--------------------------------------------------------------------------*/\r
  if(!pairN) lumaNN = lumaSS;\r
  float gradientScaled = gradient * 1.0/4.0;\r
  float lumaMM = lumaM - lumaNN * 0.5;\r
  float subpixF = subpixD * subpixE;\r
  bool lumaMLTZero = lumaMM < 0.0;\r
/*---------------------looped edge-end search-------------------------------*/\r
  lumaEndN -= lumaNN * 0.5;\r
  lumaEndP -= lumaNN * 0.5;\r
  bool doneN = abs(lumaEndN) >= gradientScaled;\r
  bool doneP = abs(lumaEndP) >= gradientScaled;\r
  if(!doneN) posN -= offNP * FXAA_QUALITY_P1;\r
  bool doneNP = (!doneN) || (!doneP);\r
  if(!doneP) posP += offNP * FXAA_QUALITY_P1;\r
/*--------------------------------------------------------------------------*/\r
  if(doneNP) {\r
    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
    doneN = abs(lumaEndN) >= gradientScaled;\r
    doneP = abs(lumaEndP) >= gradientScaled;\r
    if(!doneN) posN -= offNP * FXAA_QUALITY_P2;\r
    doneNP = (!doneN) || (!doneP);\r
    if(!doneP) posP += offNP * FXAA_QUALITY_P2;\r
/*--------------------------------------------------------------------------*/\r
    #if (FXAA_QUALITY_PS > 3)\r
      if(doneNP) {\r
        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
        doneN = abs(lumaEndN) >= gradientScaled;\r
        doneP = abs(lumaEndP) >= gradientScaled;\r
        if(!doneN) posN -= offNP * FXAA_QUALITY_P3;\r
        doneNP = (!doneN) || (!doneP);\r
        if(!doneP) posP += offNP * FXAA_QUALITY_P3;\r
/*--------------------------------------------------------------------------*/\r
        #if (FXAA_QUALITY_PS > 4)\r
          if(doneNP) {\r
            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
            doneN = abs(lumaEndN) >= gradientScaled;\r
            doneP = abs(lumaEndP) >= gradientScaled;\r
            if(!doneN) posN -= offNP * FXAA_QUALITY_P4;\r
            doneNP = (!doneN) || (!doneP);\r
            if(!doneP) posP += offNP * FXAA_QUALITY_P4;\r
/*--------------------------------------------------------------------------*/\r
            #if (FXAA_QUALITY_PS > 5)\r
               if(doneNP) {\r
                 if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                 if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                 if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                 if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                 doneN = abs(lumaEndN) >= gradientScaled;\r
                 doneP = abs(lumaEndP) >= gradientScaled;\r
                 if(!doneN) posN -= offNP * FXAA_QUALITY_P5;\r
                 doneNP = (!doneN) || (!doneP);\r
                 if(!doneP) posP += offNP * FXAA_QUALITY_P5;\r
/*--------------------------------------------------------------------------*/\r
                 #if (FXAA_QUALITY_PS > 6)\r
                   if(doneNP) {\r
                     if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                     if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                     if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                     if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                     doneN = abs(lumaEndN) >= gradientScaled;\r
                     doneP = abs(lumaEndP) >= gradientScaled;\r
                     if(!doneN) posN -= offNP * FXAA_QUALITY_P6;\r
                     doneNP = (!doneN) || (!doneP);\r
                     if(!doneP) posP += offNP * FXAA_QUALITY_P6;\r
/*--------------------------------------------------------------------------*/\r
                     #if (FXAA_QUALITY_PS > 7)\r
                       if(doneNP) {\r
                         if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                         if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                         if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                         if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                         doneN = abs(lumaEndN) >= gradientScaled;\r
                         doneP = abs(lumaEndP) >= gradientScaled;\r
                         if(!doneN) posN -= offNP * FXAA_QUALITY_P7;\r
                         doneNP = (!doneN) || (!doneP);\r
                         if(!doneP) posP += offNP * FXAA_QUALITY_P7;\r
/*--------------------------------------------------------------------------*/\r
                       }\r
                     #endif\r
                   }\r
                 #endif\r
               }\r
             #endif\r
           }\r
         #endif\r
      }\r
    #endif\r
  }\r
/*----------------calculate subpix offset due to edge ends-------------------*/\r
  float dstN = posM.x - posN.x;\r
  float dstP = posP.x - posM.x;\r
  if(!horzSpan) dstN = posM.y - posN.y;\r
  if(!horzSpan) dstP = posP.y - posM.y;\r
/*--------------------------------------------------------------------------*/\r
  bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\r
  float spanLength = (dstP + dstN);\r
  bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\r
  float spanLengthRcp = 1.0 / spanLength;\r
/*--------------------------------------------------------------------------*/\r
  bool directionN = dstN < dstP;\r
  float dst = min(dstN, dstP);\r
  bool goodSpan = directionN ? goodSpanN : goodSpanP;\r
  float subpixG = subpixF * subpixF;\r
  float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\r
  float subpixH = subpixG * fxaaQualitySubpix;\r
/*-----------------calc texture offest using subpix-------------------------*/\r
  float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\r
  float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\r
\r
  float offset = pixelOffsetSubpix * lengthSign;\r
  #ifdef BG_TRANSPARENT\r
    // get original texel\r
    vec4 rgbaA = FxaaTexTopAlpha(srcTex, posM);\r
    // calc step to blended texel\r
    vec2 step = sign((!horzSpan) ? vec2 (offset, 0.0) : vec2 (0.0, offset));\r
    // get neighboring texel\r
    vec4 rgbaB = FxaaTexTopAlpha(srcTex, posM + step * srcTexelSize);\r
    //  calc blend factor from offset\r
    float f = (!horzSpan) ? offset / srcTexelSize.x : offset / srcTexelSize.y;\r
    f = abs(f);\r
    // calc alpha (special formula to emulate blending with bg)\r
    gl_FragColor.a = 1.0 - mix(1.0 - rgbaA.a, 1.0 - rgbaB.a, f);\r
    // calc color (special formula to emulate blending with bg)\r
    gl_FragColor.rgb = mix(rgbaA.rgb * rgbaA.a, rgbaB.rgb * rgbaB.a, f) / gl_FragColor.a;\r
  #else\r
    if(!horzSpan) {\r
       posM.x += offset;\r
    } else {\r
       posM.y += offset;\r
    }\r
    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r
  #endif\r
  return;\r
}\r
`;class DE extends b.RawShaderMaterial{constructor(e){super(e),this.setValues.call(this,{uniforms:{srcTex:{type:"t",value:null},srcTexelSize:{type:"v2",value:new b.Vector2(1/512,1/512)},bgColor:{type:"c",value:new b.Color(16777215)}},vertexShader:mo,fragmentShader:SH,transparent:!1,depthTest:!1,depthWrite:!1}),this.setValues(e)}copy(e){super.copy(e),this.depth=e.depth}setValues(e){if(typeof e>"u")return;super.setValues(e);const t={};this.bgTransparent&&(t.BG_TRANSPARENT=1),this.defines=t}}DE.prototype.bgTransparent=!1;const bH=DE,wH=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 32\r
uniform vec3 samplesKernel[MAX_SAMPLES_COUNT];\r
uniform sampler2D noiseTexture;\r
uniform vec2      noiseTexelSize;\r
uniform sampler2D diffuseTexture;\r
uniform sampler2D depthTexture;\r
uniform sampler2D normalTexture;\r
uniform vec2      srcTexelSize;\r
uniform vec2      camNearFar;\r
uniform mat4      projMatrix;\r
\r
uniform float aspectRatio;\r
uniform float tanHalfFOV;\r
\r
uniform float kernelRadius;\r
uniform float depthThreshold;\r
uniform float factor;\r
\r
varying vec2 vUv;\r
\r
float CalcViewZ(vec2 screenPos)\r
{\r
  float depth = texture2D(depthTexture, screenPos).x;\r
  // [0, 1]->[-1, 1]\r
  float clipedZ = 2.0 * depth - 1.0;\r
  // see THREE.js camera.makeFrustum for projection details\r
  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r
}\r
\r
vec3 ViewPosFromDepth(vec2 screenPos)\r
{\r
  vec3 viewPos;\r
  viewPos.z = CalcViewZ(screenPos);\r
  //[0, 1]->[-1, 1]\r
  vec2 projPos = 2.0 * screenPos - 1.0;\r
  // reconstruct viewposition in right-handed sc with z to viewer\r
  viewPos.xy = vec2(\r
                    projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r
                    projPos.y * tanHalfFOV * abs(viewPos.z)\r
                   );\r
  return viewPos;\r
}\r
\r
void main() {\r
  vec3 viewPos = ViewPosFromDepth(vUv);\r
  // remap coordinates to prevent noise exture rescale\r
  vec2 vUvNoise = vUv / srcTexelSize * noiseTexelSize;\r
  vec4 normalData = texture2D(normalTexture, vUv);\r
  // return for background fragments (their normals are zero vectors)\r
  if (length(normalData.rgb) < EPSILON) {\r
    // 0.0 in alpha component means that it is background fragment\r
    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\r
    return;\r
  }\r
  //[0, 1] -> [-1, 1]\r
  vec3 normal = (normalData.rgb * 2.0 - 1.0);\r
  // normalData.a store 1.0 if normal was build for frontfaced surface\r
  // and 0.0 in other case\r
  if (normalData.a < EPSILON) {\r
    normal *= -1.0;\r
  }\r
  // get random vector for sampling sphere rotation\r
  vec3 randN = texture2D(noiseTexture, vUvNoise).rgb * 2.0 - 1.0;\r
  randN = normalize(randN);\r
  // build TBN (randomly rotated around normal)\r
  vec3 tangent   = normalize(randN - normal * dot(randN, normal));\r
  vec3 bitangent = cross(tangent, normal);\r
  mat3 TBN = mat3(tangent, bitangent, normal);\r
  // calc AO value\r
  float AO = 0.0;\r
  for (int i = 0 ; i < MAX_SAMPLES_COUNT ; i++) {\r
    // rotate sampling kernel around normal\r
    vec3 reflectedSample = TBN * samplesKernel[i];\r
    // get sample\r
    vec3 samplePos = viewPos + reflectedSample * kernelRadius;\r
\r
    // project sample to screen to get sample's screen pos\r
    vec4 SampleScrPos = vec4(samplePos, 1.0);\r
    // eye -> clip\r
    SampleScrPos = projMatrix * SampleScrPos;\r
    // normalize\r
    SampleScrPos.xy /= SampleScrPos.w;\r
    //[-1, 1] -> [0, 1]\r
    SampleScrPos.xy = (SampleScrPos.xy + vec2(1.0)) * 0.5;\r
\r
    // get view z for sample projected to the objct surface\r
    float sampleDepth = CalcViewZ(SampleScrPos.xy);\r
    // calc occlusion made by object surface at the sample\r
    AO += step(samplePos.z, sampleDepth);\r
  }\r
  // calc result AO-map color\r
  AO = 1.0 - max(0.0, AO / float(MAX_SAMPLES_COUNT) * factor);\r
  // write value to AO-map\r
  gl_FragColor = vec4(AO, AO, AO, 1.0);\r
}\r
`,MH=[new b.Vector3(.295184,.077723,.068429),new b.Vector3(-.271976,-.365221,.838363),new b.Vector3(.547713,.467576,.488515),new b.Vector3(.662808,-.031733,.584758),new b.Vector3(-.025717,.218955,.657094),new b.Vector3(-.310153,-.365223,.370701),new b.Vector3(-.101407,-.006313,.747665),new b.Vector3(-.769138,.360399,.086847),new b.Vector3(-.271988,-.27514,.905353),new b.Vector3(.09674,-.566901,.700151),new b.Vector3(.562872,-.735136,.094647),new b.Vector3(.379877,.359278,.190061),new b.Vector3(.519064,-.023055,.405068),new b.Vector3(-.301036,.114696,.088885),new b.Vector3(-.282922,.598305,.487214),new b.Vector3(-.181859,.25167,.679702),new b.Vector3(-.191463,-.635818,.512919),new b.Vector3(-.293655,.427423,.078921),new b.Vector3(-.267983,.680534,.13288),new b.Vector3(.139611,.319637,.477439),new b.Vector3(-.352086,.31104,.653913),new b.Vector3(.321032,.805279,.487345),new b.Vector3(.073516,.820734,.414183),new b.Vector3(-.155324,.589983,.41146),new b.Vector3(.335976,.170782,.527627),new b.Vector3(.46346,-.355658,.167689),new b.Vector3(.222654,.59655,.769406),new b.Vector3(.922138,-.04207,.147555),new b.Vector3(-.72705,-.329192,.369826),new b.Vector3(-.090731,.53382,.463767),new b.Vector3(-.323457,-.876559,.238524),new b.Vector3(-.663277,-.372384,.342856)];class EH extends b.RawShaderMaterial{constructor(){super(),this.setValues.call(this,{uniforms:{noiseTexture:{type:"t",value:_l.noiseTexture},noiseTexelSize:{type:"v2",value:new b.Vector2(1/_l.noiseWidth,1/_l.noiseHeight)},diffuseTexture:{type:"t",value:null},normalTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new b.Vector2(1/512,1/512)},camNearFar:{type:"v2",value:new b.Vector2(1,10)},projMatrix:{type:"mat4",value:new b.Matrix4},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},samplesKernel:{type:"v3v",value:MH},kernelRadius:{type:"f",value:1},depthThreshold:{type:"f",value:1},factor:{type:"f",value:1}},vertexShader:mo,fragmentShader:wH,transparent:!1,depthTest:!1,depthWrite:!1})}}const AH=EH,TH=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 5\r
uniform float samplesOffsets[MAX_SAMPLES_COUNT];\r
uniform sampler2D aoMap;\r
uniform sampler2D depthTexture;\r
uniform vec2      srcTexelSize;\r
\r
varying vec2 vUv;\r
\r
void main() {\r
  float x = vUv.x;\r
  float y = vUv.y;\r
  vec4 res = vec4(0.0);\r
  res.a = texture2D(aoMap, vec2(x, y )).a;\r
  // return for background fragments (0.0 in alpha component means that it is background fragment)\r
  if (res.a < EPSILON) {\r
    gl_FragColor = res;\r
    return;\r
  }\r
\r
  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r
  float weightSum = 0.0;\r
  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r
    if (texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).a < EPSILON) {\r
      continue;\r
    }\r
    vec2 samplePos = vec2(x + samplesOffsets[i] * srcTexelSize.x, y);\r
    float depth = texture2D(depthTexture, samplePos).x;\r
    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r
    res.rgb += texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).rgb * weight;\r
    weightSum += weight;\r
  }\r
  res.rgb = res.rgb / weightSum;\r
  gl_FragColor = res;\r
}\r
`,CH=[-2,-1,0,1,2];class RH extends b.RawShaderMaterial{constructor(){super(),this.setValues.call(this,{uniforms:{depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new b.Vector2(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:CH}},vertexShader:mo,fragmentShader:TH,transparent:!1,depthTest:!1,depthWrite:!1})}}const PH=RH,IH=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 5\r
uniform float samplesOffsets[MAX_SAMPLES_COUNT];\r
uniform sampler2D diffuseTexture;\r
uniform sampler2D aoMap;\r
uniform sampler2D depthTexture;\r
uniform vec2      srcTexelSize;\r
\r
uniform mat4  projMatrix;\r
uniform float aspectRatio;\r
uniform float tanHalfFOV;\r
\r
#ifdef USE_FOG\r
  uniform vec2 fogNearFar;\r
  uniform vec4 fogColor;\r
#endif\r
varying vec2 vUv;\r
\r
float CalcViewZ(vec2 screenPos)\r
{\r
  float depth = texture2D(depthTexture, screenPos).x;\r
  // [0, 1]->[-1, 1]\r
  float clipedZ = 2.0 * depth - 1.0;\r
  // see THREE.js camera.makeFrustum for projection details\r
  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r
}\r
\r
vec3 ViewPosFromDepth(vec2 screenPos)\r
{\r
  vec3 viewPos;\r
  viewPos.z = CalcViewZ(screenPos);\r
  //[0, 1]->[-1, 1]\r
  vec2 projPos = 2.0 * screenPos - 1.0;\r
  // reconstruct viewposition in right-handed sc with z to viewer\r
  viewPos.xy = vec2(\r
  projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r
  projPos.y * tanHalfFOV * abs(viewPos.z)\r
  );\r
  return viewPos;\r
}\r
\r
void main() {\r
  vec3 viewPos = ViewPosFromDepth(vUv);\r
  float x = vUv.x;\r
  float y = vUv.y;\r
  vec4 color = texture2D(diffuseTexture, vec2(x, y));\r
  vec4 res = vec4(0.0);\r
  res.a = texture2D(aoMap, vec2(x, y )).a;\r
  // return for background fragments (0.0 in alpha component means that it is background fragment)\r
  if (res.a < EPSILON) {\r
    gl_FragColor = color;\r
    return;\r
  }\r
\r
  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r
  float weightSum = 0.0;\r
  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r
    if (texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).a < EPSILON) {\r
      continue;\r
    }\r
    vec2 samplePos = vec2(x, y + samplesOffsets[i] * srcTexelSize.y);\r
    float depth = texture2D(depthTexture, samplePos).x;\r
    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r
    res.rgb += texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).rgb * weight;\r
    weightSum += weight;\r
  }\r
  res.rgb /= weightSum;\r
\r
  #if defined(USE_FOG) && !defined(FOG_TRANSPARENT)\r
    // Add fog to the result value\r
    // Proper way to get an image with fog and ao requires formula:\r
    //          gl_FragColor = fragColor*AO*(1-fogFactor) + fogColor*fogFactor\r
    // But we have already fogged molecule to add AO too. Let's split the straight formula into our real steps!\r
    // We have:  AO, fogFactor, fogColor,\r
    //          color = fragColor*(1-fogFactor) + fogColor*fogFactor (it comes from diffuseTexture,\r
    //                                                                where molecule has been already drawn with fog)\r
    // Transform:\r
    //          fragColor*AO*(1-fogFactor) + fogColor*fogFactor =\r
    //        = [fragColor*(1-fogFactor) = color - fogColor*fogFactor] =\r
    //        = (color - fogColor*fogFactor)*AO + fogColor*fogFactor =\r
    //        = color*AO + fogColor*fogFactor*(1 - AO)\r
    // Result:  gl_FragColor = color*AO + fogColor*fogFactor*(1 - AO)\r
    float fogFactor = smoothstep(fogNearFar.x, fogNearFar.y, - viewPos.z) * fogColor.a;\r
    gl_FragColor.rgb = color.rgb * res.rgb + fogColor.rgb * fogFactor *(vec3(1.0, 1.0, 1.0) - res.rgb);\r
  #else\r
    gl_FragColor.rgb = color.rgb * res.rgb;\r
  #endif\r
  gl_FragColor.a = color.a;\r
}\r
`,LH=[-2,-1,0,1,2];class K_ extends b.RawShaderMaterial{constructor(e){super(e),this.setValues.call(this,{uniforms:{diffuseTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new b.Vector2(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:LH},projMatrix:{type:"mat4",value:new b.Matrix4},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},fogNearFar:{type:"v2",value:new b.Vector2(100,100)},fogColor:{type:"v4",value:new b.Vector4(0,.5,0,1)}},vertexShader:mo,fragmentShader:IH,transparent:!1,depthTest:!1,depthWrite:!1}),this.setValues(e)}setValues(e){if(typeof e>"u")return;super.setValues(e);const t={};this.useFog&&(t.USE_FOG=1),this.fogTransparent&&(t.FOG_TRANSPARENT=1),this.defines=t}}K_.prototype.useFog=!0;K_.prototype.fogTransparent=!1;const NH=K_,FH=`precision highp float;\r
\r
uniform sampler2D srcL;\r
uniform sampler2D srcR;\r
varying vec2 vUv;\r
\r
void main() {\r
  vec4 l = texture2D(srcL, vUv);\r
  vec4 r = texture2D(srcR, vUv);\r
  gl_FragColor = vec4(l.r, r.g, r.b, 1.0);\r
}\r
`;class OH extends b.RawShaderMaterial{constructor(){super();const e={uniforms:{srcL:{type:"t",value:null},srcR:{type:"t",value:null}},vertexShader:mo,fragmentShader:FH,transparent:!1,depthTest:!1,depthWrite:!1};this.setValues(e)}}const DH=OH;class UH{constructor(){this.position=new b.Vector3(0,0,0),this.scale=1,this.orientation=new b.Quaternion(0,0,0,1)}set(e,t,n){this.position=e,this.scale=t,this.orientation=n}}const BH=1.5;class zH{setup(e,t){this._startTime=void 0,this._endTime=void 0,this._isPaused=!1,this._srcView=e,this._dstView=t,this._isMoving=!1}isMoving(){return this._isMoving}wasStarted(){return typeof this._startTime<"u"&&typeof this._endTime<"u"}start(){this._startTime=Date.now();const e=pe.now.interpolateViews?BH*1e3:0;this._endTime=this._startTime+e,this._isMoving=!0}getCurrentView(){if(typeof this._srcView>"u"||typeof this._dstView>"u"||!this._isMoving||!this.wasStarted())return{success:!1};let e=this.createView();const t=Date.now();if(t>this._endTime)return e=this._dstView,this.reset(),{success:!0,view:e};const n=(t-this._startTime)/(this._endTime-this._startTime);return e.position.copy(this._srcView.position),e.position.lerp(this._dstView.position,n),e.scale=(1-n)*this._srcView.scale+n*this._dstView.scale,e.orientation.copy(this._srcView.orientation),e.orientation.slerp(this._dstView.orientation,n),{success:!0,view:e}}reset(){this._startTime=this._endTime=0,this._isMoving=!1}pause(){this._isPaused||(this.setup(this.getCurrentView().view,this._dstView),this._isPaused=!0)}resume(){this._isPaused=!1}createView(){return new UH}}const VH=4e3,kH="Cnt";function GH(s,e){const t=s.length,n=[];for(let i=0,r=0;r<t;i++,r+=e)n[i]=s.slice(r,r+e);return n}function Tr(s,e){this.context=s,this._opts=Me.default.merge({path:"/"},e)}Ah(Tr.prototype);Tr.prototype.removeCookie=function(s){const e=this._toCount(s);let t=this._getSimpleCookie(e);if(!t){this._removeSimpleCookie(s);return}this._removeSimpleCookie(e),t=parseInt(t,10);for(let n=0;n<t;++n)this._removeSimpleCookie(s+n)};Tr.prototype.setCookie=function(s,e){this.removeCookie(s),e=encodeURIComponent(e);const t=GH(e,VH-s.length-1),n=t.length;if(n===1){this._setSimpleCookie(s,e);return}const i=this._toCount(s);this._setSimpleCookie(i,n.toString());for(let r=0;r<n;++r)this._setSimpleCookie(s+r,t[r])};Tr.prototype.getCookie=function(s){const e=this._toCount(s);let t=this._getSimpleCookie(e);if(!t)return this._getSimpleCookie(s);t=parseInt(t,10);const n=[];for(let i=0;i<t;++i)n[i]=this._getSimpleCookie(s+i);return n.join("")};Tr.prototype._toCount=function(s){return s+kH};Tr.prototype._removeSimpleCookie=function(s){document.cookie=`${s}=; expires=Thu, 01 Jan 1970 00:00:01 GMT;`};Tr.prototype._getExpirationDate=function(){const s=new Date;return s.setFullYear(s.getFullYear()+10),s};Tr.prototype._setSimpleCookie=function(s,e){document.cookie=`${s}=${e};expires=${this._getExpirationDate().toUTCString()};path=${this._opts.path}`};Tr.prototype._getSimpleCookie=function(s){const e=document.cookie.match(new RegExp(`(?:^|; )${s}=([^;]*)`));return e?decodeURIComponent(e[1]):""};Tr.prototype._exists=function(s){return document.cookie.match(new RegExp(`(?:^|; )${s}=([^;]*)`))};const HH=Tr;function WH(s){function e(r){r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR";let o=null;function a(){o.removeEventListener("end",a),r.textContent="ENTER VR",o=null}function l(h){h.addEventListener("end",a),s._gfx.renderer.xr.setReferenceSpaceType("local"),s._gfx.renderer.xr.setSession(h),r.textContent="EXIT VR",o=h}r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){if(o===null){const h={optionalFeatures:["local-floor","bounded-floor"]};navigator.xr.requestSession("immersive-vr",h).then(l),s.moveSceneBehindHeadset()}else o.end()}}function t(r){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.textContent="VR NOT FOUND",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null}function n(r){r.style.position="absolute",r.style.bottom="20px",r.style.padding="12px 6px",r.style.border="1px solid #fff",r.style.borderRadius="4px",r.style.background="transparent",r.style.color="#fff",r.style.font="normal 13px sans-serif",r.style.textAlign="center",r.style.opacity="0.5",r.style.outline="none",r.style.zIndex="999"}if("xr"in navigator){const r=document.createElement("button");return r.style.display="none",n(r),navigator.xr.isSessionSupported("immersive-vr").then(o=>o?e(r):t(r)),r}const i=document.createElement("a");return i.href="https://webvr.info",i.innerHTML="WEBXR NOT SUPPORTED",i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",n(i),i}class XH{constructor(e){this._mainCamera=new b.PerspectiveCamera,this._button=null,this._onToggle=e,this._molContainer=new yt.RCGroup,this._user=new yt.RCGroup,this._scalingPivot=new b.Object3D,this._user.add(this._scalingPivot),this._controller1=null,this._controller2=null,this._pressedGripsCounter=0,this._distance=0,this._gfx=null}startScalingByControllers(){this._distance=this._controller1.position.distanceTo(this._controller2.position),yt.getMiddlePoint(this._controller1.position,this._controller2.position,this._scalingPivot.position),this._scalingPivot.scale.set(1,1,1),this._scalingPivot.updateMatrix(),this._scalingPivot.updateMatrixWorld(),this._scalingPivot.addSavingWorldTransform(this._molContainer)}stopScalingByControllers(){this._gfx.scene.addSavingWorldTransform(this._molContainer)}handleGripsDown(e){this._pressedGripsCounter++,this._pressedGripsCounter===2?this.startScalingByControllers():this._pressedGripsCounter===1&&e.target.addSavingWorldTransform(this._molContainer)}handleGripsUp(e){this._pressedGripsCounter--,this._pressedGripsCounter===1?(this.stopScalingByControllers(),(e.target===this._controller1?this._controller2:this._controller1).addSavingWorldTransform(this._molContainer)):this._pressedGripsCounter===0&&this._gfx.scene.addSavingWorldTransform(this._molContainer)}enable(e){if(!e){In.warn("WebVR couldn't be enabled, because gfx is not defined");return}this._gfx=e;const{renderer:t,camera:n}=e;if(!t)throw new Error("No renderer is available to toggle WebVR");if(!n)throw new Error("No camera is available to toggle WebVR");t.xr.enabled=!0,this._button?this._button.style.display="block":(this._button=WH(this),document.body.appendChild(this._button)),this._mainFog=pe.now.fog,pe.set("fog",!1),this._plugVRNodesIntoScene(e,t),this._setControllersListeners(),this._onToggle&&this._onToggle(!0)}_plugVRNodesIntoScene(e,t){this._mainCamera.copy(e.camera),e.scene.add(this._user),e.scene.add(this._molContainer),this._molContainer.add(e.root),this._controller1=t.xr.getController(0),this._controller2=t.xr.getController(1);const n=this._createControllerMesh();this._controller1.add(n),this._controller2.add(n.clone()),this._user.add(this._controller1),this._user.add(this._controller2)}_setControllersListeners(){this._controller1.addEventListener("selectstart",e=>{this.handleGripsDown(e)}),this._controller1.addEventListener("selectend",e=>{this.handleGripsUp(e)}),this._controller2.addEventListener("selectstart",e=>{this.handleGripsDown(e)}),this._controller2.addEventListener("selectend",e=>{this.handleGripsUp(e)}),this._controller1.addEventListener("squeezestart",e=>{this.handleGripsDown(e)}),this._controller1.addEventListener("squeezeend",e=>{this.handleGripsUp(e)}),this._controller2.addEventListener("squeezestart",e=>{this.handleGripsDown(e)}),this._controller2.addEventListener("squeezeend",e=>{this.handleGripsUp(e)})}disable(){if(!this._gfx)return;const{renderer:e,camera:t}=this._gfx;if(!e)throw new Error("No renderer is available to toggle WebVR");e.setAnimationLoop(null);const n=e.xr.getSession();n&&n.end(),e.xr.enabled=!1,this._button&&(this._button.style.display="none"),pe.set("fog",this._mainFog),this._unplugVRNodesFromScene(t),this._onToggle&&this._onToggle(!1)}_unplugVRNodesFromScene(e){this._mainCamera&&e&&e.copy(this._mainCamera);const t=this._molContainer.children[0];t&&this._gfx.scene.add(t),this._molContainer.parent.remove(this._molContainer),this._user&&this._gfx.scene.remove(this._user),this._molContainer=null,this._user=null,this._scalingPivot=null,this._user=null,this._controller1=null,this._controller2=null}_createControllerMesh(){const e=new b.CylinderGeometry(.04,.04,.3),t=new Wr({lights:!1,overrideColor:!0});t.setUberOptions({fixedColor:new b.Color(4474111)}),t.updateUniforms();const n=new b.Mesh(e,t);return n.rotateX(-Math.PI/2),n}updateMoleculeScale(){if(!this._controller1||!this._controller2)return;const e=this;if(e._pressedGripsCounter===2){yt.getMiddlePoint(e._controller1.position,e._controller2.position,e._scalingPivot.position);const t=e._controller1.position.distanceTo(e._controller2.position),n=t/e._distance;e._scalingPivot.scale.multiplyScalar(n),e._distance=t}}moveSceneBehindHeadset(){const e=this._gfx,{camera:t}=e,n=this._molContainer;n.matrix.identity(),n.position.set(0,0,-4),n.updateMatrix(),n.matrixWorld.multiplyMatrices(t.matrixWorld,n.matrix),e.scene.addSavingWorldTransform(n),this._onToggle&&this._onToggle(!0)}getCanvas(){const e=this._gfx;return e&&e.renderer?e.renderer.domElement:null}}const YH=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform vec3 aberration;\r
\r
void main() {\r
  vec2 uv = vUv * 2.0 - 1.0;\r
  \r
  gl_FragColor.r = texture2D(srcTex, 0.5 * (uv * aberration[0] + 1.0)).r;\r
  gl_FragColor.g = texture2D(srcTex, 0.5 * (uv * aberration[1] + 1.0)).g;\r
  gl_FragColor.b = texture2D(srcTex, 0.5 * (uv * aberration[2] + 1.0)).b;\r
  gl_FragColor.a = 1.0;\r
}`,{selectors:sf,Atom:jH,Residue:qH,Chain:$H,Molecule:ZH}=On,dn={COMPLEX:0,COMPONENT:1,FRAGMENT:2},gg="Could not find suitable loader for this source",KH="Could not find suitable parser for this source";b.ColorManagement.enabled=!1;const{createElement:Od}=Oe;function JH(s,e,t){s.near=e-t*pe.now.fogNearFactor,s.far=e+t*pe.now.fogFarFactor}function sb(s){const e=s.lastIndexOf(".");return e>=0&&(s=s.substr(0,e)),s}function QH(s){let e=!1;return s.forEachComponent(t=>{t.forEachResidue(n=>{n._isValid&&(e=!0)})}),e}function ob(s,e,t){t!==void 0?s.debug(`${e}... ${Math.floor(t*100)}%`):s.debug(`${e}...`)}function Gf(){return pe.now.fogColorEnable?pe.now.fogColor:pe.now.bg.color}function Se(s){Yi.call(this),this._opts=Me.default.merge({settingsCookie:"settings",cookiePath:"/"},s),this._gfx=null,this._interpolator=new zH,this._container=s&&s.container||document.getElementById("miew-container")||Me.default.head(document.getElementsByClassName("miew-container"))||document.body,this._containerRoot=this._container,this._running=!1,this._halting=!1,this._building=!1,this._needRender=!0,this._hotKeysEnabled=!0,this.settings=pe;const e=In;e.console=!1,e.level="info",this.logger=e,this._cookies=new HH(this),this.restoreSettings(),s&&s.settings&&this.settings.set(s.settings),this._spinner=null,this._loading=[],this._animInterval=null,this._visuals={},this._curVisualName=null,this._objects=[],this._sourceWindow=null,this.reset(),this._repr&&e.debug(`Selected ${this._repr.mode.name} mode with ${this._repr.colorer.name} colorer.`);const t=this;Se.registeredPlugins.forEach(n=>{n.call(t)}),this._initOnSettingsChanged()}Se.prototype=Object.create(Yi.prototype);Se.prototype.constructor=Se;Se.prototype.getMaxRepresentationCount=function(){return bs.NUM_REPRESENTATION_BITS};function J_(s,e){const t=s;for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(e)}Se.prototype._updateShadowCamera=function(){const s=new b.Matrix4,e=new b.Vector3,t={center:new b.Vector3,halfSize:new b.Vector3};return function(){this._gfx.scene.updateMatrixWorld();for(let n=0;n<this._gfx.scene.children.length;n++)if(this._gfx.scene.children[n].type==="DirectionalLight"){const i=this._gfx.scene.children[n];s.copy(i.shadow.camera.matrixWorldInverse),this.getOBB(s,t),e.subVectors(i.target.position,i.position),i.position.subVectors(t.center,e),i.target.position.copy(t.center),i.shadow.bias=.09,i.shadow.camera.bottom=-t.halfSize.y,i.shadow.camera.top=t.halfSize.y,i.shadow.camera.right=t.halfSize.x,i.shadow.camera.left=-t.halfSize.x,i.shadow.camera.near=e.length()-t.halfSize.z,i.shadow.camera.far=e.length()+t.halfSize.z,i.shadow.camera.updateProjectionMatrix()}}}();Se.prototype.init=function(){const s=this._container,e=Oe.createElement("div",{class:"miew-canvas"});J_(s,e),this._container=e;const t=document.createDocumentFragment();if(t.appendChild(this._msgMode=Od("div",{class:"mode-message overlay"},Od("p",{},"COMPONENT EDIT MODE"))),t.appendChild(this._msgAtomInfo=Od("div",{class:"atom-info overlay"},Od("p",{},""))),s.appendChild(t),this._gfx!==null)return!0;const n=this;this._showMessage("Viewer is being initialized...");try{this._initGfx(),this._initListeners(),this._spinner=new pB({lines:13,length:28,width:14,radius:42,color:"#fff",zIndex:700});const r=NE();r.addEventListener("keydown",a=>{n._onKeyDown(a)}),r.addEventListener("keyup",a=>{n._onKeyUp(a)}),this._objectControls=new JG(this._gfx.root,this._gfx.pivot,this._gfx.camera,this._gfx.renderer.domElement,()=>n._getAltObj()),this._objectControls.addEventListener("change",a=>{switch(pe.now.shadow.on&&n._updateShadowCamera(),a.action){case"rotate":n.dispatchEvent({type:"rotate",quaternion:a.quaternion});break;case"zoom":n.dispatchEvent({type:"zoom",factor:a.factor});break;default:n.dispatchEvent({type:a.action})}n.dispatchEvent({type:"transform"}),n._needRender=!0});const o=this._gfx;this._picker=new QG(o.root,o.camera,o.renderer.domElement),this._picker.addEventListener("newpick",a=>{n._onPick(a)}),this._picker.addEventListener("dblclick",a=>{n.center(a)})}catch(r){if(r.name==="TypeError"&&r.message==="Cannot read property 'getExtension' of null")this._showMessage("Could not create WebGL context.");else if(r.message.search(/webgl/i)>1)this._showMessage(r.message);else throw this._showMessage("Viewer initialization failed."),r;return!1}const i=this._opts&&this._opts.load;if(i){const r=this._opts&&this._opts.type;this.load(i,{fileType:r,keepRepsInfo:!0})}return!0};Se.prototype.term=function(){this._showMessage("Viewer has been terminated."),this._loading.forEach(s=>{s.cancel()}),this._loading.length=0,this.halt(),this._gfx=null};Se.prototype._showMessage=function(s){const e=document.createElement("div");e.setAttribute("class","miew-message"),e.appendChild(document.createElement("p")).appendChild(document.createTextNode(s)),J_(this._container,e)};Se.prototype._showCanvas=function(){J_(this._container,this._gfx.renderer.domElement)};Se.prototype._requestAnimationFrame=function(s){const{xr:e}=this._gfx.renderer;if(e&&e.enabled){this._gfx.renderer.setAnimationLoop(s);return}requestAnimationFrame(s)};function UE(s){return s.getExtension("EXT_frag_depth")}function BE(s){return s.getExtension("WEBGL_depth_texture")&&s.getExtension("WEBGL_draw_buffers")}Se.prototype._initGfx=function(){const s={width:this._container.clientWidth,height:this._container.clientHeight},e={preserveDrawingBuffer:!0,alpha:!0,premultipliedAlpha:!1};pe.now.antialias&&(e.antialias=!0),s.renderer2d=new ZG,s.renderer=new b.WebGL1Renderer(e),s.renderer.shadowMap.enabled=pe.now.shadow.on,s.renderer.shadowMap.autoUpdate=!1,s.renderer.shadowMap.type=b.PCFShadowMap,iE.init(s.renderer),UE(s.renderer.getContext())||pe.set("zSprites",!1),BE(s.renderer.getContext())||pe.set("ao",!1),s.renderer.autoClear=!1,s.renderer.setPixelRatio(window.devicePixelRatio),s.renderer.setSize(s.width,s.height),s.renderer.setClearColor(pe.now.bg.color,+!pe.now.bg.transparent),s.renderer.clearColor(),s.renderer2d.setSize(s.width,s.height),s.camera=new b.PerspectiveCamera(pe.now.camFov,s.width/s.height,pe.now.camNear,pe.now.camFar),s.camera.setMinimalFov(pe.now.camFov),s.camera.position.z=pe.now.camDistance,s.camera.updateProjectionMatrix(),s.camera.layers.set(yt.LAYERS.DEFAULT),s.camera.layers.enable(yt.LAYERS.VOLUME),s.camera.layers.enable(yt.LAYERS.VOLUME_BFPLANE),s.stereoCam=new b.StereoCamera,s.scene=new b.Scene;const t=Gf();s.scene.fog=new b.Fog(t,pe.now.camNear,pe.now.camFar),s.root=new yt.RCGroup,s.scene.add(s.root),s.pivot=new yt.RCGroup,s.root.add(s.pivot),s.selectionScene=new b.Scene,s.selectionRoot=new b.Group,s.selectionRoot.matrixAutoUpdate=!1,s.selectionScene.add(s.selectionRoot),s.selectionPivot=new b.Group,s.selectionPivot.matrixAutoUpdate=!1,s.selectionRoot.add(s.selectionPivot);const n=new b.DirectionalLight(16777215,.45);n.position.set(0,.414,1),n.layers.enable(yt.LAYERS.TRANSPARENT),n.castShadow=!0,n.shadow.bias=.09,n.shadow.radius=pe.now.shadow.radius,n.shadow.camera.layers.set(yt.LAYERS.SHADOWMAP);const i=s.renderer.getPixelRatio(),r=Math.max(s.width,s.height)*i;n.shadow.mapSize.width=r,n.shadow.mapSize.height=r,n.target.position.set(0,0,0),s.scene.add(n),s.scene.add(n.target);const o=new b.AmbientLight(6710886);o.layers.enable(yt.LAYERS.TRANSPARENT),s.scene.add(o),s.axes=new tH(s.root,s.camera);const a=s.width*i,l=s.height*i;s.offscreenBuf=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.NearestFilter,format:b.RGBAFormat,depthBuffer:!0}),s.renderer.getContext().getExtension("WEBGL_depth_texture")&&(s.offscreenBuf.depthTexture=new b.DepthTexture,s.offscreenBuf.depthTexture.type=b.UnsignedShortType),s.offscreenBuf2=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,depthBuffer:!1}),s.offscreenBuf3=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,depthBuffer:!1}),s.offscreenBuf4=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,depthBuffer:!1}),s.volBFTex=s.offscreenBuf3,s.volFFTex=s.offscreenBuf4,s.volWFFTex=s.offscreenBuf,s.renderer.getContext().getExtension("OES_texture_float")?(s.offscreenBuf5=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,type:b.FloatType,depthBuffer:!1}),s.offscreenBuf6=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,type:b.FloatType,depthBuffer:!1}),s.offscreenBuf7=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,type:b.FloatType,depthBuffer:!0}),s.volBFTex=s.offscreenBuf5,s.volFFTex=s.offscreenBuf6,s.volWFFTex=s.offscreenBuf7):this.logger.warn("Device doesn't support OES_texture_float extension"),s.stereoBufL=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,depthBuffer:!1}),s.stereoBufR=new b.WebGLRenderTarget(a,l,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,depthBuffer:!1}),this._gfx=s,this._showCanvas(),this._embedWebXR(pe.now.stereo==="WEBVR"),this._container.appendChild(s.renderer2d.getElement());const h=new vB;h.domElement.style.position="absolute",h.domElement.style.right="0",h.domElement.style.bottom="0",this._container.appendChild(h.domElement),this._fps=h,this._fps.show(pe.now.fps)};Se.prototype._initListeners=function(){const s=this;window.addEventListener("resize",()=>{s._onResize()})};Se.prototype._makeUniqueVisualName=function(s){if(!s)return Math.random().toString();let e=s,t=1;for(;this._visuals.hasOwnProperty(e);)e=`${s} (${t.toString()})`,t++;return e};Se.prototype._addVisual=function(s){if(!s)return null;const e=this._makeUniqueVisualName(s.name);return s.name=e,this._visuals[e]=s,this._gfx.pivot.add(s),s.getSelectionGeo&&this._gfx.selectionPivot.add(s.getSelectionGeo()),e};Se.prototype._removeVisual=function(s){let e="",t=null;s instanceof sh?({name:e}=s,t=s):typeof s=="string"&&(e=s,t=this._visuals[e]),!(!t||!this._visuals.hasOwnProperty(e)||this._visuals[e]!==t)&&(e===this._curVisualName&&(this._curVisualName=void 0),delete this._visuals[e],t.release(),this._needRender=!0)};Se.prototype._forEachVisual=function(s){for(const e in this._visuals)this._visuals.hasOwnProperty(e)&&s(this._visuals[e])};Se.prototype._releaseAllVisuals=function(){if(!(!this._gfx||!this._gfx.pivot)){for(const s in this._visuals)this._visuals.hasOwnProperty(s)&&this._visuals[s].release();this._visuals={}}};Se.prototype._forEachComplexVisual=function(s){if(!(!this._gfx||!this._gfx.pivot))for(const e in this._visuals)this._visuals.hasOwnProperty(e)&&this._visuals[e]instanceof bs&&s(this._visuals[e])};Se.prototype._getComplexVisual=function(s){s=s||this._curVisualName;let e=null,t=null;return this._forEachComplexVisual(n=>{e=n,n.name===s&&(t=n)}),t||e};Se.prototype._getVolumeVisual=function(){let s=null;return this._forEachVisual(e=>{e instanceof D_&&(s=e)}),s};Se.prototype._getVisualForComplex=function(s){if(!s)return null;let e=null;return this._forEachComplexVisual(t=>{t.getComplex()===s&&(e=t)}),e};Se.prototype.getVisuals=function(){return Object.keys(this._visuals)};Se.prototype.getComplexVisualsCount=function(){let s=0;return this._forEachComplexVisual(()=>s++),s};Se.prototype.getCurrentVisual=function(){return this._curVisualName};Se.prototype.setCurrentVisual=function(s){this._visuals[s]&&(this._curVisualName=s)};Se.prototype.run=function(){if(!this._running){if(this._running=!0,this._halting){this._halting=!1;return}this._objectControls.enable(!0),this._interpolator.resume(),this._requestAnimationFrame(()=>this._onTick())}};Se.prototype.halt=function(){this._running&&(this._discardComponentEdit(),this._discardFragmentEdit(),this._objectControls.enable(!1),this._interpolator.pause(),this._halting=!0)};Se.prototype.enableHotKeys=function(s){this._hotKeysEnabled=s,this._objectControls.enableHotkeys(s)};Se.prototype._onResize=function(){const s=this._gfx;s&&(this._needRender=!0,s.width=this._container.clientWidth,s.height=this._container.clientHeight,s.camera.aspect=s.width/s.height,s.camera.setMinimalFov(pe.now.camFov),s.camera.updateProjectionMatrix(),s.renderer.setSize(s.width,s.height),s.renderer2d.setSize(s.width,s.height),this.dispatchEvent({type:"resize"}))};Se.prototype._resizeOffscreenBuffers=function(s,e,t){const n=this._gfx;t=t||"NONE";const i=t==="NONE"||t==="ANAGLYPH",r=i?1:.5;n.offscreenBuf.setSize(r*s,e),n.offscreenBuf2.setSize(r*s,e),n.offscreenBuf3.setSize(r*s,e),n.offscreenBuf4.setSize(r*s,e),n.offscreenBuf5&&n.offscreenBuf5.setSize(r*s,e),n.offscreenBuf6&&n.offscreenBuf6.setSize(r*s,e),n.offscreenBuf7&&n.offscreenBuf7.setSize(r*s,e),i&&(n.stereoBufL.setSize(s,e),n.stereoBufR.setSize(s,e))};Se.prototype._onTick=function(){if(this._halting){this._running=!1,this._halting=!1;return}this._fps.update(),this._requestAnimationFrame(()=>this._onTick()),this._onUpdate(),this._needRender&&(this._onRender(),this._needRender=!pe.now.suspendRender||pe.now.stereo==="WEBVR")};Se.prototype._getBSphereRadius=function(){let s=0;return this._forEachVisual(e=>{s=Math.max(s,e.getBoundaries().boundingSphere.radius)}),s*this._objectControls.getScale()};Se.prototype.getOBB=function(){const s=new b.Sphere,e=new b.Box3,t=new b.Box3,n=new b.Matrix4,i=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3];return function(r,o){t.makeEmpty(),this._forEachVisual(h=>{s.copy(h.getBoundaries().boundingSphere),s.applyMatrix4(h.matrixWorld).applyMatrix4(r),s.getBoundingBox(e),t.union(e)}),t.getCenter(o.center),n.copy(r).invert(),o.center.applyMatrix4(n);const{min:a}=t,{max:l}=t;i[0].set(a.x,a.y,a.z),i[1].set(l.x,a.y,a.z),i[2].set(a.x,l.y,a.z),i[3].set(a.x,a.y,l.z);for(let h=0,u=i.length;h<u;h++)i[h].applyMatrix4(n);o.halfSize.set(Math.abs(i[0].x-i[1].x),Math.abs(i[0].y-i[2].y),Math.abs(i[0].z-i[3].z)).multiplyScalar(.5)}}();Se.prototype._updateFog=function(){const s=this._gfx;if(pe.now.fog){if(typeof s.scene.fog>"u"||s.scene.fog===null){const e=Gf();s.scene.fog=new b.Fog(e),this._setUberMaterialValues({fog:pe.now.fog})}JH(s.scene.fog,s.camera.position.z,this._getBSphereRadius())}else s.scene.fog&&(s.scene.fog=void 0,this._setUberMaterialValues({fog:pe.now.fog}))};Se.prototype._onUpdate=function(){this.isScriptingCommandAvailable!==void 0&&this.isScriptingCommandAvailable()&&!this._building&&this.callNextCmd(),this._objectControls.update(),this._forEachComplexVisual(s=>{s.getComplex().update()}),pe.now.autobuild&&!this._loading.length&&!this._building&&this._needRebuild()&&this.rebuild(),!this._loading.length&&!this._building&&!this._needRebuild()&&this._updateView(),this._updateFog(),this._gfx.renderer.xr.enabled&&this.webVR.updateMoleculeScale()};Se.prototype._onRender=function(){const s=this._gfx;s.scene.updateMatrixWorld(),s.camera.updateMatrixWorld(),this._clipPlaneUpdateValue(this._getBSphereRadius()),this._fogFarUpdateValue(),s.renderer.setRenderTarget(null),s.renderer.clear(),this._renderFrame(pe.now.stereo)};Se.prototype._renderFrame=function(){const s=new DH,e=new b.Vector2;return function(t){const n=this._gfx,{renderer:i}=n;i.getSize(e),t!=="NONE"&&(n.camera.focus=n.camera.position.z,n.stereoCam.aspect=1,t==="ANAGLYPH"?n.stereoCam.update(n.camera):n.stereoCam.updateHalfSized(n.camera,pe.now.camFov));const r=n.renderer.getPixelRatio();switch(this._resizeOffscreenBuffers(e.width*r,e.height*r,t),this._renderShadowMap(),t){case"WEBVR":case"NONE":this._renderScene(n.camera,!1);break;case"SIMPLE":case"DISTORTED":i.setScissorTest(!0),i.setScissor(0,0,e.width/2,e.height),i.setViewport(0,0,e.width/2,e.height),this._renderScene(this._gfx.stereoCam.cameraL,t==="DISTORTED"),i.setScissor(e.width/2,0,e.width/2,e.height),i.setViewport(e.width/2,0,e.width/2,e.height),this._renderScene(this._gfx.stereoCam.cameraR,t==="DISTORTED"),i.setScissorTest(!1);break;case"ANAGLYPH":this._renderScene(this._gfx.stereoCam.cameraL,!1,n.stereoBufL),this._renderScene(this._gfx.stereoCam.cameraR,!1,n.stereoBufR),i.setRenderTarget(null),s.uniforms.srcL.value=n.stereoBufL.texture,s.uniforms.srcR.value=n.stereoBufR.texture,n.renderer.renderScreenQuad(s);break}n.renderer2d.render(n.scene,n.camera),pe.now.axes&&n.axes&&!n.renderer.xr.enabled&&n.axes.render(i)}}();Se.prototype._onBgColorChanged=function(){const s=this._gfx,e=Gf();s&&(s.scene.fog&&s.scene.fog.color.set(e),s.renderer.setClearColor(pe.now.bg.color,+!pe.now.bg.transparent)),this._needRender=!0};Se.prototype._onFogColorChanged=function(){const s=this._gfx,e=Gf();s&&s.scene.fog&&s.scene.fog.color.set(e),this._needRender=!0};Se.prototype._setUberMaterialValues=function(s){this._gfx.root.traverse(e=>{(e instanceof b.Mesh||e instanceof b.LineSegments||e instanceof b.Line)&&e.material instanceof Wr&&(e.material.setValues(s),e.material.needsUpdate=!0)})};Se.prototype._enableMRT=function(s,e,t){const n=this._gfx,i=n.renderer.getContext(),r=i.getExtension("WEBGL_draw_buffers"),{properties:o}=n.renderer;if(!s){r.drawBuffersWEBGL([i.COLOR_ATTACHMENT0,null]);return}n.renderer.setRenderTarget(t);const a=o.get(t.texture).__webglTexture;i.bindTexture(i.TEXTURE_2D,a),n.renderer.setRenderTarget(e);const l=o.get(e).__webglFramebuffer,h=o.get(e.texture).__webglTexture;i.bindFramebuffer(i.FRAMEBUFFER,l),l.width=e.width,l.height=e.height,i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,h,0),i.framebufferTexture2D(i.FRAMEBUFFER,r.COLOR_ATTACHMENT1_WEBGL,i.TEXTURE_2D,a,0),r.drawBuffersWEBGL([i.COLOR_ATTACHMENT0,r.COLOR_ATTACHMENT1_WEBGL])};Se.prototype._renderScene=function(){return function(s,e,t){e=e||!1,t=t||null;const n=this._gfx;if(n.renderer.setClearColor(pe.now.bg.color,+!pe.now.bg.transparent),n.renderer.setRenderTarget(t),n.renderer.clear(),n.renderer.xr.enabled){n.renderer.render(n.scene,s);return}n.renderer.setClearColor(0,0),n.renderer.setRenderTarget(n.offscreenBuf4),n.renderer.clearColor(),n.renderer.setClearColor(pe.now.bg.color,+!pe.now.bg.transparent),n.renderer.setRenderTarget(n.offscreenBuf),n.renderer.clear();const i=this._getComplexVisual()!==null,r=this._getVolumeVisual(),o=i&&pe.now.ao;o&&this._enableMRT(!0,n.offscreenBuf,n.offscreenBuf4),pe.now.transparency==="prepass"?this._renderWithPrepassTransparency(s,n.offscreenBuf):pe.now.transparency==="standard"&&(n.renderer.setRenderTarget(n.offscreenBuf),n.renderer.render(n.scene,s)),o&&this._enableMRT(!1,null,null);const a=i&&pe.now.outline.on,l=i&&pe.now.fxaa,h=r!==null&&r.getMesh().material!=null;let u=o||a||h||l||e?n.offscreenBuf2:t,f=n.offscreenBuf;o?(this._performAO(f,n.offscreenBuf4,n.offscreenBuf.depthTexture,u,n.offscreenBuf3,n.offscreenBuf2),!l&&!e&&!h&&!a&&(f=u,u=t,n.renderer.setRenderTarget(u),n.renderer.renderScreenQuadFromTex(f.texture,1))):(n.renderer.setRenderTarget(u),n.renderer.renderScreenQuadFromTex(f.texture,1)),a&&(f=u,u=h||l||e?n.offscreenBuf3:t,f!=null&&this._renderOutline(s,n.offscreenBuf,f,u)),this._renderSelection(s,n.offscreenBuf,u),h&&(n.renderer.setRenderTarget(n.offscreenBuf),n.renderer.renderScreenQuadFromTex(u.texture,1),u=n.offscreenBuf,this._renderVolume(r,s,u,n.volBFTex,n.volFFTex,n.volWFFTex),!l&&!e&&(n.renderer.setRenderTarget(t),n.renderer.renderScreenQuadFromTex(u.texture,1))),f=u,l&&(u=e?n.offscreenBuf4:t,this._performFXAA(f,u),f=u),e&&(u=t,this._performDistortion(f,u,!0))}}();Se.prototype._performDistortion=function(){const s=new b.Scene,e=new b.OrthographicCamera(-1,1,1,-1,-500,1e3),t=new b.RawShaderMaterial({uniforms:{srcTex:{type:"t",value:null},aberration:{type:"fv3",value:new b.Vector3(1)}},vertexShader:mo,fragmentShader:YH,transparent:!1,depthTest:!1,depthWrite:!1}),n=yt.buildDistorionMesh(10,10,pe.now.debug.stereoBarrel);return s.add(new sr.Mesh(n,t)),function(i,r,o){this._gfx.renderer.setRenderTarget(r),this._gfx.renderer.clear(),o?(t.uniforms.srcTex.value=i.texture,t.uniforms.aberration.value.set(.995,1,1.01),this._gfx.renderer.render(s,e)):this._gfx.renderer.renderScreenQuadFromTexWithDistortion(i,pe.now.debug.stereoBarrel)}}();Se.prototype._renderOutline=function(){const s=new OE({depth:!0});return function(e,t,n,i){const o=this._gfx;s.uniforms.srcTex.value=n.texture,s.uniforms.srcDepthTex.value=t.depthTexture,s.uniforms.srcTexSize.value.set(t.width,t.height),s.uniforms.color.value=new b.Color(pe.now.outline.color),s.uniforms.threshold.value=pe.now.outline.threshold,s.uniforms.thickness.value=new b.Vector2(pe.now.outline.thickness,pe.now.outline.thickness),o.renderer.setRenderTarget(i),o.renderer.renderScreenQuad(s)}}();Se.prototype._renderShadowMap=function(){const s={minFilter:b.NearestFilter,magFilter:b.NearestFilter,format:b.RGBAFormat};return function(){if(!pe.now.shadow.on)return;const e=this._gfx,t=e.renderer.getRenderTarget(),n=e.renderer.getActiveCubeFace(),i=e.renderer.getActiveMipmapLevel(),r=e.renderer.state;r.setBlending(b.NoBlending),r.buffers.color.setClear(1,1,1,1),r.buffers.depth.setTest(!0),r.setScissorTest(!1);for(let o=0;o<e.scene.children.length;o++)if(e.scene.children[o].type==="DirectionalLight"){const a=e.scene.children[o];a.shadow.map==null&&(a.shadow.map=new b.WebGLRenderTarget(a.shadow.mapSize.width,a.shadow.mapSize.height,s),a.shadow.camera.updateProjectionMatrix()),a.shadow.updateMatrices(a),e.renderer.setRenderTarget(a.shadow.map),e.renderer.clear(),e.renderer.render(e.scene,a.shadow.camera)}e.renderer.setRenderTarget(t,n,i)}}();Se.prototype._hasSelectionToRender=function(){const s=this._gfx.selectionPivot;for(let e=0;e<s.children.length;e++)if(s.children[e].children.length>0)return!0;return!1};Se.prototype._renderSelection=function(){const s=new OE;return function(e,t,n){const i=this,r=i._gfx;r.renderer.setClearColor("black",0),r.renderer.setRenderTarget(t),r.renderer.clear(!0,!1,!1),i._hasSelectionToRender()?(r.selectionRoot.matrix=r.root.matrix,r.selectionPivot.matrix=r.pivot.matrix,r.renderer.render(r.selectionScene,e)):r.renderer.renderDummyQuad(),r.renderer.setRenderTarget(n),r.renderer.renderScreenQuadFromTex(t.texture,.6),s.uniforms.srcTex.value=t.texture,s.uniforms.srcTexSize.value.set(t.width,t.height),r.renderer.renderScreenQuad(s)}}();Se.prototype._checkVolumeRenderingSupport=function(s){if(!s)return!1;const e=this._gfx,t=e.renderer.getRenderTarget();e.renderer.setRenderTarget(s);const n=e.renderer.getContext(),i=n.checkFramebufferStatus(n.FRAMEBUFFER);return e.renderer.setRenderTarget(t),i!==n.FRAMEBUFFER_COMPLETE?(this.logger.warn("Device doesn't support electron density rendering"),!1):!0};Se.prototype._renderVolume=function(){const s=new nf.BackFacePosMaterial,e=new nf.FrontFacePosMaterial,t=new b.Matrix4().makeTranslation(.5,.5,.5),n=new b.Matrix4;let i;return function(r,o,a,l,h,u){const f=this._gfx;if(typeof i>"u"&&(i=this._checkVolumeRenderingSupport(l)),!i)return;const p=r.getMesh();p.rebuild(f.camera),f.renderer.setClearColor("black",0),f.renderer.setRenderTarget(l),f.renderer.clear(),f.renderer.setRenderTarget(h),f.renderer.clear(),f.renderer.setRenderTarget(u),f.renderer.clear(),f.renderer.setRenderTarget(l),o.layers.set(yt.LAYERS.VOLUME_BFPLANE),f.renderer.render(f.scene,o),o.layers.set(yt.LAYERS.VOLUME),f.scene.overrideMaterial=s,f.renderer.render(f.scene,o),f.renderer.setRenderTarget(h),o.layers.set(yt.LAYERS.VOLUME),f.scene.overrideMaterial=e,f.renderer.render(f.scene,o),f.scene.overrideMaterial=null,o.layers.set(yt.LAYERS.DEFAULT),n.copy(p.matrixWorld).invert(),Wr.prototype.uberOptions.world2colorMatrix.multiplyMatrices(t,n),o.layers.set(yt.LAYERS.COLOR_FROM_POSITION),f.renderer.setRenderTarget(u),f.renderer.render(f.scene,o);const m=p.material;m.uniforms._BFRight.value=l.texture,m.uniforms._FFRight.value=h.texture,m.uniforms._WFFRight.value=u.texture,o.layers.set(yt.LAYERS.VOLUME),f.renderer.setRenderTarget(a),f.renderer.render(f.scene,o),o.layers.set(yt.LAYERS.DEFAULT)}}();Se.prototype._renderWithPrepassTransparency=function(){return function(s,e){const t=this._gfx;t.renderer.setRenderTarget(e),s.layers.set(yt.LAYERS.DEFAULT),t.renderer.render(t.scene,s),s.layers.set(yt.LAYERS.PREPASS_TRANSPARENT),t.renderer.getContext().colorMask(!1,!1,!1,!1),t.renderer.render(t.scene,s),t.renderer.getContext().colorMask(!0,!0,!0,!0),s.layers.set(yt.LAYERS.TRANSPARENT),t.renderer.render(t.scene,s),s.layers.set(yt.LAYERS.DEFAULT)}}();Se.prototype._performFXAA=function(){const s=new bH;return function(e,t){if(typeof e>"u"||typeof t>"u")return;const n=this._gfx;n.renderer.setClearColor(pe.now.bg.color,+!pe.now.bg.transparent),n.renderer.setRenderTarget(t),n.renderer.clear(),s.uniforms.srcTex.value=e.texture,s.uniforms.srcTexelSize.value.set(1/e.width,1/e.height),s.uniforms.bgColor.value.set(pe.now.bg.color),s.bgTransparent!==pe.now.bg.transparent&&(s.setValues({bgTransparent:pe.now.bg.transparent}),s.needsUpdate=!0),n.renderer.renderScreenQuad(s)}}();Se.prototype._performAO=function(){const s=new AH,e=new PH,t=new NH,n=new b.Vector3;return function(i,r,o,a,l,h){if(!i||!r||!o||!a||!l||!h)return;const u=this._gfx,f=Math.tan(b.MathUtils.DEG2RAD*.5*u.camera.fov);s.uniforms.diffuseTexture.value=i.texture,s.uniforms.depthTexture.value=o,s.uniforms.normalTexture.value=r.texture,s.uniforms.srcTexelSize.value.set(1/i.width,1/i.height),s.uniforms.camNearFar.value.set(u.camera.near,u.camera.far),s.uniforms.projMatrix.value=u.camera.projectionMatrix,s.uniforms.aspectRatio.value=u.camera.aspect,s.uniforms.tanHalfFOV.value=f,u.root.matrix.extractScale(n),s.uniforms.kernelRadius.value=pe.now.debug.ssaoKernelRadius*n.x,s.uniforms.depthThreshold.value=2*this._getBSphereRadius(),s.uniforms.factor.value=pe.now.debug.ssaoFactor,u.renderer.setRenderTarget(h),u.renderer.renderScreenQuad(s),e.uniforms.aoMap.value=h.texture,e.uniforms.srcTexelSize.value.set(1/h.width,1/h.height),e.uniforms.depthTexture.value=o,u.renderer.setRenderTarget(l),u.renderer.renderScreenQuad(e),t.uniforms.aoMap.value=l.texture,t.uniforms.diffuseTexture.value=i.texture,t.uniforms.srcTexelSize.value.set(1/l.width,1/l.height),t.uniforms.depthTexture.value=o,t.uniforms.projMatrix.value=u.camera.projectionMatrix,t.uniforms.aspectRatio.value=u.camera.aspect,t.uniforms.tanHalfFOV.value=f;const{fog:p}=u.scene;p&&(t.uniforms.fogNearFar.value.set(p.near,p.far),t.uniforms.fogColor.value.set(p.color.r,p.color.g,p.color.b,pe.now.fogAlpha)),(t.useFog!==pe.now.fog||t.fogTransparent!==pe.now.bg.transparent)&&(t.setValues({useFog:pe.now.fog,fogTransparent:pe.now.bg.transparent}),t.needsUpdate=!0),u.renderer.setRenderTarget(a),u.renderer.renderScreenQuad(t)}}();Se.prototype.reset=function(){this._picker&&this._picker.reset(),this._lastPick=null,this._releaseAllVisuals(),this._setEditMode(dn.COMPLEX),this._resetObjects(),this._gfx&&(yt.clearTree(this._gfx.pivot),this._gfx.renderer2d.reset()),this.setNeedRender()};Se.prototype._resetScene=function(){this._objectControls.reset(),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.resetReps(),this.resetPivot(),this.rebuildAll()};Se.prototype.resetView=function(){this._picker&&this._picker.reset(),this._setEditMode(dn.COMPLEX),this._resetScene(),this._forEachComplexVisual(s=>{s.updateSelectionMask({}),s.rebuildSelectionGeometry()})};Se.prototype._export=function(s){const e=Me.default.head(lo.exporters.find({format:s}));if(!e)return this.logger.error("Could not find suitable exporter for this source"),Promise.reject(new Error("Could not find suitable exporter for this source"));if(this.dispatchEvent({type:"exporting"}),this._visuals[this._curVisualName]instanceof bs){let t=null;return e.SourceClass===bs?t=this._visuals[this._curVisualName]:e.SourceClass===y_&&(t=this._visuals[this._curVisualName]._complex),new e(t,{miewVersion:Se.VERSION}).export().then(i=>i)}return this._visuals[this._curVisualName]instanceof D_?Promise.reject(new Error("Sorry, exporter for volume data not implemented yet")):Promise.reject(new Error("Unexpected format of data"))};const e9=/^(?:(pdb|cif|ccp4|dsn6):\s*)?(\d[a-z\d]{3})$/i,t9=/^(?:pc|pubchem):\s*([a-z]+)$/i,n9=/^([a-z][a-z\d\-+.]*):/i;function i9(s,e){if(!Me.default.isString(s))return s;const t=e9.exec(s);if(t){let[,i="pdb",r]=t;switch(i=i.toLowerCase(),r=r.toUpperCase(),i){case"pdb":s=`https://files.rcsb.org/download/${r}.pdb`;break;case"cif":s=`https://files.rcsb.org/download/${r}.cif`;break;case"ccp4":s=`https://www.ebi.ac.uk/pdbe/coordinates/files/${r.toLowerCase()}.ccp4`;break;case"dsn6":s=`https://edmaps.rcsb.org/maps/${r.toLowerCase()}_2fofc.dsn6`;break;default:throw new Error("Unexpected data format shortcut")}return e.fileType=i,e.fileName=`${r}.${i}`,e.sourceType="url",s}const n=t9.exec(s);if(n){const i=n[1].toLowerCase();return s=`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/${i}/JSON?record_type=3d`,e.fileType="pubchem",e.fileName=`${i}.json`,e.sourceType="url",s}return(e.sourceType==="url"||e.sourceType===void 0)&&(e.sourceType="url",n9.test(s)||(s=Oe.resolveURL(s))),s}function r9(s){let{binary:e}=s;if(s.fileType!==void 0){const t=Me.default.head(lo.parsers.find({format:s.fileType}));if(t)e=t.binary||!1;else throw new Error("Could not find suitable parser for this format")}if(e===void 0&&s.fileExt!==void 0){const t=Me.default.head(lo.parsers.find({ext:s.fileExt}));t&&(e=t.binary||!1)}s.fileExt!==void 0&&s.fileExt.toLowerCase()===".man"&&(s.binary=!0,s.animation=!0),e!==void 0&&s.binary!==void 0&&s.binary!==e&&s.context.logger.warn("Overriding incorrect binary mode"),s.binary=e||!1}function s9(s,e,t){return new Promise(n=>{if(t.shouldCancel())throw new Error("Operation cancelled");t.notify({type:"fetching"}),s=i9(s,e);const i=Me.default.head(lo.loaders.find({type:e.sourceType,source:s}));if(!i)throw new Error(gg);const r=e.fileName||i.extractName(s);if(r){const[h,u]=Oe.splitFileName(r);Me.default.defaults(e,{name:h,fileExt:u,fileName:r})}r9(e);let o=Me.default.get(e,"preset.expression");if(!Me.default.isUndefined(o)&&(o=JSON.parse(o),o&&o.settings)){const h=["singleUnit"];for(let u=0,f=h.length;u<f;++u){const p=h[u],m=Me.default.get(o.settings,p);Me.default.isUndefined(m)||pe.set(p,m)}}const a=new i(s,e);a.context=e.context,t.addEventListener("cancel",()=>a.abort()),a.addEventListener("progress",h=>{h.lengthComputable&&h.total>0?ob(a.logger,"Fetching",h.loaded/h.total):ob(a.logger,"Fetching")}),console.time("fetch");const l=a.load().then(h=>(console.timeEnd("fetch"),e.context.logger.info("Fetching finished"),t.notify({type:"fetchingDone",data:h}),h)).catch(h=>{throw console.timeEnd("fetch"),e.context.logger.debug(h.message),h.stack&&e.context.logger.debug(h.stack),e.context.logger.error("Fetching failed"),t.notify({type:"fetchingDone",error:h}),h});n(l)})}function o9(s,e,t){if(t.shouldCancel())return Promise.reject(new Error("Operation cancelled"));t.notify({type:"parsing"});const n=Me.default.head(lo.parsers.find({format:e.fileType,ext:e.fileExt,data:s}));if(!n)return Promise.reject(new Error("Could not find suitable parser"));const i=new n(s,e);return i.context=e.context,t.addEventListener("cancel",()=>i.abort()),console.time("parse"),i.parse().then(r=>(console.timeEnd("parse"),t.notify({type:"parsingDone",data:r}),r)).catch(r=>{throw console.timeEnd("parse"),e.error=r,e.context.logger.debug(r.message),r.stack&&e.context.logger.debug(r.stack),e.context.logger.error("Parsing failed"),t.notify({type:"parsingDone",error:r}),r})}Se.prototype.load=function(s,e){e=Me.default.merge({},e,{context:this}),this.settings.now.use.multiFile||(this._loading.length&&(this._loading.forEach(i=>{i.cancel()}),this._loading.length=0),e.animation||this.reset(!0)),this._interpolator.reset(),this.dispatchEvent({type:"loading",options:e,source:s});const t=new YB;this._loading.push(t),t.addEventListener("notification",i=>{this.dispatchEvent(i.slaveEvent)}),this._spinner.spin(this._container);const n=i=>{const r=this._loading.indexOf(t);return r!==-1&&this._loading.splice(r,1),this._spinner.stop(),this._refreshTitle(),t.notify({type:"loadingDone",anything:i}),i};return s9(s,e,t).then(i=>o9(i,e,t)).then(i=>{const r=this._onLoad(i,e);return n(r)}).catch(i=>{throw this.logger.error("Could not load data"),this.logger.debug(i),n(i)})};Se.prototype.unload=function(s){this._removeVisual(s||this.getCurrentVisual()),this.resetPivot(),pe.now.shadow.on&&this._updateShadowCamera()};Se.prototype._startAnimation=function(s){this._stopAnimation();const e=this,t=this._getComplexVisual();if(t===null){this.logger.error("Unable to start animation - no molecule is loaded.");return}try{this._frameInfo=new xH(t.getComplex(),s,{onLoadStatusChanged(){e.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:e._isAnimating,isLoading:e._frameInfo?e._frameInfo.isLoading:!0}})},onError(n){e._stopAnimation(),e.logger.error(n)}})}catch{this.logger.error("Animation file does not fit to current complex!");return}this._continueAnimation()};Se.prototype._pauseAnimation=function(){this._animInterval!==null&&(this._isAnimating=!1,clearInterval(this._animInterval),this._animInterval=null,this._frameInfo&&this.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:this._isAnimating,isLoading:this._frameInfo.isLoading}}))};Se.prototype._continueAnimation=function(){this._isAnimating=!0;let s=1e3/pe.now.maxfps;s=Number.isNaN(s)?0:s;const e=this,{pivot:t}=e._gfx,n=this._getComplexVisual();n&&(n.resetSelectionMask(),n.rebuildSelectionGeometry(),this._msgAtomInfo.style.opacity=0),this._animInterval=setInterval(()=>{if(e.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:e._isAnimating,isLoading:e._frameInfo.isLoading}}),e._frameInfo.frameIsReady){t.updateToFrame(e._frameInfo),e._updateObjsToFrame(e._frameInfo),e._refreshTitle(` Frame ${e._frameInfo._currFrame} of ${e._frameInfo._framesCount} time interval - ${e._frameInfo._timeStep}`);try{e._frameInfo.nextFrame()}catch{e.logger.error("Error during animation"),e._stopAnimation();return}e._needRender=!0}},s)};Se.prototype._stopAnimation=function(){this._animInterval!==null&&(clearInterval(this._animInterval),this._frameInfo.disableEvents(),this._frameInfo=null,this._animInterval=null,this.dispatchEvent({type:"mdPlayerStateChanged",state:null}))};Se.prototype._onLoad=function(s,e){const t=this._gfx;let n=null;if(e.animation)return this._refreshTitle(),this._startAnimation(s),null;if(this._stopAnimation(),(!e||!e.keepRepsInfo)&&(this._opts.reps=null,this._opts._objects=null),s.id==="Complex"){const i=s;e.fileName?i.name=i.name||sb(e.fileName).toUpperCase():e.amberFileName?i.name=i.name||sb(e.amberFileName).toUpperCase():i.name=`Dynamic ${e.fileType} molecule`,n=this._addVisual(new bs(i.name,i)),this._curVisualName=n;const r=this.info();if(this.logger.info(`Parsed ${e.fileName} (${r.atoms} atoms, ${r.bonds} bonds, ${r.residues} residues, ${r.chains} chains).`),Me.default.isNumber(this._opts.unit)&&i.setCurrentUnit(this._opts.unit),!e.preset)if(pe.now.autoPreset)switch(e.fileType){case"cml":this.resetReps("small");break;case"pdb":case"mmtf":case"cif":QH(i)?this.resetReps("macro"):this.resetReps("small");break;default:this.resetReps("default");break}else this.resetReps("default")}else s.id==="Volume"&&(this.resetEd(),n=this._onLoadEd(s));return t.camera.updateProjectionMatrix(),this._updateFog(),t.root.resetTransform(),this.resetPivot(),this._objectControls.setScale(pe.now.radiusToFit/this._getBSphereRadius()),this._resetObjects(),pe.now.autoResolution&&this._tweakResolution(),pe.now.shadow.on&&this._updateShadowCamera(),this._opts.view&&(this.view(this._opts.view),delete this._opts.view),this._refreshTitle(),n};Se.prototype.resetEd=function(){this._edLoader&&(this._edLoader.abort(),this._edLoader=null),this._removeVisual(this._getVolumeVisual()),this._needRender=!0};Se.prototype.loadEd=function(s){this.resetEd();const e=Me.default.head(lo.loaders.find({source:s}));if(!e)return this.logger.error(gg),Promise.reject(new Error(gg));const t=this._edLoader=new e(s,{binary:!0});return t.context=this,t.load().then(n=>{const i=Me.default.head(lo.parsers.find({format:"ccp4"}));if(!i)throw new Error(KH);const r=new i(n);return r.context=this,r.parse().then(o=>{this._onLoadEd(o)})}).catch(n=>{this.logger.error("Could not load ED data"),this.logger.debug(n)})};Se.prototype._onLoadEd=function(s){s.normalize();const e=new D_("volume",s);e.getMesh().layers.set(yt.LAYERS.VOLUME);const t=this._addVisual(e);return this._needRender=!0,t};Se.prototype._needRebuild=function(){let s=!1;return this._forEachComplexVisual(e=>{s=s||e.needsRebuild()}),s};Se.prototype._rebuildObjects=function(){const s=this,e=this._gfx;let t,n;const i=[];for(t=0;t<e.pivot.children.length;++t){const r=e.pivot.children[t];r instanceof sh||i.push(r)}for(t=0;t<i.length;++t)i[t].parent.remove(i[t]);setTimeout(()=>{const r=s._objects;for(t=0,n=r.length;t<n;++t){const o=r[t];o.needsRebuild&&o.build(),o.getGeometry()&&e.pivot.add(o.getGeometry())}},10)};Se.prototype.changeUnit=function(s,e){const t=this._getComplexVisual(e);if(!t)throw new Error("There is no complex to change!");function n(){const i=t?t.getComplex().getCurrentUnit():0,r=i>0?`Bio molecule ${i}`:"Asymmetric unit";return`Current unit: ${i} (${r})`}return s===void 0||(Me.default.isString(s)&&(s=Math.max(parseInt(s,10),0)),t.getComplex().setCurrentUnit(s)&&(this._resetScene(),this._updateInfoPanel())),n()};Se.prototype.rebuild=function(){if(this._building){this.logger.warn("Miew.rebuild(): already building!");return}this._building=!0,this.dispatchEvent({type:"rebuilding"}),this._rebuildObjects(),this._gfx.renderer2d.reset();const s=[];this._forEachComplexVisual(t=>{t.needsRebuild()&&s.push(t.rebuild().then(()=>new Promise(n=>{t.rebuildSelectionGeometry(),n()})))});const e=this;this._spinner.spin(this._container),Promise.all(s).then(()=>{e._spinner.stop(),e._needRender=!0,e._refreshTitle(),this.dispatchEvent({type:"buildingDone"}),e._building=!1})};Se.prototype.rebuildAll=function(){this._forEachComplexVisual(s=>{s.setNeedsRebuild()})};Se.prototype._refreshTitle=function(s){let e;s=s===void 0?"":s;const t=this._getComplexVisual();if(t){e=t.getComplex().name;const n=t.repGet(t.repCurrent());e+=n?` – ${n.mode.name} Mode`:""}else e=Object.keys(this._visuals).length>0?"Unknown":"No Data";e+=s,this.dispatchEvent({type:"titleChanged",data:e})};Se.prototype.setNeedRender=function(){this._needRender=!0};Se.prototype._extractRepresentation=function(){const s=[];this._forEachComplexVisual(e=>{if(e.getSelectionCount()===0)return;const t=e.buildSelectorFromMask(1<<e.getSelectionBit()),n=pe.now.presets.default,i=e.repAdd({selector:t,mode:n[0].mode.id,colorer:n[0].colorer.id,material:n[0].material.id});if(!i){e.repCount()===bs.NUM_REPRESENTATION_BITS&&this.logger.warn(`Number of representations is limited to ${bs.NUM_REPRESENTATION_BITS}`);return}this.dispatchEvent({type:"repAdded",index:i.index,name:e.name}),e.repCurrent(i.index),s.push(e.name)}),s.length>0&&this.logger.report(`New representation from selection for complexes: ${s.join(", ")}`)};Se.prototype._setReps=function(s){s=s||this._opts&&this._opts.reps||[],this._forEachComplexVisual(e=>e.resetReps(s))};Se.prototype.applyPreset=function(s){const{presets:e}=pe.now,t=[s||pe.defaults.preset,pe.defaults.preset,Object.keys(e)[0]];let n=null;for(let i=0;!n&&i<t.length;++i)pe.set("preset",t[i]),n=e[pe.now.preset],n||this.logger.warn(`Unknown preset "${pe.now.preset}"`);this._setReps(n)};Se.prototype.resetReps=function(s){const e=this._opts&&this._opts.reps;e?this._setReps(e):this.applyPreset(s)};Se.prototype.repCount=function(s){const e=this._getComplexVisual(s);return e?e.repCount():0};Se.prototype.repCurrent=function(s,e){const t=this._getComplexVisual(e),n=t?t.repCurrent(s):-1;return s&&n!==s&&this.logger.warn(`Representation ${s} was not found. Current rep remains unchanged.`),n};Se.prototype.rep=function(s,e){const t=this._getComplexVisual("");if(!t)return null;const n=t.rep(s,e);return n.status==="created"?this.dispatchEvent({type:"repAdded",index:n.index,name:t.name}):n.status==="changed"&&this.dispatchEvent({type:"repChanged",index:n.index,name:t.name}),n.desc};Se.prototype.repGet=function(s,e){const t=this._getComplexVisual(e);return t?t.repGet(s):null};Se.prototype.repAdd=function(s,e){const t=this._getComplexVisual(e);if(!t)return-1;const n=t.repAdd(s);return n?(this.dispatchEvent({type:"repAdded",index:n.index,name:e}),n.index):-1};Se.prototype.repRemove=function(s,e){const t=this._getComplexVisual(e);t&&(t.repRemove(s),this.dispatchEvent({type:"repRemoved",index:s,name:e}))};Se.prototype.repHide=function(s,e,t){this._needRender=!0;const n=this._getComplexVisual(t);return n?n.repHide(s,e):null};Se.prototype._setEditMode=function(s){this._editMode=s;const e=this._msgMode;if(e&&(e.style.opacity=s===dn.COMPLEX?0:1,s!==dn.COMPLEX)){const t=e.getElementsByTagName("p")[0];t.innerHTML=s===dn.COMPONENT?"COMPONENT EDIT MODE":"FRAGMENT EDIT MODE"}this.dispatchEvent({type:"editModeChanged",data:s===dn.COMPLEX})};Se.prototype._enterComponentEditMode=function(){if(this._editMode!==dn.COMPLEX)return;const s=[];this._forEachComplexVisual(e=>{const t=e.beginComponentEdit();t&&s.push(t)}),s!==[]&&(this._editors=s,this.logger.info("COMPONENT EDIT MODE -- ON"),this._setEditMode(dn.COMPONENT),this._objectControls.keysTranslateObj(!0))};Se.prototype._applyComponentEdit=function(){if(this._editMode===dn.COMPONENT){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(let s=0;s<this._editors.length;++s)this._editors[s].apply();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (applied)"),this._setEditMode(dn.COMPLEX),this.rebuildAll()}};Se.prototype._discardComponentEdit=function(){if(this._editMode===dn.COMPONENT){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(let s=0;s<this._editors.length;++s)this._editors[s].discard();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (discarded)"),this._setEditMode(dn.COMPLEX),this._needRender=!0,this.rebuildAll()}};Se.prototype._enterFragmentEditMode=function(){if(this._editMode!==dn.COMPLEX)return;const s=[];if(this._forEachComplexVisual(t=>{t instanceof bs&&t.getSelectionCount()>0&&s.push(t)}),s.length!==1)return;const e=s[0].beginFragmentEdit();e&&(this._editors=[e],this.logger.info("FRAGMENT EDIT MODE -- ON (single bond)"),this._setEditMode(dn.FRAGMENT),this._objectControls.allowTranslation(!1),this._objectControls.allowAltObjFreeRotation(e.isFreeRotationAllowed()),this._needRender=!0)};Se.prototype._applyFragmentEdit=function(){if(this._editMode===dn.FRAGMENT){this._objectControls.stop();for(let s=0;s<this._editors.length;++s)this._editors[s].apply();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (applied)"),this._setEditMode(dn.COMPLEX),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.rebuildAll()}};Se.prototype._discardFragmentEdit=function(){if(this._editMode===dn.FRAGMENT){this._objectControls.stop();for(let s=0;s<this._editors.length;++s)this._editors[s].discard();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (discarded)"),this._setEditMode(dn.COMPLEX),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this._needRender=!0}};Se.prototype._onPick=function(s){if(!pe.now.picking||this._animInterval!==null||this._editMode===dn.FRAGMENT||this._objectControls.isEditingAltObj())return;let e=null;s.obj.atom?(e=s.obj.atom.residue.getChain().getComplex(),this._lastPick=s.obj.atom):s.obj.residue?(e=s.obj.residue.getChain().getComplex(),this._lastPick=s.obj.residue):s.obj.chain?(e=s.obj.chain.getComplex(),this._lastPick=s.obj.chain):s.obj.molecule?(e=s.obj.molecule.complex,this._lastPick=s.obj.molecule):this._lastPick=null;function t(n){n.updateSelectionMask(s.obj),n.rebuildSelectionGeometry()}if(e){const n=this._getVisualForComplex(e);n&&(t(n),this._needRender=!0)}else this._forEachComplexVisual(t),this._needRender=!0;this._updateInfoPanel(),this.dispatchEvent(s)};Se.prototype._onKeyDown=function(s){if(!(!this._running||!this._hotKeysEnabled)){if(pe.now.editing)switch(s.code){case"KeyC":this._enterComponentEditMode();break;case"KeyF":this._enterFragmentEditMode();break;case"KeyA":switch(this._editMode){case dn.COMPONENT:this._applyComponentEdit();break;case dn.FRAGMENT:this._applyFragmentEdit();break}break;case"KeyD":switch(this._editMode){case dn.COMPONENT:this._discardComponentEdit();break;case dn.FRAGMENT:this._discardFragmentEdit();break}break}switch(s.code){case"NumpadAdd":s.altKey&&(s.preventDefault(),s.stopPropagation(),this._forEachComplexVisual(e=>{e.expandSelection(),e.rebuildSelectionGeometry()}),this._updateInfoPanel(),this._needRender=!0);break;case"NumpadSubtract":s.altKey&&(s.preventDefault(),s.stopPropagation(),this._forEachComplexVisual(e=>{e.shrinkSelection(),e.rebuildSelectionGeometry()}),this._updateInfoPanel(),this._needRender=!0);break}}};Se.prototype._onKeyUp=function(s){!this._running||!this._hotKeysEnabled||s.code==="KeyX"&&this._extractRepresentation()};Se.prototype._updateInfoPanel=function(){const s=this._msgAtomInfo.getElementsByTagName("p")[0];let e,t,n=0;for(this._forEachComplexVisual(l=>{n+=l.getSelectionCount()});s.firstChild;)s.removeChild(s.firstChild);if(n===0){this._msgAtomInfo.style.opacity=0;return}let i=`${String(n)} atom${n!==1?"s":""} selected`;this._lastPick!==null&&(i+=", the last pick:");let r="",o="",a="";if(this._lastPick instanceof jH){e=this._lastPick,t=e.residue,o=e.name;const l=e.location!==32?String.fromCharCode(e.location):"";r=`${e.element.fullName} #${e.serial}${l}:       ${t._chain._name}.${t._type._name}${t._sequence}${t._icode.trim()}.`,r+=o,a=`Coord: (${e.position.x.toFixed(2).toString()},     ${e.position.y.toFixed(2).toString()},     ${e.position.z.toFixed(2).toString()})`}else this._lastPick instanceof qH?(t=this._lastPick,r=`${t._type._fullName}:       ${t._chain._name}.${t._type._name}${t._sequence}${t._icode.trim()}`):this._lastPick instanceof $H?r=`chain ${this._lastPick._name}`:this._lastPick instanceof ZH&&(r=`molecule ${this._lastPick._name}`);s.appendChild(document.createTextNode(i)),r!==""&&(s.appendChild(document.createElement("br")),s.appendChild(document.createTextNode(r))),a!==""&&(s.appendChild(document.createElement("br")),s.appendChild(document.createTextNode(a))),this._msgAtomInfo.style.opacity=1};Se.prototype._getAltObj=function(){if(this._editors){let s=null;for(let e=0;e<this._editors.length;++e){const t=this._editors[e].getAltObj();if(t.objects.length>0){if(s){s=null;break}s=t}}if(s)return s}return{objects:[],pivot:new b.Vector3(0,0,0)}};Se.prototype.resetPivot=function(){const s=new b.Box3,e=new b.Vector3;return function(){s.makeEmpty(),this._forEachVisual(t=>{s.union(t.getBoundaries().boundingBox)}),s.getCenter(e),this._objectControls.setPivot(e.negate()),this.dispatchEvent({type:"transform"})}}();Se.prototype.setPivotResidue=function(){const s=new b.Vector3;return function(e){const t=this._getVisualForComplex(e.getChain().getComplex());if(t){if(e._controlPoint)s.copy(e._controlPoint);else{let n=0,i=0,r=0;const o=e._atoms.length;for(let a=0;a<o;++a){const l=e._atoms[a].position;n+=l.x/o,i+=l.y/o,r+=l.z/o}s.set(n,i,r)}s.applyMatrix4(t.matrix).negate(),this._objectControls.setPivot(s),this.dispatchEvent({type:"transform"})}}}();Se.prototype.setPivotAtom=function(){const s=new b.Vector3;return function(e){const t=this._getVisualForComplex(e.residue.getChain().getComplex());t&&(s.copy(e.position),s.applyMatrix4(t.matrix).negate(),this._objectControls.setPivot(s),this.dispatchEvent({type:"transform"}))}}();Se.prototype.getSelectionCenter=function(){const s=new b.Vector3(0,0,0);return function(e,t,n){e.set(0,0,0);let i=0;return this._forEachComplexVisual(r=>{r.getSelectionCenter(s,t,n||r.getSelectionBit())&&(e.add(s),i++)}),i===0?!1:(e.divideScalar(i),e.negate(),!0)}}();Se.prototype.setPivotSubset=function(){const s=new b.Vector3(0,0,0);function e(n,i){return n.mask&1<<i}function t(n,i){return i.selector.includesAtom(n)}return function(n){const i=n?t:e;this.getSelectionCenter(s,i,n)?(this._objectControls.setPivot(s),this.dispatchEvent({type:"transform"})):this.logger.warn("selection is empty. Center operation not performed")}}();Se.prototype.screenshot=function(s,e){const t=this._gfx,n=t.renderer.domElement.width,i=t.renderer.domElement.height;function r(h){return Math.tan(b.MathUtils.degToRad(.5*h))}function o(h){return b.MathUtils.radToDeg(Math.atan(h))*2}function a(){let h;if(Oe.getBrowser()===Oe.browserType.SAFARI){const f=document.createElement("canvas"),p=f.getContext("2d");f.width=s===void 0?n:s,f.height=e===void 0?i:e,p.drawImage(t.renderer.domElement,0,0,f.width,f.height),h=f.toDataURL("image/png")}else h=t.renderer.domElement.toDataURL("image/png");return h}e=e||s;let l;if(s===void 0&&e===void 0||s===n&&e===i)l=a();else{const h=t.camera.aspect,u=t.camera.fov,f=r(t.camera.fov),p=Math.min(t.width,t.height),m=f*p/t.height,g=s/e;t.renderer.setPixelRatio(1),t.camera.aspect=g,t.camera.fov=o(m/Math.min(g,1)),t.camera.updateProjectionMatrix(),t.renderer.setDrawingBufferSize(s,e,1),this._renderFrame(pe.now.stereo),l=a(),t.renderer.setPixelRatio(window.devicePixelRatio),t.camera.aspect=h,t.camera.fov=u,t.camera.updateProjectionMatrix(),t.renderer.setDrawingBufferSize(t.width,t.height,window.devicePixelRatio),this._needRender=!0}return l};Se.prototype.screenshotSave=function(s,e,t){const n=this.screenshot(e,t);Oe.shotDownload(n,s)};Se.prototype.save=function(s){this._export(s.fileType).then(e=>{const t=this._visuals[this._curVisualName]._complex.name;Oe.download(e,t,s.fileType),this._refreshTitle(),this.dispatchEvent({type:"exportingDone"})}).catch(e=>{this.logger.error("Could not export data"),this.logger.debug(e),this._refreshTitle(),this.dispatchEvent({type:"exportingDone",error:e})})};Se.prototype._tweakResolution=function(){const s=[["poor",100],["low",500],["medium",1e3],["high",5e3],["ultra",Number.MAX_VALUE]];let e=0;if(this._forEachComplexVisual(t=>{e+=t.getComplex().getAtomCount()}),e>0){const t=this._gfxScore*1e6/e;for(let n=0;n<s.length;++n)if(t<s[n][1]){this._autoChangeResolution(s[n][0]);break}}};Se.prototype._autoChangeResolution=function(s){s!==pe.now.resolution&&this.logger.report(`Your rendering resolution was changed to "${s}" for best performance.`),pe.now.resolution=s};Se.prototype.saveSettings=function(){this._cookies.setCookie(this._opts.settingsCookie,JSON.stringify(this.settings.getDiffs(!0)))};Se.prototype.restoreSettings=function(){try{const s=this._cookies.getCookie(this._opts.settingsCookie),e=s?JSON.parse(s):{};this.settings.applyDiffs(e,!0)}catch(s){this.logger.error(`Cookies parse error: ${s.message}`)}};Se.prototype.resetSettings=function(){this.settings.reset()};Se.prototype.setOptions=function(s){typeof s=="string"&&(s=Se.options.fromAttr(s)),s.reps&&(this._opts.reps=null),Me.default.merge(this._opts,s),s.settings&&this.set(s.settings),this._opts._objects=s._objects,this._resetObjects(),s.load&&this.load(s.load,{fileType:s.type}),s.preset&&(pe.now.preset=s.preset),s.reps&&this.resetReps(s.preset),this._opts.view&&(this.view(this._opts.view),delete this._opts.view);const e=this._getComplexVisual();e&&(e.getComplex().resetCurrentUnit(),Me.default.isNumber(s.unit)&&e.getComplex().setCurrentUnit(s.unit),this.resetView(),this.rebuildAll())};Se.prototype.info=function(s){const e=this._getComplexVisual(s);if(!e)return{};const t=e.getComplex(),{metadata:n}=t;return{id:n.id||t.name||"UNKNOWN",title:n.title&&n.title.join(" ")||"UNKNOWN DATA",atoms:t.getAtomCount(),bonds:t.getBondCount(),residues:t.getResidueCount(),chains:t.getChainCount()}};Se.prototype.addObject=function(s,e){let t=null;if(s.type===rb.prototype.type&&(t=rb),t===null)throw new Error(`Unknown scene object type - ${s.type}`);try{const n=new t(s.params,s.opts);this._addSceneObject(n)}catch(n){if(!e)this.logger.debug(`Error during scene object creation: ${n.message}`);else throw n}this._needRender=!0};Se.prototype._addSceneObject=function(s){const e=this._getComplexVisual();s.build&&e&&(s.build(e.getComplex()),this._gfx.pivot.add(s.getGeometry()));const t=this._objects;t[t.length]=s};Se.prototype._updateObjsToFrame=function(s){const e=this._objects;for(let t=0,n=e.length;t<n;++t)e[t].updateToFrame&&e[t].updateToFrame(s)};Se.prototype._resetObjects=function(){const s=this._opts._objects;if(this._objects=[],s)for(let e=0,t=s.length;e<t;++e)this.addObject(s[e],!1)};Se.prototype.removeObject=function(s){const e=this._objects[s];if(!e)throw new Error(`Scene object with index ${s} does not exist`);e.destroy(),this._objects.splice(s,1),this._needRender=!0};Se.prototype.getURL=function(s){return c_.toURL(this.getState(Me.default.defaults(s,{compact:!0,settings:!1,view:!1})))};Se.prototype.getScript=function(s){return c_.toScript(this.getState(Me.default.defaults(s,{compact:!0,settings:!0,view:!0})))};Se.prototype._compareReps=function(s,e){const t={};let n=0;s&&(n=s.repCount());const i=pe.defaults.presets[pe.now.preset];let r=e;i===void 0||i.length>n?(r=!1,t.preset="empty"):pe.now.preset!==pe.defaults.preset&&(t.preset=pe.now.preset);const o=[];let a=!0;for(let l=0,h=n;l<h;++l)o[l]=s.repGet(l).compare(r?i[l]:null),Me.default.isEmpty(o[l])||(a=!1);return a||(t.reps=o),t};Se.prototype.getState=function(s){const e={};s=Me.default.defaults(s,{compact:!0,settings:!1,view:!1});const t=this._getComplexVisual();if(t!==null){const o=t.getComplex(),{metadata:a}=o;if(a.id){const h=a.format?`${a.format}:`:"";e.load=h+a.id}const l=o.getCurrentUnit();l!==1&&(e.unit=l)}const n=this._compareReps(t,s.compact);n.preset&&(e.preset=n.preset),n.reps&&(e.reps=n.reps);const i=this._objects,r=[];for(let o=0,a=i.length;o<a;++o)r[o]=i[o].identify();if(i.length>0&&(e._objects=r),s.view&&(e.view=this.view()),s.settings){const o=this.settings.getDiffs(!1);Me.default.isEmpty(o)||(e.settings=o)}return e};Se.prototype.get=function(s,e){return pe.get(s,e)};Se.prototype._clipPlaneUpdateValue=function(s){const e=Math.max(this._gfx.camera.position.z-s*pe.now.draft.clipPlaneFactor,pe.now.camNear),t={clipPlaneValue:e};this._forEachComplexVisual(n=>{n.setUberOptions(t)});for(let n=0,i=this._objects.length;n<i;++n){const r=this._objects[n];r._line&&r._line.material.setUberOptions(t)}this._picker!==null&&(this._picker.clipPlaneValue=e)};Se.prototype._fogFarUpdateValue=function(){this._picker!==null&&(this._gfx.scene.fog?this._picker.fogFarValue=this._gfx.scene.fog.far:this._picker.fogFarValue=void 0)};Se.prototype._updateShadowmapMeshes=function(s){this._forEachComplexVisual(e=>{const t=e._reprList;for(let n=0,i=t.length;n<i;++n){const r=t[n];s(r.geo,r.material)}})};Se.prototype._updateMaterials=function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this._forEachComplexVisual(n=>n.setMaterialValues(s,e,t));for(let n=0,i=this._objects.length;n<i;++n){const r=this._objects[n];r._line&&(r._line.material.setValues(s),r._line.material.needsUpdate=!0)}};Se.prototype._fogAlphaChanged=function(){this._forEachComplexVisual(s=>{s.setUberOptions({fogAlpha:pe.now.fogAlpha})})};Se.prototype._embedWebXR=function(){if(pe.now.stereo!=="WEBVR"){this.webVR&&this.webVR.disable(),this.webVR=null;return}this.webVR||(this.webVR=new XH(()=>{this._requestAnimationFrame(()=>this._onTick()),this._needRender=!0,this._onResize()})),this.webVR.enable(this._gfx)};Se.prototype._initOnSettingsChanged=function(){const s=(e,t)=>{e=Me.default.isArray(e)?e:[e],e.forEach(n=>{this.settings.addEventListener(`change:${n}`,t)})};s("modes.VD.frame",()=>{const e=this._getVolumeVisual();e!==null&&(e.showFrame(pe.now.modes.VD.frame),this._needRender=!0)}),s("modes.VD.isoMode",()=>{const e=this._getVolumeVisual();e!==null&&(e.getMesh().material.updateDefines(),this._needRender=!0)}),s("bg.color",()=>{this._onBgColorChanged()}),s("ao",()=>{if(pe.now.ao&&!BE(this._gfx.renderer.getContext()))this.logger.warn("Your device or browser does not support ao"),pe.set("ao",!1);else{const e={normalsToGBuffer:pe.now.ao};this._setUberMaterialValues(e)}}),s("zSprites",()=>{pe.now.zSprites&&!UE(this._gfx.renderer.getContext())&&(this.logger.warn("Your device or browser does not support zSprites"),pe.set("zSprites",!1)),this.rebuildAll()}),s("fogColor",()=>{this._onFogColorChanged()}),s("fogColorEnable",()=>{this._onFogColorChanged()}),s("bg.transparent",e=>{const t=this._gfx;t&&t.renderer.setClearColor(pe.now.bg.color,+!pe.now.bg.transparent),this._updateMaterials({fogTransparent:e.value}),this.rebuildAll()}),s("draft.clipPlane",e=>{this._updateMaterials({clipPlane:e.value}),this.rebuildAll()}),s("shadow.on",e=>{const t={shadowmap:e.value,shadowmapType:pe.now.shadow.type},n=this._gfx;n&&(n.renderer.shadowMap.enabled=!!t.shadowmap),this._updateMaterials(t,!0),t.shadowmap?(this._updateShadowCamera(),this._updateShadowmapMeshes(yl.createShadowmapMaterial)):this._updateShadowmapMeshes(yl.removeShadowmapMaterial),this._needRender=!0}),s("shadow.type",e=>{pe.now.shadow.on&&(this._updateMaterials({shadowmapType:e.value},!0),this._needRender=!0)}),s("shadow.radius",e=>{for(let t=0;t<this._gfx.scene.children.length;t++)if(this._gfx.scene.children[t].shadow!==void 0){const n=this._gfx.scene.children[t];n.shadow.radius=e.value,this._needRender=!0}}),s("fps",()=>{this._fps.show(pe.now.fps)}),s(["fog","fogNearFactor","fogFarFactor"],()=>{this._updateFog(),this._needRender=!0}),s("fogAlpha",()=>{const{fogAlpha:e}=pe.now;(e<0||e>1)&&this.logger.warn("fogAlpha must belong range [0,1]"),this._fogAlphaChanged(),this._needRender=!0}),s("autoResolution",e=>{e.value&&!this._gfxScore&&this.logger.warn("Benchmarks are missed, autoresolution will not work! Autoresolution should be set during miew startup.")}),s("stereo",()=>{this._embedWebXR(pe.now.stereo==="WEBVR"),this._needRender=!0}),s(["transparency","palette"],()=>{this.rebuildAll()}),s("resolution",()=>{this.rebuildAll();const e=this._getVolumeVisual();e&&(e.getMesh().material.updateDefines(),this._needRender=!0)}),s(["axes","fxaa","ao","outline.on","outline.color","outline.threshold","outline.thickness"],()=>{this._needRender=!0})};Se.prototype.set=function(s,e){pe.set(s,e)};Se.prototype.select=function(s,e){const t=this._getComplexVisual();if(!t)return;let n=s;Me.default.isString(s)&&(n=sf.parse(s).selector),t.select(n,e),this._lastPick=null,this._updateInfoPanel(),this._needRender=!0};const c0="1";Se.prototype.view=function(s){const e=this,{pivot:t}=this._gfx;let n=[];const i="ZXY";function r(){const a=t.position,l=e._objectControls.getScale()/pe.now.radiusToFit,h=new b.Euler;return h.setFromQuaternion(e._objectControls.getOrientation(),i),n=[a.x,a.y,a.z,l,h.x,h.y,h.z],c0+Oe.arrayToBase64(n,Float32Array)}function o(){s.length===40&&(s=`0${s}`);const a=s[0];if(n=Oe.arrayFromBase64(s.substr(1),Float32Array),a!==c0)if(a==="0")n[3]/=8;else{e.logger.warn(`Encoded view version mismatch, stored as ${a} vs ${c0} expected`);return}const l=e._interpolator,h=l.createView();h.position.copy(t.position),h.scale=e._objectControls.getScale(),h.orientation.copy(e._objectControls.getOrientation());const u=l.createView();u.position.set(n[0],n[1],n[2]),e._getComplexVisual()&&u.position.sub(e._getComplexVisual().position),u.scale=n[3],u.orientation.setFromEuler(new b.Euler(n[4],n[5],n[6],i)),l.setup(h,u)}return typeof s>"u"?r():(o(),s)};Se.prototype._updateView=function(){const s=this,{pivot:e}=this._gfx,t=this._interpolator;if(t.wasStarted()||t.start(),!t.isMoving())return;const n=t.getCurrentView();if(n.success){const i=n.view;e.position.copy(i.position),s._objectControls.setScale(i.scale*pe.now.radiusToFit),s._objectControls.setOrientation(i.orientation),this.dispatchEvent({type:"transform"}),s._needRender=!0}};Se.prototype.translate=function(s,e,t){this._objectControls.translatePivot(s,e,t),this.dispatchEvent({type:"transform"}),this._needRender=!0};Se.prototype.rotate=function(s,e,t){this._objectControls.rotate(new b.Quaternion().setFromEuler(new b.Euler(s,e,t,"XYZ"))),this.dispatchEvent({type:"transform"}),this._needRender=!0};Se.prototype.scale=function(s){if(s<=0)throw new RangeError("Scale should be greater than zero");this._objectControls.scale(s),this.dispatchEvent({type:"transform"}),this._needRender=!0};Se.prototype.center=function(s){if(s===void 0){this.setPivotSubset(),this._needRender=!0;return}if(s.obj!==void 0&&("atom"in s.obj||"residue"in s.obj)){"atom"in s.obj?this.setPivotAtom(s.obj.atom):this.setPivotResidue(s.obj.residue),this._needRender=!0;return}if(s.obj===void 0&&s!==""){const e=sf.parse(s);if(e.error===void 0){this.setPivotSubset(e),this._needRender=!0;return}}this.resetPivot(),this._needRender=!0};Se.prototype.within=function(s,e){const t=this._getComplexVisual();if(!t)return sf.None();s instanceof String&&(s=sf.parse(s));const n=t.within(s,e);return n&&(t.rebuildSelectionGeometry(),this._needRender=!0),n};Se.prototype.projected=function(s,e){const t=this._getComplexVisual(e);if(!t)return!1;const n=t.getComplex().getAtomByFullname(s);if(n===null)return!1;const i=n.position.clone();return this._gfx.pivot.updateMatrixWorldRecursive(),this._gfx.camera.updateMatrixWorldRecursive(),this._gfx.pivot.localToWorld(i),i.project(this._gfx.camera),{x:(i.x+1)*.5*this._gfx.width,y:(1-i.y)*.5*this._gfx.height}};Se.prototype.dssp=function(s){const e=this._getComplexVisual(s);e&&(e.getComplex().dssp(),e._reprList.forEach(t=>{(t.mode.id==="CA"||t.colorer.id==="SS")&&(t.needsRebuild=!0)}))};Se.prototype.exportCML=function(){const s=this;function e(r){const o=new b.Vector3,a=new b.Vector3,l=new b.Vector3;r.extractBasis(o,a,l),o.normalize(),a.normalize(),l.normalize();const h=new b.Matrix4;return h.identity(),h.makeBasis(o,a,l),h}function t(r){const{root:o}=s._gfx,a=e(o.matrixWorld),l=new b.Vector4(0,0,0,0),h=new b.Vector4(0,0,0,0);let u=null,f=null;r.forEachAtom(p=>{p.xmlNodeRef&&p.xmlNodeRef.xmlNode&&(u=p.xmlNodeRef.xmlNode,f=p.position,l.set(f.x,f.y,f.z,1),l.applyMatrix4(a),u.setAttribute("x3",l.x.toString()),u.setAttribute("y3",l.y.toString()),u.setAttribute("z3",l.z.toString()),u.removeAttribute("x2"),u.removeAttribute("y2"))}),r.forEachSGroup(p=>{if(p.xmlNodeRef&&p.xmlNodeRef.xmlNode){u=p.xmlNodeRef.xmlNode,f=p.getPosition(),l.set(f.x,f.y,f.z,1);const m=p.getCentralPoint();m===null?l.applyMatrix4(a):(h.set(m.x,m.y,m.z,0),l.add(h),l.applyMatrix4(a),h.set(m.x,m.y,m.z,1),h.applyMatrix4(a),l.sub(h)),u.setAttribute("x",l.x.toString()),u.setAttribute("y",l.y.toString()),u.setAttribute("z",l.z.toString())}})}const n=s._getComplexVisual(),i=n?n.getComplex():null;return i&&i.originalCML?(t(i),new XMLSerializer().serializeToString(i.originalCML)):null};Se.prototype.motm=function(){pe.set({fogColorEnable:!0,fogColor:0,outline:{on:!0,threshold:.01},bg:{color:16777215}}),this._forEachComplexVisual(s=>{const e=[],t=s.getComplex(),n=El.get(pe.now.palette);for(let i=0;i<t.getChainCount();i++){const r=t._chains[i]._name,o=n.getChainColor(r);e[i]={selector:`chain ${r}`,mode:"VW",colorer:["CB",{color:o,factor:.9}],material:"FL"}}s.resetReps(e)})};Se.prototype.VERSION="0.11.0";Me.default.assign(Se,{VERSION:Se.prototype.VERSION,registeredPlugins:[],chem:On,io:lo,modes:Yd,colorers:jd,materials:xl,palettes:El,options:c_,settings:pe,utils:Oe,gfx:{Representation:cg},thirdParty:{lodash:Me.default,three:b}});const ua=Se;var io=Ai(89);const Q_={$help:["Rendering mode shortcut","    BS - balls and sticks mode","    LN - lines mode","    LC - licorice mode","    VW - van der waals mode","    TR - trace mode","    TU - tube mode","    CA - cartoon mode","    SA - isosurface mode","    QS - quick surface mode","    SE - solvent excluded mode","    TX - text mode"],BS:{$help:["   Balls and sticks","      aromrad = <number> #aromatic radius","      atom = <number>    #atom radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      space = <number>   #space value
`]},CA:{$help:["   Cartoon","      arrow = <number>   #arrow size","      depth = <number>   #depth of surface","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius","      tension = <number> #",`      width = <number>  #secondary width
`]},LN:{$help:["   Lines","      atom = <number>    #atom radius","      chunkarom = <number>","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      offsarom = <number>
`]},LC:{$help:["   Licorice","      aromrad = <number> #aromatic radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      space = <number>   #space value
`]},VW:{$help:["   Van der Waals",`      nothing
`]},TR:{$help:["   Trace",`      radius = <number>  #tube radius
`]},TU:{$help:["   Tube","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius",`      tension = <number> 
`]},SA:{$help:["   Surface",`      zClip = <bool> #clip z plane
`]},QS:{$help:["   Quick surface","      isoValue = <number>","      scale = <number>","      wireframe = <bool>",`      zClip = <bool> #clip z plane
`]},SE:{$help:["   Solvent excluded surface",`      zClip = <bool> #clip z plane
`]},TX:{$help:["   Text mode",'      template = <format string> string that can include "{{ id }}"',"          it will be replaced by value, id can be one of next:",`          serial, name, type, sequence, residue, chain, hetatm, water
`,'      horizontalAlign = <string> {"left", "right", "center"}','      verticalAlign = <string> {"top", "bottom", "middle"}',"      dx = <number> #offset along x","      dy = <number> #offset along y","      dz = <number> #offset along z","      fg = <string> #text color modificator","           could be keyword, named color or hex","      fg = <string> #back color modificator","           could be keyword, named color or hex","      showBg = <bool> #if set show background","           plate under text"]}},e1={$help:["Coloring mode shortcut","    EL - color by element","    CH - color by chain","    SQ - color by sequence","    RT - color by residue type","    SS - color by secondary structure","    UN - uniform"],UN:{$help:["Parameters of coloring modes customization","   Uniform",`      color = <number|color> #RGB->HEX->dec
`],color:{$help:Object.keys(El.get(pe.now.palette).namedColors).sort().join(`
`)}}},zE={$help:["Material shortcut","    DF - diffuse","    TR - transparent","    SF - soft plastic","    PL - glossy plastic","    ME - metal","    GL - glass"]},ab={$help:["Short (packed) representation description as a set of variables","    s=<EXPRESSION>","        selector property","    m=<MODE_ID>[!<PARAMETER>:<VALUE>[,...]]","        render mode property","    c=<COLORER_ID>[!<PARAMETER>:<VALUE>[,...]]","        color mode property","    mt=<MATERIAL_ID>","        material property"],s:{$help:"Selection expression string as it is in menu->representations->selection"},m:Q_,c:e1,mt:zE},lb={$help:["Parameters of rendering modes customization: modes","Parameters of colorer customization: colorers","Autobuild: autobuild = (<number>|<bool>)"],modes:Q_,colorers:e1},a9={$help:["help (<cmd name>| <path to property>)","You can get detailed information about command options",`   using "help cmd.opt.opt.[...]"
`,"   you can use one line comments","   everything started from (#|//) will be skipped",`   Example: >build //some comment
`,"List of available commands:"],reset:{$help:["Reload current object, delete all representations","    Nothing will work until load new object"]},load:{$help:["load (<PDBID>|<URL>|-f [<*.NC FILE URL STRING>])","    Load new pdb object from selected source"],PDBID:{$help:"pdb id in remote molecule database"},URL:{$help:"url to source file"},f:{$help:["open file system dialog to fetch local file","optionally you can determine trajectory file","via URL for *.top model"]}},clear:{$help:"No args. Clear terminal"},add:{$help:["add [<REP_NAME>] [<DESCRIPTION>]","    Add new item to representation set with","    default or <DESCRIPTION> params"],REP_NAME:{$help:"Identifier string [_,a-z,A-Z,0-9] can not start from digit"},DESCRIPTION:ab},rep:{$help:["rep [<REP_NAME>|<REP_INDEX>] [<DESCRIPTION>]","    set current representation by name or index","    edit current representation by <DESCRIPTION>"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"},DESCRIPTION:ab},remove:{$help:["remove (<REP_NAME>|<REP_INDEX>)","Remove representation by name or index"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"}},selector:{$help:["selector <EXPRESSION>","   set selector from EXPRESSION to current representation"],EXPRESSION:{$help:"Selection expression string as it is in menu->representations->selection"}},mode:{$help:["mode <MODE_ID> [<PARAMETER>=<VALUE>...]","   set rendering mode and apply parameters to current representation"],MODE_ID:Q_},color:{$help:["color <COLORER_ID> [<PARAMETER>=<VALUE>...]","   set colorer and apply parameters to current representation"],COLORER_ID:e1},material:{$help:["material <MATERIAL_ID>","   set material to current representation"],MATERIAL_ID:zE},build:{$help:"build help str",add:{$help:"build.add",new:{$help:["add.new","add.new new line 1","add.new new line 2","add.new new line 3"]}},del:{$help:"build.del"}},list:{$help:["list [-e|-s|<REP_NAME>|<REP_INDEX>]","Print representations if no args print list of representations","    -e expand list and show all representations","    -s show all user-registered selectors","    <REP_NAME>|<REP_INDEX> show only current representation"]},hide:{$help:["hide (<REP_NAME>|<REP_INDEX>)","Hide representation referenced in args"]},show:{$help:["show (<REP_NAME>|<REP_INDEX>)","Show representation referenced in args"]},get:{$help:["get <PARAMETER>","Print <PARAMETER> value","    <PARAMETER> - path to option use get.PARAMETER to get more info"],PARAMETER:lb},set:{$help:["set <PARAMETER> <VALUE>","Set <PARAMETER> with <VALUE>","    <PARAMETER> - path to option use set.PARAMETER to get more info"],PARAMETER:lb},set_save:{$help:["set_save","Save current settings to cookie"]},set_restore:{$help:["set_restore","Load and apply settings from cookie"]},set_reset:{$help:["set_reset","Reset current settings to the defaults"]},preset:{$help:["preset [<PRESET>]","Reset current representation or set preset to <PRESET>"],PRESET:{$help:["default","wire","small","macro"]}},unit:{$help:["unit [<unit_id>]","Change current biological structure view. Zero <unit_id> value means asymmetric unit,","positive values set an assembly with corresponding number.","Being called with no parameters command prints current unit information."]},view:{$help:["view [<ENCODED_VIEW>]","Get current encoded view or set if ENCODED_VIEW placed as argument"],ENCODED_VIEW:{$help:["encoded view matrix string (binary code)"]}},rotate:{$help:["rotate (x|y|z) [<DEGREES>] [(x|y|z) [<DEGREES>]]...","Rotate scene"]},scale:{$help:["scale <SCALE>","Scale scene"]},select:{$help:["select <SELECTOR_STRING> [as <SELECTOR_NAME>]","Select atoms using selector defined in SELECTOR_STRING","    and if SELECTOR_NAME is defined register it in viewer","    you can use it later as a complex selector"]},within:{$help:["within <DISTANCE> of <SELECTOR_STRING> as <SELECTOR_NAME>","Build within named selector","    DISTANCE        <number>","    SELECTOR_STRING <string(selection language)>","    SELECTOR_NAME   <identifier>"]},url:{$help:["url [-s] [-v]","Report URL encoded scene","    if -s set that include settings in the URL","    if -v set that include view in the URL"]},screenshot:{$help:["screenshot [<WIDTH> [<HEIGHT>]]","Make a screenshot of the scene","    WIDTH  <number> in pixels","    HEIGHT <number> in pixels, equal to WIDTH by default"]},line:{$help:["line <first_atom_path> <second_atom_path> [<PARAMETER>=<VALUE>]","Draw dashed line between two specified atoms"]},removeobj:{$help:["removeobj <id>","Remove scene object by its index. Indices could be obtained by <listobj> command"]},listobj:{$help:["listobj","Display the list of all existing scene objects"]}},h0=a9,{chem:{selectors:t1},modes:l9,colorers:c9,materials:h9,palettes:cb,options:u9,settings:Dd}=ua;function d9(){}const VE=function(){const s=new d9;return function(){return s}}();class f9{constructor(){this.representationMap={},this.representationID={}}get(e){return this.representationMap[e]||this.representationID[e]||"<no name>"}add(e,t){if(e===-1)return"Can not create representation: there is no data";if(t!==void 0)if(!this.representationMap.hasOwnProperty(e))this.representationMap[e.toString()]=t,this.representationID[t]=e.toString();else return"This name has already existed, registered without name";return`Representation ${e} successfully added`}remove(e){e&&this.representationID.hasOwnProperty(e)&&(delete this.representationMap[this.representationID[e]],delete this.representationID[e]);const t=Object.keys(this.representationID).sort();for(const n in t)if(t.hasOwnProperty(n)){const i=t[n];i>e&&(this.representationID[i-1]=this.representationID[i],this.representationMap[this.representationID[i]]-=1,delete this.representationID[i])}}clear(){this.representationMap={},this.representationID={}}}const p9=new f9;function of(s){const t={s:"selector",m:"mode",c:"colorer",mt:"material",mode:"modes",color:"colorers",colorer:"colorers",select:"selector",material:"materials",selector:"selector"}[s];return t===void 0?s:t}class m9{list(e,t,n){let i="";if(e&&t!==void 0&&(n===void 0||n==="-e")){const r=e.repCount();for(let o=0;o<r;o++)i+=this.listRep(e,t,o,n)}return i}listRep(e,t,n,i){let r="";const o=e.repGet(n);if(!o)return In.warn(`Rep ${n} does not exist!`),r;const a=n,l=t.get(a),{mode:h,colorer:u}=o,f=o.selectorString,p=o.materialPreset;return r+=`#${a} : ${h.name}${l==="<no name>"?"":`, ${l}`}
`,i!==void 0&&(r+=`    selection : "${f}"
`,r+=`    mode      : (${h.id}), ${h.name}
`,r+=`    colorer   : (${u.id}), ${u.name}
`,r+=`    material  : (${p.id}), ${p.name}
`),r}listSelector(e,t){let n="";for(const i in t)t.hasOwnProperty(i)&&(n+=`${i} : "${t[i]}"
`);return n}listObjs(e){const t=e._objects;if(!t||!Array.isArray(t)||t.length===0)return"There are no objects on the scene";const n=[];for(let i=0,r=t.length;i<r;++i)n[i]=`${i}: ${t[i].toString()}`;return n.join(`
`)}joinHelpStr(e){return e instanceof Array?e.join(`
`):e}help(e){if(Me.default.isUndefined(e))return`${this.joinHelpStr(h0.$help)}
${Me.default.slice(Me.default.sortBy(Me.default.keys(h0)),1).join(", ")}
`;const t=Me.default.get(h0,e);return Me.default.isUndefined(t)?this.help():`${this.joinHelpStr(t.$help)}
`}load(e,t){if(e===void 0||t===void 0||t==="-f")return;e.awaitWhileCMDisInProcess();const n=()=>e.finishAwaitingCMDInProcess();e.load(t).then(n,n)}checkArg(e,t,n){if(e!==void 0&&t!==void 0){if(of(e)==="selector"){const a=t1.parse(t);if(a.error!==void 0)throw{message:a.error};return n!==void 0&&n?a.selector:t}const i={colorers:c9,modes:l9,materials:h9};let r=e,o;for(;r!==o;)o=r,r=of(o);if(i[r].get(t)===void 0)throw{message:`${t} is not existed in ${r}`};return t}return VE}propagateProp(e,t){if(e!==void 0){let n={};const i=u9.adapters[typeof Me.default.get(Dd.defaults,e)];if(i===void 0)throw{message:`${e} is not existed`};if((e.endsWith(".color")||e.endsWith(".baseColor")||e.endsWith(".EL.carbon"))&&typeof t!="number"&&(t=cb.get(Dd.now.palette).getNamedColor(t)),e.endsWith(".fg")||e.endsWith(".bg"))if(typeof t!="number"){const r=cb.get(Dd.now.palette).getNamedColor(t,!0);r!==void 0&&(t=`0x${r.toString(16)}`)}else t=`0x${t.toString(16)}`;if(e.endsWith(".template")&&(t=t.replace(/\\n/g,`
`)),t!==void 0&&i(t)!==t&&i(t)!==t>0)throw n={message:`${e} must be a "${typeof Me.default.get(Dd.defaults,e)}"`},n}return t}unquoteString(e){return Oe.unquoteString(e)}}const g9=new m9;function _9(s,e){const t={};return t[s]=e,t}function Hf(s){if(s instanceof this.constructor)return s;s instanceof Array?this._values=s.slice(0):s?this._values=[s]:this._values=[]}Hf.prototype.append=function(s){const e=this._values;return e[e.length]=s,this};Hf.prototype.remove=function(s){const e=this._values,t=e.indexOf(s);return t>=0&&e.splice(t,1),this};Hf.prototype.toJSO=function(s,e,t){const n={},i=this._values;for(let r=0,o=i.length;r<o;++r)Me.default.set(n,i[r].id,s.propagateProp(`${of(e)}.${t}.${i[r].id}`,i[r].val));return n};function x9(s,e){this.id=s,this.val=e}const Ci=Object.create({});Ci.Arg=x9;Ci.ArgList=Hf;Ci.miew=null;Ci.echo=null;Ci.representations=p9;Ci.utils=g9;Ci._=Me.default;Ci.CreateObjectPair=_9;Ci.keyRemap=of;Ci.Context=t1.Context;Ci.ClearContext=t1.ClearContext;Ci.NULL=VE;Ci.notimplemented=function(){return this.NULL};ua.prototype.script=function(s,e,t){io.parser.yy.miew=this,io.parser.yy.echo=e,io.parser.yy.error=t,this.cmdQueue===void 0&&(this.cmdQueue=[]),this.commandInAction===void 0&&(this.commandInAction=!1),this.cmdQueue=this.cmdQueue.concat(s.split(`
`))};ua.prototype.awaitWhileCMDisInProcess=function(){this.commandInAction=!0};ua.prototype.finishAwaitingCMDInProcess=function(){this.commandInAction=!1};ua.prototype.isScriptingCommandAvailable=function(){return this.commandInAction!==void 0&&!this.commandInAction&&this.cmdQueue!==void 0&&this.cmdQueue.length>0};ua.prototype.callNextCmd=function(){if(this.isScriptingCommandAvailable()){const s=this.cmdQueue.shift(),e={};e.success=!1;try{io.parser.parse(s),e.success=!0}catch(t){e.error=t.message,io.parser.yy.error(e.error),this.finishAwaitingCMDInProcess()}return e}return""};io.parser.yy=Ci;io.parser.yy.parseError=io.parser.parseError;const y9=ua;var v9=xM.A;const S9={class:"container-3d"},b9={class:"info"},w9={key:0},M9=GP({__name:"MolRender3D",props:{data3D:{},data3DFormat:{},molName:{}},setup(s){const e=s,t=em(null),n=em(null),i=em(!1);let r=null,o=null;const a=xy(()=>!!e.data3D),l=xy(()=>e.data3DFormat=="sdf");HP(()=>{a.value&&h()}),WP(()=>e.data3D,()=>{f(!1,!0)}),XP(()=>{r&&(r.term(),r=null)});function h(){if(t.value){if(!a.value){r.term(),r=null,t.value.innerHTML="";return}f()}}async function u(p){i.value=p,p&&(await JP(),f(!0))}function f(p=!1,m=!1){let g;if(p&&!o||!p&&!r||m){const v=p?n.value:t.value;g=new v9({container:v,settings:{axes:!1,fps:!1,camDistance:l.value?3:2,resolution:"high",zooming:!!p,bg:{color:16053492}}}),g.init()&&(g.enableHotKeys(p),g.run()),e.data3DFormat=="sdf"?g.load(e.data3D,{sourceType:"immediate",fileType:"sdf"}):e.data3DFormat=="pdb"?g.load(e.data3D,{sourceType:"immediate",fileType:"pdb"}):e.data3DFormat=="cif"&&g.load(e.data3D,{sourceType:"immediate",fileType:"cif"}),p?o=g:r=g}}return(p,m)=>(yy(),vy(KP,null,[cc("div",S9,[Sy(by,{icon:"icn-full-screen-large",iconHover:"icn-full-screen-large-hover",icnSize:"large",btnStyle:"soft",onClick:m[0]||(m[0]=g=>u(!0))}),cc("div",{class:"viewer",ref_key:"$container3d",ref:t},null,512)]),cc("div",{id:"container-3d-fs",class:ZP(["container-3d",{show:i.value}])},[Sy(by,{icon:"icn-close",btnStyle:"soft",icnSize:"large",onClick:m[1]||(m[1]=g=>u(!1))}),cc("div",b9,[p.molName?(yy(),vy("h4",w9,YP(jP(qP)(p.molName)),1)):$P("",!0)]),cc("div",{class:"viewer",ref_key:"$container3dFs",ref:n},null,512)],2)],64))}}),q9=QP(M9,[["__scopeId","data-v-fd5756a5"]]);export{q9 as M};
