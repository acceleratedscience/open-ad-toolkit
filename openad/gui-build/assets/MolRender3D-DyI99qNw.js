import{a7 as wl,d as wT,r as Rd,c as Z_,H as bT,w as MT,o as ET,h as j_,i as K_,v as bl,n as J_,Q as Q_,t as CT,j as AT,X as TT,m as RT,S as LT,F as PT,P as IT,E as NT}from"./index-jyqcHVzo.js";var Nf={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Nf.exports;(function(a,e){(function(){var t,r="4.17.21",n=200,i="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",s="Expected a function",o="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",c=500,f="__lodash_placeholder__",d=1,p=2,m=4,v=1,y=2,S=1,_=2,x=4,b=8,M=16,E=32,T=64,R=128,V=256,Y=512,$=30,W="...",j=800,X=16,P=1,N=2,I=3,G=1/0,ee=9007199254740991,re=17976931348623157e292,he=NaN,pe=4294967295,Ie=pe-1,De=pe>>>1,Le=[["ary",R],["bind",S],["bindKey",_],["curry",b],["curryRight",M],["flip",Y],["partial",E],["partialRight",T],["rearg",V]],Oe="[object Arguments]",ne="[object Array]",at="[object AsyncFunction]",Ge="[object Boolean]",We="[object Date]",Ve="[object DOMException]",Te="[object Error]",me="[object Function]",ge="[object GeneratorFunction]",se="[object Map]",we="[object Number]",Ee="[object Null]",z="[object Object]",F="[object Promise]",ue="[object Proxy]",be="[object RegExp]",Fe="[object Set]",He="[object String]",rt="[object Symbol]",Ke="[object Undefined]",je="[object WeakMap]",Je="[object WeakSet]",A="[object ArrayBuffer]",D="[object DataView]",O="[object Float32Array]",te="[object Float64Array]",q="[object Int8Array]",Ae="[object Int16Array]",Re="[object Int32Array]",$e="[object Uint8Array]",et="[object Uint8ClampedArray]",Ze="[object Uint16Array]",yt="[object Uint32Array]",Xt=/\b__p \+= '';/g,en=/\b(__p \+=) '' \+/g,Lt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Qe=/&(?:amp|lt|gt|quot|#39);/g,ct=/[&<>"']/g,ie=RegExp(Qe.source),Mt=RegExp(ct.source),le=/<%-([\s\S]+?)%>/g,Ot=/<%([\s\S]+?)%>/g,Se=/<%=([\s\S]+?)%>/g,Yt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rn=/^\w*$/,mr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Zn=/[\\^$.*+?()[\]{}|]/g,Vn=RegExp(Zn.source),U=/^\s+/,de=/\s/,ce=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,_e=/\{\n\/\* \[wrapped with (.+)\] \*/,Ye=/,? & /,xt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ut=/[()=,{}\[\]\/\s]/,ot=/\\(\\)?/g,dt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,bt=/\w*$/,vt=/^[-+]0x[0-9a-f]+$/i,Et=/^0b[01]+$/i,ft=/^\[object .+?Constructor\]$/,Un=/^0o[0-7]+$/i,Ht=/^(?:0|[1-9]\d*)$/,Gn=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Kt=/($^)/,qr=/['\n\r\u2028\u2029\\]/g,jn="\\ud800-\\udfff",fn="\\u0300-\\u036f",Kn="\\ufe20-\\ufe2f",Ln="\\u20d0-\\u20ff",Mv=fn+Kn+Ln,Ev="\\u2700-\\u27bf",Cv="a-z\\xdf-\\xf6\\xf8-\\xff",_w="\\xac\\xb1\\xd7\\xf7",yw="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",xw="\\u2000-\\u206f",Sw=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Av="A-Z\\xc0-\\xd6\\xd8-\\xde",Tv="\\ufe0e\\ufe0f",Rv=_w+yw+xw+Sw,yh="['’]",ww="["+jn+"]",Lv="["+Rv+"]",Vc="["+Mv+"]",Pv="\\d+",bw="["+Ev+"]",Iv="["+Cv+"]",Nv="[^"+jn+Rv+Pv+Ev+Cv+Av+"]",xh="\\ud83c[\\udffb-\\udfff]",Mw="(?:"+Vc+"|"+xh+")",kv="[^"+jn+"]",Sh="(?:\\ud83c[\\udde6-\\uddff]){2}",wh="[\\ud800-\\udbff][\\udc00-\\udfff]",Os="["+Av+"]",Ov="\\u200d",Dv="(?:"+Iv+"|"+Nv+")",Ew="(?:"+Os+"|"+Nv+")",Fv="(?:"+yh+"(?:d|ll|m|re|s|t|ve))?",Bv="(?:"+yh+"(?:D|LL|M|RE|S|T|VE))?",zv=Mw+"?",Vv="["+Tv+"]?",Cw="(?:"+Ov+"(?:"+[kv,Sh,wh].join("|")+")"+Vv+zv+")*",Aw="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Tw="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Uv=Vv+zv+Cw,Rw="(?:"+[bw,Sh,wh].join("|")+")"+Uv,Lw="(?:"+[kv+Vc+"?",Vc,Sh,wh,ww].join("|")+")",Pw=RegExp(yh,"g"),Iw=RegExp(Vc,"g"),bh=RegExp(xh+"(?="+xh+")|"+Lw+Uv,"g"),Nw=RegExp([Os+"?"+Iv+"+"+Fv+"(?="+[Lv,Os,"$"].join("|")+")",Ew+"+"+Bv+"(?="+[Lv,Os+Dv,"$"].join("|")+")",Os+"?"+Dv+"+"+Fv,Os+"+"+Bv,Tw,Aw,Pv,Rw].join("|"),"g"),kw=RegExp("["+Ov+jn+Mv+Tv+"]"),Ow=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Dw=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Fw=-1,cn={};cn[O]=cn[te]=cn[q]=cn[Ae]=cn[Re]=cn[$e]=cn[et]=cn[Ze]=cn[yt]=!0,cn[Oe]=cn[ne]=cn[A]=cn[Ge]=cn[D]=cn[We]=cn[Te]=cn[me]=cn[se]=cn[we]=cn[z]=cn[be]=cn[Fe]=cn[He]=cn[je]=!1;var an={};an[Oe]=an[ne]=an[A]=an[D]=an[Ge]=an[We]=an[O]=an[te]=an[q]=an[Ae]=an[Re]=an[se]=an[we]=an[z]=an[be]=an[Fe]=an[He]=an[rt]=an[$e]=an[et]=an[Ze]=an[yt]=!0,an[Te]=an[me]=an[je]=!1;var Bw={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},zw={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Vw={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Uw={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Gw=parseFloat,Hw=parseInt,Gv=typeof wl=="object"&&wl&&wl.Object===Object&&wl,Ww=typeof self=="object"&&self&&self.Object===Object&&self,Hn=Gv||Ww||Function("return this")(),Mh=e&&!e.nodeType&&e,ns=Mh&&!0&&a&&!a.nodeType&&a,Hv=ns&&ns.exports===Mh,Eh=Hv&&Gv.process,Zr=function(){try{var ae=ns&&ns.require&&ns.require("util").types;return ae||Eh&&Eh.binding&&Eh.binding("util")}catch{}}(),Wv=Zr&&Zr.isArrayBuffer,Xv=Zr&&Zr.isDate,Yv=Zr&&Zr.isMap,$v=Zr&&Zr.isRegExp,qv=Zr&&Zr.isSet,Zv=Zr&&Zr.isTypedArray;function Nr(ae,Ne,ye){switch(ye.length){case 0:return ae.call(Ne);case 1:return ae.call(Ne,ye[0]);case 2:return ae.call(Ne,ye[0],ye[1]);case 3:return ae.call(Ne,ye[0],ye[1],ye[2])}return ae.apply(Ne,ye)}function Xw(ae,Ne,ye,lt){for(var Ct=-1,$t=ae==null?0:ae.length;++Ct<$t;){var Pn=ae[Ct];Ne(lt,Pn,ye(Pn),ae)}return lt}function jr(ae,Ne){for(var ye=-1,lt=ae==null?0:ae.length;++ye<lt&&Ne(ae[ye],ye,ae)!==!1;);return ae}function Yw(ae,Ne){for(var ye=ae==null?0:ae.length;ye--&&Ne(ae[ye],ye,ae)!==!1;);return ae}function jv(ae,Ne){for(var ye=-1,lt=ae==null?0:ae.length;++ye<lt;)if(!Ne(ae[ye],ye,ae))return!1;return!0}function ha(ae,Ne){for(var ye=-1,lt=ae==null?0:ae.length,Ct=0,$t=[];++ye<lt;){var Pn=ae[ye];Ne(Pn,ye,ae)&&($t[Ct++]=Pn)}return $t}function Uc(ae,Ne){var ye=ae==null?0:ae.length;return!!ye&&Ds(ae,Ne,0)>-1}function Ch(ae,Ne,ye){for(var lt=-1,Ct=ae==null?0:ae.length;++lt<Ct;)if(ye(Ne,ae[lt]))return!0;return!1}function hn(ae,Ne){for(var ye=-1,lt=ae==null?0:ae.length,Ct=Array(lt);++ye<lt;)Ct[ye]=Ne(ae[ye],ye,ae);return Ct}function da(ae,Ne){for(var ye=-1,lt=Ne.length,Ct=ae.length;++ye<lt;)ae[Ct+ye]=Ne[ye];return ae}function Ah(ae,Ne,ye,lt){var Ct=-1,$t=ae==null?0:ae.length;for(lt&&$t&&(ye=ae[++Ct]);++Ct<$t;)ye=Ne(ye,ae[Ct],Ct,ae);return ye}function $w(ae,Ne,ye,lt){var Ct=ae==null?0:ae.length;for(lt&&Ct&&(ye=ae[--Ct]);Ct--;)ye=Ne(ye,ae[Ct],Ct,ae);return ye}function Th(ae,Ne){for(var ye=-1,lt=ae==null?0:ae.length;++ye<lt;)if(Ne(ae[ye],ye,ae))return!0;return!1}var qw=Rh("length");function Zw(ae){return ae.split("")}function jw(ae){return ae.match(xt)||[]}function Kv(ae,Ne,ye){var lt;return ye(ae,function(Ct,$t,Pn){if(Ne(Ct,$t,Pn))return lt=$t,!1}),lt}function Gc(ae,Ne,ye,lt){for(var Ct=ae.length,$t=ye+(lt?1:-1);lt?$t--:++$t<Ct;)if(Ne(ae[$t],$t,ae))return $t;return-1}function Ds(ae,Ne,ye){return Ne===Ne?lb(ae,Ne,ye):Gc(ae,Jv,ye)}function Kw(ae,Ne,ye,lt){for(var Ct=ye-1,$t=ae.length;++Ct<$t;)if(lt(ae[Ct],Ne))return Ct;return-1}function Jv(ae){return ae!==ae}function Qv(ae,Ne){var ye=ae==null?0:ae.length;return ye?Ph(ae,Ne)/ye:he}function Rh(ae){return function(Ne){return Ne==null?t:Ne[ae]}}function Lh(ae){return function(Ne){return ae==null?t:ae[Ne]}}function eg(ae,Ne,ye,lt,Ct){return Ct(ae,function($t,Pn,tn){ye=lt?(lt=!1,$t):Ne(ye,$t,Pn,tn)}),ye}function Jw(ae,Ne){var ye=ae.length;for(ae.sort(Ne);ye--;)ae[ye]=ae[ye].value;return ae}function Ph(ae,Ne){for(var ye,lt=-1,Ct=ae.length;++lt<Ct;){var $t=Ne(ae[lt]);$t!==t&&(ye=ye===t?$t:ye+$t)}return ye}function Ih(ae,Ne){for(var ye=-1,lt=Array(ae);++ye<ae;)lt[ye]=Ne(ye);return lt}function Qw(ae,Ne){return hn(Ne,function(ye){return[ye,ae[ye]]})}function tg(ae){return ae&&ae.slice(0,ag(ae)+1).replace(U,"")}function kr(ae){return function(Ne){return ae(Ne)}}function Nh(ae,Ne){return hn(Ne,function(ye){return ae[ye]})}function ol(ae,Ne){return ae.has(Ne)}function ng(ae,Ne){for(var ye=-1,lt=ae.length;++ye<lt&&Ds(Ne,ae[ye],0)>-1;);return ye}function rg(ae,Ne){for(var ye=ae.length;ye--&&Ds(Ne,ae[ye],0)>-1;);return ye}function eb(ae,Ne){for(var ye=ae.length,lt=0;ye--;)ae[ye]===Ne&&++lt;return lt}var tb=Lh(Bw),nb=Lh(zw);function rb(ae){return"\\"+Uw[ae]}function ib(ae,Ne){return ae==null?t:ae[Ne]}function Fs(ae){return kw.test(ae)}function ab(ae){return Ow.test(ae)}function sb(ae){for(var Ne,ye=[];!(Ne=ae.next()).done;)ye.push(Ne.value);return ye}function kh(ae){var Ne=-1,ye=Array(ae.size);return ae.forEach(function(lt,Ct){ye[++Ne]=[Ct,lt]}),ye}function ig(ae,Ne){return function(ye){return ae(Ne(ye))}}function pa(ae,Ne){for(var ye=-1,lt=ae.length,Ct=0,$t=[];++ye<lt;){var Pn=ae[ye];(Pn===Ne||Pn===f)&&(ae[ye]=f,$t[Ct++]=ye)}return $t}function Hc(ae){var Ne=-1,ye=Array(ae.size);return ae.forEach(function(lt){ye[++Ne]=lt}),ye}function ob(ae){var Ne=-1,ye=Array(ae.size);return ae.forEach(function(lt){ye[++Ne]=[lt,lt]}),ye}function lb(ae,Ne,ye){for(var lt=ye-1,Ct=ae.length;++lt<Ct;)if(ae[lt]===Ne)return lt;return-1}function cb(ae,Ne,ye){for(var lt=ye+1;lt--;)if(ae[lt]===Ne)return lt;return lt}function Bs(ae){return Fs(ae)?fb(ae):qw(ae)}function ui(ae){return Fs(ae)?hb(ae):Zw(ae)}function ag(ae){for(var Ne=ae.length;Ne--&&de.test(ae.charAt(Ne)););return Ne}var ub=Lh(Vw);function fb(ae){for(var Ne=bh.lastIndex=0;bh.test(ae);)++Ne;return Ne}function hb(ae){return ae.match(bh)||[]}function db(ae){return ae.match(Nw)||[]}var pb=function ae(Ne){Ne=Ne==null?Hn:zs.defaults(Hn.Object(),Ne,zs.pick(Hn,Dw));var ye=Ne.Array,lt=Ne.Date,Ct=Ne.Error,$t=Ne.Function,Pn=Ne.Math,tn=Ne.Object,Oh=Ne.RegExp,mb=Ne.String,Kr=Ne.TypeError,Wc=ye.prototype,vb=$t.prototype,Vs=tn.prototype,Xc=Ne["__core-js_shared__"],Yc=vb.toString,Jt=Vs.hasOwnProperty,gb=0,sg=function(){var u=/[^.]+$/.exec(Xc&&Xc.keys&&Xc.keys.IE_PROTO||"");return u?"Symbol(src)_1."+u:""}(),$c=Vs.toString,_b=Yc.call(tn),yb=Hn._,xb=Oh("^"+Yc.call(Jt).replace(Zn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qc=Hv?Ne.Buffer:t,ma=Ne.Symbol,Zc=Ne.Uint8Array,og=qc?qc.allocUnsafe:t,jc=ig(tn.getPrototypeOf,tn),lg=tn.create,cg=Vs.propertyIsEnumerable,Kc=Wc.splice,ug=ma?ma.isConcatSpreadable:t,ll=ma?ma.iterator:t,rs=ma?ma.toStringTag:t,Jc=function(){try{var u=ls(tn,"defineProperty");return u({},"",{}),u}catch{}}(),Sb=Ne.clearTimeout!==Hn.clearTimeout&&Ne.clearTimeout,wb=lt&&lt.now!==Hn.Date.now&&lt.now,bb=Ne.setTimeout!==Hn.setTimeout&&Ne.setTimeout,Qc=Pn.ceil,eu=Pn.floor,Dh=tn.getOwnPropertySymbols,Mb=qc?qc.isBuffer:t,fg=Ne.isFinite,Eb=Wc.join,Cb=ig(tn.keys,tn),In=Pn.max,Jn=Pn.min,Ab=lt.now,Tb=Ne.parseInt,hg=Pn.random,Rb=Wc.reverse,Fh=ls(Ne,"DataView"),cl=ls(Ne,"Map"),Bh=ls(Ne,"Promise"),Us=ls(Ne,"Set"),ul=ls(Ne,"WeakMap"),fl=ls(tn,"create"),tu=ul&&new ul,Gs={},Lb=cs(Fh),Pb=cs(cl),Ib=cs(Bh),Nb=cs(Us),kb=cs(ul),nu=ma?ma.prototype:t,hl=nu?nu.valueOf:t,dg=nu?nu.toString:t;function k(u){if(xn(u)&&!Tt(u)&&!(u instanceof zt)){if(u instanceof Jr)return u;if(Jt.call(u,"__wrapped__"))return p_(u)}return new Jr(u)}var Hs=function(){function u(){}return function(h){if(!mn(h))return{};if(lg)return lg(h);u.prototype=h;var g=new u;return u.prototype=t,g}}();function ru(){}function Jr(u,h){this.__wrapped__=u,this.__actions__=[],this.__chain__=!!h,this.__index__=0,this.__values__=t}k.templateSettings={escape:le,evaluate:Ot,interpolate:Se,variable:"",imports:{_:k}},k.prototype=ru.prototype,k.prototype.constructor=k,Jr.prototype=Hs(ru.prototype),Jr.prototype.constructor=Jr;function zt(u){this.__wrapped__=u,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=pe,this.__views__=[]}function Ob(){var u=new zt(this.__wrapped__);return u.__actions__=vr(this.__actions__),u.__dir__=this.__dir__,u.__filtered__=this.__filtered__,u.__iteratees__=vr(this.__iteratees__),u.__takeCount__=this.__takeCount__,u.__views__=vr(this.__views__),u}function Db(){if(this.__filtered__){var u=new zt(this);u.__dir__=-1,u.__filtered__=!0}else u=this.clone(),u.__dir__*=-1;return u}function Fb(){var u=this.__wrapped__.value(),h=this.__dir__,g=Tt(u),w=h<0,L=g?u.length:0,B=ZM(0,L,this.__views__),Z=B.start,Q=B.end,oe=Q-Z,Be=w?Q:Z-1,ze=this.__iteratees__,Ue=ze.length,st=0,ht=Jn(oe,this.__takeCount__);if(!g||!w&&L==oe&&ht==oe)return Fg(u,this.__actions__);var St=[];e:for(;oe--&&st<ht;){Be+=h;for(var Pt=-1,wt=u[Be];++Pt<Ue;){var Ft=ze[Pt],Vt=Ft.iteratee,Fr=Ft.type,lr=Vt(wt);if(Fr==N)wt=lr;else if(!lr){if(Fr==P)continue e;break e}}St[st++]=wt}return St}zt.prototype=Hs(ru.prototype),zt.prototype.constructor=zt;function is(u){var h=-1,g=u==null?0:u.length;for(this.clear();++h<g;){var w=u[h];this.set(w[0],w[1])}}function Bb(){this.__data__=fl?fl(null):{},this.size=0}function zb(u){var h=this.has(u)&&delete this.__data__[u];return this.size-=h?1:0,h}function Vb(u){var h=this.__data__;if(fl){var g=h[u];return g===l?t:g}return Jt.call(h,u)?h[u]:t}function Ub(u){var h=this.__data__;return fl?h[u]!==t:Jt.call(h,u)}function Gb(u,h){var g=this.__data__;return this.size+=this.has(u)?0:1,g[u]=fl&&h===t?l:h,this}is.prototype.clear=Bb,is.prototype.delete=zb,is.prototype.get=Vb,is.prototype.has=Ub,is.prototype.set=Gb;function Vi(u){var h=-1,g=u==null?0:u.length;for(this.clear();++h<g;){var w=u[h];this.set(w[0],w[1])}}function Hb(){this.__data__=[],this.size=0}function Wb(u){var h=this.__data__,g=iu(h,u);if(g<0)return!1;var w=h.length-1;return g==w?h.pop():Kc.call(h,g,1),--this.size,!0}function Xb(u){var h=this.__data__,g=iu(h,u);return g<0?t:h[g][1]}function Yb(u){return iu(this.__data__,u)>-1}function $b(u,h){var g=this.__data__,w=iu(g,u);return w<0?(++this.size,g.push([u,h])):g[w][1]=h,this}Vi.prototype.clear=Hb,Vi.prototype.delete=Wb,Vi.prototype.get=Xb,Vi.prototype.has=Yb,Vi.prototype.set=$b;function Ui(u){var h=-1,g=u==null?0:u.length;for(this.clear();++h<g;){var w=u[h];this.set(w[0],w[1])}}function qb(){this.size=0,this.__data__={hash:new is,map:new(cl||Vi),string:new is}}function Zb(u){var h=vu(this,u).delete(u);return this.size-=h?1:0,h}function jb(u){return vu(this,u).get(u)}function Kb(u){return vu(this,u).has(u)}function Jb(u,h){var g=vu(this,u),w=g.size;return g.set(u,h),this.size+=g.size==w?0:1,this}Ui.prototype.clear=qb,Ui.prototype.delete=Zb,Ui.prototype.get=jb,Ui.prototype.has=Kb,Ui.prototype.set=Jb;function as(u){var h=-1,g=u==null?0:u.length;for(this.__data__=new Ui;++h<g;)this.add(u[h])}function Qb(u){return this.__data__.set(u,l),this}function eM(u){return this.__data__.has(u)}as.prototype.add=as.prototype.push=Qb,as.prototype.has=eM;function fi(u){var h=this.__data__=new Vi(u);this.size=h.size}function tM(){this.__data__=new Vi,this.size=0}function nM(u){var h=this.__data__,g=h.delete(u);return this.size=h.size,g}function rM(u){return this.__data__.get(u)}function iM(u){return this.__data__.has(u)}function aM(u,h){var g=this.__data__;if(g instanceof Vi){var w=g.__data__;if(!cl||w.length<n-1)return w.push([u,h]),this.size=++g.size,this;g=this.__data__=new Ui(w)}return g.set(u,h),this.size=g.size,this}fi.prototype.clear=tM,fi.prototype.delete=nM,fi.prototype.get=rM,fi.prototype.has=iM,fi.prototype.set=aM;function pg(u,h){var g=Tt(u),w=!g&&us(u),L=!g&&!w&&xa(u),B=!g&&!w&&!L&&$s(u),Z=g||w||L||B,Q=Z?Ih(u.length,mb):[],oe=Q.length;for(var Be in u)(h||Jt.call(u,Be))&&!(Z&&(Be=="length"||L&&(Be=="offset"||Be=="parent")||B&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||Xi(Be,oe)))&&Q.push(Be);return Q}function mg(u){var h=u.length;return h?u[Zh(0,h-1)]:t}function sM(u,h){return gu(vr(u),ss(h,0,u.length))}function oM(u){return gu(vr(u))}function zh(u,h,g){(g!==t&&!hi(u[h],g)||g===t&&!(h in u))&&Gi(u,h,g)}function dl(u,h,g){var w=u[h];(!(Jt.call(u,h)&&hi(w,g))||g===t&&!(h in u))&&Gi(u,h,g)}function iu(u,h){for(var g=u.length;g--;)if(hi(u[g][0],h))return g;return-1}function lM(u,h,g,w){return va(u,function(L,B,Z){h(w,L,g(L),Z)}),w}function vg(u,h){return u&&Ai(h,Dn(h),u)}function cM(u,h){return u&&Ai(h,_r(h),u)}function Gi(u,h,g){h=="__proto__"&&Jc?Jc(u,h,{configurable:!0,enumerable:!0,value:g,writable:!0}):u[h]=g}function Vh(u,h){for(var g=-1,w=h.length,L=ye(w),B=u==null;++g<w;)L[g]=B?t:xd(u,h[g]);return L}function ss(u,h,g){return u===u&&(g!==t&&(u=u<=g?u:g),h!==t&&(u=u>=h?u:h)),u}function Qr(u,h,g,w,L,B){var Z,Q=h&d,oe=h&p,Be=h&m;if(g&&(Z=L?g(u,w,L,B):g(u)),Z!==t)return Z;if(!mn(u))return u;var ze=Tt(u);if(ze){if(Z=KM(u),!Q)return vr(u,Z)}else{var Ue=Qn(u),st=Ue==me||Ue==ge;if(xa(u))return Vg(u,Q);if(Ue==z||Ue==Oe||st&&!L){if(Z=oe||st?{}:a_(u),!Q)return oe?VM(u,cM(Z,u)):zM(u,vg(Z,u))}else{if(!an[Ue])return L?u:{};Z=JM(u,Ue,Q)}}B||(B=new fi);var ht=B.get(u);if(ht)return ht;B.set(u,Z),k_(u)?u.forEach(function(wt){Z.add(Qr(wt,h,g,wt,u,B))}):I_(u)&&u.forEach(function(wt,Ft){Z.set(Ft,Qr(wt,h,g,Ft,u,B))});var St=Be?oe?sd:ad:oe?_r:Dn,Pt=ze?t:St(u);return jr(Pt||u,function(wt,Ft){Pt&&(Ft=wt,wt=u[Ft]),dl(Z,Ft,Qr(wt,h,g,Ft,u,B))}),Z}function uM(u){var h=Dn(u);return function(g){return gg(g,u,h)}}function gg(u,h,g){var w=g.length;if(u==null)return!w;for(u=tn(u);w--;){var L=g[w],B=h[L],Z=u[L];if(Z===t&&!(L in u)||!B(Z))return!1}return!0}function _g(u,h,g){if(typeof u!="function")throw new Kr(s);return xl(function(){u.apply(t,g)},h)}function pl(u,h,g,w){var L=-1,B=Uc,Z=!0,Q=u.length,oe=[],Be=h.length;if(!Q)return oe;g&&(h=hn(h,kr(g))),w?(B=Ch,Z=!1):h.length>=n&&(B=ol,Z=!1,h=new as(h));e:for(;++L<Q;){var ze=u[L],Ue=g==null?ze:g(ze);if(ze=w||ze!==0?ze:0,Z&&Ue===Ue){for(var st=Be;st--;)if(h[st]===Ue)continue e;oe.push(ze)}else B(h,Ue,w)||oe.push(ze)}return oe}var va=Xg(Ci),yg=Xg(Gh,!0);function fM(u,h){var g=!0;return va(u,function(w,L,B){return g=!!h(w,L,B),g}),g}function au(u,h,g){for(var w=-1,L=u.length;++w<L;){var B=u[w],Z=h(B);if(Z!=null&&(Q===t?Z===Z&&!Dr(Z):g(Z,Q)))var Q=Z,oe=B}return oe}function hM(u,h,g,w){var L=u.length;for(g=Rt(g),g<0&&(g=-g>L?0:L+g),w=w===t||w>L?L:Rt(w),w<0&&(w+=L),w=g>w?0:D_(w);g<w;)u[g++]=h;return u}function xg(u,h){var g=[];return va(u,function(w,L,B){h(w,L,B)&&g.push(w)}),g}function Wn(u,h,g,w,L){var B=-1,Z=u.length;for(g||(g=e2),L||(L=[]);++B<Z;){var Q=u[B];h>0&&g(Q)?h>1?Wn(Q,h-1,g,w,L):da(L,Q):w||(L[L.length]=Q)}return L}var Uh=Yg(),Sg=Yg(!0);function Ci(u,h){return u&&Uh(u,h,Dn)}function Gh(u,h){return u&&Sg(u,h,Dn)}function su(u,h){return ha(h,function(g){return Yi(u[g])})}function os(u,h){h=_a(h,u);for(var g=0,w=h.length;u!=null&&g<w;)u=u[Ti(h[g++])];return g&&g==w?u:t}function wg(u,h,g){var w=h(u);return Tt(u)?w:da(w,g(u))}function sr(u){return u==null?u===t?Ke:Ee:rs&&rs in tn(u)?qM(u):o2(u)}function Hh(u,h){return u>h}function dM(u,h){return u!=null&&Jt.call(u,h)}function pM(u,h){return u!=null&&h in tn(u)}function mM(u,h,g){return u>=Jn(h,g)&&u<In(h,g)}function Wh(u,h,g){for(var w=g?Ch:Uc,L=u[0].length,B=u.length,Z=B,Q=ye(B),oe=1/0,Be=[];Z--;){var ze=u[Z];Z&&h&&(ze=hn(ze,kr(h))),oe=Jn(ze.length,oe),Q[Z]=!g&&(h||L>=120&&ze.length>=120)?new as(Z&&ze):t}ze=u[0];var Ue=-1,st=Q[0];e:for(;++Ue<L&&Be.length<oe;){var ht=ze[Ue],St=h?h(ht):ht;if(ht=g||ht!==0?ht:0,!(st?ol(st,St):w(Be,St,g))){for(Z=B;--Z;){var Pt=Q[Z];if(!(Pt?ol(Pt,St):w(u[Z],St,g)))continue e}st&&st.push(St),Be.push(ht)}}return Be}function vM(u,h,g,w){return Ci(u,function(L,B,Z){h(w,g(L),B,Z)}),w}function ml(u,h,g){h=_a(h,u),u=c_(u,h);var w=u==null?u:u[Ti(ti(h))];return w==null?t:Nr(w,u,g)}function bg(u){return xn(u)&&sr(u)==Oe}function gM(u){return xn(u)&&sr(u)==A}function _M(u){return xn(u)&&sr(u)==We}function vl(u,h,g,w,L){return u===h?!0:u==null||h==null||!xn(u)&&!xn(h)?u!==u&&h!==h:yM(u,h,g,w,vl,L)}function yM(u,h,g,w,L,B){var Z=Tt(u),Q=Tt(h),oe=Z?ne:Qn(u),Be=Q?ne:Qn(h);oe=oe==Oe?z:oe,Be=Be==Oe?z:Be;var ze=oe==z,Ue=Be==z,st=oe==Be;if(st&&xa(u)){if(!xa(h))return!1;Z=!0,ze=!1}if(st&&!ze)return B||(B=new fi),Z||$s(u)?n_(u,h,g,w,L,B):YM(u,h,oe,g,w,L,B);if(!(g&v)){var ht=ze&&Jt.call(u,"__wrapped__"),St=Ue&&Jt.call(h,"__wrapped__");if(ht||St){var Pt=ht?u.value():u,wt=St?h.value():h;return B||(B=new fi),L(Pt,wt,g,w,B)}}return st?(B||(B=new fi),$M(u,h,g,w,L,B)):!1}function xM(u){return xn(u)&&Qn(u)==se}function Xh(u,h,g,w){var L=g.length,B=L,Z=!w;if(u==null)return!B;for(u=tn(u);L--;){var Q=g[L];if(Z&&Q[2]?Q[1]!==u[Q[0]]:!(Q[0]in u))return!1}for(;++L<B;){Q=g[L];var oe=Q[0],Be=u[oe],ze=Q[1];if(Z&&Q[2]){if(Be===t&&!(oe in u))return!1}else{var Ue=new fi;if(w)var st=w(Be,ze,oe,u,h,Ue);if(!(st===t?vl(ze,Be,v|y,w,Ue):st))return!1}}return!0}function Mg(u){if(!mn(u)||n2(u))return!1;var h=Yi(u)?xb:ft;return h.test(cs(u))}function SM(u){return xn(u)&&sr(u)==be}function wM(u){return xn(u)&&Qn(u)==Fe}function bM(u){return xn(u)&&bu(u.length)&&!!cn[sr(u)]}function Eg(u){return typeof u=="function"?u:u==null?yr:typeof u=="object"?Tt(u)?Tg(u[0],u[1]):Ag(u):$_(u)}function Yh(u){if(!yl(u))return Cb(u);var h=[];for(var g in tn(u))Jt.call(u,g)&&g!="constructor"&&h.push(g);return h}function MM(u){if(!mn(u))return s2(u);var h=yl(u),g=[];for(var w in u)w=="constructor"&&(h||!Jt.call(u,w))||g.push(w);return g}function $h(u,h){return u<h}function Cg(u,h){var g=-1,w=gr(u)?ye(u.length):[];return va(u,function(L,B,Z){w[++g]=h(L,B,Z)}),w}function Ag(u){var h=ld(u);return h.length==1&&h[0][2]?o_(h[0][0],h[0][1]):function(g){return g===u||Xh(g,u,h)}}function Tg(u,h){return ud(u)&&s_(h)?o_(Ti(u),h):function(g){var w=xd(g,u);return w===t&&w===h?Sd(g,u):vl(h,w,v|y)}}function ou(u,h,g,w,L){u!==h&&Uh(h,function(B,Z){if(L||(L=new fi),mn(B))EM(u,h,Z,g,ou,w,L);else{var Q=w?w(hd(u,Z),B,Z+"",u,h,L):t;Q===t&&(Q=B),zh(u,Z,Q)}},_r)}function EM(u,h,g,w,L,B,Z){var Q=hd(u,g),oe=hd(h,g),Be=Z.get(oe);if(Be){zh(u,g,Be);return}var ze=B?B(Q,oe,g+"",u,h,Z):t,Ue=ze===t;if(Ue){var st=Tt(oe),ht=!st&&xa(oe),St=!st&&!ht&&$s(oe);ze=oe,st||ht||St?Tt(Q)?ze=Q:Sn(Q)?ze=vr(Q):ht?(Ue=!1,ze=Vg(oe,!0)):St?(Ue=!1,ze=Ug(oe,!0)):ze=[]:Sl(oe)||us(oe)?(ze=Q,us(Q)?ze=F_(Q):(!mn(Q)||Yi(Q))&&(ze=a_(oe))):Ue=!1}Ue&&(Z.set(oe,ze),L(ze,oe,w,B,Z),Z.delete(oe)),zh(u,g,ze)}function Rg(u,h){var g=u.length;if(g)return h+=h<0?g:0,Xi(h,g)?u[h]:t}function Lg(u,h,g){h.length?h=hn(h,function(B){return Tt(B)?function(Z){return os(Z,B.length===1?B[0]:B)}:B}):h=[yr];var w=-1;h=hn(h,kr(gt()));var L=Cg(u,function(B,Z,Q){var oe=hn(h,function(Be){return Be(B)});return{criteria:oe,index:++w,value:B}});return Jw(L,function(B,Z){return BM(B,Z,g)})}function CM(u,h){return Pg(u,h,function(g,w){return Sd(u,w)})}function Pg(u,h,g){for(var w=-1,L=h.length,B={};++w<L;){var Z=h[w],Q=os(u,Z);g(Q,Z)&&gl(B,_a(Z,u),Q)}return B}function AM(u){return function(h){return os(h,u)}}function qh(u,h,g,w){var L=w?Kw:Ds,B=-1,Z=h.length,Q=u;for(u===h&&(h=vr(h)),g&&(Q=hn(u,kr(g)));++B<Z;)for(var oe=0,Be=h[B],ze=g?g(Be):Be;(oe=L(Q,ze,oe,w))>-1;)Q!==u&&Kc.call(Q,oe,1),Kc.call(u,oe,1);return u}function Ig(u,h){for(var g=u?h.length:0,w=g-1;g--;){var L=h[g];if(g==w||L!==B){var B=L;Xi(L)?Kc.call(u,L,1):Jh(u,L)}}return u}function Zh(u,h){return u+eu(hg()*(h-u+1))}function TM(u,h,g,w){for(var L=-1,B=In(Qc((h-u)/(g||1)),0),Z=ye(B);B--;)Z[w?B:++L]=u,u+=g;return Z}function jh(u,h){var g="";if(!u||h<1||h>ee)return g;do h%2&&(g+=u),h=eu(h/2),h&&(u+=u);while(h);return g}function Nt(u,h){return dd(l_(u,h,yr),u+"")}function RM(u){return mg(qs(u))}function LM(u,h){var g=qs(u);return gu(g,ss(h,0,g.length))}function gl(u,h,g,w){if(!mn(u))return u;h=_a(h,u);for(var L=-1,B=h.length,Z=B-1,Q=u;Q!=null&&++L<B;){var oe=Ti(h[L]),Be=g;if(oe==="__proto__"||oe==="constructor"||oe==="prototype")return u;if(L!=Z){var ze=Q[oe];Be=w?w(ze,oe,Q):t,Be===t&&(Be=mn(ze)?ze:Xi(h[L+1])?[]:{})}dl(Q,oe,Be),Q=Q[oe]}return u}var Ng=tu?function(u,h){return tu.set(u,h),u}:yr,PM=Jc?function(u,h){return Jc(u,"toString",{configurable:!0,enumerable:!1,value:bd(h),writable:!0})}:yr;function IM(u){return gu(qs(u))}function ei(u,h,g){var w=-1,L=u.length;h<0&&(h=-h>L?0:L+h),g=g>L?L:g,g<0&&(g+=L),L=h>g?0:g-h>>>0,h>>>=0;for(var B=ye(L);++w<L;)B[w]=u[w+h];return B}function NM(u,h){var g;return va(u,function(w,L,B){return g=h(w,L,B),!g}),!!g}function lu(u,h,g){var w=0,L=u==null?w:u.length;if(typeof h=="number"&&h===h&&L<=De){for(;w<L;){var B=w+L>>>1,Z=u[B];Z!==null&&!Dr(Z)&&(g?Z<=h:Z<h)?w=B+1:L=B}return L}return Kh(u,h,yr,g)}function Kh(u,h,g,w){var L=0,B=u==null?0:u.length;if(B===0)return 0;h=g(h);for(var Z=h!==h,Q=h===null,oe=Dr(h),Be=h===t;L<B;){var ze=eu((L+B)/2),Ue=g(u[ze]),st=Ue!==t,ht=Ue===null,St=Ue===Ue,Pt=Dr(Ue);if(Z)var wt=w||St;else Be?wt=St&&(w||st):Q?wt=St&&st&&(w||!ht):oe?wt=St&&st&&!ht&&(w||!Pt):ht||Pt?wt=!1:wt=w?Ue<=h:Ue<h;wt?L=ze+1:B=ze}return Jn(B,Ie)}function kg(u,h){for(var g=-1,w=u.length,L=0,B=[];++g<w;){var Z=u[g],Q=h?h(Z):Z;if(!g||!hi(Q,oe)){var oe=Q;B[L++]=Z===0?0:Z}}return B}function Og(u){return typeof u=="number"?u:Dr(u)?he:+u}function Or(u){if(typeof u=="string")return u;if(Tt(u))return hn(u,Or)+"";if(Dr(u))return dg?dg.call(u):"";var h=u+"";return h=="0"&&1/u==-G?"-0":h}function ga(u,h,g){var w=-1,L=Uc,B=u.length,Z=!0,Q=[],oe=Q;if(g)Z=!1,L=Ch;else if(B>=n){var Be=h?null:WM(u);if(Be)return Hc(Be);Z=!1,L=ol,oe=new as}else oe=h?[]:Q;e:for(;++w<B;){var ze=u[w],Ue=h?h(ze):ze;if(ze=g||ze!==0?ze:0,Z&&Ue===Ue){for(var st=oe.length;st--;)if(oe[st]===Ue)continue e;h&&oe.push(Ue),Q.push(ze)}else L(oe,Ue,g)||(oe!==Q&&oe.push(Ue),Q.push(ze))}return Q}function Jh(u,h){return h=_a(h,u),u=c_(u,h),u==null||delete u[Ti(ti(h))]}function Dg(u,h,g,w){return gl(u,h,g(os(u,h)),w)}function cu(u,h,g,w){for(var L=u.length,B=w?L:-1;(w?B--:++B<L)&&h(u[B],B,u););return g?ei(u,w?0:B,w?B+1:L):ei(u,w?B+1:0,w?L:B)}function Fg(u,h){var g=u;return g instanceof zt&&(g=g.value()),Ah(h,function(w,L){return L.func.apply(L.thisArg,da([w],L.args))},g)}function Qh(u,h,g){var w=u.length;if(w<2)return w?ga(u[0]):[];for(var L=-1,B=ye(w);++L<w;)for(var Z=u[L],Q=-1;++Q<w;)Q!=L&&(B[L]=pl(B[L]||Z,u[Q],h,g));return ga(Wn(B,1),h,g)}function Bg(u,h,g){for(var w=-1,L=u.length,B=h.length,Z={};++w<L;){var Q=w<B?h[w]:t;g(Z,u[w],Q)}return Z}function ed(u){return Sn(u)?u:[]}function td(u){return typeof u=="function"?u:yr}function _a(u,h){return Tt(u)?u:ud(u,h)?[u]:d_(jt(u))}var kM=Nt;function ya(u,h,g){var w=u.length;return g=g===t?w:g,!h&&g>=w?u:ei(u,h,g)}var zg=Sb||function(u){return Hn.clearTimeout(u)};function Vg(u,h){if(h)return u.slice();var g=u.length,w=og?og(g):new u.constructor(g);return u.copy(w),w}function nd(u){var h=new u.constructor(u.byteLength);return new Zc(h).set(new Zc(u)),h}function OM(u,h){var g=h?nd(u.buffer):u.buffer;return new u.constructor(g,u.byteOffset,u.byteLength)}function DM(u){var h=new u.constructor(u.source,bt.exec(u));return h.lastIndex=u.lastIndex,h}function FM(u){return hl?tn(hl.call(u)):{}}function Ug(u,h){var g=h?nd(u.buffer):u.buffer;return new u.constructor(g,u.byteOffset,u.length)}function Gg(u,h){if(u!==h){var g=u!==t,w=u===null,L=u===u,B=Dr(u),Z=h!==t,Q=h===null,oe=h===h,Be=Dr(h);if(!Q&&!Be&&!B&&u>h||B&&Z&&oe&&!Q&&!Be||w&&Z&&oe||!g&&oe||!L)return 1;if(!w&&!B&&!Be&&u<h||Be&&g&&L&&!w&&!B||Q&&g&&L||!Z&&L||!oe)return-1}return 0}function BM(u,h,g){for(var w=-1,L=u.criteria,B=h.criteria,Z=L.length,Q=g.length;++w<Z;){var oe=Gg(L[w],B[w]);if(oe){if(w>=Q)return oe;var Be=g[w];return oe*(Be=="desc"?-1:1)}}return u.index-h.index}function Hg(u,h,g,w){for(var L=-1,B=u.length,Z=g.length,Q=-1,oe=h.length,Be=In(B-Z,0),ze=ye(oe+Be),Ue=!w;++Q<oe;)ze[Q]=h[Q];for(;++L<Z;)(Ue||L<B)&&(ze[g[L]]=u[L]);for(;Be--;)ze[Q++]=u[L++];return ze}function Wg(u,h,g,w){for(var L=-1,B=u.length,Z=-1,Q=g.length,oe=-1,Be=h.length,ze=In(B-Q,0),Ue=ye(ze+Be),st=!w;++L<ze;)Ue[L]=u[L];for(var ht=L;++oe<Be;)Ue[ht+oe]=h[oe];for(;++Z<Q;)(st||L<B)&&(Ue[ht+g[Z]]=u[L++]);return Ue}function vr(u,h){var g=-1,w=u.length;for(h||(h=ye(w));++g<w;)h[g]=u[g];return h}function Ai(u,h,g,w){var L=!g;g||(g={});for(var B=-1,Z=h.length;++B<Z;){var Q=h[B],oe=w?w(g[Q],u[Q],Q,g,u):t;oe===t&&(oe=u[Q]),L?Gi(g,Q,oe):dl(g,Q,oe)}return g}function zM(u,h){return Ai(u,cd(u),h)}function VM(u,h){return Ai(u,r_(u),h)}function uu(u,h){return function(g,w){var L=Tt(g)?Xw:lM,B=h?h():{};return L(g,u,gt(w,2),B)}}function Ws(u){return Nt(function(h,g){var w=-1,L=g.length,B=L>1?g[L-1]:t,Z=L>2?g[2]:t;for(B=u.length>3&&typeof B=="function"?(L--,B):t,Z&&or(g[0],g[1],Z)&&(B=L<3?t:B,L=1),h=tn(h);++w<L;){var Q=g[w];Q&&u(h,Q,w,B)}return h})}function Xg(u,h){return function(g,w){if(g==null)return g;if(!gr(g))return u(g,w);for(var L=g.length,B=h?L:-1,Z=tn(g);(h?B--:++B<L)&&w(Z[B],B,Z)!==!1;);return g}}function Yg(u){return function(h,g,w){for(var L=-1,B=tn(h),Z=w(h),Q=Z.length;Q--;){var oe=Z[u?Q:++L];if(g(B[oe],oe,B)===!1)break}return h}}function UM(u,h,g){var w=h&S,L=_l(u);function B(){var Z=this&&this!==Hn&&this instanceof B?L:u;return Z.apply(w?g:this,arguments)}return B}function $g(u){return function(h){h=jt(h);var g=Fs(h)?ui(h):t,w=g?g[0]:h.charAt(0),L=g?ya(g,1).join(""):h.slice(1);return w[u]()+L}}function Xs(u){return function(h){return Ah(X_(W_(h).replace(Pw,"")),u,"")}}function _l(u){return function(){var h=arguments;switch(h.length){case 0:return new u;case 1:return new u(h[0]);case 2:return new u(h[0],h[1]);case 3:return new u(h[0],h[1],h[2]);case 4:return new u(h[0],h[1],h[2],h[3]);case 5:return new u(h[0],h[1],h[2],h[3],h[4]);case 6:return new u(h[0],h[1],h[2],h[3],h[4],h[5]);case 7:return new u(h[0],h[1],h[2],h[3],h[4],h[5],h[6])}var g=Hs(u.prototype),w=u.apply(g,h);return mn(w)?w:g}}function GM(u,h,g){var w=_l(u);function L(){for(var B=arguments.length,Z=ye(B),Q=B,oe=Ys(L);Q--;)Z[Q]=arguments[Q];var Be=B<3&&Z[0]!==oe&&Z[B-1]!==oe?[]:pa(Z,oe);if(B-=Be.length,B<g)return Jg(u,h,fu,L.placeholder,t,Z,Be,t,t,g-B);var ze=this&&this!==Hn&&this instanceof L?w:u;return Nr(ze,this,Z)}return L}function qg(u){return function(h,g,w){var L=tn(h);if(!gr(h)){var B=gt(g,3);h=Dn(h),g=function(Q){return B(L[Q],Q,L)}}var Z=u(h,g,w);return Z>-1?L[B?h[Z]:Z]:t}}function Zg(u){return Wi(function(h){var g=h.length,w=g,L=Jr.prototype.thru;for(u&&h.reverse();w--;){var B=h[w];if(typeof B!="function")throw new Kr(s);if(L&&!Z&&mu(B)=="wrapper")var Z=new Jr([],!0)}for(w=Z?w:g;++w<g;){B=h[w];var Q=mu(B),oe=Q=="wrapper"?od(B):t;oe&&fd(oe[0])&&oe[1]==(R|b|E|V)&&!oe[4].length&&oe[9]==1?Z=Z[mu(oe[0])].apply(Z,oe[3]):Z=B.length==1&&fd(B)?Z[Q]():Z.thru(B)}return function(){var Be=arguments,ze=Be[0];if(Z&&Be.length==1&&Tt(ze))return Z.plant(ze).value();for(var Ue=0,st=g?h[Ue].apply(this,Be):ze;++Ue<g;)st=h[Ue].call(this,st);return st}})}function fu(u,h,g,w,L,B,Z,Q,oe,Be){var ze=h&R,Ue=h&S,st=h&_,ht=h&(b|M),St=h&Y,Pt=st?t:_l(u);function wt(){for(var Ft=arguments.length,Vt=ye(Ft),Fr=Ft;Fr--;)Vt[Fr]=arguments[Fr];if(ht)var lr=Ys(wt),Br=eb(Vt,lr);if(w&&(Vt=Hg(Vt,w,L,ht)),B&&(Vt=Wg(Vt,B,Z,ht)),Ft-=Br,ht&&Ft<Be){var wn=pa(Vt,lr);return Jg(u,h,fu,wt.placeholder,g,Vt,wn,Q,oe,Be-Ft)}var di=Ue?g:this,qi=st?di[u]:u;return Ft=Vt.length,Q?Vt=l2(Vt,Q):St&&Ft>1&&Vt.reverse(),ze&&oe<Ft&&(Vt.length=oe),this&&this!==Hn&&this instanceof wt&&(qi=Pt||_l(qi)),qi.apply(di,Vt)}return wt}function jg(u,h){return function(g,w){return vM(g,u,h(w),{})}}function hu(u,h){return function(g,w){var L;if(g===t&&w===t)return h;if(g!==t&&(L=g),w!==t){if(L===t)return w;typeof g=="string"||typeof w=="string"?(g=Or(g),w=Or(w)):(g=Og(g),w=Og(w)),L=u(g,w)}return L}}function rd(u){return Wi(function(h){return h=hn(h,kr(gt())),Nt(function(g){var w=this;return u(h,function(L){return Nr(L,w,g)})})})}function du(u,h){h=h===t?" ":Or(h);var g=h.length;if(g<2)return g?jh(h,u):h;var w=jh(h,Qc(u/Bs(h)));return Fs(h)?ya(ui(w),0,u).join(""):w.slice(0,u)}function HM(u,h,g,w){var L=h&S,B=_l(u);function Z(){for(var Q=-1,oe=arguments.length,Be=-1,ze=w.length,Ue=ye(ze+oe),st=this&&this!==Hn&&this instanceof Z?B:u;++Be<ze;)Ue[Be]=w[Be];for(;oe--;)Ue[Be++]=arguments[++Q];return Nr(st,L?g:this,Ue)}return Z}function Kg(u){return function(h,g,w){return w&&typeof w!="number"&&or(h,g,w)&&(g=w=t),h=$i(h),g===t?(g=h,h=0):g=$i(g),w=w===t?h<g?1:-1:$i(w),TM(h,g,w,u)}}function pu(u){return function(h,g){return typeof h=="string"&&typeof g=="string"||(h=ni(h),g=ni(g)),u(h,g)}}function Jg(u,h,g,w,L,B,Z,Q,oe,Be){var ze=h&b,Ue=ze?Z:t,st=ze?t:Z,ht=ze?B:t,St=ze?t:B;h|=ze?E:T,h&=~(ze?T:E),h&x||(h&=~(S|_));var Pt=[u,h,L,ht,Ue,St,st,Q,oe,Be],wt=g.apply(t,Pt);return fd(u)&&u_(wt,Pt),wt.placeholder=w,f_(wt,u,h)}function id(u){var h=Pn[u];return function(g,w){if(g=ni(g),w=w==null?0:Jn(Rt(w),292),w&&fg(g)){var L=(jt(g)+"e").split("e"),B=h(L[0]+"e"+(+L[1]+w));return L=(jt(B)+"e").split("e"),+(L[0]+"e"+(+L[1]-w))}return h(g)}}var WM=Us&&1/Hc(new Us([,-0]))[1]==G?function(u){return new Us(u)}:Cd;function Qg(u){return function(h){var g=Qn(h);return g==se?kh(h):g==Fe?ob(h):Qw(h,u(h))}}function Hi(u,h,g,w,L,B,Z,Q){var oe=h&_;if(!oe&&typeof u!="function")throw new Kr(s);var Be=w?w.length:0;if(Be||(h&=~(E|T),w=L=t),Z=Z===t?Z:In(Rt(Z),0),Q=Q===t?Q:Rt(Q),Be-=L?L.length:0,h&T){var ze=w,Ue=L;w=L=t}var st=oe?t:od(u),ht=[u,h,g,w,L,ze,Ue,B,Z,Q];if(st&&a2(ht,st),u=ht[0],h=ht[1],g=ht[2],w=ht[3],L=ht[4],Q=ht[9]=ht[9]===t?oe?0:u.length:In(ht[9]-Be,0),!Q&&h&(b|M)&&(h&=~(b|M)),!h||h==S)var St=UM(u,h,g);else h==b||h==M?St=GM(u,h,Q):(h==E||h==(S|E))&&!L.length?St=HM(u,h,g,w):St=fu.apply(t,ht);var Pt=st?Ng:u_;return f_(Pt(St,ht),u,h)}function e_(u,h,g,w){return u===t||hi(u,Vs[g])&&!Jt.call(w,g)?h:u}function t_(u,h,g,w,L,B){return mn(u)&&mn(h)&&(B.set(h,u),ou(u,h,t,t_,B),B.delete(h)),u}function XM(u){return Sl(u)?t:u}function n_(u,h,g,w,L,B){var Z=g&v,Q=u.length,oe=h.length;if(Q!=oe&&!(Z&&oe>Q))return!1;var Be=B.get(u),ze=B.get(h);if(Be&&ze)return Be==h&&ze==u;var Ue=-1,st=!0,ht=g&y?new as:t;for(B.set(u,h),B.set(h,u);++Ue<Q;){var St=u[Ue],Pt=h[Ue];if(w)var wt=Z?w(Pt,St,Ue,h,u,B):w(St,Pt,Ue,u,h,B);if(wt!==t){if(wt)continue;st=!1;break}if(ht){if(!Th(h,function(Ft,Vt){if(!ol(ht,Vt)&&(St===Ft||L(St,Ft,g,w,B)))return ht.push(Vt)})){st=!1;break}}else if(!(St===Pt||L(St,Pt,g,w,B))){st=!1;break}}return B.delete(u),B.delete(h),st}function YM(u,h,g,w,L,B,Z){switch(g){case D:if(u.byteLength!=h.byteLength||u.byteOffset!=h.byteOffset)return!1;u=u.buffer,h=h.buffer;case A:return!(u.byteLength!=h.byteLength||!B(new Zc(u),new Zc(h)));case Ge:case We:case we:return hi(+u,+h);case Te:return u.name==h.name&&u.message==h.message;case be:case He:return u==h+"";case se:var Q=kh;case Fe:var oe=w&v;if(Q||(Q=Hc),u.size!=h.size&&!oe)return!1;var Be=Z.get(u);if(Be)return Be==h;w|=y,Z.set(u,h);var ze=n_(Q(u),Q(h),w,L,B,Z);return Z.delete(u),ze;case rt:if(hl)return hl.call(u)==hl.call(h)}return!1}function $M(u,h,g,w,L,B){var Z=g&v,Q=ad(u),oe=Q.length,Be=ad(h),ze=Be.length;if(oe!=ze&&!Z)return!1;for(var Ue=oe;Ue--;){var st=Q[Ue];if(!(Z?st in h:Jt.call(h,st)))return!1}var ht=B.get(u),St=B.get(h);if(ht&&St)return ht==h&&St==u;var Pt=!0;B.set(u,h),B.set(h,u);for(var wt=Z;++Ue<oe;){st=Q[Ue];var Ft=u[st],Vt=h[st];if(w)var Fr=Z?w(Vt,Ft,st,h,u,B):w(Ft,Vt,st,u,h,B);if(!(Fr===t?Ft===Vt||L(Ft,Vt,g,w,B):Fr)){Pt=!1;break}wt||(wt=st=="constructor")}if(Pt&&!wt){var lr=u.constructor,Br=h.constructor;lr!=Br&&"constructor"in u&&"constructor"in h&&!(typeof lr=="function"&&lr instanceof lr&&typeof Br=="function"&&Br instanceof Br)&&(Pt=!1)}return B.delete(u),B.delete(h),Pt}function Wi(u){return dd(l_(u,t,g_),u+"")}function ad(u){return wg(u,Dn,cd)}function sd(u){return wg(u,_r,r_)}var od=tu?function(u){return tu.get(u)}:Cd;function mu(u){for(var h=u.name+"",g=Gs[h],w=Jt.call(Gs,h)?g.length:0;w--;){var L=g[w],B=L.func;if(B==null||B==u)return L.name}return h}function Ys(u){var h=Jt.call(k,"placeholder")?k:u;return h.placeholder}function gt(){var u=k.iteratee||Md;return u=u===Md?Eg:u,arguments.length?u(arguments[0],arguments[1]):u}function vu(u,h){var g=u.__data__;return t2(h)?g[typeof h=="string"?"string":"hash"]:g.map}function ld(u){for(var h=Dn(u),g=h.length;g--;){var w=h[g],L=u[w];h[g]=[w,L,s_(L)]}return h}function ls(u,h){var g=ib(u,h);return Mg(g)?g:t}function qM(u){var h=Jt.call(u,rs),g=u[rs];try{u[rs]=t;var w=!0}catch{}var L=$c.call(u);return w&&(h?u[rs]=g:delete u[rs]),L}var cd=Dh?function(u){return u==null?[]:(u=tn(u),ha(Dh(u),function(h){return cg.call(u,h)}))}:Ad,r_=Dh?function(u){for(var h=[];u;)da(h,cd(u)),u=jc(u);return h}:Ad,Qn=sr;(Fh&&Qn(new Fh(new ArrayBuffer(1)))!=D||cl&&Qn(new cl)!=se||Bh&&Qn(Bh.resolve())!=F||Us&&Qn(new Us)!=Fe||ul&&Qn(new ul)!=je)&&(Qn=function(u){var h=sr(u),g=h==z?u.constructor:t,w=g?cs(g):"";if(w)switch(w){case Lb:return D;case Pb:return se;case Ib:return F;case Nb:return Fe;case kb:return je}return h});function ZM(u,h,g){for(var w=-1,L=g.length;++w<L;){var B=g[w],Z=B.size;switch(B.type){case"drop":u+=Z;break;case"dropRight":h-=Z;break;case"take":h=Jn(h,u+Z);break;case"takeRight":u=In(u,h-Z);break}}return{start:u,end:h}}function jM(u){var h=u.match(_e);return h?h[1].split(Ye):[]}function i_(u,h,g){h=_a(h,u);for(var w=-1,L=h.length,B=!1;++w<L;){var Z=Ti(h[w]);if(!(B=u!=null&&g(u,Z)))break;u=u[Z]}return B||++w!=L?B:(L=u==null?0:u.length,!!L&&bu(L)&&Xi(Z,L)&&(Tt(u)||us(u)))}function KM(u){var h=u.length,g=new u.constructor(h);return h&&typeof u[0]=="string"&&Jt.call(u,"index")&&(g.index=u.index,g.input=u.input),g}function a_(u){return typeof u.constructor=="function"&&!yl(u)?Hs(jc(u)):{}}function JM(u,h,g){var w=u.constructor;switch(h){case A:return nd(u);case Ge:case We:return new w(+u);case D:return OM(u,g);case O:case te:case q:case Ae:case Re:case $e:case et:case Ze:case yt:return Ug(u,g);case se:return new w;case we:case He:return new w(u);case be:return DM(u);case Fe:return new w;case rt:return FM(u)}}function QM(u,h){var g=h.length;if(!g)return u;var w=g-1;return h[w]=(g>1?"& ":"")+h[w],h=h.join(g>2?", ":" "),u.replace(ce,`{
/* [wrapped with `+h+`] */
`)}function e2(u){return Tt(u)||us(u)||!!(ug&&u&&u[ug])}function Xi(u,h){var g=typeof u;return h=h??ee,!!h&&(g=="number"||g!="symbol"&&Ht.test(u))&&u>-1&&u%1==0&&u<h}function or(u,h,g){if(!mn(g))return!1;var w=typeof h;return(w=="number"?gr(g)&&Xi(h,g.length):w=="string"&&h in g)?hi(g[h],u):!1}function ud(u,h){if(Tt(u))return!1;var g=typeof u;return g=="number"||g=="symbol"||g=="boolean"||u==null||Dr(u)?!0:rn.test(u)||!Yt.test(u)||h!=null&&u in tn(h)}function t2(u){var h=typeof u;return h=="string"||h=="number"||h=="symbol"||h=="boolean"?u!=="__proto__":u===null}function fd(u){var h=mu(u),g=k[h];if(typeof g!="function"||!(h in zt.prototype))return!1;if(u===g)return!0;var w=od(g);return!!w&&u===w[0]}function n2(u){return!!sg&&sg in u}var r2=Xc?Yi:Td;function yl(u){var h=u&&u.constructor,g=typeof h=="function"&&h.prototype||Vs;return u===g}function s_(u){return u===u&&!mn(u)}function o_(u,h){return function(g){return g==null?!1:g[u]===h&&(h!==t||u in tn(g))}}function i2(u){var h=Su(u,function(w){return g.size===c&&g.clear(),w}),g=h.cache;return h}function a2(u,h){var g=u[1],w=h[1],L=g|w,B=L<(S|_|R),Z=w==R&&g==b||w==R&&g==V&&u[7].length<=h[8]||w==(R|V)&&h[7].length<=h[8]&&g==b;if(!(B||Z))return u;w&S&&(u[2]=h[2],L|=g&S?0:x);var Q=h[3];if(Q){var oe=u[3];u[3]=oe?Hg(oe,Q,h[4]):Q,u[4]=oe?pa(u[3],f):h[4]}return Q=h[5],Q&&(oe=u[5],u[5]=oe?Wg(oe,Q,h[6]):Q,u[6]=oe?pa(u[5],f):h[6]),Q=h[7],Q&&(u[7]=Q),w&R&&(u[8]=u[8]==null?h[8]:Jn(u[8],h[8])),u[9]==null&&(u[9]=h[9]),u[0]=h[0],u[1]=L,u}function s2(u){var h=[];if(u!=null)for(var g in tn(u))h.push(g);return h}function o2(u){return $c.call(u)}function l_(u,h,g){return h=In(h===t?u.length-1:h,0),function(){for(var w=arguments,L=-1,B=In(w.length-h,0),Z=ye(B);++L<B;)Z[L]=w[h+L];L=-1;for(var Q=ye(h+1);++L<h;)Q[L]=w[L];return Q[h]=g(Z),Nr(u,this,Q)}}function c_(u,h){return h.length<2?u:os(u,ei(h,0,-1))}function l2(u,h){for(var g=u.length,w=Jn(h.length,g),L=vr(u);w--;){var B=h[w];u[w]=Xi(B,g)?L[B]:t}return u}function hd(u,h){if(!(h==="constructor"&&typeof u[h]=="function")&&h!="__proto__")return u[h]}var u_=h_(Ng),xl=bb||function(u,h){return Hn.setTimeout(u,h)},dd=h_(PM);function f_(u,h,g){var w=h+"";return dd(u,QM(w,c2(jM(w),g)))}function h_(u){var h=0,g=0;return function(){var w=Ab(),L=X-(w-g);if(g=w,L>0){if(++h>=j)return arguments[0]}else h=0;return u.apply(t,arguments)}}function gu(u,h){var g=-1,w=u.length,L=w-1;for(h=h===t?w:h;++g<h;){var B=Zh(g,L),Z=u[B];u[B]=u[g],u[g]=Z}return u.length=h,u}var d_=i2(function(u){var h=[];return u.charCodeAt(0)===46&&h.push(""),u.replace(mr,function(g,w,L,B){h.push(L?B.replace(ot,"$1"):w||g)}),h});function Ti(u){if(typeof u=="string"||Dr(u))return u;var h=u+"";return h=="0"&&1/u==-G?"-0":h}function cs(u){if(u!=null){try{return Yc.call(u)}catch{}try{return u+""}catch{}}return""}function c2(u,h){return jr(Le,function(g){var w="_."+g[0];h&g[1]&&!Uc(u,w)&&u.push(w)}),u.sort()}function p_(u){if(u instanceof zt)return u.clone();var h=new Jr(u.__wrapped__,u.__chain__);return h.__actions__=vr(u.__actions__),h.__index__=u.__index__,h.__values__=u.__values__,h}function u2(u,h,g){(g?or(u,h,g):h===t)?h=1:h=In(Rt(h),0);var w=u==null?0:u.length;if(!w||h<1)return[];for(var L=0,B=0,Z=ye(Qc(w/h));L<w;)Z[B++]=ei(u,L,L+=h);return Z}function f2(u){for(var h=-1,g=u==null?0:u.length,w=0,L=[];++h<g;){var B=u[h];B&&(L[w++]=B)}return L}function h2(){var u=arguments.length;if(!u)return[];for(var h=ye(u-1),g=arguments[0],w=u;w--;)h[w-1]=arguments[w];return da(Tt(g)?vr(g):[g],Wn(h,1))}var d2=Nt(function(u,h){return Sn(u)?pl(u,Wn(h,1,Sn,!0)):[]}),p2=Nt(function(u,h){var g=ti(h);return Sn(g)&&(g=t),Sn(u)?pl(u,Wn(h,1,Sn,!0),gt(g,2)):[]}),m2=Nt(function(u,h){var g=ti(h);return Sn(g)&&(g=t),Sn(u)?pl(u,Wn(h,1,Sn,!0),t,g):[]});function v2(u,h,g){var w=u==null?0:u.length;return w?(h=g||h===t?1:Rt(h),ei(u,h<0?0:h,w)):[]}function g2(u,h,g){var w=u==null?0:u.length;return w?(h=g||h===t?1:Rt(h),h=w-h,ei(u,0,h<0?0:h)):[]}function _2(u,h){return u&&u.length?cu(u,gt(h,3),!0,!0):[]}function y2(u,h){return u&&u.length?cu(u,gt(h,3),!0):[]}function x2(u,h,g,w){var L=u==null?0:u.length;return L?(g&&typeof g!="number"&&or(u,h,g)&&(g=0,w=L),hM(u,h,g,w)):[]}function m_(u,h,g){var w=u==null?0:u.length;if(!w)return-1;var L=g==null?0:Rt(g);return L<0&&(L=In(w+L,0)),Gc(u,gt(h,3),L)}function v_(u,h,g){var w=u==null?0:u.length;if(!w)return-1;var L=w-1;return g!==t&&(L=Rt(g),L=g<0?In(w+L,0):Jn(L,w-1)),Gc(u,gt(h,3),L,!0)}function g_(u){var h=u==null?0:u.length;return h?Wn(u,1):[]}function S2(u){var h=u==null?0:u.length;return h?Wn(u,G):[]}function w2(u,h){var g=u==null?0:u.length;return g?(h=h===t?1:Rt(h),Wn(u,h)):[]}function b2(u){for(var h=-1,g=u==null?0:u.length,w={};++h<g;){var L=u[h];w[L[0]]=L[1]}return w}function __(u){return u&&u.length?u[0]:t}function M2(u,h,g){var w=u==null?0:u.length;if(!w)return-1;var L=g==null?0:Rt(g);return L<0&&(L=In(w+L,0)),Ds(u,h,L)}function E2(u){var h=u==null?0:u.length;return h?ei(u,0,-1):[]}var C2=Nt(function(u){var h=hn(u,ed);return h.length&&h[0]===u[0]?Wh(h):[]}),A2=Nt(function(u){var h=ti(u),g=hn(u,ed);return h===ti(g)?h=t:g.pop(),g.length&&g[0]===u[0]?Wh(g,gt(h,2)):[]}),T2=Nt(function(u){var h=ti(u),g=hn(u,ed);return h=typeof h=="function"?h:t,h&&g.pop(),g.length&&g[0]===u[0]?Wh(g,t,h):[]});function R2(u,h){return u==null?"":Eb.call(u,h)}function ti(u){var h=u==null?0:u.length;return h?u[h-1]:t}function L2(u,h,g){var w=u==null?0:u.length;if(!w)return-1;var L=w;return g!==t&&(L=Rt(g),L=L<0?In(w+L,0):Jn(L,w-1)),h===h?cb(u,h,L):Gc(u,Jv,L,!0)}function P2(u,h){return u&&u.length?Rg(u,Rt(h)):t}var I2=Nt(y_);function y_(u,h){return u&&u.length&&h&&h.length?qh(u,h):u}function N2(u,h,g){return u&&u.length&&h&&h.length?qh(u,h,gt(g,2)):u}function k2(u,h,g){return u&&u.length&&h&&h.length?qh(u,h,t,g):u}var O2=Wi(function(u,h){var g=u==null?0:u.length,w=Vh(u,h);return Ig(u,hn(h,function(L){return Xi(L,g)?+L:L}).sort(Gg)),w});function D2(u,h){var g=[];if(!(u&&u.length))return g;var w=-1,L=[],B=u.length;for(h=gt(h,3);++w<B;){var Z=u[w];h(Z,w,u)&&(g.push(Z),L.push(w))}return Ig(u,L),g}function pd(u){return u==null?u:Rb.call(u)}function F2(u,h,g){var w=u==null?0:u.length;return w?(g&&typeof g!="number"&&or(u,h,g)?(h=0,g=w):(h=h==null?0:Rt(h),g=g===t?w:Rt(g)),ei(u,h,g)):[]}function B2(u,h){return lu(u,h)}function z2(u,h,g){return Kh(u,h,gt(g,2))}function V2(u,h){var g=u==null?0:u.length;if(g){var w=lu(u,h);if(w<g&&hi(u[w],h))return w}return-1}function U2(u,h){return lu(u,h,!0)}function G2(u,h,g){return Kh(u,h,gt(g,2),!0)}function H2(u,h){var g=u==null?0:u.length;if(g){var w=lu(u,h,!0)-1;if(hi(u[w],h))return w}return-1}function W2(u){return u&&u.length?kg(u):[]}function X2(u,h){return u&&u.length?kg(u,gt(h,2)):[]}function Y2(u){var h=u==null?0:u.length;return h?ei(u,1,h):[]}function $2(u,h,g){return u&&u.length?(h=g||h===t?1:Rt(h),ei(u,0,h<0?0:h)):[]}function q2(u,h,g){var w=u==null?0:u.length;return w?(h=g||h===t?1:Rt(h),h=w-h,ei(u,h<0?0:h,w)):[]}function Z2(u,h){return u&&u.length?cu(u,gt(h,3),!1,!0):[]}function j2(u,h){return u&&u.length?cu(u,gt(h,3)):[]}var K2=Nt(function(u){return ga(Wn(u,1,Sn,!0))}),J2=Nt(function(u){var h=ti(u);return Sn(h)&&(h=t),ga(Wn(u,1,Sn,!0),gt(h,2))}),Q2=Nt(function(u){var h=ti(u);return h=typeof h=="function"?h:t,ga(Wn(u,1,Sn,!0),t,h)});function eE(u){return u&&u.length?ga(u):[]}function tE(u,h){return u&&u.length?ga(u,gt(h,2)):[]}function nE(u,h){return h=typeof h=="function"?h:t,u&&u.length?ga(u,t,h):[]}function md(u){if(!(u&&u.length))return[];var h=0;return u=ha(u,function(g){if(Sn(g))return h=In(g.length,h),!0}),Ih(h,function(g){return hn(u,Rh(g))})}function x_(u,h){if(!(u&&u.length))return[];var g=md(u);return h==null?g:hn(g,function(w){return Nr(h,t,w)})}var rE=Nt(function(u,h){return Sn(u)?pl(u,h):[]}),iE=Nt(function(u){return Qh(ha(u,Sn))}),aE=Nt(function(u){var h=ti(u);return Sn(h)&&(h=t),Qh(ha(u,Sn),gt(h,2))}),sE=Nt(function(u){var h=ti(u);return h=typeof h=="function"?h:t,Qh(ha(u,Sn),t,h)}),oE=Nt(md);function lE(u,h){return Bg(u||[],h||[],dl)}function cE(u,h){return Bg(u||[],h||[],gl)}var uE=Nt(function(u){var h=u.length,g=h>1?u[h-1]:t;return g=typeof g=="function"?(u.pop(),g):t,x_(u,g)});function S_(u){var h=k(u);return h.__chain__=!0,h}function fE(u,h){return h(u),u}function _u(u,h){return h(u)}var hE=Wi(function(u){var h=u.length,g=h?u[0]:0,w=this.__wrapped__,L=function(B){return Vh(B,u)};return h>1||this.__actions__.length||!(w instanceof zt)||!Xi(g)?this.thru(L):(w=w.slice(g,+g+(h?1:0)),w.__actions__.push({func:_u,args:[L],thisArg:t}),new Jr(w,this.__chain__).thru(function(B){return h&&!B.length&&B.push(t),B}))});function dE(){return S_(this)}function pE(){return new Jr(this.value(),this.__chain__)}function mE(){this.__values__===t&&(this.__values__=O_(this.value()));var u=this.__index__>=this.__values__.length,h=u?t:this.__values__[this.__index__++];return{done:u,value:h}}function vE(){return this}function gE(u){for(var h,g=this;g instanceof ru;){var w=p_(g);w.__index__=0,w.__values__=t,h?L.__wrapped__=w:h=w;var L=w;g=g.__wrapped__}return L.__wrapped__=u,h}function _E(){var u=this.__wrapped__;if(u instanceof zt){var h=u;return this.__actions__.length&&(h=new zt(this)),h=h.reverse(),h.__actions__.push({func:_u,args:[pd],thisArg:t}),new Jr(h,this.__chain__)}return this.thru(pd)}function yE(){return Fg(this.__wrapped__,this.__actions__)}var xE=uu(function(u,h,g){Jt.call(u,g)?++u[g]:Gi(u,g,1)});function SE(u,h,g){var w=Tt(u)?jv:fM;return g&&or(u,h,g)&&(h=t),w(u,gt(h,3))}function wE(u,h){var g=Tt(u)?ha:xg;return g(u,gt(h,3))}var bE=qg(m_),ME=qg(v_);function EE(u,h){return Wn(yu(u,h),1)}function CE(u,h){return Wn(yu(u,h),G)}function AE(u,h,g){return g=g===t?1:Rt(g),Wn(yu(u,h),g)}function w_(u,h){var g=Tt(u)?jr:va;return g(u,gt(h,3))}function b_(u,h){var g=Tt(u)?Yw:yg;return g(u,gt(h,3))}var TE=uu(function(u,h,g){Jt.call(u,g)?u[g].push(h):Gi(u,g,[h])});function RE(u,h,g,w){u=gr(u)?u:qs(u),g=g&&!w?Rt(g):0;var L=u.length;return g<0&&(g=In(L+g,0)),Mu(u)?g<=L&&u.indexOf(h,g)>-1:!!L&&Ds(u,h,g)>-1}var LE=Nt(function(u,h,g){var w=-1,L=typeof h=="function",B=gr(u)?ye(u.length):[];return va(u,function(Z){B[++w]=L?Nr(h,Z,g):ml(Z,h,g)}),B}),PE=uu(function(u,h,g){Gi(u,g,h)});function yu(u,h){var g=Tt(u)?hn:Cg;return g(u,gt(h,3))}function IE(u,h,g,w){return u==null?[]:(Tt(h)||(h=h==null?[]:[h]),g=w?t:g,Tt(g)||(g=g==null?[]:[g]),Lg(u,h,g))}var NE=uu(function(u,h,g){u[g?0:1].push(h)},function(){return[[],[]]});function kE(u,h,g){var w=Tt(u)?Ah:eg,L=arguments.length<3;return w(u,gt(h,4),g,L,va)}function OE(u,h,g){var w=Tt(u)?$w:eg,L=arguments.length<3;return w(u,gt(h,4),g,L,yg)}function DE(u,h){var g=Tt(u)?ha:xg;return g(u,wu(gt(h,3)))}function FE(u){var h=Tt(u)?mg:RM;return h(u)}function BE(u,h,g){(g?or(u,h,g):h===t)?h=1:h=Rt(h);var w=Tt(u)?sM:LM;return w(u,h)}function zE(u){var h=Tt(u)?oM:IM;return h(u)}function VE(u){if(u==null)return 0;if(gr(u))return Mu(u)?Bs(u):u.length;var h=Qn(u);return h==se||h==Fe?u.size:Yh(u).length}function UE(u,h,g){var w=Tt(u)?Th:NM;return g&&or(u,h,g)&&(h=t),w(u,gt(h,3))}var GE=Nt(function(u,h){if(u==null)return[];var g=h.length;return g>1&&or(u,h[0],h[1])?h=[]:g>2&&or(h[0],h[1],h[2])&&(h=[h[0]]),Lg(u,Wn(h,1),[])}),xu=wb||function(){return Hn.Date.now()};function HE(u,h){if(typeof h!="function")throw new Kr(s);return u=Rt(u),function(){if(--u<1)return h.apply(this,arguments)}}function M_(u,h,g){return h=g?t:h,h=u&&h==null?u.length:h,Hi(u,R,t,t,t,t,h)}function E_(u,h){var g;if(typeof h!="function")throw new Kr(s);return u=Rt(u),function(){return--u>0&&(g=h.apply(this,arguments)),u<=1&&(h=t),g}}var vd=Nt(function(u,h,g){var w=S;if(g.length){var L=pa(g,Ys(vd));w|=E}return Hi(u,w,h,g,L)}),C_=Nt(function(u,h,g){var w=S|_;if(g.length){var L=pa(g,Ys(C_));w|=E}return Hi(h,w,u,g,L)});function A_(u,h,g){h=g?t:h;var w=Hi(u,b,t,t,t,t,t,h);return w.placeholder=A_.placeholder,w}function T_(u,h,g){h=g?t:h;var w=Hi(u,M,t,t,t,t,t,h);return w.placeholder=T_.placeholder,w}function R_(u,h,g){var w,L,B,Z,Q,oe,Be=0,ze=!1,Ue=!1,st=!0;if(typeof u!="function")throw new Kr(s);h=ni(h)||0,mn(g)&&(ze=!!g.leading,Ue="maxWait"in g,B=Ue?In(ni(g.maxWait)||0,h):B,st="trailing"in g?!!g.trailing:st);function ht(wn){var di=w,qi=L;return w=L=t,Be=wn,Z=u.apply(qi,di),Z}function St(wn){return Be=wn,Q=xl(Ft,h),ze?ht(wn):Z}function Pt(wn){var di=wn-oe,qi=wn-Be,q_=h-di;return Ue?Jn(q_,B-qi):q_}function wt(wn){var di=wn-oe,qi=wn-Be;return oe===t||di>=h||di<0||Ue&&qi>=B}function Ft(){var wn=xu();if(wt(wn))return Vt(wn);Q=xl(Ft,Pt(wn))}function Vt(wn){return Q=t,st&&w?ht(wn):(w=L=t,Z)}function Fr(){Q!==t&&zg(Q),Be=0,w=oe=L=Q=t}function lr(){return Q===t?Z:Vt(xu())}function Br(){var wn=xu(),di=wt(wn);if(w=arguments,L=this,oe=wn,di){if(Q===t)return St(oe);if(Ue)return zg(Q),Q=xl(Ft,h),ht(oe)}return Q===t&&(Q=xl(Ft,h)),Z}return Br.cancel=Fr,Br.flush=lr,Br}var WE=Nt(function(u,h){return _g(u,1,h)}),XE=Nt(function(u,h,g){return _g(u,ni(h)||0,g)});function YE(u){return Hi(u,Y)}function Su(u,h){if(typeof u!="function"||h!=null&&typeof h!="function")throw new Kr(s);var g=function(){var w=arguments,L=h?h.apply(this,w):w[0],B=g.cache;if(B.has(L))return B.get(L);var Z=u.apply(this,w);return g.cache=B.set(L,Z)||B,Z};return g.cache=new(Su.Cache||Ui),g}Su.Cache=Ui;function wu(u){if(typeof u!="function")throw new Kr(s);return function(){var h=arguments;switch(h.length){case 0:return!u.call(this);case 1:return!u.call(this,h[0]);case 2:return!u.call(this,h[0],h[1]);case 3:return!u.call(this,h[0],h[1],h[2])}return!u.apply(this,h)}}function $E(u){return E_(2,u)}var qE=kM(function(u,h){h=h.length==1&&Tt(h[0])?hn(h[0],kr(gt())):hn(Wn(h,1),kr(gt()));var g=h.length;return Nt(function(w){for(var L=-1,B=Jn(w.length,g);++L<B;)w[L]=h[L].call(this,w[L]);return Nr(u,this,w)})}),gd=Nt(function(u,h){var g=pa(h,Ys(gd));return Hi(u,E,t,h,g)}),L_=Nt(function(u,h){var g=pa(h,Ys(L_));return Hi(u,T,t,h,g)}),ZE=Wi(function(u,h){return Hi(u,V,t,t,t,h)});function jE(u,h){if(typeof u!="function")throw new Kr(s);return h=h===t?h:Rt(h),Nt(u,h)}function KE(u,h){if(typeof u!="function")throw new Kr(s);return h=h==null?0:In(Rt(h),0),Nt(function(g){var w=g[h],L=ya(g,0,h);return w&&da(L,w),Nr(u,this,L)})}function JE(u,h,g){var w=!0,L=!0;if(typeof u!="function")throw new Kr(s);return mn(g)&&(w="leading"in g?!!g.leading:w,L="trailing"in g?!!g.trailing:L),R_(u,h,{leading:w,maxWait:h,trailing:L})}function QE(u){return M_(u,1)}function eC(u,h){return gd(td(h),u)}function tC(){if(!arguments.length)return[];var u=arguments[0];return Tt(u)?u:[u]}function nC(u){return Qr(u,m)}function rC(u,h){return h=typeof h=="function"?h:t,Qr(u,m,h)}function iC(u){return Qr(u,d|m)}function aC(u,h){return h=typeof h=="function"?h:t,Qr(u,d|m,h)}function sC(u,h){return h==null||gg(u,h,Dn(h))}function hi(u,h){return u===h||u!==u&&h!==h}var oC=pu(Hh),lC=pu(function(u,h){return u>=h}),us=bg(function(){return arguments}())?bg:function(u){return xn(u)&&Jt.call(u,"callee")&&!cg.call(u,"callee")},Tt=ye.isArray,cC=Wv?kr(Wv):gM;function gr(u){return u!=null&&bu(u.length)&&!Yi(u)}function Sn(u){return xn(u)&&gr(u)}function uC(u){return u===!0||u===!1||xn(u)&&sr(u)==Ge}var xa=Mb||Td,fC=Xv?kr(Xv):_M;function hC(u){return xn(u)&&u.nodeType===1&&!Sl(u)}function dC(u){if(u==null)return!0;if(gr(u)&&(Tt(u)||typeof u=="string"||typeof u.splice=="function"||xa(u)||$s(u)||us(u)))return!u.length;var h=Qn(u);if(h==se||h==Fe)return!u.size;if(yl(u))return!Yh(u).length;for(var g in u)if(Jt.call(u,g))return!1;return!0}function pC(u,h){return vl(u,h)}function mC(u,h,g){g=typeof g=="function"?g:t;var w=g?g(u,h):t;return w===t?vl(u,h,t,g):!!w}function _d(u){if(!xn(u))return!1;var h=sr(u);return h==Te||h==Ve||typeof u.message=="string"&&typeof u.name=="string"&&!Sl(u)}function vC(u){return typeof u=="number"&&fg(u)}function Yi(u){if(!mn(u))return!1;var h=sr(u);return h==me||h==ge||h==at||h==ue}function P_(u){return typeof u=="number"&&u==Rt(u)}function bu(u){return typeof u=="number"&&u>-1&&u%1==0&&u<=ee}function mn(u){var h=typeof u;return u!=null&&(h=="object"||h=="function")}function xn(u){return u!=null&&typeof u=="object"}var I_=Yv?kr(Yv):xM;function gC(u,h){return u===h||Xh(u,h,ld(h))}function _C(u,h,g){return g=typeof g=="function"?g:t,Xh(u,h,ld(h),g)}function yC(u){return N_(u)&&u!=+u}function xC(u){if(r2(u))throw new Ct(i);return Mg(u)}function SC(u){return u===null}function wC(u){return u==null}function N_(u){return typeof u=="number"||xn(u)&&sr(u)==we}function Sl(u){if(!xn(u)||sr(u)!=z)return!1;var h=jc(u);if(h===null)return!0;var g=Jt.call(h,"constructor")&&h.constructor;return typeof g=="function"&&g instanceof g&&Yc.call(g)==_b}var yd=$v?kr($v):SM;function bC(u){return P_(u)&&u>=-ee&&u<=ee}var k_=qv?kr(qv):wM;function Mu(u){return typeof u=="string"||!Tt(u)&&xn(u)&&sr(u)==He}function Dr(u){return typeof u=="symbol"||xn(u)&&sr(u)==rt}var $s=Zv?kr(Zv):bM;function MC(u){return u===t}function EC(u){return xn(u)&&Qn(u)==je}function CC(u){return xn(u)&&sr(u)==Je}var AC=pu($h),TC=pu(function(u,h){return u<=h});function O_(u){if(!u)return[];if(gr(u))return Mu(u)?ui(u):vr(u);if(ll&&u[ll])return sb(u[ll]());var h=Qn(u),g=h==se?kh:h==Fe?Hc:qs;return g(u)}function $i(u){if(!u)return u===0?u:0;if(u=ni(u),u===G||u===-G){var h=u<0?-1:1;return h*re}return u===u?u:0}function Rt(u){var h=$i(u),g=h%1;return h===h?g?h-g:h:0}function D_(u){return u?ss(Rt(u),0,pe):0}function ni(u){if(typeof u=="number")return u;if(Dr(u))return he;if(mn(u)){var h=typeof u.valueOf=="function"?u.valueOf():u;u=mn(h)?h+"":h}if(typeof u!="string")return u===0?u:+u;u=tg(u);var g=Et.test(u);return g||Un.test(u)?Hw(u.slice(2),g?2:8):vt.test(u)?he:+u}function F_(u){return Ai(u,_r(u))}function RC(u){return u?ss(Rt(u),-ee,ee):u===0?u:0}function jt(u){return u==null?"":Or(u)}var LC=Ws(function(u,h){if(yl(h)||gr(h)){Ai(h,Dn(h),u);return}for(var g in h)Jt.call(h,g)&&dl(u,g,h[g])}),B_=Ws(function(u,h){Ai(h,_r(h),u)}),Eu=Ws(function(u,h,g,w){Ai(h,_r(h),u,w)}),PC=Ws(function(u,h,g,w){Ai(h,Dn(h),u,w)}),IC=Wi(Vh);function NC(u,h){var g=Hs(u);return h==null?g:vg(g,h)}var kC=Nt(function(u,h){u=tn(u);var g=-1,w=h.length,L=w>2?h[2]:t;for(L&&or(h[0],h[1],L)&&(w=1);++g<w;)for(var B=h[g],Z=_r(B),Q=-1,oe=Z.length;++Q<oe;){var Be=Z[Q],ze=u[Be];(ze===t||hi(ze,Vs[Be])&&!Jt.call(u,Be))&&(u[Be]=B[Be])}return u}),OC=Nt(function(u){return u.push(t,t_),Nr(z_,t,u)});function DC(u,h){return Kv(u,gt(h,3),Ci)}function FC(u,h){return Kv(u,gt(h,3),Gh)}function BC(u,h){return u==null?u:Uh(u,gt(h,3),_r)}function zC(u,h){return u==null?u:Sg(u,gt(h,3),_r)}function VC(u,h){return u&&Ci(u,gt(h,3))}function UC(u,h){return u&&Gh(u,gt(h,3))}function GC(u){return u==null?[]:su(u,Dn(u))}function HC(u){return u==null?[]:su(u,_r(u))}function xd(u,h,g){var w=u==null?t:os(u,h);return w===t?g:w}function WC(u,h){return u!=null&&i_(u,h,dM)}function Sd(u,h){return u!=null&&i_(u,h,pM)}var XC=jg(function(u,h,g){h!=null&&typeof h.toString!="function"&&(h=$c.call(h)),u[h]=g},bd(yr)),YC=jg(function(u,h,g){h!=null&&typeof h.toString!="function"&&(h=$c.call(h)),Jt.call(u,h)?u[h].push(g):u[h]=[g]},gt),$C=Nt(ml);function Dn(u){return gr(u)?pg(u):Yh(u)}function _r(u){return gr(u)?pg(u,!0):MM(u)}function qC(u,h){var g={};return h=gt(h,3),Ci(u,function(w,L,B){Gi(g,h(w,L,B),w)}),g}function ZC(u,h){var g={};return h=gt(h,3),Ci(u,function(w,L,B){Gi(g,L,h(w,L,B))}),g}var jC=Ws(function(u,h,g){ou(u,h,g)}),z_=Ws(function(u,h,g,w){ou(u,h,g,w)}),KC=Wi(function(u,h){var g={};if(u==null)return g;var w=!1;h=hn(h,function(B){return B=_a(B,u),w||(w=B.length>1),B}),Ai(u,sd(u),g),w&&(g=Qr(g,d|p|m,XM));for(var L=h.length;L--;)Jh(g,h[L]);return g});function JC(u,h){return V_(u,wu(gt(h)))}var QC=Wi(function(u,h){return u==null?{}:CM(u,h)});function V_(u,h){if(u==null)return{};var g=hn(sd(u),function(w){return[w]});return h=gt(h),Pg(u,g,function(w,L){return h(w,L[0])})}function eA(u,h,g){h=_a(h,u);var w=-1,L=h.length;for(L||(L=1,u=t);++w<L;){var B=u==null?t:u[Ti(h[w])];B===t&&(w=L,B=g),u=Yi(B)?B.call(u):B}return u}function tA(u,h,g){return u==null?u:gl(u,h,g)}function nA(u,h,g,w){return w=typeof w=="function"?w:t,u==null?u:gl(u,h,g,w)}var U_=Qg(Dn),G_=Qg(_r);function rA(u,h,g){var w=Tt(u),L=w||xa(u)||$s(u);if(h=gt(h,4),g==null){var B=u&&u.constructor;L?g=w?new B:[]:mn(u)?g=Yi(B)?Hs(jc(u)):{}:g={}}return(L?jr:Ci)(u,function(Z,Q,oe){return h(g,Z,Q,oe)}),g}function iA(u,h){return u==null?!0:Jh(u,h)}function aA(u,h,g){return u==null?u:Dg(u,h,td(g))}function sA(u,h,g,w){return w=typeof w=="function"?w:t,u==null?u:Dg(u,h,td(g),w)}function qs(u){return u==null?[]:Nh(u,Dn(u))}function oA(u){return u==null?[]:Nh(u,_r(u))}function lA(u,h,g){return g===t&&(g=h,h=t),g!==t&&(g=ni(g),g=g===g?g:0),h!==t&&(h=ni(h),h=h===h?h:0),ss(ni(u),h,g)}function cA(u,h,g){return h=$i(h),g===t?(g=h,h=0):g=$i(g),u=ni(u),mM(u,h,g)}function uA(u,h,g){if(g&&typeof g!="boolean"&&or(u,h,g)&&(h=g=t),g===t&&(typeof h=="boolean"?(g=h,h=t):typeof u=="boolean"&&(g=u,u=t)),u===t&&h===t?(u=0,h=1):(u=$i(u),h===t?(h=u,u=0):h=$i(h)),u>h){var w=u;u=h,h=w}if(g||u%1||h%1){var L=hg();return Jn(u+L*(h-u+Gw("1e-"+((L+"").length-1))),h)}return Zh(u,h)}var fA=Xs(function(u,h,g){return h=h.toLowerCase(),u+(g?H_(h):h)});function H_(u){return wd(jt(u).toLowerCase())}function W_(u){return u=jt(u),u&&u.replace(Gn,tb).replace(Iw,"")}function hA(u,h,g){u=jt(u),h=Or(h);var w=u.length;g=g===t?w:ss(Rt(g),0,w);var L=g;return g-=h.length,g>=0&&u.slice(g,L)==h}function dA(u){return u=jt(u),u&&Mt.test(u)?u.replace(ct,nb):u}function pA(u){return u=jt(u),u&&Vn.test(u)?u.replace(Zn,"\\$&"):u}var mA=Xs(function(u,h,g){return u+(g?"-":"")+h.toLowerCase()}),vA=Xs(function(u,h,g){return u+(g?" ":"")+h.toLowerCase()}),gA=$g("toLowerCase");function _A(u,h,g){u=jt(u),h=Rt(h);var w=h?Bs(u):0;if(!h||w>=h)return u;var L=(h-w)/2;return du(eu(L),g)+u+du(Qc(L),g)}function yA(u,h,g){u=jt(u),h=Rt(h);var w=h?Bs(u):0;return h&&w<h?u+du(h-w,g):u}function xA(u,h,g){u=jt(u),h=Rt(h);var w=h?Bs(u):0;return h&&w<h?du(h-w,g)+u:u}function SA(u,h,g){return g||h==null?h=0:h&&(h=+h),Tb(jt(u).replace(U,""),h||0)}function wA(u,h,g){return(g?or(u,h,g):h===t)?h=1:h=Rt(h),jh(jt(u),h)}function bA(){var u=arguments,h=jt(u[0]);return u.length<3?h:h.replace(u[1],u[2])}var MA=Xs(function(u,h,g){return u+(g?"_":"")+h.toLowerCase()});function EA(u,h,g){return g&&typeof g!="number"&&or(u,h,g)&&(h=g=t),g=g===t?pe:g>>>0,g?(u=jt(u),u&&(typeof h=="string"||h!=null&&!yd(h))&&(h=Or(h),!h&&Fs(u))?ya(ui(u),0,g):u.split(h,g)):[]}var CA=Xs(function(u,h,g){return u+(g?" ":"")+wd(h)});function AA(u,h,g){return u=jt(u),g=g==null?0:ss(Rt(g),0,u.length),h=Or(h),u.slice(g,g+h.length)==h}function TA(u,h,g){var w=k.templateSettings;g&&or(u,h,g)&&(h=t),u=jt(u),h=Eu({},h,w,e_);var L=Eu({},h.imports,w.imports,e_),B=Dn(L),Z=Nh(L,B),Q,oe,Be=0,ze=h.interpolate||Kt,Ue="__p += '",st=Oh((h.escape||Kt).source+"|"+ze.source+"|"+(ze===Se?dt:Kt).source+"|"+(h.evaluate||Kt).source+"|$","g"),ht="//# sourceURL="+(Jt.call(h,"sourceURL")?(h.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Fw+"]")+`
`;u.replace(st,function(wt,Ft,Vt,Fr,lr,Br){return Vt||(Vt=Fr),Ue+=u.slice(Be,Br).replace(qr,rb),Ft&&(Q=!0,Ue+=`' +
__e(`+Ft+`) +
'`),lr&&(oe=!0,Ue+=`';
`+lr+`;
__p += '`),Vt&&(Ue+=`' +
((__t = (`+Vt+`)) == null ? '' : __t) +
'`),Be=Br+wt.length,wt}),Ue+=`';
`;var St=Jt.call(h,"variable")&&h.variable;if(!St)Ue=`with (obj) {
`+Ue+`
}
`;else if(ut.test(St))throw new Ct(o);Ue=(oe?Ue.replace(Xt,""):Ue).replace(en,"$1").replace(Lt,"$1;"),Ue="function("+(St||"obj")+`) {
`+(St?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Q?", __e = _.escape":"")+(oe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Ue+`return __p
}`;var Pt=Y_(function(){return $t(B,ht+"return "+Ue).apply(t,Z)});if(Pt.source=Ue,_d(Pt))throw Pt;return Pt}function RA(u){return jt(u).toLowerCase()}function LA(u){return jt(u).toUpperCase()}function PA(u,h,g){if(u=jt(u),u&&(g||h===t))return tg(u);if(!u||!(h=Or(h)))return u;var w=ui(u),L=ui(h),B=ng(w,L),Z=rg(w,L)+1;return ya(w,B,Z).join("")}function IA(u,h,g){if(u=jt(u),u&&(g||h===t))return u.slice(0,ag(u)+1);if(!u||!(h=Or(h)))return u;var w=ui(u),L=rg(w,ui(h))+1;return ya(w,0,L).join("")}function NA(u,h,g){if(u=jt(u),u&&(g||h===t))return u.replace(U,"");if(!u||!(h=Or(h)))return u;var w=ui(u),L=ng(w,ui(h));return ya(w,L).join("")}function kA(u,h){var g=$,w=W;if(mn(h)){var L="separator"in h?h.separator:L;g="length"in h?Rt(h.length):g,w="omission"in h?Or(h.omission):w}u=jt(u);var B=u.length;if(Fs(u)){var Z=ui(u);B=Z.length}if(g>=B)return u;var Q=g-Bs(w);if(Q<1)return w;var oe=Z?ya(Z,0,Q).join(""):u.slice(0,Q);if(L===t)return oe+w;if(Z&&(Q+=oe.length-Q),yd(L)){if(u.slice(Q).search(L)){var Be,ze=oe;for(L.global||(L=Oh(L.source,jt(bt.exec(L))+"g")),L.lastIndex=0;Be=L.exec(ze);)var Ue=Be.index;oe=oe.slice(0,Ue===t?Q:Ue)}}else if(u.indexOf(Or(L),Q)!=Q){var st=oe.lastIndexOf(L);st>-1&&(oe=oe.slice(0,st))}return oe+w}function OA(u){return u=jt(u),u&&ie.test(u)?u.replace(Qe,ub):u}var DA=Xs(function(u,h,g){return u+(g?" ":"")+h.toUpperCase()}),wd=$g("toUpperCase");function X_(u,h,g){return u=jt(u),h=g?t:h,h===t?ab(u)?db(u):jw(u):u.match(h)||[]}var Y_=Nt(function(u,h){try{return Nr(u,t,h)}catch(g){return _d(g)?g:new Ct(g)}}),FA=Wi(function(u,h){return jr(h,function(g){g=Ti(g),Gi(u,g,vd(u[g],u))}),u});function BA(u){var h=u==null?0:u.length,g=gt();return u=h?hn(u,function(w){if(typeof w[1]!="function")throw new Kr(s);return[g(w[0]),w[1]]}):[],Nt(function(w){for(var L=-1;++L<h;){var B=u[L];if(Nr(B[0],this,w))return Nr(B[1],this,w)}})}function zA(u){return uM(Qr(u,d))}function bd(u){return function(){return u}}function VA(u,h){return u==null||u!==u?h:u}var UA=Zg(),GA=Zg(!0);function yr(u){return u}function Md(u){return Eg(typeof u=="function"?u:Qr(u,d))}function HA(u){return Ag(Qr(u,d))}function WA(u,h){return Tg(u,Qr(h,d))}var XA=Nt(function(u,h){return function(g){return ml(g,u,h)}}),YA=Nt(function(u,h){return function(g){return ml(u,g,h)}});function Ed(u,h,g){var w=Dn(h),L=su(h,w);g==null&&!(mn(h)&&(L.length||!w.length))&&(g=h,h=u,u=this,L=su(h,Dn(h)));var B=!(mn(g)&&"chain"in g)||!!g.chain,Z=Yi(u);return jr(L,function(Q){var oe=h[Q];u[Q]=oe,Z&&(u.prototype[Q]=function(){var Be=this.__chain__;if(B||Be){var ze=u(this.__wrapped__),Ue=ze.__actions__=vr(this.__actions__);return Ue.push({func:oe,args:arguments,thisArg:u}),ze.__chain__=Be,ze}return oe.apply(u,da([this.value()],arguments))})}),u}function $A(){return Hn._===this&&(Hn._=yb),this}function Cd(){}function qA(u){return u=Rt(u),Nt(function(h){return Rg(h,u)})}var ZA=rd(hn),jA=rd(jv),KA=rd(Th);function $_(u){return ud(u)?Rh(Ti(u)):AM(u)}function JA(u){return function(h){return u==null?t:os(u,h)}}var QA=Kg(),eT=Kg(!0);function Ad(){return[]}function Td(){return!1}function tT(){return{}}function nT(){return""}function rT(){return!0}function iT(u,h){if(u=Rt(u),u<1||u>ee)return[];var g=pe,w=Jn(u,pe);h=gt(h),u-=pe;for(var L=Ih(w,h);++g<u;)h(g);return L}function aT(u){return Tt(u)?hn(u,Ti):Dr(u)?[u]:vr(d_(jt(u)))}function sT(u){var h=++gb;return jt(u)+h}var oT=hu(function(u,h){return u+h},0),lT=id("ceil"),cT=hu(function(u,h){return u/h},1),uT=id("floor");function fT(u){return u&&u.length?au(u,yr,Hh):t}function hT(u,h){return u&&u.length?au(u,gt(h,2),Hh):t}function dT(u){return Qv(u,yr)}function pT(u,h){return Qv(u,gt(h,2))}function mT(u){return u&&u.length?au(u,yr,$h):t}function vT(u,h){return u&&u.length?au(u,gt(h,2),$h):t}var gT=hu(function(u,h){return u*h},1),_T=id("round"),yT=hu(function(u,h){return u-h},0);function xT(u){return u&&u.length?Ph(u,yr):0}function ST(u,h){return u&&u.length?Ph(u,gt(h,2)):0}return k.after=HE,k.ary=M_,k.assign=LC,k.assignIn=B_,k.assignInWith=Eu,k.assignWith=PC,k.at=IC,k.before=E_,k.bind=vd,k.bindAll=FA,k.bindKey=C_,k.castArray=tC,k.chain=S_,k.chunk=u2,k.compact=f2,k.concat=h2,k.cond=BA,k.conforms=zA,k.constant=bd,k.countBy=xE,k.create=NC,k.curry=A_,k.curryRight=T_,k.debounce=R_,k.defaults=kC,k.defaultsDeep=OC,k.defer=WE,k.delay=XE,k.difference=d2,k.differenceBy=p2,k.differenceWith=m2,k.drop=v2,k.dropRight=g2,k.dropRightWhile=_2,k.dropWhile=y2,k.fill=x2,k.filter=wE,k.flatMap=EE,k.flatMapDeep=CE,k.flatMapDepth=AE,k.flatten=g_,k.flattenDeep=S2,k.flattenDepth=w2,k.flip=YE,k.flow=UA,k.flowRight=GA,k.fromPairs=b2,k.functions=GC,k.functionsIn=HC,k.groupBy=TE,k.initial=E2,k.intersection=C2,k.intersectionBy=A2,k.intersectionWith=T2,k.invert=XC,k.invertBy=YC,k.invokeMap=LE,k.iteratee=Md,k.keyBy=PE,k.keys=Dn,k.keysIn=_r,k.map=yu,k.mapKeys=qC,k.mapValues=ZC,k.matches=HA,k.matchesProperty=WA,k.memoize=Su,k.merge=jC,k.mergeWith=z_,k.method=XA,k.methodOf=YA,k.mixin=Ed,k.negate=wu,k.nthArg=qA,k.omit=KC,k.omitBy=JC,k.once=$E,k.orderBy=IE,k.over=ZA,k.overArgs=qE,k.overEvery=jA,k.overSome=KA,k.partial=gd,k.partialRight=L_,k.partition=NE,k.pick=QC,k.pickBy=V_,k.property=$_,k.propertyOf=JA,k.pull=I2,k.pullAll=y_,k.pullAllBy=N2,k.pullAllWith=k2,k.pullAt=O2,k.range=QA,k.rangeRight=eT,k.rearg=ZE,k.reject=DE,k.remove=D2,k.rest=jE,k.reverse=pd,k.sampleSize=BE,k.set=tA,k.setWith=nA,k.shuffle=zE,k.slice=F2,k.sortBy=GE,k.sortedUniq=W2,k.sortedUniqBy=X2,k.split=EA,k.spread=KE,k.tail=Y2,k.take=$2,k.takeRight=q2,k.takeRightWhile=Z2,k.takeWhile=j2,k.tap=fE,k.throttle=JE,k.thru=_u,k.toArray=O_,k.toPairs=U_,k.toPairsIn=G_,k.toPath=aT,k.toPlainObject=F_,k.transform=rA,k.unary=QE,k.union=K2,k.unionBy=J2,k.unionWith=Q2,k.uniq=eE,k.uniqBy=tE,k.uniqWith=nE,k.unset=iA,k.unzip=md,k.unzipWith=x_,k.update=aA,k.updateWith=sA,k.values=qs,k.valuesIn=oA,k.without=rE,k.words=X_,k.wrap=eC,k.xor=iE,k.xorBy=aE,k.xorWith=sE,k.zip=oE,k.zipObject=lE,k.zipObjectDeep=cE,k.zipWith=uE,k.entries=U_,k.entriesIn=G_,k.extend=B_,k.extendWith=Eu,Ed(k,k),k.add=oT,k.attempt=Y_,k.camelCase=fA,k.capitalize=H_,k.ceil=lT,k.clamp=lA,k.clone=nC,k.cloneDeep=iC,k.cloneDeepWith=aC,k.cloneWith=rC,k.conformsTo=sC,k.deburr=W_,k.defaultTo=VA,k.divide=cT,k.endsWith=hA,k.eq=hi,k.escape=dA,k.escapeRegExp=pA,k.every=SE,k.find=bE,k.findIndex=m_,k.findKey=DC,k.findLast=ME,k.findLastIndex=v_,k.findLastKey=FC,k.floor=uT,k.forEach=w_,k.forEachRight=b_,k.forIn=BC,k.forInRight=zC,k.forOwn=VC,k.forOwnRight=UC,k.get=xd,k.gt=oC,k.gte=lC,k.has=WC,k.hasIn=Sd,k.head=__,k.identity=yr,k.includes=RE,k.indexOf=M2,k.inRange=cA,k.invoke=$C,k.isArguments=us,k.isArray=Tt,k.isArrayBuffer=cC,k.isArrayLike=gr,k.isArrayLikeObject=Sn,k.isBoolean=uC,k.isBuffer=xa,k.isDate=fC,k.isElement=hC,k.isEmpty=dC,k.isEqual=pC,k.isEqualWith=mC,k.isError=_d,k.isFinite=vC,k.isFunction=Yi,k.isInteger=P_,k.isLength=bu,k.isMap=I_,k.isMatch=gC,k.isMatchWith=_C,k.isNaN=yC,k.isNative=xC,k.isNil=wC,k.isNull=SC,k.isNumber=N_,k.isObject=mn,k.isObjectLike=xn,k.isPlainObject=Sl,k.isRegExp=yd,k.isSafeInteger=bC,k.isSet=k_,k.isString=Mu,k.isSymbol=Dr,k.isTypedArray=$s,k.isUndefined=MC,k.isWeakMap=EC,k.isWeakSet=CC,k.join=R2,k.kebabCase=mA,k.last=ti,k.lastIndexOf=L2,k.lowerCase=vA,k.lowerFirst=gA,k.lt=AC,k.lte=TC,k.max=fT,k.maxBy=hT,k.mean=dT,k.meanBy=pT,k.min=mT,k.minBy=vT,k.stubArray=Ad,k.stubFalse=Td,k.stubObject=tT,k.stubString=nT,k.stubTrue=rT,k.multiply=gT,k.nth=P2,k.noConflict=$A,k.noop=Cd,k.now=xu,k.pad=_A,k.padEnd=yA,k.padStart=xA,k.parseInt=SA,k.random=uA,k.reduce=kE,k.reduceRight=OE,k.repeat=wA,k.replace=bA,k.result=eA,k.round=_T,k.runInContext=ae,k.sample=FE,k.size=VE,k.snakeCase=MA,k.some=UE,k.sortedIndex=B2,k.sortedIndexBy=z2,k.sortedIndexOf=V2,k.sortedLastIndex=U2,k.sortedLastIndexBy=G2,k.sortedLastIndexOf=H2,k.startCase=CA,k.startsWith=AA,k.subtract=yT,k.sum=xT,k.sumBy=ST,k.template=TA,k.times=iT,k.toFinite=$i,k.toInteger=Rt,k.toLength=D_,k.toLower=RA,k.toNumber=ni,k.toSafeInteger=RC,k.toString=jt,k.toUpper=LA,k.trim=PA,k.trimEnd=IA,k.trimStart=NA,k.truncate=kA,k.unescape=OA,k.uniqueId=sT,k.upperCase=DA,k.upperFirst=wd,k.each=w_,k.eachRight=b_,k.first=__,Ed(k,function(){var u={};return Ci(k,function(h,g){Jt.call(k.prototype,g)||(u[g]=h)}),u}(),{chain:!1}),k.VERSION=r,jr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(u){k[u].placeholder=k}),jr(["drop","take"],function(u,h){zt.prototype[u]=function(g){g=g===t?1:In(Rt(g),0);var w=this.__filtered__&&!h?new zt(this):this.clone();return w.__filtered__?w.__takeCount__=Jn(g,w.__takeCount__):w.__views__.push({size:Jn(g,pe),type:u+(w.__dir__<0?"Right":"")}),w},zt.prototype[u+"Right"]=function(g){return this.reverse()[u](g).reverse()}}),jr(["filter","map","takeWhile"],function(u,h){var g=h+1,w=g==P||g==I;zt.prototype[u]=function(L){var B=this.clone();return B.__iteratees__.push({iteratee:gt(L,3),type:g}),B.__filtered__=B.__filtered__||w,B}}),jr(["head","last"],function(u,h){var g="take"+(h?"Right":"");zt.prototype[u]=function(){return this[g](1).value()[0]}}),jr(["initial","tail"],function(u,h){var g="drop"+(h?"":"Right");zt.prototype[u]=function(){return this.__filtered__?new zt(this):this[g](1)}}),zt.prototype.compact=function(){return this.filter(yr)},zt.prototype.find=function(u){return this.filter(u).head()},zt.prototype.findLast=function(u){return this.reverse().find(u)},zt.prototype.invokeMap=Nt(function(u,h){return typeof u=="function"?new zt(this):this.map(function(g){return ml(g,u,h)})}),zt.prototype.reject=function(u){return this.filter(wu(gt(u)))},zt.prototype.slice=function(u,h){u=Rt(u);var g=this;return g.__filtered__&&(u>0||h<0)?new zt(g):(u<0?g=g.takeRight(-u):u&&(g=g.drop(u)),h!==t&&(h=Rt(h),g=h<0?g.dropRight(-h):g.take(h-u)),g)},zt.prototype.takeRightWhile=function(u){return this.reverse().takeWhile(u).reverse()},zt.prototype.toArray=function(){return this.take(pe)},Ci(zt.prototype,function(u,h){var g=/^(?:filter|find|map|reject)|While$/.test(h),w=/^(?:head|last)$/.test(h),L=k[w?"take"+(h=="last"?"Right":""):h],B=w||/^find/.test(h);L&&(k.prototype[h]=function(){var Z=this.__wrapped__,Q=w?[1]:arguments,oe=Z instanceof zt,Be=Q[0],ze=oe||Tt(Z),Ue=function(Ft){var Vt=L.apply(k,da([Ft],Q));return w&&st?Vt[0]:Vt};ze&&g&&typeof Be=="function"&&Be.length!=1&&(oe=ze=!1);var st=this.__chain__,ht=!!this.__actions__.length,St=B&&!st,Pt=oe&&!ht;if(!B&&ze){Z=Pt?Z:new zt(this);var wt=u.apply(Z,Q);return wt.__actions__.push({func:_u,args:[Ue],thisArg:t}),new Jr(wt,st)}return St&&Pt?u.apply(this,Q):(wt=this.thru(Ue),St?w?wt.value()[0]:wt.value():wt)})}),jr(["pop","push","shift","sort","splice","unshift"],function(u){var h=Wc[u],g=/^(?:push|sort|unshift)$/.test(u)?"tap":"thru",w=/^(?:pop|shift)$/.test(u);k.prototype[u]=function(){var L=arguments;if(w&&!this.__chain__){var B=this.value();return h.apply(Tt(B)?B:[],L)}return this[g](function(Z){return h.apply(Tt(Z)?Z:[],L)})}}),Ci(zt.prototype,function(u,h){var g=k[h];if(g){var w=g.name+"";Jt.call(Gs,w)||(Gs[w]=[]),Gs[w].push({name:h,func:g})}}),Gs[fu(t,_).name]=[{name:"wrapper",func:t}],zt.prototype.clone=Ob,zt.prototype.reverse=Db,zt.prototype.value=Fb,k.prototype.at=hE,k.prototype.chain=dE,k.prototype.commit=pE,k.prototype.next=mE,k.prototype.plant=gE,k.prototype.reverse=_E,k.prototype.toJSON=k.prototype.valueOf=k.prototype.value=yE,k.prototype.first=k.prototype.head,ll&&(k.prototype[ll]=vE),k},zs=pb();ns?((ns.exports=zs)._=zs,Mh._=zs):Hn._=zs}).call(wl)})(Nf,Nf.exports);var xe=Nf.exports;/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const H1="131",kT=0,e0=1,OT=2,gm=1,DT=2,Yl=3,Ss=0,Tn=1,ws=2,W1=1,sa=0,ql=1,t0=2,n0=3,r0=4,FT=5,Ro=100,BT=101,zT=102,i0=103,a0=104,VT=200,UT=201,GT=202,HT=203,X1=204,Y1=205,WT=206,XT=207,YT=208,$T=209,qT=210,ZT=0,jT=1,KT=2,kf=3,JT=4,QT=5,eR=6,tR=7,Yf=0,nR=1,rR=2,xs=0,iR=1,aR=2,sR=3,oR=4,lR=5,$f=300,qf=301,Zf=302,Xp=303,Yp=304,jf=306,_m=307,ec=1e3,ur=1001,$p=1002,_n=1003,s0=1004,o0=1005,qt=1006,cR=1007,Kf=1008,Ya=1009,uR=1010,fR=1011,tc=1012,hR=1013,Tf=1014,Ni=1015,ko=1016,dR=1017,pR=1018,mR=1019,Zl=1020,vR=1021,za=1022,Mn=1023,$1=1024,gR=1025,_R=Mn,Oo=1026,nc=1027,yR=1028,xR=1029,SR=1030,wR=1031,bR=1032,MR=1033,l0=33776,c0=33777,u0=33778,f0=33779,h0=35840,d0=35841,p0=35842,m0=35843,ER=36196,v0=37492,g0=37496,CR=37808,AR=37809,TR=37810,RR=37811,LR=37812,PR=37813,IR=37814,NR=37815,kR=37816,OR=37817,DR=37818,FR=37819,BR=37820,zR=37821,VR=36492,UR=37840,GR=37841,HR=37842,WR=37843,XR=37844,YR=37845,$R=37846,qR=37847,ZR=37848,jR=37849,KR=37850,JR=37851,QR=37852,e3=37853,t3=2200,n3=2201,r3=2202,Of=2300,Df=2301,Ld=2302,Po=2400,Io=2401,Ff=2402,ym=2500,q1=2501,i3=0,Ar=3e3,Jf=3001,xm=3007,Sm=3002,a3=3003,Z1=3004,j1=3005,K1=3006,s3=3200,o3=3201,Wo=0,l3=1,Pd=7680,c3=519,rc=35044,Bf=35048,_0="300 es";let Cs=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const n=r.slice(0);for(let i=0,s=n.length;i<s;i++)n[i].call(this,e);e.target=null}}};const Xn=[];for(let a=0;a<256;a++)Xn[a]=(a<16?"0":"")+a.toString(16);let Cu=1234567;const Do=Math.PI/180,ic=180/Math.PI;function xi(){const a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Xn[a&255]+Xn[a>>8&255]+Xn[a>>16&255]+Xn[a>>24&255]+"-"+Xn[e&255]+Xn[e>>8&255]+"-"+Xn[e>>16&15|64]+Xn[e>>24&255]+"-"+Xn[t&63|128]+Xn[t>>8&255]+"-"+Xn[t>>16&255]+Xn[t>>24&255]+Xn[r&255]+Xn[r>>8&255]+Xn[r>>16&255]+Xn[r>>24&255]).toUpperCase()}function Cr(a,e,t){return Math.max(e,Math.min(t,a))}function wm(a,e){return(a%e+e)%e}function u3(a,e,t,r,n){return r+(a-e)*(n-r)/(t-e)}function f3(a,e,t){return a!==e?(t-a)/(e-a):0}function jl(a,e,t){return(1-t)*a+t*e}function h3(a,e,t,r){return jl(a,e,1-Math.exp(-t*r))}function d3(a,e=1){return e-Math.abs(wm(a,e*2)-e)}function p3(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*(3-2*a))}function m3(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*a*(a*(a*6-15)+10))}function v3(a,e){return a+Math.floor(Math.random()*(e-a+1))}function g3(a,e){return a+Math.random()*(e-a)}function _3(a){return a*(.5-Math.random())}function y3(a){return a!==void 0&&(Cu=a%2147483647),Cu=Cu*16807%2147483647,(Cu-1)/2147483646}function x3(a){return a*Do}function S3(a){return a*ic}function qp(a){return(a&a-1)===0&&a!==0}function w3(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function J1(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function b3(a,e,t,r,n){const i=Math.cos,s=Math.sin,o=i(t/2),l=s(t/2),c=i((e+r)/2),f=s((e+r)/2),d=i((e-r)/2),p=s((e-r)/2),m=i((r-e)/2),v=s((r-e)/2);switch(n){case"XYX":a.set(o*f,l*d,l*p,o*c);break;case"YZY":a.set(l*p,o*f,l*d,o*c);break;case"ZXZ":a.set(l*d,l*p,o*f,o*c);break;case"XZX":a.set(o*f,l*v,l*m,o*c);break;case"YXY":a.set(l*m,o*f,l*v,o*c);break;case"ZYZ":a.set(l*v,l*m,o*f,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}var oa=Object.freeze({__proto__:null,DEG2RAD:Do,RAD2DEG:ic,generateUUID:xi,clamp:Cr,euclideanModulo:wm,mapLinear:u3,inverseLerp:f3,lerp:jl,damp:h3,pingpong:d3,smoothstep:p3,smootherstep:m3,randInt:v3,randFloat:g3,randFloatSpread:_3,seededRandom:y3,degToRad:x3,radToDeg:S3,isPowerOfTwo:qp,ceilPowerOfTwo:w3,floorPowerOfTwo:J1,setQuaternionFromProperEuler:b3});class Pe{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,s=this.y-e.y;return this.x=i*r-s*n+e.x,this.y=i*n+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Pe.prototype.isVector2=!0;class Cn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,n,i,s,o,l,c){const f=this.elements;return f[0]=e,f[1]=n,f[2]=o,f[3]=t,f[4]=i,f[5]=l,f[6]=r,f[7]=s,f[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,i=this.elements,s=r[0],o=r[3],l=r[6],c=r[1],f=r[4],d=r[7],p=r[2],m=r[5],v=r[8],y=n[0],S=n[3],_=n[6],x=n[1],b=n[4],M=n[7],E=n[2],T=n[5],R=n[8];return i[0]=s*y+o*x+l*E,i[3]=s*S+o*b+l*T,i[6]=s*_+o*M+l*R,i[1]=c*y+f*x+d*E,i[4]=c*S+f*b+d*T,i[7]=c*_+f*M+d*R,i[2]=p*y+m*x+v*E,i[5]=p*S+m*b+v*T,i[8]=p*_+m*M+v*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],o=e[5],l=e[6],c=e[7],f=e[8];return t*s*f-t*o*c-r*i*f+r*o*l+n*i*c-n*s*l}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],o=e[5],l=e[6],c=e[7],f=e[8],d=f*s-o*c,p=o*l-f*i,m=c*i-s*l,v=t*d+r*p+n*m;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/v;return e[0]=d*y,e[1]=(n*c-f*r)*y,e[2]=(o*r-n*s)*y,e[3]=p*y,e[4]=(f*t-n*l)*y,e[5]=(n*i-o*t)*y,e[6]=m*y,e[7]=(r*l-c*t)*y,e[8]=(s*t-r*i)*y,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,n,i,s,o){const l=Math.cos(i),c=Math.sin(i);return this.set(r*l,r*c,-r*(l*s+c*o)+s+e,-n*c,n*l,-n*(-c*s+l*o)+o+t,0,0,1),this}scale(e,t){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],s=n[3],o=n[6],l=n[1],c=n[4],f=n[7];return n[0]=t*i+r*l,n[3]=t*s+r*c,n[6]=t*o+r*f,n[1]=-r*i+t*l,n[4]=-r*s+t*c,n[7]=-r*o+t*f,this}translate(e,t){const r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){const t=this.elements,r=e.elements;for(let n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}Cn.prototype.isMatrix3=!0;let Zs;class Xo{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Zs===void 0&&(Zs=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Zs.width=e.width,Zs.height=e.height;const r=Zs.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Zs}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let M3=0;class $n extends Cs{constructor(e=$n.DEFAULT_IMAGE,t=$n.DEFAULT_MAPPING,r=ur,n=ur,i=qt,s=Kf,o=Mn,l=Ya,c=1,f=Ar){super(),Object.defineProperty(this,"id",{value:M3++}),this.uuid=xi(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=n,this.magFilter=i,this.minFilter=s,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Pe(0,0),this.repeat=new Pe(1,1),this.center=new Pe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Cn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=f,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const n=this.image;if(n.uuid===void 0&&(n.uuid=xi()),!t&&e.images[n.uuid]===void 0){let i;if(Array.isArray(n)){i=[];for(let s=0,o=n.length;s<o;s++)n[s].isDataTexture?i.push(Id(n[s].image)):i.push(Id(n[s]))}else i=Id(n);e.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==$f)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ec:e.x=e.x-Math.floor(e.x);break;case ur:e.x=e.x<0?0:1;break;case $p:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ec:e.y=e.y-Math.floor(e.y);break;case ur:e.y=e.y<0?0:1;break;case $p:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}$n.DEFAULT_IMAGE=void 0;$n.DEFAULT_MAPPING=$f;$n.prototype.isTexture=!0;function Id(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap?Xo.getDataURL(a):a.data?{data:Array.prototype.slice.call(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Gt{constructor(e=0,t=0,r=0,n=1){this.x=e,this.y=t,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*n+s[12]*i,this.y=s[1]*t+s[5]*r+s[9]*n+s[13]*i,this.z=s[2]*t+s[6]*r+s[10]*n+s[14]*i,this.w=s[3]*t+s[7]*r+s[11]*n+s[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,n,i;const l=e.elements,c=l[0],f=l[4],d=l[8],p=l[1],m=l[5],v=l[9],y=l[2],S=l[6],_=l[10];if(Math.abs(f-p)<.01&&Math.abs(d-y)<.01&&Math.abs(v-S)<.01){if(Math.abs(f+p)<.1&&Math.abs(d+y)<.1&&Math.abs(v+S)<.1&&Math.abs(c+m+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const b=(c+1)/2,M=(m+1)/2,E=(_+1)/2,T=(f+p)/4,R=(d+y)/4,V=(v+S)/4;return b>M&&b>E?b<.01?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(b),n=T/r,i=R/r):M>E?M<.01?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(M),r=T/n,i=V/n):E<.01?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(E),r=R/i,n=V/i),this.set(r,n,i,t),this}let x=Math.sqrt((S-v)*(S-v)+(d-y)*(d-y)+(p-f)*(p-f));return Math.abs(x)<.001&&(x=1),this.x=(S-v)/x,this.y=(d-y)/x,this.z=(p-f)/x,this.w=Math.acos((c+m+_-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Gt.prototype.isVector4=!0;class Rn extends Cs{constructor(e,t,r={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Gt(0,0,e,t),this.scissorTest=!1,this.viewport=new Gt(0,0,e,t),this.texture=new $n(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:qt,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Rn.prototype.isWebGLRenderTarget=!0;class E3 extends Rn{constructor(e,t,r){super(e,t);const n=this.texture;this.texture=[];for(let i=0;i<r;i++)this.texture[i]=n.clone()}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let n=0,i=this.texture.length;n<i;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone();return this}}E3.prototype.isWebGLMultipleRenderTargets=!0;class Q1 extends Rn{constructor(e,t,r){super(e,t,r),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}Q1.prototype.isWebGLMultisampleRenderTarget=!0;class On{constructor(e=0,t=0,r=0,n=1){this._x=e,this._y=t,this._z=r,this._w=n}static slerp(e,t,r,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,t,n)}static slerpFlat(e,t,r,n,i,s,o){let l=r[n+0],c=r[n+1],f=r[n+2],d=r[n+3];const p=i[s+0],m=i[s+1],v=i[s+2],y=i[s+3];if(o===0){e[t+0]=l,e[t+1]=c,e[t+2]=f,e[t+3]=d;return}if(o===1){e[t+0]=p,e[t+1]=m,e[t+2]=v,e[t+3]=y;return}if(d!==y||l!==p||c!==m||f!==v){let S=1-o;const _=l*p+c*m+f*v+d*y,x=_>=0?1:-1,b=1-_*_;if(b>Number.EPSILON){const E=Math.sqrt(b),T=Math.atan2(E,_*x);S=Math.sin(S*T)/E,o=Math.sin(o*T)/E}const M=o*x;if(l=l*S+p*M,c=c*S+m*M,f=f*S+v*M,d=d*S+y*M,S===1-o){const E=1/Math.sqrt(l*l+c*c+f*f+d*d);l*=E,c*=E,f*=E,d*=E}}e[t]=l,e[t+1]=c,e[t+2]=f,e[t+3]=d}static multiplyQuaternionsFlat(e,t,r,n,i,s){const o=r[n],l=r[n+1],c=r[n+2],f=r[n+3],d=i[s],p=i[s+1],m=i[s+2],v=i[s+3];return e[t]=o*v+f*d+l*m-c*p,e[t+1]=l*v+f*p+c*d-o*m,e[t+2]=c*v+f*m+o*p-l*d,e[t+3]=f*v-o*d-l*p-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const r=e._x,n=e._y,i=e._z,s=e._order,o=Math.cos,l=Math.sin,c=o(r/2),f=o(n/2),d=o(i/2),p=l(r/2),m=l(n/2),v=l(i/2);switch(s){case"XYZ":this._x=p*f*d+c*m*v,this._y=c*m*d-p*f*v,this._z=c*f*v+p*m*d,this._w=c*f*d-p*m*v;break;case"YXZ":this._x=p*f*d+c*m*v,this._y=c*m*d-p*f*v,this._z=c*f*v-p*m*d,this._w=c*f*d+p*m*v;break;case"ZXY":this._x=p*f*d-c*m*v,this._y=c*m*d+p*f*v,this._z=c*f*v+p*m*d,this._w=c*f*d-p*m*v;break;case"ZYX":this._x=p*f*d-c*m*v,this._y=c*m*d+p*f*v,this._z=c*f*v-p*m*d,this._w=c*f*d+p*m*v;break;case"YZX":this._x=p*f*d+c*m*v,this._y=c*m*d+p*f*v,this._z=c*f*v-p*m*d,this._w=c*f*d-p*m*v;break;case"XZY":this._x=p*f*d-c*m*v,this._y=c*m*d-p*f*v,this._z=c*f*v+p*m*d,this._w=c*f*d+p*m*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],n=t[4],i=t[8],s=t[1],o=t[5],l=t[9],c=t[2],f=t[6],d=t[10],p=r+o+d;if(p>0){const m=.5/Math.sqrt(p+1);this._w=.25/m,this._x=(f-l)*m,this._y=(i-c)*m,this._z=(s-n)*m}else if(r>o&&r>d){const m=2*Math.sqrt(1+r-o-d);this._w=(f-l)/m,this._x=.25*m,this._y=(n+s)/m,this._z=(i+c)/m}else if(o>d){const m=2*Math.sqrt(1+o-r-d);this._w=(i-c)/m,this._x=(n+s)/m,this._y=.25*m,this._z=(l+f)/m}else{const m=2*Math.sqrt(1+d-r-o);this._w=(s-n)/m,this._x=(i+c)/m,this._y=(l+f)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Cr(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const n=Math.min(1,t/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,n=e._y,i=e._z,s=e._w,o=t._x,l=t._y,c=t._z,f=t._w;return this._x=r*f+s*o+n*c-i*l,this._y=n*f+s*l+i*o-r*c,this._z=i*f+s*c+r*l-n*o,this._w=s*f-r*o-n*l-i*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,n=this._y,i=this._z,s=this._w;let o=s*e._w+r*e._x+n*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=r,this._y=n,this._z=i,this;const l=1-o*o;if(l<=Number.EPSILON){const m=1-t;return this._w=m*s+t*this._w,this._x=m*r+t*this._x,this._y=m*n+t*this._y,this._z=m*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),f=Math.atan2(c,o),d=Math.sin((1-t)*f)/c,p=Math.sin(t*f)/c;return this._w=s*d+this._w*p,this._x=r*d+this._x*p,this._y=n*d+this._y*p,this._z=i*d+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,r){this.copy(e).slerp(t,r)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}On.prototype.isQuaternion=!0;class C{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(y0.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(y0.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=e.elements,s=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*s,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*s,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*s,this}applyQuaternion(e){const t=this.x,r=this.y,n=this.z,i=e.x,s=e.y,o=e.z,l=e.w,c=l*t+s*n-o*r,f=l*r+o*t-i*n,d=l*n+i*r-s*t,p=-i*t-s*r-o*n;return this.x=c*l+p*-i+f*-o-d*-s,this.y=f*l+p*-s+d*-i-c*-o,this.z=d*l+p*-o+c*-s-f*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,n=e.y,i=e.z,s=t.x,o=t.y,l=t.z;return this.x=n*l-i*o,this.y=i*s-r*l,this.z=r*o-n*s,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Nd.copy(this).projectOnVector(e),this.sub(Nd)}reflect(e){return this.sub(Nd.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Cr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}C.prototype.isVector3=!0;const Nd=new C,y0=new On;class An{constructor(e=new C(1/0,1/0,1/0),t=new C(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,r=1/0,n=1/0,i=-1/0,s=-1/0,o=-1/0;for(let l=0,c=e.length;l<c;l+=3){const f=e[l],d=e[l+1],p=e[l+2];f<t&&(t=f),d<r&&(r=d),p<n&&(n=p),f>i&&(i=f),d>s&&(s=d),p>o&&(o=p)}return this.min.set(t,r,n),this.max.set(i,s,o),this}setFromBufferAttribute(e){let t=1/0,r=1/0,n=1/0,i=-1/0,s=-1/0,o=-1/0;for(let l=0,c=e.count;l<c;l++){const f=e.getX(l),d=e.getY(l),p=e.getZ(l);f<t&&(t=f),d<r&&(r=d),p<n&&(n=p),f>i&&(i=f),d>s&&(s=d),p>o&&(o=p)}return this.min.set(t,r,n),this.max.set(i,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Ml.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),kd.copy(t.boundingBox),kd.applyMatrix4(e.matrixWorld),this.union(kd));const r=e.children;for(let n=0,i=r.length;n<i;n++)this.expandByObject(r[n]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ml),Ml.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(El),Au.subVectors(this.max,El),js.subVectors(e.a,El),Ks.subVectors(e.b,El),Js.subVectors(e.c,El),Sa.subVectors(Ks,js),wa.subVectors(Js,Ks),fs.subVectors(js,Js);let t=[0,-Sa.z,Sa.y,0,-wa.z,wa.y,0,-fs.z,fs.y,Sa.z,0,-Sa.x,wa.z,0,-wa.x,fs.z,0,-fs.x,-Sa.y,Sa.x,0,-wa.y,wa.x,0,-fs.y,fs.x,0];return!Od(t,js,Ks,Js,Au)||(t=[1,0,0,0,1,0,0,0,1],!Od(t,js,Ks,Js,Au))?!1:(Tu.crossVectors(Sa,wa),t=[Tu.x,Tu.y,Tu.z],Od(t,js,Ks,Js,Au))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ml.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Ml).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Zi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Zi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Zi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Zi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Zi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Zi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Zi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Zi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Zi),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}An.prototype.isBox3=!0;const Zi=[new C,new C,new C,new C,new C,new C,new C,new C],Ml=new C,kd=new An,js=new C,Ks=new C,Js=new C,Sa=new C,wa=new C,fs=new C,El=new C,Au=new C,Tu=new C,hs=new C;function Od(a,e,t,r,n){for(let i=0,s=a.length-3;i<=s;i+=3){hs.fromArray(a,i);const o=n.x*Math.abs(hs.x)+n.y*Math.abs(hs.y)+n.z*Math.abs(hs.z),l=e.dot(hs),c=t.dot(hs),f=r.dot(hs);if(Math.max(-Math.max(l,c,f),Math.min(l,c,f))>o)return!1}return!0}const C3=new An,x0=new C,Dd=new C,Fd=new C;class Lr{constructor(e=new C,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):C3.setFromPoints(e).getCenter(r);let n=0;for(let i=0,s=e.length;i<s;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Fd.subVectors(e,this.center);const t=Fd.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),n=(r-this.radius)*.5;this.center.add(Fd.multiplyScalar(n/r)),this.radius+=n}return this}union(e){return Dd.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(x0.copy(e.center).add(Dd)),this.expandByPoint(x0.copy(e.center).sub(Dd)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ji=new C,Bd=new C,Ru=new C,ba=new C,zd=new C,Lu=new C,Vd=new C;class ja{constructor(e=new C,t=new C(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ji)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ji.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ji.copy(this.direction).multiplyScalar(t).add(this.origin),ji.distanceToSquared(e))}distanceSqToSegment(e,t,r,n){Bd.copy(e).add(t).multiplyScalar(.5),Ru.copy(t).sub(e).normalize(),ba.copy(this.origin).sub(Bd);const i=e.distanceTo(t)*.5,s=-this.direction.dot(Ru),o=ba.dot(this.direction),l=-ba.dot(Ru),c=ba.lengthSq(),f=Math.abs(1-s*s);let d,p,m,v;if(f>0)if(d=s*l-o,p=s*o-l,v=i*f,d>=0)if(p>=-v)if(p<=v){const y=1/f;d*=y,p*=y,m=d*(d+s*p+2*o)+p*(s*d+p+2*l)+c}else p=i,d=Math.max(0,-(s*p+o)),m=-d*d+p*(p+2*l)+c;else p=-i,d=Math.max(0,-(s*p+o)),m=-d*d+p*(p+2*l)+c;else p<=-v?(d=Math.max(0,-(-s*i+o)),p=d>0?-i:Math.min(Math.max(-i,-l),i),m=-d*d+p*(p+2*l)+c):p<=v?(d=0,p=Math.min(Math.max(-i,-l),i),m=p*(p+2*l)+c):(d=Math.max(0,-(s*i+o)),p=d>0?i:Math.min(Math.max(-i,-l),i),m=-d*d+p*(p+2*l)+c);else p=s>0?-i:i,d=Math.max(0,-(s*p+o)),m=-d*d+p*(p+2*l)+c;return r&&r.copy(this.direction).multiplyScalar(d).add(this.origin),n&&n.copy(Ru).multiplyScalar(p).add(Bd),m}intersectSphere(e,t){ji.subVectors(e.center,this.origin);const r=ji.dot(this.direction),n=ji.dot(ji)-r*r,i=e.radius*e.radius;if(n>i)return null;const s=Math.sqrt(i-n),o=r-s,l=r+s;return o<0&&l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,n,i,s,o,l;const c=1/this.direction.x,f=1/this.direction.y,d=1/this.direction.z,p=this.origin;return c>=0?(r=(e.min.x-p.x)*c,n=(e.max.x-p.x)*c):(r=(e.max.x-p.x)*c,n=(e.min.x-p.x)*c),f>=0?(i=(e.min.y-p.y)*f,s=(e.max.y-p.y)*f):(i=(e.max.y-p.y)*f,s=(e.min.y-p.y)*f),r>s||i>n||((i>r||r!==r)&&(r=i),(s<n||n!==n)&&(n=s),d>=0?(o=(e.min.z-p.z)*d,l=(e.max.z-p.z)*d):(o=(e.max.z-p.z)*d,l=(e.min.z-p.z)*d),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,t)}intersectsBox(e){return this.intersectBox(e,ji)!==null}intersectTriangle(e,t,r,n,i){zd.subVectors(t,e),Lu.subVectors(r,e),Vd.crossVectors(zd,Lu);let s=this.direction.dot(Vd),o;if(s>0){if(n)return null;o=1}else if(s<0)o=-1,s=-s;else return null;ba.subVectors(this.origin,e);const l=o*this.direction.dot(Lu.crossVectors(ba,Lu));if(l<0)return null;const c=o*this.direction.dot(zd.cross(ba));if(c<0||l+c>s)return null;const f=-o*ba.dot(Vd);return f<0?null:this.at(f/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Xe{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,n,i,s,o,l,c,f,d,p,m,v,y,S){const _=this.elements;return _[0]=e,_[4]=t,_[8]=r,_[12]=n,_[1]=i,_[5]=s,_[9]=o,_[13]=l,_[2]=c,_[6]=f,_[10]=d,_[14]=p,_[3]=m,_[7]=v,_[11]=y,_[15]=S,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Xe().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,n=1/Qs.setFromMatrixColumn(e,0).length(),i=1/Qs.setFromMatrixColumn(e,1).length(),s=1/Qs.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,r=e.x,n=e.y,i=e.z,s=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),f=Math.cos(i),d=Math.sin(i);if(e.order==="XYZ"){const p=s*f,m=s*d,v=o*f,y=o*d;t[0]=l*f,t[4]=-l*d,t[8]=c,t[1]=m+v*c,t[5]=p-y*c,t[9]=-o*l,t[2]=y-p*c,t[6]=v+m*c,t[10]=s*l}else if(e.order==="YXZ"){const p=l*f,m=l*d,v=c*f,y=c*d;t[0]=p+y*o,t[4]=v*o-m,t[8]=s*c,t[1]=s*d,t[5]=s*f,t[9]=-o,t[2]=m*o-v,t[6]=y+p*o,t[10]=s*l}else if(e.order==="ZXY"){const p=l*f,m=l*d,v=c*f,y=c*d;t[0]=p-y*o,t[4]=-s*d,t[8]=v+m*o,t[1]=m+v*o,t[5]=s*f,t[9]=y-p*o,t[2]=-s*c,t[6]=o,t[10]=s*l}else if(e.order==="ZYX"){const p=s*f,m=s*d,v=o*f,y=o*d;t[0]=l*f,t[4]=v*c-m,t[8]=p*c+y,t[1]=l*d,t[5]=y*c+p,t[9]=m*c-v,t[2]=-c,t[6]=o*l,t[10]=s*l}else if(e.order==="YZX"){const p=s*l,m=s*c,v=o*l,y=o*c;t[0]=l*f,t[4]=y-p*d,t[8]=v*d+m,t[1]=d,t[5]=s*f,t[9]=-o*f,t[2]=-c*f,t[6]=m*d+v,t[10]=p-y*d}else if(e.order==="XZY"){const p=s*l,m=s*c,v=o*l,y=o*c;t[0]=l*f,t[4]=-d,t[8]=c*f,t[1]=p*d+y,t[5]=s*f,t[9]=m*d-v,t[2]=v*d-m,t[6]=o*f,t[10]=y*d+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(A3,e,T3)}lookAt(e,t,r){const n=this.elements;return zr.subVectors(e,t),zr.lengthSq()===0&&(zr.z=1),zr.normalize(),Ma.crossVectors(r,zr),Ma.lengthSq()===0&&(Math.abs(r.z)===1?zr.x+=1e-4:zr.z+=1e-4,zr.normalize(),Ma.crossVectors(r,zr)),Ma.normalize(),Pu.crossVectors(zr,Ma),n[0]=Ma.x,n[4]=Pu.x,n[8]=zr.x,n[1]=Ma.y,n[5]=Pu.y,n[9]=zr.y,n[2]=Ma.z,n[6]=Pu.z,n[10]=zr.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,i=this.elements,s=r[0],o=r[4],l=r[8],c=r[12],f=r[1],d=r[5],p=r[9],m=r[13],v=r[2],y=r[6],S=r[10],_=r[14],x=r[3],b=r[7],M=r[11],E=r[15],T=n[0],R=n[4],V=n[8],Y=n[12],$=n[1],W=n[5],j=n[9],X=n[13],P=n[2],N=n[6],I=n[10],G=n[14],ee=n[3],re=n[7],he=n[11],pe=n[15];return i[0]=s*T+o*$+l*P+c*ee,i[4]=s*R+o*W+l*N+c*re,i[8]=s*V+o*j+l*I+c*he,i[12]=s*Y+o*X+l*G+c*pe,i[1]=f*T+d*$+p*P+m*ee,i[5]=f*R+d*W+p*N+m*re,i[9]=f*V+d*j+p*I+m*he,i[13]=f*Y+d*X+p*G+m*pe,i[2]=v*T+y*$+S*P+_*ee,i[6]=v*R+y*W+S*N+_*re,i[10]=v*V+y*j+S*I+_*he,i[14]=v*Y+y*X+S*G+_*pe,i[3]=x*T+b*$+M*P+E*ee,i[7]=x*R+b*W+M*N+E*re,i[11]=x*V+b*j+M*I+E*he,i[15]=x*Y+b*X+M*G+E*pe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],s=e[1],o=e[5],l=e[9],c=e[13],f=e[2],d=e[6],p=e[10],m=e[14],v=e[3],y=e[7],S=e[11],_=e[15];return v*(+i*l*d-n*c*d-i*o*p+r*c*p+n*o*m-r*l*m)+y*(+t*l*m-t*c*p+i*s*p-n*s*m+n*c*f-i*l*f)+S*(+t*c*d-t*o*m-i*s*d+r*s*m+i*o*f-r*c*f)+_*(-n*o*f-t*l*d+t*o*p+n*s*d-r*s*p+r*l*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],o=e[5],l=e[6],c=e[7],f=e[8],d=e[9],p=e[10],m=e[11],v=e[12],y=e[13],S=e[14],_=e[15],x=d*S*c-y*p*c+y*l*m-o*S*m-d*l*_+o*p*_,b=v*p*c-f*S*c-v*l*m+s*S*m+f*l*_-s*p*_,M=f*y*c-v*d*c+v*o*m-s*y*m-f*o*_+s*d*_,E=v*d*l-f*y*l-v*o*p+s*y*p+f*o*S-s*d*S,T=t*x+r*b+n*M+i*E;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/T;return e[0]=x*R,e[1]=(y*p*i-d*S*i-y*n*m+r*S*m+d*n*_-r*p*_)*R,e[2]=(o*S*i-y*l*i+y*n*c-r*S*c-o*n*_+r*l*_)*R,e[3]=(d*l*i-o*p*i-d*n*c+r*p*c+o*n*m-r*l*m)*R,e[4]=b*R,e[5]=(f*S*i-v*p*i+v*n*m-t*S*m-f*n*_+t*p*_)*R,e[6]=(v*l*i-s*S*i-v*n*c+t*S*c+s*n*_-t*l*_)*R,e[7]=(s*p*i-f*l*i+f*n*c-t*p*c-s*n*m+t*l*m)*R,e[8]=M*R,e[9]=(v*d*i-f*y*i-v*r*m+t*y*m+f*r*_-t*d*_)*R,e[10]=(s*y*i-v*o*i+v*r*c-t*y*c-s*r*_+t*o*_)*R,e[11]=(f*o*i-s*d*i-f*r*c+t*d*c+s*r*m-t*o*m)*R,e[12]=E*R,e[13]=(f*y*n-v*d*n+v*r*p-t*y*p-f*r*S+t*d*S)*R,e[14]=(v*o*n-s*y*n-v*r*l+t*y*l+s*r*S-t*o*S)*R,e[15]=(s*d*n-f*o*n+f*r*l-t*d*l-s*r*p+t*o*p)*R,this}scale(e){const t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),n=Math.sin(t),i=1-r,s=e.x,o=e.y,l=e.z,c=i*s,f=i*o;return this.set(c*s+r,c*o-n*l,c*l+n*o,0,c*o+n*l,f*o+r,f*l-n*s,0,c*l-n*o,f*l+n*s,i*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,n,i,s){return this.set(1,r,i,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,r){const n=this.elements,i=t._x,s=t._y,o=t._z,l=t._w,c=i+i,f=s+s,d=o+o,p=i*c,m=i*f,v=i*d,y=s*f,S=s*d,_=o*d,x=l*c,b=l*f,M=l*d,E=r.x,T=r.y,R=r.z;return n[0]=(1-(y+_))*E,n[1]=(m+M)*E,n[2]=(v-b)*E,n[3]=0,n[4]=(m-M)*T,n[5]=(1-(p+_))*T,n[6]=(S+x)*T,n[7]=0,n[8]=(v+b)*R,n[9]=(S-x)*R,n[10]=(1-(p+y))*R,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,r){const n=this.elements;let i=Qs.set(n[0],n[1],n[2]).length();const s=Qs.set(n[4],n[5],n[6]).length(),o=Qs.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],pi.copy(this);const c=1/i,f=1/s,d=1/o;return pi.elements[0]*=c,pi.elements[1]*=c,pi.elements[2]*=c,pi.elements[4]*=f,pi.elements[5]*=f,pi.elements[6]*=f,pi.elements[8]*=d,pi.elements[9]*=d,pi.elements[10]*=d,t.setFromRotationMatrix(pi),r.x=i,r.y=s,r.z=o,this}makePerspective(e,t,r,n,i,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,l=2*i/(t-e),c=2*i/(r-n),f=(t+e)/(t-e),d=(r+n)/(r-n),p=-(s+i)/(s-i),m=-2*s*i/(s-i);return o[0]=l,o[4]=0,o[8]=f,o[12]=0,o[1]=0,o[5]=c,o[9]=d,o[13]=0,o[2]=0,o[6]=0,o[10]=p,o[14]=m,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,r,n,i,s){const o=this.elements,l=1/(t-e),c=1/(r-n),f=1/(s-i),d=(t+e)*l,p=(r+n)*c,m=(s+i)*f;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-d,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-p,o[2]=0,o[6]=0,o[10]=-2*f,o[14]=-m,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}Xe.prototype.isMatrix4=!0;const Qs=new C,pi=new Xe,A3=new C(0,0,0),T3=new C(1,1,1),Ma=new C,Pu=new C,zr=new C,S0=new Xe,w0=new On;class la{constructor(e=0,t=0,r=0,n=la.DefaultOrder){this._x=e,this._y=t,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,n=this._order){return this._x=e,this._y=t,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const n=e.elements,i=n[0],s=n[4],o=n[8],l=n[1],c=n[5],f=n[9],d=n[2],p=n[6],m=n[10];switch(t){case"XYZ":this._y=Math.asin(Cr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-f,m),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Cr(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(o,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,i),this._z=0);break;case"ZXY":this._x=Math.asin(Cr(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,i));break;case"ZYX":this._y=Math.asin(-Cr(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(p,m),this._z=Math.atan2(l,i)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(Cr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,c),this._y=Math.atan2(-d,i)):(this._x=0,this._y=Math.atan2(o,m));break;case"XZY":this._z=Math.asin(-Cr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-f,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return S0.makeRotationFromQuaternion(e),this.setFromRotationMatrix(S0,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return w0.setFromEuler(this),this.setFromQuaternion(w0,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new C(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}la.prototype.isEuler=!0;la.DefaultOrder="XYZ";la.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class bm{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}}let R3=0;const b0=new C,eo=new On,Ki=new Xe,Iu=new C,Cl=new C,L3=new C,P3=new On,M0=new C(1,0,0),E0=new C(0,1,0),C0=new C(0,0,1),I3={type:"added"},A0={type:"removed"};class Dt extends Cs{constructor(){super(),Object.defineProperty(this,"id",{value:R3++}),this.uuid=xi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Dt.DefaultUp.clone();const e=new C,t=new la,r=new On,n=new C(1,1,1);function i(){r.setFromEuler(t,!1)}function s(){t.setFromQuaternion(r,void 0,!1)}t._onChange(i),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Xe},normalMatrix:{value:new Cn}}),this.matrix=new Xe,this.matrixWorld=new Xe,this.matrixAutoUpdate=Dt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new bm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return eo.setFromAxisAngle(e,t),this.quaternion.multiply(eo),this}rotateOnWorldAxis(e,t){return eo.setFromAxisAngle(e,t),this.quaternion.premultiply(eo),this}rotateX(e){return this.rotateOnAxis(M0,e)}rotateY(e){return this.rotateOnAxis(E0,e)}rotateZ(e){return this.rotateOnAxis(C0,e)}translateOnAxis(e,t){return b0.copy(e).applyQuaternion(this.quaternion),this.position.add(b0.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(M0,e)}translateY(e){return this.translateOnAxis(E0,e)}translateZ(e){return this.translateOnAxis(C0,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ki.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Iu.copy(e):Iu.set(e,t,r);const n=this.parent;this.updateWorldMatrix(!0,!1),Cl.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ki.lookAt(Cl,Iu,this.up):Ki.lookAt(Iu,Cl,this.up),this.quaternion.setFromRotationMatrix(Ki),n&&(Ki.extractRotation(n.matrixWorld),eo.setFromRotationMatrix(Ki),this.quaternion.premultiply(eo.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(I3)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(A0)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(A0)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ki.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ki.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ki),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,n=this.children.length;r<n;r++){const s=this.children[r].getObjectByProperty(e,t);if(s!==void 0)return s}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Cl,e,L3),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Cl,P3,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const n=this.children;for(let i=0,s=n.length;i<s;i++)n[i].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function i(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,f=l.length;c<f;c++){const d=l[c];i(e.shapes,d)}else i(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(i(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(i(e.materials,this.material[l]));n.material=o}else n.material=i(e.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(i(e.animations,l))}}if(t){const o=s(e.geometries),l=s(e.materials),c=s(e.textures),f=s(e.images),d=s(e.shapes),p=s(e.skeletons),m=s(e.animations);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),f.length>0&&(r.images=f),d.length>0&&(r.shapes=d),p.length>0&&(r.skeletons=p),m.length>0&&(r.animations=m)}return r.object=n,r;function s(o){const l=[];for(const c in o){const f=o[c];delete f.metadata,l.push(f)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const n=e.children[r];this.add(n.clone())}return this}}Dt.DefaultUp=new C(0,1,0);Dt.DefaultMatrixAutoUpdate=!0;Dt.prototype.isObject3D=!0;const mi=new C,Ji=new C,Ud=new C,Qi=new C,to=new C,no=new C,T0=new C,Gd=new C,Hd=new C,Wd=new C;let Wr=class Lo{constructor(e=new C,t=new C,r=new C){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,n){n.subVectors(r,t),mi.subVectors(e,t),n.cross(mi);const i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}static getBarycoord(e,t,r,n,i){mi.subVectors(n,t),Ji.subVectors(r,t),Ud.subVectors(e,t);const s=mi.dot(mi),o=mi.dot(Ji),l=mi.dot(Ud),c=Ji.dot(Ji),f=Ji.dot(Ud),d=s*c-o*o;if(d===0)return i.set(-2,-1,-1);const p=1/d,m=(c*l-o*f)*p,v=(s*f-o*l)*p;return i.set(1-m-v,v,m)}static containsPoint(e,t,r,n){return this.getBarycoord(e,t,r,n,Qi),Qi.x>=0&&Qi.y>=0&&Qi.x+Qi.y<=1}static getUV(e,t,r,n,i,s,o,l){return this.getBarycoord(e,t,r,n,Qi),l.set(0,0),l.addScaledVector(i,Qi.x),l.addScaledVector(s,Qi.y),l.addScaledVector(o,Qi.z),l}static isFrontFacing(e,t,r,n){return mi.subVectors(r,t),Ji.subVectors(e,t),mi.cross(Ji).dot(n)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return mi.subVectors(this.c,this.b),Ji.subVectors(this.a,this.b),mi.cross(Ji).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Lo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Lo.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,n,i){return Lo.getUV(e,this.a,this.b,this.c,t,r,n,i)}containsPoint(e){return Lo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Lo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,n=this.b,i=this.c;let s,o;to.subVectors(n,r),no.subVectors(i,r),Gd.subVectors(e,r);const l=to.dot(Gd),c=no.dot(Gd);if(l<=0&&c<=0)return t.copy(r);Hd.subVectors(e,n);const f=to.dot(Hd),d=no.dot(Hd);if(f>=0&&d<=f)return t.copy(n);const p=l*d-f*c;if(p<=0&&l>=0&&f<=0)return s=l/(l-f),t.copy(r).addScaledVector(to,s);Wd.subVectors(e,i);const m=to.dot(Wd),v=no.dot(Wd);if(v>=0&&m<=v)return t.copy(i);const y=m*c-l*v;if(y<=0&&c>=0&&v<=0)return o=c/(c-v),t.copy(r).addScaledVector(no,o);const S=f*v-m*d;if(S<=0&&d-f>=0&&m-v>=0)return T0.subVectors(i,n),o=(d-f)/(d-f+(m-v)),t.copy(n).addScaledVector(T0,o);const _=1/(S+y+p);return s=y*_,o=p*_,t.copy(r).addScaledVector(to,s).addScaledVector(no,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},N3=0;class qn extends Cs{constructor(){super(),Object.defineProperty(this,"id",{value:N3++}),this.uuid=xi(),this.name="",this.type="Material",this.fog=!0,this.blending=ql,this.side=Ss,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=X1,this.blendDst=Y1,this.blendEquation=Ro,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=kf,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=c3,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Pd,this.stencilZFail=Pd,this.stencilZPass=Pd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===W1;continue}const n=this[t];if(n===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(r.specularTint=this.specularTint.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(r.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationTint!==void 0&&(r.attenuationTint=this.attenuationTint.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==ql&&(r.blending=this.blending),this.side!==Ss&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData);function n(i){const s=[];for(const o in i){const l=i[o];delete l.metadata,s.push(l)}return s}if(t){const i=n(e.textures),s=n(e.images);i.length>0&&(r.textures=i),s.length>0&&(r.images=s)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const n=t.length;r=new Array(n);for(let i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}qn.prototype.isMaterial=!0;const ex={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vi={h:0,s:0,l:0},Nu={h:0,s:0,l:0};function Xd(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+(e-a)*6*t:t<1/2?e:t<2/3?a+(e-a)*6*(2/3-t):a}function Yd(a){return a<.04045?a*.0773993808:Math.pow(a*.9478672986+.0521327014,2.4)}function $d(a){return a<.0031308?a*12.92:1.055*Math.pow(a,.41666)-.055}class nt{constructor(e,t,r){return t===void 0&&r===void 0?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,r){return this.r=e,this.g=t,this.b=r,this}setHSL(e,t,r){if(e=wm(e,1),t=Cr(t,0,1),r=Cr(r,0,1),t===0)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=Xd(i,n,e+1/3),this.g=Xd(i,n,e),this.b=Xd(i,n,e-1/3)}return this}setStyle(e){function t(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n;const i=r[1],s=r[2];switch(i){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const o=parseFloat(n[1])/360,l=parseInt(n[2],10)/100,c=parseInt(n[3],10)/100;return t(n[4]),this.setHSL(o,l,c)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(i===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,this;if(i===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=ex[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Yd(e.r),this.g=Yd(e.g),this.b=Yd(e.b),this}copyLinearToSRGB(e){return this.r=$d(e.r),this.g=$d(e.g),this.b=$d(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,r=this.g,n=this.b,i=Math.max(t,r,n),s=Math.min(t,r,n);let o,l;const c=(s+i)/2;if(s===i)o=0,l=0;else{const f=i-s;switch(l=c<=.5?f/(i+s):f/(2-i-s),i){case t:o=(r-n)/f+(r<n?6:0);break;case r:o=(n-t)/f+2;break;case n:o=(t-r)/f+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,r){return this.getHSL(vi),vi.h+=e,vi.s+=t,vi.l+=r,this.setHSL(vi.h,vi.s,vi.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(vi),e.getHSL(Nu);const r=jl(vi.h,Nu.h,t),n=jl(vi.s,Nu.s,t),i=jl(vi.l,Nu.l,t);return this.setHSL(r,n,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}nt.NAMES=ex;nt.prototype.isColor=!0;nt.prototype.r=1;nt.prototype.g=1;nt.prototype.b=1;class Qf extends qn{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new nt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Yf,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Qf.prototype.isMeshBasicMaterial=!0;const sn=new C,ku=new Pe;class mt{constructor(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r===!0,this.usage=rc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let r=0;for(let n=0,i=e.length;n<i;n++){let s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new nt),t[r++]=s.r,t[r++]=s.g,t[r++]=s.b}return this}copyVector2sArray(e){const t=this.array;let r=0;for(let n=0,i=e.length;n<i;n++){let s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new Pe),t[r++]=s.x,t[r++]=s.y}return this}copyVector3sArray(e){const t=this.array;let r=0;for(let n=0,i=e.length;n<i;n++){let s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new C),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z}return this}copyVector4sArray(e){const t=this.array;let r=0;for(let n=0,i=e.length;n<i;n++){let s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new Gt),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z,t[r++]=s.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)ku.fromBufferAttribute(this,t),ku.applyMatrix3(e),this.setXY(t,ku.x,ku.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)sn.fromBufferAttribute(this,t),sn.applyMatrix3(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)sn.x=this.getX(t),sn.y=this.getY(t),sn.z=this.getZ(t),sn.applyMatrix4(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)sn.x=this.getX(t),sn.y=this.getY(t),sn.z=this.getZ(t),sn.applyNormalMatrix(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)sn.x=this.getX(t),sn.y=this.getY(t),sn.z=this.getZ(t),sn.transformDirection(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==rc&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}mt.prototype.isBufferAttribute=!0;class Mm extends mt{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class tx extends mt{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class k3 extends mt{constructor(e,t,r){super(new Uint16Array(e),t,r)}}k3.prototype.isFloat16BufferAttribute=!0;class ln extends mt{constructor(e,t,r){super(new Float32Array(e),t,r)}}function nx(a){if(a.length===0)return-1/0;let e=a[0];for(let t=1,r=a.length;t<r;++t)a[t]>e&&(e=a[t]);return e}let O3=0;const ri=new Xe,qd=new Dt,ro=new C,Vr=new An,Al=new An,Fn=new C;class It extends Cs{constructor(){super(),Object.defineProperty(this,"id",{value:O3++}),this.uuid=xi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(nx(e)>65535?tx:Mm)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const i=new Cn().getNormalMatrix(e);r.applyNormalMatrix(i),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ri.makeRotationFromQuaternion(e),this.applyMatrix4(ri),this}rotateX(e){return ri.makeRotationX(e),this.applyMatrix4(ri),this}rotateY(e){return ri.makeRotationY(e),this.applyMatrix4(ri),this}rotateZ(e){return ri.makeRotationZ(e),this.applyMatrix4(ri),this}translate(e,t,r){return ri.makeTranslation(e,t,r),this.applyMatrix4(ri),this}scale(e,t,r){return ri.makeScale(e,t,r),this.applyMatrix4(ri),this}lookAt(e){return qd.lookAt(e),qd.updateMatrix(),this.applyMatrix4(qd.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ro).negate(),this.translate(ro.x,ro.y,ro.z),this}setFromPoints(e){const t=[];for(let r=0,n=e.length;r<n;r++){const i=e[r];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new ln(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new An);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new C(-1/0,-1/0,-1/0),new C(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,n=t.length;r<n;r++){const i=t[r];Vr.setFromBufferAttribute(i),this.morphTargetsRelative?(Fn.addVectors(this.boundingBox.min,Vr.min),this.boundingBox.expandByPoint(Fn),Fn.addVectors(this.boundingBox.max,Vr.max),this.boundingBox.expandByPoint(Fn)):(this.boundingBox.expandByPoint(Vr.min),this.boundingBox.expandByPoint(Vr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Lr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new C,1/0);return}if(e){const r=this.boundingSphere.center;if(Vr.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const o=t[i];Al.setFromBufferAttribute(o),this.morphTargetsRelative?(Fn.addVectors(Vr.min,Al.min),Vr.expandByPoint(Fn),Fn.addVectors(Vr.max,Al.max),Vr.expandByPoint(Fn)):(Vr.expandByPoint(Al.min),Vr.expandByPoint(Al.max))}Vr.getCenter(r);let n=0;for(let i=0,s=e.count;i<s;i++)Fn.fromBufferAttribute(e,i),n=Math.max(n,r.distanceToSquared(Fn));if(t)for(let i=0,s=t.length;i<s;i++){const o=t[i],l=this.morphTargetsRelative;for(let c=0,f=o.count;c<f;c++)Fn.fromBufferAttribute(o,c),l&&(ro.fromBufferAttribute(e,c),Fn.add(ro)),n=Math.max(n,r.distanceToSquared(Fn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=e.array,n=t.position.array,i=t.normal.array,s=t.uv.array,o=n.length/3;t.tangent===void 0&&this.setAttribute("tangent",new mt(new Float32Array(4*o),4));const l=t.tangent.array,c=[],f=[];for(let $=0;$<o;$++)c[$]=new C,f[$]=new C;const d=new C,p=new C,m=new C,v=new Pe,y=new Pe,S=new Pe,_=new C,x=new C;function b($,W,j){d.fromArray(n,$*3),p.fromArray(n,W*3),m.fromArray(n,j*3),v.fromArray(s,$*2),y.fromArray(s,W*2),S.fromArray(s,j*2),p.sub(d),m.sub(d),y.sub(v),S.sub(v);const X=1/(y.x*S.y-S.x*y.y);isFinite(X)&&(_.copy(p).multiplyScalar(S.y).addScaledVector(m,-y.y).multiplyScalar(X),x.copy(m).multiplyScalar(y.x).addScaledVector(p,-S.x).multiplyScalar(X),c[$].add(_),c[W].add(_),c[j].add(_),f[$].add(x),f[W].add(x),f[j].add(x))}let M=this.groups;M.length===0&&(M=[{start:0,count:r.length}]);for(let $=0,W=M.length;$<W;++$){const j=M[$],X=j.start,P=j.count;for(let N=X,I=X+P;N<I;N+=3)b(r[N+0],r[N+1],r[N+2])}const E=new C,T=new C,R=new C,V=new C;function Y($){R.fromArray(i,$*3),V.copy(R);const W=c[$];E.copy(W),E.sub(R.multiplyScalar(R.dot(W))).normalize(),T.crossVectors(V,W);const X=T.dot(f[$])<0?-1:1;l[$*4]=E.x,l[$*4+1]=E.y,l[$*4+2]=E.z,l[$*4+3]=X}for(let $=0,W=M.length;$<W;++$){const j=M[$],X=j.start,P=j.count;for(let N=X,I=X+P;N<I;N+=3)Y(r[N+0]),Y(r[N+1]),Y(r[N+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new mt(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let p=0,m=r.count;p<m;p++)r.setXYZ(p,0,0,0);const n=new C,i=new C,s=new C,o=new C,l=new C,c=new C,f=new C,d=new C;if(e)for(let p=0,m=e.count;p<m;p+=3){const v=e.getX(p+0),y=e.getX(p+1),S=e.getX(p+2);n.fromBufferAttribute(t,v),i.fromBufferAttribute(t,y),s.fromBufferAttribute(t,S),f.subVectors(s,i),d.subVectors(n,i),f.cross(d),o.fromBufferAttribute(r,v),l.fromBufferAttribute(r,y),c.fromBufferAttribute(r,S),o.add(f),l.add(f),c.add(f),r.setXYZ(v,o.x,o.y,o.z),r.setXYZ(y,l.x,l.y,l.z),r.setXYZ(S,c.x,c.y,c.z)}else for(let p=0,m=t.count;p<m;p+=3)n.fromBufferAttribute(t,p+0),i.fromBufferAttribute(t,p+1),s.fromBufferAttribute(t,p+2),f.subVectors(s,i),d.subVectors(n,i),f.cross(d),r.setXYZ(p+0,f.x,f.y,f.z),r.setXYZ(p+1,f.x,f.y,f.z),r.setXYZ(p+2,f.x,f.y,f.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const r=this.attributes;for(const n in r){if(e.attributes[n]===void 0)continue;const s=r[n].array,o=e.attributes[n],l=o.array,c=o.itemSize*t,f=Math.min(l.length,s.length-c);for(let d=0,p=c;d<f;d++,p++)s[p]=l[d]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Fn.fromBufferAttribute(e,t),Fn.normalize(),e.setXYZ(t,Fn.x,Fn.y,Fn.z)}toNonIndexed(){function e(o,l){const c=o.array,f=o.itemSize,d=o.normalized,p=new c.constructor(l.length*f);let m=0,v=0;for(let y=0,S=l.length;y<S;y++){o.isInterleavedBufferAttribute?m=l[y]*o.data.stride+o.offset:m=l[y]*f;for(let _=0;_<f;_++)p[v++]=c[m++]}return new mt(p,f,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new It,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=e(l,r);t.setAttribute(o,c)}const i=this.morphAttributes;for(const o in i){const l=[],c=i[o];for(let f=0,d=c.length;f<d;f++){const p=c[f],m=e(p,r);l.push(m)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,l=s.length;o<l;o++){const c=s[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let i=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],f=[];for(let d=0,p=c.length;d<p;d++){const m=c[d];f.push(m.toJSON(e.data))}f.length>0&&(n[l]=f,i=!0)}i&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new It().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const n=e.attributes;for(const c in n){const f=n[c];this.setAttribute(c,f.clone(t))}const i=e.morphAttributes;for(const c in i){const f=[],d=i[c];for(let p=0,m=d.length;p<m;p++)f.push(d[p].clone(t));this.morphAttributes[c]=f}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let c=0,f=s.length;c<f;c++){const d=s[c];this.addGroup(d.start,d.count,d.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}It.prototype.isBufferGeometry=!0;const R0=new Xe,io=new ja,Zd=new Lr,Ea=new C,Ca=new C,Aa=new C,jd=new C,Kd=new C,Jd=new C,Ou=new C,Du=new C,Fu=new C,Bu=new Pe,zu=new Pe,Vu=new Pe,Qd=new C,Uu=new C;class Ut extends Dt{constructor(e=new It,t=new Qf){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const n=t[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,s=n.length;i<s;i++){const o=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const r=this.geometry,n=this.material,i=this.matrixWorld;if(n===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),Zd.copy(r.boundingSphere),Zd.applyMatrix4(i),e.ray.intersectsSphere(Zd)===!1)||(R0.copy(i).invert(),io.copy(e.ray).applyMatrix4(R0),r.boundingBox!==null&&io.intersectsBox(r.boundingBox)===!1))return;let s;if(r.isBufferGeometry){const o=r.index,l=r.attributes.position,c=r.morphAttributes.position,f=r.morphTargetsRelative,d=r.attributes.uv,p=r.attributes.uv2,m=r.groups,v=r.drawRange;if(o!==null)if(Array.isArray(n))for(let y=0,S=m.length;y<S;y++){const _=m[y],x=n[_.materialIndex],b=Math.max(_.start,v.start),M=Math.min(_.start+_.count,v.start+v.count);for(let E=b,T=M;E<T;E+=3){const R=o.getX(E),V=o.getX(E+1),Y=o.getX(E+2);s=Gu(this,x,e,io,l,c,f,d,p,R,V,Y),s&&(s.faceIndex=Math.floor(E/3),s.face.materialIndex=_.materialIndex,t.push(s))}}else{const y=Math.max(0,v.start),S=Math.min(o.count,v.start+v.count);for(let _=y,x=S;_<x;_+=3){const b=o.getX(_),M=o.getX(_+1),E=o.getX(_+2);s=Gu(this,n,e,io,l,c,f,d,p,b,M,E),s&&(s.faceIndex=Math.floor(_/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(n))for(let y=0,S=m.length;y<S;y++){const _=m[y],x=n[_.materialIndex],b=Math.max(_.start,v.start),M=Math.min(_.start+_.count,v.start+v.count);for(let E=b,T=M;E<T;E+=3){const R=E,V=E+1,Y=E+2;s=Gu(this,x,e,io,l,c,f,d,p,R,V,Y),s&&(s.faceIndex=Math.floor(E/3),s.face.materialIndex=_.materialIndex,t.push(s))}}else{const y=Math.max(0,v.start),S=Math.min(l.count,v.start+v.count);for(let _=y,x=S;_<x;_+=3){const b=_,M=_+1,E=_+2;s=Gu(this,n,e,io,l,c,f,d,p,b,M,E),s&&(s.faceIndex=Math.floor(_/3),t.push(s))}}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}Ut.prototype.isMesh=!0;function D3(a,e,t,r,n,i,s,o){let l;if(e.side===Tn?l=r.intersectTriangle(s,i,n,!0,o):l=r.intersectTriangle(n,i,s,e.side!==ws,o),l===null)return null;Uu.copy(o),Uu.applyMatrix4(a.matrixWorld);const c=t.ray.origin.distanceTo(Uu);return c<t.near||c>t.far?null:{distance:c,point:Uu.clone(),object:a}}function Gu(a,e,t,r,n,i,s,o,l,c,f,d){Ea.fromBufferAttribute(n,c),Ca.fromBufferAttribute(n,f),Aa.fromBufferAttribute(n,d);const p=a.morphTargetInfluences;if(i&&p){Ou.set(0,0,0),Du.set(0,0,0),Fu.set(0,0,0);for(let v=0,y=i.length;v<y;v++){const S=p[v],_=i[v];S!==0&&(jd.fromBufferAttribute(_,c),Kd.fromBufferAttribute(_,f),Jd.fromBufferAttribute(_,d),s?(Ou.addScaledVector(jd,S),Du.addScaledVector(Kd,S),Fu.addScaledVector(Jd,S)):(Ou.addScaledVector(jd.sub(Ea),S),Du.addScaledVector(Kd.sub(Ca),S),Fu.addScaledVector(Jd.sub(Aa),S)))}Ea.add(Ou),Ca.add(Du),Aa.add(Fu)}a.isSkinnedMesh&&(a.boneTransform(c,Ea),a.boneTransform(f,Ca),a.boneTransform(d,Aa));const m=D3(a,e,t,r,Ea,Ca,Aa,Qd);if(m){o&&(Bu.fromBufferAttribute(o,c),zu.fromBufferAttribute(o,f),Vu.fromBufferAttribute(o,d),m.uv=Wr.getUV(Qd,Ea,Ca,Aa,Bu,zu,Vu,new Pe)),l&&(Bu.fromBufferAttribute(l,c),zu.fromBufferAttribute(l,f),Vu.fromBufferAttribute(l,d),m.uv2=Wr.getUV(Qd,Ea,Ca,Aa,Bu,zu,Vu,new Pe));const v={a:c,b:f,c:d,normal:new C,materialIndex:0};Wr.getNormal(Ea,Ca,Aa,v.normal),m.face=v}return m}class mc extends It{constructor(e=1,t=1,r=1,n=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:s};const o=this;n=Math.floor(n),i=Math.floor(i),s=Math.floor(s);const l=[],c=[],f=[],d=[];let p=0,m=0;v("z","y","x",-1,-1,r,t,e,s,i,0),v("z","y","x",1,-1,r,t,-e,s,i,1),v("x","z","y",1,1,e,r,t,n,s,2),v("x","z","y",1,-1,e,r,-t,n,s,3),v("x","y","z",1,-1,e,t,r,n,i,4),v("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(l),this.setAttribute("position",new ln(c,3)),this.setAttribute("normal",new ln(f,3)),this.setAttribute("uv",new ln(d,2));function v(y,S,_,x,b,M,E,T,R,V,Y){const $=M/R,W=E/V,j=M/2,X=E/2,P=T/2,N=R+1,I=V+1;let G=0,ee=0;const re=new C;for(let he=0;he<I;he++){const pe=he*W-X;for(let Ie=0;Ie<N;Ie++){const De=Ie*$-j;re[y]=De*x,re[S]=pe*b,re[_]=P,c.push(re.x,re.y,re.z),re[y]=0,re[S]=0,re[_]=T>0?1:-1,f.push(re.x,re.y,re.z),d.push(Ie/R),d.push(1-he/V),G+=1}}for(let he=0;he<V;he++)for(let pe=0;pe<R;pe++){const Ie=p+pe+N*he,De=p+pe+N*(he+1),Le=p+(pe+1)+N*(he+1),Oe=p+(pe+1)+N*he;l.push(Ie,De,Oe),l.push(De,Le,Oe),ee+=6}o.addGroup(m,ee,Y),m+=ee,p+=G}}static fromJSON(e){return new mc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Uo(a){const e={};for(const t in a){e[t]={};for(const r in a[t]){const n=a[t][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[t][r]=n.clone():Array.isArray(n)?e[t][r]=n.slice():e[t][r]=n}}return e}function er(a){const e={};for(let t=0;t<a.length;t++){const r=Uo(a[t]);for(const n in r)e[n]=r[n]}return e}const bs={clone:Uo,merge:er};var F3=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,B3=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class wi extends qn{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=F3,this.fragmentShader=B3,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Uo(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const s=this.uniforms[n].value;s&&s.isTexture?t.uniforms[n]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[n]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[n]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[n]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[n]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[n]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[n]={type:"m4",value:s.toArray()}:t.uniforms[n]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}wi.prototype.isShaderMaterial=!0;class Em extends Dt{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Xe,this.projectionMatrix=new Xe,this.projectionMatrixInverse=new Xe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}Em.prototype.isCamera=!0;class En extends Em{constructor(e=50,t=1,r=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ic*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Do*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ic*2*Math.atan(Math.tan(Do*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,n,i,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Do*.5*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n;const s=this.view;if(this.view!==null&&this.view.enabled){const l=s.fullWidth,c=s.fullHeight;i+=s.offsetX*n/l,t-=s.offsetY*r/c,n*=s.width/l,r*=s.height/c}const o=this.filmOffset;o!==0&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}En.prototype.isPerspectiveCamera=!0;const ao=90,so=1;class Cm extends Dt{constructor(e,t,r){if(super(),this.type="CubeCamera",r.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=r;const n=new En(ao,so,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new C(1,0,0)),this.add(n);const i=new En(ao,so,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new C(-1,0,0)),this.add(i);const s=new En(ao,so,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new C(0,1,0)),this.add(s);const o=new En(ao,so,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new C(0,-1,0)),this.add(o);const l=new En(ao,so,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new C(0,0,1)),this.add(l);const c=new En(ao,so,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new C(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const r=this.renderTarget,[n,i,s,o,l,c]=this.children,f=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;const p=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,n),e.setRenderTarget(r,1),e.render(t,i),e.setRenderTarget(r,2),e.render(t,s),e.setRenderTarget(r,3),e.render(t,o),e.setRenderTarget(r,4),e.render(t,l),r.texture.generateMipmaps=p,e.setRenderTarget(r,5),e.render(t,c),e.setRenderTarget(d),e.xr.enabled=f}}class eh extends $n{constructor(e,t,r,n,i,s,o,l,c,f){e=e!==void 0?e:[],t=t!==void 0?t:qf,o=o!==void 0?o:za,super(e,t,r,n,i,s,o,l,c,f),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}eh.prototype.isCubeTexture=!0;class rx extends Rn{constructor(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),super(e,e,t),t=t||{},this.texture=new eh(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:qt,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Mn,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new mc(5,5,5),i=new wi({name:"CubemapFromEquirect",uniforms:Uo(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Tn,blending:sa});i.uniforms.tEquirect.value=t;const s=new Ut(n,i),o=t.minFilter;return t.minFilter===Kf&&(t.minFilter=qt),new Cm(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,r,n){const i=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,r,n);e.setRenderTarget(i)}}rx.prototype.isWebGLCubeRenderTarget=!0;const ep=new C,z3=new C,V3=new Cn;class yi{constructor(e=new C(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const n=ep.subVectors(r,t).cross(z3.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const r=e.delta(ep),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/n;return i<0||i>1?null:t.copy(r).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||V3.getNormalMatrix(e),n=this.coplanarPoint(ep).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}yi.prototype.isPlane=!0;const oo=new Lr,Hu=new C;class th{constructor(e=new yi,t=new yi,r=new yi,n=new yi,i=new yi,s=new yi){this.planes=[e,t,r,n,i,s]}set(e,t,r,n,i,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(s),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){const t=this.planes,r=e.elements,n=r[0],i=r[1],s=r[2],o=r[3],l=r[4],c=r[5],f=r[6],d=r[7],p=r[8],m=r[9],v=r[10],y=r[11],S=r[12],_=r[13],x=r[14],b=r[15];return t[0].setComponents(o-n,d-l,y-p,b-S).normalize(),t[1].setComponents(o+n,d+l,y+p,b+S).normalize(),t[2].setComponents(o+i,d+c,y+m,b+_).normalize(),t[3].setComponents(o-i,d-c,y-m,b-_).normalize(),t[4].setComponents(o-s,d-f,y-v,b-x).normalize(),t[5].setComponents(o+s,d+f,y+v,b+x).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),oo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(oo)}intersectsSprite(e){return oo.center.set(0,0,0),oo.radius=.7071067811865476,oo.applyMatrix4(e.matrixWorld),this.intersectsSphere(oo)}intersectsSphere(e){const t=this.planes,r=e.center,n=-e.radius;for(let i=0;i<6;i++)if(t[i].distanceToPoint(r)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const n=t[r];if(Hu.x=n.normal.x>0?e.max.x:e.min.x,Hu.y=n.normal.y>0?e.max.y:e.min.y,Hu.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Hu)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ix(){let a=null,e=!1,t=null,r=null;function n(i,s){t(i,s),r=a.requestAnimationFrame(n)}return{start:function(){e!==!0&&t!==null&&(r=a.requestAnimationFrame(n),e=!0)},stop:function(){a.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(i){t=i},setContext:function(i){a=i}}}function U3(a,e){const t=e.isWebGL2,r=new WeakMap;function n(c,f){const d=c.array,p=c.usage,m=a.createBuffer();a.bindBuffer(f,m),a.bufferData(f,d,p),c.onUploadCallback();let v=5126;return d instanceof Float32Array?v=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?c.isFloat16BufferAttribute?t?v=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):v=5123:d instanceof Int16Array?v=5122:d instanceof Uint32Array?v=5125:d instanceof Int32Array?v=5124:d instanceof Int8Array?v=5120:(d instanceof Uint8Array||d instanceof Uint8ClampedArray)&&(v=5121),{buffer:m,type:v,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function i(c,f,d){const p=f.array,m=f.updateRange;a.bindBuffer(d,c),m.count===-1?a.bufferSubData(d,0,p):(t?a.bufferSubData(d,m.offset*p.BYTES_PER_ELEMENT,p,m.offset,m.count):a.bufferSubData(d,m.offset*p.BYTES_PER_ELEMENT,p.subarray(m.offset,m.offset+m.count)),m.count=-1)}function s(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);const f=r.get(c);f&&(a.deleteBuffer(f.buffer),r.delete(c))}function l(c,f){if(c.isGLBufferAttribute){const p=r.get(c);(!p||p.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=r.get(c);d===void 0?r.set(c,n(c,f)):d.version<c.version&&(i(d.buffer,c,f),d.version=c.version)}return{get:s,remove:o,update:l}}class Ka extends It{constructor(e=1,t=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};const i=e/2,s=t/2,o=Math.floor(r),l=Math.floor(n),c=o+1,f=l+1,d=e/o,p=t/l,m=[],v=[],y=[],S=[];for(let _=0;_<f;_++){const x=_*p-s;for(let b=0;b<c;b++){const M=b*d-i;v.push(M,-x,0),y.push(0,0,1),S.push(b/o),S.push(1-_/l)}}for(let _=0;_<l;_++)for(let x=0;x<o;x++){const b=x+c*_,M=x+c*(_+1),E=x+1+c*(_+1),T=x+1+c*_;m.push(b,M,T),m.push(M,E,T)}this.setIndex(m),this.setAttribute("position",new ln(v,3)),this.setAttribute("normal",new ln(y,3)),this.setAttribute("uv",new ln(S,2))}static fromJSON(e){return new Ka(e.width,e.height,e.widthSegments,e.heightSegments)}}var G3=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,H3=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,W3=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,X3=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,Y3=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$3="vec3 transformed = vec3( position );",q3=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Z3=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in vec3 f90, const in float dotVH ) {
	float fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );
	return ( f90 - f0 ) * fresnel + f0;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in vec3 f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, vec3( 1.0 ), dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,j3=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,K3=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,J3=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Q3=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,eL=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,tL=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,nL=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,rL=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,iL=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,aL=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,sL=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,oL=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,lL=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,cL=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,uL=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,fL=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,hL="gl_FragColor = linearToOutputTexel( gl_FragColor );",dL=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,pL=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,mL=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,vL=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,gL=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,_L=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,yL=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,xL=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,SL=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,wL=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,bL=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,ML=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,EL=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,CL=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,AL=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,TL=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,RL=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,LL=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,PL=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,IL=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,NL=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	#ifdef SPECULAR
		vec3 specularIntensityFactor = vec3( specularIntensity );
		vec3 specularTintFactor = specularTint;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARTINTMAP
			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;
		#endif
		material.specularColorF90 = mix( specularIntensityFactor, vec3( 1.0 ), metalnessFactor );
	#else
		vec3 specularIntensityFactor = vec3( 1.0 );
		vec3 specularTintFactor = vec3( 1.0 );
		material.specularColorF90 = vec3( 1.0 );
	#endif
	material.specularColor = mix( min( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
	material.specularColorF90 = vec3( 1.0 );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,kL=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
	vec3 specularColorF90;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), vec3( 1.0 ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularColorF90, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,OL=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,DL=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,FL=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,BL=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,zL=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,VL=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,UL=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,GL=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,HL=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,WL=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,XL=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,YL=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,$L=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,qL=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,ZL=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,jL=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,KL=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,JL=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,QL=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,eP=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,tP=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,nP=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,rP=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,iP=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,aP=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,sP=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,oP=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,lP=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,cP=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,uP=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,fP=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,hP=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,dP=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,pP=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,mP=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,vP=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,gP=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,_P=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,yP=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,xP=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,SP=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,wP=`#ifdef USE_TRANSMISSION
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition.xyz / vWorldPosition.w;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	float ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );
	vec3 transmission = transmissionFactor * getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationTint, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );
#endif`,bP=`#ifdef USE_TRANSMISSION
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec4 vWorldPosition;
	vec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {
		vec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);
		vec3 modelScale;
		modelScale.x = length(vec3(modelMatrix[0].xyz));
		modelScale.y = length(vec3(modelMatrix[1].xyz));
		modelScale.z = length(vec3(modelMatrix[2].xyz));
		return normalize(refractionVector) * thickness * modelScale;
	}
	float applyIorToRoughness(float roughness, float ior) {
		return roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);
	}
	vec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {
		float framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);
		return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;
	}
	vec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {
		if (attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;
			vec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);			return transmittance * radiance;
		}
	}
	vec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance) {
		vec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);
		vec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);
		return (1.0 - specularColor) * attenuatedColor * baseColor;
	}
#endif`,MP=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,EP=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,CP=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,AP=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,TP=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,RP=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,LP=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,PP=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,IP=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,NP=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,kP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,OP=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,DP=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,FP=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,BP=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,zP=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,VP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,UP=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,GP=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,HP=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WP=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,XP=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,YP=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$P=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,qP=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
		#ifdef USE_TANGENT
			vTangent = normalize( transformedTangent );
			vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
		#endif
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ZP=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jP=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,KP=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JP=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,QP=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationTint;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularTint;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARTINTMAP
		uniform sampler2D specularTintMap;
	#endif
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <transmission_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,eI=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#ifdef USE_TRANSMISSION
	varying vec4 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition;
#endif
}`,tI=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,nI=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,rI=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,iI=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,aI=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sI=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,oI=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,lI=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const Bt={alphamap_fragment:G3,alphamap_pars_fragment:H3,alphatest_fragment:W3,aomap_fragment:X3,aomap_pars_fragment:Y3,begin_vertex:$3,beginnormal_vertex:q3,bsdfs:Z3,bumpmap_pars_fragment:j3,clipping_planes_fragment:K3,clipping_planes_pars_fragment:J3,clipping_planes_pars_vertex:Q3,clipping_planes_vertex:eL,color_fragment:tL,color_pars_fragment:nL,color_pars_vertex:rL,color_vertex:iL,common:aL,cube_uv_reflection_fragment:sL,defaultnormal_vertex:oL,displacementmap_pars_vertex:lL,displacementmap_vertex:cL,emissivemap_fragment:uL,emissivemap_pars_fragment:fL,encodings_fragment:hL,encodings_pars_fragment:dL,envmap_fragment:pL,envmap_common_pars_fragment:mL,envmap_pars_fragment:vL,envmap_pars_vertex:gL,envmap_physical_pars_fragment:TL,envmap_vertex:_L,fog_vertex:yL,fog_pars_vertex:xL,fog_fragment:SL,fog_pars_fragment:wL,gradientmap_pars_fragment:bL,lightmap_fragment:ML,lightmap_pars_fragment:EL,lights_lambert_vertex:CL,lights_pars_begin:AL,lights_toon_fragment:RL,lights_toon_pars_fragment:LL,lights_phong_fragment:PL,lights_phong_pars_fragment:IL,lights_physical_fragment:NL,lights_physical_pars_fragment:kL,lights_fragment_begin:OL,lights_fragment_maps:DL,lights_fragment_end:FL,logdepthbuf_fragment:BL,logdepthbuf_pars_fragment:zL,logdepthbuf_pars_vertex:VL,logdepthbuf_vertex:UL,map_fragment:GL,map_pars_fragment:HL,map_particle_fragment:WL,map_particle_pars_fragment:XL,metalnessmap_fragment:YL,metalnessmap_pars_fragment:$L,morphnormal_vertex:qL,morphtarget_pars_vertex:ZL,morphtarget_vertex:jL,normal_fragment_begin:KL,normal_fragment_maps:JL,normalmap_pars_fragment:QL,clearcoat_normal_fragment_begin:eP,clearcoat_normal_fragment_maps:tP,clearcoat_pars_fragment:nP,packing:rP,premultiplied_alpha_fragment:iP,project_vertex:aP,dithering_fragment:sP,dithering_pars_fragment:oP,roughnessmap_fragment:lP,roughnessmap_pars_fragment:cP,shadowmap_pars_fragment:uP,shadowmap_pars_vertex:fP,shadowmap_vertex:hP,shadowmask_pars_fragment:dP,skinbase_vertex:pP,skinning_pars_vertex:mP,skinning_vertex:vP,skinnormal_vertex:gP,specularmap_fragment:_P,specularmap_pars_fragment:yP,tonemapping_fragment:xP,tonemapping_pars_fragment:SP,transmission_fragment:wP,transmission_pars_fragment:bP,uv_pars_fragment:MP,uv_pars_vertex:EP,uv_vertex:CP,uv2_pars_fragment:AP,uv2_pars_vertex:TP,uv2_vertex:RP,worldpos_vertex:LP,background_frag:PP,background_vert:IP,cube_frag:NP,cube_vert:kP,depth_frag:OP,depth_vert:DP,distanceRGBA_frag:FP,distanceRGBA_vert:BP,equirect_frag:zP,equirect_vert:VP,linedashed_frag:UP,linedashed_vert:GP,meshbasic_frag:HP,meshbasic_vert:WP,meshlambert_frag:XP,meshlambert_vert:YP,meshmatcap_frag:$P,meshmatcap_vert:qP,meshtoon_frag:ZP,meshtoon_vert:jP,meshphong_frag:KP,meshphong_vert:JP,meshphysical_frag:QP,meshphysical_vert:eI,normal_frag:tI,normal_vert:nI,points_frag:rI,points_vert:iI,shadow_frag:aI,shadow_vert:sI,sprite_frag:oI,sprite_vert:lI},it={common:{diffuse:{value:new nt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Cn},uv2Transform:{value:new Cn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Pe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new nt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new nt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Cn}},sprite:{diffuse:{value:new nt(16777215)},opacity:{value:1},center:{value:new Pe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Cn}}},Ii={basic:{uniforms:er([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.fog]),vertexShader:Bt.meshbasic_vert,fragmentShader:Bt.meshbasic_frag},lambert:{uniforms:er([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.fog,it.lights,{emissive:{value:new nt(0)}}]),vertexShader:Bt.meshlambert_vert,fragmentShader:Bt.meshlambert_frag},phong:{uniforms:er([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.fog,it.lights,{emissive:{value:new nt(0)},specular:{value:new nt(1118481)},shininess:{value:30}}]),vertexShader:Bt.meshphong_vert,fragmentShader:Bt.meshphong_frag},standard:{uniforms:er([it.common,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.roughnessmap,it.metalnessmap,it.fog,it.lights,{emissive:{value:new nt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Bt.meshphysical_vert,fragmentShader:Bt.meshphysical_frag},toon:{uniforms:er([it.common,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.gradientmap,it.fog,it.lights,{emissive:{value:new nt(0)}}]),vertexShader:Bt.meshtoon_vert,fragmentShader:Bt.meshtoon_frag},matcap:{uniforms:er([it.common,it.bumpmap,it.normalmap,it.displacementmap,it.fog,{matcap:{value:null}}]),vertexShader:Bt.meshmatcap_vert,fragmentShader:Bt.meshmatcap_frag},points:{uniforms:er([it.points,it.fog]),vertexShader:Bt.points_vert,fragmentShader:Bt.points_frag},dashed:{uniforms:er([it.common,it.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Bt.linedashed_vert,fragmentShader:Bt.linedashed_frag},depth:{uniforms:er([it.common,it.displacementmap]),vertexShader:Bt.depth_vert,fragmentShader:Bt.depth_frag},normal:{uniforms:er([it.common,it.bumpmap,it.normalmap,it.displacementmap,{opacity:{value:1}}]),vertexShader:Bt.normal_vert,fragmentShader:Bt.normal_frag},sprite:{uniforms:er([it.sprite,it.fog]),vertexShader:Bt.sprite_vert,fragmentShader:Bt.sprite_frag},background:{uniforms:{uvTransform:{value:new Cn},t2D:{value:null}},vertexShader:Bt.background_vert,fragmentShader:Bt.background_frag},cube:{uniforms:er([it.envmap,{opacity:{value:1}}]),vertexShader:Bt.cube_vert,fragmentShader:Bt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Bt.equirect_vert,fragmentShader:Bt.equirect_frag},distanceRGBA:{uniforms:er([it.common,it.displacementmap,{referencePosition:{value:new C},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Bt.distanceRGBA_vert,fragmentShader:Bt.distanceRGBA_frag},shadow:{uniforms:er([it.lights,it.fog,{color:{value:new nt(0)},opacity:{value:1}}]),vertexShader:Bt.shadow_vert,fragmentShader:Bt.shadow_frag}};Ii.physical={uniforms:er([Ii.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Pe(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new nt(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Pe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new nt(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new nt(1,1,1)},specularTintMap:{value:null}}]),vertexShader:Bt.meshphysical_vert,fragmentShader:Bt.meshphysical_frag};function cI(a,e,t,r,n){const i=new nt(0);let s=0,o,l,c=null,f=0,d=null;function p(v,y){let S=!1,_=y.isScene===!0?y.background:null;_&&_.isTexture&&(_=e.get(_));const x=a.xr,b=x.getSession&&x.getSession();b&&b.environmentBlendMode==="additive"&&(_=null),_===null?m(i,s):_&&_.isColor&&(m(_,1),S=!0),(a.autoClear||S)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),_&&(_.isCubeTexture||_.mapping===jf)?(l===void 0&&(l=new Ut(new mc(1,1,1),new wi({name:"BackgroundCubeMaterial",uniforms:Uo(Ii.cube.uniforms),vertexShader:Ii.cube.vertexShader,fragmentShader:Ii.cube.fragmentShader,side:Tn,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(M,E,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=_,l.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,(c!==_||f!==_.version||d!==a.toneMapping)&&(l.material.needsUpdate=!0,c=_,f=_.version,d=a.toneMapping),v.unshift(l,l.geometry,l.material,0,0,null)):_&&_.isTexture&&(o===void 0&&(o=new Ut(new Ka(2,2),new wi({name:"BackgroundMaterial",uniforms:Uo(Ii.background.uniforms),vertexShader:Ii.background.vertexShader,fragmentShader:Ii.background.fragmentShader,side:Ss,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=_,_.matrixAutoUpdate===!0&&_.updateMatrix(),o.material.uniforms.uvTransform.value.copy(_.matrix),(c!==_||f!==_.version||d!==a.toneMapping)&&(o.material.needsUpdate=!0,c=_,f=_.version,d=a.toneMapping),v.unshift(o,o.geometry,o.material,0,0,null))}function m(v,y){t.buffers.color.setClear(v.r,v.g,v.b,y,n)}return{getClearColor:function(){return i},setClearColor:function(v,y=1){i.set(v),s=y,m(i,s)},getClearAlpha:function(){return s},setClearAlpha:function(v){s=v,m(i,s)},render:p}}function uI(a,e,t,r){const n=a.getParameter(34921),i=r.isWebGL2?null:e.get("OES_vertex_array_object"),s=r.isWebGL2||i!==null,o={},l=y(null);let c=l;function f(X,P,N,I,G){let ee=!1;if(s){const re=v(I,N,P);c!==re&&(c=re,p(c.object)),ee=S(I,G),ee&&_(I,G)}else{const re=P.wireframe===!0;(c.geometry!==I.id||c.program!==N.id||c.wireframe!==re)&&(c.geometry=I.id,c.program=N.id,c.wireframe=re,ee=!0)}X.isInstancedMesh===!0&&(ee=!0),G!==null&&t.update(G,34963),ee&&(R(X,P,N,I),G!==null&&a.bindBuffer(34963,t.get(G).buffer))}function d(){return r.isWebGL2?a.createVertexArray():i.createVertexArrayOES()}function p(X){return r.isWebGL2?a.bindVertexArray(X):i.bindVertexArrayOES(X)}function m(X){return r.isWebGL2?a.deleteVertexArray(X):i.deleteVertexArrayOES(X)}function v(X,P,N){const I=N.wireframe===!0;let G=o[X.id];G===void 0&&(G={},o[X.id]=G);let ee=G[P.id];ee===void 0&&(ee={},G[P.id]=ee);let re=ee[I];return re===void 0&&(re=y(d()),ee[I]=re),re}function y(X){const P=[],N=[],I=[];for(let G=0;G<n;G++)P[G]=0,N[G]=0,I[G]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:N,attributeDivisors:I,object:X,attributes:{},index:null}}function S(X,P){const N=c.attributes,I=X.attributes;let G=0;for(const ee in I){const re=N[ee],he=I[ee];if(re===void 0||re.attribute!==he||re.data!==he.data)return!0;G++}return c.attributesNum!==G||c.index!==P}function _(X,P){const N={},I=X.attributes;let G=0;for(const ee in I){const re=I[ee],he={};he.attribute=re,re.data&&(he.data=re.data),N[ee]=he,G++}c.attributes=N,c.attributesNum=G,c.index=P}function x(){const X=c.newAttributes;for(let P=0,N=X.length;P<N;P++)X[P]=0}function b(X){M(X,0)}function M(X,P){const N=c.newAttributes,I=c.enabledAttributes,G=c.attributeDivisors;N[X]=1,I[X]===0&&(a.enableVertexAttribArray(X),I[X]=1),G[X]!==P&&((r.isWebGL2?a:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](X,P),G[X]=P)}function E(){const X=c.newAttributes,P=c.enabledAttributes;for(let N=0,I=P.length;N<I;N++)P[N]!==X[N]&&(a.disableVertexAttribArray(N),P[N]=0)}function T(X,P,N,I,G,ee){r.isWebGL2===!0&&(N===5124||N===5125)?a.vertexAttribIPointer(X,P,N,G,ee):a.vertexAttribPointer(X,P,N,I,G,ee)}function R(X,P,N,I){if(r.isWebGL2===!1&&(X.isInstancedMesh||I.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();const G=I.attributes,ee=N.getAttributes(),re=P.defaultAttributeValues;for(const he in ee){const pe=ee[he];if(pe>=0){const Ie=G[he];if(Ie!==void 0){const De=Ie.normalized,Le=Ie.itemSize,Oe=t.get(Ie);if(Oe===void 0)continue;const ne=Oe.buffer,at=Oe.type,Ge=Oe.bytesPerElement;if(Ie.isInterleavedBufferAttribute){const We=Ie.data,Ve=We.stride,Te=Ie.offset;We&&We.isInstancedInterleavedBuffer?(M(pe,We.meshPerAttribute),I._maxInstanceCount===void 0&&(I._maxInstanceCount=We.meshPerAttribute*We.count)):b(pe),a.bindBuffer(34962,ne),T(pe,Le,at,De,Ve*Ge,Te*Ge)}else Ie.isInstancedBufferAttribute?(M(pe,Ie.meshPerAttribute),I._maxInstanceCount===void 0&&(I._maxInstanceCount=Ie.meshPerAttribute*Ie.count)):b(pe),a.bindBuffer(34962,ne),T(pe,Le,at,De,0,0)}else if(he==="instanceMatrix"){const De=t.get(X.instanceMatrix);if(De===void 0)continue;const Le=De.buffer,Oe=De.type;M(pe+0,1),M(pe+1,1),M(pe+2,1),M(pe+3,1),a.bindBuffer(34962,Le),a.vertexAttribPointer(pe+0,4,Oe,!1,64,0),a.vertexAttribPointer(pe+1,4,Oe,!1,64,16),a.vertexAttribPointer(pe+2,4,Oe,!1,64,32),a.vertexAttribPointer(pe+3,4,Oe,!1,64,48)}else if(he==="instanceColor"){const De=t.get(X.instanceColor);if(De===void 0)continue;const Le=De.buffer,Oe=De.type;M(pe,1),a.bindBuffer(34962,Le),a.vertexAttribPointer(pe,3,Oe,!1,12,0)}else if(re!==void 0){const De=re[he];if(De!==void 0)switch(De.length){case 2:a.vertexAttrib2fv(pe,De);break;case 3:a.vertexAttrib3fv(pe,De);break;case 4:a.vertexAttrib4fv(pe,De);break;default:a.vertexAttrib1fv(pe,De)}}}}E()}function V(){W();for(const X in o){const P=o[X];for(const N in P){const I=P[N];for(const G in I)m(I[G].object),delete I[G];delete P[N]}delete o[X]}}function Y(X){if(o[X.id]===void 0)return;const P=o[X.id];for(const N in P){const I=P[N];for(const G in I)m(I[G].object),delete I[G];delete P[N]}delete o[X.id]}function $(X){for(const P in o){const N=o[P];if(N[X.id]===void 0)continue;const I=N[X.id];for(const G in I)m(I[G].object),delete I[G];delete N[X.id]}}function W(){j(),c!==l&&(c=l,p(c.object))}function j(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:f,reset:W,resetDefaultState:j,dispose:V,releaseStatesOfGeometry:Y,releaseStatesOfProgram:$,initAttributes:x,enableAttribute:b,disableUnusedAttributes:E}}function fI(a,e,t,r){const n=r.isWebGL2;let i;function s(c){i=c}function o(c,f){a.drawArrays(i,c,f),t.update(f,i,1)}function l(c,f,d){if(d===0)return;let p,m;if(n)p=a,m="drawArraysInstanced";else if(p=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[m](i,c,f,d),t.update(f,i,d)}this.setMode=s,this.render=o,this.renderInstances=l}function hI(a,e,t){let r;function n(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");r=a.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function i(R){if(R==="highp"){if(a.getShaderPrecisionFormat(35633,36338).precision>0&&a.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";R="mediump"}return R==="mediump"&&a.getShaderPrecisionFormat(35633,36337).precision>0&&a.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s=typeof WebGL2RenderingContext<"u"&&a instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&a instanceof WebGL2ComputeRenderingContext;let o=t.precision!==void 0?t.precision:"highp";const l=i(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const c=s||e.has("WEBGL_draw_buffers"),f=t.logarithmicDepthBuffer===!0,d=a.getParameter(34930),p=a.getParameter(35660),m=a.getParameter(3379),v=a.getParameter(34076),y=a.getParameter(34921),S=a.getParameter(36347),_=a.getParameter(36348),x=a.getParameter(36349),b=p>0,M=s||e.has("OES_texture_float"),E=b&&M,T=s?a.getParameter(36183):0;return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:i,precision:o,logarithmicDepthBuffer:f,maxTextures:d,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:v,maxAttributes:y,maxVertexUniforms:S,maxVaryings:_,maxFragmentUniforms:x,vertexTextures:b,floatFragmentTextures:M,floatVertexTextures:E,maxSamples:T}}function dI(a){const e=this;let t=null,r=0,n=!1,i=!1;const s=new yi,o=new Cn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,p,m){const v=d.length!==0||p||r!==0||n;return n=p,t=f(d,m,0),r=d.length,v},this.beginShadows=function(){i=!0,f(null)},this.endShadows=function(){i=!1,c()},this.setState=function(d,p,m){const v=d.clippingPlanes,y=d.clipIntersection,S=d.clipShadows,_=a.get(d);if(!n||v===null||v.length===0||i&&!S)i?f(null):c();else{const x=i?0:r,b=x*4;let M=_.clippingState||null;l.value=M,M=f(v,p,b,m);for(let E=0;E!==b;++E)M[E]=t[E];_.clippingState=M,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function f(d,p,m,v){const y=d!==null?d.length:0;let S=null;if(y!==0){if(S=l.value,v!==!0||S===null){const _=m+y*4,x=p.matrixWorldInverse;o.getNormalMatrix(x),(S===null||S.length<_)&&(S=new Float32Array(_));for(let b=0,M=m;b!==y;++b,M+=4)s.copy(d[b]).applyMatrix4(x,o),s.normal.toArray(S,M),S[M+3]=s.constant}l.value=S,l.needsUpdate=!0}return e.numPlanes=y,e.numIntersection=0,S}}function pI(a){let e=new WeakMap;function t(s,o){return o===Xp?s.mapping=qf:o===Yp&&(s.mapping=Zf),s}function r(s){if(s&&s.isTexture&&s.isRenderTargetTexture===!1){const o=s.mapping;if(o===Xp||o===Yp)if(e.has(s)){const l=e.get(s).texture;return t(l,s.mapping)}else{const l=s.image;if(l&&l.height>0){const c=a.getRenderTarget(),f=new rx(l.height/2);return f.fromEquirectangularTexture(a,s),e.set(s,f),a.setRenderTarget(c),s.addEventListener("dispose",n),t(f.texture,s.mapping)}else return null}}return s}function n(s){const o=s.target;o.removeEventListener("dispose",n);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function i(){e=new WeakMap}return{get:r,dispose:i}}class Yo extends Em{constructor(e=-1,t=1,r=1,n=-1,i=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,n,i,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let i=r-e,s=r+e,o=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=c*this.view.offsetX,s=i+c*this.view.width,o-=f*this.view.offsetY,l=o-f*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}Yo.prototype.isOrthographicCamera=!0;class Yr extends wi{constructor(e){super(e),this.type="RawShaderMaterial"}}Yr.prototype.isRawShaderMaterial=!0;const Fo=4,Va=8,Li=Math.pow(2,Va),ax=[.125,.215,.35,.446,.526,.582],sx=Va-Fo+1+ax.length,lo=20,ki={[Ar]:0,[Jf]:1,[Sm]:2,[Z1]:3,[j1]:4,[K1]:5,[xm]:6},gs=new Qf({side:Tn,depthWrite:!1,depthTest:!1}),mI=new Ut(new mc,gs),tp=new Yo,{_lodPlanes:Tl,_sizeLods:L0,_sigmas:Wu}=_I(),P0=new nt;let np=null;const _s=(1+Math.sqrt(5))/2,co=1/_s,I0=[new C(1,1,1),new C(-1,1,1),new C(1,1,-1),new C(-1,1,-1),new C(0,_s,co),new C(0,_s,-co),new C(co,0,_s),new C(-co,0,_s),new C(_s,co,0),new C(-_s,co,0)];function N0(a){const e=Math.max(a.r,a.g,a.b),t=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);return a.multiplyScalar(Math.pow(2,-t)),(t+128)/255}class vI{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=yI(lo),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,n=100){np=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(e,r,n,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=D0(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=O0(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Tl.length;e++)Tl[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(np),e.scissorTest=!1,Xu(e,0,0,e.width,e.height)}_fromTexture(e){np=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:_n,minFilter:_n,generateMipmaps:!1,type:Ya,format:_R,encoding:gI(e)?e.encoding:Sm,depthBuffer:!1},r=k0(t);return r.depthBuffer=!e,this._pingPongRenderTarget=k0(t),r}_compileMaterial(e){const t=new Ut(Tl[0],e);this._renderer.compile(t,tp)}_sceneToCubeUV(e,t,r,n){const o=new En(90,1,t,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],f=this._renderer,d=f.autoClear,p=f.outputEncoding,m=f.toneMapping;f.getClearColor(P0),f.toneMapping=xs,f.outputEncoding=Ar,f.autoClear=!1;let v=!1;const y=e.background;if(y){if(y.isColor){gs.color.copy(y).convertSRGBToLinear(),e.background=null;const S=N0(gs.color);gs.opacity=S,v=!0}}else{gs.color.copy(P0).convertSRGBToLinear();const S=N0(gs.color);gs.opacity=S,v=!0}for(let S=0;S<6;S++){const _=S%3;_==0?(o.up.set(0,l[S],0),o.lookAt(c[S],0,0)):_==1?(o.up.set(0,0,l[S]),o.lookAt(0,c[S],0)):(o.up.set(0,l[S],0),o.lookAt(0,0,c[S])),Xu(n,_*Li,S>2?Li:0,Li,Li),f.setRenderTarget(n),v&&f.render(mI,o),f.render(e,o)}f.toneMapping=m,f.outputEncoding=p,f.autoClear=d}_textureToCubeUV(e,t){const r=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=D0()):this._equirectShader==null&&(this._equirectShader=O0());const n=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Ut(Tl[0],n),s=n.uniforms;s.envMap.value=e,e.isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=ki[e.encoding],s.outputEncoding.value=ki[t.texture.encoding],Xu(t,0,0,3*Li,2*Li),r.setRenderTarget(t),r.render(i,tp)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let n=1;n<sx;n++){const i=Math.sqrt(Wu[n]*Wu[n]-Wu[n-1]*Wu[n-1]),s=I0[(n-1)%I0.length];this._blur(e,n-1,n,i,s)}t.autoClear=r}_blur(e,t,r,n,i){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,n,"latitudinal",i),this._halfBlur(s,e,r,r,n,"longitudinal",i)}_halfBlur(e,t,r,n,i,s,o){const l=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,d=new Ut(Tl[n],c),p=c.uniforms,m=L0[r]-1,v=isFinite(i)?Math.PI/(2*m):2*Math.PI/(2*lo-1),y=i/v,S=isFinite(i)?1+Math.floor(f*y):lo;S>lo&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${S} samples when the maximum is set to ${lo}`);const _=[];let x=0;for(let T=0;T<lo;++T){const R=T/y,V=Math.exp(-R*R/2);_.push(V),T==0?x+=V:T<S&&(x+=2*V)}for(let T=0;T<_.length;T++)_[T]=_[T]/x;p.envMap.value=e.texture,p.samples.value=S,p.weights.value=_,p.latitudinal.value=s==="latitudinal",o&&(p.poleAxis.value=o),p.dTheta.value=v,p.mipInt.value=Va-r,p.inputEncoding.value=ki[e.texture.encoding],p.outputEncoding.value=ki[e.texture.encoding];const b=L0[n],M=3*Math.max(0,Li-2*b),E=(n===0?0:2*Li)+2*b*(n>Va-Fo?n-Va+Fo:0);Xu(t,M,E,3*b,2*b),l.setRenderTarget(t),l.render(d,tp)}}function gI(a){return a===void 0||a.type!==Ya?!1:a.encoding===Ar||a.encoding===Jf||a.encoding===xm}function _I(){const a=[],e=[],t=[];let r=Va;for(let n=0;n<sx;n++){const i=Math.pow(2,r);e.push(i);let s=1/i;n>Va-Fo?s=ax[n-Va+Fo-1]:n==0&&(s=0),t.push(s);const o=1/(i-1),l=-o/2,c=1+o/2,f=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,p=6,m=3,v=2,y=1,S=new Float32Array(m*p*d),_=new Float32Array(v*p*d),x=new Float32Array(y*p*d);for(let M=0;M<d;M++){const E=M%3*2/3-1,T=M>2?0:-1,R=[E,T,0,E+2/3,T,0,E+2/3,T+1,0,E,T,0,E+2/3,T+1,0,E,T+1,0];S.set(R,m*p*M),_.set(f,v*p*M);const V=[M,M,M,M,M,M];x.set(V,y*p*M)}const b=new It;b.setAttribute("position",new mt(S,m)),b.setAttribute("uv",new mt(_,v)),b.setAttribute("faceIndex",new mt(x,y)),a.push(b),r>Fo&&r--}return{_lodPlanes:a,_sizeLods:e,_sigmas:t}}function k0(a){const e=new Rn(3*Li,3*Li,a);return e.texture.mapping=jf,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Xu(a,e,t,r,n){a.viewport.set(e,t,r,n),a.scissor.set(e,t,r,n)}function yI(a){const e=new Float32Array(a),t=new C(0,1,0);return new Yr({name:"SphericalGaussianBlur",defines:{n:a},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:ki[Ar]},outputEncoding:{value:ki[Ar]}},vertexShader:Am(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${Tm()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:sa,depthTest:!1,depthWrite:!1})}function O0(){const a=new Pe(1,1);return new Yr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:a},inputEncoding:{value:ki[Ar]},outputEncoding:{value:ki[Ar]}},vertexShader:Am(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${Tm()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:sa,depthTest:!1,depthWrite:!1})}function D0(){return new Yr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ki[Ar]},outputEncoding:{value:ki[Ar]}},vertexShader:Am(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${Tm()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:sa,depthTest:!1,depthWrite:!1})}function Am(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Tm(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function xI(a){let e=new WeakMap,t=null;function r(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const l=o.mapping,c=l===Xp||l===Yp,f=l===qf||l===Zf;if(c||f){if(e.has(o))return e.get(o).texture;{const d=o.image;if(c&&d&&d.height>0||f&&d&&n(d)){const p=a.getRenderTarget();t===null&&(t=new vI(a));const m=c?t.fromEquirectangular(o):t.fromCubemap(o);return e.set(o,m),a.setRenderTarget(p),o.addEventListener("dispose",i),m.texture}else return null}}}return o}function n(o){let l=0;const c=6;for(let f=0;f<c;f++)o[f]!==void 0&&l++;return l===c}function i(o){const l=o.target;l.removeEventListener("dispose",i);const c=e.get(l);c!==void 0&&(c.delete(l),c.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:s}}function SI(a){const e={};function t(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=a.getExtension(r)}return e[r]=n,n}return{has:function(r){return t(r)!==null},init:function(r){r.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(r){const n=t(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function wI(a,e,t,r){const n={},i=new WeakMap;function s(d){const p=d.target;p.index!==null&&e.remove(p.index);for(const v in p.attributes)e.remove(p.attributes[v]);p.removeEventListener("dispose",s),delete n[p.id];const m=i.get(p);m&&(e.remove(m),i.delete(p)),r.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,t.memory.geometries--}function o(d,p){return n[p.id]===!0||(p.addEventListener("dispose",s),n[p.id]=!0,t.memory.geometries++),p}function l(d){const p=d.attributes;for(const v in p)e.update(p[v],34962);const m=d.morphAttributes;for(const v in m){const y=m[v];for(let S=0,_=y.length;S<_;S++)e.update(y[S],34962)}}function c(d){const p=[],m=d.index,v=d.attributes.position;let y=0;if(m!==null){const x=m.array;y=m.version;for(let b=0,M=x.length;b<M;b+=3){const E=x[b+0],T=x[b+1],R=x[b+2];p.push(E,T,T,R,R,E)}}else{const x=v.array;y=v.version;for(let b=0,M=x.length/3-1;b<M;b+=3){const E=b+0,T=b+1,R=b+2;p.push(E,T,T,R,R,E)}}const S=new(nx(p)>65535?tx:Mm)(p,1);S.version=y;const _=i.get(d);_&&e.remove(_),i.set(d,S)}function f(d){const p=i.get(d);if(p){const m=d.index;m!==null&&p.version<m.version&&c(d)}else c(d);return i.get(d)}return{get:o,update:l,getWireframeAttribute:f}}function bI(a,e,t,r){const n=r.isWebGL2;let i;function s(p){i=p}let o,l;function c(p){o=p.type,l=p.bytesPerElement}function f(p,m){a.drawElements(i,m,o,p*l),t.update(m,i,1)}function d(p,m,v){if(v===0)return;let y,S;if(n)y=a,S="drawElementsInstanced";else if(y=e.get("ANGLE_instanced_arrays"),S="drawElementsInstancedANGLE",y===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}y[S](i,m,o,p*l,v),t.update(m,i,v)}this.setMode=s,this.setIndex=c,this.render=f,this.renderInstances=d}function MI(a){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(i,s,o){switch(t.calls++,s){case 4:t.triangles+=o*(i/3);break;case 1:t.lines+=o*(i/2);break;case 3:t.lines+=o*(i-1);break;case 2:t.lines+=o*i;break;case 0:t.points+=o*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function n(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:n,update:r}}function EI(a,e){return a[0]-e[0]}function CI(a,e){return Math.abs(e[1])-Math.abs(a[1])}function AI(a){const e={},t=new Float32Array(8),r=[];for(let i=0;i<8;i++)r[i]=[i,0];function n(i,s,o,l){const c=i.morphTargetInfluences,f=c===void 0?0:c.length;let d=e[s.id];if(d===void 0||d.length!==f){d=[];for(let S=0;S<f;S++)d[S]=[S,0];e[s.id]=d}for(let S=0;S<f;S++){const _=d[S];_[0]=S,_[1]=c[S]}d.sort(CI);for(let S=0;S<8;S++)S<f&&d[S][1]?(r[S][0]=d[S][0],r[S][1]=d[S][1]):(r[S][0]=Number.MAX_SAFE_INTEGER,r[S][1]=0);r.sort(EI);const p=s.morphAttributes.position,m=s.morphAttributes.normal;let v=0;for(let S=0;S<8;S++){const _=r[S],x=_[0],b=_[1];x!==Number.MAX_SAFE_INTEGER&&b?(p&&s.getAttribute("morphTarget"+S)!==p[x]&&s.setAttribute("morphTarget"+S,p[x]),m&&s.getAttribute("morphNormal"+S)!==m[x]&&s.setAttribute("morphNormal"+S,m[x]),t[S]=b,v+=b):(p&&s.hasAttribute("morphTarget"+S)===!0&&s.deleteAttribute("morphTarget"+S),m&&s.hasAttribute("morphNormal"+S)===!0&&s.deleteAttribute("morphNormal"+S),t[S]=0)}const y=s.morphTargetsRelative?1:1-v;l.getUniforms().setValue(a,"morphTargetBaseInfluence",y),l.getUniforms().setValue(a,"morphTargetInfluences",t)}return{update:n}}function TI(a,e,t,r){let n=new WeakMap;function i(l){const c=r.render.frame,f=l.geometry,d=e.get(l,f);return n.get(d)!==c&&(e.update(d),n.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}function s(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:i,dispose:s}}class ox extends $n{constructor(e=null,t=1,r=1,n=1){super(null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=_n,this.minFilter=_n,this.wrapR=ur,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ox.prototype.isDataTexture2DArray=!0;class lx extends $n{constructor(e=null,t=1,r=1,n=1){super(null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=_n,this.minFilter=_n,this.wrapR=ur,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}lx.prototype.isDataTexture3D=!0;const cx=new $n,RI=new ox,LI=new lx,ux=new eh,F0=[],B0=[],z0=new Float32Array(16),V0=new Float32Array(9),U0=new Float32Array(4);function $o(a,e,t){const r=a[0];if(r<=0||r>0)return a;const n=e*t;let i=F0[n];if(i===void 0&&(i=new Float32Array(n),F0[n]=i),e!==0){r.toArray(i,0);for(let s=1,o=0;s!==e;++s)o+=t,a[s].toArray(i,o)}return i}function fr(a,e){if(a.length!==e.length)return!1;for(let t=0,r=a.length;t<r;t++)if(a[t]!==e[t])return!1;return!0}function rr(a,e){for(let t=0,r=e.length;t<r;t++)a[t]=e[t]}function fx(a,e){let t=B0[e];t===void 0&&(t=new Int32Array(e),B0[e]=t);for(let r=0;r!==e;++r)t[r]=a.allocateTextureUnit();return t}function PI(a,e){const t=this.cache;t[0]!==e&&(a.uniform1f(this.addr,e),t[0]=e)}function II(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fr(t,e))return;a.uniform2fv(this.addr,e),rr(t,e)}}function NI(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(a.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(fr(t,e))return;a.uniform3fv(this.addr,e),rr(t,e)}}function kI(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fr(t,e))return;a.uniform4fv(this.addr,e),rr(t,e)}}function OI(a,e){const t=this.cache,r=e.elements;if(r===void 0){if(fr(t,e))return;a.uniformMatrix2fv(this.addr,!1,e),rr(t,e)}else{if(fr(t,r))return;U0.set(r),a.uniformMatrix2fv(this.addr,!1,U0),rr(t,r)}}function DI(a,e){const t=this.cache,r=e.elements;if(r===void 0){if(fr(t,e))return;a.uniformMatrix3fv(this.addr,!1,e),rr(t,e)}else{if(fr(t,r))return;V0.set(r),a.uniformMatrix3fv(this.addr,!1,V0),rr(t,r)}}function FI(a,e){const t=this.cache,r=e.elements;if(r===void 0){if(fr(t,e))return;a.uniformMatrix4fv(this.addr,!1,e),rr(t,e)}else{if(fr(t,r))return;z0.set(r),a.uniformMatrix4fv(this.addr,!1,z0),rr(t,r)}}function BI(a,e){const t=this.cache;t[0]!==e&&(a.uniform1i(this.addr,e),t[0]=e)}function zI(a,e){const t=this.cache;fr(t,e)||(a.uniform2iv(this.addr,e),rr(t,e))}function VI(a,e){const t=this.cache;fr(t,e)||(a.uniform3iv(this.addr,e),rr(t,e))}function UI(a,e){const t=this.cache;fr(t,e)||(a.uniform4iv(this.addr,e),rr(t,e))}function GI(a,e){const t=this.cache;t[0]!==e&&(a.uniform1ui(this.addr,e),t[0]=e)}function HI(a,e){const t=this.cache;fr(t,e)||(a.uniform2uiv(this.addr,e),rr(t,e))}function WI(a,e){const t=this.cache;fr(t,e)||(a.uniform3uiv(this.addr,e),rr(t,e))}function XI(a,e){const t=this.cache;fr(t,e)||(a.uniform4uiv(this.addr,e),rr(t,e))}function YI(a,e,t){const r=this.cache,n=t.allocateTextureUnit();r[0]!==n&&(a.uniform1i(this.addr,n),r[0]=n),t.safeSetTexture2D(e||cx,n)}function $I(a,e,t){const r=this.cache,n=t.allocateTextureUnit();r[0]!==n&&(a.uniform1i(this.addr,n),r[0]=n),t.setTexture3D(e||LI,n)}function qI(a,e,t){const r=this.cache,n=t.allocateTextureUnit();r[0]!==n&&(a.uniform1i(this.addr,n),r[0]=n),t.safeSetTextureCube(e||ux,n)}function ZI(a,e,t){const r=this.cache,n=t.allocateTextureUnit();r[0]!==n&&(a.uniform1i(this.addr,n),r[0]=n),t.setTexture2DArray(e||RI,n)}function jI(a){switch(a){case 5126:return PI;case 35664:return II;case 35665:return NI;case 35666:return kI;case 35674:return OI;case 35675:return DI;case 35676:return FI;case 5124:case 35670:return BI;case 35667:case 35671:return zI;case 35668:case 35672:return VI;case 35669:case 35673:return UI;case 5125:return GI;case 36294:return HI;case 36295:return WI;case 36296:return XI;case 35678:case 36198:case 36298:case 36306:case 35682:return YI;case 35679:case 36299:case 36307:return $I;case 35680:case 36300:case 36308:case 36293:return qI;case 36289:case 36303:case 36311:case 36292:return ZI}}function KI(a,e){a.uniform1fv(this.addr,e)}function JI(a,e){const t=$o(e,this.size,2);a.uniform2fv(this.addr,t)}function QI(a,e){const t=$o(e,this.size,3);a.uniform3fv(this.addr,t)}function eN(a,e){const t=$o(e,this.size,4);a.uniform4fv(this.addr,t)}function tN(a,e){const t=$o(e,this.size,4);a.uniformMatrix2fv(this.addr,!1,t)}function nN(a,e){const t=$o(e,this.size,9);a.uniformMatrix3fv(this.addr,!1,t)}function rN(a,e){const t=$o(e,this.size,16);a.uniformMatrix4fv(this.addr,!1,t)}function iN(a,e){a.uniform1iv(this.addr,e)}function aN(a,e){a.uniform2iv(this.addr,e)}function sN(a,e){a.uniform3iv(this.addr,e)}function oN(a,e){a.uniform4iv(this.addr,e)}function lN(a,e){a.uniform1uiv(this.addr,e)}function cN(a,e){a.uniform2uiv(this.addr,e)}function uN(a,e){a.uniform3uiv(this.addr,e)}function fN(a,e){a.uniform4uiv(this.addr,e)}function hN(a,e,t){const r=e.length,n=fx(t,r);a.uniform1iv(this.addr,n);for(let i=0;i!==r;++i)t.safeSetTexture2D(e[i]||cx,n[i])}function dN(a,e,t){const r=e.length,n=fx(t,r);a.uniform1iv(this.addr,n);for(let i=0;i!==r;++i)t.safeSetTextureCube(e[i]||ux,n[i])}function pN(a){switch(a){case 5126:return KI;case 35664:return JI;case 35665:return QI;case 35666:return eN;case 35674:return tN;case 35675:return nN;case 35676:return rN;case 5124:case 35670:return iN;case 35667:case 35671:return aN;case 35668:case 35672:return sN;case 35669:case 35673:return oN;case 5125:return lN;case 36294:return cN;case 36295:return uN;case 36296:return fN;case 35678:case 36198:case 36298:case 36306:case 35682:return hN;case 35680:case 36300:case 36308:case 36293:return dN}}function mN(a,e,t){this.id=a,this.addr=t,this.cache=[],this.setValue=jI(e.type)}function hx(a,e,t){this.id=a,this.addr=t,this.cache=[],this.size=e.size,this.setValue=pN(e.type)}hx.prototype.updateCache=function(a){const e=this.cache;a instanceof Float32Array&&e.length!==a.length&&(this.cache=new Float32Array(a.length)),rr(e,a)};function dx(a){this.id=a,this.seq=[],this.map={}}dx.prototype.setValue=function(a,e,t){const r=this.seq;for(let n=0,i=r.length;n!==i;++n){const s=r[n];s.setValue(a,e[s.id],t)}};const rp=/(\w+)(\])?(\[|\.)?/g;function G0(a,e){a.seq.push(e),a.map[e.id]=e}function vN(a,e,t){const r=a.name,n=r.length;for(rp.lastIndex=0;;){const i=rp.exec(r),s=rp.lastIndex;let o=i[1];const l=i[2]==="]",c=i[3];if(l&&(o=o|0),c===void 0||c==="["&&s+2===n){G0(t,c===void 0?new mN(o,a,e):new hx(o,a,e));break}else{let d=t.map[o];d===void 0&&(d=new dx(o),G0(t,d)),t=d}}}function Ua(a,e){this.seq=[],this.map={};const t=a.getProgramParameter(e,35718);for(let r=0;r<t;++r){const n=a.getActiveUniform(e,r),i=a.getUniformLocation(e,n.name);vN(n,i,this)}}Ua.prototype.setValue=function(a,e,t,r){const n=this.map[e];n!==void 0&&n.setValue(a,t,r)};Ua.prototype.setOptional=function(a,e,t){const r=e[t];r!==void 0&&this.setValue(a,t,r)};Ua.upload=function(a,e,t,r){for(let n=0,i=e.length;n!==i;++n){const s=e[n],o=t[s.id];o.needsUpdate!==!1&&s.setValue(a,o.value,r)}};Ua.seqWithValue=function(a,e){const t=[];for(let r=0,n=a.length;r!==n;++r){const i=a[r];i.id in e&&t.push(i)}return t};function H0(a,e,t){const r=a.createShader(e);return a.shaderSource(r,t),a.compileShader(r),r}let gN=0;function _N(a){const e=a.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function px(a){switch(a){case Ar:return["Linear","( value )"];case Jf:return["sRGB","( value )"];case Sm:return["RGBE","( value )"];case Z1:return["RGBM","( value, 7.0 )"];case j1:return["RGBM","( value, 16.0 )"];case K1:return["RGBD","( value, 256.0 )"];case xm:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case a3:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}function W0(a,e,t){const r=a.getShaderParameter(e,35713),n=a.getShaderInfoLog(e).trim();if(r&&n==="")return"";const i=a.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+n+_N(i)}function uo(a,e){const t=px(e);return"vec4 "+a+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function yN(a,e){const t=px(e);return"vec4 "+a+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function xN(a,e){let t;switch(e){case iR:t="Linear";break;case aR:t="Reinhard";break;case sR:t="OptimizedCineon";break;case oR:t="ACESFilmic";break;case lR:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+a+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function SN(a){return[a.extensionDerivatives||a.envMapCubeUV||a.bumpMap||a.tangentSpaceNormalMap||a.clearcoatNormalMap||a.flatShading||a.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(a.extensionFragDepth||a.logarithmicDepthBuffer)&&a.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",a.extensionDrawBuffers&&a.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(a.extensionShaderTextureLOD||a.envMap||a.transmission>0)&&a.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter($l).join(`
`)}function wN(a){const e=[];for(const t in a){const r=a[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function bN(a,e){const t={},r=a.getProgramParameter(e,35721);for(let n=0;n<r;n++){const s=a.getActiveAttrib(e,n).name;t[s]=a.getAttribLocation(e,s)}return t}function $l(a){return a!==""}function X0(a,e){return a.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Y0(a,e){return a.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const MN=/^[ \t]*#include +<([\w\d./]+)>/gm;function Zp(a){return a.replace(MN,EN)}function EN(a,e){const t=Bt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return Zp(t)}const CN=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,AN=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function $0(a){return a.replace(AN,mx).replace(CN,TN)}function TN(a,e,t,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),mx(a,e,t,r)}function mx(a,e,t,r){let n="";for(let i=parseInt(e);i<parseInt(t);i++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return n}function q0(a){let e="precision "+a.precision+` float;
precision `+a.precision+" int;";return a.precision==="highp"?e+=`
#define HIGH_PRECISION`:a.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:a.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function RN(a){let e="SHADOWMAP_TYPE_BASIC";return a.shadowMapType===gm?e="SHADOWMAP_TYPE_PCF":a.shadowMapType===DT?e="SHADOWMAP_TYPE_PCF_SOFT":a.shadowMapType===Yl&&(e="SHADOWMAP_TYPE_VSM"),e}function LN(a){let e="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case qf:case Zf:e="ENVMAP_TYPE_CUBE";break;case jf:case _m:e="ENVMAP_TYPE_CUBE_UV";break}return e}function PN(a){let e="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case Zf:case _m:e="ENVMAP_MODE_REFRACTION";break}return e}function IN(a){let e="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case Yf:e="ENVMAP_BLENDING_MULTIPLY";break;case nR:e="ENVMAP_BLENDING_MIX";break;case rR:e="ENVMAP_BLENDING_ADD";break}return e}function NN(a,e,t,r){const n=a.getContext(),i=t.defines;let s=t.vertexShader,o=t.fragmentShader;const l=RN(t),c=LN(t),f=PN(t),d=IN(t),p=a.gammaFactor>0?a.gammaFactor:1,m=t.isWebGL2?"":SN(t),v=wN(i),y=n.createProgram();let S,_,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(S=[v].filter($l).join(`
`),S.length>0&&(S+=`
`),_=[m,v].filter($l).join(`
`),_.length>0&&(_+=`
`)):(S=[q0(t),"#define SHADER_NAME "+t.shaderName,v,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter($l).join(`
`),_=[m,q0(t),"#define SHADER_NAME "+t.shaderName,v,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+f:"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==xs?"#define TONE_MAPPING":"",t.toneMapping!==xs?Bt.tonemapping_pars_fragment:"",t.toneMapping!==xs?xN("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",Bt.encodings_pars_fragment,t.map?uo("mapTexelToLinear",t.mapEncoding):"",t.matcap?uo("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?uo("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?uo("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularTintMap?uo("specularTintMapTexelToLinear",t.specularTintMapEncoding):"",t.lightMap?uo("lightMapTexelToLinear",t.lightMapEncoding):"",yN("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter($l).join(`
`)),s=Zp(s),s=X0(s,t),s=Y0(s,t),o=Zp(o),o=X0(o,t),o=Y0(o,t),s=$0(s),o=$0(o),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,S=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+S,_=["#define varying in",t.glslVersion===_0?"":"out highp vec4 pc_fragColor;",t.glslVersion===_0?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const b=x+S+s,M=x+_+o,E=H0(n,35633,b),T=H0(n,35632,M);if(n.attachShader(y,E),n.attachShader(y,T),t.index0AttributeName!==void 0?n.bindAttribLocation(y,0,t.index0AttributeName):t.morphTargets===!0&&n.bindAttribLocation(y,0,"position"),n.linkProgram(y),a.debug.checkShaderErrors){const Y=n.getProgramInfoLog(y).trim(),$=n.getShaderInfoLog(E).trim(),W=n.getShaderInfoLog(T).trim();let j=!0,X=!0;if(n.getProgramParameter(y,35714)===!1){j=!1;const P=W0(n,E,"vertex"),N=W0(n,T,"fragment");console.error("THREE.WebGLProgram: shader error: ",n.getError(),"35715",n.getProgramParameter(y,35715),"gl.getProgramInfoLog",Y,P,N)}else Y!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Y):($===""||W==="")&&(X=!1);X&&(this.diagnostics={runnable:j,programLog:Y,vertexShader:{log:$,prefix:S},fragmentShader:{log:W,prefix:_}})}n.deleteShader(E),n.deleteShader(T);let R;this.getUniforms=function(){return R===void 0&&(R=new Ua(n,y)),R};let V;return this.getAttributes=function(){return V===void 0&&(V=bN(n,y)),V},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(y),this.program=void 0},this.name=t.shaderName,this.id=gN++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=E,this.fragmentShader=T,this}function kN(a,e,t,r,n,i,s){const o=[],l=n.isWebGL2,c=n.logarithmicDepthBuffer,f=n.floatVertexTextures,d=n.maxVertexUniforms,p=n.vertexTextures;let m=n.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},y=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function S(R){const Y=R.skeleton.bones;if(f)return 1024;{const W=Math.floor((d-20)/4),j=Math.min(W,Y.length);return j<Y.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Y.length+" bones. This GPU supports "+j+"."),0):j}}function _(R){let V;return R&&R.isTexture?V=R.encoding:R&&R.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),V=R.texture.encoding):V=Ar,V}function x(R,V,Y,$,W){const j=$.fog,X=R.isMeshStandardMaterial?$.environment:null,P=(R.isMeshStandardMaterial?t:e).get(R.envMap||X),N=v[R.type],I=W.isSkinnedMesh?S(W):0;R.precision!==null&&(m=n.getMaxPrecision(R.precision),m!==R.precision&&console.warn("THREE.WebGLProgram.getParameters:",R.precision,"not supported, using",m,"instead."));let G,ee;if(N){const pe=Ii[N];G=pe.vertexShader,ee=pe.fragmentShader}else G=R.vertexShader,ee=R.fragmentShader;const re=a.getRenderTarget();return{isWebGL2:l,shaderID:N,shaderName:R.type,vertexShader:G,fragmentShader:ee,defines:R.defines,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:m,instancing:W.isInstancedMesh===!0,instancingColor:W.isInstancedMesh===!0&&W.instanceColor!==null,supportsVertexTextures:p,outputEncoding:re!==null?_(re.texture):a.outputEncoding,map:!!R.map,mapEncoding:_(R.map),matcap:!!R.matcap,matcapEncoding:_(R.matcap),envMap:!!P,envMapMode:P&&P.mapping,envMapEncoding:_(P),envMapCubeUV:!!P&&(P.mapping===jf||P.mapping===_m),lightMap:!!R.lightMap,lightMapEncoding:_(R.lightMap),aoMap:!!R.aoMap,emissiveMap:!!R.emissiveMap,emissiveMapEncoding:_(R.emissiveMap),bumpMap:!!R.bumpMap,normalMap:!!R.normalMap,objectSpaceNormalMap:R.normalMapType===l3,tangentSpaceNormalMap:R.normalMapType===Wo,clearcoatMap:!!R.clearcoatMap,clearcoatRoughnessMap:!!R.clearcoatRoughnessMap,clearcoatNormalMap:!!R.clearcoatNormalMap,displacementMap:!!R.displacementMap,roughnessMap:!!R.roughnessMap,metalnessMap:!!R.metalnessMap,specularMap:!!R.specularMap,specularIntensityMap:!!R.specularIntensityMap,specularTintMap:!!R.specularTintMap,specularTintMapEncoding:_(R.specularTintMap),alphaMap:!!R.alphaMap,gradientMap:!!R.gradientMap,sheen:!!R.sheen,transmission:!!R.transmission,transmissionMap:!!R.transmissionMap,thicknessMap:!!R.thicknessMap,combine:R.combine,vertexTangents:!!R.normalMap&&!!W.geometry&&!!W.geometry.attributes.tangent,vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!W.geometry&&!!W.geometry.attributes.color&&W.geometry.attributes.color.itemSize===4,vertexUvs:!!R.map||!!R.bumpMap||!!R.normalMap||!!R.specularMap||!!R.alphaMap||!!R.emissiveMap||!!R.roughnessMap||!!R.metalnessMap||!!R.clearcoatMap||!!R.clearcoatRoughnessMap||!!R.clearcoatNormalMap||!!R.displacementMap||!!R.transmissionMap||!!R.thicknessMap||!!R.specularIntensityMap||!!R.specularTintMap,uvsVertexOnly:!(R.map||R.bumpMap||R.normalMap||R.specularMap||R.alphaMap||R.emissiveMap||R.roughnessMap||R.metalnessMap||R.clearcoatNormalMap||R.transmission||R.transmissionMap||R.thicknessMap||R.specularIntensityMap||R.specularTintMap)&&!!R.displacementMap,fog:!!j,useFog:R.fog,fogExp2:j&&j.isFogExp2,flatShading:!!R.flatShading,sizeAttenuation:R.sizeAttenuation,logarithmicDepthBuffer:c,skinning:W.isSkinnedMesh===!0&&I>0,maxBones:I,useVertexTexture:f,morphTargets:!!W.geometry&&!!W.geometry.morphAttributes.position,morphNormals:!!W.geometry&&!!W.geometry.morphAttributes.normal,numDirLights:V.directional.length,numPointLights:V.point.length,numSpotLights:V.spot.length,numRectAreaLights:V.rectArea.length,numHemiLights:V.hemi.length,numDirLightShadows:V.directionalShadowMap.length,numPointLightShadows:V.pointShadowMap.length,numSpotLightShadows:V.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:R.dithering,shadowMapEnabled:a.shadowMap.enabled&&Y.length>0,shadowMapType:a.shadowMap.type,toneMapping:R.toneMapped?a.toneMapping:xs,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:R.premultipliedAlpha,alphaTest:R.alphaTest,doubleSided:R.side===ws,flipSided:R.side===Tn,depthPacking:R.depthPacking!==void 0?R.depthPacking:!1,index0AttributeName:R.index0AttributeName,extensionDerivatives:R.extensions&&R.extensions.derivatives,extensionFragDepth:R.extensions&&R.extensions.fragDepth,extensionDrawBuffers:R.extensions&&R.extensions.drawBuffers,extensionShaderTextureLOD:R.extensions&&R.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:R.customProgramCacheKey()}}function b(R){const V=[];if(R.shaderID?V.push(R.shaderID):(V.push(R.fragmentShader),V.push(R.vertexShader)),R.defines!==void 0)for(const Y in R.defines)V.push(Y),V.push(R.defines[Y]);if(R.isRawShaderMaterial===!1){for(let Y=0;Y<y.length;Y++)V.push(R[y[Y]]);V.push(a.outputEncoding),V.push(a.gammaFactor)}return V.push(R.customProgramCacheKey),V.join()}function M(R){const V=v[R.type];let Y;if(V){const $=Ii[V];Y=bs.clone($.uniforms)}else Y=R.uniforms;return Y}function E(R,V){let Y;for(let $=0,W=o.length;$<W;$++){const j=o[$];if(j.cacheKey===V){Y=j,++Y.usedTimes;break}}return Y===void 0&&(Y=new NN(a,V,R,i),o.push(Y)),Y}function T(R){if(--R.usedTimes===0){const V=o.indexOf(R);o[V]=o[o.length-1],o.pop(),R.destroy()}}return{getParameters:x,getProgramCacheKey:b,getUniforms:M,acquireProgram:E,releaseProgram:T,programs:o}}function ON(){let a=new WeakMap;function e(i){let s=a.get(i);return s===void 0&&(s={},a.set(i,s)),s}function t(i){a.delete(i)}function r(i,s,o){a.get(i)[s]=o}function n(){a=new WeakMap}return{get:e,remove:t,update:r,dispose:n}}function DN(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.program!==e.program?a.program.id-e.program.id:a.material.id!==e.material.id?a.material.id-e.material.id:a.z!==e.z?a.z-e.z:a.id-e.id}function Z0(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.z!==e.z?e.z-a.z:a.id-e.id}function j0(a){const e=[];let t=0;const r=[],n=[],i=[],s={id:-1};function o(){t=0,r.length=0,n.length=0,i.length=0}function l(m,v,y,S,_,x){let b=e[t];const M=a.get(y);return b===void 0?(b={id:m.id,object:m,geometry:v,material:y,program:M.program||s,groupOrder:S,renderOrder:m.renderOrder,z:_,group:x},e[t]=b):(b.id=m.id,b.object=m,b.geometry=v,b.material=y,b.program=M.program||s,b.groupOrder=S,b.renderOrder=m.renderOrder,b.z=_,b.group=x),t++,b}function c(m,v,y,S,_,x){const b=l(m,v,y,S,_,x);y.transmission>0?n.push(b):y.transparent===!0?i.push(b):r.push(b)}function f(m,v,y,S,_,x){const b=l(m,v,y,S,_,x);y.transmission>0?n.unshift(b):y.transparent===!0?i.unshift(b):r.unshift(b)}function d(m,v){r.length>1&&r.sort(m||DN),n.length>1&&n.sort(v||Z0),i.length>1&&i.sort(v||Z0)}function p(){for(let m=t,v=e.length;m<v;m++){const y=e[m];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.program=null,y.group=null}}return{opaque:r,transmissive:n,transparent:i,init:o,push:c,unshift:f,finish:p,sort:d}}function FN(a){let e=new WeakMap;function t(n,i){let s;return e.has(n)===!1?(s=new j0(a),e.set(n,[s])):i>=e.get(n).length?(s=new j0(a),e.get(n).push(s)):s=e.get(n)[i],s}function r(){e=new WeakMap}return{get:t,dispose:r}}function BN(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new C,color:new nt};break;case"SpotLight":t={position:new C,direction:new C,color:new nt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new C,color:new nt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new C,skyColor:new nt,groundColor:new nt};break;case"RectAreaLight":t={color:new nt,position:new C,halfWidth:new C,halfHeight:new C};break}return a[e.id]=t,t}}}function zN(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pe,shadowCameraNear:1,shadowCameraFar:1e3};break}return a[e.id]=t,t}}}let VN=0;function UN(a,e){return(e.castShadow?1:0)-(a.castShadow?1:0)}function GN(a,e){const t=new BN,r=zN(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let f=0;f<9;f++)n.probe.push(new C);const i=new C,s=new Xe,o=new Xe;function l(f){let d=0,p=0,m=0;for(let R=0;R<9;R++)n.probe[R].set(0,0,0);let v=0,y=0,S=0,_=0,x=0,b=0,M=0,E=0;f.sort(UN);for(let R=0,V=f.length;R<V;R++){const Y=f[R],$=Y.color,W=Y.intensity,j=Y.distance,X=Y.shadow&&Y.shadow.map?Y.shadow.map.texture:null;if(Y.isAmbientLight)d+=$.r*W,p+=$.g*W,m+=$.b*W;else if(Y.isLightProbe)for(let P=0;P<9;P++)n.probe[P].addScaledVector(Y.sh.coefficients[P],W);else if(Y.isDirectionalLight){const P=t.get(Y);if(P.color.copy(Y.color).multiplyScalar(Y.intensity),Y.castShadow){const N=Y.shadow,I=r.get(Y);I.shadowBias=N.bias,I.shadowNormalBias=N.normalBias,I.shadowRadius=N.radius,I.shadowMapSize=N.mapSize,n.directionalShadow[v]=I,n.directionalShadowMap[v]=X,n.directionalShadowMatrix[v]=Y.shadow.matrix,b++}n.directional[v]=P,v++}else if(Y.isSpotLight){const P=t.get(Y);if(P.position.setFromMatrixPosition(Y.matrixWorld),P.color.copy($).multiplyScalar(W),P.distance=j,P.coneCos=Math.cos(Y.angle),P.penumbraCos=Math.cos(Y.angle*(1-Y.penumbra)),P.decay=Y.decay,Y.castShadow){const N=Y.shadow,I=r.get(Y);I.shadowBias=N.bias,I.shadowNormalBias=N.normalBias,I.shadowRadius=N.radius,I.shadowMapSize=N.mapSize,n.spotShadow[S]=I,n.spotShadowMap[S]=X,n.spotShadowMatrix[S]=Y.shadow.matrix,E++}n.spot[S]=P,S++}else if(Y.isRectAreaLight){const P=t.get(Y);P.color.copy($).multiplyScalar(W),P.halfWidth.set(Y.width*.5,0,0),P.halfHeight.set(0,Y.height*.5,0),n.rectArea[_]=P,_++}else if(Y.isPointLight){const P=t.get(Y);if(P.color.copy(Y.color).multiplyScalar(Y.intensity),P.distance=Y.distance,P.decay=Y.decay,Y.castShadow){const N=Y.shadow,I=r.get(Y);I.shadowBias=N.bias,I.shadowNormalBias=N.normalBias,I.shadowRadius=N.radius,I.shadowMapSize=N.mapSize,I.shadowCameraNear=N.camera.near,I.shadowCameraFar=N.camera.far,n.pointShadow[y]=I,n.pointShadowMap[y]=X,n.pointShadowMatrix[y]=Y.shadow.matrix,M++}n.point[y]=P,y++}else if(Y.isHemisphereLight){const P=t.get(Y);P.skyColor.copy(Y.color).multiplyScalar(W),P.groundColor.copy(Y.groundColor).multiplyScalar(W),n.hemi[x]=P,x++}}_>0&&(e.isWebGL2||a.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=it.LTC_FLOAT_1,n.rectAreaLTC2=it.LTC_FLOAT_2):a.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=it.LTC_HALF_1,n.rectAreaLTC2=it.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=m;const T=n.hash;(T.directionalLength!==v||T.pointLength!==y||T.spotLength!==S||T.rectAreaLength!==_||T.hemiLength!==x||T.numDirectionalShadows!==b||T.numPointShadows!==M||T.numSpotShadows!==E)&&(n.directional.length=v,n.spot.length=S,n.rectArea.length=_,n.point.length=y,n.hemi.length=x,n.directionalShadow.length=b,n.directionalShadowMap.length=b,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=E,n.spotShadowMap.length=E,n.directionalShadowMatrix.length=b,n.pointShadowMatrix.length=M,n.spotShadowMatrix.length=E,T.directionalLength=v,T.pointLength=y,T.spotLength=S,T.rectAreaLength=_,T.hemiLength=x,T.numDirectionalShadows=b,T.numPointShadows=M,T.numSpotShadows=E,n.version=VN++)}function c(f,d){let p=0,m=0,v=0,y=0,S=0;const _=d.matrixWorldInverse;for(let x=0,b=f.length;x<b;x++){const M=f[x];if(M.isDirectionalLight){const E=n.directional[p];E.direction.setFromMatrixPosition(M.matrixWorld),i.setFromMatrixPosition(M.target.matrixWorld),E.direction.sub(i),E.direction.transformDirection(_),p++}else if(M.isSpotLight){const E=n.spot[v];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(_),E.direction.setFromMatrixPosition(M.matrixWorld),i.setFromMatrixPosition(M.target.matrixWorld),E.direction.sub(i),E.direction.transformDirection(_),v++}else if(M.isRectAreaLight){const E=n.rectArea[y];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(_),o.identity(),s.copy(M.matrixWorld),s.premultiply(_),o.extractRotation(s),E.halfWidth.set(M.width*.5,0,0),E.halfHeight.set(0,M.height*.5,0),E.halfWidth.applyMatrix4(o),E.halfHeight.applyMatrix4(o),y++}else if(M.isPointLight){const E=n.point[m];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(_),m++}else if(M.isHemisphereLight){const E=n.hemi[S];E.direction.setFromMatrixPosition(M.matrixWorld),E.direction.transformDirection(_),E.direction.normalize(),S++}}}return{setup:l,setupView:c,state:n}}function K0(a,e){const t=new GN(a,e),r=[],n=[];function i(){r.length=0,n.length=0}function s(d){r.push(d)}function o(d){n.push(d)}function l(){t.setup(r)}function c(d){t.setupView(r,d)}return{init:i,state:{lightsArray:r,shadowsArray:n,lights:t},setupLights:l,setupLightsView:c,pushLight:s,pushShadow:o}}function HN(a,e){let t=new WeakMap;function r(i,s=0){let o;return t.has(i)===!1?(o=new K0(a,e),t.set(i,[o])):s>=t.get(i).length?(o=new K0(a,e),t.get(i).push(o)):o=t.get(i)[s],o}function n(){t=new WeakMap}return{get:r,dispose:n}}class vx extends qn{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=s3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}vx.prototype.isMeshDepthMaterial=!0;class gx extends qn{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new C,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}gx.prototype.isMeshDistanceMaterial=!0;var WN=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,XN=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function _x(a,e,t){let r=new th;const n=new Pe,i=new Pe,s=new Gt,o=new vx({depthPacking:o3}),l=new gx,c={},f=t.maxTextureSize,d={0:Tn,1:Ss,2:ws},p=new wi({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pe},radius:{value:4}},vertexShader:XN,fragmentShader:WN}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const v=new It;v.setAttribute("position",new mt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new Ut(v,p),S=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=gm,this.render=function(M,E,T){if(S.enabled===!1||S.autoUpdate===!1&&S.needsUpdate===!1||M.length===0)return;const R=a.getRenderTarget(),V=a.getActiveCubeFace(),Y=a.getActiveMipmapLevel(),$=a.state;$.setBlending(sa),$.buffers.color.setClear(1,1,1,1),$.buffers.depth.setTest(!0),$.setScissorTest(!1);for(let W=0,j=M.length;W<j;W++){const X=M[W],P=X.shadow;if(P===void 0){console.warn("THREE.WebGLShadowMap:",X,"has no shadow.");continue}if(P.autoUpdate===!1&&P.needsUpdate===!1)continue;n.copy(P.mapSize);const N=P.getFrameExtents();if(n.multiply(N),i.copy(P.mapSize),(n.x>f||n.y>f)&&(n.x>f&&(i.x=Math.floor(f/N.x),n.x=i.x*N.x,P.mapSize.x=i.x),n.y>f&&(i.y=Math.floor(f/N.y),n.y=i.y*N.y,P.mapSize.y=i.y)),P.map===null&&!P.isPointLightShadow&&this.type===Yl){const G={minFilter:qt,magFilter:qt,format:Mn};P.map=new Rn(n.x,n.y,G),P.map.texture.name=X.name+".shadowMap",P.mapPass=new Rn(n.x,n.y,G),P.camera.updateProjectionMatrix()}if(P.map===null){const G={minFilter:_n,magFilter:_n,format:Mn};P.map=new Rn(n.x,n.y,G),P.map.texture.name=X.name+".shadowMap",P.camera.updateProjectionMatrix()}a.setRenderTarget(P.map),a.clear();const I=P.getViewportCount();for(let G=0;G<I;G++){const ee=P.getViewport(G);s.set(i.x*ee.x,i.y*ee.y,i.x*ee.z,i.y*ee.w),$.viewport(s),P.updateMatrices(X,G),r=P.getFrustum(),b(E,T,P.camera,X,this.type)}!P.isPointLightShadow&&this.type===Yl&&_(P,T),P.needsUpdate=!1}S.needsUpdate=!1,a.setRenderTarget(R,V,Y)};function _(M,E){const T=e.update(y);p.uniforms.shadow_pass.value=M.map.texture,p.uniforms.resolution.value=M.mapSize,p.uniforms.radius.value=M.radius,a.setRenderTarget(M.mapPass),a.clear(),a.renderBufferDirect(E,null,T,p,y,null),m.uniforms.shadow_pass.value=M.mapPass.texture,m.uniforms.resolution.value=M.mapSize,m.uniforms.radius.value=M.radius,a.setRenderTarget(M.map),a.clear(),a.renderBufferDirect(E,null,T,m,y,null)}function x(M,E,T,R,V,Y,$){let W=null;const j=R.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(j!==void 0?W=j:W=R.isPointLight===!0?l:o,a.localClippingEnabled&&T.clipShadows===!0&&T.clippingPlanes.length!==0){const X=W.uuid,P=T.uuid;let N=c[X];N===void 0&&(N={},c[X]=N);let I=N[P];I===void 0&&(I=W.clone(),N[P]=I),W=I}return W.visible=T.visible,W.wireframe=T.wireframe,$===Yl?W.side=T.shadowSide!==null?T.shadowSide:T.side:W.side=T.shadowSide!==null?T.shadowSide:d[T.side],W.clipShadows=T.clipShadows,W.clippingPlanes=T.clippingPlanes,W.clipIntersection=T.clipIntersection,W.wireframeLinewidth=T.wireframeLinewidth,W.linewidth=T.linewidth,R.isPointLight===!0&&W.isMeshDistanceMaterial===!0&&(W.referencePosition.setFromMatrixPosition(R.matrixWorld),W.nearDistance=V,W.farDistance=Y),W}function b(M,E,T,R,V){if(M.visible===!1)return;if(M.layers.test(E.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&V===Yl)&&(!M.frustumCulled||r.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,M.matrixWorld);const W=e.update(M),j=M.material;if(Array.isArray(j)){const X=W.groups;for(let P=0,N=X.length;P<N;P++){const I=X[P],G=j[I.materialIndex];if(G&&G.visible){const ee=x(M,W,G,R,T.near,T.far,V);a.renderBufferDirect(T,null,W,ee,M,I)}}}else if(j.visible){const X=x(M,W,j,R,T.near,T.far,V);a.renderBufferDirect(T,null,W,X,M,null)}}const $=M.children;for(let W=0,j=$.length;W<j;W++)b($[W],E,T,R,V)}}function YN(a,e,t){const r=t.isWebGL2;function n(){let A=!1;const D=new Gt;let O=null;const te=new Gt(0,0,0,0);return{setMask:function(q){O!==q&&!A&&(a.colorMask(q,q,q,q),O=q)},setLocked:function(q){A=q},setClear:function(q,Ae,Re,$e,et){et===!0&&(q*=$e,Ae*=$e,Re*=$e),D.set(q,Ae,Re,$e),te.equals(D)===!1&&(a.clearColor(q,Ae,Re,$e),te.copy(D))},reset:function(){A=!1,O=null,te.set(-1,0,0,0)}}}function i(){let A=!1,D=null,O=null,te=null;return{setTest:function(q){q?Le(2929):Oe(2929)},setMask:function(q){D!==q&&!A&&(a.depthMask(q),D=q)},setFunc:function(q){if(O!==q){if(q)switch(q){case ZT:a.depthFunc(512);break;case jT:a.depthFunc(519);break;case KT:a.depthFunc(513);break;case kf:a.depthFunc(515);break;case JT:a.depthFunc(514);break;case QT:a.depthFunc(518);break;case eR:a.depthFunc(516);break;case tR:a.depthFunc(517);break;default:a.depthFunc(515)}else a.depthFunc(515);O=q}},setLocked:function(q){A=q},setClear:function(q){te!==q&&(a.clearDepth(q),te=q)},reset:function(){A=!1,D=null,O=null,te=null}}}function s(){let A=!1,D=null,O=null,te=null,q=null,Ae=null,Re=null,$e=null,et=null;return{setTest:function(Ze){A||(Ze?Le(2960):Oe(2960))},setMask:function(Ze){D!==Ze&&!A&&(a.stencilMask(Ze),D=Ze)},setFunc:function(Ze,yt,Xt){(O!==Ze||te!==yt||q!==Xt)&&(a.stencilFunc(Ze,yt,Xt),O=Ze,te=yt,q=Xt)},setOp:function(Ze,yt,Xt){(Ae!==Ze||Re!==yt||$e!==Xt)&&(a.stencilOp(Ze,yt,Xt),Ae=Ze,Re=yt,$e=Xt)},setLocked:function(Ze){A=Ze},setClear:function(Ze){et!==Ze&&(a.clearStencil(Ze),et=Ze)},reset:function(){A=!1,D=null,O=null,te=null,q=null,Ae=null,Re=null,$e=null,et=null}}}const o=new n,l=new i,c=new s;let f={},d=null,p={},m=null,v=!1,y=null,S=null,_=null,x=null,b=null,M=null,E=null,T=!1,R=null,V=null,Y=null,$=null,W=null;const j=a.getParameter(35661);let X=!1,P=0;const N=a.getParameter(7938);N.indexOf("WebGL")!==-1?(P=parseFloat(/^WebGL (\d)/.exec(N)[1]),X=P>=1):N.indexOf("OpenGL ES")!==-1&&(P=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),X=P>=2);let I=null,G={};const ee=a.getParameter(3088),re=a.getParameter(2978),he=new Gt().fromArray(ee),pe=new Gt().fromArray(re);function Ie(A,D,O){const te=new Uint8Array(4),q=a.createTexture();a.bindTexture(A,q),a.texParameteri(A,10241,9728),a.texParameteri(A,10240,9728);for(let Ae=0;Ae<O;Ae++)a.texImage2D(D+Ae,0,6408,1,1,0,6408,5121,te);return q}const De={};De[3553]=Ie(3553,3553,1),De[34067]=Ie(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Le(2929),l.setFunc(kf),ge(!1),se(e0),Le(2884),Te(sa);function Le(A){f[A]!==!0&&(a.enable(A),f[A]=!0)}function Oe(A){f[A]!==!1&&(a.disable(A),f[A]=!1)}function ne(A){A!==d&&(a.bindFramebuffer(36160,A),d=A)}function at(A,D){return D===null&&d!==null&&(D=d),p[A]!==D?(a.bindFramebuffer(A,D),p[A]=D,r&&(A===36009&&(p[36160]=D),A===36160&&(p[36009]=D)),!0):!1}function Ge(A){return m!==A?(a.useProgram(A),m=A,!0):!1}const We={[Ro]:32774,[BT]:32778,[zT]:32779};if(r)We[i0]=32775,We[a0]=32776;else{const A=e.get("EXT_blend_minmax");A!==null&&(We[i0]=A.MIN_EXT,We[a0]=A.MAX_EXT)}const Ve={[VT]:0,[UT]:1,[GT]:768,[X1]:770,[qT]:776,[YT]:774,[WT]:772,[HT]:769,[Y1]:771,[$T]:775,[XT]:773};function Te(A,D,O,te,q,Ae,Re,$e){if(A===sa){v===!0&&(Oe(3042),v=!1);return}if(v===!1&&(Le(3042),v=!0),A!==FT){if(A!==y||$e!==T){if((S!==Ro||b!==Ro)&&(a.blendEquation(32774),S=Ro,b=Ro),$e)switch(A){case ql:a.blendFuncSeparate(1,771,1,771);break;case t0:a.blendFunc(1,1);break;case n0:a.blendFuncSeparate(0,0,769,771);break;case r0:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",A);break}else switch(A){case ql:a.blendFuncSeparate(770,771,1,771);break;case t0:a.blendFunc(770,1);break;case n0:a.blendFunc(0,769);break;case r0:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",A);break}_=null,x=null,M=null,E=null,y=A,T=$e}return}q=q||D,Ae=Ae||O,Re=Re||te,(D!==S||q!==b)&&(a.blendEquationSeparate(We[D],We[q]),S=D,b=q),(O!==_||te!==x||Ae!==M||Re!==E)&&(a.blendFuncSeparate(Ve[O],Ve[te],Ve[Ae],Ve[Re]),_=O,x=te,M=Ae,E=Re),y=A,T=null}function me(A,D){A.side===ws?Oe(2884):Le(2884);let O=A.side===Tn;D&&(O=!O),ge(O),A.blending===ql&&A.transparent===!1?Te(sa):Te(A.blending,A.blendEquation,A.blendSrc,A.blendDst,A.blendEquationAlpha,A.blendSrcAlpha,A.blendDstAlpha,A.premultipliedAlpha),l.setFunc(A.depthFunc),l.setTest(A.depthTest),l.setMask(A.depthWrite),o.setMask(A.colorWrite);const te=A.stencilWrite;c.setTest(te),te&&(c.setMask(A.stencilWriteMask),c.setFunc(A.stencilFunc,A.stencilRef,A.stencilFuncMask),c.setOp(A.stencilFail,A.stencilZFail,A.stencilZPass)),Ee(A.polygonOffset,A.polygonOffsetFactor,A.polygonOffsetUnits),A.alphaToCoverage===!0?Le(32926):Oe(32926)}function ge(A){R!==A&&(A?a.frontFace(2304):a.frontFace(2305),R=A)}function se(A){A!==kT?(Le(2884),A!==V&&(A===e0?a.cullFace(1029):A===OT?a.cullFace(1028):a.cullFace(1032))):Oe(2884),V=A}function we(A){A!==Y&&(X&&a.lineWidth(A),Y=A)}function Ee(A,D,O){A?(Le(32823),($!==D||W!==O)&&(a.polygonOffset(D,O),$=D,W=O)):Oe(32823)}function z(A){A?Le(3089):Oe(3089)}function F(A){A===void 0&&(A=33984+j-1),I!==A&&(a.activeTexture(A),I=A)}function ue(A,D){I===null&&F();let O=G[I];O===void 0&&(O={type:void 0,texture:void 0},G[I]=O),(O.type!==A||O.texture!==D)&&(a.bindTexture(A,D||De[A]),O.type=A,O.texture=D)}function be(){const A=G[I];A!==void 0&&A.type!==void 0&&(a.bindTexture(A.type,null),A.type=void 0,A.texture=void 0)}function Fe(){try{a.compressedTexImage2D.apply(a,arguments)}catch(A){console.error("THREE.WebGLState:",A)}}function He(){try{a.texImage2D.apply(a,arguments)}catch(A){console.error("THREE.WebGLState:",A)}}function rt(){try{a.texImage3D.apply(a,arguments)}catch(A){console.error("THREE.WebGLState:",A)}}function Ke(A){he.equals(A)===!1&&(a.scissor(A.x,A.y,A.z,A.w),he.copy(A))}function je(A){pe.equals(A)===!1&&(a.viewport(A.x,A.y,A.z,A.w),pe.copy(A))}function Je(){a.disable(3042),a.disable(2884),a.disable(2929),a.disable(32823),a.disable(3089),a.disable(2960),a.disable(32926),a.blendEquation(32774),a.blendFunc(1,0),a.blendFuncSeparate(1,0,1,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(513),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(519,0,4294967295),a.stencilOp(7680,7680,7680),a.clearStencil(0),a.cullFace(1029),a.frontFace(2305),a.polygonOffset(0,0),a.activeTexture(33984),a.bindFramebuffer(36160,null),r===!0&&(a.bindFramebuffer(36009,null),a.bindFramebuffer(36008,null)),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),f={},I=null,G={},d=null,p={},m=null,v=!1,y=null,S=null,_=null,x=null,b=null,M=null,E=null,T=!1,R=null,V=null,Y=null,$=null,W=null,he.set(0,0,a.canvas.width,a.canvas.height),pe.set(0,0,a.canvas.width,a.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:Le,disable:Oe,bindFramebuffer:at,bindXRFramebuffer:ne,useProgram:Ge,setBlending:Te,setMaterial:me,setFlipSided:ge,setCullFace:se,setLineWidth:we,setPolygonOffset:Ee,setScissorTest:z,activeTexture:F,bindTexture:ue,unbindTexture:be,compressedTexImage2D:Fe,texImage2D:He,texImage3D:rt,scissor:Ke,viewport:je,reset:Je}}function $N(a,e,t,r,n,i,s){const o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,f=n.maxTextureSize,d=n.maxSamples,p=new WeakMap;let m,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(z,F){return v?new OffscreenCanvas(z,F):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function S(z,F,ue,be){let Fe=1;if((z.width>be||z.height>be)&&(Fe=be/Math.max(z.width,z.height)),Fe<1||F===!0)if(typeof HTMLImageElement<"u"&&z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&z instanceof ImageBitmap){const He=F?J1:Math.floor,rt=He(Fe*z.width),Ke=He(Fe*z.height);m===void 0&&(m=y(rt,Ke));const je=ue?y(rt,Ke):m;return je.width=rt,je.height=Ke,je.getContext("2d").drawImage(z,0,0,rt,Ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+z.width+"x"+z.height+") to ("+rt+"x"+Ke+")."),je}else return"data"in z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+z.width+"x"+z.height+")."),z;return z}function _(z){return qp(z.width)&&qp(z.height)}function x(z){return o?!1:z.wrapS!==ur||z.wrapT!==ur||z.minFilter!==_n&&z.minFilter!==qt}function b(z,F){return z.generateMipmaps&&F&&z.minFilter!==_n&&z.minFilter!==qt}function M(z,F,ue,be,Fe=1){a.generateMipmap(z);const He=r.get(F);He.__maxMipLevel=Math.log2(Math.max(ue,be,Fe))}function E(z,F,ue){if(o===!1)return F;if(z!==null){if(a[z]!==void 0)return a[z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+z+"'")}let be=F;return F===6403&&(ue===5126&&(be=33326),ue===5131&&(be=33325),ue===5121&&(be=33321)),F===6407&&(ue===5126&&(be=34837),ue===5131&&(be=34843),ue===5121&&(be=32849)),F===6408&&(ue===5126&&(be=34836),ue===5131&&(be=34842),ue===5121&&(be=32856)),(be===33325||be===33326||be===34842||be===34836)&&e.get("EXT_color_buffer_float"),be}function T(z){return z===_n||z===s0||z===o0?9728:9729}function R(z){const F=z.target;F.removeEventListener("dispose",R),Y(F),F.isVideoTexture&&p.delete(F),s.memory.textures--}function V(z){const F=z.target;F.removeEventListener("dispose",V),$(F)}function Y(z){const F=r.get(z);F.__webglInit!==void 0&&(a.deleteTexture(F.__webglTexture),r.remove(z))}function $(z){const F=z.texture,ue=r.get(z),be=r.get(F);if(z){if(be.__webglTexture!==void 0&&(a.deleteTexture(be.__webglTexture),s.memory.textures--),z.depthTexture&&z.depthTexture.dispose(),z.isWebGLCubeRenderTarget)for(let Fe=0;Fe<6;Fe++)a.deleteFramebuffer(ue.__webglFramebuffer[Fe]),ue.__webglDepthbuffer&&a.deleteRenderbuffer(ue.__webglDepthbuffer[Fe]);else a.deleteFramebuffer(ue.__webglFramebuffer),ue.__webglDepthbuffer&&a.deleteRenderbuffer(ue.__webglDepthbuffer),ue.__webglMultisampledFramebuffer&&a.deleteFramebuffer(ue.__webglMultisampledFramebuffer),ue.__webglColorRenderbuffer&&a.deleteRenderbuffer(ue.__webglColorRenderbuffer),ue.__webglDepthRenderbuffer&&a.deleteRenderbuffer(ue.__webglDepthRenderbuffer);if(z.isWebGLMultipleRenderTargets)for(let Fe=0,He=F.length;Fe<He;Fe++){const rt=r.get(F[Fe]);rt.__webglTexture&&(a.deleteTexture(rt.__webglTexture),s.memory.textures--),r.remove(F[Fe])}r.remove(F),r.remove(z)}}let W=0;function j(){W=0}function X(){const z=W;return z>=l&&console.warn("THREE.WebGLTextures: Trying to use "+z+" texture units while this GPU supports only "+l),W+=1,z}function P(z,F){const ue=r.get(z);if(z.isVideoTexture&&me(z),z.version>0&&ue.__version!==z.version){const be=z.image;if(be===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(be.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ie(ue,z,F);return}}t.activeTexture(33984+F),t.bindTexture(3553,ue.__webglTexture)}function N(z,F){const ue=r.get(z);if(z.version>0&&ue.__version!==z.version){Ie(ue,z,F);return}t.activeTexture(33984+F),t.bindTexture(35866,ue.__webglTexture)}function I(z,F){const ue=r.get(z);if(z.version>0&&ue.__version!==z.version){Ie(ue,z,F);return}t.activeTexture(33984+F),t.bindTexture(32879,ue.__webglTexture)}function G(z,F){const ue=r.get(z);if(z.version>0&&ue.__version!==z.version){De(ue,z,F);return}t.activeTexture(33984+F),t.bindTexture(34067,ue.__webglTexture)}const ee={[ec]:10497,[ur]:33071,[$p]:33648},re={[_n]:9728,[s0]:9984,[o0]:9986,[qt]:9729,[cR]:9985,[Kf]:9987};function he(z,F,ue){if(ue?(a.texParameteri(z,10242,ee[F.wrapS]),a.texParameteri(z,10243,ee[F.wrapT]),(z===32879||z===35866)&&a.texParameteri(z,32882,ee[F.wrapR]),a.texParameteri(z,10240,re[F.magFilter]),a.texParameteri(z,10241,re[F.minFilter])):(a.texParameteri(z,10242,33071),a.texParameteri(z,10243,33071),(z===32879||z===35866)&&a.texParameteri(z,32882,33071),(F.wrapS!==ur||F.wrapT!==ur)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(z,10240,T(F.magFilter)),a.texParameteri(z,10241,T(F.minFilter)),F.minFilter!==_n&&F.minFilter!==qt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const be=e.get("EXT_texture_filter_anisotropic");if(F.type===Ni&&e.has("OES_texture_float_linear")===!1||o===!1&&F.type===ko&&e.has("OES_texture_half_float_linear")===!1)return;(F.anisotropy>1||r.get(F).__currentAnisotropy)&&(a.texParameterf(z,be.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,n.getMaxAnisotropy())),r.get(F).__currentAnisotropy=F.anisotropy)}}function pe(z,F){z.__webglInit===void 0&&(z.__webglInit=!0,F.addEventListener("dispose",R),z.__webglTexture=a.createTexture(),s.memory.textures++)}function Ie(z,F,ue){let be=3553;F.isDataTexture2DArray&&(be=35866),F.isDataTexture3D&&(be=32879),pe(z,F),t.activeTexture(33984+ue),t.bindTexture(be,z.__webglTexture),a.pixelStorei(37440,F.flipY),a.pixelStorei(37441,F.premultiplyAlpha),a.pixelStorei(3317,F.unpackAlignment),a.pixelStorei(37443,0);const Fe=x(F)&&_(F.image)===!1,He=S(F.image,Fe,!1,f),rt=_(He)||o,Ke=i.convert(F.format);let je=i.convert(F.type),Je=E(F.internalFormat,Ke,je);he(be,F,rt);let A;const D=F.mipmaps;if(F.isDepthTexture)Je=6402,o?F.type===Ni?Je=36012:F.type===Tf?Je=33190:F.type===Zl?Je=35056:Je=33189:F.type===Ni&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),F.format===Oo&&Je===6402&&F.type!==tc&&F.type!==Tf&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),F.type=tc,je=i.convert(F.type)),F.format===nc&&Je===6402&&(Je=34041,F.type!==Zl&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),F.type=Zl,je=i.convert(F.type))),t.texImage2D(3553,0,Je,He.width,He.height,0,Ke,je,null);else if(F.isDataTexture)if(D.length>0&&rt){for(let O=0,te=D.length;O<te;O++)A=D[O],t.texImage2D(3553,O,Je,A.width,A.height,0,Ke,je,A.data);F.generateMipmaps=!1,z.__maxMipLevel=D.length-1}else t.texImage2D(3553,0,Je,He.width,He.height,0,Ke,je,He.data),z.__maxMipLevel=0;else if(F.isCompressedTexture){for(let O=0,te=D.length;O<te;O++)A=D[O],F.format!==Mn&&F.format!==za?Ke!==null?t.compressedTexImage2D(3553,O,Je,A.width,A.height,0,A.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,O,Je,A.width,A.height,0,Ke,je,A.data);z.__maxMipLevel=D.length-1}else if(F.isDataTexture2DArray)t.texImage3D(35866,0,Je,He.width,He.height,He.depth,0,Ke,je,He.data),z.__maxMipLevel=0;else if(F.isDataTexture3D)t.texImage3D(32879,0,Je,He.width,He.height,He.depth,0,Ke,je,He.data),z.__maxMipLevel=0;else if(D.length>0&&rt){for(let O=0,te=D.length;O<te;O++)A=D[O],t.texImage2D(3553,O,Je,Ke,je,A);F.generateMipmaps=!1,z.__maxMipLevel=D.length-1}else t.texImage2D(3553,0,Je,Ke,je,He),z.__maxMipLevel=0;b(F,rt)&&M(be,F,He.width,He.height),z.__version=F.version,F.onUpdate&&F.onUpdate(F)}function De(z,F,ue){if(F.image.length!==6)return;pe(z,F),t.activeTexture(33984+ue),t.bindTexture(34067,z.__webglTexture),a.pixelStorei(37440,F.flipY),a.pixelStorei(37441,F.premultiplyAlpha),a.pixelStorei(3317,F.unpackAlignment),a.pixelStorei(37443,0);const be=F&&(F.isCompressedTexture||F.image[0].isCompressedTexture),Fe=F.image[0]&&F.image[0].isDataTexture,He=[];for(let O=0;O<6;O++)!be&&!Fe?He[O]=S(F.image[O],!1,!0,c):He[O]=Fe?F.image[O].image:F.image[O];const rt=He[0],Ke=_(rt)||o,je=i.convert(F.format),Je=i.convert(F.type),A=E(F.internalFormat,je,Je);he(34067,F,Ke);let D;if(be){for(let O=0;O<6;O++){D=He[O].mipmaps;for(let te=0;te<D.length;te++){const q=D[te];F.format!==Mn&&F.format!==za?je!==null?t.compressedTexImage2D(34069+O,te,A,q.width,q.height,0,q.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+O,te,A,q.width,q.height,0,je,Je,q.data)}}z.__maxMipLevel=D.length-1}else{D=F.mipmaps;for(let O=0;O<6;O++)if(Fe){t.texImage2D(34069+O,0,A,He[O].width,He[O].height,0,je,Je,He[O].data);for(let te=0;te<D.length;te++){const Ae=D[te].image[O].image;t.texImage2D(34069+O,te+1,A,Ae.width,Ae.height,0,je,Je,Ae.data)}}else{t.texImage2D(34069+O,0,A,je,Je,He[O]);for(let te=0;te<D.length;te++){const q=D[te];t.texImage2D(34069+O,te+1,A,je,Je,q.image[O])}}z.__maxMipLevel=D.length}b(F,Ke)&&M(34067,F,rt.width,rt.height),z.__version=F.version,F.onUpdate&&F.onUpdate(F)}function Le(z,F,ue,be,Fe){const He=i.convert(ue.format),rt=i.convert(ue.type),Ke=E(ue.internalFormat,He,rt);Fe===32879||Fe===35866?t.texImage3D(Fe,0,Ke,F.width,F.height,F.depth,0,He,rt,null):t.texImage2D(Fe,0,Ke,F.width,F.height,0,He,rt,null),t.bindFramebuffer(36160,z),a.framebufferTexture2D(36160,be,Fe,r.get(ue).__webglTexture,0),t.bindFramebuffer(36160,null)}function Oe(z,F,ue){if(a.bindRenderbuffer(36161,z),F.depthBuffer&&!F.stencilBuffer){let be=33189;if(ue){const Fe=F.depthTexture;Fe&&Fe.isDepthTexture&&(Fe.type===Ni?be=36012:Fe.type===Tf&&(be=33190));const He=Te(F);a.renderbufferStorageMultisample(36161,He,be,F.width,F.height)}else a.renderbufferStorage(36161,be,F.width,F.height);a.framebufferRenderbuffer(36160,36096,36161,z)}else if(F.depthBuffer&&F.stencilBuffer){if(ue){const be=Te(F);a.renderbufferStorageMultisample(36161,be,35056,F.width,F.height)}else a.renderbufferStorage(36161,34041,F.width,F.height);a.framebufferRenderbuffer(36160,33306,36161,z)}else{const be=F.isWebGLMultipleRenderTargets===!0?F.texture[0]:F.texture,Fe=i.convert(be.format),He=i.convert(be.type),rt=E(be.internalFormat,Fe,He);if(ue){const Ke=Te(F);a.renderbufferStorageMultisample(36161,Ke,rt,F.width,F.height)}else a.renderbufferStorage(36161,rt,F.width,F.height)}a.bindRenderbuffer(36161,null)}function ne(z,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,z),!(F.depthTexture&&F.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),P(F.depthTexture,0);const be=r.get(F.depthTexture).__webglTexture;if(F.depthTexture.format===Oo)a.framebufferTexture2D(36160,36096,3553,be,0);else if(F.depthTexture.format===nc)a.framebufferTexture2D(36160,33306,3553,be,0);else throw new Error("Unknown depthTexture format")}function at(z){const F=r.get(z),ue=z.isWebGLCubeRenderTarget===!0;if(z.depthTexture){if(ue)throw new Error("target.depthTexture not supported in Cube render targets");ne(F.__webglFramebuffer,z)}else if(ue){F.__webglDepthbuffer=[];for(let be=0;be<6;be++)t.bindFramebuffer(36160,F.__webglFramebuffer[be]),F.__webglDepthbuffer[be]=a.createRenderbuffer(),Oe(F.__webglDepthbuffer[be],z,!1)}else t.bindFramebuffer(36160,F.__webglFramebuffer),F.__webglDepthbuffer=a.createRenderbuffer(),Oe(F.__webglDepthbuffer,z,!1);t.bindFramebuffer(36160,null)}function Ge(z){const F=z.texture,ue=r.get(z),be=r.get(F);z.addEventListener("dispose",V),z.isWebGLMultipleRenderTargets!==!0&&(be.__webglTexture=a.createTexture(),be.__version=F.version,s.memory.textures++);const Fe=z.isWebGLCubeRenderTarget===!0,He=z.isWebGLMultipleRenderTargets===!0,rt=z.isWebGLMultisampleRenderTarget===!0,Ke=F.isDataTexture3D||F.isDataTexture2DArray,je=_(z)||o;if(o&&F.format===za&&(F.type===Ni||F.type===ko)&&(F.format=Mn,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Fe){ue.__webglFramebuffer=[];for(let Je=0;Je<6;Je++)ue.__webglFramebuffer[Je]=a.createFramebuffer()}else if(ue.__webglFramebuffer=a.createFramebuffer(),He)if(n.drawBuffers){const Je=z.texture;for(let A=0,D=Je.length;A<D;A++){const O=r.get(Je[A]);O.__webglTexture===void 0&&(O.__webglTexture=a.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(rt)if(o){ue.__webglMultisampledFramebuffer=a.createFramebuffer(),ue.__webglColorRenderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,ue.__webglColorRenderbuffer);const Je=i.convert(F.format),A=i.convert(F.type),D=E(F.internalFormat,Je,A),O=Te(z);a.renderbufferStorageMultisample(36161,O,D,z.width,z.height),t.bindFramebuffer(36160,ue.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064,36161,ue.__webglColorRenderbuffer),a.bindRenderbuffer(36161,null),z.depthBuffer&&(ue.__webglDepthRenderbuffer=a.createRenderbuffer(),Oe(ue.__webglDepthRenderbuffer,z,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Fe){t.bindTexture(34067,be.__webglTexture),he(34067,F,je);for(let Je=0;Je<6;Je++)Le(ue.__webglFramebuffer[Je],z,F,36064,34069+Je);b(F,je)&&M(34067,F,z.width,z.height),t.bindTexture(34067,null)}else if(He){const Je=z.texture;for(let A=0,D=Je.length;A<D;A++){const O=Je[A],te=r.get(O);t.bindTexture(3553,te.__webglTexture),he(3553,O,je),Le(ue.__webglFramebuffer,z,O,36064+A,3553),b(O,je)&&M(3553,O,z.width,z.height)}t.bindTexture(3553,null)}else{let Je=3553;Ke&&(o?Je=F.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(Je,be.__webglTexture),he(Je,F,je),Le(ue.__webglFramebuffer,z,F,36064,Je),b(F,je)&&M(Je,F,z.width,z.height,z.depth),t.bindTexture(Je,null)}z.depthBuffer&&at(z)}function We(z){const F=_(z)||o,ue=z.isWebGLMultipleRenderTargets===!0?z.texture:[z.texture];for(let be=0,Fe=ue.length;be<Fe;be++){const He=ue[be];if(b(He,F)){const rt=z.isWebGLCubeRenderTarget?34067:3553,Ke=r.get(He).__webglTexture;t.bindTexture(rt,Ke),M(rt,He,z.width,z.height),t.bindTexture(rt,null)}}}function Ve(z){if(z.isWebGLMultisampleRenderTarget)if(o){const F=z.width,ue=z.height;let be=16384;z.depthBuffer&&(be|=256),z.stencilBuffer&&(be|=1024);const Fe=r.get(z);t.bindFramebuffer(36008,Fe.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Fe.__webglFramebuffer),a.blitFramebuffer(0,0,F,ue,0,0,F,ue,be,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,Fe.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Te(z){return o&&z.isWebGLMultisampleRenderTarget?Math.min(d,z.samples):0}function me(z){const F=s.render.frame;p.get(z)!==F&&(p.set(z,F),z.update())}let ge=!1,se=!1;function we(z,F){z&&z.isWebGLRenderTarget&&(ge===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),ge=!0),z=z.texture),P(z,F)}function Ee(z,F){z&&z.isWebGLCubeRenderTarget&&(se===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),se=!0),z=z.texture),G(z,F)}this.allocateTextureUnit=X,this.resetTextureUnits=j,this.setTexture2D=P,this.setTexture2DArray=N,this.setTexture3D=I,this.setTextureCube=G,this.setupRenderTarget=Ge,this.updateRenderTargetMipmap=We,this.updateMultisampleRenderTarget=Ve,this.safeSetTexture2D=we,this.safeSetTextureCube=Ee}function qN(a,e,t){const r=t.isWebGL2;function n(i){let s;if(i===Ya)return 5121;if(i===dR)return 32819;if(i===pR)return 32820;if(i===mR)return 33635;if(i===uR)return 5120;if(i===fR)return 5122;if(i===tc)return 5123;if(i===hR)return 5124;if(i===Tf)return 5125;if(i===Ni)return 5126;if(i===ko)return r?5131:(s=e.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(i===vR)return 6406;if(i===za)return 6407;if(i===Mn)return 6408;if(i===$1)return 6409;if(i===gR)return 6410;if(i===Oo)return 6402;if(i===nc)return 34041;if(i===yR)return 6403;if(i===xR)return 36244;if(i===SR)return 33319;if(i===wR)return 33320;if(i===bR)return 36248;if(i===MR)return 36249;if(i===l0||i===c0||i===u0||i===f0)if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===l0)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===c0)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===u0)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===f0)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===h0||i===d0||i===p0||i===m0)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===h0)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===d0)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===p0)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===m0)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===ER)return s=e.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if((i===v0||i===g0)&&(s=e.get("WEBGL_compressed_texture_etc"),s!==null)){if(i===v0)return s.COMPRESSED_RGB8_ETC2;if(i===g0)return s.COMPRESSED_RGBA8_ETC2_EAC}if(i===CR||i===AR||i===TR||i===RR||i===LR||i===PR||i===IR||i===NR||i===kR||i===OR||i===DR||i===FR||i===BR||i===zR||i===UR||i===GR||i===HR||i===WR||i===XR||i===YR||i===$R||i===qR||i===ZR||i===jR||i===KR||i===JR||i===QR||i===e3)return s=e.get("WEBGL_compressed_texture_astc"),s!==null?i:null;if(i===VR)return s=e.get("EXT_texture_compression_bptc"),s!==null?i:null;if(i===Zl)return r?34042:(s=e.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:n}}class yx extends En{constructor(e=[]){super(),this.cameras=e}}yx.prototype.isArrayCamera=!0;class nr extends Dt{constructor(){super(),this.type="Group"}}nr.prototype.isGroup=!0;const ZN={type:"move"};class ip{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new nr,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new nr,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new C,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new C),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new nr,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new C,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new C),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let n=null,i=null,s=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(o!==null&&(n=t.getPose(e.targetRaySpace,r),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(ZN))),c&&e.hand){s=!0;for(const y of e.hand.values()){const S=t.getJointPose(y,r);if(c.joints[y.jointName]===void 0){const x=new nr;x.matrixAutoUpdate=!1,x.visible=!1,c.joints[y.jointName]=x,c.add(x)}const _=c.joints[y.jointName];S!==null&&(_.matrix.fromArray(S.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.jointRadius=S.radius),_.visible=S!==null}const f=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],p=f.position.distanceTo(d.position),m=.02,v=.005;c.inputState.pinching&&p>m+v?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&p<=m-v&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(i=t.getPose(e.gripSpace,r),i!==null&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1));return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=i!==null),c!==null&&(c.visible=s!==null),this}}class jN extends Cs{constructor(e,t){super();const r=this,n=e.state;let i=null,s=1,o=null,l="local-floor",c=null,f=null,d=null,p=null,m=null;const v=[],y=new Map,S=new En;S.layers.enable(1),S.viewport=new Gt;const _=new En;_.layers.enable(2),_.viewport=new Gt;const x=[S,_],b=new yx;b.layers.enable(1),b.layers.enable(2);let M=null,E=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(I){let G=v[I];return G===void 0&&(G=new ip,v[I]=G),G.getTargetRaySpace()},this.getControllerGrip=function(I){let G=v[I];return G===void 0&&(G=new ip,v[I]=G),G.getGripSpace()},this.getHand=function(I){let G=v[I];return G===void 0&&(G=new ip,v[I]=G),G.getHandSpace()};function T(I){const G=y.get(I.inputSource);G&&G.dispatchEvent({type:I.type,data:I.inputSource})}function R(){y.forEach(function(I,G){I.disconnect(G)}),y.clear(),M=null,E=null,n.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),N.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(I){s=I,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(I){l=I,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=async function(I){if(i=I,i!==null){i.addEventListener("select",T),i.addEventListener("selectstart",T),i.addEventListener("selectend",T),i.addEventListener("squeeze",T),i.addEventListener("squeezestart",T),i.addEventListener("squeezeend",T),i.addEventListener("end",R),i.addEventListener("inputsourceschange",V);const G=t.getContextAttributes();if(G.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0){const ee={antialias:G.antialias,alpha:G.alpha,depth:G.depth,stencil:G.stencil,framebufferScaleFactor:s};m=new XRWebGLLayer(i,t,ee),i.updateRenderState({baseLayer:m})}else{let ee=0;if(G.antialias){const re={antialias:!0,alpha:G.alpha,depth:G.depth,stencil:G.stencil,framebufferScaleFactor:s};m=new XRWebGLLayer(i,t,re),i.updateRenderState({layers:[m]})}else{G.depth&&(ee=G.stencil?34041:6402);const re={colorFormat:G.alpha?6408:6407,depthFormat:ee,scaleFactor:s};f=new XRWebGLBinding(i,t),p=f.createProjectionLayer(re),d=t.createFramebuffer(),i.updateRenderState({layers:[p]})}}o=await i.requestReferenceSpace(l),N.setContext(i),N.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};function V(I){const G=i.inputSources;for(let ee=0;ee<v.length;ee++)y.set(G[ee],v[ee]);for(let ee=0;ee<I.removed.length;ee++){const re=I.removed[ee],he=y.get(re);he&&(he.dispatchEvent({type:"disconnected",data:re}),y.delete(re))}for(let ee=0;ee<I.added.length;ee++){const re=I.added[ee],he=y.get(re);he&&he.dispatchEvent({type:"connected",data:re})}}const Y=new C,$=new C;function W(I,G,ee){Y.setFromMatrixPosition(G.matrixWorld),$.setFromMatrixPosition(ee.matrixWorld);const re=Y.distanceTo($),he=G.projectionMatrix.elements,pe=ee.projectionMatrix.elements,Ie=he[14]/(he[10]-1),De=he[14]/(he[10]+1),Le=(he[9]+1)/he[5],Oe=(he[9]-1)/he[5],ne=(he[8]-1)/he[0],at=(pe[8]+1)/pe[0],Ge=Ie*ne,We=Ie*at,Ve=re/(-ne+at),Te=Ve*-ne;G.matrixWorld.decompose(I.position,I.quaternion,I.scale),I.translateX(Te),I.translateZ(Ve),I.matrixWorld.compose(I.position,I.quaternion,I.scale),I.matrixWorldInverse.copy(I.matrixWorld).invert();const me=Ie+Ve,ge=De+Ve,se=Ge-Te,we=We+(re-Te),Ee=Le*De/ge*me,z=Oe*De/ge*me;I.projectionMatrix.makePerspective(se,we,Ee,z,me,ge)}function j(I,G){G===null?I.matrixWorld.copy(I.matrix):I.matrixWorld.multiplyMatrices(G.matrixWorld,I.matrix),I.matrixWorldInverse.copy(I.matrixWorld).invert()}this.updateCamera=function(I){if(i===null)return;b.near=_.near=S.near=I.near,b.far=_.far=S.far=I.far,(M!==b.near||E!==b.far)&&(i.updateRenderState({depthNear:b.near,depthFar:b.far}),M=b.near,E=b.far);const G=I.parent,ee=b.cameras;j(b,G);for(let he=0;he<ee.length;he++)j(ee[he],G);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),I.position.copy(b.position),I.quaternion.copy(b.quaternion),I.scale.copy(b.scale),I.matrix.copy(b.matrix),I.matrixWorld.copy(b.matrixWorld);const re=I.children;for(let he=0,pe=re.length;he<pe;he++)re[he].updateMatrixWorld(!0);ee.length===2?W(b,S,_):b.projectionMatrix.copy(S.projectionMatrix)},this.getCamera=function(){return b},this.getFoveation=function(){if(p!==null)return p.fixedFoveation;if(m!==null)return m.fixedFoveation},this.setFoveation=function(I){p!==null&&(p.fixedFoveation=I),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=I)};let X=null;function P(I,G){if(c=G.getViewerPose(o),c!==null){const re=c.views;m!==null&&n.bindXRFramebuffer(m.framebuffer);let he=!1;re.length!==b.cameras.length&&(b.cameras.length=0,he=!0);for(let pe=0;pe<re.length;pe++){const Ie=re[pe];let De=null;if(m!==null)De=m.getViewport(Ie);else{const Oe=f.getViewSubImage(p,Ie);n.bindXRFramebuffer(d),Oe.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,36096,3553,Oe.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,Oe.colorTexture,0),De=Oe.viewport}const Le=x[pe];Le.matrix.fromArray(Ie.transform.matrix),Le.projectionMatrix.fromArray(Ie.projectionMatrix),Le.viewport.set(De.x,De.y,De.width,De.height),pe===0&&b.matrix.copy(Le.matrix),he===!0&&b.cameras.push(Le)}}const ee=i.inputSources;for(let re=0;re<v.length;re++){const he=v[re],pe=ee[re];he.update(pe,G,o)}X&&X(I,G)}const N=new ix;N.setAnimationLoop(P),this.setAnimationLoop=function(I){X=I},this.dispose=function(){}}}function KN(a){function e(_,x){_.fogColor.value.copy(x.color),x.isFog?(_.fogNear.value=x.near,_.fogFar.value=x.far):x.isFogExp2&&(_.fogDensity.value=x.density)}function t(_,x,b,M,E){x.isMeshBasicMaterial?r(_,x):x.isMeshLambertMaterial?(r(_,x),l(_,x)):x.isMeshToonMaterial?(r(_,x),f(_,x)):x.isMeshPhongMaterial?(r(_,x),c(_,x)):x.isMeshStandardMaterial?(r(_,x),x.isMeshPhysicalMaterial?p(_,x,E):d(_,x)):x.isMeshMatcapMaterial?(r(_,x),m(_,x)):x.isMeshDepthMaterial?(r(_,x),v(_,x)):x.isMeshDistanceMaterial?(r(_,x),y(_,x)):x.isMeshNormalMaterial?(r(_,x),S(_,x)):x.isLineBasicMaterial?(n(_,x),x.isLineDashedMaterial&&i(_,x)):x.isPointsMaterial?s(_,x,b,M):x.isSpriteMaterial?o(_,x):x.isShadowMaterial?(_.color.value.copy(x.color),_.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function r(_,x){_.opacity.value=x.opacity,x.color&&_.diffuse.value.copy(x.color),x.emissive&&_.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(_.map.value=x.map),x.alphaMap&&(_.alphaMap.value=x.alphaMap),x.specularMap&&(_.specularMap.value=x.specularMap);const b=a.get(x).envMap;if(b){_.envMap.value=b,_.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=x.reflectivity,_.refractionRatio.value=x.refractionRatio;const T=a.get(b).__maxMipLevel;T!==void 0&&(_.maxMipLevel.value=T)}x.lightMap&&(_.lightMap.value=x.lightMap,_.lightMapIntensity.value=x.lightMapIntensity),x.aoMap&&(_.aoMap.value=x.aoMap,_.aoMapIntensity.value=x.aoMapIntensity);let M;x.map?M=x.map:x.specularMap?M=x.specularMap:x.displacementMap?M=x.displacementMap:x.normalMap?M=x.normalMap:x.bumpMap?M=x.bumpMap:x.roughnessMap?M=x.roughnessMap:x.metalnessMap?M=x.metalnessMap:x.alphaMap?M=x.alphaMap:x.emissiveMap?M=x.emissiveMap:x.clearcoatMap?M=x.clearcoatMap:x.clearcoatNormalMap?M=x.clearcoatNormalMap:x.clearcoatRoughnessMap?M=x.clearcoatRoughnessMap:x.specularIntensityMap?M=x.specularIntensityMap:x.specularTintMap&&(M=x.specularTintMap),M!==void 0&&(M.isWebGLRenderTarget&&(M=M.texture),M.matrixAutoUpdate===!0&&M.updateMatrix(),_.uvTransform.value.copy(M.matrix));let E;x.aoMap?E=x.aoMap:x.lightMap&&(E=x.lightMap),E!==void 0&&(E.isWebGLRenderTarget&&(E=E.texture),E.matrixAutoUpdate===!0&&E.updateMatrix(),_.uv2Transform.value.copy(E.matrix))}function n(_,x){_.diffuse.value.copy(x.color),_.opacity.value=x.opacity}function i(_,x){_.dashSize.value=x.dashSize,_.totalSize.value=x.dashSize+x.gapSize,_.scale.value=x.scale}function s(_,x,b,M){_.diffuse.value.copy(x.color),_.opacity.value=x.opacity,_.size.value=x.size*b,_.scale.value=M*.5,x.map&&(_.map.value=x.map),x.alphaMap&&(_.alphaMap.value=x.alphaMap);let E;x.map?E=x.map:x.alphaMap&&(E=x.alphaMap),E!==void 0&&(E.matrixAutoUpdate===!0&&E.updateMatrix(),_.uvTransform.value.copy(E.matrix))}function o(_,x){_.diffuse.value.copy(x.color),_.opacity.value=x.opacity,_.rotation.value=x.rotation,x.map&&(_.map.value=x.map),x.alphaMap&&(_.alphaMap.value=x.alphaMap);let b;x.map?b=x.map:x.alphaMap&&(b=x.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),_.uvTransform.value.copy(b.matrix))}function l(_,x){x.emissiveMap&&(_.emissiveMap.value=x.emissiveMap)}function c(_,x){_.specular.value.copy(x.specular),_.shininess.value=Math.max(x.shininess,1e-4),x.emissiveMap&&(_.emissiveMap.value=x.emissiveMap),x.bumpMap&&(_.bumpMap.value=x.bumpMap,_.bumpScale.value=x.bumpScale,x.side===Tn&&(_.bumpScale.value*=-1)),x.normalMap&&(_.normalMap.value=x.normalMap,_.normalScale.value.copy(x.normalScale),x.side===Tn&&_.normalScale.value.negate()),x.displacementMap&&(_.displacementMap.value=x.displacementMap,_.displacementScale.value=x.displacementScale,_.displacementBias.value=x.displacementBias)}function f(_,x){x.gradientMap&&(_.gradientMap.value=x.gradientMap),x.emissiveMap&&(_.emissiveMap.value=x.emissiveMap),x.bumpMap&&(_.bumpMap.value=x.bumpMap,_.bumpScale.value=x.bumpScale,x.side===Tn&&(_.bumpScale.value*=-1)),x.normalMap&&(_.normalMap.value=x.normalMap,_.normalScale.value.copy(x.normalScale),x.side===Tn&&_.normalScale.value.negate()),x.displacementMap&&(_.displacementMap.value=x.displacementMap,_.displacementScale.value=x.displacementScale,_.displacementBias.value=x.displacementBias)}function d(_,x){_.roughness.value=x.roughness,_.metalness.value=x.metalness,x.roughnessMap&&(_.roughnessMap.value=x.roughnessMap),x.metalnessMap&&(_.metalnessMap.value=x.metalnessMap),x.emissiveMap&&(_.emissiveMap.value=x.emissiveMap),x.bumpMap&&(_.bumpMap.value=x.bumpMap,_.bumpScale.value=x.bumpScale,x.side===Tn&&(_.bumpScale.value*=-1)),x.normalMap&&(_.normalMap.value=x.normalMap,_.normalScale.value.copy(x.normalScale),x.side===Tn&&_.normalScale.value.negate()),x.displacementMap&&(_.displacementMap.value=x.displacementMap,_.displacementScale.value=x.displacementScale,_.displacementBias.value=x.displacementBias),a.get(x).envMap&&(_.envMapIntensity.value=x.envMapIntensity)}function p(_,x,b){d(_,x),_.reflectivity.value=x.reflectivity,_.clearcoat.value=x.clearcoat,_.clearcoatRoughness.value=x.clearcoatRoughness,x.sheen&&_.sheen.value.copy(x.sheen),x.clearcoatMap&&(_.clearcoatMap.value=x.clearcoatMap),x.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap),x.clearcoatNormalMap&&(_.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),_.clearcoatNormalMap.value=x.clearcoatNormalMap,x.side===Tn&&_.clearcoatNormalScale.value.negate()),_.transmission.value=x.transmission,x.transmissionMap&&(_.transmissionMap.value=x.transmissionMap),x.transmission>0&&(_.transmissionSamplerMap.value=b.texture,_.transmissionSamplerSize.value.set(b.width,b.height)),_.thickness.value=x.thickness,x.thicknessMap&&(_.thicknessMap.value=x.thicknessMap),_.attenuationDistance.value=x.attenuationDistance,_.attenuationTint.value.copy(x.attenuationTint),_.specularIntensity.value=x.specularIntensity,_.specularTint.value.copy(x.specularTint),x.specularIntensityMap&&(_.specularIntensityMap.value=x.specularIntensityMap),x.specularTintMap&&(_.specularTintMap.value=x.specularTintMap)}function m(_,x){x.matcap&&(_.matcap.value=x.matcap),x.bumpMap&&(_.bumpMap.value=x.bumpMap,_.bumpScale.value=x.bumpScale,x.side===Tn&&(_.bumpScale.value*=-1)),x.normalMap&&(_.normalMap.value=x.normalMap,_.normalScale.value.copy(x.normalScale),x.side===Tn&&_.normalScale.value.negate()),x.displacementMap&&(_.displacementMap.value=x.displacementMap,_.displacementScale.value=x.displacementScale,_.displacementBias.value=x.displacementBias)}function v(_,x){x.displacementMap&&(_.displacementMap.value=x.displacementMap,_.displacementScale.value=x.displacementScale,_.displacementBias.value=x.displacementBias)}function y(_,x){x.displacementMap&&(_.displacementMap.value=x.displacementMap,_.displacementScale.value=x.displacementScale,_.displacementBias.value=x.displacementBias),_.referencePosition.value.copy(x.referencePosition),_.nearDistance.value=x.nearDistance,_.farDistance.value=x.farDistance}function S(_,x){x.bumpMap&&(_.bumpMap.value=x.bumpMap,_.bumpScale.value=x.bumpScale,x.side===Tn&&(_.bumpScale.value*=-1)),x.normalMap&&(_.normalMap.value=x.normalMap,_.normalScale.value.copy(x.normalScale),x.side===Tn&&_.normalScale.value.negate()),x.displacementMap&&(_.displacementMap.value=x.displacementMap,_.displacementScale.value=x.displacementScale,_.displacementBias.value=x.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function JN(){const a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return a.style.display="block",a}function Zt(a={}){const e=a.canvas!==void 0?a.canvas:JN(),t=a.context!==void 0?a.context:null,r=a.alpha!==void 0?a.alpha:!1,n=a.depth!==void 0?a.depth:!0,i=a.stencil!==void 0?a.stencil:!0,s=a.antialias!==void 0?a.antialias:!1,o=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0,l=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1,c=a.powerPreference!==void 0?a.powerPreference:"default",f=a.failIfMajorPerformanceCaveat!==void 0?a.failIfMajorPerformanceCaveat:!1;let d=null,p=null;const m=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ar,this.physicallyCorrectLights=!1,this.toneMapping=xs,this.toneMappingExposure=1;const y=this;let S=!1,_=0,x=0,b=null,M=-1,E=null;const T=new Gt,R=new Gt;let V=null,Y=e.width,$=e.height,W=1,j=null,X=null;const P=new Gt(0,0,Y,$),N=new Gt(0,0,Y,$);let I=!1;const G=[],ee=new th;let re=!1,he=!1,pe=null;const Ie=new Xe,De=new C,Le={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Oe(){return b===null?W:1}let ne=t;function at(U,de){for(let ce=0;ce<U.length;ce++){const _e=U[ce],Ye=e.getContext(_e,de);if(Ye!==null)return Ye}return null}try{const U={alpha:r,depth:n,stencil:i,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:f};if(e.addEventListener("webglcontextlost",Re,!1),e.addEventListener("webglcontextrestored",$e,!1),ne===null){const de=["webgl2","webgl","experimental-webgl"];if(y.isWebGL1Renderer===!0&&de.shift(),ne=at(de,U),ne===null)throw at(de)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ne.getShaderPrecisionFormat===void 0&&(ne.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(U){throw console.error("THREE.WebGLRenderer: "+U.message),U}let Ge,We,Ve,Te,me,ge,se,we,Ee,z,F,ue,be,Fe,He,rt,Ke,je,Je,A,D,O,te;function q(){Ge=new SI(ne),We=new hI(ne,Ge,a),Ge.init(We),O=new qN(ne,Ge,We),Ve=new YN(ne,Ge,We),G[0]=1029,Te=new MI,me=new ON,ge=new $N(ne,Ge,Ve,me,We,O,Te),se=new pI(y),we=new xI(y),Ee=new U3(ne,We),te=new uI(ne,Ge,Ee,We),z=new wI(ne,Ee,Te,te),F=new TI(ne,z,Ee,Te),Je=new AI(ne),rt=new dI(me),ue=new kN(y,se,we,Ge,We,te,rt),be=new KN(me),Fe=new FN(me),He=new HN(Ge,We),je=new cI(y,se,Ve,F,o),Ke=new _x(y,F,We),A=new fI(ne,Ge,Te,We),D=new bI(ne,Ge,Te,We),Te.programs=ue.programs,y.capabilities=We,y.extensions=Ge,y.properties=me,y.renderLists=Fe,y.shadowMap=Ke,y.state=Ve,y.info=Te}q();const Ae=new jN(y,ne);this.xr=Ae,this.getContext=function(){return ne},this.getContextAttributes=function(){return ne.getContextAttributes()},this.forceContextLoss=function(){const U=Ge.get("WEBGL_lose_context");U&&U.loseContext()},this.forceContextRestore=function(){const U=Ge.get("WEBGL_lose_context");U&&U.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(U){U!==void 0&&(W=U,this.setSize(Y,$,!1))},this.getSize=function(U){return U.set(Y,$)},this.setSize=function(U,de,ce){if(Ae.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Y=U,$=de,e.width=Math.floor(U*W),e.height=Math.floor(de*W),ce!==!1&&(e.style.width=U+"px",e.style.height=de+"px"),this.setViewport(0,0,U,de)},this.getDrawingBufferSize=function(U){return U.set(Y*W,$*W).floor()},this.setDrawingBufferSize=function(U,de,ce){Y=U,$=de,W=ce,e.width=Math.floor(U*ce),e.height=Math.floor(de*ce),this.setViewport(0,0,U,de)},this.getCurrentViewport=function(U){return U.copy(T)},this.getViewport=function(U){return U.copy(P)},this.setViewport=function(U,de,ce,_e){U.isVector4?P.set(U.x,U.y,U.z,U.w):P.set(U,de,ce,_e),Ve.viewport(T.copy(P).multiplyScalar(W).floor())},this.getScissor=function(U){return U.copy(N)},this.setScissor=function(U,de,ce,_e){U.isVector4?N.set(U.x,U.y,U.z,U.w):N.set(U,de,ce,_e),Ve.scissor(R.copy(N).multiplyScalar(W).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(U){Ve.setScissorTest(I=U)},this.setOpaqueSort=function(U){j=U},this.setTransparentSort=function(U){X=U},this.getClearColor=function(U){return U.copy(je.getClearColor())},this.setClearColor=function(){je.setClearColor.apply(je,arguments)},this.getClearAlpha=function(){return je.getClearAlpha()},this.setClearAlpha=function(){je.setClearAlpha.apply(je,arguments)},this.clear=function(U,de,ce){let _e=0;(U===void 0||U)&&(_e|=16384),(de===void 0||de)&&(_e|=256),(ce===void 0||ce)&&(_e|=1024),ne.clear(_e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Re,!1),e.removeEventListener("webglcontextrestored",$e,!1),Fe.dispose(),He.dispose(),me.dispose(),se.dispose(),we.dispose(),F.dispose(),te.dispose(),Ae.dispose(),Ae.removeEventListener("sessionstart",Qe),Ae.removeEventListener("sessionend",ct),pe&&(pe.dispose(),pe=null),ie.stop()};function Re(U){U.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),S=!0}function $e(){console.log("THREE.WebGLRenderer: Context Restored."),S=!1;const U=Te.autoReset,de=Ke.enabled,ce=Ke.autoUpdate,_e=Ke.needsUpdate,Ye=Ke.type;q(),Te.autoReset=U,Ke.enabled=de,Ke.autoUpdate=ce,Ke.needsUpdate=_e,Ke.type=Ye}function et(U){const de=U.target;de.removeEventListener("dispose",et),Ze(de)}function Ze(U){yt(U),me.remove(U)}function yt(U){const de=me.get(U).programs;de!==void 0&&de.forEach(function(ce){ue.releaseProgram(ce)})}function Xt(U,de){U.render(function(ce){y.renderBufferImmediate(ce,de)})}this.renderBufferImmediate=function(U,de){te.initAttributes();const ce=me.get(U);U.hasPositions&&!ce.position&&(ce.position=ne.createBuffer()),U.hasNormals&&!ce.normal&&(ce.normal=ne.createBuffer()),U.hasUvs&&!ce.uv&&(ce.uv=ne.createBuffer()),U.hasColors&&!ce.color&&(ce.color=ne.createBuffer());const _e=de.getAttributes();U.hasPositions&&(ne.bindBuffer(34962,ce.position),ne.bufferData(34962,U.positionArray,35048),te.enableAttribute(_e.position),ne.vertexAttribPointer(_e.position,3,5126,!1,0,0)),U.hasNormals&&(ne.bindBuffer(34962,ce.normal),ne.bufferData(34962,U.normalArray,35048),te.enableAttribute(_e.normal),ne.vertexAttribPointer(_e.normal,3,5126,!1,0,0)),U.hasUvs&&(ne.bindBuffer(34962,ce.uv),ne.bufferData(34962,U.uvArray,35048),te.enableAttribute(_e.uv),ne.vertexAttribPointer(_e.uv,2,5126,!1,0,0)),U.hasColors&&(ne.bindBuffer(34962,ce.color),ne.bufferData(34962,U.colorArray,35048),te.enableAttribute(_e.color),ne.vertexAttribPointer(_e.color,3,5126,!1,0,0)),te.disableUnusedAttributes(),ne.drawArrays(4,0,U.count),U.count=0},this.renderBufferDirect=function(U,de,ce,_e,Ye,xt){de===null&&(de=Le);const ut=Ye.isMesh&&Ye.matrixWorld.determinant()<0,ot=mr(U,de,_e,Ye);Ve.setMaterial(_e,ut);let dt=ce.index;const bt=ce.attributes.position;if(dt===null){if(bt===void 0||bt.count===0)return}else if(dt.count===0)return;let vt=1;_e.wireframe===!0&&(dt=z.getWireframeAttribute(ce),vt=2),(ce.morphAttributes.position!==void 0||ce.morphAttributes.normal!==void 0)&&Je.update(Ye,ce,_e,ot),te.setup(Ye,_e,ot,ce,dt);let Et,ft=A;dt!==null&&(Et=Ee.get(dt),ft=D,ft.setIndex(Et));const Un=dt!==null?dt.count:bt.count,Ht=ce.drawRange.start*vt,Gn=ce.drawRange.count*vt,Kt=xt!==null?xt.start*vt:0,qr=xt!==null?xt.count*vt:1/0,jn=Math.max(Ht,Kt),fn=Math.min(Un,Ht+Gn,Kt+qr)-1,Kn=Math.max(0,fn-jn+1);if(Kn!==0){if(Ye.isMesh)_e.wireframe===!0?(Ve.setLineWidth(_e.wireframeLinewidth*Oe()),ft.setMode(1)):ft.setMode(4);else if(Ye.isLine){let Ln=_e.linewidth;Ln===void 0&&(Ln=1),Ve.setLineWidth(Ln*Oe()),Ye.isLineSegments?ft.setMode(1):Ye.isLineLoop?ft.setMode(2):ft.setMode(3)}else Ye.isPoints?ft.setMode(0):Ye.isSprite&&ft.setMode(4);if(Ye.isInstancedMesh)ft.renderInstances(jn,Kn,Ye.count);else if(ce.isInstancedBufferGeometry){const Ln=Math.min(ce.instanceCount,ce._maxInstanceCount);ft.renderInstances(jn,Kn,Ln)}else ft.render(jn,Kn)}},this.compile=function(U,de){p=He.get(U),p.init(),v.push(p),U.traverseVisible(function(ce){ce.isLight&&ce.layers.test(de.layers)&&(p.pushLight(ce),ce.castShadow&&p.pushShadow(ce))}),p.setupLights(),U.traverse(function(ce){const _e=ce.material;if(_e)if(Array.isArray(_e))for(let Ye=0;Ye<_e.length;Ye++){const xt=_e[Ye];Yt(xt,U,ce)}else Yt(_e,U,ce)}),v.pop(),p=null};let en=null;function Lt(U){en&&en(U)}function Qe(){ie.stop()}function ct(){ie.start()}const ie=new ix;ie.setAnimationLoop(Lt),typeof window<"u"&&ie.setContext(window),this.setAnimationLoop=function(U){en=U,Ae.setAnimationLoop(U),U===null?ie.stop():ie.start()},Ae.addEventListener("sessionstart",Qe),Ae.addEventListener("sessionend",ct),this.render=function(U,de){if(de!==void 0&&de.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(S===!0)return;U.autoUpdate===!0&&U.updateMatrixWorld(),de.parent===null&&de.updateMatrixWorld(),Ae.enabled===!0&&Ae.isPresenting===!0&&(Ae.cameraAutoUpdate===!0&&Ae.updateCamera(de),de=Ae.getCamera()),U.isScene===!0&&U.onBeforeRender(y,U,de,b),p=He.get(U,v.length),p.init(),v.push(p),Ie.multiplyMatrices(de.projectionMatrix,de.matrixWorldInverse),ee.setFromProjectionMatrix(Ie),he=this.localClippingEnabled,re=rt.init(this.clippingPlanes,he,de),d=Fe.get(U,m.length),d.init(),m.push(d),Mt(U,de,0,y.sortObjects),d.finish(),y.sortObjects===!0&&d.sort(j,X),re===!0&&rt.beginShadows();const ce=p.state.shadowsArray;Ke.render(ce,U,de),p.setupLights(),p.setupLightsView(de),re===!0&&rt.endShadows(),this.info.autoReset===!0&&this.info.reset(),je.render(d,U);const _e=d.opaque,Ye=d.transmissive,xt=d.transparent;_e.length>0&&Ot(_e,U,de),Ye.length>0&&le(_e,Ye,U,de),xt.length>0&&Ot(xt,U,de),b!==null&&(ge.updateMultisampleRenderTarget(b),ge.updateRenderTargetMipmap(b)),U.isScene===!0&&U.onAfterRender(y,U,de),Ve.buffers.depth.setTest(!0),Ve.buffers.depth.setMask(!0),Ve.buffers.color.setMask(!0),Ve.setPolygonOffset(!1),te.resetDefaultState(),M=-1,E=null,v.pop(),v.length>0?p=v[v.length-1]:p=null,m.pop(),m.length>0?d=m[m.length-1]:d=null};function Mt(U,de,ce,_e){if(U.visible===!1)return;if(U.layers.test(de.layers)){if(U.isGroup)ce=U.renderOrder;else if(U.isLOD)U.autoUpdate===!0&&U.update(de);else if(U.isLight)p.pushLight(U),U.castShadow&&p.pushShadow(U);else if(U.isSprite){if(!U.frustumCulled||ee.intersectsSprite(U)){_e&&De.setFromMatrixPosition(U.matrixWorld).applyMatrix4(Ie);const ut=F.update(U),ot=U.material;ot.visible&&d.push(U,ut,ot,ce,De.z,null)}}else if(U.isImmediateRenderObject)_e&&De.setFromMatrixPosition(U.matrixWorld).applyMatrix4(Ie),d.push(U,null,U.material,ce,De.z,null);else if((U.isMesh||U.isLine||U.isPoints)&&(U.isSkinnedMesh&&U.skeleton.frame!==Te.render.frame&&(U.skeleton.update(),U.skeleton.frame=Te.render.frame),!U.frustumCulled||ee.intersectsObject(U))){_e&&De.setFromMatrixPosition(U.matrixWorld).applyMatrix4(Ie);const ut=F.update(U),ot=U.material;if(Array.isArray(ot)){const dt=ut.groups;for(let bt=0,vt=dt.length;bt<vt;bt++){const Et=dt[bt],ft=ot[Et.materialIndex];ft&&ft.visible&&d.push(U,ut,ft,ce,De.z,Et)}}else ot.visible&&d.push(U,ut,ot,ce,De.z,null)}}const xt=U.children;for(let ut=0,ot=xt.length;ut<ot;ut++)Mt(xt[ut],de,ce,_e)}function le(U,de,ce,_e){if(pe===null){const ot=s===!0&&We.isWebGL2===!0?Q1:Rn;pe=new ot(1024,1024,{generateMipmaps:!0,type:O.convert(ko)!==null?ko:Ya,minFilter:Kf,magFilter:_n,wrapS:ur,wrapT:ur})}const Ye=y.getRenderTarget();y.setRenderTarget(pe),y.clear();const xt=y.toneMapping;y.toneMapping=xs,Ot(U,ce,_e),y.toneMapping=xt,ge.updateMultisampleRenderTarget(pe),ge.updateRenderTargetMipmap(pe),y.setRenderTarget(Ye),Ot(de,ce,_e)}function Ot(U,de,ce){const _e=de.isScene===!0?de.overrideMaterial:null;if(ce.isArrayCamera){const Ye=ce.cameras;for(let xt=0,ut=Ye.length;xt<ut;xt++){const ot=Ye[xt];Ve.viewport(T.copy(ot.viewport)),p.setupLightsView(ot);for(let dt=0,bt=U.length;dt<bt;dt++){const vt=U[dt],Et=vt.object,ft=vt.geometry,Un=_e===null?vt.material:_e,Ht=vt.group;Et.layers.test(ot.layers)&&Se(Et,de,ot,ft,Un,Ht)}}}else for(let Ye=0,xt=U.length;Ye<xt;Ye++){const ut=U[Ye],ot=ut.object,dt=ut.geometry,bt=_e===null?ut.material:_e,vt=ut.group;Se(ot,de,ce,dt,bt,vt)}}function Se(U,de,ce,_e,Ye,xt){if(U.onBeforeRender(y,de,ce,_e,Ye,xt),U.modelViewMatrix.multiplyMatrices(ce.matrixWorldInverse,U.matrixWorld),U.normalMatrix.getNormalMatrix(U.modelViewMatrix),U.isImmediateRenderObject){const ut=mr(ce,de,Ye,U);Ve.setMaterial(Ye),te.reset(),Xt(U,ut)}else Ye.transparent===!0&&Ye.side===ws?(Ye.side=Tn,Ye.needsUpdate=!0,y.renderBufferDirect(ce,de,_e,Ye,U,xt),Ye.side=Ss,Ye.needsUpdate=!0,y.renderBufferDirect(ce,de,_e,Ye,U,xt),Ye.side=ws):y.renderBufferDirect(ce,de,_e,Ye,U,xt);U.onAfterRender(y,de,ce,_e,Ye,xt)}function Yt(U,de,ce){de.isScene!==!0&&(de=Le);const _e=me.get(U),Ye=p.state.lights,xt=p.state.shadowsArray,ut=Ye.state.version,ot=ue.getParameters(U,Ye.state,xt,de,ce),dt=ue.getProgramCacheKey(ot);let bt=_e.programs;_e.environment=U.isMeshStandardMaterial?de.environment:null,_e.fog=de.fog,_e.envMap=(U.isMeshStandardMaterial?we:se).get(U.envMap||_e.environment),bt===void 0&&(U.addEventListener("dispose",et),bt=new Map,_e.programs=bt);let vt=bt.get(dt);if(vt!==void 0){if(_e.currentProgram===vt&&_e.lightsStateVersion===ut)return rn(U,ot),vt}else ot.uniforms=ue.getUniforms(U),U.onBuild(ot,y),U.onBeforeCompile(ot,y),vt=ue.acquireProgram(ot,dt),bt.set(dt,vt),_e.uniforms=ot.uniforms;const Et=_e.uniforms;(!U.isShaderMaterial&&!U.isRawShaderMaterial||U.clipping===!0)&&(Et.clippingPlanes=rt.uniform),rn(U,ot),_e.needsLights=Vn(U),_e.lightsStateVersion=ut,_e.needsLights&&(Et.ambientLightColor.value=Ye.state.ambient,Et.lightProbe.value=Ye.state.probe,Et.directionalLights.value=Ye.state.directional,Et.directionalLightShadows.value=Ye.state.directionalShadow,Et.spotLights.value=Ye.state.spot,Et.spotLightShadows.value=Ye.state.spotShadow,Et.rectAreaLights.value=Ye.state.rectArea,Et.ltc_1.value=Ye.state.rectAreaLTC1,Et.ltc_2.value=Ye.state.rectAreaLTC2,Et.pointLights.value=Ye.state.point,Et.pointLightShadows.value=Ye.state.pointShadow,Et.hemisphereLights.value=Ye.state.hemi,Et.directionalShadowMap.value=Ye.state.directionalShadowMap,Et.directionalShadowMatrix.value=Ye.state.directionalShadowMatrix,Et.spotShadowMap.value=Ye.state.spotShadowMap,Et.spotShadowMatrix.value=Ye.state.spotShadowMatrix,Et.pointShadowMap.value=Ye.state.pointShadowMap,Et.pointShadowMatrix.value=Ye.state.pointShadowMatrix);const ft=vt.getUniforms(),Un=Ua.seqWithValue(ft.seq,Et);return _e.currentProgram=vt,_e.uniformsList=Un,vt}function rn(U,de){const ce=me.get(U);ce.outputEncoding=de.outputEncoding,ce.instancing=de.instancing,ce.skinning=de.skinning,ce.morphTargets=de.morphTargets,ce.morphNormals=de.morphNormals,ce.numClippingPlanes=de.numClippingPlanes,ce.numIntersection=de.numClipIntersection,ce.vertexAlphas=de.vertexAlphas,ce.vertexTangents=de.vertexTangents}function mr(U,de,ce,_e){de.isScene!==!0&&(de=Le),ge.resetTextureUnits();const Ye=de.fog,xt=ce.isMeshStandardMaterial?de.environment:null,ut=b===null?y.outputEncoding:b.texture.encoding,ot=(ce.isMeshStandardMaterial?we:se).get(ce.envMap||xt),dt=ce.vertexColors===!0&&!!_e.geometry&&!!_e.geometry.attributes.color&&_e.geometry.attributes.color.itemSize===4,bt=!!_e.geometry&&!!_e.geometry.attributes.tangent,vt=!!_e.geometry&&!!_e.geometry.morphAttributes.position,Et=!!_e.geometry&&!!_e.geometry.morphAttributes.normal,ft=me.get(ce),Un=p.state.lights;if(re===!0&&(he===!0||U!==E)){const Ln=U===E&&ce.id===M;rt.setState(ce,U,Ln)}let Ht=!1;ce.version===ft.__version?(ft.needsLights&&ft.lightsStateVersion!==Un.state.version||ft.outputEncoding!==ut||_e.isInstancedMesh&&ft.instancing===!1||!_e.isInstancedMesh&&ft.instancing===!0||_e.isSkinnedMesh&&ft.skinning===!1||!_e.isSkinnedMesh&&ft.skinning===!0||ft.envMap!==ot||ce.fog&&ft.fog!==Ye||ft.numClippingPlanes!==void 0&&(ft.numClippingPlanes!==rt.numPlanes||ft.numIntersection!==rt.numIntersection)||ft.vertexAlphas!==dt||ft.vertexTangents!==bt||ft.morphTargets!==vt||ft.morphNormals!==Et)&&(Ht=!0):(Ht=!0,ft.__version=ce.version);let Gn=ft.currentProgram;Ht===!0&&(Gn=Yt(ce,de,_e));let Kt=!1,qr=!1,jn=!1;const fn=Gn.getUniforms(),Kn=ft.uniforms;if(Ve.useProgram(Gn.program)&&(Kt=!0,qr=!0,jn=!0),ce.id!==M&&(M=ce.id,qr=!0),Kt||E!==U){if(fn.setValue(ne,"projectionMatrix",U.projectionMatrix),We.logarithmicDepthBuffer&&fn.setValue(ne,"logDepthBufFC",2/(Math.log(U.far+1)/Math.LN2)),E!==U&&(E=U,qr=!0,jn=!0),ce.isShaderMaterial||ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshStandardMaterial||ce.envMap){const Ln=fn.map.cameraPosition;Ln!==void 0&&Ln.setValue(ne,De.setFromMatrixPosition(U.matrixWorld))}(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial)&&fn.setValue(ne,"isOrthographic",U.isOrthographicCamera===!0),(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial||ce.isShadowMaterial||_e.isSkinnedMesh)&&fn.setValue(ne,"viewMatrix",U.matrixWorldInverse)}if(_e.isSkinnedMesh){fn.setOptional(ne,_e,"bindMatrix"),fn.setOptional(ne,_e,"bindMatrixInverse");const Ln=_e.skeleton;Ln&&(We.floatVertexTextures?(Ln.boneTexture===null&&Ln.computeBoneTexture(),fn.setValue(ne,"boneTexture",Ln.boneTexture,ge),fn.setValue(ne,"boneTextureSize",Ln.boneTextureSize)):fn.setOptional(ne,Ln,"boneMatrices"))}return(qr||ft.receiveShadow!==_e.receiveShadow)&&(ft.receiveShadow=_e.receiveShadow,fn.setValue(ne,"receiveShadow",_e.receiveShadow)),qr&&(fn.setValue(ne,"toneMappingExposure",y.toneMappingExposure),ft.needsLights&&Zn(Kn,jn),Ye&&ce.fog&&be.refreshFogUniforms(Kn,Ye),be.refreshMaterialUniforms(Kn,ce,W,$,pe),Ua.upload(ne,ft.uniformsList,Kn,ge)),ce.isShaderMaterial&&ce.uniformsNeedUpdate===!0&&(Ua.upload(ne,ft.uniformsList,Kn,ge),ce.uniformsNeedUpdate=!1),ce.isSpriteMaterial&&fn.setValue(ne,"center",_e.center),fn.setValue(ne,"modelViewMatrix",_e.modelViewMatrix),fn.setValue(ne,"normalMatrix",_e.normalMatrix),fn.setValue(ne,"modelMatrix",_e.matrixWorld),Gn}function Zn(U,de){U.ambientLightColor.needsUpdate=de,U.lightProbe.needsUpdate=de,U.directionalLights.needsUpdate=de,U.directionalLightShadows.needsUpdate=de,U.pointLights.needsUpdate=de,U.pointLightShadows.needsUpdate=de,U.spotLights.needsUpdate=de,U.spotLightShadows.needsUpdate=de,U.rectAreaLights.needsUpdate=de,U.hemisphereLights.needsUpdate=de}function Vn(U){return U.isMeshLambertMaterial||U.isMeshToonMaterial||U.isMeshPhongMaterial||U.isMeshStandardMaterial||U.isShadowMaterial||U.isShaderMaterial&&U.lights===!0}this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return b},this.setRenderTarget=function(U,de=0,ce=0){b=U,_=de,x=ce,U&&me.get(U).__webglFramebuffer===void 0&&ge.setupRenderTarget(U);let _e=null,Ye=!1,xt=!1;if(U){const ot=U.texture;(ot.isDataTexture3D||ot.isDataTexture2DArray)&&(xt=!0);const dt=me.get(U).__webglFramebuffer;U.isWebGLCubeRenderTarget?(_e=dt[de],Ye=!0):U.isWebGLMultisampleRenderTarget?_e=me.get(U).__webglMultisampledFramebuffer:_e=dt,T.copy(U.viewport),R.copy(U.scissor),V=U.scissorTest}else T.copy(P).multiplyScalar(W).floor(),R.copy(N).multiplyScalar(W).floor(),V=I;if(Ve.bindFramebuffer(36160,_e)&&We.drawBuffers){let ot=!1;if(U)if(U.isWebGLMultipleRenderTargets){const dt=U.texture;if(G.length!==dt.length||G[0]!==36064){for(let bt=0,vt=dt.length;bt<vt;bt++)G[bt]=36064+bt;G.length=dt.length,ot=!0}}else(G.length!==1||G[0]!==36064)&&(G[0]=36064,G.length=1,ot=!0);else(G.length!==1||G[0]!==1029)&&(G[0]=1029,G.length=1,ot=!0);ot&&(We.isWebGL2?ne.drawBuffers(G):Ge.get("WEBGL_draw_buffers").drawBuffersWEBGL(G))}if(Ve.viewport(T),Ve.scissor(R),Ve.setScissorTest(V),Ye){const ot=me.get(U.texture);ne.framebufferTexture2D(36160,36064,34069+de,ot.__webglTexture,ce)}else if(xt){const ot=me.get(U.texture),dt=de||0;ne.framebufferTextureLayer(36160,36064,ot.__webglTexture,ce||0,dt)}},this.readRenderTargetPixels=function(U,de,ce,_e,Ye,xt,ut){if(!(U&&U.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ot=me.get(U).__webglFramebuffer;if(U.isWebGLCubeRenderTarget&&ut!==void 0&&(ot=ot[ut]),ot){Ve.bindFramebuffer(36160,ot);try{const dt=U.texture,bt=dt.format,vt=dt.type;if(bt!==Mn&&O.convert(bt)!==ne.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Et=vt===ko&&(Ge.has("EXT_color_buffer_half_float")||We.isWebGL2&&Ge.has("EXT_color_buffer_float"));if(vt!==Ya&&O.convert(vt)!==ne.getParameter(35738)&&!(vt===Ni&&(We.isWebGL2||Ge.has("OES_texture_float")||Ge.has("WEBGL_color_buffer_float")))&&!Et){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ne.checkFramebufferStatus(36160)===36053?de>=0&&de<=U.width-_e&&ce>=0&&ce<=U.height-Ye&&ne.readPixels(de,ce,_e,Ye,O.convert(bt),O.convert(vt),xt):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const dt=b!==null?me.get(b).__webglFramebuffer:null;Ve.bindFramebuffer(36160,dt)}}},this.copyFramebufferToTexture=function(U,de,ce=0){const _e=Math.pow(2,-ce),Ye=Math.floor(de.image.width*_e),xt=Math.floor(de.image.height*_e);let ut=O.convert(de.format);We.isWebGL2&&(ut===6407&&(ut=32849),ut===6408&&(ut=32856)),ge.setTexture2D(de,0),ne.copyTexImage2D(3553,ce,ut,U.x,U.y,Ye,xt,0),Ve.unbindTexture()},this.copyTextureToTexture=function(U,de,ce,_e=0){const Ye=de.image.width,xt=de.image.height,ut=O.convert(ce.format),ot=O.convert(ce.type);ge.setTexture2D(ce,0),ne.pixelStorei(37440,ce.flipY),ne.pixelStorei(37441,ce.premultiplyAlpha),ne.pixelStorei(3317,ce.unpackAlignment),de.isDataTexture?ne.texSubImage2D(3553,_e,U.x,U.y,Ye,xt,ut,ot,de.image.data):de.isCompressedTexture?ne.compressedTexSubImage2D(3553,_e,U.x,U.y,de.mipmaps[0].width,de.mipmaps[0].height,ut,de.mipmaps[0].data):ne.texSubImage2D(3553,_e,U.x,U.y,ut,ot,de.image),_e===0&&ce.generateMipmaps&&ne.generateMipmap(3553),Ve.unbindTexture()},this.copyTextureToTexture3D=function(U,de,ce,_e,Ye=0){if(y.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const xt=U.max.x-U.min.x+1,ut=U.max.y-U.min.y+1,ot=U.max.z-U.min.z+1,dt=O.convert(_e.format),bt=O.convert(_e.type);let vt;if(_e.isDataTexture3D)ge.setTexture3D(_e,0),vt=32879;else if(_e.isDataTexture2DArray)ge.setTexture2DArray(_e,0),vt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ne.pixelStorei(37440,_e.flipY),ne.pixelStorei(37441,_e.premultiplyAlpha),ne.pixelStorei(3317,_e.unpackAlignment);const Et=ne.getParameter(3314),ft=ne.getParameter(32878),Un=ne.getParameter(3316),Ht=ne.getParameter(3315),Gn=ne.getParameter(32877),Kt=ce.isCompressedTexture?ce.mipmaps[0]:ce.image;ne.pixelStorei(3314,Kt.width),ne.pixelStorei(32878,Kt.height),ne.pixelStorei(3316,U.min.x),ne.pixelStorei(3315,U.min.y),ne.pixelStorei(32877,U.min.z),ce.isDataTexture||ce.isDataTexture3D?ne.texSubImage3D(vt,Ye,de.x,de.y,de.z,xt,ut,ot,dt,bt,Kt.data):ce.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ne.compressedTexSubImage3D(vt,Ye,de.x,de.y,de.z,xt,ut,ot,dt,Kt.data)):ne.texSubImage3D(vt,Ye,de.x,de.y,de.z,xt,ut,ot,dt,bt,Kt),ne.pixelStorei(3314,Et),ne.pixelStorei(32878,ft),ne.pixelStorei(3316,Un),ne.pixelStorei(3315,Ht),ne.pixelStorei(32877,Gn),Ye===0&&_e.generateMipmaps&&ne.generateMipmap(vt),Ve.unbindTexture()},this.initTexture=function(U){ge.setTexture2D(U,0),Ve.unbindTexture()},this.resetState=function(){_=0,x=0,b=null,Ve.reset(),te.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class xx extends Zt{}xx.prototype.isWebGL1Renderer=!0;class ac{constructor(e,t=1,r=1e3){this.name="",this.color=new nt(e),this.near=t,this.far=r}clone(){return new ac(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}ac.prototype.isFog=!0;class Ga extends Dt{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}Ga.prototype.isScene=!0;class vc{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=rc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=xi()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}vc.prototype.isInterleavedBuffer=!0;const bn=new C;class sc{constructor(e,t,r,n=!1){this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=n===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)bn.x=this.getX(t),bn.y=this.getY(t),bn.z=this.getZ(t),bn.applyMatrix4(e),this.setXYZ(t,bn.x,bn.y,bn.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)bn.x=this.getX(t),bn.y=this.getY(t),bn.z=this.getZ(t),bn.applyNormalMatrix(e),this.setXYZ(t,bn.x,bn.y,bn.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)bn.x=this.getX(t),bn.y=this.getY(t),bn.z=this.getZ(t),bn.transformDirection(e),this.setXYZ(t,bn.x,bn.y,bn.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this}setXYZW(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[n+i])}return new mt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new sc(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[n+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}sc.prototype.isInterleavedBufferAttribute=!0;class Sx extends qn{constructor(e){super(),this.type="SpriteMaterial",this.color=new nt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}Sx.prototype.isSpriteMaterial=!0;let fo;const Rl=new C,ho=new C,po=new C,mo=new Pe,Ll=new Pe,wx=new Xe,Yu=new C,Pl=new C,$u=new C,J0=new Pe,ap=new Pe,Q0=new Pe;class QN extends Dt{constructor(e){if(super(),this.type="Sprite",fo===void 0){fo=new It;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new vc(t,5);fo.setIndex([0,1,2,0,2,3]),fo.setAttribute("position",new sc(r,3,0,!1)),fo.setAttribute("uv",new sc(r,2,3,!1))}this.geometry=fo,this.material=e!==void 0?e:new Sx,this.center=new Pe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ho.setFromMatrixScale(this.matrixWorld),wx.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),po.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ho.multiplyScalar(-po.z);const r=this.material.rotation;let n,i;r!==0&&(i=Math.cos(r),n=Math.sin(r));const s=this.center;qu(Yu.set(-.5,-.5,0),po,s,ho,n,i),qu(Pl.set(.5,-.5,0),po,s,ho,n,i),qu($u.set(.5,.5,0),po,s,ho,n,i),J0.set(0,0),ap.set(1,0),Q0.set(1,1);let o=e.ray.intersectTriangle(Yu,Pl,$u,!1,Rl);if(o===null&&(qu(Pl.set(-.5,.5,0),po,s,ho,n,i),ap.set(0,1),o=e.ray.intersectTriangle(Yu,$u,Pl,!1,Rl),o===null))return;const l=e.ray.origin.distanceTo(Rl);l<e.near||l>e.far||t.push({distance:l,point:Rl.clone(),uv:Wr.getUV(Rl,Yu,Pl,$u,J0,ap,Q0,new Pe),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}QN.prototype.isSprite=!0;function qu(a,e,t,r,n,i){mo.subVectors(a,t).addScalar(.5).multiply(r),n!==void 0?(Ll.x=i*mo.x-n*mo.y,Ll.y=n*mo.x+i*mo.y):Ll.copy(mo),a.copy(e),a.x+=Ll.x,a.y+=Ll.y,a.applyMatrix4(wx)}const ey=new C,ty=new Gt,ny=new Gt,ek=new C,ry=new Xe;class bx extends Ut{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Xe,this.bindMatrixInverse=new Xe}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Gt,t=this.geometry.attributes.skinWeight;for(let r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const r=this.skeleton,n=this.geometry;ty.fromBufferAttribute(n.attributes.skinIndex,e),ny.fromBufferAttribute(n.attributes.skinWeight,e),ey.fromBufferAttribute(n.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let i=0;i<4;i++){const s=ny.getComponent(i);if(s!==0){const o=ty.getComponent(i);ry.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),t.addScaledVector(ek.copy(ey).applyMatrix4(ry),s)}}return t.applyMatrix4(this.bindMatrixInverse)}}bx.prototype.isSkinnedMesh=!0;class tk extends Dt{constructor(){super(),this.type="Bone"}}tk.prototype.isBone=!0;class Rm extends $n{constructor(e=null,t=1,r=1,n,i,s,o,l,c=_n,f=_n,d,p){super(null,s,o,l,c,f,n,i,d,p),this.image={data:e,width:t,height:r},this.magFilter=c,this.minFilter=f,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Rm.prototype.isDataTexture=!0;const iy=new Xe,ay=new Xe,Zu=[],Il=new Ut;let nk=class extends Ut{constructor(e,t,r){super(e,t),this.instanceMatrix=new mt(new Float32Array(r*16),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const r=this.matrixWorld,n=this.count;if(Il.geometry=this.geometry,Il.material=this.material,Il.material!==void 0)for(let i=0;i<n;i++){this.getMatrixAt(i,iy),ay.multiplyMatrices(r,iy),Il.matrixWorld=ay,Il.raycast(e,Zu);for(let s=0,o=Zu.length;s<o;s++){const l=Zu[s];l.instanceId=i,l.object=this,t.push(l)}Zu.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new mt(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};nk.prototype.isInstancedMesh=!0;class As extends qn{constructor(e){super(),this.type="LineBasicMaterial",this.color=new nt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}As.prototype.isLineBasicMaterial=!0;const sy=new C,oy=new C,ly=new Xe,sp=new ja,ju=new Lr;class Ts extends Dt{constructor(e=new It,t=new As){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,r=[0];for(let n=1,i=t.count;n<i;n++)sy.fromBufferAttribute(t,n-1),oy.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=sy.distanceTo(oy);e.setAttribute("lineDistance",new ln(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const r=this.geometry,n=this.matrixWorld,i=e.params.Line.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),ju.copy(r.boundingSphere),ju.applyMatrix4(n),ju.radius+=i,e.ray.intersectsSphere(ju)===!1)return;ly.copy(n).invert(),sp.copy(e.ray).applyMatrix4(ly);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new C,f=new C,d=new C,p=new C,m=this.isLineSegments?2:1;if(r.isBufferGeometry){const v=r.index,S=r.attributes.position;if(v!==null){const _=Math.max(0,s.start),x=Math.min(v.count,s.start+s.count);for(let b=_,M=x-1;b<M;b+=m){const E=v.getX(b),T=v.getX(b+1);if(c.fromBufferAttribute(S,E),f.fromBufferAttribute(S,T),sp.distanceSqToSegment(c,f,p,d)>l)continue;p.applyMatrix4(this.matrixWorld);const V=e.ray.origin.distanceTo(p);V<e.near||V>e.far||t.push({distance:V,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{const _=Math.max(0,s.start),x=Math.min(S.count,s.start+s.count);for(let b=_,M=x-1;b<M;b+=m){if(c.fromBufferAttribute(S,b),f.fromBufferAttribute(S,b+1),sp.distanceSqToSegment(c,f,p,d)>l)continue;p.applyMatrix4(this.matrixWorld);const T=e.ray.origin.distanceTo(p);T<e.near||T>e.far||t.push({distance:T,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else r.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const n=t[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,s=n.length;i<s;i++){const o=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Ts.prototype.isLine=!0;const cy=new C,uy=new C;class $r extends Ts{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,r=[];for(let n=0,i=t.count;n<i;n+=2)cy.fromBufferAttribute(t,n),uy.fromBufferAttribute(t,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+cy.distanceTo(uy);e.setAttribute("lineDistance",new ln(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}$r.prototype.isLineSegments=!0;class rk extends Ts{constructor(e,t){super(e,t),this.type="LineLoop"}}rk.prototype.isLineLoop=!0;class Mx extends qn{constructor(e){super(),this.type="PointsMaterial",this.color=new nt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Mx.prototype.isPointsMaterial=!0;const fy=new Xe,jp=new ja,Ku=new Lr,Ju=new C;class ik extends Dt{constructor(e=new It,t=new Mx){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,n=this.matrixWorld,i=e.params.Points.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Ku.copy(r.boundingSphere),Ku.applyMatrix4(n),Ku.radius+=i,e.ray.intersectsSphere(Ku)===!1)return;fy.copy(n).invert(),jp.copy(e.ray).applyMatrix4(fy);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o;if(r.isBufferGeometry){const c=r.index,d=r.attributes.position;if(c!==null){const p=Math.max(0,s.start),m=Math.min(c.count,s.start+s.count);for(let v=p,y=m;v<y;v++){const S=c.getX(v);Ju.fromBufferAttribute(d,S),hy(Ju,S,l,n,e,t,this)}}else{const p=Math.max(0,s.start),m=Math.min(d.count,s.start+s.count);for(let v=p,y=m;v<y;v++)Ju.fromBufferAttribute(d,v),hy(Ju,v,l,n,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const n=t[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,s=n.length;i<s;i++){const o=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}ik.prototype.isPoints=!0;function hy(a,e,t,r,n,i,s){const o=jp.distanceSqToPoint(a);if(o<t){const l=new C;jp.closestPointToPoint(a,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;i.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,object:s})}}class ak extends $n{constructor(e,t,r,n,i,s,o,l,c){super(e,t,r,n,i,s,o,l,c),this.format=o!==void 0?o:za,this.minFilter=s!==void 0?s:qt,this.magFilter=i!==void 0?i:qt,this.generateMipmaps=!1;const f=this;function d(){f.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}ak.prototype.isVideoTexture=!0;class sk extends $n{constructor(e,t,r,n,i,s,o,l,c,f,d,p){super(null,s,o,l,c,f,n,i,d,p),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}sk.prototype.isCompressedTexture=!0;class ok extends $n{constructor(e,t,r,n,i,s,o,l,c){super(e,t,r,n,i,s,o,l,c),this.needsUpdate=!0}}ok.prototype.isCanvasTexture=!0;class Ex extends $n{constructor(e,t,r,n,i,s,o,l,c,f){if(f=f!==void 0?f:Oo,f!==Oo&&f!==nc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&f===Oo&&(r=tc),r===void 0&&f===nc&&(r=Zl),super(null,n,i,s,o,l,f,r,c),this.image={width:e,height:t},this.magFilter=o!==void 0?o:_n,this.minFilter=l!==void 0?l:_n,this.flipY=!1,this.generateMipmaps=!1}}Ex.prototype.isDepthTexture=!0;class gc extends It{constructor(e=1,t=1,r=1,n=8,i=1,s=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),i=Math.floor(i);const f=[],d=[],p=[],m=[];let v=0;const y=[],S=r/2;let _=0;x(),s===!1&&(e>0&&b(!0),t>0&&b(!1)),this.setIndex(f),this.setAttribute("position",new ln(d,3)),this.setAttribute("normal",new ln(p,3)),this.setAttribute("uv",new ln(m,2));function x(){const M=new C,E=new C;let T=0;const R=(t-e)/r;for(let V=0;V<=i;V++){const Y=[],$=V/i,W=$*(t-e)+e;for(let j=0;j<=n;j++){const X=j/n,P=X*l+o,N=Math.sin(P),I=Math.cos(P);E.x=W*N,E.y=-$*r+S,E.z=W*I,d.push(E.x,E.y,E.z),M.set(N,R,I).normalize(),p.push(M.x,M.y,M.z),m.push(X,1-$),Y.push(v++)}y.push(Y)}for(let V=0;V<n;V++)for(let Y=0;Y<i;Y++){const $=y[Y][V],W=y[Y+1][V],j=y[Y+1][V+1],X=y[Y][V+1];f.push($,W,X),f.push(W,j,X),T+=6}c.addGroup(_,T,0),_+=T}function b(M){const E=v,T=new Pe,R=new C;let V=0;const Y=M===!0?e:t,$=M===!0?1:-1;for(let j=1;j<=n;j++)d.push(0,S*$,0),p.push(0,$,0),m.push(.5,.5),v++;const W=v;for(let j=0;j<=n;j++){const P=j/n*l+o,N=Math.cos(P),I=Math.sin(P);R.x=Y*I,R.y=S*$,R.z=Y*N,d.push(R.x,R.y,R.z),p.push(0,$,0),T.x=N*.5+.5,T.y=I*.5*$+.5,m.push(T.x,T.y),v++}for(let j=0;j<n;j++){const X=E+j,P=W+j;M===!0?f.push(P,P+1,X):f.push(P+1,P,X),V+=3}c.addGroup(_,V,M===!0?1:2),_+=V}}static fromJSON(e){return new gc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ai{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,n=this.getPoint(0),i=0;t.push(0);for(let s=1;s<=e;s++)r=this.getPoint(s/e),i+=r.distanceTo(n),t.push(i),n=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let n=0;const i=r.length;let s;t?s=t:s=e*r[i-1];let o=0,l=i-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-s,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===s)return n/(i-1);const f=r[n],p=r[n+1]-f,m=(s-f)/p;return(n+m)/(i-1)}getTangent(e,t){let n=e-1e-4,i=e+1e-4;n<0&&(n=0),i>1&&(i=1);const s=this.getPoint(n),o=this.getPoint(i),l=t||(s.isVector2?new Pe:new C);return l.copy(o).sub(s).normalize(),l}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new C,n=[],i=[],s=[],o=new C,l=new Xe;for(let m=0;m<=e;m++){const v=m/e;n[m]=this.getTangentAt(v,new C),n[m].normalize()}i[0]=new C,s[0]=new C;let c=Number.MAX_VALUE;const f=Math.abs(n[0].x),d=Math.abs(n[0].y),p=Math.abs(n[0].z);f<=c&&(c=f,r.set(1,0,0)),d<=c&&(c=d,r.set(0,1,0)),p<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),i[0].crossVectors(n[0],o),s[0].crossVectors(n[0],i[0]);for(let m=1;m<=e;m++){if(i[m]=i[m-1].clone(),s[m]=s[m-1].clone(),o.crossVectors(n[m-1],n[m]),o.length()>Number.EPSILON){o.normalize();const v=Math.acos(Cr(n[m-1].dot(n[m]),-1,1));i[m].applyMatrix4(l.makeRotationAxis(o,v))}s[m].crossVectors(n[m],i[m])}if(t===!0){let m=Math.acos(Cr(i[0].dot(i[e]),-1,1));m/=e,n[0].dot(o.crossVectors(i[0],i[e]))>0&&(m=-m);for(let v=1;v<=e;v++)i[v].applyMatrix4(l.makeRotationAxis(n[v],m*v)),s[v].crossVectors(n[v],i[v])}return{tangents:n,normals:i,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class nh extends ai{constructor(e=0,t=0,r=1,n=1,i=0,s=Math.PI*2,o=!1,l=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=l}getPoint(e,t){const r=t||new Pe,n=Math.PI*2;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(s?i=0:i=n),this.aClockwise===!0&&!s&&(i===n?i=-n:i=i-n);const o=this.aStartAngle+e*i;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const f=Math.cos(this.aRotation),d=Math.sin(this.aRotation),p=l-this.aX,m=c-this.aY;l=p*f-m*d+this.aX,c=p*d+m*f+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}nh.prototype.isEllipseCurve=!0;class Cx extends nh{constructor(e,t,r,n,i,s){super(e,t,r,r,n,i,s),this.type="ArcCurve"}}Cx.prototype.isArcCurve=!0;function Lm(){let a=0,e=0,t=0,r=0;function n(i,s,o,l){a=i,e=o,t=-3*i+3*s-2*o-l,r=2*i-2*s+o+l}return{initCatmullRom:function(i,s,o,l,c){n(s,o,c*(o-i),c*(l-s))},initNonuniformCatmullRom:function(i,s,o,l,c,f,d){let p=(s-i)/c-(o-i)/(c+f)+(o-s)/f,m=(o-s)/f-(l-s)/(f+d)+(l-o)/d;p*=f,m*=f,n(s,o,p,m)},calc:function(i){const s=i*i,o=s*i;return a+e*i+t*s+r*o}}}const Qu=new C,op=new Lm,lp=new Lm,cp=new Lm;class Ax extends ai{constructor(e=[],t=!1,r="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=n}getPoint(e,t=new C){const r=t,n=this.points,i=n.length,s=(i-(this.closed?0:1))*e;let o=Math.floor(s),l=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/i)+1)*i:l===0&&o===i-1&&(o=i-2,l=1);let c,f;this.closed||o>0?c=n[(o-1)%i]:(Qu.subVectors(n[0],n[1]).add(n[0]),c=Qu);const d=n[o%i],p=n[(o+1)%i];if(this.closed||o+2<i?f=n[(o+2)%i]:(Qu.subVectors(n[i-1],n[i-2]).add(n[i-1]),f=Qu),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let v=Math.pow(c.distanceToSquared(d),m),y=Math.pow(d.distanceToSquared(p),m),S=Math.pow(p.distanceToSquared(f),m);y<1e-4&&(y=1),v<1e-4&&(v=y),S<1e-4&&(S=y),op.initNonuniformCatmullRom(c.x,d.x,p.x,f.x,v,y,S),lp.initNonuniformCatmullRom(c.y,d.y,p.y,f.y,v,y,S),cp.initNonuniformCatmullRom(c.z,d.z,p.z,f.z,v,y,S)}else this.curveType==="catmullrom"&&(op.initCatmullRom(c.x,d.x,p.x,f.x,this.tension),lp.initCatmullRom(c.y,d.y,p.y,f.y,this.tension),cp.initCatmullRom(c.z,d.z,p.z,f.z,this.tension));return r.set(op.calc(l),lp.calc(l),cp.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const n=e.points[t];this.points.push(new C().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}Ax.prototype.isCatmullRomCurve3=!0;function dy(a,e,t,r,n){const i=(r-e)*.5,s=(n-t)*.5,o=a*a,l=a*o;return(2*t-2*r+i+s)*l+(-3*t+3*r-2*i-s)*o+i*a+t}function lk(a,e){const t=1-a;return t*t*e}function ck(a,e){return 2*(1-a)*a*e}function uk(a,e){return a*a*e}function Kl(a,e,t,r){return lk(a,e)+ck(a,t)+uk(a,r)}function fk(a,e){const t=1-a;return t*t*t*e}function hk(a,e){const t=1-a;return 3*t*t*a*e}function dk(a,e){return 3*(1-a)*a*a*e}function pk(a,e){return a*a*a*e}function Jl(a,e,t,r,n){return fk(a,e)+hk(a,t)+dk(a,r)+pk(a,n)}class Pm extends ai{constructor(e=new Pe,t=new Pe,r=new Pe,n=new Pe){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new Pe){const r=t,n=this.v0,i=this.v1,s=this.v2,o=this.v3;return r.set(Jl(e,n.x,i.x,s.x,o.x),Jl(e,n.y,i.y,s.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Pm.prototype.isCubicBezierCurve=!0;class Tx extends ai{constructor(e=new C,t=new C,r=new C,n=new C){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new C){const r=t,n=this.v0,i=this.v1,s=this.v2,o=this.v3;return r.set(Jl(e,n.x,i.x,s.x,o.x),Jl(e,n.y,i.y,s.y,o.y),Jl(e,n.z,i.z,s.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Tx.prototype.isCubicBezierCurve3=!0;class rh extends ai{constructor(e=new Pe,t=new Pe){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Pe){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const r=t||new Pe;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}rh.prototype.isLineCurve=!0;class mk extends ai{constructor(e=new C,t=new C){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new C){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Im extends ai{constructor(e=new Pe,t=new Pe,r=new Pe){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Pe){const r=t,n=this.v0,i=this.v1,s=this.v2;return r.set(Kl(e,n.x,i.x,s.x),Kl(e,n.y,i.y,s.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Im.prototype.isQuadraticBezierCurve=!0;class Rx extends ai{constructor(e=new C,t=new C,r=new C){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new C){const r=t,n=this.v0,i=this.v1,s=this.v2;return r.set(Kl(e,n.x,i.x,s.x),Kl(e,n.y,i.y,s.y),Kl(e,n.z,i.z,s.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Rx.prototype.isQuadraticBezierCurve3=!0;class Nm extends ai{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Pe){const r=t,n=this.points,i=(n.length-1)*e,s=Math.floor(i),o=i-s,l=n[s===0?s:s-1],c=n[s],f=n[s>n.length-2?n.length-1:s+1],d=n[s>n.length-3?n.length-1:s+2];return r.set(dy(o,l.x,c.x,f.x,d.x),dy(o,l.y,c.y,f.y,d.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const n=e.points[t];this.points.push(new Pe().fromArray(n))}return this}}Nm.prototype.isSplineCurve=!0;var Lx=Object.freeze({__proto__:null,ArcCurve:Cx,CatmullRomCurve3:Ax,CubicBezierCurve:Pm,CubicBezierCurve3:Tx,EllipseCurve:nh,LineCurve:rh,LineCurve3:mk,QuadraticBezierCurve:Im,QuadraticBezierCurve3:Rx,SplineCurve:Nm});const vk={triangulate:function(a,e,t=2){const r=e&&e.length,n=r?e[0]*t:a.length;let i=Px(a,0,n,t,!0);const s=[];if(!i||i.next===i.prev)return s;let o,l,c,f,d,p,m;if(r&&(i=Sk(a,e,i,t)),a.length>80*t){o=c=a[0],l=f=a[1];for(let v=t;v<n;v+=t)d=a[v],p=a[v+1],d<o&&(o=d),p<l&&(l=p),d>c&&(c=d),p>f&&(f=p);m=Math.max(c-o,f-l),m=m!==0?1/m:0}return oc(i,s,t,o,l,m),s}};function Px(a,e,t,r,n){let i,s;if(n===Ik(a,e,t,r)>0)for(i=e;i<t;i+=r)s=py(i,a[i],a[i+1],s);else for(i=t-r;i>=e;i-=r)s=py(i,a[i],a[i+1],s);return s&&ih(s,s.next)&&(cc(s),s=s.next),s}function $a(a,e){if(!a)return a;e||(e=a);let t=a,r;do if(r=!1,!t.steiner&&(ih(t,t.next)||yn(t.prev,t,t.next)===0)){if(cc(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function oc(a,e,t,r,n,i,s){if(!a)return;!s&&i&&Ck(a,r,n,i);let o=a,l,c;for(;a.prev!==a.next;){if(l=a.prev,c=a.next,i?_k(a,r,n,i):gk(a)){e.push(l.i/t),e.push(a.i/t),e.push(c.i/t),cc(a),a=c.next,o=c.next;continue}if(a=c,a===o){s?s===1?(a=yk($a(a),e,t),oc(a,e,t,r,n,i,2)):s===2&&xk(a,e,t,r,n,i):oc($a(a),e,t,r,n,i,1);break}}}function gk(a){const e=a.prev,t=a,r=a.next;if(yn(e,t,r)>=0)return!1;let n=a.next.next;for(;n!==a.prev;){if(No(e.x,e.y,t.x,t.y,r.x,r.y,n.x,n.y)&&yn(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function _k(a,e,t,r){const n=a.prev,i=a,s=a.next;if(yn(n,i,s)>=0)return!1;const o=n.x<i.x?n.x<s.x?n.x:s.x:i.x<s.x?i.x:s.x,l=n.y<i.y?n.y<s.y?n.y:s.y:i.y<s.y?i.y:s.y,c=n.x>i.x?n.x>s.x?n.x:s.x:i.x>s.x?i.x:s.x,f=n.y>i.y?n.y>s.y?n.y:s.y:i.y>s.y?i.y:s.y,d=Kp(o,l,e,t,r),p=Kp(c,f,e,t,r);let m=a.prevZ,v=a.nextZ;for(;m&&m.z>=d&&v&&v.z<=p;){if(m!==a.prev&&m!==a.next&&No(n.x,n.y,i.x,i.y,s.x,s.y,m.x,m.y)&&yn(m.prev,m,m.next)>=0||(m=m.prevZ,v!==a.prev&&v!==a.next&&No(n.x,n.y,i.x,i.y,s.x,s.y,v.x,v.y)&&yn(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;m&&m.z>=d;){if(m!==a.prev&&m!==a.next&&No(n.x,n.y,i.x,i.y,s.x,s.y,m.x,m.y)&&yn(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;v&&v.z<=p;){if(v!==a.prev&&v!==a.next&&No(n.x,n.y,i.x,i.y,s.x,s.y,v.x,v.y)&&yn(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function yk(a,e,t){let r=a;do{const n=r.prev,i=r.next.next;!ih(n,i)&&Ix(n,r,r.next,i)&&lc(n,i)&&lc(i,n)&&(e.push(n.i/t),e.push(r.i/t),e.push(i.i/t),cc(r),cc(r.next),r=a=i),r=r.next}while(r!==a);return $a(r)}function xk(a,e,t,r,n,i){let s=a;do{let o=s.next.next;for(;o!==s.prev;){if(s.i!==o.i&&Rk(s,o)){let l=Nx(s,o);s=$a(s,s.next),l=$a(l,l.next),oc(s,e,t,r,n,i),oc(l,e,t,r,n,i);return}o=o.next}s=s.next}while(s!==a)}function Sk(a,e,t,r){const n=[];let i,s,o,l,c;for(i=0,s=e.length;i<s;i++)o=e[i]*r,l=i<s-1?e[i+1]*r:a.length,c=Px(a,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(Tk(c));for(n.sort(wk),i=0;i<n.length;i++)bk(n[i],t),t=$a(t,t.next);return t}function wk(a,e){return a.x-e.x}function bk(a,e){if(e=Mk(a,e),e){const t=Nx(e,a);$a(e,e.next),$a(t,t.next)}}function Mk(a,e){let t=e;const r=a.x,n=a.y;let i=-1/0,s;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){const p=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(p<=r&&p>i){if(i=p,p===r){if(n===t.y)return t;if(n===t.next.y)return t.next}s=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!s)return null;if(r===i)return s;const o=s,l=s.x,c=s.y;let f=1/0,d;t=s;do r>=t.x&&t.x>=l&&r!==t.x&&No(n<c?r:i,n,l,c,n<c?i:r,n,t.x,t.y)&&(d=Math.abs(n-t.y)/(r-t.x),lc(t,a)&&(d<f||d===f&&(t.x>s.x||t.x===s.x&&Ek(s,t)))&&(s=t,f=d)),t=t.next;while(t!==o);return s}function Ek(a,e){return yn(a.prev,a,e.prev)<0&&yn(e.next,a,a.next)<0}function Ck(a,e,t,r){let n=a;do n.z===null&&(n.z=Kp(n.x,n.y,e,t,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==a);n.prevZ.nextZ=null,n.prevZ=null,Ak(n)}function Ak(a){let e,t,r,n,i,s,o,l,c=1;do{for(t=a,a=null,i=null,s=0;t;){for(s++,r=t,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||t.z<=r.z)?(n=t,t=t.nextZ,o--):(n=r,r=r.nextZ,l--),i?i.nextZ=n:a=n,n.prevZ=i,i=n;t=r}i.nextZ=null,c*=2}while(s>1);return a}function Kp(a,e,t,r,n){return a=32767*(a-t)*n,e=32767*(e-r)*n,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,a|e<<1}function Tk(a){let e=a,t=a;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==a);return t}function No(a,e,t,r,n,i,s,o){return(n-s)*(e-o)-(a-s)*(i-o)>=0&&(a-s)*(r-o)-(t-s)*(e-o)>=0&&(t-s)*(i-o)-(n-s)*(r-o)>=0}function Rk(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!Lk(a,e)&&(lc(a,e)&&lc(e,a)&&Pk(a,e)&&(yn(a.prev,a,e.prev)||yn(a,e.prev,e))||ih(a,e)&&yn(a.prev,a,a.next)>0&&yn(e.prev,e,e.next)>0)}function yn(a,e,t){return(e.y-a.y)*(t.x-e.x)-(e.x-a.x)*(t.y-e.y)}function ih(a,e){return a.x===e.x&&a.y===e.y}function Ix(a,e,t,r){const n=tf(yn(a,e,t)),i=tf(yn(a,e,r)),s=tf(yn(t,r,a)),o=tf(yn(t,r,e));return!!(n!==i&&s!==o||n===0&&ef(a,t,e)||i===0&&ef(a,r,e)||s===0&&ef(t,a,r)||o===0&&ef(t,e,r))}function ef(a,e,t){return e.x<=Math.max(a.x,t.x)&&e.x>=Math.min(a.x,t.x)&&e.y<=Math.max(a.y,t.y)&&e.y>=Math.min(a.y,t.y)}function tf(a){return a>0?1:a<0?-1:0}function Lk(a,e){let t=a;do{if(t.i!==a.i&&t.next.i!==a.i&&t.i!==e.i&&t.next.i!==e.i&&Ix(t,t.next,a,e))return!0;t=t.next}while(t!==a);return!1}function lc(a,e){return yn(a.prev,a,a.next)<0?yn(a,e,a.next)>=0&&yn(a,a.prev,e)>=0:yn(a,e,a.prev)<0||yn(a,a.next,e)<0}function Pk(a,e){let t=a,r=!1;const n=(a.x+e.x)/2,i=(a.y+e.y)/2;do t.y>i!=t.next.y>i&&t.next.y!==t.y&&n<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==a);return r}function Nx(a,e){const t=new Jp(a.i,a.x,a.y),r=new Jp(e.i,e.x,e.y),n=a.next,i=e.prev;return a.next=e,e.prev=a,t.next=n,n.prev=t,r.next=t,t.prev=r,i.next=r,r.prev=i,r}function py(a,e,t,r){const n=new Jp(a,e,t);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function cc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Jp(a,e,t){this.i=a,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ik(a,e,t,r){let n=0;for(let i=e,s=t-r;i<t;i+=r)n+=(a[s]-a[i])*(a[i+1]+a[s+1]),s=i;return n}class Ha{static area(e){const t=e.length;let r=0;for(let n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return r*.5}static isClockWise(e){return Ha.area(e)<0}static triangulateShape(e,t){const r=[],n=[],i=[];my(e),vy(r,e);let s=e.length;t.forEach(my);for(let l=0;l<t.length;l++)n.push(s),s+=t[l].length,vy(r,t[l]);const o=vk.triangulate(r,n);for(let l=0;l<o.length;l+=3)i.push(o.slice(l,l+3));return i}}function my(a){const e=a.length;e>2&&a[e-1].equals(a[0])&&a.pop()}function vy(a,e){for(let t=0;t<e.length;t++)a.push(e[t].x),a.push(e[t].y)}class qo extends It{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,n=[],i=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];s(c)}this.setAttribute("position",new ln(n,3)),this.setAttribute("uv",new ln(i,2)),this.computeVertexNormals();function s(o){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,f=t.steps!==void 0?t.steps:1;let d=t.depth!==void 0?t.depth:100,p=t.bevelEnabled!==void 0?t.bevelEnabled:!0,m=t.bevelThickness!==void 0?t.bevelThickness:6,v=t.bevelSize!==void 0?t.bevelSize:m-2,y=t.bevelOffset!==void 0?t.bevelOffset:0,S=t.bevelSegments!==void 0?t.bevelSegments:3;const _=t.extrudePath,x=t.UVGenerator!==void 0?t.UVGenerator:Nk;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let b,M=!1,E,T,R,V;_&&(b=_.getSpacedPoints(f),M=!0,p=!1,E=_.computeFrenetFrames(f,!1),T=new C,R=new C,V=new C),p||(S=0,m=0,v=0,y=0);const Y=o.extractPoints(c);let $=Y.shape;const W=Y.holes;if(!Ha.isClockWise($)){$=$.reverse();for(let me=0,ge=W.length;me<ge;me++){const se=W[me];Ha.isClockWise(se)&&(W[me]=se.reverse())}}const X=Ha.triangulateShape($,W),P=$;for(let me=0,ge=W.length;me<ge;me++){const se=W[me];$=$.concat(se)}function N(me,ge,se){return ge||console.error("THREE.ExtrudeGeometry: vec does not exist"),ge.clone().multiplyScalar(se).add(me)}const I=$.length,G=X.length;function ee(me,ge,se){let we,Ee,z;const F=me.x-ge.x,ue=me.y-ge.y,be=se.x-me.x,Fe=se.y-me.y,He=F*F+ue*ue,rt=F*Fe-ue*be;if(Math.abs(rt)>Number.EPSILON){const Ke=Math.sqrt(He),je=Math.sqrt(be*be+Fe*Fe),Je=ge.x-ue/Ke,A=ge.y+F/Ke,D=se.x-Fe/je,O=se.y+be/je,te=((D-Je)*Fe-(O-A)*be)/(F*Fe-ue*be);we=Je+F*te-me.x,Ee=A+ue*te-me.y;const q=we*we+Ee*Ee;if(q<=2)return new Pe(we,Ee);z=Math.sqrt(q/2)}else{let Ke=!1;F>Number.EPSILON?be>Number.EPSILON&&(Ke=!0):F<-Number.EPSILON?be<-Number.EPSILON&&(Ke=!0):Math.sign(ue)===Math.sign(Fe)&&(Ke=!0),Ke?(we=-ue,Ee=F,z=Math.sqrt(He)):(we=F,Ee=ue,z=Math.sqrt(He/2))}return new Pe(we/z,Ee/z)}const re=[];for(let me=0,ge=P.length,se=ge-1,we=me+1;me<ge;me++,se++,we++)se===ge&&(se=0),we===ge&&(we=0),re[me]=ee(P[me],P[se],P[we]);const he=[];let pe,Ie=re.concat();for(let me=0,ge=W.length;me<ge;me++){const se=W[me];pe=[];for(let we=0,Ee=se.length,z=Ee-1,F=we+1;we<Ee;we++,z++,F++)z===Ee&&(z=0),F===Ee&&(F=0),pe[we]=ee(se[we],se[z],se[F]);he.push(pe),Ie=Ie.concat(pe)}for(let me=0;me<S;me++){const ge=me/S,se=m*Math.cos(ge*Math.PI/2),we=v*Math.sin(ge*Math.PI/2)+y;for(let Ee=0,z=P.length;Ee<z;Ee++){const F=N(P[Ee],re[Ee],we);at(F.x,F.y,-se)}for(let Ee=0,z=W.length;Ee<z;Ee++){const F=W[Ee];pe=he[Ee];for(let ue=0,be=F.length;ue<be;ue++){const Fe=N(F[ue],pe[ue],we);at(Fe.x,Fe.y,-se)}}}const De=v+y;for(let me=0;me<I;me++){const ge=p?N($[me],Ie[me],De):$[me];M?(R.copy(E.normals[0]).multiplyScalar(ge.x),T.copy(E.binormals[0]).multiplyScalar(ge.y),V.copy(b[0]).add(R).add(T),at(V.x,V.y,V.z)):at(ge.x,ge.y,0)}for(let me=1;me<=f;me++)for(let ge=0;ge<I;ge++){const se=p?N($[ge],Ie[ge],De):$[ge];M?(R.copy(E.normals[me]).multiplyScalar(se.x),T.copy(E.binormals[me]).multiplyScalar(se.y),V.copy(b[me]).add(R).add(T),at(V.x,V.y,V.z)):at(se.x,se.y,d/f*me)}for(let me=S-1;me>=0;me--){const ge=me/S,se=m*Math.cos(ge*Math.PI/2),we=v*Math.sin(ge*Math.PI/2)+y;for(let Ee=0,z=P.length;Ee<z;Ee++){const F=N(P[Ee],re[Ee],we);at(F.x,F.y,d+se)}for(let Ee=0,z=W.length;Ee<z;Ee++){const F=W[Ee];pe=he[Ee];for(let ue=0,be=F.length;ue<be;ue++){const Fe=N(F[ue],pe[ue],we);M?at(Fe.x,Fe.y+b[f-1].y,b[f-1].x+se):at(Fe.x,Fe.y,d+se)}}}Le(),Oe();function Le(){const me=n.length/3;if(p){let ge=0,se=I*ge;for(let we=0;we<G;we++){const Ee=X[we];Ge(Ee[2]+se,Ee[1]+se,Ee[0]+se)}ge=f+S*2,se=I*ge;for(let we=0;we<G;we++){const Ee=X[we];Ge(Ee[0]+se,Ee[1]+se,Ee[2]+se)}}else{for(let ge=0;ge<G;ge++){const se=X[ge];Ge(se[2],se[1],se[0])}for(let ge=0;ge<G;ge++){const se=X[ge];Ge(se[0]+I*f,se[1]+I*f,se[2]+I*f)}}r.addGroup(me,n.length/3-me,0)}function Oe(){const me=n.length/3;let ge=0;ne(P,ge),ge+=P.length;for(let se=0,we=W.length;se<we;se++){const Ee=W[se];ne(Ee,ge),ge+=Ee.length}r.addGroup(me,n.length/3-me,1)}function ne(me,ge){let se=me.length;for(;--se>=0;){const we=se;let Ee=se-1;Ee<0&&(Ee=me.length-1);for(let z=0,F=f+S*2;z<F;z++){const ue=I*z,be=I*(z+1),Fe=ge+we+ue,He=ge+Ee+ue,rt=ge+Ee+be,Ke=ge+we+be;We(Fe,He,rt,Ke)}}}function at(me,ge,se){l.push(me),l.push(ge),l.push(se)}function Ge(me,ge,se){Ve(me),Ve(ge),Ve(se);const we=n.length/3,Ee=x.generateTopUV(r,n,we-3,we-2,we-1);Te(Ee[0]),Te(Ee[1]),Te(Ee[2])}function We(me,ge,se,we){Ve(me),Ve(ge),Ve(we),Ve(ge),Ve(se),Ve(we);const Ee=n.length/3,z=x.generateSideWallUV(r,n,Ee-6,Ee-3,Ee-2,Ee-1);Te(z[0]),Te(z[1]),Te(z[3]),Te(z[1]),Te(z[2]),Te(z[3])}function Ve(me){n.push(l[me*3+0]),n.push(l[me*3+1]),n.push(l[me*3+2])}function Te(me){i.push(me.x),i.push(me.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,r=this.parameters.options;return kk(t,r,e)}static fromJSON(e,t){const r=[];for(let i=0,s=e.shapes.length;i<s;i++){const o=t[e.shapes[i]];r.push(o)}const n=e.options.extrudePath;return n!==void 0&&(e.options.extrudePath=new Lx[n.type]().fromJSON(n)),new qo(r,e.options)}}const Nk={generateTopUV:function(a,e,t,r,n){const i=e[t*3],s=e[t*3+1],o=e[r*3],l=e[r*3+1],c=e[n*3],f=e[n*3+1];return[new Pe(i,s),new Pe(o,l),new Pe(c,f)]},generateSideWallUV:function(a,e,t,r,n,i){const s=e[t*3],o=e[t*3+1],l=e[t*3+2],c=e[r*3],f=e[r*3+1],d=e[r*3+2],p=e[n*3],m=e[n*3+1],v=e[n*3+2],y=e[i*3],S=e[i*3+1],_=e[i*3+2];return Math.abs(o-f)<Math.abs(s-c)?[new Pe(s,1-l),new Pe(c,1-d),new Pe(p,1-v),new Pe(y,1-_)]:[new Pe(o,1-l),new Pe(f,1-d),new Pe(m,1-v),new Pe(S,1-_)]}};function kk(a,e,t){if(t.shapes=[],Array.isArray(a))for(let r=0,n=a.length;r<n;r++){const i=a[r];t.shapes.push(i.uuid)}else t.shapes.push(a.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class km extends It{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],n=[],i=[],s=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let f=0;f<e.length;f++)c(e[f]),this.addGroup(o,l,f),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new ln(n,3)),this.setAttribute("normal",new ln(i,3)),this.setAttribute("uv",new ln(s,2));function c(f){const d=n.length/3,p=f.extractPoints(t);let m=p.shape;const v=p.holes;Ha.isClockWise(m)===!1&&(m=m.reverse());for(let S=0,_=v.length;S<_;S++){const x=v[S];Ha.isClockWise(x)===!0&&(v[S]=x.reverse())}const y=Ha.triangulateShape(m,v);for(let S=0,_=v.length;S<_;S++){const x=v[S];m=m.concat(x)}for(let S=0,_=m.length;S<_;S++){const x=m[S];n.push(x.x,x.y,0),i.push(0,0,1),s.push(x.x,x.y)}for(let S=0,_=y.length;S<_;S++){const x=y[S],b=x[0]+d,M=x[1]+d,E=x[2]+d;r.push(b,M,E),l+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return Ok(t,e)}static fromJSON(e,t){const r=[];for(let n=0,i=e.shapes.length;n<i;n++){const s=t[e.shapes[n]];r.push(s)}return new km(r,e.curveSegments)}}function Ok(a,e){if(e.shapes=[],Array.isArray(a))for(let t=0,r=a.length;t<r;t++){const n=a[t];e.shapes.push(n.uuid)}else e.shapes.push(a.uuid);return e}class ah extends It{constructor(e=1,t=32,r=16,n=0,i=Math.PI*2,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(s+o,Math.PI);let c=0;const f=[],d=new C,p=new C,m=[],v=[],y=[],S=[];for(let _=0;_<=r;_++){const x=[],b=_/r;let M=0;_==0&&s==0?M=.5/t:_==r&&l==Math.PI&&(M=-.5/t);for(let E=0;E<=t;E++){const T=E/t;d.x=-e*Math.cos(n+T*i)*Math.sin(s+b*o),d.y=e*Math.cos(s+b*o),d.z=e*Math.sin(n+T*i)*Math.sin(s+b*o),v.push(d.x,d.y,d.z),p.copy(d).normalize(),y.push(p.x,p.y,p.z),S.push(T+M,1-b),x.push(c++)}f.push(x)}for(let _=0;_<r;_++)for(let x=0;x<t;x++){const b=f[_][x+1],M=f[_][x],E=f[_+1][x],T=f[_+1][x+1];(_!==0||s>0)&&m.push(b,M,T),(_!==r-1||l<Math.PI)&&m.push(M,E,T)}this.setIndex(m),this.setAttribute("position",new ln(v,3)),this.setAttribute("normal",new ln(y,3)),this.setAttribute("uv",new ln(S,2))}static fromJSON(e){return new ah(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Dk extends qn{constructor(e){super(),this.type="ShadowMaterial",this.color=new nt(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}Dk.prototype.isShadowMaterial=!0;class kx extends qn{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new nt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wo,this.normalScale=new Pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}kx.prototype.isMeshStandardMaterial=!0;class Fk extends kx{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Pe(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Cr(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new nt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new nt(1,1,1),this.specularTintMap=null,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new nt).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}Fk.prototype.isMeshPhysicalMaterial=!0;class Bk extends qn{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new nt(16777215),this.specular=new nt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wo,this.normalScale=new Pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Yf,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Bk.prototype.isMeshPhongMaterial=!0;class zk extends qn{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new nt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wo,this.normalScale=new Pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}zk.prototype.isMeshToonMaterial=!0;class Vk extends qn{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wo,this.normalScale=new Pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Vk.prototype.isMeshNormalMaterial=!0;class Uk extends qn{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new nt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Yf,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Uk.prototype.isMeshLambertMaterial=!0;class Gk extends qn{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new nt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wo,this.normalScale=new Pe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}Gk.prototype.isMeshMatcapMaterial=!0;class Hk extends As{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Hk.prototype.isLineDashedMaterial=!0;const dn={arraySlice:function(a,e,t){return dn.isTypedArray(a)?new a.constructor(a.subarray(e,t!==void 0?t:a.length)):a.slice(e,t)},convertArray:function(a,e,t){return!a||!t&&a.constructor===e?a:typeof e.BYTES_PER_ELEMENT=="number"?new e(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){function e(n,i){return a[n]-a[i]}const t=a.length,r=new Array(t);for(let n=0;n!==t;++n)r[n]=n;return r.sort(e),r},sortedArray:function(a,e,t){const r=a.length,n=new a.constructor(r);for(let i=0,s=0;s!==r;++i){const o=t[i]*e;for(let l=0;l!==e;++l)n[s++]=a[o+l]}return n},flattenJSON:function(a,e,t,r){let n=1,i=a[0];for(;i!==void 0&&i[r]===void 0;)i=a[n++];if(i===void 0)return;let s=i[r];if(s!==void 0)if(Array.isArray(s))do s=i[r],s!==void 0&&(e.push(i.time),t.push.apply(t,s)),i=a[n++];while(i!==void 0);else if(s.toArray!==void 0)do s=i[r],s!==void 0&&(e.push(i.time),s.toArray(t,t.length)),i=a[n++];while(i!==void 0);else do s=i[r],s!==void 0&&(e.push(i.time),t.push(s)),i=a[n++];while(i!==void 0)},subclip:function(a,e,t,r,n=30){const i=a.clone();i.name=e;const s=[];for(let l=0;l<i.tracks.length;++l){const c=i.tracks[l],f=c.getValueSize(),d=[],p=[];for(let m=0;m<c.times.length;++m){const v=c.times[m]*n;if(!(v<t||v>=r)){d.push(c.times[m]);for(let y=0;y<f;++y)p.push(c.values[m*f+y])}}d.length!==0&&(c.times=dn.convertArray(d,c.times.constructor),c.values=dn.convertArray(p,c.values.constructor),s.push(c))}i.tracks=s;let o=1/0;for(let l=0;l<i.tracks.length;++l)o>i.tracks[l].times[0]&&(o=i.tracks[l].times[0]);for(let l=0;l<i.tracks.length;++l)i.tracks[l].shift(-1*o);return i.resetDuration(),i},makeClipAdditive:function(a,e=0,t=a,r=30){r<=0&&(r=30);const n=t.tracks.length,i=e/r;for(let s=0;s<n;++s){const o=t.tracks[s],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=a.tracks.find(function(_){return _.name===o.name&&_.ValueTypeName===l});if(c===void 0)continue;let f=0;const d=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=d/3);let p=0;const m=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=m/3);const v=o.times.length-1;let y;if(i<=o.times[0]){const _=f,x=d-f;y=dn.arraySlice(o.values,_,x)}else if(i>=o.times[v]){const _=v*d+f,x=_+d-f;y=dn.arraySlice(o.values,_,x)}else{const _=o.createInterpolant(),x=f,b=d-f;_.evaluate(i),y=dn.arraySlice(_.resultBuffer,x,b)}l==="quaternion"&&new On().fromArray(y).normalize().conjugate().toArray(y);const S=c.times.length;for(let _=0;_<S;++_){const x=_*m+p;if(l==="quaternion")On.multiplyQuaternionsFlat(c.values,x,y,0,c.values,x);else{const b=m-p*2;for(let M=0;M<b;++M)c.values[x+M]-=y[M]}}}return a.blendMode=q1,a}};class qa{constructor(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{let s;n:{r:if(!(e<n)){for(let o=r+2;;){if(n===void 0){if(e<i)break r;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===o)break;if(i=n,n=t[++r],e<n)break t}s=t.length;break n}if(!(e>=i)){const o=t[1];e<o&&(r=2,i=o);for(let l=r-2;;){if(i===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===l)break;if(n=i,i=t[--r-1],e>=i)break t}s=r,r=0;break n}break e}for(;r<s;){const o=r+s>>>1;e<t[o]?s=o:r=o+1}if(n=t[r],i=t[r-1],i===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(n===void 0)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n;for(let s=0;s!==n;++s)t[s]=r[i+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}qa.prototype.beforeStart_=qa.prototype.copySampleValue_;qa.prototype.afterEnd_=qa.prototype.copySampleValue_;class Wk extends qa{constructor(e,t,r,n){super(e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Po,endingEnd:Po}}intervalChanged_(e,t,r){const n=this.parameterPositions;let i=e-2,s=e+1,o=n[i],l=n[s];if(o===void 0)switch(this.getSettings_().endingStart){case Io:i=e,o=2*t-r;break;case Ff:i=n.length-2,o=t+n[i]-n[i+1];break;default:i=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case Io:s=e,l=2*r-t;break;case Ff:s=1,l=r+n[1]-n[0];break;default:s=e-1,l=t}const c=(r-t)*.5,f=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-r),this._offsetPrev=i*f,this._offsetNext=s*f}interpolate_(e,t,r,n){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,f=this._offsetPrev,d=this._offsetNext,p=this._weightPrev,m=this._weightNext,v=(r-t)/(n-t),y=v*v,S=y*v,_=-p*S+2*p*y-p*v,x=(1+p)*S+(-1.5-2*p)*y+(-.5+p)*v+1,b=(-1-m)*S+(1.5+m)*y+.5*v,M=m*S-m*y;for(let E=0;E!==o;++E)i[E]=_*s[f+E]+x*s[c+E]+b*s[l+E]+M*s[d+E];return i}}class Ox extends qa{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e,t,r,n){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,f=(r-t)/(n-t),d=1-f;for(let p=0;p!==o;++p)i[p]=s[c+p]*d+s[l+p]*f;return i}}class Xk extends qa{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Bi{constructor(e,t,r,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=dn.convertArray(t,this.TimeBufferType),this.values=dn.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:dn.convertArray(e.times,Array),values:dn.convertArray(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(r.interpolation=n)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new Xk(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Ox(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Wk(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Of:t=this.InterpolantFactoryMethodDiscrete;break;case Df:t=this.InterpolantFactoryMethodLinear;break;case Ld:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Of;case this.InterpolantFactoryMethodLinear:return Df;case this.InterpolantFactoryMethodSmooth:return Ld}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,n=t.length;r!==n;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,n=t.length;r!==n;++r)t[r]*=e}return this}trim(e,t){const r=this.times,n=r.length;let i=0,s=n-1;for(;i!==n&&r[i]<e;)++i;for(;s!==-1&&r[s]>t;)--s;if(++s,i!==0||s!==n){i>=s&&(s=Math.max(s,1),i=s-1);const o=this.getValueSize();this.times=dn.arraySlice(r,i,s),this.values=dn.arraySlice(this.values,i*o,s*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,n=this.values,i=r.length;i===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let o=0;o!==i;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(s!==null&&s>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,s),e=!1;break}s=l}if(n!==void 0&&dn.isTypedArray(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=dn.arraySlice(this.times),t=dn.arraySlice(this.values),r=this.getValueSize(),n=this.getInterpolation()===Ld,i=e.length-1;let s=1;for(let o=1;o<i;++o){let l=!1;const c=e[o],f=e[o+1];if(c!==f&&(o!==1||c!==e[0]))if(n)l=!0;else{const d=o*r,p=d-r,m=d+r;for(let v=0;v!==r;++v){const y=t[d+v];if(y!==t[p+v]||y!==t[m+v]){l=!0;break}}}if(l){if(o!==s){e[s]=e[o];const d=o*r,p=s*r;for(let m=0;m!==r;++m)t[p+m]=t[d+m]}++s}}if(i>0){e[s]=e[i];for(let o=i*r,l=s*r,c=0;c!==r;++c)t[l+c]=t[o+c];++s}return s!==e.length?(this.times=dn.arraySlice(e,0,s),this.values=dn.arraySlice(t,0,s*r)):(this.times=e,this.values=t),this}clone(){const e=dn.arraySlice(this.times,0),t=dn.arraySlice(this.values,0),r=this.constructor,n=new r(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Bi.prototype.TimeBufferType=Float32Array;Bi.prototype.ValueBufferType=Float32Array;Bi.prototype.DefaultInterpolation=Df;class Zo extends Bi{}Zo.prototype.ValueTypeName="bool";Zo.prototype.ValueBufferType=Array;Zo.prototype.DefaultInterpolation=Of;Zo.prototype.InterpolantFactoryMethodLinear=void 0;Zo.prototype.InterpolantFactoryMethodSmooth=void 0;class Dx extends Bi{}Dx.prototype.ValueTypeName="color";class zf extends Bi{}zf.prototype.ValueTypeName="number";class Yk extends qa{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e,t,r,n){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=(r-t)/(n-t);let c=e*o;for(let f=c+o;c!==f;c+=4)On.slerpFlat(i,0,s,c-o,s,c,l);return i}}class _c extends Bi{InterpolantFactoryMethodLinear(e){return new Yk(this.times,this.values,this.getValueSize(),e)}}_c.prototype.ValueTypeName="quaternion";_c.prototype.DefaultInterpolation=Df;_c.prototype.InterpolantFactoryMethodSmooth=void 0;class jo extends Bi{}jo.prototype.ValueTypeName="string";jo.prototype.ValueBufferType=Array;jo.prototype.DefaultInterpolation=Of;jo.prototype.InterpolantFactoryMethodLinear=void 0;jo.prototype.InterpolantFactoryMethodSmooth=void 0;class Vf extends Bi{}Vf.prototype.ValueTypeName="vector";class gy{constructor(e,t=-1,r,n=ym){this.name=e,this.tracks=r,this.duration=t,this.blendMode=n,this.uuid=xi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,n=1/(e.fps||1);for(let s=0,o=r.length;s!==o;++s)t.push(qk(r[s]).scale(n));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let i=0,s=r.length;i!==s;++i)t.push(Bi.toJSON(r[i]));return n}static CreateFromMorphTargetSequence(e,t,r,n){const i=t.length,s=[];for(let o=0;o<i;o++){let l=[],c=[];l.push((o+i-1)%i,o,(o+1)%i),c.push(0,1,0);const f=dn.getKeyframeOrder(l);l=dn.sortedArray(l,1,f),c=dn.sortedArray(c,1,f),!n&&l[0]===0&&(l.push(i),c.push(c[0])),s.push(new zf(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/r))}return new this(e,-1,s)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const n=e;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===t)return r[n];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const n={},i=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],f=c.name.match(i);if(f&&f.length>1){const d=f[1];let p=n[d];p||(n[d]=p=[]),p.push(c)}}const s=[];for(const o in n)s.push(this.CreateFromMorphTargetSequence(o,n[o],t,r));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(d,p,m,v,y){if(m.length!==0){const S=[],_=[];dn.flattenJSON(m,S,_,v),S.length!==0&&y.push(new d(p,S,_))}},n=[],i=e.name||"default",s=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const p=c[d].keys;if(!(!p||p.length===0))if(p[0].morphTargets){const m={};let v;for(v=0;v<p.length;v++)if(p[v].morphTargets)for(let y=0;y<p[v].morphTargets.length;y++)m[p[v].morphTargets[y]]=-1;for(const y in m){const S=[],_=[];for(let x=0;x!==p[v].morphTargets.length;++x){const b=p[v];S.push(b.time),_.push(b.morphTarget===y?1:0)}n.push(new zf(".morphTargetInfluence["+y+"]",S,_))}l=m.length*(s||1)}else{const m=".bones["+t[d].name+"]";r(Vf,m+".position",p,"pos",n),r(_c,m+".quaternion",p,"rot",n),r(Vf,m+".scale",p,"scl",n)}}return n.length===0?null:new this(i,l,n,o)}resetDuration(){const e=this.tracks;let t=0;for(let r=0,n=e.length;r!==n;++r){const i=this.tracks[r];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function $k(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return zf;case"vector":case"vector2":case"vector3":case"vector4":return Vf;case"color":return Dx;case"quaternion":return _c;case"bool":case"boolean":return Zo;case"string":return jo}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}function qk(a){if(a.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=$k(a.type);if(a.times===void 0){const t=[],r=[];dn.flattenJSON(a.keys,t,r,"value"),a.times=t,a.values=r}return e.parse!==void 0?e.parse(a):new e(a.name,a.times,a.values,a.interpolation)}const Go={enabled:!1,files:{},add:function(a,e){this.enabled!==!1&&(this.files[a]=e)},get:function(a){if(this.enabled!==!1)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};class Zk{constructor(e,t,r){const n=this;let i=!1,s=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(f){o++,i===!1&&n.onStart!==void 0&&n.onStart(f,s,o),i=!0},this.itemEnd=function(f){s++,n.onProgress!==void 0&&n.onProgress(f,s,o),s===o&&(i=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(f){n.onError!==void 0&&n.onError(f)},this.resolveURL=function(f){return l?l(f):f},this.setURLModifier=function(f){return l=f,this},this.addHandler=function(f,d){return c.push(f,d),this},this.removeHandler=function(f){const d=c.indexOf(f);return d!==-1&&c.splice(d,2),this},this.getHandler=function(f){for(let d=0,p=c.length;d<p;d+=2){const m=c[d],v=c[d+1];if(m.global&&(m.lastIndex=0),m.test(f))return v}return null}}}const jk=new Zk;let Ja=class{constructor(e){this.manager=e!==void 0?e:jk,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(n,i){r.load(e,n,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};const gi={};let Kk=class extends Ja{constructor(e){super(e)}load(e,t,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=Go.get(e);if(s!==void 0)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;if(gi[e]!==void 0){gi[e].push({onLoad:t,onProgress:r,onError:n});return}const o=/^data:(.*?)(;base64)?,(.*)$/,l=e.match(o);let c;if(l){const f=l[1],d=!!l[2];let p=l[3];p=decodeURIComponent(p),d&&(p=atob(p));try{let m;const v=(this.responseType||"").toLowerCase();switch(v){case"arraybuffer":case"blob":const y=new Uint8Array(p.length);for(let _=0;_<p.length;_++)y[_]=p.charCodeAt(_);v==="blob"?m=new Blob([y.buffer],{type:f}):m=y.buffer;break;case"document":m=new DOMParser().parseFromString(p,f);break;case"json":m=JSON.parse(p);break;default:m=p;break}setTimeout(function(){t&&t(m),i.manager.itemEnd(e)},0)}catch(m){setTimeout(function(){n&&n(m),i.manager.itemError(e),i.manager.itemEnd(e)},0)}}else{gi[e]=[],gi[e].push({onLoad:t,onProgress:r,onError:n}),c=new XMLHttpRequest,c.open("GET",e,!0),c.addEventListener("load",function(f){const d=this.response,p=gi[e];if(delete gi[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Go.add(e,d);for(let m=0,v=p.length;m<v;m++){const y=p[m];y.onLoad&&y.onLoad(d)}i.manager.itemEnd(e)}else{for(let m=0,v=p.length;m<v;m++){const y=p[m];y.onError&&y.onError(f)}i.manager.itemError(e),i.manager.itemEnd(e)}},!1),c.addEventListener("progress",function(f){const d=gi[e];for(let p=0,m=d.length;p<m;p++){const v=d[p];v.onProgress&&v.onProgress(f)}},!1),c.addEventListener("error",function(f){const d=gi[e];delete gi[e];for(let p=0,m=d.length;p<m;p++){const v=d[p];v.onError&&v.onError(f)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),c.addEventListener("abort",function(f){const d=gi[e];delete gi[e];for(let p=0,m=d.length;p<m;p++){const v=d[p];v.onError&&v.onError(f)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const f in this.requestHeader)c.setRequestHeader(f,this.requestHeader[f]);c.send(null)}return i.manager.itemStart(e),c}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};class Fx extends Ja{constructor(e){super(e)}load(e,t,r,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=Go.get(e);if(s!==void 0)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function l(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1),Go.add(e,this),t&&t(this),i.manager.itemEnd(e)}function c(f){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1),n&&n(f),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}class Jk extends Ja{constructor(e){super(e)}load(e,t,r,n){const i=new eh,s=new Fx(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function l(c){s.load(e[c],function(f){i.images[c]=f,o++,o===6&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}for(let c=0;c<e.length;++c)l(c);return i}}class Qk extends Ja{constructor(e){super(e)}load(e,t,r,n){const i=new $n,s=new Fx(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(o){i.image=o;const l=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;i.format=l?za:Mn,i.needsUpdate=!0,t!==void 0&&t(i)},r,n),i}}class eO extends ai{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new rh(t,e))}getPoint(e){const t=e*this.getLength(),r=this.getCurveLengths();let n=0;for(;n<r.length;){if(r[n]>=t){const i=r[n]-t,s=this.curves[n],o=s.getLength(),l=o===0?0:1-i/o;return s.getPointAt(l)}n++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let n=0,i=this.curves;n<i.length;n++){const s=i[n],o=s&&s.isEllipseCurve?e*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,l=s.getPoints(o);for(let c=0;c<l.length;c++){const f=l[c];r&&r.equals(f)||(t.push(f),r=f)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const n=e.curves[t];this.curves.push(new Lx[n.type]().fromJSON(n))}return this}}class Qp extends eO{constructor(e){super(),this.type="Path",this.currentPoint=new Pe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new rh(this.currentPoint.clone(),new Pe(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,n){const i=new Im(this.currentPoint.clone(),new Pe(e,t),new Pe(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this}bezierCurveTo(e,t,r,n,i,s){const o=new Pm(this.currentPoint.clone(),new Pe(e,t),new Pe(r,n),new Pe(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new Nm(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,n,i,s){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,r,n,i,s),this}absarc(e,t,r,n,i,s){return this.absellipse(e,t,r,r,n,i,s),this}ellipse(e,t,r,n,i,s,o,l){const c=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+c,t+f,r,n,i,s,o,l),this}absellipse(e,t,r,n,i,s,o,l){const c=new nh(e,t,r,n,i,s,o,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const f=c.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Om extends Qp{constructor(e){super(e),this.uuid=xi(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const n=e.holes[t];this.holes.push(new Qp().fromJSON(n))}return this}}class Oi extends Dt{constructor(e,t=1){super(),this.type="Light",this.color=new nt(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}Oi.prototype.isLight=!0;class tO extends Oi{constructor(e,t,r){super(e,r),this.type="HemisphereLight",this.position.copy(Dt.DefaultUp),this.updateMatrix(),this.groundColor=new nt(t)}copy(e){return Oi.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}tO.prototype.isHemisphereLight=!0;const _y=new Xe,yy=new C,xy=new C;class Dm{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Pe(512,512),this.map=null,this.mapPass=null,this.matrix=new Xe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new th,this._frameExtents=new Pe(1,1),this._viewportCount=1,this._viewports=[new Gt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;yy.setFromMatrixPosition(e.matrixWorld),t.position.copy(yy),xy.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(xy),t.updateMatrixWorld(),_y.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_y),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Bx extends Dm{constructor(){super(new En(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,r=ic*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;(r!==t.fov||n!==t.aspect||i!==t.far)&&(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Bx.prototype.isSpotLightShadow=!0;class nO extends Oi{constructor(e,t,r=0,n=Math.PI/3,i=0,s=1){super(e,t),this.type="SpotLight",this.position.copy(Dt.DefaultUp),this.updateMatrix(),this.target=new Dt,this.distance=r,this.angle=n,this.penumbra=i,this.decay=s,this.shadow=new Bx}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}nO.prototype.isSpotLight=!0;const Sy=new Xe,Nl=new C,up=new C;class zx extends Dm{constructor(){super(new En(90,1,.5,500)),this._frameExtents=new Pe(4,2),this._viewportCount=6,this._viewports=[new Gt(2,1,1,1),new Gt(0,1,1,1),new Gt(3,1,1,1),new Gt(1,1,1,1),new Gt(3,0,1,1),new Gt(1,0,1,1)],this._cubeDirections=[new C(1,0,0),new C(-1,0,0),new C(0,0,1),new C(0,0,-1),new C(0,1,0),new C(0,-1,0)],this._cubeUps=[new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,0,1),new C(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,n=this.matrix,i=e.distance||r.far;i!==r.far&&(r.far=i,r.updateProjectionMatrix()),Nl.setFromMatrixPosition(e.matrixWorld),r.position.copy(Nl),up.copy(r.position),up.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(up),r.updateMatrixWorld(),n.makeTranslation(-Nl.x,-Nl.y,-Nl.z),Sy.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sy)}}zx.prototype.isPointLightShadow=!0;class rO extends Oi{constructor(e,t,r=0,n=1){super(e,t),this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new zx}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}rO.prototype.isPointLight=!0;class Vx extends Dm{constructor(){super(new Yo(-5,5,5,-5,.5,500))}}Vx.prototype.isDirectionalLightShadow=!0;class Ux extends Oi{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Dt.DefaultUp),this.updateMatrix(),this.target=new Dt,this.shadow=new Vx}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Ux.prototype.isDirectionalLight=!0;class Gx extends Oi{constructor(e,t){super(e,t),this.type="AmbientLight"}}Gx.prototype.isAmbientLight=!0;class iO extends Oi{constructor(e,t,r=10,n=10){super(e,t),this.type="RectAreaLight",this.width=r,this.height=n}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}iO.prototype.isRectAreaLight=!0;class Hx{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new C)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,n=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*i),t.addScaledVector(s[3],.488603*r),t.addScaledVector(s[4],1.092548*(r*n)),t.addScaledVector(s[5],1.092548*(n*i)),t.addScaledVector(s[6],.315392*(3*i*i-1)),t.addScaledVector(s[7],1.092548*(r*i)),t.addScaledVector(s[8],.546274*(r*r-n*n)),t}getIrradianceAt(e,t){const r=e.x,n=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],2*.511664*n),t.addScaledVector(s[2],2*.511664*i),t.addScaledVector(s[3],2*.511664*r),t.addScaledVector(s[4],2*.429043*r*n),t.addScaledVector(s[5],2*.429043*n*i),t.addScaledVector(s[6],.743125*i*i-.247708),t.addScaledVector(s[7],2*.429043*r*i),t.addScaledVector(s[8],.429043*(r*r-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(e,t+n*3);return this}toArray(e=[],t=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(e,t+n*3);return e}static getBasisAt(e,t){const r=e.x,n=e.y,i=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-n*n)}}Hx.prototype.isSphericalHarmonics3=!0;class Fm extends Oi{constructor(e=new Hx,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Fm.prototype.isLightProbe=!0;class aO{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}}class Za extends It{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Za.prototype.isInstancedBufferGeometry=!0;class Er extends mt{constructor(e,t,r,n=1){typeof r=="number"&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,r),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Er.prototype.isInstancedBufferAttribute=!0;class sO extends Ja{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=Go.get(e);if(s!==void 0)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(l){Go.add(e,l),t&&t(l),i.manager.itemEnd(e)}).catch(function(l){n&&n(l),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)}}sO.prototype.isImageBitmapLoader=!0;let nf;const oO={getContext:function(){return nf===void 0&&(nf=new(window.AudioContext||window.webkitAudioContext)),nf},setContext:function(a){nf=a}};class lO extends Ja{constructor(e){super(e)}load(e,t,r,n){const i=this,s=new Kk(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(o){try{const l=o.slice(0);oO.getContext().decodeAudioData(l,function(f){t(f)})}catch(l){n?n(l):console.error(l),i.manager.itemError(e)}},r,n)}}class cO extends Fm{constructor(e,t,r=1){super(void 0,r);const n=new nt().set(e),i=new nt().set(t),s=new C(n.r,n.g,n.b),o=new C(i.r,i.g,i.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(l),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(c)}}cO.prototype.isHemisphereLightProbe=!0;class uO extends Fm{constructor(e,t=1){super(void 0,t);const r=new nt().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}uO.prototype.isAmbientLightProbe=!0;const wy=new Xe,by=new Xe;class Wx{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new En,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new En,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),i=t.eyeSep/2,s=i*t.near/t.focus,o=t.near*Math.tan(Do*t.fov*.5)/t.zoom;let l,c;by.elements[12]=-i,wy.elements[12]=i,l=-o*t.aspect+s,c=o*t.aspect+s,n.elements[0]=2*t.near/(c-l),n.elements[8]=(c+l)/(c-l),this.cameraL.projectionMatrix.copy(n),l=-o*t.aspect-s,c=o*t.aspect-s,n.elements[0]=2*t.near/(c-l),n.elements[8]=(c+l)/(c-l),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(by),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(wy)}}class fO extends Dt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}class hO{constructor(e,t,r){this.binding=e,this.valueSize=r;let n,i,s;switch(t){case"quaternion":n=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,n=this.valueSize,i=e*n+n;let s=this.cumulativeWeight;if(s===0){for(let o=0;o!==n;++o)r[i+o]=r[o];s=t}else{s+=t;const o=t/s;this._mixBufferRegion(r,i,0,o,n)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const l=t*this._origIndex;this._mixBufferRegion(r,n,l,1-i,t)}s>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(r[l]!==r[l+t]){o.setValue(r,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,n=r*this._origIndex;e.getValue(t,n);for(let i=r,s=n;i!==s;++i)t[i]=t[n+i%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,n,i){if(n>=.5)for(let s=0;s!==i;++s)e[t+s]=e[r+s]}_slerp(e,t,r,n){On.slerpFlat(e,t,e,t,e,r,n)}_slerpAdditive(e,t,r,n,i){const s=this._workIndex*i;On.multiplyQuaternionsFlat(e,s,e,t,e,r),On.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,r,n,i){const s=1-n;for(let o=0;o!==i;++o){const l=t+o;e[l]=e[l]*s+e[r+o]*n}}_lerpAdditive(e,t,r,n,i){for(let s=0;s!==i;++s){const o=t+s;e[o]=e[o]+e[r+s]*n}}}const Bm="\\[\\]\\.:\\/",dO=new RegExp("["+Bm+"]","g"),zm="[^"+Bm+"]",pO="[^"+Bm.replace("\\.","")+"]",mO=/((?:WC+[\/:])*)/.source.replace("WC",zm),vO=/(WCOD+)?/.source.replace("WCOD",pO),gO=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zm),_O=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zm),yO=new RegExp("^"+mO+vO+gO+_O+"$"),xO=["material","materials","bones"];class SO{constructor(e,t,r){const n=r||Qt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class Qt{constructor(e,t,r){this.path=t,this.parsedPath=r||Qt.parseTrackName(t),this.node=Qt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Qt.Composite(e,t,r):new Qt(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(dO,"")}static parseTrackName(e){const t=yO.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const i=r.nodeName.substring(n+1);xO.indexOf(i)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(i){for(let s=0;s<i.length;s++){const o=i[s];if(o.name===t||o.uuid===t)return o;const l=r(o.children);if(l)return l}return null},n=r(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)e[t++]=r[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,n=t.propertyName;let i=t.propertyIndex;if(e||(e=Qt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let c=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===c){c=f;break}break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const s=e[n];if(s===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(i!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[i]!==void 0&&(i=e.morphTargetDictionary[i])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Qt.Composite=SO;Qt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Qt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Qt.prototype.GetterByBindingType=[Qt.prototype._getValue_direct,Qt.prototype._getValue_array,Qt.prototype._getValue_arrayElement,Qt.prototype._getValue_toArray];Qt.prototype.SetterByBindingTypeAndVersioning=[[Qt.prototype._setValue_direct,Qt.prototype._setValue_direct_setNeedsUpdate,Qt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Qt.prototype._setValue_array,Qt.prototype._setValue_array_setNeedsUpdate,Qt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Qt.prototype._setValue_arrayElement,Qt.prototype._setValue_arrayElement_setNeedsUpdate,Qt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Qt.prototype._setValue_fromArray,Qt.prototype._setValue_fromArray_setNeedsUpdate,Qt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class wO{constructor(e,t,r=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=n;const i=t.tracks,s=i.length,o=new Array(s),l={endingStart:Po,endingEnd:Po};for(let c=0;c!==s;++c){const f=i[c].createInterpolant(null);o[c]=f,f.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=n3,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const n=this._clip.duration,i=e._clip.duration,s=i/n,o=n/i;e.warp(1,s,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const n=this._mixer,i=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=i,l[1]=i+r,c[0]=e/s,c[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,n){if(!this.enabled){this._updateWeight(e);return}const i=this._startTime;if(i!==null){const l=(e-i)*r;if(l<0||r===0)return;this._startTime=null,t=r*l}t*=this._updateTimeScale(e);const s=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case q1:for(let f=0,d=l.length;f!==d;++f)l[f].evaluate(s),c[f].accumulateAdditive(o);break;case ym:default:for(let f=0,d=l.length;f!==d;++f)l[f].evaluate(s),c[f].accumulate(n,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let n=this.time+e,i=this._loopCount;const s=r===r3;if(e===0)return i===-1?n:s&&(i&1)===1?t-n:n;if(r===t3){i===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(i===-1&&(e>=0?(i=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),n>=t||n<0){const o=Math.floor(n/t);n-=t*o,i+=Math.abs(o);const l=this.repetitions-i;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(s&&(i&1)===1)return t-n}return n}_setEndings(e,t,r){const n=this._interpolantSettings;r?(n.endingStart=Io,n.endingEnd=Io):(e?n.endingStart=this.zeroSlopeAtStart?Io:Po:n.endingStart=Ff,t?n.endingEnd=this.zeroSlopeAtEnd?Io:Po:n.endingEnd=Ff)}_scheduleFading(e,t,r){const n=this._mixer,i=n.time;let s=this._weightInterpolant;s===null&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,l=s.sampleValues;return o[0]=i,l[0]=t,o[1]=i+e,l[1]=r,this}}class bO extends Cs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,s=e._propertyBindings,o=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let f=c[l];f===void 0&&(f={},c[l]=f);for(let d=0;d!==i;++d){const p=n[d],m=p.name;let v=f[m];if(v!==void 0)s[d]=v;else{if(v=s[d],v!==void 0){v._cacheIndex===null&&(++v.referenceCount,this._addInactiveBinding(v,l,m));continue}const y=t&&t._propertyBindings[d].binding.parsedPath;v=new hO(Qt.create(r,m,y),p.ValueTypeName,p.getValueSize()),++v.referenceCount,this._addInactiveBinding(v,l,m),s[d]=v}o[d].resultBuffer=v.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,r)}const t=e._propertyBindings;for(let r=0,n=t.length;r!==n;++r){const i=t[r];i.useCount++===0&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,n=t.length;r!==n;++r){const i=t[r];--i.useCount===0&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const n=this._actions,i=this._actionsByClip;let s=i[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=s;else{const o=s.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,s=this._actionsByClip,o=s[i],l=o.knownActions,c=l[l.length-1],f=e._byClipCacheIndex;c._byClipCacheIndex=f,l[f]=c,l.pop(),e._byClipCacheIndex=null;const d=o.actionByRoot,p=(e._localRoot||this._root).uuid;delete d[p],l.length===0&&delete s[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,n=t.length;r!==n;++r){const i=t[r];--i.referenceCount===0&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_addInactiveBinding(e,t,r){const n=this._bindingsByRootAndName,i=this._bindings;let s=n[t];s===void 0&&(s={},n[t]=s),s[r]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,s=this._bindingsByRootAndName,o=s[n],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[i],Object.keys(o).length===0&&delete s[n]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new Ox(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i}clipAction(e,t,r){const n=t||this._root,i=n.uuid;let s=typeof e=="string"?gy.findByName(n,e):e;const o=s!==null?s.uuid:e,l=this._actionsByClip[o];let c=null;if(r===void 0&&(s!==null?r=s.blendMode:r=ym),l!==void 0){const d=l.actionByRoot[i];if(d!==void 0&&d.blendMode===r)return d;c=l.knownActions[0],s===null&&(s=c._clip)}if(s===null)return null;const f=new wO(this,s,t,r);return this._bindAction(f,c),this._addInactiveAction(f,o,i),f}existingAction(e,t){const r=t||this._root,n=r.uuid,i=typeof e=="string"?gy.findByName(r,e):e,s=i?i.uuid:e,o=this._actionsByClip[s];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let r=t-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),s=this._accuIndex^=1;for(let c=0;c!==r;++c)t[c]._update(n,e,i,s);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(i!==void 0){const s=i.knownActions;for(let o=0,l=s.length;o!==l;++o){const c=s[o];this._deactivateAction(c);const f=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=f,t[f]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const s in r){const o=r[s].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,i=n[t];if(i!==void 0)for(const s in i){const o=i[s];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}bO.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class MO extends vc{constructor(e,t,r=1){super(e,t),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}MO.prototype.isInstancedInterleavedBuffer=!0;class Xx{constructor(e,t,r=0,n=1/0){this.ray=new ja(e,t),this.near=r,this.far=n,this.camera=null,this.layers=new bm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,r=[]){return em(e,this,r,t),r.sort(My),r}intersectObjects(e,t=!1,r=[]){for(let n=0,i=e.length;n<i;n++)em(e[n],this,r,t);return r.sort(My),r}}function My(a,e){return a.distance-e.distance}function em(a,e,t,r){if(a.layers.test(e.layers)&&a.raycast(e,t),r===!0){const n=a.children;for(let i=0,s=n.length;i<s;i++)em(n[i],e,t,!0)}}class EO extends Dt{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}EO.prototype.isImmediateRenderObject=!0;const Ta=new C,rf=new Xe,fp=new Xe;class CO extends $r{constructor(e){const t=Yx(e),r=new It,n=[],i=[],s=new nt(0,0,1),o=new nt(0,1,0);for(let c=0;c<t.length;c++){const f=t[c];f.parent&&f.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(s.r,s.g,s.b),i.push(o.r,o.g,o.b))}r.setAttribute("position",new ln(n,3)),r.setAttribute("color",new ln(i,3));const l=new As({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,r=this.geometry,n=r.getAttribute("position");fp.copy(this.root.matrixWorld).invert();for(let i=0,s=0;i<t.length;i++){const o=t[i];o.parent&&o.parent.isBone&&(rf.multiplyMatrices(fp,o.matrixWorld),Ta.setFromMatrixPosition(rf),n.setXYZ(s,Ta.x,Ta.y,Ta.z),rf.multiplyMatrices(fp,o.parent.matrixWorld),Ta.setFromMatrixPosition(rf),n.setXYZ(s+1,Ta.x,Ta.y,Ta.z),s+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Yx(a){const e=[];a&&a.isBone&&e.push(a);for(let t=0;t<a.children.length;t++)e.push.apply(e,Yx(a.children[t]));return e}class AO extends $r{constructor(e=10,t=10,r=4473924,n=8947848){r=new nt(r),n=new nt(n);const i=t/2,s=e/t,o=e/2,l=[],c=[];for(let p=0,m=0,v=-o;p<=t;p++,v+=s){l.push(-o,0,v,o,0,v),l.push(v,0,-o,v,0,o);const y=p===i?r:n;y.toArray(c,m),m+=3,y.toArray(c,m),m+=3,y.toArray(c,m),m+=3,y.toArray(c,m),m+=3}const f=new It;f.setAttribute("position",new ln(l,3)),f.setAttribute("color",new ln(c,3));const d=new As({vertexColors:!0,toneMapped:!1});super(f,d),this.type="GridHelper"}}class TO extends $r{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new It;n.setAttribute("position",new ln(t,3)),n.setAttribute("color",new ln(r,3));const i=new As({vertexColors:!0,toneMapped:!1});super(n,i),this.type="AxesHelper"}setColors(e,t,r){const n=new nt,i=this.geometry.attributes.color.array;return n.set(e),n.toArray(i,0),n.toArray(i,3),n.set(t),n.toArray(i,6),n.toArray(i,9),n.set(r),n.toArray(i,12),n.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const RO=new Float32Array(1);new Int32Array(RO.buffer);ai.create=function(a,e){return console.log("THREE.Curve.create() has been deprecated"),a.prototype=Object.create(ai.prototype),a.prototype.constructor=a,a.prototype.getPoint=e,a};Qp.prototype.fromPoints=function(a){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(a)};AO.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};CO.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Ja.prototype.extractUrlBase=function(a){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),aO.extractUrlBase(a)};Ja.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};An.prototype.center=function(a){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(a)};An.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};An.prototype.isIntersectionBox=function(a){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)};An.prototype.isIntersectionSphere=function(a){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)};An.prototype.size=function(a){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(a)};Lr.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};th.prototype.setFromMatrix=function(a){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(a)};Cn.prototype.flattenToArrayOffset=function(a,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,e)};Cn.prototype.multiplyVector3=function(a){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)};Cn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Cn.prototype.applyToBufferAttribute=function(a){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)};Cn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Cn.prototype.getInverse=function(a){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(a).invert()};Xe.prototype.extractPosition=function(a){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(a)};Xe.prototype.flattenToArrayOffset=function(a,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,e)};Xe.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new C().setFromMatrixColumn(this,3)};Xe.prototype.setRotationFromQuaternion=function(a){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(a)};Xe.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Xe.prototype.multiplyVector3=function(a){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)};Xe.prototype.multiplyVector4=function(a){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)};Xe.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Xe.prototype.rotateAxis=function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),a.transformDirection(this)};Xe.prototype.crossVector=function(a){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)};Xe.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Xe.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Xe.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Xe.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Xe.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Xe.prototype.applyToBufferAttribute=function(a){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)};Xe.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Xe.prototype.makeFrustum=function(a,e,t,r,n,i){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(a,e,r,t,n,i)};Xe.prototype.getInverse=function(a){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(a).invert()};yi.prototype.isIntersectionLine=function(a){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(a)};On.prototype.multiplyVector3=function(a){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)};On.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};ja.prototype.isIntersectionBox=function(a){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)};ja.prototype.isIntersectionPlane=function(a){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(a)};ja.prototype.isIntersectionSphere=function(a){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)};Wr.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Wr.prototype.barycoordFromPoint=function(a,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(a,e)};Wr.prototype.midpoint=function(a){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(a)};Wr.prototypenormal=function(a){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(a)};Wr.prototype.plane=function(a){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(a)};Wr.barycoordFromPoint=function(a,e,t,r,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Wr.getBarycoord(a,e,t,r,n)};Wr.normal=function(a,e,t,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Wr.getNormal(a,e,t,r)};Om.prototype.extractAllPoints=function(a){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(a)};Om.prototype.extrude=function(a){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new qo(this,a)};Om.prototype.makeGeometry=function(a){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new km(this,a)};Pe.prototype.fromAttribute=function(a,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,e,t)};Pe.prototype.distanceToManhattan=function(a){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(a)};Pe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};C.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};C.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};C.prototype.getPositionFromMatrix=function(a){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)};C.prototype.getScaleFromMatrix=function(a){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)};C.prototype.getColumnFromMatrix=function(a,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,a)};C.prototype.applyProjection=function(a){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(a)};C.prototype.fromAttribute=function(a,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,e,t)};C.prototype.distanceToManhattan=function(a){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(a)};C.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Gt.prototype.fromAttribute=function(a,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,e,t)};Gt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Dt.prototype.getChildByName=function(a){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(a)};Dt.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Dt.prototype.translate=function(a,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,a)};Dt.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Dt.prototype.applyMatrix=function(a){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)};Object.defineProperties(Dt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Ut.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Ut.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),i3},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});bx.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};En.prototype.setLens=function(a,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(a)};Object.defineProperties(Oi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=a}}});Object.defineProperties(mt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Bf},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Bf)}}});mt.prototype.setDynamic=function(a){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(a===!0?Bf:rc),this};mt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},mt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};It.prototype.addIndex=function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(a)};It.prototype.addAttribute=function(a,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(a,new mt(arguments[1],arguments[2]))):a==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(a,e)};It.prototype.addDrawCall=function(a,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(a,e)};It.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};It.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};It.prototype.removeAttribute=function(a){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(a)};It.prototype.applyMatrix=function(a){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)};Object.defineProperties(It.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});vc.prototype.setDynamic=function(a){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(a===!0?Bf:rc),this};vc.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};qo.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};qo.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};qo.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Ga.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(qn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new nt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(a){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=a===W1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(a){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=a}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(wi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=a}}});Zt.prototype.clearTarget=function(a,e,t,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(a),this.clear(e,t,r)};Zt.prototype.animate=function(a){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(a)};Zt.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Zt.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Zt.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Zt.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Zt.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Zt.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Zt.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Zt.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Zt.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Zt.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Zt.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Zt.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Zt.prototype.enableScissorTest=function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(a)};Zt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Zt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Zt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Zt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Zt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Zt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Zt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Zt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Zt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Zt.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Zt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=a}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(a){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=a===!0?Jf:Ar}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(_x.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Rn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=a}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=a}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=a}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=a}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=a}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=a}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=a}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=a}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=a}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=a}}});fO.prototype.load=function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new lO().load(a,function(r){e.setBuffer(r)}),this};Cm.prototype.updateCubeMap=function(a,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(a,e)};Cm.prototype.clear=function(a,e,t,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(a,e,t,r)};Xo.crossOrigin=void 0;Xo.loadTexture=function(a,e,t,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const n=new Qk;n.setCrossOrigin(this.crossOrigin);const i=n.load(a,t,void 0,r);return e&&(i.mapping=e),i};Xo.loadTextureCube=function(a,e,t,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const n=new Jk;n.setCrossOrigin(this.crossOrigin);const i=n.load(a,t,void 0,r);return e&&(i.mapping=e),i};Xo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Xo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:H1}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=H1);function Di(a){"@babel/helpers - typeof";return Di=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Di(a)}function K(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function Ey(a,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}}function J(a,e,t){return e&&Ey(a.prototype,e),t&&Ey(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function si(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function uc(a,e){return uc=Object.setPrototypeOf||function(r,n){return r.__proto__=n,r},uc(a,e)}function ve(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(a,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),writable:!1}),e&&uc(a,e)}function Me(a,e){if(e&&(Di(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return si(a)}function H(a){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},H(a)}function LO(a){if(Array.isArray(a))return a}function PO(a,e){var t=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(t!=null){var r=[],n=!0,i=!1,s,o;try{for(t=t.call(a);!(n=(s=t.next()).done)&&(r.push(s.value),!(e&&r.length===e));n=!0);}catch(l){i=!0,o=l}finally{try{!n&&t.return!=null&&t.return()}finally{if(i)throw o}}return r}}function tm(a,e){(e==null||e>a.length)&&(e=a.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=a[t];return r}function $x(a,e){if(a){if(typeof a=="string")return tm(a,e);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tm(a,e)}}function IO(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pn(a,e){return LO(a)||PO(a,e)||$x(a,e)||IO()}var Uf=function(){return Uf=Object.assign||function(a){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n])}return a},Uf.apply(this,arguments)},NO={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",fadeColor:"transparent",animation:"spinner-line-fade-default",rotate:0,direction:1,speed:1,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:"0 0 1px transparent",position:"absolute"},kO=function(){function a(e){e===void 0&&(e={}),this.opts=Uf(Uf({},NO),e)}return a.prototype.spin=function(e){return this.stop(),this.el=document.createElement("div"),this.el.className=this.opts.className,this.el.setAttribute("role","progressbar"),nm(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top,transform:"scale("+this.opts.scale+")"}),e&&e.insertBefore(this.el,e.firstChild||null),OO(this.el,this.opts),this},a.prototype.stop=function(){return this.el&&(typeof requestAnimationFrame<"u"?cancelAnimationFrame(this.animateId):clearTimeout(this.animateId),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},a}();function nm(a,e){for(var t in e)a.style[t]=e[t];return a}function Cy(a,e){return typeof a=="string"?a:a[e%a.length]}function OO(a,e){var t=Math.round(e.corners*e.width*500)/1e3+"px",r="none";e.shadow===!0?r="0 2px 4px #000":typeof e.shadow=="string"&&(r=e.shadow);for(var n=DO(r),i=0;i<e.lines;i++){var s=~~(360/e.lines*i+e.rotate),o=nm(document.createElement("div"),{position:"absolute",top:-e.width/2+"px",width:e.length+e.width+"px",height:e.width+"px",background:Cy(e.fadeColor,i),borderRadius:t,transformOrigin:"left",transform:"rotate("+s+"deg) translateX("+e.radius+"px)"}),l=i*e.direction/e.lines/e.speed;l-=1/e.speed;var c=nm(document.createElement("div"),{width:"100%",height:"100%",background:Cy(e.color,i),borderRadius:t,boxShadow:FO(n,s),animation:1/e.speed+"s linear "+l+"s infinite "+e.animation});o.appendChild(c),a.appendChild(o)}}function DO(a){for(var e=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,t=[],r=0,n=a.split(",");r<n.length;r++){var i=n[r],s=i.match(e);if(s!==null){var o=+s[2],l=+s[5],c=s[4],f=s[7];o===0&&!c&&(c=f),l===0&&!f&&(f=c),c===f&&t.push({prefix:s[1]||"",x:o,y:l,xUnits:c,yUnits:f,end:s[8]})}}return t}function FO(a,e){for(var t=[],r=0,n=a;r<n.length;r++){var i=n[r],s=BO(i.x,i.y,e);t.push(i.prefix+s[0]+i.xUnits+" "+s[1]+i.yUnits+i.end)}return t.join(", ")}function BO(a,e,t){var r=t*Math.PI/180,n=Math.sin(r),i=Math.cos(r);return[Math.round((a*i+e*n)*1e3)/1e3,Math.round((-a*n+e*i)*1e3)/1e3]}var sh=function(){function a(){K(this,a),this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return J(a,[{key:"start",value:function(){this.startTime=a.now(),this.oldTime=this.startTime,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1}},{key:"getElapsedTime",value:function(){return this.update(),this.elapsedTime}},{key:"update",value:function(){var t=0;if(this.running){var r=a.now();t=.001*(r-this.oldTime),this.oldTime=r,this.elapsedTime+=t}return t}}]),a}();sh.now=function(){var a=typeof window<"u"&&window.performance;return a&&a.now?a.now.bind(a):Date.now}();var Ay=sh.now;function Ty(a,e,t){var r=document.createElement(a);return r.id=e,r.style.cssText=t,r}var zO=function(){function a(){K(this,a),this.domElement=Ty("div","stats","padding:8px"),this._text=Ty("p","fps","margin:0;color:silver;font-size:large"),this.domElement.appendChild(this._text),this._startTime=Ay(),this._prevTime=this._startTime,this._deltas=new Array(20),this._index=0,this._total=0,this._count=0}return J(a,[{key:"end",value:function(){var t=Ay(),r=t-this._startTime;return this._count<this._deltas.length?this._count++:this._total-=this._deltas[this._index],this._total+=r,this._deltas[this._index]=r,this._index=(this._index+1)%this._deltas.length,this.ms=this._total/this._count,this.fps=1e3/this.ms,t>this._prevTime+1e3&&(this._text.textContent=this.fps.toPrecision(2),this._prevTime=t),t}},{key:"update",value:function(){this._startTime=this.end()}},{key:"show",value:function(t){t===void 0&&(t=!0),this.domElement.style.display=t?"block":"none"}}]),a}();function VO(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function UO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ql(a,e,t){return UO()?Ql=Reflect.construct:Ql=function(n,i,s){var o=[null];o.push.apply(o,i);var l=Function.bind.apply(n,o),c=new l;return s&&uc(c,s.prototype),c},Ql.apply(null,arguments)}function fc(a){var e=typeof Map=="function"?new Map:void 0;return fc=function(r){if(r===null||!VO(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,n)}function n(){return Ql(r,arguments,H(this).constructor)}return n.prototype=Object.create(r.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),uc(n,r)},fc(a)}function hp(a,e){return!a||a===e}function pr(){this._handlers={}}pr.prototype.addEventListener=function(a,e,t){var r=this._handlers[a];r||(this._handlers[a]=[],r=this._handlers[a]);var n=[e,t];function i(s){return s[0]===n[0]&&s[1]===n[1]}xe.find(r,i)===void 0&&r.push(n)};pr.prototype.removeEventListener=function(a,e,t){var r=this;xe.forEach(r._handlers,function(n,i){xe.remove(n,function(s){return hp(a,i)&&hp(e,s[0])&&hp(t,s[1]||r)})}),this._handlers=xe.omitBy(r._handlers,function(n){return n.length===0})};pr.prototype.dispatchEvent=function(a){var e=this;xe.forEach(this._handlers[a.type],function(t){var r=t[1]||e;t[0].apply(r,[a])})};var bi={debug:0,info:1,report:2,warn:3,error:4};function hr(){pr.call(this),this.console=!1,this._priority=bi.warn}hr.prototype=Object.create(pr.prototype);hr.prototype.constructor=hr;hr.prototype.instantiate=function(){return new hr};function qx(a){if(!xe.isNumber(a))throw new Error("Wrong log level specified!");return a}Object.defineProperty(hr.prototype,"level",{get:function(){var e=this;return xe.findKey(bi,function(t){return t===e._priority})},set:function(e){this._priority=qx(bi[e])}});hr.prototype.levels=function(){return Object.keys(bi)};hr.prototype.message=function(a,e){var t=qx(bi[a]);this._message(t,e)};hr.prototype.debug=function(a){this._message(bi.debug,a)};hr.prototype.info=function(a){this._message(bi.info,a)};hr.prototype.report=function(a){this._message(bi.report,a)};hr.prototype.warn=function(a){this._message(bi.warn,a)};hr.prototype.error=function(a){this._message(bi.error,a)};hr.prototype._message=function(a,e){if(!(a<this._priority)){var t=xe.findKey(bi,function(n){return n===a});if(e=String(e),this.console){var r="miew:".concat(t,": ").concat(e);t==="error"?console.error(r):t==="warn"?console.warn(r):console.log(r)}this.dispatchEvent({type:"message",level:t,message:e})}};var kn=new hr;function GO(a){var e=HO();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function HO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rm={DEFAULT:0,SAFARI:1};function WO(a,e){var t=function(n){return String.fromCharCode(parseInt(n.substr(1),16))};return encodeURIComponent(a).replace(e,t).replace(/%20/g,"+")}function im(a){return decodeURIComponent(a.replace(/\+/g," "))}function Zx(a){a=a||window.location.search;for(var e=a.substring(a.indexOf("?")+1),t=/([^&=]+)=?([^&]*)/g,r=[],n;(n=t.exec(e))!==null;)r.push([im(n[1]),im(n[2])]);return r}function XO(a){for(var e={},t=Zx(a),r=0;r<t.length;++r){var n=pn(t[r],2),i=n[0],s=n[1];e[i]=s}return e}function YO(a){if(typeof URL<"u")try{return typeof window<"u"?new URL(a,window.location).href:new URL(a).href}catch{}if(typeof document<"u"){var e=document.createElement("a");return e.href=a,e.href}return a}function $O(a){for(var e=[],t=0,r=a.length;t<r;++t)e[e.length]=a[t].charCodeAt(0).toString(16);var n=e.join("|");return new RegExp("%(?:".concat(n,")"),"gi")}function qO(a,e,t){var r=document.createElement(a),n,i;if(e){var s=Object.keys(e);for(n=0,i=s.length;n<i;++n){var o=s[n];r.setAttribute(o,e[o])}}if(t)for(t instanceof Array||(t=[t]),n=0,i=t.length;n<i;++n){var l=t[n];typeof l=="string"?r.appendChild(document.createTextNode(l)):l instanceof HTMLElement&&r.appendChild(l)}return r}function ZO(a,e,t,r){return a.prototype=xe.assign(Object.create(e.prototype),{constructor:a},t),r&&xe.assign(a,r),a}function am(a,e){var t=a,r,n;if(a instanceof Array)for(t=new Array(a.length),r=0,n=a.length;r<n;++r)t[r]=am(a[r]);else if(a instanceof Object){t=Object.create(a);var i=Object.keys(a);for(r=0,n=i.length;r<n;++r){var s=i[r],o=a[s],l=am(o);l!==o&&(t[s]=l)}e&&Object.keys(t).length>0&&(t=Object.create(t))}return t}function jO(a){var e="0000000".concat(a.toString(16)).substr(-6);return"#".concat(e)}function Vm(a){var e=!1;this.enable=function(c){e=c};var t=0,r=Object.keys(a);function n(c,f){return function(){var d=Vm.spaces.substr(0,t*2);e&&kn.debug("".concat(d+f," {")),t++;for(var p=arguments.length,m=new Array(p),v=0;v<p;v++)m[v]=arguments[v];var y=c.apply(this,m);return t--,e&&kn.debug("".concat(d,"} // ").concat(f)),y}}for(var i=0,s=r.length;i<s;++i){var o=r[i],l=a[o];l instanceof Function&&o!=="constructor"&&(a[o]=n(l,o))}}Vm.spaces="                                                                                          ";var jx=function(a){ve(t,a);var e=GO(t);function t(r){var n;return K(this,t),n=e.call(this),n.name="OutOfMemoryError",n.message=r,n}return J(t)}(fc(Error));function KO(a,e){var t=null;try{t=new a(e)}catch(r){throw r instanceof RangeError?new jx(r.message):r}return t}function Kx(a){for(var e=new Uint8Array(a),t="",r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return window.btoa(t)}function Um(a){for(var e=window.atob(a),t=new Uint8Array(e.length),r=0;r<t.length;++r)t[r]=e[r].charCodeAt(0);return t.buffer}function JO(a,e){return Kx(new e(a).buffer)}function QO(a,e){return Array.prototype.slice.call(new e(Um(a)))}function e4(a,e){var t=[];if(e&&a){for(var r=Object.keys(a),n=0;n<r.length;++n){var i=r[n],s=a[i];!(s instanceof Object)&&typeof e[i]<"u"&&e[i]!==s&&t.push("".concat(i,":").concat(s))}if(t.length>0)return"!".concat(t.join())}return""}function sm(a){if(xe.isPlainObject(a))return!0;var e=a&&Object.getPrototypeOf(a);return!!e&&!e.hasOwnProperty("constructor")&&sm(e)}function Jx(a,e){var t={};return xe.forIn(a,function(r,n){var i=e[n];if(sm(r)&&sm(i)){var s=Jx(r,i);xe.isEmpty(s)||(t[n]=s)}else xe.isEqual(r,i)||(t[n]=r)}),t}function t4(a,e){function t(r,n){xe.forIn(r,function(i,s){var o=n+(n.length>0?".":"");i instanceof Object?t(i,o+s):i!==void 0&&e(i,o+s)})}t(a,"")}function n4(a){return xe.isString(a)?'"'.concat(a.replace(/"/g,'\\"'),'"'):a}function r4(a){if(!xe.isString(a))return a;if(a[0]==='"'&&a[a.length-1]==='"')return a=a.slice(1,a.length-1),a.replace(/\\"/g,'"');if(a[0]==="'"&&a[a.length-1]==="'")return a=a.slice(1,a.length-1),a.replace(/\\'/g,"'");throw new SyntaxError("Incorrect string format, can't unqute it")}function Qx(a){return a.slice(Math.max(0,a.lastIndexOf("."))||1/0)}function i4(a){var e=Qx(a),t=a.slice(0,a.length-e.length);return[t,e]}function Ry(a){var e=a.split(/[:;,]/),t=e.length;return t>=3&&e[t-2]==="base64"?new Blob([Um(e[t-1])]):null}function a4(){return navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&navigator.userAgent.indexOf("CriOS")===-1&&navigator.userAgent.indexOf("FxiOS")===-1?rm.SAFARI:rm.DEFAULT}function s4(a){typeof window<"u"&&window.open().document.write('<body style="margin:0"><img src="'.concat(a,'" /></body>'))}function o4(a,e){if(!(!a||a.substr(0,5)!=="data:")){if(e||(e=["screenshot-",+new Date,".png"].join("")),typeof window<"u"&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(Ry(a),e);else if(typeof document<"u"){var t=document.createElement("a");t.download=e,t.innerHTML="download",t.href=window.URL.createObjectURL(Ry(a)),document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}function l4(a,e,t){var r=new Blob([a]);if(e||(e=["data",+new Date].join("")),t?e+=".".concat(t):e+=r.type||".bin",typeof window<"u"&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(r,e);else if(typeof document<"u"){var n=document.createElement("a");n.download=e,n.innerHTML="download",n.href=window.URL.createObjectURL(r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}}function c4(a,e,t,r){for(var n=0,i=t.length;n<i;++n)for(var s=0;s<r;++s)e[n*r+s]=a[t[n]*r+s]}function u4(a){var e=a.cloneNode(!0);return e.worldPos=a.worldPos,e}var f4=/^[a-zA-Z0-9_]*$/,Ly=['"',"",'"'];function h4(a){return f4.test(a)?a:(Ly[1]=a,Ly.join(""))}function d4(a,e){var t=new a.constructor(a.length+e.length);return t.set(a),t.set(e,a.length),t}function p4(a){if(a.length<=0)return null;for(var e=a.reduce(function(s,o){return s+o.length},0),t=new a[0].constructor(e),r=0,n=0;r<a.length;r++){var i=a[r].length;t.set(a[r],n),n+=i}return t}var ke={browserType:rm,encodeQueryComponent:WO,decodeQueryComponent:im,getUrlParameters:Zx,getUrlParametersAsDict:XO,resolveURL:YO,generateRegExp:$O,createElement:qO,deriveClass:ZO,deriveDeep:am,hexColor:jO,DebugTracer:Vm,OutOfMemoryError:jx,allocateTyped:KO,bytesFromBase64:Um,bytesToBase64:Kx,arrayFromBase64:QO,arrayToBase64:JO,compareOptionsWithDefaults:e4,objectsDiff:Jx,forInRecursive:t4,enquoteString:n4,unquoteString:r4,getBrowser:a4,shotOpen:s4,shotDownload:o4,copySubArrays:c4,shallowCloneNode:u4,correctSelectorIdentifier:h4,getFileExtension:Qx,splitFileName:i4,download:l4,concatTypedArraysUnsafe:d4,mergeTypedArraysUnsafe:p4};function m4(a){var e=v4();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function v4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var g4=function(a){ve(t,a);var e=m4(t);function t(){var r;return K(this,t),r=e.call(this),r._shouldCancel=!1,r}return J(t,[{key:"cancel",value:function(){this._shouldCancel=!0,this.dispatchEvent({type:"cancel"})}},{key:"shouldCancel",value:function(){return this._shouldCancel}},{key:"notify",value:function(n){this.dispatchEvent({type:"notification",slaveEvent:n})}}]),t}(pr),Py=0,kl={modes:{BS:{atom:.23,bond:.15,space:.5,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},VW:{polyComplexity:{poor:4,low:6,medium:8,high:16,ultra:32}},LN:{multibond:!0,showarom:!0,offsarom:.2,chunkarom:10,atom:.23,lineWidth:2},LC:{bond:.2,space:0,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},SA:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},SE:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},QS:{isoValue:.5,gaussLim:{poor:1.5,low:2,medium:2.5,high:3,ultra:4},scale:1,wireframe:!1,gridSpacing:{poor:2,low:1.5,medium:1,high:.5,ultra:.25},subset:"",zClip:!1},CS:{probeRadius:1.4,isoValue:1.5,wireframe:!1,probePositions:30,polyComplexity:{poor:.5,low:1,medium:1.5,high:1.75,ultra:2},subset:"",zClip:!1},TR:{radius:.3,polyComplexity:{poor:12,low:16,medium:32,high:64,ultra:64}},TU:{radius:.3,heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},CA:{radius:.3,depth:.25,ss:{helix:{width:1,arrow:2},strand:{width:1,arrow:2}},heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},TX:{template:"{{Chain}}.{{Residue}}{{Sequence}}.{{Name}}",horizontalAlign:"center",verticalAlign:"middle",dx:0,dy:0,dz:1,fg:"none",bg:"0x202020",showBg:!0},VD:{kSigma:1,kSigmaMed:2,kSigmaMax:4,frame:!0,isoMode:!1,polyComplexity:{poor:2,low:3,medium:4,high:8,ultra:10}}},colorers:{EL:{carbon:-1},UN:{color:16777215},CO:{subset:"charged",color:16711680,baseColor:16777215},CB:{color:9474192,factor:.6},SQ:{gradient:"rainbow"},TM:{gradient:"temp",min:5,max:40},OC:{gradient:"reds"},HY:{gradient:"blue-red"},MO:{gradient:"rainbow"}},antialias:!0,camFov:45,camNear:.5,camFar:100,camDistance:2.5,radiusToFit:1,fogNearFactor:.5,fogFarFactor:1,fogAlpha:1,fogColor:0,fogColorEnable:!1,palette:"JM",resolution:"medium",autoResolution:!1,autoPreset:!0,preset:"default",presets:{default:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],empty:[],wire:[{mode:"LN",colorer:"EL",selector:"all",material:"SF"}],small:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],macro:[{mode:"CA",colorer:"SS",selector:"not hetatm",material:"SF"},{mode:"BS",colorer:"EL",selector:"hetatm and not water",material:"SF"}]},objects:{line:{color:4294967295,dashSize:.3,gapSize:.05}},bg:{color:2105376,transparent:!1},draft:{clipPlane:!1,clipPlaneFactor:.5,clipPlaneSpeed:3e-5},plugins:{},axes:!0,fog:!0,fps:!0,zSprites:!0,isoSurfaceFakeOpacity:!0,suspendRender:!0,nowater:!1,autobuild:!0,fxaa:!0,outline:{on:!1,color:0,threshold:.1,thickness:1},ao:!1,shadow:{on:!1,type:"random",radius:1},autoRotation:0,maxfps:30,fbxprec:4,autoRotationAxisFixed:!0,zooming:!0,picking:!0,pick:"atom",editing:!1,aromatic:!1,singleUnit:!0,stereo:"NONE",interpolateViews:!0,transparency:"prepass",translationSpeed:2,debug:{example:3.5,text:"hello!",good:!0,ssaoKernelRadius:.7,ssaoFactor:.7,stereoBarrel:.25},use:{multiFile:!1}};function eS(){pr.call(this),this.old=null,this.now={},this._changed={},this.reset()}ke.deriveClass(eS,pr,{defaults:kl,set:function(e,t){if(xe.isString(e)){var r=xe.get(this.now,e);r!==t&&(xe.set(this.now,e,t),this._notifyChange(e,t))}else{var n=ke.objectsDiff(e,this.now);xe.isEmpty(n)||(xe.merge(this.now,n),this._notifyChanges(n))}},get:function(e,t){return xe.get(this.now,e,t)},reset:function(){var e=ke.objectsDiff(kl,this.now);this.now=xe.cloneDeep(kl),this.old=null,this._notifyChanges(e),this._changed={}},checkpoint:function(){this.old=xe.cloneDeep(this.now),this._changed={}},_notifyChange:function(e,t){this._changed[e]=!0,this.dispatchEvent({type:"change:".concat(e),value:t})},_notifyChanges:function(e){var t=this;ke.forInRecursive(e,function(r,n){t._notifyChange(n,r)})},changed:function(){if(!this.old)return[];var e=this.old,t=this.now,r=xe.filter(Object.keys(this._changed),function(n){return xe.get(e,n)!==xe.get(t,n)});return r},applyDiffs:function(e){if(e.hasOwnProperty("VERSION")&&e.VERSION!==Py)throw new Error("Settings version does not match!");delete e.VERSION,this.reset(),this.set(e)},getDiffs:function(e){var t=ke.objectsDiff(this.now,kl);return e&&(t.VERSION=Py),t},setPluginOpts:function(e,t){kl.plugins[e]=xe.cloneDeep(t),this.now.plugins[e]=xe.cloneDeep(t)}});var fe=new eS,Yn=0;function tS(a){return!(!a||a==="0"||xe.isString(a)&&a.toLowerCase()==="false")}var Gm={string:String,number:Number,boolean:tS},_4="=",Hm="!",nS=":",rS=",",iS="$;@/?";function y4(){var a=":,";return ke.generateRegExp(iS+a)}function x4(){var a=" ";return ke.generateRegExp(iS+a)}var S4=y4();function Iy(a){return ke.encodeQueryComponent(a,S4)}var w4=x4();function Ny(a){return ke.encodeQueryComponent(a,w4)}function Rf(a){var e=a.reps;if(!e){var t=fe.now.presets,r=a.preset||fe.now.preset;if(e=t[r],!e){kn.warn('Unknown preset "'.concat(r,'"'));var n=Object.keys(t),i=pn(n,1);r=i[0],e=t[r]}a.preset=r,a.reps=ke.deriveDeep(e,!0)}}function af(a,e,t){Rf(a);var r=a.reps[Yn];r.hasOwnProperty(e)&&(Yn=a.reps.length,a.reps[Yn]=ke.deriveDeep(r,!0)),t!==void 0&&(a.reps[Yn][e]=t)}function b4(a,e,t){a._objects===void 0&&(a._objects=[]);var r=pn(t,2),n=r[0],i=r[1],s={type:n,params:e};i!==void 0&&(s.opts=i),a._objects[a._objects.length]=s}function M4(a,e){var t=a.indexOf(",");return t>=0?(e.push(a.substr(t+1).split(",")),a.substr(0,t)):a}function sf(a,e,t){if(a){var r=a.indexOf(Hm),n=M4(a.substr(0,r>=0?r:void 0),t);if(r>=0){var i=a.substr(r+1).split(rS);if(a=n,e){var s=e[a],o=ke.deriveDeep(s,!0);i.forEach(function(l){var c=l.split(nS,2),f=decodeURIComponent(c[0]),d=decodeURIComponent(c[1]),p=Gm[Di(xe.get(s,f))];p?xe.set(o,f,p(d)):kn.warn('Unknown argument "'.concat(f,'" for option "').concat(a,'"'))}),Object.keys(o).length>0&&(a=[a,o])}}else a=n}return a}var dp={l:"load",load:String,t:"type",type:String,v:"view",view:String,u:"unit",unit:Number,menu:tS,o:"object",object:function(e,t){var r=[],n=sf(e,fe.defaults.objects,r);Array.isArray(n)||(n=[n]),b4(t,r[0],n)},p:"preset",preset:function(e,t){t.preset=e,t.reps=null,Rf(t)},r:"rep",rep:function(e,t){Rf(t),Yn=Number(e),Yn=Yn<=t.reps.length?Yn<0?0:Yn:t.reps.length,Yn===t.reps.length&&(t.reps[Yn]=Yn>0?ke.deriveDeep(t.reps[Yn-1],!0):ke.deriveDeep(fe.defaults.presets.default[0],!0))},s:"select",select:function(e,t){af(t,"selector",e)},m:"mode",mode:function(e,t){af(t,"mode",sf(e,fe.defaults.modes))},c:"color",color:function(e,t){af(t,"colorer",sf(e,fe.defaults.colorers))},mt:"material",material:function(e,t){af(t,"material",sf(e,fe.defaults.materials))},dup:function(e,t){Rf(t);var r=t.reps,n=r[Yn];Yn=r.length,r[Yn]=ke.deriveDeep(n,!0)},ar:"autoResolution"};function aS(a){Yn=0;for(var e={},t=0,r=a.length;t<r;++t){var n=a[t],i=n[0],s=n[1];if(dp.hasOwnProperty(i)){for(var o=dp[i];xe.isString(o);)i=o,o=dp[i];if(typeof o=="function"){var l=o(s,e);l!==void 0&&(e[i]=l)}}else{var c=Gm[Di(xe.get(fe.defaults,i))];c?xe.set(e,"settings.".concat(i),c(s)):kn.warn('Unknown option "'.concat(i,'"'))}}return e}function E4(a){return aS(ke.getUrlParameters("?".concat(a||"")))}function C4(a){return aS(ke.getUrlParameters(a))}function sS(a){var e=[],t=0;return ke.forInRecursive(a,function(r,n){e[t++]=Ny(n)+nS+Ny(r)}),e.join(rS)}function pp(a){return xe.isArray(a)?a.length<2?a[0]:"".concat(a[0]).concat(Hm).concat(sS(a[1])):a}function A4(a){if(!(!a||!a.type)){var e=a.type;return xe.isArray(a.params)&&a.params.length>0&&(e+=",".concat(a.params.join(","))),a.opts&&(e+=Hm+sS(a.opts)),e}}function T4(a){var e=[],t=0;function r(c,f){f!=null&&(e[t++]=Iy(c)+_4+Iy(f))}function n(c){if(c)for(var f=0,d=c.length;f<d;++f)xe.isEmpty(c[f])||(r("r",f),r("s",c[f].selector),r("m",pp(c[f].mode)),r("c",pp(c[f].colorer)),r("mt",pp(c[f].material)))}function i(c){if(c)for(var f=0,d=c.length;f<d;++f)r("o",A4(c[f]))}r("l",a.load),r("u",a.unit),r("p",a.preset),n(a.reps),i(a._objects),r("v",a.view),ke.forInRecursive(a.settings,function(c,f){f!=="preset"&&r(f,c)});var s="";if(typeof window<"u"){var o=window,l=o.location;s="".concat(l.protocol,"//").concat(l.host).concat(l.pathname)}return e.length>0&&(s+="?".concat(e.join("&"))),s}function oS(a){var e=[],t=0;return ke.forInRecursive(a,function(r,n){e[t++]="".concat(n,"=").concat(ke.enquoteString(r))}),e.join(" ")}function mp(a){return xe.isArray(a)?a.length<2?a[0]:"".concat(a[0]," ").concat(oS(a[1])):a}function R4(a){if(!(!a||!a.type)){var e=a.type;return xe.isArray(a.params)&&a.params.length>0&&(e+=" ".concat(a.params.map(ke.enquoteString).join(" "))),a.opts&&(e+=" ".concat(oS(a.opts))),e}}function L4(a,e){var t=[],r=0;function n(i,s){s!=null&&(t[r++]=i+s)}return xe.isEmpty(a)?null:(n("",e),n("s=",ke.enquoteString(a.selector)),n("m=",mp(a.mode)),n("c=",mp(a.colorer)),n("mt=",mp(a.material)),t.join(" "))}function P4(a){var e=[],t=0;function r(s,o,l){if(o!=null){var c=typeof o=="string"&&l?'"':"";e[t++]="".concat(s," ").concat(c).concat(o).concat(c).trim()}}function n(s){if(s)for(var o=0,l=s.length;o<l;++o)r("rep",L4(s[o],o))}function i(s){if(s)for(var o=0,l=s.length;o<l;++o)r("",R4(s[o]))}return r("set","autobuild false"),r("load",a.load,!0),r("unit",a.unit),r("preset",a.preset),n(a.reps),i(a._objects),ke.forInRecursive(a.settings,function(s,o){o!=="preset"&&r("set ".concat(o),s,!0)}),r("view",a.view),r("set","autobuild true"),e.join(`
`)}var om={fromURL:C4,fromAttr:E4,adapters:Gm,toURL:T4,toScript:P4};function qe(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var Si=function(){function a(e,t,r,n,i,s,o,l,c,f,d){K(this,a),this.index=-1,this.residue=e,this.name=t,this.element=r,this.position=n,this.role=i,this.mask=1,this.het=s,this.serial=o,this.location=(l||" ").charCodeAt(0),this.occupancy=c||1,this.temperature=f,this.charge=d,this.hydrogenCount=-1,this.radicalCount=0,this.valence=-1,this.bonds=[],this.flags=0,r.name==="H"?this.flags|=a.Flags.HYDROGEN:r.name==="C"&&(this.flags|=a.Flags.CARBON)}return J(a,[{key:"isHet",value:function(){return this.het}},{key:"isHydrogen",value:function(){return this.element.number===1}},{key:"getVisualName",value:function(){var t=this.name;return t.length>0?t:this.element.name.trim()}},{key:"forEachBond",value:function(t){for(var r=this.bonds,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"getFullName",value:function(){var t="";return this.residue!==null&&(this.residue._chain!==null&&(t+="".concat(this.residue._chain.getName(),".")),t+="".concat(this.residue._sequence,".")),t+=this.name,t}}]),a}();qe(Si,"Flags",{CARBON:1,HYDROGEN:8,NONPOLARH:4104});var Ce=J(function a(e,t,r,n,i,s,o){K(this,a),this.number=e,this.name=t,this.fullName=r,this.weight=n,this.radius=i,this.radiusBonding=s,this.hydrogenValency=o});qe(Ce,"Constants",{U1:1,Lead:2,U2:3,Wing:4,U18:18});qe(Ce,"Role",{N:Ce.Constants.U1,CA:Ce.Constants.Lead,C:Ce.Constants.U2,O:Ce.Constants.Wing,SG:Ce.Constants.U18});qe(Ce,"ByAtomicNumber",[null,new Ce(1,"H","Hydrogen",1.008,1.2,.23,[1]),new Ce(2,"HE","Helium",4.003,1.4,.93,[0]),new Ce(3,"LI","Lithium",6.941,1.82,.68,[1]),new Ce(4,"BE","Beryllium",9.012,1.7,.35,[2]),new Ce(5,"B","Boron",10.81,2.08,.83,[3]),new Ce(6,"C","Carbon",12.011,1.95,.68,[4]),new Ce(7,"N","Nitrogen",14.007,1.85,.68,[3,5]),new Ce(8,"O","Oxygen",15.999,1.7,.68,[2,4]),new Ce(9,"F","Fluorine",18.998,1.73,.64,[1]),new Ce(10,"NE","Neon",20.18,1.54,1.12,[0]),new Ce(11,"NA","Sodium",22.99,2.27,.97,[1]),new Ce(12,"MG","Magnesium",24.305,1.73,1.1,[2]),new Ce(13,"AL","Aluminum",26.981,2.05,1.35,[3]),new Ce(14,"SI","Silicon",28.086,2.1,1.2,[4]),new Ce(15,"P","Phosphorus",30.974,2.08,.75,[3,5]),new Ce(16,"S","Sulfur",32.07,2,1.02,[2,4,6]),new Ce(17,"CL","Chlorine",35.453,1.97,.99,[1,3,5,7]),new Ce(18,"AR","Argon",39.948,1.88,1.57,[0]),new Ce(19,"K","Potassium",39.1,2.75,1.33,[1]),new Ce(20,"CA","Calcium",40.08,1.973,.99,[2]),new Ce(21,"SC","Scandium",44.956,1.7,1.44,[0]),new Ce(22,"TI","Titanium",47.88,1.7,1.47,[0]),new Ce(23,"V","Vanadium",50.941,1.7,1.33,[0]),new Ce(24,"CR","Chromium",52,1.7,1.35,[0]),new Ce(25,"MN","Manganese",54.938,1.7,1.35,[0]),new Ce(26,"FE","Iron",55.847,1.7,1.34,[0]),new Ce(27,"CO","Cobalt",58.93,1.7,1.33,[0]),new Ce(28,"NI","Nickel",58.69,1.63,1.5,[0]),new Ce(29,"CU","Copper",63.55,1.4,1.52,[0]),new Ce(30,"ZN","Zinc",65.39,1.39,1.45,[0]),new Ce(31,"GA","Gallium",69.72,1.87,1.22,[3]),new Ce(32,"GE","Germanium",72.61,1.7,1.17,[4]),new Ce(33,"AS","Arsenic",74.92,1.85,1.21,[3,5]),new Ce(34,"SE","Selenium",78.96,1.9,1.22,[2,4,6]),new Ce(35,"BR","Bromine",79.9,2.1,1.21,[1,3,5,7]),new Ce(36,"KR","Krypton",83.8,2.02,1.91,[0]),new Ce(37,"RB","Rubidium",85.47,1.7,1.47,[1]),new Ce(38,"SR","Strontium",87.62,1.7,1.12,[2]),new Ce(39,"Y","Yttrium",88.91,1.7,1.78,[0]),new Ce(40,"ZR","Zirconium",91.22,1.7,1.56,[0]),new Ce(41,"NB","Niobium",92.91,1.7,1.48,[0]),new Ce(42,"MO","Molybdenum",95.94,1.7,1.47,[0]),new Ce(43,"TC","Technetium",98.91,1.7,1.35,[0]),new Ce(44,"RU","Ruthenium",101.07,1.7,1.4,[0]),new Ce(45,"RH","Rhodium",102.91,1.7,1.45,[0]),new Ce(46,"PD","Palladium",106.42,1.63,1.5,[0]),new Ce(47,"AG","Silver",107.87,1.72,1.59,[0]),new Ce(48,"CD","Cadmium",112.41,1.58,1.69,[0]),new Ce(49,"IN","Indium",114.82,1.93,1.63,[3]),new Ce(50,"SN","Tin",118.71,2.17,1.46,[2,4]),new Ce(51,"SB","Antimony",121.75,2.2,1.46,[3,5]),new Ce(52,"TE","Tellurium",127.6,2.06,1.47,[2,4,6]),new Ce(53,"I","Iodine",126.91,2.15,1.4,[1,3,5,7]),new Ce(54,"XE","Xenon",131.29,2.16,1.98,[0]),new Ce(55,"CS","Cesium",132.91,1.7,1.67,[1]),new Ce(56,"BA","Barium",137.33,1.7,1.34,[2]),new Ce(57,"LA","Lanthanum",138.91,1.7,1.87,[0]),new Ce(58,"CE","Cerium",140.12,1.7,1.83,[0]),new Ce(59,"PR","Praseodymium",140.91,1.7,1.82,[0]),new Ce(60,"ND","Neodymium",144.24,1.7,1.81,[0]),new Ce(61,"PM","Promethium",144.9,1.7,1.8,[0]),new Ce(62,"SM","Samarium",150.36,1.7,1.8,[0]),new Ce(63,"EU","Europium",151.96,1.7,1.99,[0]),new Ce(64,"GD","Gadolinium",157.25,1.7,1.79,[0]),new Ce(65,"TB","Terbium",158.93,1.7,1.76,[0]),new Ce(66,"DY","Dysprosium",162.5,1.7,1.75,[0]),new Ce(67,"HO","Holmium",164.93,1.7,1.74,[0]),new Ce(68,"ER","Erbium",167.26,1.7,1.73,[0]),new Ce(69,"TM","Thulium",168.93,1.7,1.72,[0]),new Ce(70,"YB","Ytterbium",173.04,1.7,1.94,[0]),new Ce(71,"LU","Lutetium",174.97,1.7,1.72,[0]),new Ce(72,"HF","Hafnium",178.49,1.7,1.57,[0]),new Ce(73,"TA","Tantalum",180.95,1.7,1.43,[0]),new Ce(74,"W","Tungsten",183.85,1.7,1.37,[0]),new Ce(75,"RE","Rhenium",186.21,1.7,1.35,[0]),new Ce(76,"OS","Osmium",190.2,1.7,1.37,[0]),new Ce(77,"IR","Iridium",192.22,1.7,1.32,[0]),new Ce(78,"PT","Platinum",195.08,1.72,1.5,[0]),new Ce(79,"AU","Gold",196.97,1.66,1.5,[0]),new Ce(80,"HG","Mercury",200.59,1.55,1.7,[0]),new Ce(81,"TL","Thallium",204.38,1.96,1.55,[1,3]),new Ce(82,"PB","Lead",207.2,2.02,1.54,[2,4]),new Ce(83,"BI","Bismuth",208.98,1.7,1.54,[3,5]),new Ce(84,"PO","Polonium",210,1.7,1.68,[2,4,6]),new Ce(85,"AT","Astatine",210,1.7,1.7,[1,3,5,7]),new Ce(86,"RN","Radon",222,1.7,2.4,[0]),new Ce(87,"FR","Francium",223,1.7,2,[1]),new Ce(88,"RA","Radium",226.03,1.7,1.9,[2]),new Ce(89,"AC","Actinium",227.03,1.7,1.88,[0]),new Ce(90,"TH","Thorium",232.04,1.7,1.79,[0]),new Ce(91,"PA","Protactinium",231.04,1.7,1.61,[0]),new Ce(92,"U","Uranium",238.03,1.86,1.58,[0]),new Ce(93,"NP","Neptunium",237.05,1.7,1.55,[0]),new Ce(94,"PU","Plutonium",239.1,1.7,1.53,[0]),new Ce(95,"AM","Americium",243.1,1.7,1.51,[0]),new Ce(96,"CM","Curium",247.1,1.7,1.5,[0]),new Ce(97,"BK","Berkelium",247.1,1.7,1.5,[0]),new Ce(98,"CF","Californium",252.1,1.7,1.5,[0]),new Ce(99,"ES","Einsteinium",252.1,1.7,1.5,[0]),new Ce(100,"FM","Fermium",257.1,1.7,1.5,[0]),new Ce(101,"MD","Mendelevium",256.1,1.7,1.5,[0]),new Ce(102,"NO","Nobelium",259.1,1.7,1.5,[0]),new Ce(103,"LR","Lawrencium",260.1,1.7,1.5,[0]),new Ce(104,"RF","Rutherfordium",261,1.7,1.6,[0]),new Ce(105,"DB","Dubnium",262,1.7,1.6,[0]),new Ce(106,"SG","Seaborgium",263,1.7,1.6,[0]),new Ce(107,"BH","Bohrium",262,1.7,1.6,[0]),new Ce(108,"HS","Hassium",265,1.7,1.6,[0]),new Ce(109,"MT","Meitnerium",268,1.7,1.6,[0])]);qe(Ce,"ByName",{D:new Ce(1,"D","Deuterium",2.014,1.2,.23,[1]),T:new Ce(1,"T","Tritium",3.016,1.2,.23,[1])});(function(){for(var a=Ce.ByAtomicNumber,e=Ce.ByName,t=0,r=a.length;t<r;++t){var n=a[t];n&&(e[n.name]=n)}})();Ce.getByName=function(a){var e=Ce.ByName[a];return e||(e=Ce.ByName[a]=new Ce(0,a,"Unknown",0,1,.01,[0])),e};var lS={UNKNOWN:0,COVALENT:1,AROMATIC:2};function I4(a){return a.position}var Rs=function(){function a(e,t,r,n,i){if(K(this,a),this._left=e,this._right=t,this._fixed=i,this._index=-1,e>t)throw new Error("In a bond atom indices must be in increasing order");this._order=r,this._type=n}return J(a,[{key:"getLeft",value:function(){return this._left}},{key:"getRight",value:function(){return this._right}},{key:"getOrder",value:function(){return this._order}},{key:"calcLength",value:function(){return this._left.position.distanceTo(this._right.position)}},{key:"_forEachNeighbour",value:function(t,r){for(var n=t.bonds,i=0,s=n.length;i<s;++i)r(n[i]._left!==t?n[i]._left:n[i]._right)}},{key:"forEachLevelOne",value:function(t){var r=this._left,n=this._right;this._forEachNeighbour(r,function(i){i!==n&&t(i)}),this._forEachNeighbour(n,function(i){i!==r&&t(i)})}},{key:"forEachLevelTwo",value:function(t){var r=this._left,n=this._right,i=this;i._forEachNeighbour(r,function(s){s!==n&&i._forEachNeighbour(s,function(o){o!==r&&t(o)})}),i._forEachNeighbour(n,function(s){s!==r&&i._forEachNeighbour(s,function(o){o!==n&&t(o)})})}},{key:"_fixDir",value:function(t,r,n){var i=0,s=0,o=t.clone();function l(p){o.copy(n(p)),o.sub(t);var m=r.dot(o);m>0?++i:++s}function c(p){p.element.name==="C"&&l(p)}for(var f=[[this.forEachLevelOne,c],[this.forEachLevelOne,l],[this.forEachLevelTwo,c],[this.forEachLevelTwo,l]],d=0;d<f.length;++d){if(f[d][0].call(this,f[d][1]),s>i)return r.multiplyScalar(-1);if(s<i)return r}return r}},{key:"calcNormalDir",value:function(t){var r=this._left,n=this._right,i=r,s=n;t=t===void 0?I4:t,r.bonds.length>n.bonds.length&&(i=n,s=r);for(var o=i,l=0,c=s,f=c.bonds,d=0,p=f.length;d<p;++d){var m=f[d]._left;f[d]._left===s&&(m=f[d]._right),m.bonds.length>l&&m!==i&&(o=m,l=m.bonds.length)}var v=t(s),y=t(i).clone().sub(v),S=t(o).clone().sub(v);return S.crossVectors(y,S),S.lengthSq()<1e-4&&S.set(0,1,0),y.normalize(),S.normalize(),y.crossVectors(S,y),y.lengthSq()<1e-4&&y.set(0,1,0),y.normalize(),this._fixDir(v,y,t)}}]),a}();qe(Rs,"BondType",lS);Rs.prototype.BondType=lS;var N4=["C3'","C3*","P","H5T","H3T"],ky=["OP1","O1P"],Oy=["OP2","O2P"],k4=["C3'","C3*","C1","C1'","C1*","P"],of=[{types:["A","DA","G","DG"],atoms:["N1"]},{types:["C","DC"],atoms:["N3"]},{types:["T","DT","U","DU"],atoms:["O4"]}],Gf=function(){function a(e,t,r,n){K(this,a),this._chain=e,this._component=null,this._type=t,this._sequence=r,this._icode=n,this._mask=1,this._index=-1,this._atoms=[],this._secondary=null,this._firstAtom=null,this._leadAtom=null,this._wingAtom=null,this._lastAtom=null,this._controlPoint=null,this._midPoint=null,this._wingVector=null,this._cylinders=null,this._isValid=!0,this._het=!1,this._molecule=null,this.temperature=null,this.occupancy=null}return J(a,[{key:"getChain",value:function(){return this._chain}},{key:"getMolecule",value:function(){return this._molecule}},{key:"getType",value:function(){return this._type}},{key:"getSequence",value:function(){return this._sequence}},{key:"getSecondary",value:function(){return this._secondary}},{key:"getICode",value:function(){return this._icode}},{key:"addAtom",value:function(t,r,n,i,s,o,l,c,f,d){var p=new Si(this,t,r,n,i,s,o,l,c,f,d),m=this._chain.getComplex();return m.addAtom(p),this._atoms.push(p),this._het=this._het||s,p}},{key:"getAtomCount",value:function(){return this._atoms.length}},{key:"forEachAtom",value:function(t){for(var r=this._atoms,n=0,i=r.length;n<i&&!t(r[n]);++n);}},{key:"_findAtomByName",value:function(t){var r=null;return this.forEachAtom(function(n){return n.name===t?(r=n,!0):!1}),r}},{key:"_findFirstAtomInList",value:function(t){for(var r=null,n=0;n<t.length;++n)if(r=this._findAtomByName(t[n]),r!==null)return r;return r}},{key:"collectMask",value:function(){for(var t=4294967295,r=this._atoms,n=0,i=r.length;n<i;++n)t&=r[n].mask;this._mask=t}},{key:"getCylinderTargetList",value:function(){for(var t=this._type._name,r=0,n=of.length;r<n;++r)for(var i=0,s=of[r].types.length;i<s;++i)if(t===of[r].types[i])return of[r].atoms;return null}},{key:"_detectLeadWing",value:function(t,r,n){var i=this._findFirstAtomInList(N4),s=this._findFirstAtomInList(ky),o=this._findFirstAtomInList(Oy);if(s===null&&r!==null&&(s=r._findFirstAtomInList(ky)),o===null&&r!==null&&(o=r._findFirstAtomInList(Oy)),!(i===null||s===null||o===null)){t._leadAtom=i,t._controlPoint=n(i),t._wingVector=n(o).clone().sub(n(s)),t._isValid=!0;var l=this._findFirstAtomInList(k4),c=this.getCylinderTargetList(),f=c!==null?this._findFirstAtomInList(c):null;l===null||f===null||(t._cylinders=[n(l),n(f)])}}},{key:"calcWing",value:function(t,r,n,i){var s=r.clone().sub(t),o=t.clone().sub(n);if(o.crossVectors(s,o),o.crossVectors(s,o).normalize(),i!==null&&i.length()>1e-4){var l=o.length()>1e-4&&Math.abs(i.angleTo(o))>Math.PI/2;l&&o.negate()}return o}},{key:"_innerFinalize",value:function(t,r,n,i,s,o){var l=r===null,c=o(this._leadAtom),f=new C(c.x,c.y,c.z);if(s){this._detectLeadWing(i,n,o);return}if(l)i._midPoint=o(this._firstAtom).clone();else{var d=r._controlPoint;i._midPoint=d.clone().lerp(f,.5),i._wingVector=this.calcWing(d,f,o(t._wingAtom),r._wingVector)}i._controlPoint=f}},{key:"_finalize2",value:function(t,r,n){this._innerFinalize(t,t,r,this,n,function(i){return i.position})}},{key:"isConnected",value:function(t){if(this._chain!==t._chain)return!1;if(this===t)return!0;var r=!1;return this.forEachAtom(function(n){for(var i=n.bonds,s=0,o=i.length;s<o;++s){var l=i[s];if(l._left.residue===t||l._right.residue===t)return r=!0,!0}return!1}),r}},{key:"_finalize",value:function(){var t=this,r=pn(this._atoms,1);this._firstAtom=r[0],this._lastAtom=this._atoms[this._atoms.length-1],this._leadAtom=null,this._wingAtom=null;var n=0,i=0,s=0,o=0;this.forEachAtom(function(l){return t._leadAtom===null&&l.role===Ce.Constants.Lead&&(t._leadAtom=l),t._wingAtom===null&&l.role===Ce.Constants.Wing&&(t._wingAtom=l),l.temperature&&(i+=l.temperature,n++),l.occupancy&&(o+=l.occupancy,s++),t._leadAtom!==null&&t._wingAtom!==null}),n>0&&(this.temperature=i/n),s>0&&(this.occupancy=o/s),(this._leadAtom===null||this._wingAtom===null)&&(this._isValid=!1),this._leadAtom===null&&(this._leadAtom=this._firstAtom),this._wingAtom===null&&(this._wingAtom=this._lastAtom)}}]),a}(),tt=function(){function a(e,t,r){K(this,a),this._name=e,this._fullName=t,this.letterCode=r,this.flags=0}return J(a,[{key:"getName",value:function(){return this._name}}]),a}();qe(tt,"StandardTypes",{ALA:new tt("ALA","Alanine","A"),ARG:new tt("ARG","Arginine","R"),ASN:new tt("ASN","Asparagine","N"),ASP:new tt("ASP","Aspartic Acid","D"),CYS:new tt("CYS","Cysteine","C"),GLN:new tt("GLN","Glutamine","Q"),GLU:new tt("GLU","Glutamic Acid","E"),GLY:new tt("GLY","Glycine","G"),HIS:new tt("HIS","Histidine","H"),ILE:new tt("ILE","Isoleucine","I"),LEU:new tt("LEU","Leucine","L"),LYS:new tt("LYS","Lysine","K"),MET:new tt("MET","Methionine","M"),PHE:new tt("PHE","Phenylalanine","F"),PRO:new tt("PRO","Proline","P"),PYL:new tt("PYL","Pyrrolysine","O"),SEC:new tt("SEC","Selenocysteine","U"),SER:new tt("SER","Serine","S"),THR:new tt("THR","Threonine","T"),TRP:new tt("TRP","Tryptophan","W"),TYR:new tt("TYR","Tyrosine","Y"),VAL:new tt("VAL","Valine","V"),A:new tt("A","Adenine","A"),C:new tt("C","Cytosine","C"),G:new tt("G","Guanine","G"),I:new tt("I","Inosine","I"),T:new tt("T","Thymine","T"),U:new tt("U","Uracil","U"),DA:new tt("DA","Adenine","A"),DC:new tt("DC","Cytosine","C"),DG:new tt("DG","Guanine","G"),DI:new tt("DI","Inosine","I"),DT:new tt("DT","Thymine","T"),DU:new tt("DU","Uracil","U"),"+A":new tt("+A","Adenine","A"),"+C":new tt("+C","Cytosine","C"),"+G":new tt("+G","Guanine","G"),"+I":new tt("+I","Inosine","I"),"+T":new tt("+T","Thymine","T"),"+U":new tt("+U","Uracil","U"),WAT:new tt("WAT","Water",""),H2O:new tt("H2O","Water",""),HOH:new tt("HOH","Water",""),DOD:new tt("DOD","Water",""),UNK:new tt("UNK","Unknown",""),UNL:new tt("UNL","Unknown Ligand","")});qe(tt,"Flags",{PROTEIN:1,BASIC:2,ACIDIC:4,POLAR:8,NONPOLAR:16,AROMATIC:32,NUCLEIC:256,PURINE:512,PYRIMIDINE:1024,DNA:2048,RNA:4096,WATER:65536});function oi(a,e){for(var t=0,r=e.length;t<r;++t){var n=tt.StandardTypes[e[t]];n&&(n.flags|=a)}}var li=tt.Flags;oi(li.WATER,["WAT","H2O","HOH","DOD"]);oi(li.PROTEIN,["ALA","ARG","ASN","ASP","CYS","GLY","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","PRO","PYL","SEC","SER","THR","TRP","TYR","VAL"]);oi(li.BASIC,["ARG","HIS","LYS"]);oi(li.ACIDIC,["ASP","GLU"]);oi(li.POLAR,["ASN","CYS","GLN","SER","THR","TYR"]);oi(li.NONPOLAR,["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL","GLY"]);oi(li.AROMATIC,["PHE","TRP","TYR"]);oi(li.NUCLEIC,["A","G","I","DA","DG","DI","+A","+G","+I","C","T","U","DC","DT","DU","+C","+T","+U"]);oi(li.PURINE,["A","G","I","DA","DG","DI","+A","+G","+I"]);oi(li.PYRIMIDINE,["C","T","U","DC","DT","DU","+C","+T","+U"]);oi(li.DNA,["DA","DG","DI","DC","DT","DU"]);oi(li.RNA,["A","G","I","C","T","U"]);var O4={ILE:4.5,VAL:4.2,LEU:3.8,PHE:2.8,CYS:2.5,MET:1.9,ALA:1.8,GLY:-.4,THR:-.7,SER:-.8,TRP:-.9,TYR:-1.3,PRO:-1.6,HIS:-3.2,GLU:-3.5,GLN:-3.5,ASP:-3.5,ASN:-3.5,LYS:-3.9,ARG:-4.5};function D4(a,e){for(var t=Object.keys(e),r=0,n=t.length;r<n;++r){var i=t[r],s=e[i];tt.StandardTypes[i][a]=s}}D4("hydrophobicity",O4);var Ol={UNKNOWN:0,PROTEIN:1,NUCLEIC:2},cS=function(){function a(e,t){K(this,a),this._complex=e,this._name=t,this._mask=1,this._index=-1,this._residues=[],this.minSequence=Number.POSITIVE_INFINITY,this.maxSequence=Number.NEGATIVE_INFINITY}return J(a,[{key:"getComplex",value:function(){return this._complex}},{key:"getName",value:function(){return this._name}},{key:"getResidues",value:function(){return this._residues}},{key:"_determineType",value:function(){var t=this._residues,r=tt.Flags,n=r.PROTEIN,i=r.NUCLEIC;this.type=Ol.UNKNOWN;for(var s=0,o=t.length;s<o;++s){var l=t[s]._type.flags;if(l&i){this.type=Ol.NUCLEIC;break}else if(l&n){this.type=Ol.PROTEIN;break}}}},{key:"findResidue",value:function(t,r){for(var n=this._residues,i=0,s=n.length;i<s;++i){var o=n[i];if(o._sequence===t&&o._icode===r)return[o,i]}return null}},{key:"_finalize",value:function(){this._determineType();for(var t=this._residues,r=null,n=0,i=t.length;n<i;++n){var s=n+1<i?t[n+1]:null,o=t[n];o._finalize2(r,s,this.type===Ol.NUCLEIC),r=o}if(t.length>1&&t[1]._wingVector){var l=t[1]._wingVector;t[0]._wingVector=new C(l.x,l.y,l.z)}else t.length>0&&(t[0]._wingVector=new C(1,0,0))}},{key:"updateToFrame",value:function(t){var r=this._residues,n=null,i=null,s=t._residues,o=r.length;function l(m){return t.getAtomPos(m.index)}for(var c=0;c<o;++c){var f=r[c],d=s[f._index],p=c+1<o?r[c+1]:null;f._innerFinalize(n,i,p,d,this.type===Ol.NUCLEIC,l),n=f,i=d}s[r[0]._index]._wingVector=o>1?s[r[1]._index]._wingVector:new C(1,0,0)}},{key:"addResidue",value:function(t,r,n){var i=this._complex.getResidueType(t);i===null&&(i=this._complex.addResidueType(t));var s=new Gf(this,i,r,n);return this._complex.addResidue(s),this._residues.push(s),i.flags&(tt.Flags.NUCLEIC|tt.Flags.PROTEIN)&&(this.maxSequence<r&&(this.maxSequence=r),this.minSequence>r&&(this.minSequence=r)),s}},{key:"getResidueCount",value:function(){return this._residues.length}},{key:"forEachResidue",value:function(t){for(var r=this._residues,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"collectMask",value:function(){for(var t=4294967295,r=this._residues,n=0,i=r.length;n<i;++n)t&=r[n]._mask;this._mask=t}}]),a}(),ds,zn=function(){function a(e,t,r){K(this,a),this.type=e,this.generic=a.genericByType[this.type]||"loop",this.init=t,this.term=r}return J(a,[{key:"_finalize",value:function(t,r,n){if(!(this.init instanceof Gf&&this.term instanceof Gf)){for(var i=n.splitUnifiedSerial(this.init),s=n.splitUnifiedSerial(this.term),o=i.chain;o<=s.chain;o++)for(var l=i.serial;l<=s.serial;l++)for(var c=i.iCode;c<=s.iCode;c++){var f=n.getUnifiedSerial(o,l,c);r[f]&&(r[f]._secondary=this)}this.init=r[this.init],this.term=r[this.term]}}}]),a}();zn.Type={STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",HELIX:"X",TURN_310:"3",TURN_ALPHA:"4",TURN_PI:"5",TURN:"T",BEND:"S",COIL:"C"};zn.Generic={STRAND:"strand",HELIX:"helix",LOOP:"loop"};var Dl=zn.Type,Fl=zn.Generic;zn.genericByType=(ds={},qe(ds,Dl.STRAND,Fl.STRAND),qe(ds,Dl.HELIX_310,Fl.HELIX),qe(ds,Dl.HELIX_ALPHA,Fl.HELIX),qe(ds,Dl.HELIX_PI,Fl.HELIX),qe(ds,Dl.HELIX,Fl.HELIX),ds);function F4(a){var e=B4();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function B4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vp=zn.Type,uS={1:vp.HELIX_ALPHA,3:vp.HELIX_PI,5:vp.HELIX_310},lm=function(a){ve(t,a);var e=F4(t);function t(r,n,i,s,o,l,c){var f;return K(this,t),f=e.call(this,uS[r]||zn.Type.HELIX,n,i),f.serial=s,f.name=o,f.comment=l,f.length=c,f}return J(t)}(zn);function z4(a,e){for(;!Object.prototype.hasOwnProperty.call(a,e)&&(a=H(a),a!==null););return a}function nn(){return typeof Reflect<"u"&&Reflect.get?nn=Reflect.get:nn=function(e,t,r){var n=z4(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},nn.apply(this,arguments)}function V4(a){var e=U4();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function U4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wm=function(a){ve(t,a);var e=V4(t);function t(r,n,i,s,o,l){var c;return K(this,t),c=e.call(this,zn.Type.STRAND,n,i),c.sheet=r,c.sense=s,c.atomCur=o,c.atomPrev=l,c}return J(t,[{key:"_finalize",value:function(n,i,s){nn(H(t.prototype),"_finalize",this).call(this,n,i,s);var o=this.atomCur;o!==null&&!Number.isNaN(o)&&(this.atomCur=n[o]),o=this.atomPrev,o!==null&&!Number.isNaN(o)&&(this.atomPrev=n[o])}}]),t}(zn),fS=function(){function a(e,t){K(this,a),this._name=e,this._width=t,this._strands=[]}return J(a,[{key:"getName",value:function(){return this._name}},{key:"getWidth",value:function(){return this._width}},{key:"addStrand",value:function(t){this._strands.push(t),this._width=this._strands.length}},{key:"addEmptyStrand",value:function(){this._strands.push(new Wm(null,null,null,null,null,null))}},{key:"_finalize",value:function(t,r,n){for(var i=this._strands,s=0,o=i.length;s<o;++s)i[s]._finalize(t,r,n);if(this._width||(this._width=i.length),i.length!==this._width)throw new Error("Sheet ".concat(this._name," is inconsistent."))}}]),a}(),G4=function(){function a(e,t,r,n,i){K(this,a),this._id=e,this._name=t,this._position=r||new C,this._atoms=n||[],this._charge=0,this._repeat=1,this._center=null,this.xmlNodeRef=i||null}return J(a,[{key:"getName",value:function(){return this._name}},{key:"getPosition",value:function(){return this._position}},{key:"getCentralPoint",value:function(){return this._center}},{key:"_rebuildSGroupOnAtomChange",value:function(){var t=1e8;if(this._center!==null){for(var r=new C(t,t,t),n=new C(-t,-t,-t),i=0,s=this._atoms.length;i<s;i++){var o=this._atoms[i].position;r.set(Math.min(r.x,o.x),Math.min(r.y,o.y),Math.min(r.z,o.z)),n.set(Math.max(n.x,o.x),Math.max(n.y,o.y),Math.max(n.z,o.z))}this._center.addVectors(r,n),this._center.multiplyScalar(.5)}}}]),a}(),hS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},H4=function(){var a=function(b,M,E,T){for(E=E||{},T=b.length;T--;E[b[T]]=M);return E},e=[1,4],t=[1,5],r=[1,6],n=[1,7],i=[1,8],s=[1,9],o=[1,11],l=[1,12],c=[5,7,8,11],f=[1,17],d=[1,22],p=[1,20],m=[1,21],v=[5,7,8,11,19],y={trace:function(){},yy:{},symbols_:{error:2,Program:3,Expression:4,EOF:5,Selector:6,OR:7,AND:8,NOT:9,"(":10,")":11,SELECTOR:12,NAMED_SELECTOR:13,SELECTOR_RANGED:14,RangeList:15,SELECTOR_NAMED:16,NameList:17,Range:18,",":19,NUMBER:20,":":21,Name:22,IDENTIFIER:23,STRING:24,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"OR",8:"AND",9:"NOT",10:"(",11:")",12:"SELECTOR",13:"NAMED_SELECTOR",14:"SELECTOR_RANGED",16:"SELECTOR_NAMED",19:",",20:"NUMBER",21:":",23:"IDENTIFIER",24:"STRING"},productions_:[0,[3,2],[4,1],[4,3],[4,3],[4,2],[4,3],[6,1],[6,1],[6,2],[6,2],[15,1],[15,3],[18,1],[18,3],[17,1],[17,3],[22,1],[22,1],[22,1]],performAction:function(b,M,E,T,R,V,Y){var $=V.length-1;switch(R){case 1:return V[$-1];case 3:this.$=T.keyword("or")(V[$-2],V[$]);break;case 4:this.$=T.keyword("and")(V[$-2],V[$]);break;case 5:this.$=T.keyword("not")(V[$]);break;case 6:this.$=V[$-1];break;case 7:this.$=T.keyword(V[$])();break;case 8:this.$=T.GetSelector(V[$].toLowerCase().slice(1,V[$].length));break;case 9:case 10:this.$=T.keyword(V[$-1])(V[$]);break;case 11:this.$=new T.RangeList(V[$]);break;case 12:case 16:this.$=V[$-2].append(V[$]);break;case 13:this.$=new T.Range(Number(V[$]));break;case 14:this.$=new T.Range(Number(V[$-2]),Number(V[$]));break;case 15:this.$=new T.ValueList(V[$]);break}},table:[{3:1,4:2,6:3,9:e,10:t,12:r,13:n,14:i,16:s},{1:[3]},{5:[1,10],7:o,8:l},a(c,[2,2]),{4:13,6:3,9:e,10:t,12:r,13:n,14:i,16:s},{4:14,6:3,9:e,10:t,12:r,13:n,14:i,16:s},a(c,[2,7]),a(c,[2,8]),{15:15,18:16,20:f},{17:18,20:d,22:19,23:p,24:m},{1:[2,1]},{4:23,6:3,9:e,10:t,12:r,13:n,14:i,16:s},{4:24,6:3,9:e,10:t,12:r,13:n,14:i,16:s},a(c,[2,5]),{7:o,8:l,11:[1,25]},a(c,[2,9],{19:[1,26]}),a(v,[2,11]),a(v,[2,13],{21:[1,27]}),a(c,[2,10],{19:[1,28]}),a(v,[2,15]),a(v,[2,17]),a(v,[2,18]),a(v,[2,19]),a([5,7,11],[2,3],{8:l}),a(c,[2,4]),a(c,[2,6]),{18:29,20:f},{20:[1,30]},{20:d,22:31,23:p,24:m},a(v,[2,12]),a(v,[2,14]),a(v,[2,16])],defaultActions:{10:[2,1]},parseError:function(b,M){if(M.recoverable)this.trace(b);else{var E=new Error(b);throw E.hash=M,E}},parse:function(b){var M=this,E=[0],T=[],R=[null],V=[],Y=this.table,$="",W=0,j=0,X=2,P=1,N=V.slice.call(arguments,1),I=Object.create(this.lexer),G={yy:{}};for(var ee in this.yy)Object.prototype.hasOwnProperty.call(this.yy,ee)&&(G.yy[ee]=this.yy[ee]);I.setInput(b,G.yy),G.yy.lexer=I,G.yy.parser=this,typeof I.yylloc>"u"&&(I.yylloc={});var re=I.yylloc;V.push(re);var he=I.options&&I.options.ranges;typeof G.yy.parseError=="function"?this.parseError=G.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function pe(){var me;return me=T.pop()||I.lex()||P,typeof me!="number"&&(me instanceof Array&&(T=me,me=T.pop()),me=M.symbols_[me]||me),me}for(var Ie,De,Le,Oe,ne={},at,Ge,We,Ve;;){if(De=E[E.length-1],this.defaultActions[De]?Le=this.defaultActions[De]:((Ie===null||typeof Ie>"u")&&(Ie=pe()),Le=Y[De]&&Y[De][Ie]),typeof Le>"u"||!Le.length||!Le[0]){var Te="";Ve=[];for(at in Y[De])this.terminals_[at]&&at>X&&Ve.push("'"+this.terminals_[at]+"'");I.showPosition?Te="Parse error on line "+(W+1)+`:
`+I.showPosition()+`
Expecting `+Ve.join(", ")+", got '"+(this.terminals_[Ie]||Ie)+"'":Te="Parse error on line "+(W+1)+": Unexpected "+(Ie==P?"end of input":"'"+(this.terminals_[Ie]||Ie)+"'"),this.parseError(Te,{text:I.match,token:this.terminals_[Ie]||Ie,line:I.yylineno,loc:re,expected:Ve})}if(Le[0]instanceof Array&&Le.length>1)throw new Error("Parse Error: multiple actions possible at state: "+De+", token: "+Ie);switch(Le[0]){case 1:E.push(Ie),R.push(I.yytext),V.push(I.yylloc),E.push(Le[1]),Ie=null,j=I.yyleng,$=I.yytext,W=I.yylineno,re=I.yylloc;break;case 2:if(Ge=this.productions_[Le[1]][1],ne.$=R[R.length-Ge],ne._$={first_line:V[V.length-(Ge||1)].first_line,last_line:V[V.length-1].last_line,first_column:V[V.length-(Ge||1)].first_column,last_column:V[V.length-1].last_column},he&&(ne._$.range=[V[V.length-(Ge||1)].range[0],V[V.length-1].range[1]]),Oe=this.performAction.apply(ne,[$,j,W,G.yy,Le[1],R,V].concat(N)),typeof Oe<"u")return Oe;Ge&&(E=E.slice(0,-1*Ge*2),R=R.slice(0,-1*Ge),V=V.slice(0,-1*Ge)),E.push(this.productions_[Le[1]][0]),R.push(ne.$),V.push(ne._$),We=Y[E[E.length-2]][E[E.length-1]],E.push(We);break;case 3:return!0}}return!0}},S=function(){var x={EOF:1,parseError:function(M,E){if(this.yy.parser)this.yy.parser.parseError(M,E);else throw new Error(M)},setInput:function(M,E){return this.yy=E||this.yy||{},this._input=M,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var M=this._input[0];this.yytext+=M,this.yyleng++,this.offset++,this.match+=M,this.matched+=M;var E=M.match(/(?:\r\n?|\n).*/g);return E?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),M},unput:function(M){var E=M.length,T=M.split(/(?:\r\n?|\n)/g);this._input=M+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-E),this.offset-=E;var R=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),T.length-1&&(this.yylineno-=T.length-1);var V=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:T?(T.length===R.length?this.yylloc.first_column:0)+R[R.length-T.length].length-T[0].length:this.yylloc.first_column-E},this.options.ranges&&(this.yylloc.range=[V[0],V[0]+this.yyleng-E]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(M){this.unput(this.match.slice(M))},pastInput:function(){var M=this.matched.substr(0,this.matched.length-this.match.length);return(M.length>20?"...":"")+M.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var M=this.match;return M.length<20&&(M+=this._input.substr(0,20-M.length)),(M.substr(0,20)+(M.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var M=this.pastInput(),E=new Array(M.length+1).join("-");return M+this.upcomingInput()+`
`+E+"^"},test_match:function(M,E){var T,R,V;if(this.options.backtrack_lexer&&(V={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(V.yylloc.range=this.yylloc.range.slice(0))),R=M[0].match(/(?:\r\n?|\n).*/g),R&&(this.yylineno+=R.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:R?R[R.length-1].length-R[R.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+M[0].length},this.yytext+=M[0],this.match+=M[0],this.matches=M,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(M[0].length),this.matched+=M[0],T=this.performAction.call(this,this.yy,this,E,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),T)return T;if(this._backtrack){for(var Y in V)this[Y]=V[Y];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var M,E,T,R;this._more||(this.yytext="",this.match="");for(var V=this._currentRules(),Y=0;Y<V.length;Y++)if(T=this._input.match(this.rules[V[Y]]),T&&(!E||T[0].length>E[0].length)){if(E=T,R=Y,this.options.backtrack_lexer){if(M=this.test_match(T,V[Y]),M!==!1)return M;if(this._backtrack){E=!1;continue}else return!1}else if(!this.options.flex)break}return E?(M=this.test_match(E,V[R]),M!==!1?M:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var M=this.next();return M||this.lex()},begin:function(M){this.conditionStack.push(M)},popState:function(){var M=this.conditionStack.length-1;return M>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(M){return M=this.conditionStack.length-1-Math.abs(M||0),M>=0?this.conditionStack[M]:"INITIAL"},pushState:function(M){this.begin(M)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(M,E,T,R){switch(T){case 0:break;case 1:return 20;case 2:return 7;case 3:return 8;case 4:return 9;case 5:return 12;case 6:return 16;case 7:return 14;case 8:return 10;case 9:return 11;case 10:return 19;case 11:return 21;case 12:return"<=";case 13:return">=";case 14:return"<";case 15:return">";case 16:return E.yytext=E.yytext.substr(1,E.yyleng-2),24;case 17:return 13;case 18:return 23;case 19:return 5;case 20:return"INVALID"}},rules:[/^(?:\s+)/i,/^(?:(-?(?:[1-9][0-9]+|[0-9]))\b)/i,/^(?:OR\b)/i,/^(?:AND\b)/i,/^(?:NOT\b)/i,/^(?:((ALL|NONE|HETATM|PROTEIN|BASIC|ACIDIC|CHARGED|POLAR|NONPOLAR|AROMATIC|NUCLEIC|PURINE|PYRIMIDINE|WATER|POLARH|NONPOLARH))\b)/i,/^(?:((NAME|ELEM|TYPE|RESIDUE|ICODE|CHAIN|ALTLOC))\b)/i,/^(?:((SERIAL|SEQUENCE|RESIDX))\b)/i,/^(?:\()/i,/^(?:\))/i,/^(?:,)/i,/^(?::)/i,/^(?:<=)/i,/^(?:>=)/i,/^(?:<)/i,/^(?:>)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:(@[_A-Z0-9]+))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:.)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],inclusive:!0}}};return x}();y.lexer=S;function _(){this.yy={}}return _.prototype=y,y.Parser=_,new _}(),Hf={parser:H4};function dS(a){var e=W4();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function W4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var X4=function(){function a(e,t){K(this,a),this.min=e,this.max=typeof t>"u"?e:t}return J(a,[{key:"includes",value:function(t){return this.min<=t&&t<=this.max}},{key:"toString",value:function(){var t=this.min,r=this.max;return t===r?String(t):[t,r].join(":")}},{key:"toJSON",value:function(){return[this.min,this.max]}}]),a}(),pS=function(){function a(e){if(K(this,a),e instanceof this.constructor)return e;e instanceof Array?this._values=e.slice(0):e?this._values=[e]:this._values=[]}return J(a,[{key:"append",value:function(t){var r=this._values;return r[r.length]=t,this}},{key:"remove",value:function(t){var r=this._values,n=r.indexOf(t);return n>=0&&r.splice(n,1),this}},{key:"toString",value:function(){return this._values.join(",")}},{key:"toJSON",value:function(){for(var t=this._values,r=[],n=0,i=t.length;n<i;++n){var s=t[n];r[n]=s.toJSON?s.toJSON():s}return r}}]),a}(),mS=function(a){ve(t,a);var e=dS(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includes",value:function(n){for(var i=this._values,s=0,o=i.length;s<o;++s)if(i[s].includes(n))return!0;return!1}}]),t}(pS),gp=[],vS=function(a){ve(t,a);var e=dS(t);function t(r,n){var i;K(this,t);var s=i=e.call(this,r);if(n){i.upperOnly=!0;for(var o=s._values,l=0,c=o.length;l<c;++l){var f=o[l];typeof f=="string"&&(o[l]=f.toUpperCase())}}else i.upperOnly=!1;return Me(i,s)}return J(t,[{key:"includes",value:function(n){return this._values.indexOf(n)!==-1}},{key:"toString",value:function(){var n=this._values;gp.length=0;for(var i=0,s=n.length;i<s;++i)gp[i]=ke.correctSelectorIdentifier(String(n[i]));return gp.join(",")}},{key:"_validate",value:function(n){return this.upperOnly&&typeof n=="string"?n.toUpperCase():n}},{key:"append",value:function(n){return nn(H(t.prototype),"append",this).call(this,this._validate(n)),this}},{key:"remove",value:function(n){return nn(H(t.prototype),"remove",this).call(this,this._validate(n)),this}}]),t}(pS);function yc(a){var e=Y4();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Y4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ci=function(){function a(){K(this,a)}return J(a,[{key:"toString",value:function(){return this.keyword}},{key:"toJSON",value:function(){return[this.name]}}]),a}();ci.prototype.name="Error";ci.prototype.keyword="error";var gS=function(a){ve(t,a);var e=yc(t);function t(r){var n;return K(this,t),n=e.call(this),n.list=r,n}return J(t,[{key:"toString",value:function(){return"".concat(this.keyword," ").concat(this.list)}},{key:"toJSON",value:function(){return[this.name,this.list.toJSON()]}}]),t}(ci),oh=function(a){ve(t,a);var e=yc(t);function t(r){return K(this,t),e.call(this,new mS(r))}return J(t)}(gS),Ls=function(a){ve(t,a);var e=yc(t);function t(r,n){return K(this,t),e.call(this,new vS(r,!n))}return J(t)}(gS),lh=function(a){ve(t,a);var e=yc(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return!1}}]),t}(ci);lh.prototype.name="None";lh.prototype.keyword="none";var Xm=function(a){ve(t,a);var e=yc(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return!0}}]),t}(ci);Xm.prototype.name="All";Xm.prototype.keyword="all";function _S(a){var e=$4();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function $4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cm=new lh,Ym=function(a){ve(t,a);var e=_S(t);function t(r){var n;return K(this,t),n=e.call(this),n.rhs=r||cm,n}return J(t,[{key:"toString",value:function(){var n=this.rhs.priority&&this.rhs.priority>this.priority?"(".concat(this.rhs,")"):this.rhs;return"".concat(this.keyword," ").concat(n)}},{key:"toJSON",value:function(){return[this.name,this.rhs.toJSON()]}}]),t}(ci);Ym.prototype.priority=1;var ch=function(a){ve(t,a);var e=_S(t);function t(r,n){var i;return K(this,t),i=e.call(this),i.lhs=r||cm,i.rhs=n||cm,i}return J(t,[{key:"toString",value:function(){var n=this.lhs.priority&&this.lhs.priority>this.priority?"(".concat(this.lhs,")"):this.lhs,i=this.rhs.priority&&this.rhs.priority>this.priority?"(".concat(this.rhs,")"):this.rhs;return"".concat(n," ").concat(this.keyword," ").concat(i)}},{key:"toJSON",value:function(){return[this.name,this.lhs.toJSON(),this.rhs.toJSON()]}}]),t}(ci);ch.prototype.priority=1e3;function ir(a){var e=q4();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function q4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hc={};function ar(a,e){var t=a.toLowerCase();e.prototype.keyword=t,e.prototype.name=a;var r=function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return Ql(e,s)};return r.SelectorClass=e,hc[t]=r,e}ar("Serial",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(n.serial)}}]),t}(oh));ar("Name",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(n.name)}}]),t}(Ls));ar("AltLoc",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(String.fromCharCode(n.location))}}]),t}(Ls));ar("Elem",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(n.element.name)}}]),t}(Ls));ar("Residue",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(n.residue._type._name)}}]),t}(Ls));ar("Sequence",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(n.residue._sequence)}}]),t}(oh));ar("ICode",function(a){ve(t,a);var e=ir(t);function t(r){return K(this,t),e.call(this,r,!0)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(n.residue._icode)}}]),t}(Ls));ar("ResIdx",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(n.residue._index)}}]),t}(oh));ar("Chain",function(a){ve(t,a);var e=ir(t);function t(r){return K(this,t),e.call(this,r,!0)}return J(t,[{key:"includesAtom",value:function(n){return this.list.includes(n.residue._chain._name)}}]),t}(Ls));ar("Hetatm",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return n.het}}]),t}(ci));ar("PolarH",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return(n.flags&Si.Flags.NONPOLARH)===Si.Flags.HYDROGEN}}]),t}(ci));ar("NonPolarH",function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return(n.flags&Si.Flags.NONPOLARH)===Si.Flags.NONPOLARH}}]),t}(ci));ar("All",Xm);ar("None",lh);var yS=hc.none();function $m(a,e,t){return t.prototype.priority=e,ar(a,t)}$m("Not",1,function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return!this.rhs.includesAtom(n)}}]),t}(Ym));$m("And",2,function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.lhs.includesAtom(n)&&this.rhs.includesAtom(n)}}]),t}(ch));$m("Or",3,function(a){ve(t,a);var e=ir(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"includesAtom",value:function(n){return this.lhs.includesAtom(n)||this.rhs.includesAtom(n)}}]),t}(ch));function Mi(a,e){return ar(e,function(t){ve(n,t);var r=ir(n);function n(){return K(this,n),r.apply(this,arguments)}return J(n,[{key:"includesAtom",value:function(s){return(s.residue._type.flags&a)!==0}}]),n}(ci))}Mi(tt.Flags.PROTEIN,"Protein");Mi(tt.Flags.BASIC,"Basic");Mi(tt.Flags.ACIDIC,"Acidic");Mi(tt.Flags.BASIC|tt.Flags.ACIDIC,"Charged");Mi(tt.Flags.POLAR,"Polar");Mi(tt.Flags.NONPOLAR,"NonPolar");Mi(tt.Flags.AROMATIC,"Aromatic");Mi(tt.Flags.NUCLEIC,"Nucleic");Mi(tt.Flags.PURINE,"Purine");Mi(tt.Flags.PYRIMIDINE,"Pyrimidine");Mi(tt.Flags.WATER,"Water");var un=Object.create(hc);un.Selector=ci;un.RangeListSelector=oh;un.ValueListSelector=Ls;un.Range=X4;un.RangeList=mS;un.ValueList=vS;un.PrefixOperator=Ym;un.InfixOperator=ch;un.Context=Object.create({});un.GetSelector=function(a){if(!un.Context.hasOwnProperty(a)){var e={message:"selector ".concat(a," is not registered")};throw e}return un.Context[a]||yS};un.ClearContext=function(){Object.keys(un.Context).forEach(function(a){delete un.Context[a]})};un.keyword=function(a){return hc[a.toLowerCase()]||hc.none};un.parse=function(a){var e={};try{e.selector=Hf.parser.parse(a)}catch(t){e.selector=yS,e.error=t.message}return e};Hf.parser.yy=un;Hf.parser.yy.parseError=Hf.parser.parseError;var xS=function(){function a(e){K(this,a),this._complex=e,this._selector=un.keyword("All")(),this._boundaries={boundingBox:new An,boundingSphere:new Lr}}return J(a,[{key:"computeBoundaries",value:function(){var t=this._complex._atoms,r=t.length,n=this._selector,i=this._boundaries.boundingBox;if(i.makeEmpty(),r===1){i.expandByPoint(t[0].position);var s=new C;i.getCenter(s);var o=2*t[0].element.radius;i.setFromCenterAndSize(s,new C(o,o,o))}else for(var l=0;l<r;++l)n.includesAtom(t[l])&&i.expandByPoint(t[l].position);var c=0,f=new C;if(i.getCenter(f),r===1)this._boundaries.boundingSphere.set(f,t[0].element.radius);else{for(var d=0;d<r;++d)if(n.includesAtom(t[d])){var p=t[d].position,m=f.distanceToSquared(p);c<m&&(c=m)}this._boundaries.boundingSphere.set(f,Math.sqrt(c))}}},{key:"getTransforms",value:function(){return[]}},{key:"getSelector",value:function(){return this._selector}},{key:"getBoundaries",value:function(){return this._boundaries}},{key:"finalize",value:function(){}}]),a}();function Z4(a){var e=j4();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function j4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qm=function(a){ve(t,a);var e=Z4(t);function t(r){var n;return K(this,t),n=e.call(this,r),n.chains=[],n.matrices=[],n}return J(t,[{key:"computeBoundaries",value:function(){nn(H(t.prototype),"computeBoundaries",this).call(this);var n=this.matrices,i=this._boundaries.boundingSphere.center,s=this._boundaries.boundingSphere.radius,o=this._boundaries.boundingBox=new An;o.makeEmpty();for(var l=0,c=n.length;l<c;++l)o.expandByPoint(i.clone().applyMatrix4(n[l]));var f=o.max.distanceTo(o.min)/2+s,d=new C;o.getCenter(d),this._boundaries.boundingSphere=new Lr().set(d,f),o.max.addScalar(s),o.min.subScalar(s)}},{key:"addChain",value:function(n){this.chains[this.chains.length]=n}},{key:"addMatrix",value:function(n){this.matrices[this.matrices.length]=n}},{key:"getTransforms",value:function(){return this.matrices}},{key:"finalize",value:function(){this.chains.length>0?this._selector=un.keyword("Chain")(this.chains):this._selector=un.keyword("None")()}}]),t}(xS),Dy=function(){function a(e){K(this,a),this._complex=e,this._index=-1,this._residueIndices=[],this._cycles=[],this._subDivs=[],this._residueCount=0}return J(a,[{key:"getResidues",value:function(){return this._complex._residues}},{key:"getResidueCount",value:function(){return this._residueCount}},{key:"forEachResidue",value:function(t){for(var r=this._complex._residues,n=this._residueIndices,i=0,s=n.length;i<s;++i)for(var o=n[i].start,l=n[i].end;o<=l;++o)t(r[o])}},{key:"setSubDivs",value:function(t){this._subDivs=t;for(var r=0,n=[],i=0,s=0,o=t.length;s<o;++s)if(s===o-1||t[s].end+1!==t[s+1].start){var l=t[r].start,c=t[s].end;n[n.length]={start:l,end:c},i+=c-l+1,r=s+1}this._residueIndices=n,this._residueCount=i}},{key:"getComplex",value:function(){return this._complex}},{key:"forEachBond",value:function(t){for(var r=this._complex._bonds,n=0,i=r.length;n<i;++n){var s=r[n];s._left.residue._component===this&&t(s)}}},{key:"update",value:function(){this.forEachCycle(function(t){t.update()})}},{key:"forEachAtom",value:function(t){this.forEachResidue(function(r){r.forEachAtom(t)})}},{key:"addCycle",value:function(t){this._cycles.push(t)}},{key:"forEachCycle",value:function(t){for(var r=this._cycles,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"markResidues",value:function(){var t=this;t.forEachResidue(function(r){r._component=t})}},{key:"_forEachSubChain",value:function(t,r){for(var n=this._complex._residues,i=this._subDivs,s=0,o=i.length;s<o;++s)for(var l=i[s].start,c=i[s].end;l<=c;++l){var f=n[l];if(t&f._mask&&f._isValid){for(var d=l+1;d<=c;++d){var p=n[d];if(!(t&p._mask&&p._isValid))break}r(s,l,d-1),l=d}}}},{key:"getMaskedSequences",value:function(t){var r=[],n=0;return this._forEachSubChain(t,function(i,s,o){r[n++]={start:s,end:o}}),r}},{key:"getMaskedSubdivSequences",value:function(t){var r=[],n=-1,i=-1,s=this._subDivs;return this._forEachSubChain(t,function(o,l,c){i!==o&&(++n,r[n]={arr:[],boundaries:s[o]},i=o),r[n].arr[r[n].arr.length]={start:l,end:c}}),r}}]),a}(),Bl=32,_p=1024*1024,yp=4,K4=14,xp=-1,J4=89237,SS=function(){function a(e){K(this,a),this.numPairs=0,this.numMaxPairs=e,this.intBuffer=ke.allocateTyped(Int32Array,e*yp);for(var t=0;t<e*yp;t++)this.intBuffer[t]=xp;this.hashBuffer=ke.allocateTyped(Int32Array,_p*Bl);for(var r=0;r<_p*Bl;r++)this.hashBuffer[r]=xp}return J(a,[{key:"destroy",value:function(){this.intBuffer=null,this.hashBuffer=null}},{key:"addPair",value:function(t,r){for(var n=t<r?t:r,i=t>r?t:r,s=n+(i<<K4),o=n+i*J4&_p-1,l=o*Bl,c=0;c<Bl;c++){var f=this.hashBuffer[l+c];if(f===xp)break;if(f===s)return!1}if(c>=Bl)throw new Error("addPair: increase cMaxPairsForHashCode");if(this.hashBuffer[l+c]=s,this.numPairs>=this.numMaxPairs)throw new Error("addPair: increase num pairs");return l=this.numPairs*yp,this.intBuffer[l]=n,this.intBuffer[l+1]=i,this.intBuffer[l+2]=s,this.numPairs++,!0}}]),a}(),Q4=4,Fy=32,By=.45,eD=.001;function zy(a){var e=a.element;if(e)return e.radiusBonding;throw new Error("_getBondingRadius: Logic error.")}function tD(a){return!a.isHet()||a.bonds&&a.bonds.length===0}var nD=function(){function a(e){K(this,a),this._complex=e,this._maxRad=1.8;var t=this._complex.getDefaultBoundaries().boundingBox;this._vBoxMin=t.min.clone(),this._vBoxMax=t.max.clone(),this._pairCollection=null}return J(a,[{key:"_addExistingPairs",value:function(){for(var t=this._complex.getAtoms(),r=t.length,n=0,i=this._pairCollection;n<r;n++)for(var s=t[n].bonds,o=s.length,l=0;l<o;l++){var c=s[l],f=c._left.index;f===n&&i.addPair(n,c._right.index)}return 0}},{key:"_findPairs",value:function(){var t=this._complex.getVoxelWorld();if(t!==null)for(var r=this._complex._atoms,n=r.length,i=this,s,o,l,c,f,d=function(v){if(!(o&&v.isHydrogen())){var y=v.location;if(!(c!==Fy&&y!==Fy&&c!==y)){var S=l.distanceToSquared(v.position),_=v.element.radiusBonding,x=s+_+By;S>x*x||S<eD||i._pairCollection.addPair(f.index,v.index)}}},p=0;p<n;++p)f=r[p],tD(f)&&(s=f.element.radiusBonding,o=f.isHydrogen(),l=f.position,c=f.location,t.forEachAtomWithinRadius(l,2*this._maxRad+By,d))}},{key:"_addPairs",value:function(){for(var t=this._complex._atoms,r=0,n=0;r<this._pairCollection.numPairs;r++,n+=4){var i=this._pairCollection.intBuffer[n],s=this._pairCollection.intBuffer[n+1];this._addPair(t[i],t[s])}}},{key:"_addPair",value:function(t,r){for(var n=t.bonds,i=t.index,s=r.index,o=0,l=n.length;o<l;++o){var c=n[o];if(c._left.index===s||c._right.index===s)return}var f=i<s?t:r,d=i<s?r:t,p=this._complex.addBond(f,d,0,Rs.BondType.UNKNOWN,!1);n.push(p),r.bonds.push(p)}},{key:"build",value:function(){this._buildInner()}},{key:"_buildInner",value:function(){var t=this._complex._atoms;if(!(t.length<2)){if(t[0].index<0)throw new Error("AutoBond: Atoms in complex were not indexed.");this._calcBoundingBox(),this._pairCollection=new SS(t.length*Q4),this._addExistingPairs(),this._findPairs(),this._addPairs()}}},{key:"_calcBoundingBox",value:function(){for(var t=this._complex._atoms,r=t.length,n=zy(t[0]),i=1;i<r;++i)n=Math.max(n,zy(t[i]));this._vBoxMax.addScalar(n),this._vBoxMin.addScalar(-n),this._maxRad=n*1.2}},{key:"destroy",value:function(){this._pairCollection&&this._pairCollection.destroy()}}]),a}(),rD=.1,Zm=Rs.BondType.AROMATIC,Vy=[Ce.ByName.C.number,Ce.ByName.N.number],iD=function(){var a=new C,e=new C,t=new C;return function(r,n){return a.copy(r).normalize(),e.copy(n).normalize(),t.crossVectors(a,e),t.length()>rD?!1:a.dot(e)>=0}}();function Uy(a,e){for(var t=0;t<a.length&&a[t]<e;)++t;a.splice(t,0,e)}function Gy(a,e){return a._left===e?a._right:a._left}function aD(a,e){var t=a.dot(e)/Math.sqrt(a.lengthSq()*e.lengthSq());return oa.clamp(t,-1,1)}function sD(a){a._type=Zm}var oD=function(){function a(e){K(this,a),this.atoms=e,this.update()}return J(a,[{key:"update",value:function(){for(var t=this.atoms,r=new C,n=t.length,i=0;i<n;++i)r.add(t[i].position);r.multiplyScalar(1/n),this.center=r,this.radius=r.distanceTo(t[0].position.clone().lerp(t[1].position,.5))}},{key:"forEachBond",value:function(t){var r=this.atoms,n=r.length,i=r[0],s;function o(c){(c._left===s||c._right===s)&&t(c)}for(var l=0;l<n;++l)s=r[(l+1)%n],i.forEachBond(o),i=s}}]),a}();function Hy(a){return a._type===Zm}function lD(a){if(a.type===Zm)return!0;var e=Vy.indexOf(a._right.element.number),t=Vy.indexOf(a._left.element.number);return e!==-1&&t!==-1}function cD(a){return a.length>3}function uD(a){return console.assert(a.length>2),!0}var fD=function(){function a(e){K(this,a),this._complex=e;for(var t=new Array(e._bonds.length),r=new Array(e._bonds.length),n=0,i=t.length;n<i;++n)t[n]=[],r[n]=!1;this._bondsData=t,this._bondMarks=r,this._resetCycles()}return J(a,[{key:"_resetCycles",value:function(){this._cycles=[],this._currIdx=-1}},{key:"_haveSameCycle",value:function(t,r,n){for(var i=t[r._index],s=t[n._index],o=i.length,l=s.length,c=0,f=0;c<o&&f<l;){if(i[c]===s[f])return!0;i[c]>s[f]?++f:++c}return!1}},{key:"_tryBond",value:function(t,r,n){var i=[],s=this._bondsData,o=Gy(t,r),l=r.position.clone().sub(o.position),c=this._currStart,f=this,d=this._bondMarks,p=this._checkBond;d[t._index]=!0,p=p===void 0?Hy:p,r.forEachBond(function(_){if(!(!p(_)||_===t||d[_._index]||f._haveSameCycle(s,t,_))){var x=Gy(_,r),b=x.position.clone().sub(r.position),M=x===c?-2:1-aD(l,b),E=b.cross(l);if(iD(E,n)){for(var T=0;T<i.length&&i[T].val<M;)++T;i.splice(T,0,{bond:_,val:M,dir:E})}}});for(var m=0,v=i.length;m<v;++m){var y=i[m].bond,S=y._left===r?y._right:y._left;if(S===c)return++this._currIdx,this._cycles.push([r]),d[t._index]=!1,!0;if(this._tryBond(y,S,i[m].dir))return Uy(s[y._index],this._currIdx),this._cycles[this._currIdx].push(r),d[t._index]=!1,!0}return d[t._index]=!1,!1}},{key:"_startCycle",value:function(t){this._currStart=t._left,this._tryBond(t,t._right,new C)&&(Uy(this._bondsData[t._index],this._currIdx),this._cycles[this._currIdx].push(t._left))}},{key:"_findLoops",value:function(t,r){this._checkBond=t;var n=this._complex,i=this;n.forEachComponent(function(s){i._resetCycles(),s.forEachBond(function(p){t(p)&&i._startCycle(p)});for(var o=i._cycles,l=0,c=o.length;l<c;++l){var f=o[l];if(r(f)){var d=new oD(f);d.forEachBond(sD),s.addCycle(d)}}})}},{key:"markCycles",value:function(){this._findLoops(Hy,cD)}},{key:"detectCycles",value:function(){this._findLoops(lD,uD)}}]),a}();function hD(a,e,t,r){var n=t-a.z,i=r-a.z,s=Math.sqrt(Math.max(e*e-n*n,0)),o=Math.sqrt(Math.max(e*e-i*i,0)),l=Math.min(s,o),c;return t<=a.z&&r>=a.z?c=e:c=Math.max(s,o),[l,c]}function dD(a,e,t,r){var n=t-a.y,i=r-a.y,s=Math.sqrt(Math.max(e*e-n*n,0)),o=Math.sqrt(Math.max(e*e-i*i,0)),l=Math.min(s,o),c;return t<=a.y&&r>=a.y?c=e:c=Math.max(s,o),[l,c]}var Qa=function(){function a(e,t){K(this,a),this._box=e.clone();var r=new C;e.getSize(r),this._count=r.clone().divide(t).floor().max(new C(1,1,1)),this._last=this._count.clone().subScalar(1),this._cellSize=r.clone().divide(this._count),this._cellInnerR=.5*Math.min(Math.min(this._cellSize.x,this._cellSize.y),this._cellSize.z),this._cellOuterR=.5*Math.sqrt(this._cellSize.dot(this._cellSize));var n=this._count.x*this._count.y*this._count.z;this._voxels=ke.allocateTyped(Int32Array,n);for(var i=0;i<n;++i)this._voxels[i]=-1;this._atoms=[]}return J(a,[{key:"addAtoms",value:function(t){var r=this,n=this._atoms.length;this._atoms.length+=2*t.getAtomCount(),t.forEachAtom(function(i){var s=r._findVoxel(i.position);r._atoms[n]=i,r._atoms[n+1]=r._voxels[s],r._voxels[s]=n,n+=2})}},{key:"_findVoxel",value:function(t){var r=a._zero,n=a._voxel;return n.copy(t).sub(this._box.min).divide(this._cellSize).floor().clamp(r,this._last),n.x+this._count.x*(n.y+this._count.y*n.z)}},{key:"_forEachAtomInVoxel",value:function(t,r){for(var n=this._voxels[t];n>=0;n=this._atoms[n+1])r(this._atoms[n])}},{key:"_forEachVoxelWithinRadius",value:function(t,r,n){var i=a._xRange,s=a._yRange,o=a._zRange;if(r/this._cellInnerR<10){this._forEachVoxelWithinRadiusSimple(t,r,n);return}var l,c,f,d,p,m,v,y;o.set(t.z-r,t.z+r),o.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor().clampScalar(0,this._count.z-1);for(var S=o.x;S<=o.y;++S){p=[this._box.min.z+S*this._cellSize.z,this._box.min.z+(S+1)*this._cellSize.z],y=t.z-r<=p[0]&&p[1]<=t.z+r,l=hD(t,r,p[0],p[1]),s.set(t.y-l[1],t.y+l[1]),s.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor().clampScalar(0,this._count.y-1);for(var _=s.x;_<=s.y;++_){d=[this._box.min.y+_*this._cellSize.y,this._box.min.y+(_+1)*this._cellSize.y],v=t.y-l[0]<=d[0]&&d[1]<=t.y+l[0],c=dD(t,l[1],d[0],d[1]),i.set(t.x-c[1],t.x+c[1]),i.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor().clampScalar(0,this._count.x-1);for(var x=i.x;x<=i.y;++x)f=[this._box.min.x+x*this._cellSize.x,this._box.min.x+(x+1)*this._cellSize.x],m=t.x-c[0]<=f[0]&&f[1]<=t.x+c[0],n(x+this._count.x*(_+this._count.y*S),m&&v&&y)}}}},{key:"_forEachVoxelWithinRadiusSimple",value:function(t,r,n){var i=a._xRange,s=a._yRange,o=a._zRange,l=a._vCenter,c=(r+this._cellOuterR)*(r+this._cellOuterR),f=-1;r>this._cellOuterR&&(f=(r-this._cellOuterR)*(r-this._cellOuterR)),i.set(t.x-r,t.x+r),i.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor(),i.x=Math.min(Math.max(i.x,0),this._count.x-1),i.y=Math.min(Math.max(i.y,0),this._count.x-1),s.set(t.y-r,t.y+r),s.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor(),s.x=Math.min(Math.max(s.x,0),this._count.y-1),s.y=Math.min(Math.max(s.y,0),this._count.y-1),o.set(t.z-r,t.z+r),o.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor(),o.x=Math.min(Math.max(o.x,0),this._count.z-1),o.y=Math.min(Math.max(o.y,0),this._count.z-1);for(var d=o.x;d<=o.y;++d){var p=[this._box.min.z+d*this._cellSize.z,this._box.min.z+(d+1)*this._cellSize.z];l.z=.5*(p[0]+p[1]);for(var m=s.x;m<=s.y;++m){var v=[this._box.min.y+m*this._cellSize.y,this._box.min.y+(m+1)*this._cellSize.y];l.y=.5*(v[0]+v[1]);for(var y=i.x;y<=i.y;++y){var S=[this._box.min.x+y*this._cellSize.x,this._box.min.x+(y+1)*this._cellSize.x];l.x=.5*(S[0]+S[1]);var _=t.distanceToSquared(l);_<=c&&n(y+this._count.x*(m+this._count.y*d),_<=f)}}}}},{key:"forEachAtomWithinRadius",value:function(t,r,n){var i=this,s=r*r;i._forEachVoxelWithinRadius(t,r,function(o,l){l?i._forEachAtomInVoxel(o,n):i._forEachAtomInVoxel(o,function(c){t.distanceToSquared(c.position)<=s&&n(c)})})}},{key:"forEachAtomWithinDistFromMasked",value:function(t,r,n,i){this._forEachAtomWithinDistFromGroup(function(s){t.forEachAtom(function(o){o.mask&r&&s(o)})},n,i)}},{key:"forEachAtomWithinDistFromSelected",value:function(t,r,n,i){this._forEachAtomWithinDistFromGroup(function(s){t.forEachAtom(function(o){r.includesAtom(o)&&s(o)})},n,i)}},{key:"_forEachAtomWithinDistFromGroup",value:function(t,r,n){var i=this,s=r*r,o=[],l=[],c=0;t(function(p){i._forEachVoxelWithinRadius(p.position,r,function(m,v){v?o[m]=-1:typeof o[m]>"u"?(l.push(p),l.push(-1),o[m]=c,c+=2):o[m]!==-1&&(l.push(p),l.push(o[m]),o[m]=c,c+=2)})});var f,d=function(m){if(!(typeof o[f]>"u")){if(c=o[f],c===-1){n(m);return}for(;c>=0;c=l[c+1])if(m.position.distanceToSquared(l[c].position)<s){n(m);break}}};for(f in o)o.hasOwnProperty(f)&&i._forEachAtomInVoxel(f,d)}}]),a}();qe(Qa,"_zero",new C(0,0,0));qe(Qa,"_voxel",new C);qe(Qa,"_xRange",new Pe);qe(Qa,"_yRange",new Pe);qe(Qa,"_zRange",new Pe);qe(Qa,"_vCenter",new C);var lf=.5,Sp=-9.9,Wy=-.5,cf=-27.888,pD=5,mD=1e3,vD=function(){function a(e){K(this,a),this._complex=e,this._hbonds=[],this._complex._residues.length>mD?this._buildVW():this._build()}return J(a,[{key:"isBond",value:function(t,r){if(this._hbonds[t]){var n=pn(this._hbonds[t].acceptor,2),i=n[0],s=n[1];if(i&&i.residue===r&&i.energy<Wy||s&&s.residue===r&&s.energy<Wy)return!0}return!1}},{key:"_build",value:function(){for(var t=this,r=0;r<this._complex._residues.length-1;++r){var n=this._complex._residues[r];if(n.getType().flags&tt.Flags.PROTEIN){var i=null;r>0&&this._complex._residues[r-1].getType().flags&tt.Flags.PROTEIN&&n._sequence===this._complex._residues[r-1]._sequence+1&&(i=this._complex._residues[r-1]);for(var s=r+1;s<this._complex._residues.length;++s){var o=this._complex._residues[s];if(o.getType().flags&tt.Flags.PROTEIN){var l=null;this._complex._residues[s-1].getType().flags&tt.Flags.PROTEIN&&o._sequence===this._complex._residues[s-1]._sequence+1&&(l=this._complex._residues[s-1]),t._calcHBondEnergy(i,n,o),s!==r+1&&t._calcHBondEnergy(l,o,n)}}}}}},{key:"_buildVW",value:function(){var t=this,r=this._complex._residues,n,i,s=this._complex.getVoxelWorld();if(s===null)return;var o=new SS(this._complex._residues.length*this._complex._residues.length/2);function l(f){var d=f.residue;if(d._index!==n._index&&d.getType().flags&tt.Flags.PROTEIN&&o.addPair(n._index,d._index)){var p=d._index>0?r[d._index-1]:null;p&&(!(p.getType().flags&tt.Flags.PROTEIN)||d._sequence!==p._sequence+1)&&(p=null),t._calcHBondEnergy(i,n,d),d._index!==n._index+1&&t._calcHBondEnergy(p,d,n)}}for(var c=0;c<r.length-1;++c)n=r[c],n.getType().flags&tt.Flags.PROTEIN&&(i=c>0?r[c-1]:null,i&&(!(i.getType().flags&tt.Flags.PROTEIN)||n._sequence!==i._sequence+1)&&(i=null),s.forEachAtomWithinRadius(this._residueGetCAlpha(n),pD,l))}},{key:"_residueGetCAlpha",value:function(t){for(var r=0;r<t._atoms.length;++r){var n=t._atoms[r].name;if(n==="CA"||n==="C1")return t._atoms[r].position}return null}},{key:"_residueGetCO",value:function(t){var r=null,n=null;return t.forEachAtom(function(i){i.name==="C"?r=i.position:i.name==="O"&&(n=i.position)}),[r,n]}},{key:"_residueGetNH",value:function(t,r){var n=this._residueGetCO(t),i=pn(n,2),s=i[0],o=i[1],l;if(r.forEachAtom(function(f){f.name==="N"&&(l=f.position)}),s&&o&&l){var c=s.clone();return c.sub(o),c.multiplyScalar(1/c.length()),c.add(l),[l,c]}return[null,null]}},{key:"_calcHBondEnergy",value:function(t,r,n){var i=0;if(t===null)return i;if(r.getType().getName()!=="PRO"){var s=this._residueGetNH(t,r),o=pn(s,2),l=o[0],c=o[1],f=this._residueGetCO(n),d=pn(f,2),p=d[0],m=d[1];if(l===null||c===null||p===null||m===null)return i;var v=c.distanceTo(m),y=c.distanceTo(p),S=l.distanceTo(p),_=l.distanceTo(m);v<lf||y<lf||S<lf||_<lf?i=Sp:i=cf/v-cf/y+cf/S-cf/_,i=Math.round(i*1e3)/1e3,i<Sp&&(i=Sp)}typeof this._hbonds[r._index]>"u"&&(this._hbonds[r._index]={donor:[],acceptor:[]});var x=this._hbonds[r._index];x.acceptor.length<2&&x.acceptor.push({residue:n._index,energy:i}),x.acceptor.length>1&&(i<x.acceptor[0].energy?(x.acceptor[1].residue=x.acceptor[0].residue,x.acceptor[1].energy=x.acceptor[0].energy,x.acceptor[0].residue=n._index,x.acceptor[0].energy=i):i<x.acceptor[1].energy&&(x.acceptor[1].residue=n._index,x.acceptor[1].energy=i)),typeof this._hbonds[n._index]>"u"&&(this._hbonds[n._index]={donor:[],acceptor:[]});var b=this._hbonds[n._index];return b.donor.length<2&&b.donor.push({residue:r._index,energy:i}),b.donor.length>1&&(i<b.donor[0].energy?(b.donor[1].residue=b.donor[0].residue,b.donor[1].energy=b.donor[0].energy,b.donor[0].residue=r._index,b.donor[0].energy=i):i<b.donor[1].energy&&(b.donor[1].residue=r._index,b.donor[1].energy=i)),i}}]),a}();function ps(a,e){var t=typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(!t){if(Array.isArray(a)||(t=gD(a))||e){t&&(a=t);var r=0,n=function(){};return{s:n,n:function(){return r>=a.length?{done:!0}:{done:!1,value:a[r++]}},e:function(c){throw c},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(a)},n:function(){var c=t.next();return i=c.done,c},e:function(c){s=!0,o=c},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function gD(a,e){if(a){if(typeof a=="string")return Xy(a,e);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xy(a,e)}}function Xy(a,e){(e==null||e>a.length)&&(e=a.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=a[t];return r}var ea=Object.freeze({NO_BRIDGE:0,PARALLEL:1,ANTI_PARALLEL:2}),ms=Object.freeze({START:1,MIDDLE:2,END:3,START_AND_END:4}),Gr=Object.freeze({STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",TURN:"T",BEND:"S",LOOP:" "}),jm=function(){function a(e){K(this,a),this._complex=e,this._build()}return J(a,[{key:"_build",value:function(){var t=this;this._hbonds=new vD(this._complex),this._ss=[],this._sheet=[],this._betaPartners=[],this._bend=[];for(var r=0;r<this._complex.getResidues().length;++r)this._betaPartners[r]=[];this._helixFlags=[],this._helixFlags[3]=[],this._helixFlags[4]=[],this._helixFlags[5]=[],this._chainLengths=[];for(var n=0;n<this._complex._chains.length;++n){for(var i=this._complex._chains[n].getResidues(),s=0;s<i.length&&i[s].getType().flags&tt.Flags.PROTEIN;++s);this._chainLengths[n]=s}this._buildBetaSheets();for(var o=0;o<this._complex._chains.length;++o)t._buildAlphaHelices(this._complex._chains[o].getResidues(),this._chainLengths[o],!1)}},{key:"_buildAlphaHelices",value:function(t,r,n){for(var i=3;i<=5&&!(t.length<i);++i)for(var s=0;s+i<r;++s)if(this._hbonds.isBond(t[s+i]._index,t[s]._index)){this._helixFlags[i][t[s+i]._index]=ms.END;for(var o=s+1;o<s+i;++o)typeof this._helixFlags[i][t[o]._index]>"u"&&(this._helixFlags[i][t[o]._index]=ms.MIDDLE);this._helixFlags[i][t[s]._index]===ms.END?this._helixFlags[i][t[s]._index]=ms.START_AND_END:this._helixFlags[i][t[s]._index]=ms.START}for(var l=2;l<r-2;++l){var c=this._kappa(t[l-2],t[l],t[l+2]);this._bend[t[l]._index]=c!==360&&c>70}for(var f=1;f+4<r;++f)if(this._isHelixStart(t[f]._index,4)&&this._isHelixStart(t[f-1]._index,4))for(var d=f;d<=f+3;++d)this._ss[t[d]._index]=Gr.HELIX_ALPHA;for(var p=1;p+3<r;++p)if(this._isHelixStart(t[p]._index,3)&&this._isHelixStart(t[p-1]._index,3)){for(var m=!0,v=p;m&&v<=p+2;++v)m=typeof this._ss[t[v]._index]>"u"||this._ss[t[v]._index]===Gr.HELIX_310;if(m)for(var y=p;y<=p+2;++y)this._ss[t[y]._index]=Gr.HELIX_310}for(var S=1;S+5<r;++S)if(this._isHelixStart(t[S]._index,5)&&this._isHelixStart(t[S-1]._index,5)){for(var _=!0,x=S;_&&x<=S+4;++x)_=typeof this._ss[t[x]._index]>"u"||this._ss[t[x]._index]===Gr.HELIX_PI||n&&this._ss[t[x]._index]===Gr.HELIX_ALPHA;if(_)for(var b=S;b<=S+4;++b)this._ss[t[b]._index]=Gr.HELIX_PI}for(var M=1;M+1<r;++M)if(typeof this._ss[t[M]._index]>"u"){for(var E=!1,T=3;T<=5&&!E;++T)for(var R=1;R<T&&!E;++R)E=M>=R&&this._isHelixStart(t[M-R]._index,T);E?this._ss[t[M]._index]=Gr.TURN:this._bend[t[M]._index]&&(this._ss[t[M]._index]=Gr.BEND)}}},{key:"_residueGetCAlpha",value:function(t){for(var r=0;r<t._atoms.length;++r){var n=t._atoms[r].name;if(n==="CA"||n==="C1")return t._atoms[r].position}return null}},{key:"_cosinusAngle",value:function(t,r,n,i){var s=t.clone().sub(r),o=n.clone().sub(i),l=0,c=s.dot(s)*o.dot(o);return c>0&&(l=s.dot(o)/Math.sqrt(c)),l}},{key:"_kappa",value:function(t,r,n){var i=this._residueGetCAlpha(r),s=this._residueGetCAlpha(t),o=this._residueGetCAlpha(n);if(i===null||s===null||o===null)return 180;var l=this._cosinusAngle(i,s,o,i),c=Math.sqrt(1-l*l);return Math.atan2(c,l)*180/Math.PI}},{key:"_isHelixStart",value:function(t,r){return this._helixFlags[r][t]===ms.START||this._helixFlags[r][t]===ms.START_AND_END}},{key:"_buildBetaSheets",value:function(){for(var t=[],r=0;r<this._complex._chains.length;++r){var n=this._chainLengths[r];if(!(n<=4))for(var i=this._complex._chains[r].getResidues(),s=r;s<this._complex._chains.length;++s){var o=this._chainLengths[s];if(!(o<=4))for(var l=this._complex._chains[s].getResidues(),c=1;c+1<n;++c){var f=i[c],d=1;for(s===r&&(d=c+3);d+1<o;++d){var p=l[d],m=this._testBridge(i,c,l,d);if(m!==ea.NO_BRIDGE){var v=!1,y=ps(t),S;try{for(y.s();!(S=y.n()).done;){var _=S.value;if(!(m!==_.type||f._index!==_.i[_.i.length-1]+1)){if(m===ea.PARALLEL&&_.j[_.j.length-1]+1===p._index){_.i.push(f._index),_.j.push(p._index),v=!0;break}if(m===ea.ANTI_PARALLEL&&_.j[0]-1===p._index){_.i.push(f._index),_.j.unshift(p._index),v=!0;break}}}}catch(je){y.e(je)}finally{y.f()}v||t.push({type:m,i:[f._index],chainI:f.getChain()._index,j:[p._index],chainJ:p.getChain()._index})}}}}}t.sort(function(je,Je){return je.chainI<Je.chainI||je.chainI===Je.chainI&&je.i[0]<Je.i[0]?-1:1});for(var x=0;x<t.length;++x)for(var b=x+1;b<t.length;++b){var M=t[x].i[0],E=t[x].i[t[x].i.length-1],T=t[x].j[0],R=t[x].j[t[x].j.length-1],V=t[b].i[0],Y=t[b].i[t[b].i.length-1],$=t[b].j[0],W=t[b].j[t[b].j.length-1];if(!(t[x].type!==t[b].type||this._hasChainBreak(Math.min(M,V),Math.max(E,Y))||this._hasChainBreak(Math.min(T,$),Math.max(R,W))||V-E>=6||E>=V&&M<=Y)){var j=!1;t[x].type===ea.PARALLEL?j=$-R<6&&V-E<3||$-R<3:j=T-W<6&&V-E<3||T-W<3,j&&(t[x].i=t[x].i.concat(t[b].i),t[x].type===ea.PARALLEL?t[x].j=t[x].j.concat(t[b].j):t[x].j=t[b].j.concat(t[x].j),t.splice(b--,1))}}for(var X=new Set,P=0;P<t.length;++P)X.add(t[P]);for(var N=1,I=0;X.size>0;){var G=X.values().next().value;X.delete(G);var ee=new Set;ee.add(G);var re=void 0;do{re=new Set;var he=ps(ee.values()),pe;try{for(he.s();!(pe=he.n()).done;){var Ie=pe.value,De=ps(X.values()),Le;try{for(De.s();!(Le=De.n()).done;){var Oe=Le.value;this._areBridgesLinked(Ie,Oe)&&re.add(Oe)}}catch(je){De.e(je)}finally{De.f()}}}catch(je){he.e(je)}finally{he.f()}var ne=ps(re.values()),at;try{for(ne.s();!(at=ne.n()).done;)G=at.value,ee.add(G),X.delete(G)}catch(je){ne.e(je)}finally{ne.f()}}while(re.size>0);var Ge=ps(ee.values()),We;try{for(Ge.s();!(We=Ge.n()).done;)G=We.value,G.ladder=I,G.sheet=N,G.link=ee,++I}catch(je){Ge.e(je)}finally{Ge.f()}++N}for(var Ve=0;Ve<t.length;++Ve){for(var Te=t[Ve],me=0,ge=0,se=0;se<Te.i.length;++se)if(this._betaPartners[Te.i[se]][0]){me=1;break}for(var we=0;we<Te.j.length;++we)if(this._betaPartners[Te.j[we]][0]){ge=1;break}var Ee=Gr.BRIDGE;if(Te.i.length>1&&(Ee=Gr.STRAND),Te.type===ea.PARALLEL){for(var z=0,F=0;F<Te.i.length;++F)this._betaPartners[Te.i[F]][me]={residue:Te.j[z++],ladder:Te.ladder,parallel:!0};z=0;for(var ue=0;ue<Te.j.length;++ue)this._betaPartners[Te.j[ue]][ge]={residue:Te.i[z++],ladder:Te.ladder,parallel:!0}}else{for(var be=Te.j.length-1,Fe=0;Fe<Te.i.length;++Fe)this._betaPartners[Te.i[Fe]][me]={residue:Te.j[be--],ladder:Te.ladder,parallel:!1};be=Te.i.length-1;for(var He=0;He<Te.j.length;++He)this._betaPartners[Te.j[He]][ge]={residue:Te.i[be--],ladder:Te.ladder,parallel:!1}}for(var rt=Te.i[0];rt<=Te.i[Te.i.length-1];++rt)this._ss[rt]!==Gr.STRAND&&(this._ss[rt]=Ee,this._sheet[rt]=Te.sheet);for(var Ke=Te.j[0];Ke<=Te.j[Te.j.length-1];++Ke)this._ss[Ke]!==Gr.STRAND&&(this._ss[Ke]=Ee,this._sheet[Ke]=Te.sheet)}}},{key:"_testBridge",value:function(t,r,n,i){var s=ea.NO_BRIDGE,o=t[r-1]._index,l=t[r]._index,c=t[r+1]._index,f=n[i-1]._index,d=n[i]._index,p=n[i+1]._index,m=this._hbonds.isBond.bind(this._hbonds);return m(c,d)&&m(d,o)||m(p,l)&&m(l,f)?s=ea.PARALLEL:(m(c,f)&&m(p,o)||m(d,l)&&m(l,d))&&(s=ea.ANTI_PARALLEL),s}},{key:"_areBridgesLinked",value:function(t,r){var n=new Set(t.i),i=new Set(t.j),s=ps(r.i),o;try{for(s.s();!(o=s.n()).done;){var l=o.value;if(n.has(l)||i.has(l))return!0}}catch(p){s.e(p)}finally{s.f()}var c=ps(r.j),f;try{for(c.s();!(f=c.n()).done;){var d=f.value;if(n.has(d)||i.has(d))return!0}}catch(p){c.e(p)}finally{c.f()}return!1}},{key:"_hasChainBreak",value:function(t,r){for(var n=t+1;n<=r;++n)if(this._complex._residues[n]._sequence!==this._complex._residues[n-1]._sequence+1)return!0;return!1}}]),a}();jm.StructureType=Gr;var zl,vo,wp=5,Fa=jm.StructureType,uf=zn.Type,_D=(zl={},qe(zl,Fa.HELIX_ALPHA,1),qe(zl,Fa.HELIX_PI,3),qe(zl,Fa.HELIX_310,5),zl),yD=(vo={},qe(vo,Fa.BRIDGE,uf.BRIDGE),qe(vo,Fa.TURN,uf.TURN),qe(vo,Fa.BEND,uf.BEND),qe(vo,Fa.LOOP,uf.COIL),vo),xc=function(){function a(){K(this,a),this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._residueTypes=Object.create(tt.StandardTypes),this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[],this._molecules=[],this._maskNeedsUpdate=!1,this.metadata={},this.symmetry=[],this.units=[new xS(this)],this._currentUnit=0}return J(a,[{key:"addAtom",value:function(t){var r=this._atoms.length;return this._atoms.push(t),r}},{key:"addSheet",value:function(t){var r=this._sheets.length;return this._sheets.push(t),r}},{key:"addHelix",value:function(t){var r=this._helices.length;return this._helices.push(t),r}},{key:"getAtoms",value:function(){return this._atoms}},{key:"getBonds",value:function(){return this._bonds}},{key:"getAtomCount",value:function(){return this._atoms.length}},{key:"addResidue",value:function(t){var r=this._residues.length;return this._residues.push(t),r}},{key:"updateToFrame",value:function(t){this.forEachChain(function(r){r.updateToFrame(t)})}},{key:"addResidueType",value:function(t){var r=this._residueTypes[t]=new tt(t,"Unknown","");return r}},{key:"getResidueCount",value:function(){return this._residues.length}},{key:"getResidues",value:function(){return this._residues}},{key:"getSGroupCount",value:function(){return this._sgroups.length}},{key:"getSGroups",value:function(){return this._sgroups}},{key:"getAtomByFullname",value:function(t){var r=t.split(".");if(r.length!==3)return null;var n=r[0],i=parseInt(r[1],10);if(Number.isNaN(i))return null;var s=r[2].toUpperCase(),o=null;return this.forEachChain(function(l){o||l._name.localeCompare(n)===0&&l.forEachResidue(function(c){o||c._sequence===i&&c.forEachAtom(function(f){o||s.localeCompare(f.name)===0&&(o=f)})})}),o}},{key:"addChain",value:function(t){var r=new cS(this,t);return this._chains.push(r),r}},{key:"getChain",value:function(t){for(var r=0,n=this._chains.length;r<n;++r){var i=this._chains[r];if(i.getName()===t)return i}return null}},{key:"getChainCount",value:function(){return this._chains.length}},{key:"getMolecules",value:function(){return this._molecules}},{key:"getMoleculeCount",value:function(){return this._molecules.length}},{key:"forEachAtom",value:function(t){for(var r=this._atoms,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"forEachBond",value:function(t){for(var r=this._bonds,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"forEachResidue",value:function(t){for(var r=this._residues,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"forEachChain",value:function(t){for(var r=this._chains,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"forEachMolecule",value:function(t){for(var r=this._molecules,n=r.length,i=0;i<n;++i)t(r[i])}},{key:"forEachSGroup",value:function(t){for(var r=this._sgroups,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"forEachComponent",value:function(t){for(var r=this._components,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"forEachVisibleComponent",value:function(t){for(var r=this._components,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"addBond",value:function(t,r,n,i,s){var o=new Rs(t,r,n,i,s);return this._bonds.push(o),o}},{key:"getBondCount",value:function(){return this._bonds.length}},{key:"getResidueType",value:function(t){return this._residueTypes[t]||null}},{key:"getUnifiedSerial",value:function(t,r,n){var i=65536,s=i*256;return r+n*i+t*s}},{key:"splitUnifiedSerial",value:function(t){var r=65536,n=r*256,i=Math.floor(t/n),s=t-i*n,o=Math.floor(s/r),l=s-o*r;return{chain:i,serial:l,iCode:o}}},{key:"_fillCmpEdit",value:function(){var t=this,r=this._components;function n(){var i=new Dy(t);return i._index=r.length,r[i._index]=i,i}this.forEachChain(function(i){var s=i._residues,o=s.length;if(!(o<1))for(var l=n(),c=s[0]._index,f=0;f<o;++f){var d=s[f];d._component=l;var p=f===o-1?null:s[f+1];(!p||!d.isConnected(p)||d._index!==p._index-1)&&(l.setSubDivs([{start:c,end:d._index}]),p&&(c=p._index,l=n()))}})}},{key:"_fillCmpNoedit",value:function(){var t=new Dy(this);t._index=0;var r=this._residues,n=r.length;if(n!==0){for(var i=[],s=0,o=0;o<n;++o){var l=r[o];l._component=t;var c=o===n-1?null:r[o+1];(!c||!l.isConnected(c))&&(i[i.length]={start:s,end:o},c&&(s=o+1))}t.setSubDivs(i),this._components[t._index]=t}}},{key:"_fillComponents",value:function(t){t?this._fillCmpEdit():this._fillCmpNoedit()}},{key:"getCurrentUnit",value:function(){return this._currentUnit}},{key:"getDefaultBoundaries",value:function(){return this.units[0].getBoundaries()}},{key:"getBoundaries",value:function(){return this.units[this._currentUnit].getBoundaries()}},{key:"getTransforms",value:function(){return this.units[this._currentUnit].getTransforms()}},{key:"getSelector",value:function(){return this.units[this._currentUnit].getSelector()}},{key:"resetCurrentUnit",value:function(){this._currentUnit=0,this.setCurrentUnit(1)}},{key:"setCurrentUnit",value:function(t){return t!=null&&t!==this._currentUnit&&t>=0&&t<this.units.length?(this._currentUnit=t,!0):!1}},{key:"_computeBounds",value:function(){for(var t=this.units,r=0,n=t.length;r<n;++r)t[r].computeBoundaries()}},{key:"onAtomPositionChanged",value:function(){this.forEachChain(function(t){t._finalize()}),this.forEachComponent(function(t){t.update()}),this._computeBounds(),this._finalizeBonds(),this.forEachSGroup(function(t){t._rebuildSGroupOnAtomChange()})}},{key:"update",value:function(){this._maskNeedsUpdate&&(this.updateStructuresMask(),this._maskNeedsUpdate=!1)}},{key:"_finalizeBonds",value:function(){for(var t=this.getBonds(),r=t.length,n=0;n<r;++n)t[n]._index=n}},{key:"finalize",value:function(t){t=t||{};var r=this._bonds,n,i;for(n=r.length-1;n>=0;n--){var s=r[n];s._left===null||s._right===null?r.splice(n,1):(s._left.bonds.push(s),s._right.bonds.push(s))}var o=this._residues;for(n=0,i=o.length;n<i;++n)o[n]._finalize();this.forEachChain(function(T){T._finalize()});var l=this.units;for(n=0,i=l.length;n<i;++n)l[n].finalize();this.setCurrentUnit(1);var c={};for(n=0,i=o.length;n<i;++n){var f=o[n];c[this.getUnifiedSerial(f.getChain().getName().charCodeAt(0),f.getSequence(),f.getICode().charCodeAt(0))]=f}var d=this.structures;for(n=0,i=d.length;n<i;++n)d[n]._finalize(t.serialAtomMap,c,this);var p=this._helices;for(n=0,i=p.length;n<i;++n)p[n]._finalize(t.serialAtomMap,c,this);var m=this._sheets;for(n=0,i=m.length;n<i;++n)m[n]._finalize(t.serialAtomMap,c,this);this._computeBounds();var v=this._atoms;for(n=0,i=v.length;n<i;++n){var y=v[n];y.index=n}if(t.needAutoBonding){var S=new nD(this);S.build(),S.destroy()}var _=this._chains;for(n=0,i=_.length;n<i;++n)_[n]._index=n;for(n=0,i=o.length;n<i;++n)o[n]._index=n;for(n=0,i=v.length;n<i;++n){var x=v[n];if(x.flags&Si.Flags.HYDROGEN&&x.bonds.length===1){var b=x.bonds[0],M=b._left!==x&&b._left||b._right;M.flags&Si.Flags.CARBON&&(x.flags|=Si.Flags.NONPOLARH)}}this._finalizeBonds(),this._fillComponents(t.enableEditing);var E=new fD(this);E.markCycles(),t.detectAromaticLoops&&E.detectCycles(),this._finalizeMolecules()}},{key:"_finalizeMolecules",value:function(){for(var t=0;t<this._molecules.length;t++)for(var r=this._molecules[t],n=r.residues.length,i=0;i<n;i++){var s=r.residues[i];s._molecule=r}}},{key:"updateStructuresMask",value:function(){var t=function(n){return n.collectMask()};this.forEachResidue(t),this.forEachChain(t),this.forEachMolecule(t)}},{key:"countAtomsByMask",value:function(t){var r=0;return this.forEachAtom(function(n){n.mask&t&&r++}),r}},{key:"getNumAtomsBySelector",value:function(t){var r=0;return this.forEachAtom(function(n){t.includesAtom(n)&&r++}),r}},{key:"resetAtomMask",value:function(t){this.forEachAtom(function(r){r.mask=t})}},{key:"markAtoms",value:function(t,r){var n=r,i=~n,s=0,o=un.keyword("And")(t,this.getSelector());return this.forEachAtom(function(l){o.includesAtom(l)?(l.mask|=n,s++):l.mask&=i}),this._maskNeedsUpdate=!0,s}},{key:"markAtomsAdditionally",value:function(t,r){var n=r,i=0;return this.forEachAtom(function(s){t.includesAtom(s)&&(s.mask&r)!==r&&(s.mask|=n,i++)}),i}},{key:"clearAtomBits",value:function(t){var r=~t;this.forEachAtom(function(i){i.mask&=r});var n=function(s){s._mask&=r};this.forEachAtom(n),this.forEachResidue(n),this.forEachChain(n),this.forEachMolecule(n)}},{key:"getAtomNames",value:function(){if(this.hasOwnProperty("_atomNames"))return this._atomNames;var t={};return this.forEachAtom(function(r){t[r.name]=1}),this._atomNames=Object.keys(t),this._atomNames}},{key:"getElements",value:function(){if(this.hasOwnProperty("_elements"))return this._elements;var t={};return this.forEachAtom(function(r){t[r.element.name]=1}),this._elements=Object.keys(t),this._elements}},{key:"getResidueNames",value:function(){if(this.hasOwnProperty("_residueNames"))return this._residueNames;var t={};return this.forEachResidue(function(r){t[r._type._name]=1}),this._residueNames=Object.keys(t),this._residueNames}},{key:"getChainNames",value:function(){if(this.hasOwnProperty("_chainNames"))return this._chainNames;var t={};return this.forEachChain(function(r){t[r._name]=1}),this._chainNames=Object.keys(t),this._chainNames}},{key:"getAltLocNames",value:function(){if(this.hasOwnProperty("_altlocNames"))return this._altlocNames;var t={};return this.forEachAtom(function(r){t[String.fromCharCode(r.location)]=1}),this._altlocNames=Object.keys(t),this._altlocNames}},{key:"getVoxelWorld",value:function(){if(!this.hasOwnProperty("_voxelWorld"))try{this._voxelWorld=new Qa(this.getDefaultBoundaries().boundingBox,new C(wp,wp,wp)),this._voxelWorld.addAtoms(this)}catch{kn.warn("Unable to create voxel world"),this._voxelWorld=null}return this._voxelWorld}},{key:"addElement",value:function(t,r,n,i){for(var s=t.length,o=0;o<s;++o){var l=t[o];i(l,n),r.push(l)}}},{key:"joinComplexes",value:function(t){this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[];var r=this,n=0,i=0,s=0,o=0,l=0;function c(x,b){x.serial+=b,x.index+=b}function f(x,b){x._index+=b}function d(x,b){x._index+=b}function p(x,b){x._complex=r,x._index+=b}function m(x,b){x._complex=r,x._index+=b}function v(){}for(var y=0;y<t.length;++y){var S=t[y];this.addElement(S._atoms,this._atoms,n,c),this.addElement(S._bonds,this._bonds,i,f),this.addElement(S._residues,this._residues,s,d),this.addElement(S._chains,this._chains,o,p),this.addElement(S._sheets,this._sheets,0,v),this.addElement(S._helices,this._helices,0,v),this.addElement(S._sgroups,this._sgroups,0,v),this.addElement(S._components,this._components,l,m),this.addElement(S.structures,this.structures,0,v);for(var _ in S._residueTypes)S._residueTypes.hasOwnProperty(_)&&(this._residueTypes[_]=S._residueTypes[_]);n+=S._atoms.length,i+=S._bonds.length,s+=S._residues.length,o+=S._chains.length,l+=S._components.length}this._computeBounds()}},{key:"dssp",value:function(){for(var t=new jm(this),r=this.structures=[],n=this._helices=[],i=this._sheets=[],s=function(M){var E=i[M];return E||(E=i[M]=new fS(String(M),0)),E},o,l,c=0,f=null,d=0,p=this._residues.length;d<p;++d){var m=t._ss[d],v=this._residues[d],y=t._sheet[d];if(m===o&&y===l){v._secondary=f,f&&(f.term=v),f instanceof lm&&f.length++;continue}var S=_D[m],_=yD[m];if(m===Fa.STRAND){var x=s(y);f=new Wm(x,v,v,0,null,null),x.addStrand(f)}else S!==void 0?(c++,f=new lm(S,v,v,c,String(c),"",1),n.push(f)):_!==void 0?f=new zn(_,v,v):f=null;f&&r.push(f),v._secondary=f,o=m,l=y}this._sheets=i.filter(function(b){return!0})}}]),a}();xc.prototype.id="Complex";xc.prototype.name="";function Yy(a){var e=2;for(a=a-1>>1;a;)e<<=1,a>>=1;return e}var Km=function(){function a(e,t,r,n,i,s){if(K(this,a),this._box=r.clone(),this._dimVec=Math.max(Math.floor(n||1),1),this._volumeInfo=s,t instanceof Array){var o=pn(t,3);this._dimX=o[0],this._dimY=o[1],this._dimZ=o[2]}else this._dimX=t.x,this._dimY=t.y,this._dimZ=t.z;switch(this._dimX=Math.max(Math.floor(this._dimX),1),this._dimY=Math.max(Math.floor(this._dimY),1),this._dimZ=Math.max(Math.floor(this._dimZ),1),this._rowElements=this._dimVec*this._dimX,this._planeElements=this._rowElements*this._dimY,this._totalElements=this._planeElements*this._dimZ,this._data=i||ke.allocateTyped(e,this._totalElements),this._dimVec){case 1:break;case 2:this.getValue=function(l,c,f){var d=l*this._dimVec+c*this._rowElements+f*this._planeElements;return[this._data[d],this._data[d+1]]},this.setValue=function(l,c,f,d,p){var m=l*this._dimVec+c*this._rowElements+f*this._planeElements;this._data[m]=d,this._data[m+1]=p},this.addValue=function(l,c,f,d,p){var m=l*this._dimVec+c*this._rowElements+f*this._planeElements;this._data[m]+=d,this._data[m+1]+=p};break;case 3:this.getValue=function(l,c,f){var d=l*this._dimVec+c*this._rowElements+f*this._planeElements;return[this._data[d],this._data[d+1],this._data[d+2]]},this.setValue=function(l,c,f,d,p,m){var v=l*this._dimVec+c*this._rowElements+f*this._planeElements;this._data[v]=d,this._data[v+1]=p,this._data[v+2]=m},this.addValue=function(l,c,f,d,p,m){var v=l*this._dimVec+c*this._rowElements+f*this._planeElements;this._data[v]+=d,this._data[v+1]+=p,this._data[v+2]+=m};break;default:throw new Error("Volume: invalid vector dimension")}}return J(a,[{key:"getValue",value:function(t,r,n){return this._data[t+r*this._rowElements+n*this._planeElements]}},{key:"setValue",value:function(t,r,n,i){this._data[t+r*this._rowElements+n*this._planeElements]=i}},{key:"addValue",value:function(t,r,n,i){this._data[t+r*this._rowElements+n*this._planeElements]+=i}},{key:"getDimensions",value:function(){return[this._dimX,this._dimY,this._dimZ]}},{key:"getBox",value:function(){return this._box}},{key:"getVolumeInfo",value:function(){return this._volumeInfo}},{key:"getCellSize",value:function(){var t=new C;this._box.getSize(t);var r=new C;return r.x=this._dimX>1?t.x/(this._dimX-1):0,r.y=this._dimY>1?t.y/(this._dimY-1):0,r.z=this._dimZ>1?t.z/(this._dimZ-1):0,r}},{key:"computeGradient",value:function(){if(this._dimVec!==1)return null;var t=new a(Float32Array,[this._dimX,this._dimY,this._dimZ],this._box,3),r=this.getCellSize(),n=new C(-.5/r.x,-.5/r.y,-.5/r.z);function i(M,E,T){return Math.min(T,Math.max(E,M))}var s=this._dimX,o=this._dimY,l=this._dimZ,c=this._data;function f(M,E,T){return c[T*s*o+E*s+M]}for(var d=0;d<l;++d)for(var p=i(d-1,0,l-1),m=i(d+1,0,l-1),v=0;v<o;++v)for(var y=i(v-1,0,o-1),S=i(v+1,0,o-1),_=0;_<s;++_){var x=i(_-1,0,s-1),b=i(_+1,0,s-1);t.setValue(_,v,d,(f(b,v,d)-f(x,v,d))*n.x,(f(_,S,d)-f(_,y,d))*n.y,(f(_,v,m)-f(_,v,p))*n.z)}return t}},{key:"normalize",value:function(){for(var t=this._data,r=t[0],n=t[0],i=1;i<t.length;++i)r=Math.min(r,t[i]),n=Math.max(n,t[i]);var s=1/(n-r);if(s!==0)for(var o=0;o<t.length;++o)t[o]=s*(t[o]-r)}},{key:"getTiledTextureStride",value:function(){return[this._dimX+2,this._dimY+2]}},{key:"buildTiledTexture",value:function(){var t=Math.ceil(Math.sqrt(this._dimZ*this._dimY/this._dimX)),r=t*(this._dimX+2)-1;r=Yy(r),t=Math.floor(r/(this._dimX+2));var n=Math.ceil(this._dimZ/t),i=n*(this._dimY+2)-1;i=Yy(i);for(var s=new Uint8Array(r*i),o,l,c=0;c<n;++c)for(var f=0;f<this._dimY;++f){o=c*t*this._planeElements+f*this._rowElements,l=r*(c*(this._dimY+2)+f);for(var d=0;d<t;++d){for(var p=0;p<this._dimX;++p)s[l++]=255*this._data[o++];s[l++]=255*this._data[o-1],d<t-1&&(o+=this._planeElements-this._rowElements,s[l++]=255*this._data[o])}}for(var m=0;m<n;++m){o=r*(m*(this._dimY+2)+this._dimY-1),l=o+r;for(var v=0;v<r;++v)s[l++]=s[o++];if(m<n-1){o=r*(m+1)*(this._dimY+2),l=o-r;for(var y=0;y<r;++y)s[l++]=s[o++]}}var S=new Rm(s,r,i,$1,Ya,$f,ur,ur,qt,qt);return S.needsUpdate=!0,S}},{key:"getData",value:function(){return this._data}},{key:"getDirectIdx",value:function(t,r,n){return t*this._dimVec+r*this._rowElements+n*this._planeElements}},{key:"getStrideX",value:function(){return this._dimVec}},{key:"getStrideY",value:function(){return this._rowElements}},{key:"getStrideZ",value:function(){return this._planeElements}}]),a}();Km.prototype.id="Volume";var xD=function(){function a(e,t,r){K(this,a),this.complex=e,this.name=t||"",this.residues=[],this.mask=1,this.index=r||-1}return J(a,[{key:"forEachResidue",value:function(t){for(var r=this.residues,n=0,i=r.length;n<i;++n)t(r[n])}},{key:"collectMask",value:function(){for(var t=4294967295,r=this.residues,n=0,i=r.length;n<i;++n)t&=r[n]._mask;this.mask=t}}]),a}(),pt={Atom:Si,Element:Ce,Bond:Rs,Residue:Gf,ResidueType:tt,Chain:cS,Helix:lm,Strand:Wm,Sheet:fS,SGroup:G4,Assembly:qm,Complex:xc,Volume:Km,VoxelWorld:Qa,selectors:un,Molecule:xD};function SD(a){var e=wD();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function wD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Jm=function(a){ve(t,a);var e=SD(t);function t(r){var n;K(this,t),n=e.call(this);var i=si(n);return n._element=r,n._element.style.position="absolute",n.addEventListener("removed",function(){i._element.parentNode!==null&&i._element.parentNode.removeChild(i._element)}),n}return J(t,[{key:"getElement",value:function(){return this._element}},{key:"setTransparency",value:function(n){var i=this.getElement();if(i!==null){if(n===1){i.style.display="none";return}i.style.display="inline";var s=1-n,o=s.toString(),l=s*100;i.style.opacity=o,i.style.filter="alpha(opacity=".concat(l,")")}}},{key:"clone",value:function(){var n=new t(this._element);return n.copy(this),n}}]),t}(Dt);function bD(a){var e=MD();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function MD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ps=function(a){ve(t,a);var e=bD(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"raycast",value:function(n,i){if(this.visible)for(var s=this.children,o=0,l=s.length;o<l;++o)s[o].raycast(n,i)}},{key:"enableSubset",value:function(n,i){for(var s=this.children,o=0,l=s.length;o<l;++o)s[o].enableSubset&&s[o].enableSubset(n,i)}},{key:"disableSubset",value:function(n,i){for(var s=this.children,o=0,l=s.length;o<l;++o)s[o].disableSubset&&s[o].disableSubset(n,i)}},{key:"isEmpty",value:function(){return this.children.length===0}},{key:"updateToFrame",value:function(n){for(var i=this.children,s=0,o=i.length;s<o;++s)i[s].updateToFrame&&i[s].updateToFrame(n)}},{key:"getSubset",value:function(n,i){for(var s=[],o=this.children,l=0,c=o.length;l<c;++l)o[l].getSubset&&Array.prototype.push.apply(s,o[l].getSubset(n,i));return s}}]),t}(nr),es=`uniform mat4 projectionMatrix;\r
uniform mat4 modelViewMatrix;\r
\r
attribute vec2 uv;\r
attribute vec3 position;\r
\r
varying vec2 vUv;\r
\r
void main() {\r
  vUv = uv;\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r
}\r
`,ED=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform float opacity;\r
\r
void main() {\r
  vec4 color = texture2D(srcTex, vUv);\r
  gl_FragColor = vec4(color.xyz, color.a * opacity);\r
}\r
`,CD=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform float coef;\r
\r
void main() {\r
  vec2 uv = vUv * 2.0 - 1.0;\r
  float r2 = dot(uv, uv);\r
  vec2 tc = uv * (1.0 + coef * r2);\r
  if (!all(lessThan(abs(tc), vec2(1.0))))\r
    discard;\r
  tc = 0.5 * (tc + 1.0);\r
  gl_FragColor = texture2D(srcTex, tc);\r
}\r
`;function AD(a){var e=TD();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function TD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var um={DEFAULT:0,VOLUME:1,TRANSPARENT:2,PREPASS_TRANSPARENT:3,VOLUME_BFPLANE:4,COLOR_FROM_POSITION:5,SHADOWMAP:6},$y=[um.DEFAULT,um.TRANSPARENT];Dt.prototype.resetTransform=function(){this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1)};Dt.prototype.updateMatrixWorldRecursive=function(){this.parent!=null&&this.parent.updateMatrixWorldRecursive(),this.updateMatrixWorld()};Dt.prototype.addSavingWorldTransform=function(){var a=new Xe;return function(e){e instanceof Dt&&(a.copy(this.matrixWorld).invert(),a.multiply(e.matrixWorld),e.matrix.copy(a),e.matrix.decompose(e.position,e.quaternion,e.scale),this.add(e))}}();Zt.prototype.renderDummyQuad=function(){var a=new Qf({transparent:!0,opacity:0,depthWrite:!1}),e=new Ga,t=new Ut(new Ka(.01,.01),a);e.add(t);var r=new Yo(-.5,.5,.5,-.5,-1e4,1e4);return r.position.z=100,function(){this.render(e,r)}}();Zt.prototype.renderScreenQuad=function(){var a=new Ga,e=new Ut(new Ka(1,1));a.add(e);var t=new Yo(-.5,.5,.5,-.5,-1e4,1e4);return t.position.z=100,function(r){e.material=r,this.render(a,t)}}();Xe.prototype.isIdentity=function(){var a=new Xe;return function(){return a.equals(this)}}();Xe.prototype.applyToPointsArray=function(a,e,t){if(!a||!e||e<3)return a;t=t||0;for(var r=this.elements,n=0;n<a.length;n+=e){var i=a[n],s=a[n+1],o=a[n+2],l=1/(r[3]*i+r[7]*s+r[11]*o+r[15]);a[n]=(r[0]*i+r[4]*s+r[8]*o+r[12]*t)*l,a[n+1]=(r[1]*i+r[5]*s+r[9]*o+r[13]*t)*l,a[n+2]=(r[2]*i+r[6]*s+r[10]*o+r[14]*t)*l}return a};var wS=function(a){ve(t,a);var e=AD(t);function t(r){return K(this,t),r.uniforms===void 0&&(r.uniforms={}),r.uniforms.srcTex={type:"t",value:null},r.vertexShader=es,r.transparent=!1,r.depthTest=!1,r.depthWrite=!1,e.call(this,r)}return J(t)}(Yr);Zt.prototype.renderScreenQuadFromTex=function(){var a=new wS({uniforms:{opacity:{type:"f",value:1}},fragmentShader:ED,transparent:!0});return function(e,t){a.uniforms.srcTex.value=e,a.transparent=t<1,a.uniforms.opacity.value=t,this.renderScreenQuad(a)}}();Zt.prototype.renderScreenQuadFromTexWithDistortion=function(){var a=new wS({uniforms:{coef:{type:"f",value:1}},fragmentShader:CD});return function(e,t){a.uniforms.srcTex.value=e,a.uniforms.coef.value=t,this.renderScreenQuad(a)}}();En.prototype.setMinimalFov=function(a){this.aspect>=1?this.fov=a:this.fov=oa.radToDeg(2*Math.atan(Math.tan(oa.degToRad(a)*.5)/this.aspect))};Wx.prototype.updateHalfSized=function(a,e){var t=a.aspect,r=a.fov;a.aspect=t/2,a.setMinimalFov(e),a.updateProjectionMatrix(),this.update(a),a.aspect=t,a.fov=r,a.updateProjectionMatrix()};En.prototype.setDistanceToFit=function(a,e){this.position.z=a/Math.sin(.5*oa.degToRad(e))};Xx.prototype.intersectVisibleObject=function(a,e,t,r){var n=this.intersectObject(a,!1);if(n.length===0)return null;var i=Math.min(e.near,t),s,o=n[0],l=new C;for(s=0;s<n.length&&(o=n[s],l.copy(o.point),l.applyMatrix4(e.matrixWorldInverse),!(l.z<=-i));++s);if(s===n.length)return null;var c=Math.min(e.far,r);return l.copy(o.point),l.applyMatrix4(e.matrixWorldInverse),l.z<=-c?null:o};Xe.prototype.extractScale=function(){var a=new C;return function(e){e===void 0&&(kn.debug("extractScale(): new is too expensive operation to do it on-the-fly"),e=a.clone());var t=this.elements;e.x=a.set(t[0],t[1],t[2]).length(),e.y=a.set(t[4],t[5],t[6]).length(),e.z=a.set(t[8],t[9],t[10]).length();var r=this.determinant();return r<0&&(e.x=-e.x),e}}();function RD(a,e,t){var r=a.clone().lerp(e,.5),n=new Xe;n.makeScale(t,a.distanceTo(e),t);var i=new Xe;i.makeRotationX(Math.PI/2);var s=new Xe,o=new C(0,1,0);return s.lookAt(r,e,o),s.multiply(i),s.multiply(n),s.setPosition(r),s}function LD(a,e,t,r){var n=new Xe;n.makeScale(r.x,r.y,0);var i=new Xe;return i.lookAt(a,e,t),i.multiply(n),i.setPosition(a),i}function PD(a){var e=!1;return a.traverse(function(t){(t.hasOwnProperty("geometry")||t instanceof Jm)&&(e=!0)}),e}function ID(a,e,t){function r(f){for(var d=1e-5,p=0,m=f,v=1;Math.abs(m-p)>d;)v=1+t*m,p=m,m=f/(v*v);return 1/v}for(var n=new Ka(2,2,a,e),i=n.getAttribute("position"),s=0;s<i.count;++s){var o=i.array[3*s],l=i.array[3*s+1],c=r(o*o+l*l);i.setXY(s,c*o,c*l)}return n}mt.prototype.copyAtList=function(a,e){console.assert(this.itemSize===a.itemSize,"false: BufferAttribute.copyAtList buffers have different item size.");for(var t=this.itemSize,r=0,n=e.length;r<n;++r)for(var i=0;i<t;++i)this.array[r*t+i]=a.array[e[r]*t+i];return this};function ND(a,e,t,r){t=typeof t<"u"?t:0,r=typeof r<"u"?r:a.length;for(var n=t;n<r;++n)a[n]=e}function kD(a){for(var e=a.children,t=0,r=e.length;t<r;++t){var n=e[t];n.parent=null,n.dispatchEvent({type:"removed"})}a.children=[]}function bS(a){a.traverse(function(e){(e instanceof Ut||e instanceof $r||e instanceof Ts)&&e.geometry.dispose()}),kD(a)}function OD(a){bS(a),a.parent?a.parent.remove(a):a.dispatchEvent({type:"removed"})}function DD(a){for(var e=0;e<$y.length;e++)if((a.layers.mask>>$y[e]&1)===1)return!0;return!1}function FD(a,e){var t=+(e!=="BA");a.traverse(function(r){r.isGroup&&(r.renderOrder=t)})}function BD(a){a.traverse(function(e){"material"in e&&(e.material=e.material.clone(!0),e.material.setValues({depthFunc:kf,overrideColor:!0,fog:!1,lights:!1,shadowmap:!1}),e.material.setUberOptions({fixedColor:new nt(16776960),zOffset:-1e-6}))})}function zD(a,e,t){var r=t||new C;return r.set(0,0,0),r.addScaledVector(a,.5),r.addScaledVector(e,.5),r}var VD=Za.prototype.copy;Za.prototype.copy=function(a){VD.call(this,a),this.instanceCount===void 0&&(this.instanceCount=1/0)};var _t={calcCylinderMatrix:RD,calcChunkMatrix:LD,groupHasGeometryToRender:PD,buildDistorionMesh:ID,RCGroup:Ps,fillArray:ND,clearTree:bS,destroyObject:OD,belongToSelectLayers:DD,processObjRenderOrder:FD,applySelectionMaterial:BD,getMiddlePoint:zD,LAYERS:um};function UD(a){var e=GD();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function GD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HD={boundingBox:new An(new C(-1,-1,-1),new C(1,1,1)),boundingSphere:new Lr(new C(0,0,0),1)},dc=function(a){ve(t,a);var e=UD(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i.name=r,i._dataSource=n,i}return J(t,[{key:"release",value:function(){this.parent&&this.parent.remove(this)}},{key:"getDataSource",value:function(){return this._dataSource}},{key:"getBoundaries",value:function(){return HD}}]),t}(_t.RCGroup);function WD(a){if(Array.isArray(a))return tm(a)}function XD(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function YD(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ms(a){return WD(a)||XD(a)||$x(a)||YD()}function qy(a){return a==null||Array.isArray(a)?a:[a]}var Is=function(){function a(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["id"];K(this,a),this._list=[],this._dict={},this._indices=Ms(r),this._indices.forEach(function(n){e._dict[n]={}}),t.forEach(function(n){return e.register(n)})}return J(a,[{key:"register",value:function(t){var r=this;a.registerInList(this._list,t),this._indices.forEach(function(n){a.registerInDict(r._dict[n],qy(t[n]),t)})}},{key:"unregister",value:function(t){var r=this;a.unregisterFromList(this._list,t),this._indices.forEach(function(n){a.unregisterFromDict(r._dict[n],qy(t[n]),t)})}},{key:"all",get:function(){return Ms(this._list)}},{key:"first",get:function(){return this._list[0]}},{key:"keys",value:function(t){return Object.keys(this._dict[t||this._indices[0]])}},{key:"get",value:function(t,r){var n=this._dict[r||this._indices[0]];if(n){var i=n[t&&t.toLowerCase()];return i&&i.length>0?i[0]:void 0}}}],[{key:"registerInList",value:function(t,r){t.includes(r)||t.push(r)}},{key:"unregisterFromList",value:function(t,r){var n=t.indexOf(r);n!==-1&&t.splice(n,1)}},{key:"registerInDict",value:function(t,r,n){r.forEach(function(i){i=i.toLowerCase();var s=t[i]=t[i]||[];s.includes(n)||s.push(n)})}},{key:"unregisterFromDict",value:function(t,r,n){r.forEach(function(i){i=i.toLowerCase();var s=t[i];if(s){var o=s.indexOf(n);o!==-1&&s.splice(o,1),s.length===0&&delete t[i]}})}}]),a}();function Sc(a){Object.defineProperties(a,{logger:{get:function(){return this.context&&this.context.logger?this.context.logger:kn}},settings:{get:function(){return this.context&&this.context.settings?this.context.settings:fe}}})}function $D(a){var e=qD();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function qD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MS=function(){function a(e,t){K(this,a),this._position=e,this._radius=t}return J(a,[{key:"raycast",value:function(t){var r=a._sphere;r.set(this._position,this._radius);var n=new C;return t.ray.intersectSphere(r,n)?{distance:t.ray.origin.distanceTo(n),point:n}:null}}]),a}();qe(MS,"_sphere",new Lr);var Qm=function(e){return function(t){ve(n,t);var r=$D(n);function n(i){var s;K(this,n);for(var o=arguments.length,l=new Array(o>1?o-1:0),c=1;c<o;c++)l[c-1]=arguments[c];return s=r.call.apply(r,[this].concat(l)),s._objects=new Array(i),s.boundingSphere=null,s.boundingBox=null,s}return J(n,[{key:"setSphere",value:function(s,o,l){this._objects[s]=new MS(o,l)}},{key:"raycast",value:function(s,o){for(var l=0,c=this._objects.length;l<c;++l){var f=this._objects[l].raycast(s);f&&(f.chunkIdx=l,o.push(f))}}},{key:"computeBoundingBox",value:function(){var s=this._objects,o=this.boundingBox;o===null&&(this.boundingBox=o=new An),o.makeEmpty();for(var l=0,c=s.length;l<c;++l)o.expandByPoint(s[l]._position)}},{key:"computeBoundingSphere",value:function(){this.computeBoundingBox();var s=this._objects,o=this.boundingBox,l=0,c=new C;o.getCenter(c);for(var f=0,d=s.length;f<d;++f){var p=s[f]._position,m=c.distanceToSquared(p);l<m&&(l=m)}this.boundingSphere===null&&(this.boundingSphere=new Lr),this.boundingSphere.set(c,Math.sqrt(l))}}]),n}(e)};function ZD(a){var e=jD();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function jD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ff=new nt,hf=4,df=3,Zy=ke.copySubArrays;function KD(a,e,t,r,n){a[e]=t,a[e+1]=r,a[e+2]=n}function JD(a,e,t,r,n,i){a[e]=t,a[e+1]=r,a[e+2]=n,a[e+3]=i}var ES=function(a){ve(t,a);var e=ZD(t);function t(r,n,i){var s;return K(this,t),s=e.call(this,r),s._sphGeometry=i?new Ka(2,2,1,1):new ah(1,n*2,n,0,Math.PI*2,0,Math.PI),s._init(r,s._sphGeometry),s}return J(t,[{key:"setItem",value:function(n,i,s){JD(this._offsets,n*hf,i.x,i.y,i.z,s),this.setSphere(n,i,s)}},{key:"setColor",value:function(n,i){ff.set(i),KD(this._colors,n*df,ff.r,ff.g,ff.b)}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("offset").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(n,i){for(var s=this._alpha,o=0,l=n.length;o<l;++o)s[n[o]]=i;this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubset",value:function(n){var i=n.length,s=new Za;return this._init.call(s,i,this._sphGeometry),Zy(this._offsets,s._offsets,n,hf),Zy(this._colors,s._colors,n,df),s.boundingSphere=this.boundingSphere,s.boundingBox=this.boundingBox,[s]}},{key:"_init",value:function(n,i){this.copy(i),this._offsets=ke.allocateTyped(Float32Array,n*hf),this._colors=ke.allocateTyped(Float32Array,n*df);var s=this._alpha=ke.allocateTyped(Float32Array,n);xe.fill(s,1),this.setAttribute("offset",new Er(this._offsets,hf,!1,1)),this.setAttribute("color",new Er(this._colors,df,!1,1)),this.setAttribute("alphaColor",new Er(s,1,!1,1))}}]),t}(Qm(Za));function QD(a){var e=e5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function e5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var t5=65535,Ra=3,pf=new nt,uh=function(a){ve(t,a);var e=QD(t);function t(r,n){var i;if(K(this,t),i=e.call(this),i.constructor===t)throw new Error("Can not instantiate abstract class!");return i._chunkGeo=r,i._init(r,n),i}return J(t,[{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("normal").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}},{key:"setColor",value:function(n,i){pf.set(i);for(var s=this._colors,o=this._chunkSize,l=n*o,c=l+o;l<c;++l){var f=l*Ra;s[f]=pf.r,s[f+1]=pf.g,s[f+2]=pf.b}}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(n,i){for(var s=this._alpha,o=this._chunkSize,l=0,c=n.length;l<c;++l){var f=n[l]*o;xe.fill(s,i,f,f+o)}this.getAttribute("alphaColor").needsUpdate=!0}},{key:"raycast",value:function(n,i){var s=[],o=new Ut;o.geometry=this,o.raycast(n,s);for(var l=this._chunkGeo.index.count/3,c=0,f=s.length;c<f;++c)s[c].hasOwnProperty("faceIndex")&&(s[c].chunkIdx=Math.floor(s[c].faceIndex/l),i.push(s[c]))}},{key:"getSubset",value:function(n){var i=n.length,s=new It;this._init.call(s,this._chunkGeo,i);for(var o=this._positions,l=this._normals,c=this._colors,f=s._positions,d=s._normals,p=s._colors,m=this._chunkSize*Ra,v=0,y=n.length;v<y;++v){var S=v*m,_=n[v]*m,x=_+m;f.set(o.subarray(_,x),S),d.set(l.subarray(_,x),S),p.set(c.subarray(_,x),S)}return s.boundingSphere=this.boundingSphere,s.boundingBox=this.boundingBox,[s]}},{key:"_init",value:function(n,i){var s=this._chunkSize=n.attributes.position.count,o=n.index.array,l=o.length,c=this._chunkSize*i,f=c>t5,d=l*i,p=this._index=ke.allocateTyped(f?Uint32Array:Uint16Array,d);this._positions=ke.allocateTyped(Float32Array,c*Ra),this._normals=ke.allocateTyped(Float32Array,c*Ra),this._colors=ke.allocateTyped(Float32Array,c*Ra);var m=this._alpha=ke.allocateTyped(Float32Array,c);xe.fill(m,1);for(var v=0;v<i;++v){var y=v*l,S=v*s;p.set(o,y);for(var _=0;_<l;++_)p[y+_]+=S}this.setIndex(new mt(this._index,1)),this.setAttribute("position",new mt(this._positions,Ra)),this.setAttribute("normal",new mt(this._normals,Ra)),this.setAttribute("color",new mt(this._colors,Ra)),this.setAttribute("alphaColor",new mt(m,1))}}]),t}(It);function n5(a){var e=r5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function r5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bp=3,i5=function(a){ve(t,a);var e=n5(t);function t(r,n){var i;K(this,t);var s=new ah(1,n*2,n,0,Math.PI*2,0,Math.PI);i=e.call(this,r,s,r);var o=i._normals,l=s.attributes.normal.array,c=i._chunkSize;i._chunkPos=i._chunkGeo.attributes.position.array,i._tmpPositions=ke.allocateTyped(Float32Array,c*bp);for(var f=0;f<r;++f)o.set(l,c*bp*f);return i}return J(t,[{key:"setItem",value:function(n,i,s){for(var o=this._tmpPositions,l=this._chunkSize,c=this._chunkPos,f=0;f<l;++f){var d=f*3;o[d]=i.x+c[d]*s,o[d+1]=i.y+c[d+1]*s,o[d+2]=i.z+c[d+2]*s}this._positions.set(o,l*n*bp),this.setSphere(n,i,s)}}]),t}(Qm(uh));function a5(a){var e=s5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function s5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var go=3,_o=new C,yo=new C,jy=new Cn,ev=function(a){ve(t,a);var e=a5(t);function t(r,n){var i;K(this,t);var s=new gc(1,1,1,Math.max(3,n),2,!0);i=e.call(this,s,2*r);var o=i._chunkSize;return i._chunkPos=i._chunkGeo.attributes.position.array,i._chunkNorms=i._chunkGeo.attributes.normal.array,i._tmpVector=ke.allocateTyped(Float32Array,o*go),i}return J(t,[{key:"setItem",value:function(n,i,s,o){var l=this._chunkSize,c=l*2*n*go,f=c+l*go,d=this._tmpVector,p=this._chunkPos,m=this._chunkNorms;_o.lerpVectors(i,s,.5);var v=_t.calcCylinderMatrix(i,_o,o);jy.getNormalMatrix(v);for(var y,S=0;S<l;++S)y=S*go,yo.fromArray(p,y),yo.applyMatrix4(v),yo.toArray(d,y);this._positions.set(d,c),_o.sub(i);for(var _=0;_<l;++_)y=_*go,d[y]+=_o.x,d[y+1]+=_o.y,d[y+2]+=_o.z;this._positions.set(d,f);for(var x=0;x<l;++x)y=x*go,yo.fromArray(m,y),yo.applyMatrix3(jy),yo.toArray(d,y);this._normals.set(d,c),this._normals.set(d,f)}},{key:"setColor",value:function(n,i,s){var o=2*n;nn(H(t.prototype),"setColor",this).call(this,o,i);var l=o+1;nn(H(t.prototype),"setColor",this).call(this,l,s)}}]),t}(uh);function o5(a){var e=l5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function l5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var c5=65536,Vl=3,u5=function(a){ve(t,a);var e=o5(t);function t(r,n,i,s,o,l){var c;K(this,t),c=e.call(this);var f=0,d=2*Math.PI;c.type="CylinderBufferGeometry",c.parameters={radiusTop:r,radiusBottom:n,height:i,radialSegments:s,heightSegments:o,openEnded:l};var p=l===!1&&r>0,m=l===!1&&n>0,v=(o+1)*s+p*(s+1)+m*(s+1),y=(2*o+p+m)*s,S=i/2,_=new mt(ke.allocateTyped(Float32Array,v*3),3),x=new mt(ke.allocateTyped(Float32Array,v*3),3),b=new Mm(ke.allocateTyped(Uint16Array,y*Vl),1),M=new mt(ke.allocateTyped(Float32Array,v*2),2);console.assert(v<c5,"false: Cylinder Geometry has too many vertices (65536 max).");for(var E=0,T=0,R=-(n-r)/i,V=0;V<=o;V++){if(V!==o)for(var Y=0;Y<s;Y++){var $=E+Y,W=E+s+Y,j=E+s+(Y+1)%s,X=E+(Y+1)%s;b.setXYZ(T*Vl,$,X,W),T++,b.setXYZ(T*Vl,W,X,j),T++}for(var P=V/o,N=P*(n-r)+r,I=0;I<s;I++){var G=I/s,ee=N*Math.sin(G*d+f),re=P*i-S,he=N*Math.cos(G*d+f),pe=new C(ee,Math.sqrt(ee*ee+he*he)*R,he).normalize();_.setXYZ(E,ee,re,he),x.setXYZ(E,pe.x,pe.y,pe.z),M.setXY(E,G,P),++E}}if(p){for(var Ie=E,De=E+s,Le=0;Le<s;++Le){var Oe=E-s;_.setXYZ(E,_.getX(Oe),_.getY(Oe),_.getZ(Oe)),x.setXYZ(E,0,1,0),M.setXY(E,1,1);var ne=Ie+(Le+1)%s;b.setXYZ(T*Vl,E,ne,De),T++,E++}_.setXYZ(E,0,S,0),x.setXYZ(E,0,1,0),M.setXY(E,1,1),++E}if(m){for(var at=E,Ge=E+s,We=0;We<s;++We){var Ve=We;_.setXYZ(E,_.getX(Ve),_.getY(Ve),_.getZ(Ve)),x.setXYZ(E,0,-1,0),M.setXY(E,0,0);var Te=at+(We+1)%s;b.setXYZ(T*Vl,Te,E,Ge),T++,E++}_.setXYZ(E,0,-S,0),x.setXYZ(E,0,-1,0),M.setXY(E,0,0)}return c.setIndex(b),c.setAttribute("position",_),c.setAttribute("normal",x),c.setAttribute("uv",M),c}return J(t,[{key:"clone",value:function(){var n=this.parameters;return new t(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded)}}]),t}(It);function f5(a){var e=h5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function h5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var La=new nt,Ky=new Xe,Nn=4,aa=3,Pa=ke.copySubArrays;function Jy(a,e,t,r,n){a[e]=t,a[e+1]=r,a[e+2]=n}function xo(a,e,t,r,n,i){a[e]=t,a[e+1]=r,a[e+2]=n,a[e+3]=i}function d5(a,e){return a-e}function p5(a){a.sort(d5);for(var e=[],t=[],r=0,n=a.length;r<n;++r){var i=a[r],s=(i|0)%2===0,o={first:!1,second:!1};s?(o.first=!0,o.second=r+1<n&&a[r+1]===a[r]+1,o.second&&++r):o.second=!0,e.push(Math.floor(i/2)),t.push(o)}return{indices:e,cylinderInfo:t}}function m5(a,e,t){for(var r=0,n=a.length;r<n;++r){var i=a[r];i.first||(e[aa*r]=-.5),i.second||(t[aa*r]=-.5)}}var CS=function(a){ve(t,a);var e=f5(t);function t(r,n,i,s){var o;return K(this,t),o=e.call(this),o._useZSprites=i,o._cylGeometry=i?new Ka(2,2,1,1):new u5(1,1,1,Math.max(3,n),2,s),o._init(r,o._cylGeometry,o._useZSprites),o._collisionGeo=new ev(r,3),o}return J(t,[{key:"setItem",value:function(n,i,s,o){var l=_t.calcCylinderMatrix(i,s,o),c=l.elements,f=n*Nn;this._collisionGeo.setItem(n,i,s,o),xo(this._matVector1,f,c[0],c[4],c[8],c[12]),xo(this._matVector2,f,c[1],c[5],c[9],c[13]),xo(this._matVector3,f,c[2],c[6],c[10],c[14]),this._useZSprites&&(Ky.copy(l).invert(),c=Ky.elements,xo(this._invmatVector1,f,c[0],c[4],c[8],c[12]),xo(this._invmatVector2,f,c[1],c[5],c[9],c[13]),xo(this._invmatVector3,f,c[2],c[6],c[10],c[14]))}},{key:"setColor",value:function(n,i,s){var o=n*aa;La.set(i),Jy(this._color1,o,La.r,La.g,La.b),La.set(s),Jy(this._color2,o,La.r,La.g,La.b)}},{key:"computeBoundingSphere",value:function(){this._collisionGeo.computeBoundingSphere(),this.boundingSphere=this._collisionGeo.boundingSphere}},{key:"computeBoundingBox",value:function(){this._collisionGeo.computeBoundingBox(),this.boundingBox=this._collisionGeo.boundingBox}},{key:"raycast",value:function(n,i){this._collisionGeo.raycast(n,i)}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("matVector1").needsUpdate=!0,this.getAttribute("matVector2").needsUpdate=!0,this.getAttribute("matVector3").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("color2").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this._useZSprites&&(this.getAttribute("invmatVector1").needsUpdate=!0,this.getAttribute("invmatVector2").needsUpdate=!0,this.getAttribute("invmatVector3").needsUpdate=!0),this._collisionGeo.finishUpdate()}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(n,i){for(var s=this._alpha,o=0,l=n.length;o<l;++o)s[Math.floor(n[o]/2)]=i;this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubset",value:function(n){var i=p5(n),s=i.indices,o=s.length,l=new Za;return this._init.call(l,o,this._cylGeometry,this._useZSprites),Pa(this._matVector1,l._matVector1,s,Nn),Pa(this._matVector2,l._matVector2,s,Nn),Pa(this._matVector3,l._matVector3,s,Nn),this._useZSprites&&(Pa(this._invmatVector1,l._invmatVector1,s,Nn),Pa(this._invmatVector2,l._invmatVector2,s,Nn),Pa(this._invmatVector3,l._invmatVector3,s,Nn)),Pa(this._color1,l._color1,s,aa),Pa(this._color2,l._color2,s,aa),m5(i.cylinderInfo,l._color1,l._color2),l.boundingSphere=this.boundingSphere,l.boundingBox=this.boundingBox,[l]}},{key:"getGeoParams",value:function(){return this._cylGeometry.parameters}},{key:"_init",value:function(n,i,s){this.copy(i),this._matVector1=ke.allocateTyped(Float32Array,n*Nn),this._matVector2=ke.allocateTyped(Float32Array,n*Nn),this._matVector3=ke.allocateTyped(Float32Array,n*Nn),this._color1=ke.allocateTyped(Float32Array,n*aa),this._color2=ke.allocateTyped(Float32Array,n*aa);var o=this._alpha=ke.allocateTyped(Float32Array,n);xe.fill(o,1),this.setAttribute("matVector1",new Er(this._matVector1,Nn,!1,1)),this.setAttribute("matVector2",new Er(this._matVector2,Nn,!1,1)),this.setAttribute("matVector3",new Er(this._matVector3,Nn,!1,1)),this.setAttribute("color",new Er(this._color1,aa,!1,1)),this.setAttribute("color2",new Er(this._color2,aa,!1,1)),this.setAttribute("alphaColor",new Er(this._alpha,1,!1,1)),s&&(this._invmatVector1=ke.allocateTyped(Float32Array,n*Nn),this._invmatVector2=ke.allocateTyped(Float32Array,n*Nn),this._invmatVector3=ke.allocateTyped(Float32Array,n*Nn),this.setAttribute("invmatVector1",new Er(this._invmatVector1,Nn,!1,1)),this.setAttribute("invmatVector2",new Er(this._invmatVector2,Nn,!1,1)),this.setAttribute("invmatVector3",new Er(this._invmatVector3,Nn,!1,1)))}}]),t}(Za);function v5(a){var e=g5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function g5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tr=3,Mp=3,So=new C,wo=new C,mf=new C,_5=new C(1,0,0),Qy=new C,e1=new C;function y5(a,e){for(var t=new It,r=a.length,n=r*e,i=n<=65536?Uint16Array:Uint32Array,s=(e-1)*r*2,o=new mt(ke.allocateTyped(i,s*Mp),1),l=0,c=0,f=0;f<e;f++){if(f!==e-1)for(var d=0;d<r;d++){var p=l+d,m=l+r+d,v=l+r+(d+1)%r,y=l+(d+1)%r;o.setXYZ(c*Mp,p,y,m),c++,o.setXYZ(c*Mp,m,y,v),c++}l+=r}t.setIndex(o);var S=ke.allocateTyped(Float32Array,n*tr);return t.setAttribute("position",new mt(S,tr)),t._positions=a,t}var x5=function(a){ve(t,a);var e=v5(t);function t(r,n,i){var s;K(this,t);var o=y5(r,n);s=e.call(this,o,i),s._ringsCount=n;for(var l=s._tmpShape=[],c=0;c<r.length;++c)l[c]=new C;return s}return J(t,[{key:"setItem",value:function(n,i){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=this._chunkGeo._positions.length,c=this._ringsCount,f=l*this._ringsCount*n*tr;this._setPoints(i,l,c,f),s?this._setSlopeNormals(l,c,f):this._setBaseNormals(l,c,f),o&&this._addCut(l,c,f)}},{key:"_setPoints",value:function(n,i,s,o){for(var l=this._tmpShape,c=this._positions,f=this._chunkGeo._positions,d=0,p=o;d<s;++d)for(var m=n[d],v=0;v<i;++v,p+=tr)l[v].copy(f[v]).applyMatrix4(m).toArray(c,p)}},{key:"_setBaseNormals",value:function(n,i,s){for(var o=n*tr,l=0,c=s;l<i;++l,c+=o)this._countNormalsInRing(n,c,!1)}},{key:"_setSlopeNormals",value:function(n,i,s){for(var o=this._normals,l=n*tr,c=s,f=0;f<n;++f,c+=tr)_5.toArray(o,c);if(c-2*l>0)for(var d=0;d<n;++d,c+=tr)mf.fromArray(o,c-2*l).toArray(o,c);else this._countNormalsInRing(n,c,!0,+l),c+=l;for(var p=2;p<i;++p,c+=l)this._countNormalsInRing(n,c,!0,-l)}},{key:"_countNormalsInRing",value:function(n,i,s,o){var l=this._tmpShape,c=this._normals;l[0].fromArray(this._positions,i),l[n-1].fromArray(this._positions,i+(n-1)*tr);for(var f=0;f<n;++f,i+=tr)f<n-1&&l[f+1].fromArray(this._positions,i+tr),s?(e1.fromArray(this._positions,i+o),So.subVectors(l[(f+n-1)%n],l[(f+1)%n]).normalize(),wo.subVectors(l[f],e1).normalize(),mf.crossVectors(wo,So).normalize().toArray(c,i)):(So.subVectors(l[f],l[(f+n-1)%n]).normalize(),wo.subVectors(l[f],l[(f+1)%n]).normalize(),mf.addVectors(So,wo).normalize().toArray(c,i))}},{key:"_addCut",value:function(n,i,s){if(!(n<3||i<2)){var o=this._positions,l=this._normals,c=this._tmpShape,f=n*tr;c[0].fromArray(o,s),c[1].fromArray(o,s+tr),c[2].fromArray(o,s+2*tr),So.subVectors(c[1],c[0]).normalize(),wo.subVectors(c[1],c[2]).normalize(),Qy.crossVectors(So,wo).normalize();for(var d=s,p=0;p<n*2;++p,d+=tr)Qy.toArray(l,d);if(i>2)for(var m=0;m<n;++m,d+=tr)mf.fromArray(o,d-f).toArray(o,d)}}}]),t}(uh);function S5(a){var e=w5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function w5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var b5=65535,Hr=4,ta=4,Ia=3,Na=3,Ur=new nt,xr=new C;function ka(a,e,t,r,n){a[e]=t,a[e+1]=r,a[e+2]=n}function vf(a,e,t,r,n,i){a[e]=t,a[e+1]=r,a[e+2]=n,a[e+3]=i}function gf(a,e,t,r){var n=e*Hr,i=n+t*Hr;return a.subarray(n*r,i*r)}var AS=function(a){ve(t,a);var e=S5(t);function t(r){var n;return K(this,t),n=e.call(this),n._initVertices(r),n}return J(t,[{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this.getAttribute("direction").needsUpdate=!0}},{key:"setColor",value:function(n,i){Ur.set(i);var s=n*Hr*Na;ka(this._colors,s,Ur.r,Ur.g,Ur.b),s+=Na,ka(this._colors,s,Ur.r,Ur.g,Ur.b),s+=Na,ka(this._colors,s,Ur.r,Ur.g,Ur.b),s+=Na,ka(this._colors,s,Ur.r,Ur.g,Ur.b)}},{key:"setSegment",value:function(n,i,s){xr.subVectors(i,s),xr.normalize();var o=this._positions,l=this._directions,c=n*Hr*ta,f=n*Hr*Ia;vf(o,c,i.x,i.y,i.z,.5),ka(l,f,xr.x,xr.y,xr.z),c+=ta,f+=Ia,vf(o,c,i.x,i.y,i.z,-.5),ka(l,f,xr.x,xr.y,xr.z),c+=ta,f+=Ia,vf(o,c,s.x,s.y,s.z,.5),ka(l,f,xr.x,xr.y,xr.z),c+=ta,f+=Ia,vf(o,c,s.x,s.y,s.z,-.5),ka(l,f,xr.x,xr.y,xr.z)}},{key:"setOpacity",value:function(n,i,s){var o=n*Hr,l=i*Hr;xe.fill(this.alpha,s,l,o),this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubsetSegments",value:function(n,i){return[gf(this._positions,n,i,ta),gf(this._directions,n,i,Ia)]}},{key:"getSubsetColors",value:function(n,i){return gf(this._colors,n,i,Na)}},{key:"getSubsetOpacities",value:function(n,i){return gf(this._alpha,n,i,1)}},{key:"getNumVertexPerSegment",value:function(){return Hr}},{key:"getPositionSize",value:function(){return ta}},{key:"setSegments",value:function(n,i){var s=n*Hr*ta;if(i instanceof Array&&i.length===2){this._positions.set(i[0],s);var o=n*Hr*Ia;this._directions.set(i[1],o)}else this._positions.set(i,s)}},{key:"setColors",value:function(n,i){var s=n*Hr*Na;this._colors.set(i,s)}},{key:"_initVertices",value:function(n){this._buffersSize=n*Hr;var i=this._buffersSize,s=i>b5;this._index=ke.allocateTyped(s?Uint32Array:Uint16Array,n*6),this._positions=ke.allocateTyped(Float32Array,i*ta),this._colors=ke.allocateTyped(Float32Array,i*Na),this._directions=ke.allocateTyped(Float32Array,i*Ia);var o=this._alpha=ke.allocateTyped(Float32Array,i);xe.fill(o,1);for(var l=this._index,c=0,f=0,d=0;d<n;d++,c+=6,f+=Hr)l[c]=f,l[c+1]=f+1,l[c+2]=f+3,l[c+3]=f,l[c+4]=f+2,l[c+5]=f+3;this.setIndex(new mt(this._index,1)),this.setAttribute("position",new mt(this._positions,ta)),this.setAttribute("color",new mt(this._colors,Na)),this.setAttribute("alphaColor",new mt(o,1)),this.setAttribute("direction",new mt(this._directions,Ia))}}]),t}(It);function M5(a){var e=E5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function E5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TS=function(a){ve(t,a);var e=M5(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"startUpdate",value:function(){return!0}},{key:"computeBoundingSphere",value:function(){var n=this.boundingBox,i=0,s=new C;n&&n.getCenter(s);for(var o=this._positions,l=this.boundingSphere||new Lr,c=this._positions.length,f=new C,d=this.getPositionSize(),p=0;p<c;p+=d){f.set(o[p],o[p+1],o[p+2]);var m=s.distanceToSquared(f);i<m&&(i=m)}l.set(s,Math.sqrt(i)),this.boundingSphere=l}},{key:"computeBoundingBox",value:function(){for(var n=this._positions,i=new An,s=this._positions.length,o=new C,l=this.getPositionSize(),c=0;c<s;c+=l)o.set(n[c],n[c+1],n[c+2]),i.expandByPoint(o);this.boundingBox=i}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}}]),t}(AS);function C5(a){var e=A5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function A5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _f=3,bo=new C,t1=new Cn,T5=function(a){ve(t,a);var e=C5(t);function t(r,n){var i;K(this,t);var s=new gc(1,1,1,Math.max(3,n),2,!0);i=e.call(this,s,r);var o=i._chunkSize;return i._chunkPos=i._chunkGeo.attributes.position.array,i._chunkNorms=i._chunkGeo.attributes.normal.array,i._tmpVector=ke.allocateTyped(Float32Array,o*_f),i}return J(t,[{key:"setItem",value:function(n,i,s,o){var l=this._chunkSize,c=l*n*_f,f=this._tmpVector,d=this._chunkPos,p=this._chunkNorms,m=_t.calcCylinderMatrix(i,s,o);t1.getNormalMatrix(m);for(var v,y=0;y<l;++y)v=y*_f,bo.fromArray(d,v),bo.applyMatrix4(m),bo.toArray(f,v);this._positions.set(f,c);for(var S=0;S<l;++S)v=S*_f,bo.fromArray(p,v),bo.applyMatrix3(t1),bo.toArray(f,v);this._normals.set(f,c)}}]),t}(uh);function R5(a){var e=L5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function L5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var P5=.1,RS=function(a){ve(t,a);var e=R5(t);function t(r,n,i){var s;return K(this,t),s=e.call(this,r*n),s._init(n),s._collisionGeo=i?new T5(r*n,3):null,s}return J(t,[{key:"startUpdate",value:function(){return!0}},{key:"computeBoundingSphere",value:function(){var n=this._collisionGeo;if(n){n.computeBoundingSphere(),this.boundingSphere=n.boundingSphere;return}nn(H(t.prototype),"computeBoundingSphere",this).call(this)}},{key:"computeBoundingBox",value:function(){var n=this._collisionGeo;if(n){n.computeBoundingBox(),this.boundingBox=n.boundingBox;return}nn(H(t.prototype),"computeBoundingBox",this).call(this)}},{key:"raycast",value:function(n,i){var s=this._collisionGeo;if(s){var o=this._chunkSize;this._collisionGeo.raycast(n,i);for(var l=0,c=i.length;l<c;++l){var f=i[l].chunkIdx;f!==void 0&&(f=f/o|0,i[l].chunkIdx=f)}}}},{key:"setColor",value:function(n,i){for(var s=this._chunkSize,o=n*s,l=o+s;o<l;++o)nn(H(t.prototype),"setColor",this).call(this,o,i)}},{key:"setSegment",value:function(n,i,s,o){var l=this._chunkSize,c=n*l+i;nn(H(t.prototype),"setSegment",this).call(this,c,s,o),this._collisionGeo&&this._collisionGeo.setItem(n*l+i,s,o,P5)}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(n,i){for(var s=this._chunkSize,o=0,l=n.length;o<l;++o){var c=n[o]*s;nn(H(t.prototype),"setOpacity",this).call(this,c,c+s-1,i)}}},{key:"getSubset",value:function(n){for(var i=n.length,s=this._chunkSize,o=new t(i,s,!1),l=0,c=n.length;l<c;++l){var f=l*s,d=n[l]*s;o.setSegments(f,this.getSubsetSegments(d,s)),o.setColors(f,this.getSubsetColors(d,s))}return o.boundingSphere=this.boundingSphere,o.boundingBox=this.boundingBox,[o]}},{key:"_init",value:function(n){this._chunkSize=n}}]),t}(TS);function I5(a){var e=N5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function N5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var k5=.3,Ep=new C,O5=function(a){ve(t,a);var e=I5(t);function t(r){var n;return K(this,t),n=e.call(this,r*2),n._init(r),n._collisionGeo=new ev(r,3),n}return J(t,[{key:"setItem",value:function(n,i,s){this._collisionGeo.setItem(n,i,s,k5);var o=2*n;Ep.lerpVectors(i,s,.5),nn(H(t.prototype),"setSegment",this).call(this,o,i,Ep),nn(H(t.prototype),"setSegment",this).call(this,o+1,Ep,s)}},{key:"setColor",value:function(n,i,s){var o=2*n;nn(H(t.prototype),"setColor",this).call(this,o,i),nn(H(t.prototype),"setColor",this).call(this,o+1,s)}},{key:"raycast",value:function(n,i){this._collisionGeo&&this._collisionGeo.raycast(n,i)}},{key:"getSubset",value:function(n){for(var i=n.length,s=new t(i),o=0,l=i;o<l;++o){var c=n[o];s.setSegments(o,this.getSubsetSegments(c,1)),s.setColors(o,this.getSubsetColors(c,1))}return s.boundingSphere=this.boundingSphere,s.boundingBox=this.boundingBox,[s]}},{key:"_init",value:function(n){this._segCounts=n*2}}]),t}(TS);function D5(a){var e=F5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function F5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ys=[new C(1,0,0),new C(-1,0,0),new C(0,1,0),new C(0,-1,0),new C(0,0,1),new C(0,0,-1)],n1=ys.length,yf=new C,xf=new C,B5=function(a){ve(t,a);var e=D5(t);function t(r){return K(this,t),e.call(this,r,r,n1/2|0,!1)}return J(t,[{key:"setItem",value:function(n,i,s){this.setSphere(n,i,s);for(var o=0;o<n1/2;++o){var l=o*2;yf.x=i.x+ys[l].x*s,yf.y=i.y+ys[l].y*s,yf.z=i.z+ys[l].z*s;var c=l+1;xf.x=i.x+ys[c].x*s,xf.y=i.y+ys[c].y*s,xf.z=i.z+ys[c].z*s,this.setSegment(n,o,yf,xf)}}}]),t}(Qm(RS));function z5(a){var e=V5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function V5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var r1=4,i1=3,Sf=new nt,LS=function(a){ve(t,a);var e=z5(t);function t(r,n){var i;return K(this,t),i=e.call(this),i._opts=n,i.zClip=i._opts.zClip,i._posRad=ke.allocateTyped(Float32Array,r*r1),i._colors=ke.allocateTyped(Float32Array,r*i1),i}return J(t,[{key:"setItem",value:function(n,i,s){var o=this._posRad,l=r1*n;o[l++]=i.x,o[l++]=i.y,o[l++]=i.z,o[l]=s}},{key:"setColor",value:function(n,i){Sf.set(i);var s=this._colors,o=i1*n;s[o++]=Sf.r,s[o++]=Sf.g,s[o]=Sf.b}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"finishUpdate",value:function(){this._build()}},{key:"setOpacity",value:function(){}},{key:"raycast",value:function(){}},{key:"getSubset",value:function(){return[]}}]),t}(It),tv=function(){function a(){K(this,a),this.pointsValuesLinear=null,this.hasIntersection=null,this.bitsInside=null}return J(a,[{key:"create",value:function(t){var r=117440512,n=t*t*t;if(n>r)throw new Error("Too large cube dimension: lead to memory huge uasge");return this.pointsValuesLinear=ke.allocateTyped(Float32Array,32*n),this.hasIntersection=ke.allocateTyped(Int32Array,n),this.bitsInside=ke.allocateTyped(Int32Array,n),0}},{key:"destroy",value:function(){this.bitsInside=null,this.hasIntersection=null,this.pointsValuesLinear=null}}]),a}();tv.prototype.striIndicesMarchCube=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];var a1=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0];function U5(a,e,t){var r=a.getValue(e.x,e.y,e.z);t.set(r[0],r[1],r[2])}var G5=J(function a(){K(this,a),this._arrSize=8,this.p=new Array(this._arrSize),this.g=new Array(this._arrSize),this.val=new Array(this._arrSize);for(var e=0;e<this._arrSize;++e)this.p[e]=new C,this.g[e]=new C;this.cubeIndex=0}),H5=J(function a(){K(this,a),this.a={p:new C,n:new C},this.b={p:new C,n:new C},this.c={p:new C,n:new C}});function PS(a){for(var e=new Array(a),t=0;t<a;++t)e[t]=new C;return e}var ca=function(){function a(){K(this,a),this._numTriangles=0,this._numVertices=0,this._position=[],this._normals=[],this._colors=null,this._indices=[],this._volumetricData=null,this._xAxis=new C,this._yAxis=new C,this._zAxis=new C,this._xDir=new C,this._yDir=new C,this._zDir=new C}return J(a,[{key:"_prepareAxesAndDirs",value:function(){var t=this._volumetricData,r=t.getCellSize(),n=this._xAxis,i=this._yAxis,s=this._zAxis,o=this._xDir,l=this._yDir,c=this._zDir;n.set(r.x,0,0),i.set(0,r.y,0),s.set(0,0,r.z),o.set(1,0,0),l.set(0,1,0),c.set(0,0,1);var f=new C;if(f.crossVectors(o,l),f.dot(c)<0&&(o.negate(),l.negate(),c.negate()),o.x<0||o.y<0||o.z<0||l.x<0||l.y<0||l.z<0||c.x<0||c.y<0||c.z<0)return!1;var d=function(m){return Math.abs(m)>Number.EPSILON};return!(d(n.y)||d(n.z)||d(i.x)||d(i.z)||d(s.x)||d(s.y))}},{key:"_vertexInterp",value:function(t,r,n,i,s,o){var l=r.p[n],c=r.p[i],f=r.g[n],d=r.g[i],p=r.val[n],m=r.val[i],v=t-p,y=m-p,S=0;Math.abs(y)>0&&(S=v/y),S=S>1?1:S,s.lerpVectors(l,c,S),o.lerpVectors(f,d,S)}},{key:"_polygonize",value:function(t,r,n){for(var i=t.cubeIndex,s=0,o=a._arrSize,l=a._firstIndices,c=a._secondIndices,f=a._vertexList,d=a._normalList;s<o;++s)a1[i]&1<<s&&this._vertexInterp(r,t,l[s],c[s],f[s],d[s]);var p=0,m=i*16,v=a._triTable;for(s=0;v[m+s]!==-1;s+=3)n[p].a.p.copy(f[v[m+s]]),n[p].a.n.copy(d[v[m+s]]),n[p].b.p.copy(f[v[m+s+1]]),n[p].b.n.copy(d[v[m+s+1]]),n[p].c.p.copy(f[v[m+s+2]]),n[p].c.n.copy(d[v[m+s+2]]),++p;return p}},{key:"_doGridPosNorms",value:function(t,r,n){for(var i=this._volumetricData,s=this._volumetricData.getData(),o=i.getDimensions(),l=o[0],c=o[1],f=o[2],d=r*i.getStrideX(),p=r*i.getStrideY(),m=r*i.getStrideZ(),v=new G5,y=v.val,S=v.val.length,_=[new C(0,0,0),new C(r,0,0),new C(r,r,0),new C(0,r,0),new C(0,0,r),new C(r,0,r),new C(r,r,r),new C(0,r,r)],x=5,b=new Array(x),M=0;M<x;++M)b[M]=new H5;var E,T=this,R=this._position,V=this._normals;n?E=function(){var ee=new C(T._xAxis.x,T._yAxis.y,T._zAxis.z);return function(re){var he=re.p.clone();he.multiply(ee),R.push(he.add(T._origin)),V.push(re.n.clone())}}():E=function(){var ee=new Cn;ee.set(T._xAxis.x,T._yAxis.x,T._zAxis.x,T._xAxis.y,T._yAxis.y,T._zAxis.y,T._xAxis.z,T._yAxis.z,T._zAxis.z);var re=new Cn;return re.set(T._xDir.x,T._yDir.x,T._zDir.x,T._xDir.y,T._yDir.y,T._zDir.y,T._xDir.z,T._yDir.z,T._zDir.z),function(he){R.push(he.p.clone().applyMatrix3(ee).add(T._origin)),V.push(he.n.clone().applyMatrix3(re))}}();for(var Y=this._indices,$=0,W=0;W<f-r;W+=r)for(var j=0;j<c-r;j+=r)for(var X=i.getDirectIdx(0,j,W),P=0;P<l-r;P+=r,X+=d){y[0]=s[X],y[1]=s[X+d],y[3]=s[X+p],y[2]=s[X+d+p],y[4]=s[X+m],y[5]=s[X+d+m],y[7]=s[X+p+m],y[6]=s[X+d+p+m];for(var N=0,I=0;I<S;++I)y[I]<t&&(N|=1<<I);if(a1[N]!==0){for(v.cubeIndex=N,I=0;I<S;++I)v.p[I].set(P+_[I].x,j+_[I].y,W+_[I].z),U5(this._gradient,v.p[I],v.g[I]);var G=this._polygonize(v,t,b);for($+=G,I=0;I<G;++I)Y.push(this._numTriangles*3),Y.push(this._numTriangles*3+1),Y.push(this._numTriangles*3+2),++this._numTriangles,E(b[I].a),E(b[I].b),E(b[I].c)}}return $}},{key:"compute",value:function(t,r,n,i){this._volumetricData=t,this._origin=r,this._gradient=t.computeGradient(),this._doGridPosNorms(n,i,this._prepareAxesAndDirs())}},{key:"_remapIndices",value:function(t,r){for(var n=this._indices,i=ke.allocateTyped(Uint32Array,r),s=0;s<r;++s)n[s]=t[n[s]],i[s]=n[s];this._indices=i}},{key:"_remapVertices",value:function(t,r,n){for(var i=ke.allocateTyped(Float32Array,n*3),s=ke.allocateTyped(Float32Array,n*3),o=0;o<n;++o){var l=t[o];i[o*3]=l.x,i[o*3+1]=l.y,i[o*3+2]=l.z;var c=r[o].normalize();s[o*3]=c.x,s[o*3+1]=c.y,s[o*3+2]=c.z}this._position=i,this._normals=s}},{key:"vertexFusion",value:function(t,r){var n=this._indices.length,i=this._position,s=this._normals,o=i.length|0;if(!(n===0||o===0)){var l=ke.allocateTyped(Uint32Array,o);l[0]=0;for(var c=1,f=1;f<o;++f){for(var d=c-t<0?0:c-t,p=d+r>c?c:d+r,m=-1,v=d;v<p;++v)if(Math.abs(i[f]-i[v])<Number.EPSILON){m=v;break}m!==-1?l[f]=m:(i[c].copy(i[f]),s[c].copy(s[f]),l[f]=c,++c)}this._remapIndices(l,n),this._remapVertices(i,s,c)}}},{key:"setColorVolTex",value:function(t,r,n,i){var s,o,l=this._position.length/3,c=this._position,f=this._origin,d=this._volumetricData.getDimensions(),p=d[0]-1,m=d[1]-1,v=d[2]-1,y=t.getData(),S=t.getStrideX(),_=t.getStrideY(),x=t.getStrideZ(),b,M,E,T;i!==null&&(b=n.getData(),M=n.getStrideX(),E=n.getStrideY(),T=n.getStrideZ());var R=1/this._xAxis.x,V=1/this._yAxis.y,Y=1/this._zAxis.z,$=[],W=[],j=ke.allocateTyped(Float32Array,l*3);function X(je,Je,A,D){D[0]=(1-je)*y[Je]+je*y[A],D[1]=(1-je)*y[Je+1]+je*y[A+1],D[2]=(1-je)*y[Je+2]+je*y[A+2]}function P(je,Je,A,D){var O=r[je];if(O!=null){$[O.index]=O;var te=Je*A*D*b[je];typeof W[O.index]>"u"?W[O.index]=te:W[O.index]+=te}}var N=ke.allocateTyped(Int32Array,l),I=0;for(s=0;s<l;s++){var G=s*3,ee=(c[G]-f.x)*R,re=(c[G+1]-f.y)*V,he=(c[G+2]-f.z)*Y,pe=Math.min(Math.max(ee,0),p)|0,Ie=Math.min(Math.max(re,0),m)|0,De=Math.min(Math.max(he,0),v)|0,Le=ee-pe,Oe=re-Ie,ne=he-De;if(i!=null){$=[],W=[],o=n.getDirectIdx(pe,Ie,De),P(o,1-Le,1-Oe,1-ne),P(o+M,Le,1-Oe,1-ne),P(o+E,1-Le,Oe,1-ne),P(o+M+E,Le,Oe,1-ne),P(o+T,1-Le,1-Oe,ne),P(o+M+T,Le,1-Oe,ne),P(o+E+T,1-Le,Oe,ne),P(o+M+E+T,Le,Oe,ne);var at=0,Ge=-1;for(var We in W)W[We]>at&&(Ge=We,at=W[We]);if(Ge<0||!i.includesAtom($[Ge])){N[s]=-1;continue}}N[s]=I++;var Ve=pe<p?S:0,Te=Ie<m?_:0,me=De<v?x:0,ge=[0,0,0],se=[0,0,0],we=[0,0,0],Ee=[0,0,0];o=t.getDirectIdx(pe,Ie,De),X(Le,o,o+Ve,ge),X(Le,o+Te,o+Ve+Te,se),X(Le,o+me,o+Ve+me,we),X(Le,o+Te+me,o+Ve+Te+me,Ee);var z=[0,0,0];z[0]=(1-Oe)*ge[0]+Oe*se[0],z[1]=(1-Oe)*ge[1]+Oe*se[1],z[2]=(1-Oe)*ge[2]+Oe*se[2];var F=[0,0,0];F[0]=(1-Oe)*we[0]+Oe*Ee[0],F[1]=(1-Oe)*we[1]+Oe*Ee[1],F[2]=(1-Oe)*we[2]+Oe*Ee[2],j[G]=(1-ne)*z[0]+ne*F[0],j[G+1]=(1-ne)*z[1]+ne*F[1],j[G+2]=(1-ne)*z[2]+ne*F[2]}if(this._colors=j,i!=null){for(s=0;s<l;++s){var ue=N[s];ue<0||(this._position[ue*3]=this._position[s*3],this._position[ue*3+1]=this._position[s*3+1],this._position[ue*3+2]=this._position[s*3+2],this._normals[ue*3]=this._normals[s*3],this._normals[ue*3+1]=this._normals[s*3+1],this._normals[ue*3+2]=this._normals[s*3+2],this._colors[ue*3]=this._colors[s*3],this._colors[ue*3+1]=this._colors[s*3+1],this._colors[ue*3+2]=this._colors[s*3+2])}var be=this._indices.length/3,Fe=0;for(s=0;s<be;++s){var He=N[this._indices[3*s]],rt=N[this._indices[3*s+1]],Ke=N[this._indices[3*s+2]];He>=0&&rt>=0&&Ke>=0&&(this._indices[3*Fe]=He,this._indices[3*Fe+1]=rt,this._indices[3*Fe+2]=Ke,++Fe)}this._position=new Float32Array(this._position.buffer.slice(0,I*3*4)),this._normals=new Float32Array(this._normals.buffer.slice(0,I*3*4)),this._colors=new Float32Array(this._colors.buffer.slice(0,I*3*4)),this._indices=new Uint32Array(this._indices.buffer.slice(0,Fe*3*4))}}},{key:"toMesh",value:function(){var t=new It;return t.setIndex(new mt(this._indices,1)),t.setAttribute("position",new mt(this._position,3)),t.setAttribute("normal",new mt(this._normals,3)),t.setAttribute("color",new mt(this._colors,3)),t.computeBoundingSphere(),t}}]),a}();qe(ca,"_triTable",tv.prototype.striIndicesMarchCube);qe(ca,"_arrSize",12);qe(ca,"_firstIndices",[0,1,2,3,4,5,6,7,0,1,2,3]);qe(ca,"_secondIndices",[1,2,3,0,5,6,7,4,4,5,6,7]);qe(ca,"_vertexList",PS(ca._arrSize));qe(ca,"_normalList",PS(ca._arrSize));function W5(a){var e=X5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function X5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IS=function(a){ve(t,a);var e=W5(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_build",value:function(){var n=this._opts;this.numVoxels=[128,128,128],this.xAxis=new C(1,0,0),this.yAxis=new C(0,1,0),this.zAxis=new C(0,0,1),this.origin=new C(0,0,0),this._visibilitySelector=n.visibilitySelector,this._calcSurface(n)}},{key:"_findMinMax",value:function(n){for(var i=4,s=n.length/i,o=[n[0],n[1],n[2],n[3]],l=[n[0],n[1],n[2],n[3]],c=1;c<s;++c)for(var f=c*i,d=0;d<i;++d){var p=n[f+d];o[d]=Math.max(p,o[d]),l[d]=Math.min(p,l[d])}return{maxPosRad:o,minPosRad:l}}},{key:"_findNumVoxels",value:function(n,i){var s=this.numVoxels,o=this._findMinMax(n),l=o.minPosRad,c=o.maxPosRad;l[3]>4&&(i.gridSpacing*=l[3]);var f=i.radScale*c[3]*1.7,d=f;d=.65*Math.sqrt(4/3*Math.PI*d*d*d),f=Math.max(f,d);for(var p=0;p<3;++p)l[p]-=f,c[p]+=f;for(p=0;p<3;++p)s[p]=Math.ceil((c[p]-l[p])/i.gridSpacing);this.xAxis.x=(s[0]-1)*i.gridSpacing,this.yAxis.y=(s[1]-1)*i.gridSpacing,this.zAxis.z=(s[2]-1)*i.gridSpacing;var m=pn(l,3);return this.origin.x=m[0],this.origin.y=m[1],this.origin.z=m[2],{bbox:o,dim:s}}},{key:"_makeSurface",value:function(n,i){var s=new ca;s.compute(n.volMap,this.origin,i.isoValue,1),s.vertexFusion(9,9),s._numTriangles>0?(s.setColorVolTex(n.volTexMap,n.atomMap,n.atomWeightMap,this._visibilitySelector),this.setIndex(new mt(s._indices,1)),this.setAttribute("position",new mt(s._position,3)),this.setAttribute("normal",new mt(s._normals,3)),this.setAttribute("color",new mt(s._colors,3))):this.setAttribute("position",new mt(ke.allocateTyped(Float32Array,0),3))}},{key:"_calcSurface",value:function(n){var i={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};if(i.posRad.length!==0){var s=this._findNumVoxels(i.posRad,n),o=new An(this.origin,new C(this.xAxis.x,this.yAxis.y,this.zAxis.z).add(this.origin)),l=this._computeSurface(i,o,s,n);this._makeSurface(l,n)}}}]),t}(LS);function Y5(a){var e=$5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function $5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Cp=pt.Volume,q5=function(a){ve(t,a);var e=Y5(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_computeSurface",value:function(n,i,s,o){this._shiftByOrigin(n.posRad);var l={volMap:new Cp(Float32Array,this.numVoxels,i),volTexMap:new Cp(Float32Array,this.numVoxels,i,3)};return this._visibilitySelector!=null&&(l.atomMap=[],l.atomWeightMap=new Cp(Float32Array,this.numVoxels,i)),this.gaussdensity(l,n,null,o),l}},{key:"gaussdensity",value:function(n,i,s,o){var l=i.posRad.length/4,c=i.posRad,f=i.colors,d=this.numVoxels,p=o.radScale,m=o.gaussLim,v=o.gridSpacing,y=1/o.isoValue,S=1/v,_=d[0]-1,x=d[1]-1,b=d[2]-1,M=n.volMap,E=n.volTexMap,T=M.getData(),R=M.getStrideX(),V=E.getData(),Y=E.getStrideX(),$;this._visibilitySelector!=null&&($=n.atomWeightMap.getData());for(var W=n.atomMap,j=0;j<l;++j){var X=j*4,P=c[X+3]*p,N=s===null?1:s[j],I=1/(2*P*P),G=m*P,ee=G*G;G*=S;var re=c[X]*S,he=Math.max(re-G|0,0),pe=Math.min(re+G|0,_);re=c[X+1]*S;var Ie=Math.max(re-G|0,0),De=Math.min(re+G|0,x);re=c[X+2]*S;for(var Le=Math.max(re-G|0,0),Oe=Math.min(re+G|0,b),ne=Le*v-c[X+2],at=Le;at<=Oe;++at,ne+=v)for(var Ge=Ie*v-c[X+1],We=Ie;We<=De;++We,Ge+=v){var Ve=Ge*Ge+ne*ne;if(!(Ve>=ee))for(var Te=M.getDirectIdx(he,We,at),me=E.getDirectIdx(he,We,at),ge=he*v-c[X],se=he;se<=pe;++se,ge+=v,Te+=R,me+=Y){var we=ge*ge+Ve,Ee=-we*I,z=Math.exp(Ee)*N;this._visibilitySelector!=null&&z>$[Te]&&($[Te]=z,W[Te]=i.atoms[j]),T[Te]+=z,z*=y;var F=j*3;V[me]+=z*f[F],V[me+1]+=z*f[F+1],V[me+2]+=z*f[F+2]}}}}},{key:"_shiftByOrigin",value:function(n){for(var i=this.origin.x,s=this.origin.y,o=this.origin.z,l=4,c=n.length/l,f=0;f<c;++f){var d=f*l;n[d]-=i,n[d+1]-=s,n[d+2]-=o}}}]),t}(IS);function Z5(a,e,t,r){var n=4,i=a.length/n,s=e[0],o=e[1],l=e[2],c=t[0],f=t[1],d=t[2];function p(I,G){return Math.floor((I-G)/r)}var m=p(c,s)+1,v=p(f,o)+1,y=p(d,l)+1,S=m*v*y,_=v*y,x=function(G,ee,re){return(p(G,s)*v+p(ee,o))*y+p(re,l)},b=[],M,E;for(M=0;M<i;M++){var T=n*M;E=x(a[T],a[T+1],a[T+2]),b[E]===void 0?b[E]=[M]:b[E].push(M)}var R=ke.allocateTyped(Uint32Array,S),V=ke.allocateTyped(Uint16Array,S),Y=ke.allocateTyped(Uint32Array,i),$=0,W=0,j;for(M=0;M<S;M++){var X=R[M]=$,P=b[M];if(P!==void 0)for(j=0;j<P.length;j++)Y[$]=P[j],$++;var N=$-X;V[M]=N,N>W&&(W=N)}this.neighbourListLength=27*W+1,this.withinRadii=function(I,G,ee,re,he){var pe=0,Ie=p(I,s),De=p(G,o),Le=p(ee,l),Oe=Math.max(0,Ie-1),ne=Math.max(0,De-1),at=Math.max(0,Le-1),Ge=Math.min(m-1,Ie+1),We=Math.min(v-1,De+1),Ve=Math.min(y-1,Le+1);for(M=Oe;M<=Ge;++M){var Te=M*_;for(j=ne;j<=We;++j)for(var me=j*y,ge=at;ge<=Ve;++ge){E=Te+me+ge;for(var se=R[E],we=se+V[E],Ee=se;Ee<we;Ee++){var z=Y[Ee],F=n*z,ue=a[F]-I,be=a[F+1]-G,Fe=a[F+2]-ee,He=a[F+3]+re;ue*ue+be*be+Fe*Fe<=He*He&&(he[pe++]=Y[Ee])}}}he[pe]=-1}}function j5(a,e,t,r){var n=4,i=a.posRad,s=a.colors,o=a.atoms,l=i.length/n,c=e.bbox,f=c.minPosRad,d=c.maxPosRad,p,m,v,y,S,_=-1,x,b,M,E,T=null,R=null,V=null,Y,$,W,j,X,P,N,I=new C(0,0,0),G=new C(0,0,0),ee=new C(0,0,0),re;function he(se,we,Ee){for(var z=ke.allocateTyped(se,we),F=0;F<we;++F)z[F]=Ee;return z}function pe(se,we,Ee){for(var z=0;z<se.length;z++)se[z]=we+Ee*z}function Ie(){y=t.scaleFactor,x=e.dim,re=Math.min(5,2+Math.floor(v*y));var se=x[0]*x[1]*x[2];b=he(Float32Array,se,-1001),M=ke.allocateTyped(Float32Array,se*3),E=ke.allocateTyped(Float32Array,se),V&&(T=ke.allocateTyped(Float32Array,se),R=[]),Y=ke.allocateTyped(Float32Array,x[0]),$=ke.allocateTyped(Float32Array,x[1]),W=ke.allocateTyped(Float32Array,x[2]),pe(Y,f[0],1/y),pe($,f[1],1/y),pe(W,f[2],1/y)}function De(){var se=0,we=2*Math.PI/S;X=ke.allocateTyped(Float32Array,S),j=ke.allocateTyped(Float32Array,S);for(var Ee=0;Ee<S;Ee++)X[Ee]=Math.cos(se),j[Ee]=Math.sin(se),se+=we}function Le(){P=new Z5(i,f,d,2.01*m),N=new Int32Array(P.neighbourListLength)}function Oe(){v=t.probeRadius,y=t.scaleFactor,S=t.probePositions,V=t.visibilitySelector,p=ke.allocateTyped(Float32Array,l),m=0;for(var se=0;se<l;++se){var we=i[se*n+3]+=v;we>m&&(m=we),p[se]=we*we}Ie(),De(),Le(),_=-1}function ne(se,we,Ee,z){var F=n*se,ue=p[se],be=i[F]-we,Fe=i[F+1]-Ee,He=i[F+2]-z,rt=be*be+Fe*Fe+He*He;return rt<ue}function at(se,we,Ee,z,F){var ue;if(_!==-1){if(ue=_,ue!==z&&ue!==F&&ne(ue,se,we,Ee))return ue;_=-1}var be=0;for(ue=N[be];ue>=0;){if(ue!==z&&ue!==F&&ne(ue,se,we,Ee))return _=ue,ue;ue=N[++be]}return _=-1,-1}function Ge(){for(var se=4,we=se/3,Ee=1/(2*we*we),z=0;z<l;z++){var F=n*z,ue=i[F],be=i[F+1],Fe=i[F+2],He=i[F+3],rt=p[z];P.withinRadii(ue,be,Fe,He,N);for(var Ke=Math.ceil(He*y),je=Math.floor(y*(ue-f[0])),Je=Math.floor(y*(be-f[1])),A=Math.floor(y*(Fe-f[2])),D=Math.max(0,je-Ke),O=Math.max(0,Je-Ke),te=Math.max(0,A-Ke),q=Math.min(x[0],je+Ke+2),Ae=Math.min(x[1],Je+Ke+2),Re=Math.min(x[2],A+Ke+2),$e=z*3,et=s[$e],Ze=s[$e+1],yt=s[$e+2],Xt=te;Xt<Re;Xt++)for(var en=W[Xt]-Fe,Lt=x[1]*x[0]*Xt,Qe=O;Qe<Ae;Qe++)for(var ct=$[Qe]-be,ie=en*en+ct*ct,Mt=Lt+x[0]*Qe,le=D;le<q;le++){var Ot=le+Mt,Se=Y[le]-ue,Yt=ie+Se*Se;if(Yt<rt){var rn=Math.exp(-Yt*Ee),mr=Ot*3;M[mr]+=et*rn,M[mr+1]+=Ze*rn,M[mr+2]+=yt*rn,E[Ot]+=rn,V!==null&&rn>T[Ot]&&(T[Ot]=rn,R[Ot]=o[z]),b[Ot]<0&&(b[Ot]=-b[Ot]);var Zn=Math.sqrt(Yt),Vn=He/Zn,U=Se*Vn,de=ct*Vn,ce=en*Vn;if(U+=ue,de+=be,ce+=Fe,at(U,de,ce,z,-1)===-1){var _e=He-Zn;_e<b[Ot]&&(b[Ot]=_e)}}}}}function We(se,we){return se.x=se.y=se.z=1,we.x!==0?se.x=(we.y+we.z)/-we.x:we.y!==0?se.y=(we.x+we.z)/-we.y:we.z!==0&&(se.z=(we.x+we.y)/-we.z),se}function Ve(se,we){var Ee=n*se,z=n*we,F=i[Ee],ue=i[Ee+1],be=i[Ee+2],Fe=i[Ee+3],He=I.x=i[z]-F,rt=I.y=i[z+1]-ue,Ke=I.z=i[z+2]-be,je=i[z+3],Je=He*He+rt*rt+Ke*Ke,A=Math.sqrt(Je),D=(Fe*Fe+A*A-je*je)/(2*Fe*A),O=Fe*D;I.normalize(),We(G,I),G.normalize(),ee.crossVectors(I,G),ee.normalize();var te=Math.sqrt(Fe*Fe-O*O);G.multiplyScalar(te),ee.multiplyScalar(te),I.multiplyScalar(O),I.x+=F,I.y+=ue,I.z+=be,_=-1;for(var q=re,Ae=0;Ae<S;Ae++){var Re=X[Ae],$e=j[Ae],et=I.x+Re*G.x+$e*ee.x,Ze=I.y+Re*G.y+$e*ee.y,yt=I.z+Re*G.z+$e*ee.z;if(at(et,Ze,yt,se,we)===-1)for(var Xt=Math.floor(y*(et-f[0])),en=Math.floor(y*(Ze-f[1])),Lt=Math.floor(y*(yt-f[2])),Qe=Math.max(0,Xt-q),ct=Math.max(0,en-q),ie=Math.max(0,Lt-q),Mt=Math.min(x[0],Xt+q+2),le=Math.min(x[1],en+q+2),Ot=Math.min(x[2],Lt+q+2),Se=ie;Se<Ot;Se++){Ke=yt-W[Se];for(var Yt=x[1]*x[0]*Se,rn=ct;rn<le;rn++){rt=Ze-$[rn];for(var mr=Ke*Ke+rt*rt,Zn=Yt+x[0]*rn,Vn=Qe;Vn<Mt;Vn++){He=et-Y[Vn],Je=mr+He*He;var U=Vn+Zn,de=b[U];de>0&&Je<de*de&&(b[U]=Math.sqrt(Je))}}}}}function Te(){for(var se=0;se<l;se++){var we=n*se;P.withinRadii(i[we],i[we+1],i[we+2],i[we+3],N);for(var Ee=0,z=N[Ee];z>=0;)se<z&&Ve(se,z),z=N[++Ee]}}function me(){for(var se=0,we=b.length;se<we;se++){b[se]<0&&(b[se]=0);var Ee=E[se];if(Ee>0){Ee=1/Ee;var z=se*3;M[z]*=Ee,M[z+1]*=Ee,M[z+2]*=Ee}}}function ge(){console.time("ContactSurface.getVolume"),console.time("ContactSurface.init"),Oe(),console.timeEnd("ContactSurface.init"),console.time("ContactSurface.projectPoints"),Ge(),console.timeEnd("ContactSurface.projectPoints"),console.time("ContactSurface.projectTorii"),Te(),console.timeEnd("ContactSurface.projectTorii"),me(),console.timeEnd("ContactSurface.getVolume")}this.build=function(){ge(),this.volTexMap=M,this.weightsMap=T,this.atomMap=R,this.volMap=b}}function K5(a){var e=J5();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function J5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ap=pt.Volume,Q5=function(a){ve(t,a);var e=K5(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_computeSurface",value:function(n,i,s,o){var l=new j5(n,s,o);l.build();var c={volMap:new Ap(Float32Array,this.numVoxels,i,1,l.volMap),volTexMap:new Ap(Float32Array,this.numVoxels,i,3,l.volTexMap),atomMap:l.atomMap,atomWeightMap:new Ap(Float32Array,this.numVoxels,i,1,l.weightsMap)};return c}}]),t}(IS),eF=J(function a(e,t){K(this,a),this.coord=new C,this.coord.copy(e),this.radius=t,this.colorX=.99999,this.colorY=0,this.colorZ=0,this.atomType=0,this.srcAtom=null}),tF=function(){function a(e,t,r,n,i){K(this,a),this._numAtoms=e,this._atoms=t,this._vBoxMin=new C,this._vBoxMax=new C,this._vBoxMin.copy(r),this._vBoxMax.copy(n),this._probeRadius=i,this._atomsList=null,this._voxelList=null}return J(a,[{key:"createVoxels",value:function(){var t,r,n=4.5,i=this._numAtoms|0,s=this._atoms,o=this._vBoxMax.x-this._vBoxMin.x,l=this._vBoxMax.y-this._vBoxMin.y,c=this._vBoxMax.z-this._vBoxMin.z,f=o<l?o:l;f=c<f?c:f;var d=0,p=0,m;for(m=0;m<i;m++)r=(s[m].radius+this._probeRadius)*2,d=r>d?r:d,p+=r;var v=Math.floor(f/d);v<2&&(v=2),p/=i,this._numCells=v,this._aveRad=p,this._maxRad=d;var y=v,S=v*v,_=v*v*v,x=this._xScale=1/(this._vBoxMax.x-this._vBoxMin.x),b=this._yScale=1/(this._vBoxMax.y-this._vBoxMin.y),M=this._zScale=1/(this._vBoxMax.z-this._vBoxMin.z),E=0,T=x*v,R=b*v,V=M*v;for(m=0;m<i;m++){var Y=(s[m].radius+this._probeRadius)*n,$=Y*2,W=Math.floor(T*$+.8),j=Math.floor(R*$+.8),X=Math.floor(V*$+.8);W++,j++,X++,E+=W*j*X}this._voxelList=ke.allocateTyped(Int32Array,_);var P=[];if(P.length=E,this._voxelList===null||P===null)return-1;for(m=0;m<_;m++)this._voxelList[m]=-1;for(t=0,m=0;m<i;m++){r=(s[m].radius+this._probeRadius)*n;var N=Math.floor((s[m].coord.x-this._vBoxMin.x-r)*v*x),I=Math.floor((s[m].coord.y-this._vBoxMin.y-r)*v*b),G=Math.floor((s[m].coord.z-this._vBoxMin.z-r)*v*M),ee=Math.floor((s[m].coord.x-this._vBoxMin.x+r)*v*x),re=Math.floor((s[m].coord.y-this._vBoxMin.y+r)*v*b),he=Math.floor((s[m].coord.z-this._vBoxMin.z+r)*v*M);N=N>=0?N:0,I=I>=0?I:0,G=G>=0?G:0,ee=ee<v?ee:v-1,re=re<v?re:v-1,he=he<v?he:v-1;for(var pe=G;pe<=he;pe++)for(var Ie=I;Ie<=re;Ie++)for(var De=N;De<=ee;De++){var Le=De+Ie*y+pe*S;if(this._voxelList[Le]<0){P[t*2+0]=m,P[t*2+1]=-1,this._voxelList[Le]=t,t++;continue}var Oe=this._voxelList[Le];this._voxelList[Le]=t,P[t*2+0]=m,P[t*2+1]=Oe,t++}}return this._atomsList=Int32Array.from(P),0}},{key:"destroyVoxels",value:function(){this._atomsList=null,this._voxelList=null,this._atoms=null,this._vertices=null,this._vBoxMin=null,this._vBoxMax=null}},{key:"forEachRelatedAtom",value:function(t,r){for(var n=Math.floor((t.x-this._vBoxMin.x)*this._numCells*this._xScale),i=Math.floor((t.y-this._vBoxMin.y)*this._numCells*this._yScale),s=Math.floor((t.z-this._vBoxMin.z)*this._numCells*this._zScale),o=n+i*this._numCells+s*this._numCells*this._numCells,l=this._atoms,c=this._voxelList[o];c>=0;c=this._atomsList[c*2+1]){var f=this._atomsList[c*2];r(l[f])}}},{key:"getClosestAtom",value:function(t){var r=null,n=Number.MAX_VALUE;return this.forEachRelatedAtom(t,function(i){var s=t.distanceToSquared(i.coord);s<n&&(n=s,r=i)}),r}},{key:"buildNormals",value:function(t,r,n){for(var i=this,s=0,o=0,l=0,c=0,f,d=0,p=0,m=0,v=0,y=0,S=2.5,_=.1,x=this._aveRad*S,b=x*x,M=-this._aveRad*_,E=function(V){var Y=o-V.coord.x,$=l-V.coord.y,W=c-V.coord.z;if(f=Y*Y+$*$+W*W,!(f>b)){var j=V.radius+i._probeRadius;v=f-j*j,v<0&&(v=-v),y=Math.exp(M*v),d+=Y*y,p+=$*y,m+=W*y,s++}},T=0;T<t;T++)o=r[T].x,l=r[T].y,c=r[T].z,s=0,d=p=m=0,this.forEachRelatedAtom(r[T],E),f=d*d+p*p+m*m,s>0&&(v=1/Math.sqrt(f),d*=v,p*=v,m*=v),n[T].x=d,n[T].y=p,n[T].z=m;return 0}},{key:"buildColors",value:function(t,r,n,i){for(var s=this,o=0,l=0,c=0,f=0,d=0,p=.8,m=i,v=m*m,y=[],S=[],_=0,x=function(R){var V=o-R.coord.x,Y=l-R.coord.y,$=c-R.coord.z,W=V*V+Y*Y+$*$;if(!(W>v)){var j=R.radius+s._probeRadius;f=W-j*j,f<0&&(f=-f),d=1/(p+f),y.push([R.colorX,R.colorY,R.colorZ]),S.push(d),_+=d}},b=0;b<t;b++){o=r[b].x,l=r[b].y,c=r[b].z,y=[],S=[],_=0,this.forEachRelatedAtom(r[b],x);for(var M=0;M<y.length;++M){var E=S[M]/_;n[b].x+=y[M][0]*E,n[b].y+=y[M][1]*E,n[b].z+=y[M][2]*E}}return 0}}]),a}(),s1=function(){function a(e,t,r){K(this,a),this._maxNumVertices=e,this._maxNumTriangles=t,this._vertices=new Array(e),this._normals=new Array(e),this._colors=null,r&&(this._colors=new Array(e)),this._indices=new Array(t*3),this._numVertices=0,this._numTriangles=0;var n;for(n=0;n<e;n++)this._vertices[n]=new C,this._normals[n]=new C;for(n=0;n<t*3;n++)this._indices[n]=-1;if(r)for(n=0;n<e;n++)this._colors[n]=new C}return J(a,[{key:"destroy",value:function(){this._vertices=null,this._normals=null,this._indices=null}}]),a}();function nF(a){var e=rF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function rF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iF=3,Tp=32768,aF=pt.Element,sF=function(a){ve(t,a);var e=nF(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_build",value:function(){this._innerBuild();var n=this.getGeo();this.destroy(),this._fromGeo(n)}},{key:"_fromGeo",value:function(n){var i=null,s=ke.allocateTyped(Float32Array,3*n._numVertices),o=ke.allocateTyped(Float32Array,3*n._numVertices);n._colors!==null&&(i=ke.allocateTyped(Float32Array,3*n._numVertices));for(var l=ke.allocateTyped(Uint32Array,3*n._numTriangles),c=0,f=0;c<n._numVertices;c++)s[f+0]=n._vertices[c].x,s[f+1]=n._vertices[c].y,s[f+2]=n._vertices[c].z,o[f+0]=n._normals[c].x,o[f+1]=n._normals[c].y,o[f+2]=n._normals[c].z,f+=3;if(i!==null)for(var d=0,p=0;d<n._numVertices;d++,p+=3)i[p+0]=n._colors[d].x,i[p+1]=n._colors[d].y,i[p+2]=n._colors[d].z;for(var m=n._numTriangles*3,v=0;v<m;v++)l[v]=n._indices[v];this.setIndex(new mt(l,1)),this.setAttribute("position",new mt(s,3)),this.setAttribute("normal",new mt(o,3)),this.setAttribute("color",new mt(i,3)),this.computeBoundingBox(),this.computeBoundingSphere(),n.destroy()}},{key:"convertToAtomsColored",value:function(n,i){for(var s=n.atoms,o=n.colors,l=0,c=s.length;l<c;l++){var f=s[l].position,d=s[l].element.radius;i[l]=new eF(f,d);var p=s[l].element.number;i[l].atomType=this.getType(p);var m=iF*l;i[l].colorX=o[m++],i[l].colorY=o[m++],i[l].colorZ=o[m],i[l].srcAtom=s[l]}}},{key:"getGeo",value:function(){return this.geoOut}},{key:"destroy",value:function(){this.atoms=null,this.hashLines=null,this.hashEntries=null}},{key:"getBoundingBox",value:function(n,i,s){var o=1e7;i.x=i.y=i.z=o,s.x=s.y=s.z=0-o;for(var l=this.probeRadius*this.atomRadiusScale,c=0,f=0,d=n.length;f<d;f++){var p=n[f].coord,m=n[f].radius+l;c=m>c?m:c,p.x-m<i.x&&(i.x=p.x-m),p.y-m<i.y&&(i.y=p.y-m),p.z-m<i.z&&(i.z=p.z-m),p.x+m>s.x&&(s.x=p.x+m),p.y+m>s.y&&(s.y=p.y+m),p.z+m>s.z&&(s.z=p.z+m)}i.x-=c,i.y-=c,i.z-=c,s.x+=c,s.y+=c,s.z+=c}},{key:"getCornerCoord",value:function(n,i,s,o,l,c,f){var d=1/(c-1),p=s*d,m=o*d,v=l*d;f.x=n.x*(1-p)+i.x*p,f.y=n.y*(1-m)+i.y*m,f.z=n.z*(1-v)+i.z*v}},{key:"buildEdgePoint",value:function(n,i,s,o,l,c){if(s[n]^s[i]){var f=24,d=0-o.pointsValuesLinear[l+f+n],p=o.pointsValuesLinear[l+f+i],m=o.pointsValuesLinear[l+f+n],v=d/(p-m),y=o.pointsValuesLinear[l+n*3+0],S=o.pointsValuesLinear[l+n*3+1],_=o.pointsValuesLinear[l+n*3+2],x=o.pointsValuesLinear[l+i*3+0],b=o.pointsValuesLinear[l+i*3+1],M=o.pointsValuesLinear[l+i*3+2];c.x=y*(1-v)+x*v,c.y=S*(1-v)+b*v,c.z=_*(1-v)+M*v}}},{key:"isTriangleVisible",value:function(n,i,s){var o=this.voxelWorld.getClosestAtom(n),l=this.voxelWorld.getClosestAtom(i),c=this.voxelWorld.getClosestAtom(s);return o===null||l===null||c===null||o.srcAtom===null||l.srcAtom===null||c.srcAtom===null?!1:this.visibilitySelector.includesAtom(o.srcAtom)&&this.visibilitySelector.includesAtom(l.srcAtom)&&this.visibilitySelector.includesAtom(c.srcAtom)}},{key:"addTriangle",value:function(n,i,s){if(this.visibilitySelector&&!this.isTriangleVisible(n,i,s))return!0;var o=this.geoOut;if(o._numTriangles>=this.maxNumTriangles)return!1;var l=this.addVertexToGeo(o,n),c=this.addVertexToGeo(o,i),f=this.addVertexToGeo(o,s);if((l|c|f)<0)return!1;var d=3*o._numTriangles;return o._indices[d+0]=l,o._indices[d+1]=c,o._indices[d+2]=f,o._numTriangles++,!0}},{key:"buildGeoFromCorners",value:function(n,i,s,o,l,c){for(var f=12,d=8,p=n-1,m=n,v=n*n,y=new Array(f),S=0;S<f;S++)y[S]=new C;for(var _=[],x=0;x<d;x++)_[x]=1;for(var b=new C,M=0,E=0,T=0;T<p;T++,E+=v)for(var R=0,V=0;V<p;V++,R+=m)for(var Y=0;Y<p;Y++){if(!c.hasIntersection[M]){M++;continue}var $=c.bitsInside[M];this.getCornerCoord(i,s,Y,T,V,n,b);for(var W=M*32,j=0,X=0;j<d;j++)c.pointsValuesLinear[W+X++]=b.x,c.pointsValuesLinear[W+X++]=b.y,c.pointsValuesLinear[W+X++]=b.z;c.pointsValuesLinear[W+3]+=l.x,c.pointsValuesLinear[W+2*3]+=l.x,c.pointsValuesLinear[W+5*3]+=l.x,c.pointsValuesLinear[W+6*3]+=l.x,c.pointsValuesLinear[W+2*3+2]+=l.z,c.pointsValuesLinear[W+3*3+2]+=l.z,c.pointsValuesLinear[W+6*3+2]+=l.z,c.pointsValuesLinear[W+7*3+2]+=l.z,c.pointsValuesLinear[W+4*3+1]+=l.y,c.pointsValuesLinear[W+5*3+1]+=l.y,c.pointsValuesLinear[W+6*3+1]+=l.y,c.pointsValuesLinear[W+7*3+1]+=l.y;for(var P=W+24,N=0;N<d;++N)_[N]=c.pointsValuesLinear[P+N]<0?1:0;this.buildEdgePoint(0,1,_,c,W,y[0]),this.buildEdgePoint(1,2,_,c,W,y[1]),this.buildEdgePoint(2,3,_,c,W,y[2]),this.buildEdgePoint(3,0,_,c,W,y[3]),this.buildEdgePoint(4,5,_,c,W,y[4]),this.buildEdgePoint(5,6,_,c,W,y[5]),this.buildEdgePoint(6,7,_,c,W,y[6]),this.buildEdgePoint(7,4,_,c,W,y[7]),this.buildEdgePoint(0,4,_,c,W,y[8]),this.buildEdgePoint(1,5,_,c,W,y[9]),this.buildEdgePoint(2,6,_,c,W,y[10]),this.buildEdgePoint(3,7,_,c,W,y[11]);for(var I=$*16,G=0,ee=0;G<6;G++,ee+=3){var re=c.striIndicesMarchCube[I+ee];if(re<0)break;var he=c.striIndicesMarchCube[I+ee+1],pe=c.striIndicesMarchCube[I+ee+2];if(!this.addTriangle(y[re],y[he],y[pe]))return-2}M++}return 0}},{key:"getNumIntersectedCells",value:function(n,i,s,o){for(var l=n*n,c=8,f=0,d=0,p=0,m=0;m<i;m++,p+=l)for(var v=0,y=0;y<i;y++,v+=n)for(var S=0;S<i;S++){var _=d*32+24,x=S+v+p;o.pointsValuesLinear[_]=s[x],o.pointsValuesLinear[_+1]=s[x+1],o.pointsValuesLinear[_+2]=s[x+n+1],o.pointsValuesLinear[_+3]=s[x+n],o.pointsValuesLinear[_+4]=s[l+x],o.pointsValuesLinear[_+5]=s[l+x+1],o.pointsValuesLinear[_+6]=s[l+x+n+1],o.pointsValuesLinear[_+7]=s[l+x+n];for(var b=0,M=0;M<c;++M)o.pointsValuesLinear[_+M]<0&&(b|=1<<M);b===0||b===(1<<c)-1?o.hasIntersection[d]=!1:(o.hasIntersection[d]=!0,f++),o.bitsInside[d]=b,d++}return f}},{key:"getType",value:function(n){var i=[0,0,1,1,2,6,3,6,4,6,5,6,6,0,7,3,8,2,9,6,10,6,11,6,12,6,13,6,14,6,15,4,16,5,17,6,18,6,19,6,20,6,21,6,22,6,23,6,24,6,25,6,26,6,27,6,28,6,29,6,30,6,31,6,32,6,33,6,34,6,35,6,36,6,37,6,38,6,39,6,40,6,41,6,42,6,43,6,44,6,45,6,46,6,47,6,48,6,49,6,50,6,51,6,52,6,53,6,54,6,55,6,56,6,57,6,58,6,59,6,60,6,61,6,62,6,63,6,64,6,65,6,66,6,67,6,68,6,69,6,70,6,71,6,72,6,73,6,74,6,75,6,76,6,77,6,78,6,79,6,80,6,81,6,82,6,83,6,84,6,85,6,86,6,87,6,88,6,89,6,90,6,91,6,92,6,93,6,94,6,95,6,96,6,97,6,98,6,99,6,100,6,101,6,102,6,103,6,104,6,105,6,106,6,107,6,108,6,109,6];if(n<1||n>i.length/2||Object.keys(aF.ByAtomicNumber).length*2!==i.length)throw new Error("atomT.length  should be equal Element.ByAtomicNumber.length * 2");return i[n*2]}},{key:"calculateGridCorners",value:function(n,i,s,o,l,c){for(var f=i*i,d=f*i,p=new C,m=new C,v=1e12,y=0;y<d;y++)n[y]=v;for(var S=(i-1)/(o.x-s.x),_=(i-1)/(o.y-s.y),x=(i-1)/(o.z-s.z),b=0,M=l.length;b<M;b++){var E=l[b],T=E.radius+c,R=(E.coord.x-T-s.x)*S,V=(E.coord.y-T-s.y)*_,Y=(E.coord.z-T-s.z)*x,$=Math.floor(R),W=Math.floor(V),j=Math.floor(Y),X=Math.floor((E.coord.x+T-s.x)*S),P=Math.floor((E.coord.y+T-s.y)*_),N=Math.floor((E.coord.z+T-s.z)*x);X++,P++,N++,X=X<=i-1?X:i-1,P=P<=i-1?P:i-1,N=N<=i-1?N:i-1;for(var I=W;I<=P;I++)for(var G=I*f,ee=j;ee<=N;ee++)for(var re=ee*i,he=$;he<=X;he++){var pe=G+re+he;this.getCornerCoord(s,o,he,I,ee,i,p),m.x=p.x-E.coord.x,m.y=p.y-E.coord.y,m.z=p.z-E.coord.z;var Ie=Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z),De=Ie-T;De<n[pe]&&(n[pe]=De)}}}},{key:"createVertexHash",value:function(n,i){if(this.hashLines=ke.allocateTyped(Int32Array,Tp*2),this.hashLines===null)return-1;for(var s=0,o=0;s<Tp;s++)this.hashLines[o++]=0,this.hashLines[o++]=-1;if(this.maxNumVertices=n,this.maxNumTriangles=i,this.numHashEtriesAllocated=n,this.hashEntries=ke.allocateTyped(Int32Array,2*this.numHashEtriesAllocated),this.hashEntries===null)return-1;for(var l=0,c=0;l<this.numHashEtriesAllocated;l++)this.hashEntries[c++]=-1,this.hashEntries[c++]=-1;return this.numHashEntryIndex=0,0}},{key:"getNewHashEntry",value:function(){if(this.numHashEntryIndex<this.numHashEtriesAllocated){var n=this.numHashEntryIndex;return this.numHashEntryIndex++,n}return-1}},{key:"addVertexToGeo",value:function(n,i){var s,o=.01,l=815851,c=37633,f=2453543,d=1e-6,p=this.marCubeResoultion<<2,m=new C,v=Math.floor(p*(i.x-this.vBoxMin.x)/(this.vBoxMax.x+o-this.vBoxMin.x)),y=Math.floor(p*(i.y-this.vBoxMin.y)/(this.vBoxMax.y+o-this.vBoxMin.y)),S=Math.floor(p*(i.z-this.vBoxMin.z)/(this.vBoxMax.z+o-this.vBoxMin.z)),_=v*l+S*c+y*f;_&=Tp-1;var x=_+_;if(this.vBoxMin!==null&&this.vBoxMax!==null)for(s=this.hashLines[x+1];s>=0;s=this.hashEntries[s*2+1]){var b=this.hashEntries[s*2+0];m.copy(n._vertices[b]),m.x-=i.x,m.y-=i.y,m.z-=i.z;var M=m.x*m.x+m.y*m.y+m.z*m.z;if(M<d)return b}if(n._numVertices>=this.maxNumVertices)return-1;var E=n._numVertices;if(n._vertices[E].copy(i),this.vBoxMin!==null&&this.vBoxMax!==null){if(s=this.getNewHashEntry(),s<0)return-1;var T=this.hashLines[x+1];this.hashLines[x+1]=s,this.hashEntries[s*2+0]=E,this.hashEntries[s*2+1]=T,this.hashLines[x+0]++}return n._numVertices++,E}},{key:"modifyExcludedFromGeo",value:function(n,i,s,o,l,c){var f,d,p,m=1.1;function v(){p>0&&c[f]<0&&(c[f]=p),p>c[f]&&(c[f]=p)}for(var y=n*n,S=(n-1)/(o.x-s.x),_=(n-1)/(o.y-s.y),x=(n-1)/(o.z-s.z),b=i*2*(i*2),M=1/(n-1),E=0;E<l._numVertices;E++){var T=l._vertices[E],R=i*m,V=Math.floor((T.x-R-s.x)*S),Y=Math.floor((T.y-R-s.y)*_),$=Math.floor((T.z-R-s.z)*x),W=Math.floor((T.x+R-s.x)*S),j=Math.floor((T.y+R-s.y)*_),X=Math.floor((T.z+R-s.z)*x);V=V>=0?V:0,Y=Y>=0?Y:0,$=$>=0?$:0,W=W<=n-1?W:n-1,j=j<=n-1?j:n-1,X=X<=n-1?X:n-1;for(var P=Y;P<=j;P++)for(var N=P*y,I=$;I<=X;I++)for(var G=I*n,ee=V;ee<=W;ee++){f=N+G+ee;var re=ee*M,he=s.x*(1-re)+o.x*re;re=P*M;var pe=s.y*(1-re)+o.y*re;re=I*M;var Ie=s.z*(1-re)+o.z*re,De=he-T.x,Le=pe-T.y,Oe=Ie-T.z,ne=De*De+Le*Le+Oe*Oe;ne<b&&(d=Math.sqrt(ne),p=-(d-i),v())}}return 0}},{key:"_innerBuild",value:function(){var n,i=1.2,s={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};this.complex=this._opts.parent,this.atoms=s.atoms,this.meshResolution=this._opts.gridSpacing,this.atomRadiusScale=this._opts.radScale,this.colorMode=this._opts.colorMode,this.probeRadius=this._opts.probeRadius,this.useVertexColors=!0,this.excludeProbe=this._opts.excludeProbe,this.visibilitySelector=this._opts.visibilitySelector,this.geoOut=null,this.hashLines=null,this.hashEntries=null,this.numHashEtriesAllocated=0,this.numHashEntryIndex=0,this.maxNumVertices=0,this.maxNumTriangles=0;var o=new Array(this.atoms.length);this.convertToAtomsColored(s,o);var l=this.vBoxMin=new C,c=this.vBoxMax=new C;this.getBoundingBox(o,l,c);var f=this.marCubeResoultion=this.meshResolution*4,d=f,p=d*d,m=p*d,v=ke.allocateTyped(Float32Array,m),y=this.probeRadius*this.atomRadiusScale;this.calculateGridCorners(v,d,l,c,o,y);var S=f-1,_=new tv;if(n=_.create(S),n<0)return n;var x=new C;x.x=(c.x-l.x)/S,x.y=(c.y-l.y)/S,x.z=(c.z-l.z)/S;var b=this.getNumIntersectedCells(d,S,v,_),M=Math.floor(b*i),E=Math.floor(b*i*2);if(this.geoOut=new s1(M,E,this.useVertexColors),n=this.createVertexHash(M,E),n<0)return n;var T=y;if(this.excludeProbe&&(T=.01),this.voxelWorld=new tF(o.length,o,l,c,T),this.voxelWorld.createVoxels(),n=this.buildGeoFromCorners(f,l,c,v,x,_),this.excludeProbe){if(this.modifyExcludedFromGeo(d,y,l,c,this.geoOut,v),this.geoOut._vertices=null,this.geoOut._colors=null,this.geoOut._indices=null,this.geoOut._normals=null,this.geoOut._numVertices=0,this.geoOut._numTriangles=0,this.geoOut=null,b=this.getNumIntersectedCells(d,S,v,_),M=Math.floor(b*i),E=Math.floor(b*i*2),this.geoOut=new s1(M,E,this.useVertexColors),n=this.createVertexHash(M,E),n<0)return n;n=this.buildGeoFromCorners(d,l,c,v,x,_)}this.voxelWorld.buildNormals(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._normals);var R=6.5;return this.excludeProbe&&(R-=1.5),this.useVertexColors&&this.voxelWorld.buildColors(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._colors,R),this.voxelWorld.destroyVoxels(),this.voxelWorld=null,_.destroy(),n}}]),t}(LS);function oF(a){var e=lF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function lF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function cF(a,e){var t=document.createElement("div");if(t.className=e,typeof a=="string"){var r=document.createElement("span");r.style.fontSize="150%";for(var n=a.split(`
`),i=0,s=n.length;i<s;++i){var o=document.createElement("span"),l=document.createTextNode(n[i]);o.appendChild(l),r.appendChild(o),i<s-1&&r.appendChild(document.createElement("br"))}t.appendChild(r)}else t.appendChild(a);return t.worldPos=new C,t}var uF=function(a){ve(t,a);var e=oF(t);function t(r,n){var i;K(this,t),i=e.call(this),i._opts=n,i.items=[],i.needsUpdate=!1;var s=-50,o=-50;switch(n.horizontalAlign){case"left":s=0;break;case"right":s=-100;break}switch(n.verticalAlign){case"top":o=-100;break;case"bottom":o=0;break}var l=new C(n.dx||0,n.dy||0,n.dz||0);return i.userData={translation:"translate(".concat(s,"%, ").concat(o,"%)"),offset:l},i}return J(t,[{key:"setItem",value:function(n,i,s){var o=this._opts,l=this.items[n]||cF(s,"label");l.worldPos.copy(i),l.style.textAlign=o.horizontalAlign,l.style.verticalAlign=o.verticalAlign,this.items[n]=l}},{key:"setColor",value:function(n,i,s){var o=this.items[n];o.opts={color:i,background:s}}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.needsUpdate=!0,this.dispatchEvent({type:"update"})}},{key:"finalize",value:function(){this.finishUpdate()}},{key:"raycast",value:function(){}},{key:"setOpacity",value:function(){}},{key:"getSubset",value:function(){return[]}}]),t}(pr),Ri={InstancedSpheresGeometry:ES,SimpleSpheresGeometry:i5,Simple2CCylindersGeometry:ev,Instanced2CCylindersGeometry:CS,ExtrudedObjectsGeometry:x5,ChunkedLinesGeometry:RS,TwoColorLinesGeometry:O5,CrossGeometry:B5,QuickSurfGeometry:q5,ContactSurfaceGeometry:Q5,SSIsosurfaceGeometry:sF,LabelsGeometry:uF},fF=`float INSTANCED_SPRITE_OVERSCALE = 1.3;\r
\r
attribute vec3 normal;\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  varying vec3 viewNormal;\r
#endif\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  varying vec3 vNormal;\r
#endif\r
\r
#ifdef THICK_LINE\r
  attribute vec4 position; // W contains vert pos or neg offset\r
#else\r
  attribute vec3 position;\r
#endif\r
\r
varying vec3 vWorldPosition;\r
varying vec3 vViewPosition;\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  attribute float alphaColor;\r
  varying float alphaCol;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\r
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r
		varying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  attribute vec3 color;\r
  varying vec3 vColor;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  attribute vec3 color2;\r
  varying vec3 vColor2;\r
  attribute vec2 uv;\r
  #ifndef CYLINDER_SPRITE\r
    varying vec2 vUv;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_POS\r
  attribute vec4 offset;\r
  #ifdef SPHERE_SPRITE\r
    varying vec4 instOffset;\r
  varying vec4 spritePosEye;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  attribute vec4 matVector1;\r
  attribute vec4 matVector2;\r
  attribute vec4 matVector3;\r
  attribute vec4 invmatVector1;\r
  attribute vec4 invmatVector2;\r
  attribute vec4 invmatVector3;\r
\r
  #ifdef CYLINDER_SPRITE\r
    varying vec4 matVec1;\r
    varying vec4 matVec2;\r
    varying vec4 matVec3;\r
    varying vec4 invmatVec1;\r
    varying vec4 invmatVec2;\r
    varying vec4 invmatVec3;\r
    varying vec4 spritePosEye;\r
  #endif\r
#endif\r
\r
uniform mat4 modelViewMatrix; // optional\r
uniform mat4 projectionMatrix; // optional\r
uniform mat3 normalMatrix; // optional\r
uniform mat4 modelMatrix; // optional\r
\r
#ifdef DASHED_LINE\r
  attribute float lineDistance;\r
  varying float vLineDistance;\r
#endif\r
\r
#ifdef THICK_LINE\r
  attribute vec3 direction;\r
  uniform mat4 projMatrixInv;\r
  uniform vec2 viewport;\r
  uniform float lineWidth;\r
\r
  vec4 transform(vec4 coord){\r
    return projectionMatrix * modelViewMatrix * coord;\r
  }\r
\r
  vec2 project(vec4 device){\r
    vec3 device_normal = device.xyz/device.w;\r
    vec2 clip_pos = (device_normal*0.5+0.5).xy;\r
    return clip_pos * viewport;\r
  }\r
\r
  vec4 unproject(vec2 screen, float z, float w){\r
    vec2 clip_pos = screen/viewport;\r
    vec2 device_normal = clip_pos*2.0-1.0;\r
    return vec4(device_normal*w, z, w);\r
  }\r
#endif\r
\r
\r
/////////////////////////////////////////// Main ///////////////////////////////////////////////\r
void main() {\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  alphaCol = alphaColor;\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  vec3 objectNormal = vec3(\r
    dot(normal, matVector1.xyz),\r
    dot(normal, matVector2.xyz),\r
    dot(normal, matVector3.xyz));\r
#else\r
  vec3 objectNormal = vec3( normal );\r
#endif\r
\r
vec3 transformedNormal = normalMatrix * objectNormal;\r
\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  vNormal = normalize(transformedNormal);\r
#endif\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  viewNormal = normalize(mat3(modelViewMatrix)*objectNormal);\r
#endif\r
\r
  vec4 localPos = vec4(position.xyz, 1.0);\r
  vec4 worldPos = modelMatrix * localPos;\r
  vec4 mvPosition = modelViewMatrix * localPos;\r
\r
// make thick line offset\r
#ifdef THICK_LINE\r
   // get screen pos\r
   vec4 dPos = transform(vec4(position.xyz, 1.0));\r
   vec2 sPos = project(dPos);\r
   // move pos forward\r
   vec3 position2 = position.xyz + direction.xyz * 0.5;\r
   // get screen offset pos\r
   vec4 dPos2 = transform(vec4(position2.xyz, 1.0));\r
   vec2 sPos2 = project(dPos2);\r
   // screen line direction\r
   vec2 sDir = normalize(sPos2 - sPos);\r
   // vertex offset (orthogonal to line direction)\r
   vec2 offset1 = vec2(-sDir.y, sDir.x);\r
   // move screen vertex\r
   vec2 newPos = sPos + offset1 * position.w * lineWidth;\r
   // get moved pos in view space\r
   vec4 dNewPos =  unproject(newPos, dPos.z, dPos.w);\r
   mvPosition.xyz = (projMatrixInv * dNewPos).xyz;\r
#endif // THICK_LINE\r
\r
#ifdef INSTANCED_POS\r
  #ifdef SPHERE_SPRITE\r
    instOffset = offset;\r
\r
    vec4 posEye = modelViewMatrix * vec4( offset.xyz, 1.0 );\r
    float scale = length(modelViewMatrix[0]);\r
    mvPosition = posEye + vec4( position.xyz * offset.w * scale * INSTANCED_SPRITE_OVERSCALE, 0.0 );\r
    posEye.w = offset.w * scale;\r
\r
    spritePosEye = posEye;\r
 #else\r
    localPos = vec4( offset.xyz + position.xyz * offset.w, 1.0 );\r
    worldPos = modelMatrix * localPos;\r
    mvPosition = modelViewMatrix * localPos;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  #ifdef CYLINDER_SPRITE\r
    matVec1 = matVector1;\r
    matVec2 = matVector2;\r
    matVec3 = matVector3;\r
    invmatVec1 = invmatVector1;\r
    invmatVec2 = invmatVector2;\r
    invmatVec3 = invmatVector3;\r
\r
    // calculate eye coords of cylinder endpoints\r
    vec4 v = vec4(0, -0.5, 0, 1);\r
    vec4 p1 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r
    v.y = 0.5;\r
    vec4 p2 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r
\r
    // sprite is placed at the center of cylinder\r
    vec4 posEye;\r
    posEye.xyz = mix(p1.xyz, p2.xyz, 0.5);\r
    posEye.w = 1.0;\r
    spritePosEye = posEye;\r
\r
    // cylinder radius in eye space\r
    float rad = length(modelViewMatrix[0]) * length(vec3(matVector1.x, matVector2.x, matVector3.x));\r
    vec2 spriteSize;\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // In ortho projection we skip z coordinate\r
      // basic sprite size at screen plane (covers only cylinder axis)\r
      vec2 spriteSizeScreen = abs(p2.xy - p1.xy);\r
\r
      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * (spriteSizeScreen + 2.0 * rad);\r
    #else\r
      // basic sprite size at screen plane (covers only cylinder axis)\r
      vec2 spriteSizeScreen = abs(p2.xy / p2.z - p1.xy / p1.z);\r
\r
      // full sprite size in eye coords\r
      float minZ = min(abs(p1.z), abs(p2.z));\r
      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * abs(posEye.z) * (spriteSizeScreen + 2.0 * rad / minZ);\r
    #endif\r
\r
    mvPosition = posEye + vec4( position.xy * 0.5 * spriteSize, 0, 0 );\r
  #else\r
    localPos = vec4(dot(localPos, matVector1), dot(localPos, matVector2), dot(localPos, matVector3), 1.0);\r
    worldPos = modelMatrix * localPos;\r
    mvPosition = modelViewMatrix * localPos;\r
  #endif\r
#endif\r
\r
  gl_Position = projectionMatrix * mvPosition;\r
\r
  vWorldPosition = worldPos.xyz;\r
  vViewPosition = - mvPosition.xyz;\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
	  vec4 worldPosition;\r
	  // see THREE.WebGLProgram.unrollLoops\r
	  #pragma unroll_loop_start\r
	  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
      vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * vec4(vWorldPosition, 1.0);\r
      vDirectionalShadowNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(objectNormal, 0.0))).xyz;\r
	  }\r
	  #pragma unroll_loop_end\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  vColor = color.xyz;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  vColor2 = color2;\r
  #ifndef CYLINDER_SPRITE\r
    vUv = uv;\r
  #endif\r
#endif\r
\r
#ifdef DASHED_LINE\r
  vLineDistance = lineDistance;\r
#endif\r
}\r
`,hF=`#if defined (NORMALS_TO_G_BUFFER)\r
  #define fragColor gl_FragData[0]\r
#else\r
  #define fragColor gl_FragColor\r
#endif\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  varying float alphaCol;\r
#endif\r
\r
#ifdef COLOR_FROM_POS\r
  uniform mat4 world2colorMatrix;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\r
    uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ]; //only for sprites\r
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r
		varying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r
    vec4 vDirLightWorldCoord[ NUM_DIR_LIGHTS ];\r
    vec3 vDirLightWorldNormal[ NUM_DIR_LIGHTS ];\r
\r
    #ifdef SHADOWMAP_PCF_RAND\r
      // We use 4 instead uniform variable or define because this value is used in for(... i < value; ...) with\r
      // unroll_loop and unroll_loop has pattern:\r
      // /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g\r
      uniform vec2 samplesKernel[4]; // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
      uniform sampler2D noiseTex;\r
      uniform vec2 noiseTexelSize;\r
      uniform vec2 srcTexelSize;\r
      uniform mat4 projectionMatrix;\r
    #endif\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  varying vec3 vColor;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  varying vec3 vColor2;\r
  #ifndef CYLINDER_SPRITE\r
    varying vec2 vUv;\r
  #endif\r
#endif\r
\r
uniform vec3 diffuse;\r
uniform vec3 emissive;\r
uniform vec3 specular;\r
uniform float shininess;\r
uniform vec3 fixedColor;\r
uniform float opacity;\r
uniform float zClipValue;\r
uniform float clipPlaneValue;\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  varying vec3 viewNormal;\r
#endif\r
\r
#define PI 3.14159265359\r
#define RECIPROCAL_PI 0.31830988618\r
#define saturate(a) clamp( a, 0.0, 1.0 )\r
\r
#ifdef USE_FOG\r
  uniform vec3 fogColor;\r
  uniform float fogAlpha;\r
  uniform float fogNear;\r
  uniform float fogFar;\r
#endif\r
\r
varying vec3 vWorldPosition; // world position of the pixel (invalid when INSTANCED_SPRITE is defined)\r
varying vec3 vViewPosition;\r
\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  varying vec3 vNormal;\r
#endif\r
\r
/////////////////////////////////////////// ZSprites ////////////////////////////////////////////////\r
#if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r
  uniform float nearPlaneValue;\r
#endif\r
\r
#ifdef SPHERE_SPRITE\r
  varying vec4 spritePosEye;\r
#endif\r
\r
#if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
  uniform float zOffset;\r
\r
  #if !defined(USE_LIGHTS) || !defined(SHADOWMAP) || !defined(SHADOWMAP_PCF_RAND) || !(NUM_DIR_LIGHTS > 0)\r
    uniform mat4 projectionMatrix;\r
  #endif\r
\r
  float calcDepthForSprites(vec4 pixelPosEye, float zOffset, mat4 projMatrix) {\r
    vec4 pixelPosScreen = projMatrix * pixelPosEye;\r
    return 0.5 * (pixelPosScreen.z / pixelPosScreen.w + 1.0) + zOffset;\r
  }\r
#endif\r
\r
#ifdef SPHERE_SPRITE\r
  varying vec4 instOffset;\r
  uniform mat4 modelMatrix;\r
  uniform mat4 modelViewMatrix;\r
  uniform mat4 invModelViewMatrix;\r
  uniform mat3 normalMatrix;\r
\r
\r
  bool intersect_ray_sphere(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r
\r
    // intersect XZ-projected ray with circle\r
    float a = dot(ray, ray);\r
    float b = dot(ray, origin);\r
    float c = dot(origin, origin) - 1.0;\r
    float det = b * b - a * c;\r
    if (det < 0.0) return false;\r
    float t1 = (-b - sqrt(det)) / a;\r
    float t2 = (-b + sqrt(det)) / a;\r
\r
    // calculate both intersection points\r
    vec3 p1 = origin + ray * t1;\r
    vec3 p2 = origin + ray * t2;\r
\r
    // choose nearest point inside frustum\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // orthografic camera is used for dirLight sources. So in it for all spheres the point with smaller 't' is visible\r
      // t1 is always smaller than t2 (from calculations)\r
      point = p1;\r
      frontFaced = 1.0;\r
      return true;\r
    #else\r
      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r
      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r
      if (t1 >= 0.0) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (t2 >= 0.0) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #endif\r
\r
    return false;\r
  }\r
\r
  bool get_sphere_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r
    vec3 origin, ray;\r
\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // transform vector from sprite center to curPixel into sphere local coords\r
      origin = pixelPosEye.xyz - spritePosEye.xyz;\r
      origin = (invModelViewMatrix * vec4(origin, 0.0)).xyz / instOffset.w;\r
\r
      // transform camera orientation vector into sphere local coords\r
      ray = (invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\r
    #else\r
      // find point of intersection near plane by the ray from camera to curPixel\r
      vec4 v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r
\r
      // transform intersection point into sphere local coords\r
      v = invModelViewMatrix * v;\r
      origin = (v.xyz - instOffset.xyz) / instOffset.w;\r
\r
      // transform vector from camera pos to curPixel into sphere local coords\r
      ray = (invModelViewMatrix * vec4(pixelPosEye, 0.0)).xyz;\r
    #endif\r
    ray = normalize(ray);\r
\r
    return intersect_ray_sphere(origin, ray, point, frontFaced);\r
  }\r
#endif\r
\r
#ifdef CYLINDER_SPRITE\r
  varying vec4 matVec1;\r
  varying vec4 matVec2;\r
  varying vec4 matVec3;\r
  varying vec4 invmatVec1;\r
  varying vec4 invmatVec2;\r
  varying vec4 invmatVec3;\r
\r
  uniform mat4 modelMatrix;\r
  uniform mat4 modelViewMatrix;\r
  uniform mat4 invModelViewMatrix;\r
  uniform mat3 normalMatrix;\r
\r
  varying vec4 spritePosEye;\r
\r
  bool intersect_ray_cylinder(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r
\r
    // intersect XZ-projected ray with circle\r
    float a = dot(ray.xz, ray.xz);\r
    float b = dot(ray.xz, origin.xz);\r
    float c = dot(origin.xz, origin.xz) - 1.0;\r
    float det = b * b - a * c;\r
    if (det < 0.0) return false;\r
    float t1 = (-b - sqrt(det)) / a;\r
    float t2 = (-b + sqrt(det)) / a;\r
\r
    // calculate both intersection points\r
    vec3 p1 = origin + ray * t1;\r
    vec3 p2 = origin + ray * t2;\r
\r
    float halfHeight = 0.5;\r
\r
    // choose nearest point\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // orthografic camera is used for dirLight sources. So in it for all cylinders the point with smaller 't' is visible\r
      // if it is not outside of cylinnder (t1 is always smaller than t2).\r
      if (p1.y >= -halfHeight && p1.y <= halfHeight) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (p2.y >= -halfHeight && p2.y <= halfHeight) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #else\r
      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r
      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r
      if (t1 >= 0.0 && p1.y >= -halfHeight && p1.y <= halfHeight) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (t2 >= 0.0 && p2.y >= -halfHeight && p2.y <= halfHeight) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #endif\r
\r
    return false;\r
  }\r
\r
  bool get_cylinder_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r
    vec3 origin, ray;\r
    vec4 v;\r
\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // transform vector from sprite center to curPixel into cylinder local coords\r
      v = invModelViewMatrix * vec4(pixelPosEye.xyz - spritePosEye.xyz, 0.0);\r
      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
\r
      // transform camera orientation vector into cylinder local coords\r
      v = invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0);\r
      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
    #else\r
      // find point of intersection near plane by the ray from camera to curPixel\r
      v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r
\r
      // transform intersection point into cylinder local coords\r
      v = invModelViewMatrix * v;\r
      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
\r
      // transform vector from camera pos to curPixel into cylinder local coords\r
      v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\r
      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
    #endif\r
    ray = normalize(ray);\r
\r
    return intersect_ray_cylinder(origin, ray, point, frontFaced);\r
  }\r
#endif\r
\r
///////////////////////////////////// Pack and unpack ///////////////////////////////////////////////\r
const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r
const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r
\r
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r
\r
\r
const float ShiftRight8 = 1. / 256.;\r
\r
vec4 packDepthToRGBA( const in float v ) {\r
  vec4 r = vec4( fract( v * PackFactors ), v );\r
  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\r
  return r * PackUpscale;\r
}\r
\r
float unpackRGBAToDepth( const in vec4 v ) {\r
  return dot( v, UnpackFactors );\r
}\r
\r
////////////////////////////////////////// All Lighting /////////////////////////////////////////////////\r
#ifdef TOON_SHADING\r
  #define LOW_TOON_BORDER 0.0\r
  #define MEDIUM_TOON_BORDER 0.7\r
  #define HIGH_TOON_BORDER 1.0\r
\r
  #define MEDIUM_TOON_RANGE 0.5\r
  #define HIGH_TOON_RANGE 0.95\r
#endif\r
#if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r
  struct ReflectedLight {\r
    vec3 directDiffuse;\r
    vec3 directSpecular;\r
    vec3 indirectDiffuse;\r
  };\r
\r
  struct BlinnPhongMaterial {\r
    vec3  diffuseColor;\r
    vec3  specularColor;\r
    float specularShininess;\r
  };\r
\r
  struct GeometricContext {\r
    vec3 normal;\r
    vec3 viewDir;\r
  };\r
\r
  struct DirectionalLight {\r
    vec3 direction;\r
    vec3 color;\r
  };\r
  uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r
\r
  struct DirectionalLightShadow {\r
     vec2 shadowMapSize;\r
     float shadowBias;\r
     float shadowRadius;\r
   };\r
  uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHTS ];\r
\r
  uniform vec3 ambientLightColor;\r
\r
  /////////////////////////////////////////// Shadowmap ////////////////////////////////////////////////\r
\r
  #if defined(SHADOWMAP)\r
  	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\r
  		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r
  	}\r
\r
    float getShadow( sampler2D shadowMap, DirectionalLightShadow dirLight, vec4 shadowCoord, vec3 vViewPosition, vec3 vNormal ) {\r
   	  float shadow = 0.0;\r
\r
      // When shadows for sprites will appear use here for them normals as it done for G-buffer\r
      shadowCoord.xyz += dirLight.shadowBias * vNormal;\r
      shadowCoord.xyz /= shadowCoord.w;\r
\r
      bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r
      bool inFrustum = all( inFrustumVec );\r
      bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r
      bool frustumTest = all( frustumTestVec );\r
\r
      if ( frustumTest ) {\r
        #ifdef SHADOWMAP_BASIC\r
      	  shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r
      	#endif\r
\r
      	#ifdef SHADOWMAP_PCF_SHARP\r
      	  vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r
\r
            float dx0 = - texelSize.x * dirLight.shadowRadius;\r
            float dy0 = - texelSize.y * dirLight.shadowRadius;\r
            float dx1 = + texelSize.x * dirLight.shadowRadius;\r
            float dy1 = + texelSize.y * dirLight.shadowRadius;\r
\r
            shadow = (\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r
            ) * ( 1.0 / 9.0 );\r
        #endif\r
\r
        #ifdef SHADOWMAP_PCF_RAND\r
          vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r
\r
          vec4 vUv = ((projectionMatrix * vec4(vViewPosition, 1.0)) + 1.0) / 2.0;\r
          vec2 vUvNoise = vUv.xy / srcTexelSize * noiseTexelSize;\r
\r
          vec2 noiseVec = normalize(texture2D(noiseTex, vUvNoise).rg);\r
          mat2 mNoise = mat2(noiseVec.x, noiseVec.y, -noiseVec.y, noiseVec.x);\r
\r
          vec2 offset;\r
          #pragma unroll_loop_start\r
          for ( int i = 0; i < 4; i ++ ) { // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
            offset = mNoise * ( normalize( samplesKernel[ i ]) * texelSize * dirLight.shadowRadius );\r
            shadow +=  texture2DCompare( shadowMap, shadowCoord.xy + offset, shadowCoord.z );\r
          }\r
          #pragma unroll_loop_end\r
          shadow /= float( 4 ); // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
        #endif\r
      }\r
      return shadow;//(shadow != 1.0) ? 0.5 : 1.0;//vec4(shadow, shadow, shadow, 1.0);\r
   }\r
  #endif\r
\r
  /////////////////////////////////////////// Lighting /////////////////////////////////////////////////\r
\r
  vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\r
    return RECIPROCAL_PI * diffuseColor;\r
  } // validated\r
\r
  vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\r
    // Original approximation by Christophe Schlick '94\r
    //;float fresnel = pow( 1.0 - dotLH, 5.0 );\r
    // Optimized variant (presented by Epic at SIGGRAPH '13)\r
    float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\r
    return ( 1.0 - specularColor ) * fresnel + specularColor;\r
  } // validated\r
\r
  float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\r
    // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\r
    return 0.25;\r
  }\r
\r
  float D_BlinnPhong( const in float shininess, const in float dotNH ) {\r
    return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\r
  }\r
\r
  vec3 BRDF_Specular_BlinnPhong( const in DirectionalLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\r
    vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r
    float dotNH = saturate(dot( geometry.normal, halfDir ));\r
    float dotLH = saturate(dot( incidentLight.direction, halfDir ));\r
\r
    vec3 F = F_Schlick( specularColor, dotLH );\r
    float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\r
    float D = D_BlinnPhong( shininess, dotNH );\r
\r
    return F * ( G * D );\r
  } // validated\r
\r
  void RE_Direct_BlinnPhong( const in DirectionalLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight, float penumbra ) {\r
\r
    float dotNL = saturate( dot( geometry.normal, directLight.direction ));\r
    #ifdef TOON_SHADING\r
      if(dotNL < MEDIUM_TOON_RANGE){\r
        dotNL = LOW_TOON_BORDER;\r
      }\r
      else if(dotNL < HIGH_TOON_RANGE){\r
        dotNL = MEDIUM_TOON_BORDER;\r
      }\r
      else{\r
        dotNL = HIGH_TOON_BORDER;\r
      }\r
    #endif\r
\r
    vec3 irradiance = dotNL * directLight.color * PI;\r
    reflectedLight.directDiffuse += penumbra * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r
    reflectedLight.directSpecular += penumbra * irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess );\r
  }\r
\r
  void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r
  }\r
\r
  vec3 calcLighting(const in GeometricContext geometry, const in BlinnPhongMaterial material, vec3 vViewPosition) {\r
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\r
    vec3 irradiance = ambientLightColor * PI;\r
\r
    float shadowMask = 1.0;\r
    // see THREE.WebGLProgram.unrollLoops\r
  	#pragma unroll_loop_start\r
  	  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
  	    #ifdef SHADOWMAP\r
  	      shadowMask = getShadow( directionalShadowMap[ i ], directionalLightShadows[ i ], vDirLightWorldCoord[ i ], vViewPosition, vDirLightWorldNormal[ i ] );\r
        #endif\r
\r
  		  if ( shadowMask > 0.0 ) RE_Direct_BlinnPhong( directionalLights[ i ], geometry, material, reflectedLight, shadowMask );\r
  		}\r
  		#pragma unroll_loop_end\r
\r
    RE_IndirectDiffuse_BlinnPhong(irradiance, material, reflectedLight);\r
\r
    return saturate(reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular);\r
  }\r
#endif\r
\r
/////////////////////////////////////////// Dashed Line ///////////////////////////////////////////////\r
#ifdef DASHED_LINE\r
  uniform float dashedLineSize;\r
  uniform float dashedLinePeriod;\r
  varying float vLineDistance;\r
#endif\r
\r
/////////////////////////////////////////// Main ///////////////////////////////////////////////\r
void main() {\r
\r
#ifdef CLIP_PLANE\r
  if (vViewPosition.z < clipPlaneValue) discard;\r
#endif\r
\r
#ifdef ZCLIP\r
  if (vViewPosition.z < zClipValue) discard;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
  #if NUM_DIR_LIGHTS > 0\r
    // see THREE.WebGLProgram.unrollLoops\r
    #pragma unroll_loop_start\r
    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
      vDirLightWorldCoord[ i ] = vDirectionalShadowCoord[ i ];\r
      vDirLightWorldNormal[ i ] = vDirectionalShadowNormal[ i ];\r
    }\r
    #pragma unroll_loop_end\r
  #endif\r
#endif\r
\r
  vec4 pixelPosWorld = vec4(vWorldPosition, 1.0);\r
  vec4 pixelPosEye;\r
\r
#ifdef SPHERE_SPRITE\r
\r
  vec3 viewNormalSprites;\r
  float frontFaced = 1.0;\r
  vec3 normal;\r
\r
/* quick-and-dirty method\r
  normal.xy = ' + INSTANCED_SPRITE_OVERSCALE + ' * (2.0 * vUv - 1.0);\r
  float r2 = dot(normal.xy, normal.xy);\r
  if (r2 > 1.0) discard;\r
  float normalZ = sqrt(1.0 - r2);\r
  normal.z = normalZ;\r
  normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\r
  pixelPosEye = vec4(spritePosEye.xyz, 1.0);\r
  pixelPosEye.z += spritePosEye.w * normalZ;\r
*/\r
\r
  // ray-trace sphere surface\r
  {\r
    vec3 p;\r
    if (!get_sphere_point(-vViewPosition, p, frontFaced)) discard;\r
    vec4 v = vec4(instOffset.xyz + p * instOffset.w, 1.0);\r
    pixelPosWorld = modelMatrix * v;\r
    pixelPosEye = modelViewMatrix * v;\r
    normal = normalize(normalMatrix * p);\r
    #ifdef NORMALS_TO_G_BUFFER\r
      viewNormalSprites = normalize(mat3(modelViewMatrix)*p);\r
    #endif\r
\r
    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
      #if NUM_DIR_LIGHTS > 0\r
        // see THREE.WebGLProgram.unrollLoops\r
        #pragma unroll_loop_start\r
          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r
            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(p, 0.0))).xyz;\r
          }\r
        #pragma unroll_loop_end\r
      #endif\r
    #endif\r
  }\r
#endif\r
\r
#ifdef CYLINDER_SPRITE\r
  vec3 normal;\r
  vec3 viewNormalSprites;\r
  float frontFaced = 1.0;\r
  float cylinderY = 0.0;\r
\r
  // ray-trace cylinder surface\r
  {\r
    vec3 p;\r
    if (!get_cylinder_point(-vViewPosition, p, frontFaced)) discard;\r
\r
    cylinderY = 0.5 * (p.y + 1.0);\r
\r
    vec4 v = vec4(p, 1.0);\r
    v = vec4(dot(v, matVec1), dot(v, matVec2), dot(v, matVec3), 1.0);\r
    pixelPosWorld = modelMatrix * v;\r
    pixelPosEye = modelViewMatrix * v;\r
\r
    vec3 localNormal = normalize(vec3(p.x, 0.0, p.z));\r
    normal = vec3(\r
      dot(localNormal, matVec1.xyz),\r
      dot(localNormal, matVec2.xyz),\r
      dot(localNormal, matVec3.xyz));\r
    #ifdef NORMALS_TO_G_BUFFER\r
      viewNormalSprites = normalize(mat3(modelViewMatrix)*normal);\r
    #endif\r
\r
    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
      #if NUM_DIR_LIGHTS > 0\r
        // see THREE.WebGLProgram.unrollLoops\r
        #pragma unroll_loop_start\r
          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r
            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(normal, 0.0))).xyz;\r
          }\r
        #pragma unroll_loop_end\r
      #endif\r
    #endif\r
\r
    normal = normalize(normalMatrix * normal);\r
  }\r
#endif\r
\r
  #ifdef ATTR_COLOR\r
    vec3 vertexColor = vColor;\r
  #else\r
    vec3 vertexColor = vec3(1.0, 1.0, 1.0);\r
  #endif\r
\r
  #ifdef ATTR_COLOR2\r
    #ifdef CYLINDER_SPRITE\r
      float colorCoef = cylinderY; // cylinder parameter is calculated from ray-tracing\r
    #else\r
      float colorCoef = vUv.y; // cylinder parameter is interpolated as tex coord\r
    #endif\r
      // choose either color or color2\r
    vertexColor = mix(vColor2, vColor, step(0.5, colorCoef));\r
  #endif\r
\r
  // negative red component is a special condition\r
  if (vertexColor.x < 0.0) discard;\r
\r
  #ifdef DASHED_LINE\r
    if ( mod( vLineDistance, dashedLinePeriod ) > dashedLineSize ) discard;\r
  #endif\r
\r
  // transparency prepass writes only z, so we don't need to calc the color\r
  #ifdef PREPASS_TRANSP\r
    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
    #endif\r
    return;\r
  #endif\r
\r
    float totalOpacity = opacity;\r
\r
  #ifdef ATTR_ALPHA_COLOR\r
    totalOpacity *= alphaCol;\r
  #endif\r
\r
  // discard fully transparent pixels\r
  if (totalOpacity == 0.0) discard;\r
\r
  #ifdef FAKE_OPACITY\r
    // discard pixels in checker pattern\r
    vec2 dm_coord = floor(gl_FragCoord.xy);\r
    dm_coord = fract(dm_coord * 0.5);\r
    if (totalOpacity < 1.0 && (dm_coord.x < 0.5 ^^ dm_coord.y < 0.5)) discard;\r
    vec4 diffuseColor = vec4(diffuse, 1.0);\r
  #else\r
    vec4 diffuseColor = vec4(diffuse, totalOpacity);\r
  #endif\r
\r
  float flipNormal;\r
  #if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
    flipNormal = 1.0;\r
    #ifdef DOUBLE_SIDED\r
      flipNormal = float( gl_FrontFacing );\r
    #endif\r
    vec3 normal = normalize( vNormal ) * flipNormal;\r
  #endif\r
\r
    diffuseColor.rgb *= vertexColor;\r
\r
  #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
    gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
  #endif\r
\r
  #ifdef NORMALS_TO_G_BUFFER\r
    #if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r
      vec3 viewNormaInColor = viewNormalSprites;\r
    #else\r
      vec3 viewNormaInColor = viewNormal;\r
      float frontFaced = float( gl_FrontFacing );\r
    #endif\r
    // [-1, 1] -> [0, 1]\r
    viewNormaInColor = 0.5 * viewNormaInColor + 0.5;\r
    gl_FragData[1] = vec4(viewNormaInColor, frontFaced);\r
  #endif\r
\r
  #if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r
    vec3 viewDir;\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      viewDir = -pixelPosEye.xyz;\r
    #else\r
      viewDir = vViewPosition;\r
    #endif\r
    GeometricContext geometry = GeometricContext(normal, normalize( viewDir ));\r
    BlinnPhongMaterial material = BlinnPhongMaterial(diffuseColor.rgb, specular, shininess);\r
    vec3 outgoingLight = calcLighting(geometry, material, viewDir);\r
  #else\r
    vec3 outgoingLight = diffuseColor.rgb;\r
  #endif\r
\r
  #ifdef COLOR_FROM_DEPTH\r
    float depth = 0.0;\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
      depth = gl_FragDepthEXT;\r
    #else\r
      depth = gl_FragCoord.z;\r
    #endif\r
    fragColor = packDepthToRGBA(depth);\r
    return;\r
  #endif\r
\r
  #ifdef COLOR_FROM_POS\r
    fragColor = world2colorMatrix * pixelPosWorld;\r
  #else\r
    #ifdef OVERRIDE_COLOR\r
      fragColor = vec4(fixedColor, diffuseColor.a);\r
    #else\r
      fragColor = vec4(outgoingLight, diffuseColor.a);//vec4(vNormal, 1.0);\r
    #endif\r
\r
    #ifdef USE_FOG\r
      float viewDistance;\r
      #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
        viewDistance = abs(pixelPosEye.z);\r
      #else\r
        viewDistance = vViewPosition.z;\r
      #endif\r
      float fogFactor = smoothstep( fogNear, fogFar, viewDistance) * fogAlpha;\r
      #ifdef FOG_TRANSPARENT\r
        fragColor.a = fragColor.a * (1.0 - fogFactor);\r
      #else\r
        fragColor.rgb = mix( fragColor.rgb, fogColor, fogFactor );\r
      #endif\r
    #endif\r
\r
  #endif\r
}\r
`,NS={precision:"mediump",init:function(e){this.precision=e.capabilities.getMaxPrecision("highp")}},kS=4,OS=4,dF=new Uint8Array([24,52,0,254,145,0,122,0,0,7,170,0,34,214,0,173,8,0,86,249,0,160,4,0,226,46,0,224,211,0,3,157,0,174,247,0,12,182,0,220,216,0,1,109,0,253,154,0]),pF=ec,mF=ec,vF=_n,gF=_n,_F=$f,DS=new Rm(dF,kS,OS,za,Ya,_F,pF,mF,gF,vF,1);DS.needsUpdate=!0;var Bo={noiseWidth:kS,noiseHeight:OS,noiseTexture:DS};function o1(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),t.push.apply(t,r)}return t}function l1(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?o1(Object(t),!0).forEach(function(r){qe(a,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):o1(Object(t)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))})}return a}function yF(a){var e=xF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function xF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SF=[new Pe(-.541978,.840393),new Pe(.125533,-.992089),new Pe(.374329,.927296),new Pe(-.105475,.994422)],wF=bs.merge([it.fog,it.lights,{diffuse:{value:new nt(15658734)},opacity:{value:1},specular:{type:"c",value:new nt(1118481)},shininess:{type:"f",value:30},fixedColor:{type:"c",value:new nt(16777215)},zOffset:{type:"f",value:0},zClipValue:{type:"f",value:0},clipPlaneValue:{type:"f",value:0},nearPlaneValue:{type:"f",value:-.5},invModelViewMatrix:{type:"4fv",value:new Xe},world2colorMatrix:{type:"4fv",value:new Xe},dashedLineSize:{type:"f",value:.1},dashedLinePeriod:{type:"f",value:.2},projMatrixInv:{type:"4fv",value:new Xe},viewport:{type:"v2",value:new Pe},lineWidth:{type:"f",value:2},fogAlpha:{type:"f",value:1},samplesKernel:{type:"v2v",value:null},noiseTex:{type:"t",value:null},noiseTexelSize:{type:"v2",value:null},srcTexelSize:{type:"v2",value:null}}]),bF=["shininess","opacity","zOffset","diffuse","specular","fixedColor","zClipCoef","zClipValue","clipPlaneValue","world2colorMatrix","dashedLineSize","dashedLinePeriod","projMatrixInv","viewport","lineWidth","fogAlpha","samplesKernel","noiseTex","noiseTexelSize","srcTexelSize"],MF={diffuse:new nt(16777215),specular:new nt(1118481),shininess:30,opacity:1,fixedColor:new nt(16777215),zOffset:0,zClipCoef:2,zClipValue:0,clipPlaneValue:0,world2colorMatrix:new Xe,dashedLineSize:.1,dashedLinePeriod:.3,projMatrixInv:new Xe,viewport:new Pe(800,600),lineWidth:2,fogAlpha:1,samplesKernel:SF,noiseTex:Bo.noiseTexture,noiseTexelSize:new Pe(1/Bo.noiseWidth,1/Bo.noiseHeight),srcTexelSize:new Pe(1/800,1/600),copy:function(e){this.diffuse.copy(e.diffuse),this.specular.copy(e.specular),this.shininess=e.shininess,this.opacity=e.opacity,this.fixedColor.copy(e.fixedColor),this.zOffset=e.zOffset,this.zClipCoef=e.zClipCoef,this.zClipValue=e.zClipValue,this.clipPlaneValue=e.clipPlaneValue,this.world2colorMatrix.copy(e.world2colorMatrix),this.dashedLineSize=e.dashedLineSize,this.dashedLinePeriod=e.dashedLinePeriod,this.projMatrixInv=e.projMatrixInv,this.viewport=e.viewport,this.lineWidth=e.lineWidth,this.toonShading=e.toonShading,this.fogAlpha=e.fogAlpha,this.samplesKernel=e.samplesKernel,this.noiseTex=e.noiseTex,this.noiseTexelSize=e.noiseTexelSize,this.srcTexelSize=e.srcTexelSize}},Fi=function(a){ve(t,a);var e=yF(t);function t(r){var n;return K(this,t),n=e.call(this,r),n.fog=!0,n.instancedPos=!1,n.instancedMatrix=!1,n.attrColor=!1,n.attrColor2=!1,n.attrAlphaColor=!1,n.overrideColor=!1,n.sphereSprite=!1,n.cylinderSprite=!1,n.zClip=!1,n.clipPlane=!1,n.fakeOpacity=!1,n.prepassTransparancy=!1,n.colorFromPos=!1,n.shadowmap=!1,n.shadowmapType="random",n.colorFromDepth=!1,n.orthoCam=!1,n.dashedLine=!1,n.transparent=!0,n.thickLine=!1,n.fogTransparent=!1,n.normalsToGBuffer=!1,n.toonShading=!1,n.uberOptions=MF,n.setValues(l1({uniforms:bs.clone(wF),vertexShader:n.precisionString()+fF,fragmentShader:n.precisionString()+hF,lights:!0,fog:!0,side:ws},r)),n}return J(t,[{key:"precisionString",value:function(){var n=NS.precision,i="precision ".concat(n,` float;
`)+"precision ".concat(n,` int;

`);return i}},{key:"copy",value:function(n){return nn(H(t.prototype),"copy",this).call(this,n),this.fragmentShader=n.fragmentShader,this.vertexShader=n.vertexShader,this.uniforms=bs.clone(n.uniforms),this.defines=l1({},n.defines),this.extensions=n.extensions,this.fog=n.fog,this.instancedPos=n.instancedPos,this.instancedMatrix=n.instancedMatrix,this.attrColor=n.attrColor,this.attrColor2=n.attrColor2,this.attrAlphaColor=n.attrAlphaColor,this.overrideColor=n.overrideColor,this.sphereSprite=n.sphereSprite,this.cylinderSprite=n.cylinderSprite,this.zClip=n.zClip,this.clipPlane=n.clipPlane,this.fakeOpacity=n.fakeOpacity,this.colorFromPos=n.colorFromPos,this.shadowmap=n.shadowmap,this.shadowmapType=n.shadowmapType,this.colorFromDepth=n.colorFromDepth,this.orthoCam=n.orthoCam,this.prepassTransparancy=n.prepassTransparancy,this.dashedLine=n.dashedLine,this.thickLine=n.thickLine,this.fogTransparent=n.fogTransparent,this.normalsToGBuffer=n.normalsToGBuffer,this.toonShading=n.toonShading,this.uberOptions.copy(n.uberOptions),this}},{key:"createInstance",value:function(){var n=new t;return n.copy(this),n.uberOptions=Object.create(this.uberOptions),n}},{key:"setValues",value:function(n){if(!(typeof n>"u")){nn(H(t.prototype),"setValues",this).call(this,n);var i={},s={};this.fog&&(i.USE_FOG=1),this.instancedPos&&(i.INSTANCED_POS=1),this.instancedMatrix&&(i.INSTANCED_MATRIX=1),this.attrColor&&(i.ATTR_COLOR=1),this.attrColor2&&(i.ATTR_COLOR2=1),this.attrAlphaColor&&(i.ATTR_ALPHA_COLOR=1),this.overrideColor&&(i.OVERRIDE_COLOR=1),this.sphereSprite&&(i.SPHERE_SPRITE=1,s.fragDepth=1),this.cylinderSprite&&(i.CYLINDER_SPRITE=1,s.fragDepth=1),this.zClip&&(i.ZCLIP=1),this.clipPlane&&(i.CLIP_PLANE=1),this.fakeOpacity&&(i.FAKE_OPACITY=1),this.lights&&(i.USE_LIGHTS=1),this.colorFromPos&&(i.COLOR_FROM_POS=1),this.shadowmap&&(i.SHADOWMAP=1,this.shadowmapType==="pcf"?i.SHADOWMAP_PCF_SHARP=1:this.shadowmapType==="random"?i.SHADOWMAP_PCF_RAND=1:i.SHADOWMAP_BASIC=1),this.colorFromDepth&&(i.COLOR_FROM_DEPTH=1),this.orthoCam&&(i.ORTHOGRAPHIC_CAMERA=1),this.prepassTransparancy&&(i.PREPASS_TRANSP=1),this.dashedLine&&(i.DASHED_LINE=1),this.thickLine&&(i.THICK_LINE=1),this.fogTransparent&&(i.FOG_TRANSPARENT=1),this.normalsToGBuffer&&(s.drawBuffers=1,i.NORMALS_TO_G_BUFFER=1),this.toonShading&&(i.TOON_SHADING=1),this.defines=i,this.extensions=s}}},{key:"setUberOptions",value:function(n){if(!(typeof n>"u"))for(var i in n)n.hasOwnProperty(i)&&(this.uberOptions[i]instanceof nt?this.uberOptions[i]=n[i].clone():this.uberOptions[i]=n[i])}},{key:"clone",value:function(n){return n?this.createInstance():qn.prototype.clone.call(this)}},{key:"updateUniforms",value:function(){var n=this;bF.forEach(function(i){n.uniforms.hasOwnProperty(i)&&(n.uberOptions[i]instanceof nt||n.uberOptions[i]instanceof Xe?n.uniforms[i].value=n.uberOptions[i].clone():n.uniforms[i].value=n.uberOptions[i])})}}]),t}(Yr);function EF(a){var e=CF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function CF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Es(a){var e=function(t){ve(n,t);var r=EF(n);function n(){var i;K(this,n);for(var s=arguments.length,o=new Array(s),l=0;l<s;l++)o[l]=arguments[l];return i=r.call.apply(r,[this].concat(o)),i.onBeforeRender=n.prototype.onBeforeRender,i}return J(n,[{key:"onBeforeRender",value:function(s,o,l,c,f,d){this._onBeforeRender(s,o,l,c,f,d),this._update()}},{key:"_onBeforeRender",value:function(){}},{key:"_update",value:function(){var s=this.material;s&&s instanceof Fi&&s.updateUniforms()}}]),n}(a);return e}function AF(a){var e=TF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function TF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var c1=Es(Ut),FS=function(a){ve(t,a);var e=AF(t);function t(){var r;K(this,t);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return r=e.call.apply(e,[this].concat(i)),r.castShadow=!0,r.receiveShadow=!0,r}return J(t,[{key:"_onBeforeRender",value:function(n,i,s,o,l,c){c1.prototype._onBeforeRender.call(this,n,i,s);var f=this.material;f&&f.uniforms.invModelViewMatrix&&(this.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,this.matrixWorld),f.uniforms.invModelViewMatrix.value.copy(this.modelViewMatrix).invert(),f.uniforms.nearPlaneValue.value=s.near,f.uniformsNeedUpdate=!0)}}]),t}(c1);function RF(a){var e=LF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function LF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var u1=Es(Ut),fh=function(a){ve(t,a);var e=RF(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i.castShadow=!0,i.receiveShadow=!0,i}return J(t,[{key:"_onBeforeRender",value:function(n,i,s){u1.prototype._onBeforeRender.call(this,n,i,s);var o=this.geometry,l=this.material;if(!(!o.zClip||!l.uberOptions)){var c=.5,f=t._modelView,d=t._mvLength,p=t._center;f.multiplyMatrices(this.matrixWorld,s.matrixWorldInverse);var m=d.setFromMatrixColumn(f,0).length();p.copy(o.boundingSphere.center),this.localToWorld(p),l.uberOptions.zClipValue=s.position.z-p.z-m*(c*o.boundingSphere.radius)}}}]),t}(u1);qe(fh,"_mvLength",new C);qe(fh,"_center",new C);qe(fh,"_modelView",new Xe);function PF(a){var e=IF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function IF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NF=function(a){ve(t,a);var e=PF(t);function t(r,n){var i;K(this,t),i=e.call(this),i.geometry=r;var s=si(i);return s.initialized=!1,i.geometry.addEventListener("update",function(){s.update()}),i}return J(t,[{key:"init",value:function(){for(var n=this.children,i=n.length-1;i>=0;--i)this.remove(n[i]);for(var s=this.geometry,o=s.items,l=s.userData,c=0,f=o.length;c<f;++c){var d=o[c];if(d){var p=ke.shallowCloneNode(d),m=new Jm(p);m.userData=xe.clone(l);var v=m.getElement();v.style.visibility="visible",m.source=d,this.add(m)}}this.initialized=!0}},{key:"update",value:function(){var n=this.geometry;if(n.needsUpdate){var i=this.children;this.initialized||this.init();for(var s=0,o=i.length;s<o;++s){var l=i[s],c=l.source;l.position.copy(c.worldPos),l.userData.color=c.opts.color,l.userData.background=c.opts.background}}}}]),t}(nr);function kF(a){var e=OF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function OF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DF=Es(Ut),FF=function(a){ve(t,a);var e=kF(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i.castShadow=!0,i.receiveShadow=!0,i}return J(t)}(DF);function BF(a){var e=zF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function zF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VF=Es(Ut),Rp=new Pe,BS=function(a){ve(t,a);var e=BF(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_onBeforeRender",value:function(n,i,s,o,l,c){var f=this.material;f.uberOptions&&(f.uberOptions.projMatrixInv.copy(s.projectionMatrix).invert(),n.getSize(Rp),f.uberOptions.viewport.set(Rp.width,Rp.height))}}]),t}(VF);function UF(a){var e=GF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function GF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HF=Es(Ut),WF=function(a){ve(t,a);var e=UF(t);function t(){var r;K(this,t);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return r=e.call.apply(e,[this].concat(i)),r.castShadow=!0,r.receiveShadow=!0,r}return J(t)}(HF),ii={ZClipped:fh,ZSprite:FS,Text:NF,Line:Es(Ts),LineSegments:Es($r),Mesh:FF,ThickLineMesh:BS,Instanced:WF};function wc(a,e){return function(t){t.setValues(a),t.setUberOptions(e)}}function f1(a,e){return{Geometry:function(r,n){return new Ri.Instanced2CCylindersGeometry(r,n,a,e)},Object:a?ii.ZSprite:ii.Instanced,initMaterial:wc({instancedMatrix:!0,attrColor:!0,attrColor2:!0,attrAlphaColor:!0,cylinderSprite:a})}}function Lp(a,e){var t=a.prototype instanceof AS,r=e.lineWidth||0;return{Geometry:a,Object:t?ii.ThickLineMesh:ii.LineSegments,initMaterial:wc({lights:!1,attrColor:!0,attrAlphaColor:!0,thickLine:t},{lineWidth:r})}}function XF(a){return{Geometry:a,Object:ii.Mesh,initMaterial:wc({attrColor:!0,attrAlphaColor:!0})}}function Pp(a,e,t,r){var n={wireframe:!!r.wireframe,fakeOpacity:t.now.isoSurfaceFakeOpacity,zClip:r.zClip};return{Geometry:a,Object:ii.ZClipped,initMaterial:wc({attrColor:!0,attrAlphaColor:!1,wireframe:n.wireframe,fakeOpacity:n.fakeOpacity,zClip:n.zClip})}}var Sr=function(){function a(){K(this,a)}return J(a,null,[{key:"createSpheres",value:function(t,r){var n=r.now.zSprites;return{Geometry:function(s,o){return new Ri.InstancedSpheresGeometry(s,o,n)},Object:n?ii.ZSprite:ii.Instanced,initMaterial:wc({instancedPos:!0,attrColor:!0,attrAlphaColor:!0,sphereSprite:n})}}},{key:"create2CClosedCylinders",value:function(t,r){return f1(!1,!1)}},{key:"create2CCylinders",value:function(t,r){return f1(r.now.zSprites,!0)}},{key:"create2CLines",value:function(t,r,n){return Lp(Ri.TwoColorLinesGeometry,n)}},{key:"createCrosses",value:function(t,r,n){return Lp(Ri.CrossGeometry,n)}},{key:"createExtrudedChains",value:function(t,r){return XF(Ri.ExtrudedObjectsGeometry)}},{key:"createChunkedLines",value:function(t,r,n){return Lp(Ri.ChunkedLinesGeometry,n)}},{key:"createQuickSurface",value:function(t,r,n){return Pp(Ri.QuickSurfGeometry,t,r,n)}},{key:"createContactSurface",value:function(t,r,n){return Pp(Ri.ContactSurfaceGeometry,t,r,n)}},{key:"createSASSES",value:function(t,r,n){return Pp(Ri.SSIsosurfaceGeometry,t,r,n)}},{key:"createLabels",value:function(t,r){return{Geometry:Ri.LabelsGeometry,Object:ii.Text,initMaterial:function(){}}}}]),a}();function YF(a){var e=$F();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function $F(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nv=function(a){ve(t,a);var e=YF(t);function t(r,n,i,s){var o;K(this,t),o=e.call(this),o._geometry=r,o._geoParams=n;var l=i.createInstance();n.initMaterial(l),o._material=l,o._transforms=s.length>0?s:[new Xe];for(var c=o._createMeshes(r),f=0,d=c.length;f<d;++f)o.add(c[f]);return o}return J(t,[{key:"raycast",value:function(n,i){var s=t._ray,o=t._inverseMatrix,l=this.children;s.copy(n.ray);for(var c=0,f=l.length;c<f;++c){var d=l[c];if(_t.belongToSelectLayers(d)){d.updateMatrixWorld();var p=d.matrixWorld;o.copy(p).invert(),n.ray.copy(s).applyMatrix4(o);var m=[];this._geometry.raycast(n,m);for(var v=0,y=m.length;v<y;++v){var S=m[v];S.point&&(S.point.applyMatrix4(p),S.distance=s.origin.distanceTo(S.point)),S.object=d,i[i.length]=S}}}n.ray.copy(s)}},{key:"getSubset",value:function(n){for(var i=this._geometry.getSubset(n),s=[],o=0,l=0,c=i.length;l<c;++l)for(var f=this._createMeshes(i[l]),d=0,p=f.length;d<p;++d)s[o++]=f[d];return s}},{key:"_createMeshes",value:function(n){for(var i=this._transforms,s=this._geoParams.Object,o=this._material,l=[],c=0,f=i.length;c<f;++c){var d=new s(n,o);d.applyMatrix4(i[c]),l[c]=d}return l}}]),t}(Dt);qe(nv,"_inverseMatrix",new Xe);qe(nv,"_ray",new ja);function qF(a){var e=ZF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function ZF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function jF(a,e){var t=[a].concat(e);return a.bind.apply(a,Ms(t))}var hh=function(a){ve(t,a);var e=qF(t);function t(r,n,i,s,o,l,c){var f;if(K(this,t),f=e.call(this),f.constructor===t)throw new Error("Can not instantiate abstract class!");return f._selection=n,f._mode=s,f._colorer=i,f._chunksIdc=n.chunks,f._polyComplexity=l,f._geo=new(jF(r.Geometry,f._makeGeoArgs())),f._mesh=new nv(f._geo,r,c,o),f.add(f._mesh),f._build(),f}return J(t,[{key:"_makeGeoArgs",value:function(){throw new Error("ChemGroup subclass must override _makeGeoArgs() method")}},{key:"getSubset",value:function(n,i){i=i!==void 0?i:!1;var s=this._calcChunksList(n,i);return s.length===0?[]:this._mesh.getSubset(s)}},{key:"_changeSubsetOpacity",value:function(n,i,s){var o=this._calcChunksList(n,s);o.length!==0&&this._geo.setOpacity(o,i)}},{key:"enableSubset",value:function(n,i){i=i!==void 0?i:!0,this._changeSubsetOpacity(n,1,i)}},{key:"disableSubset",value:function(n,i){i=i!==void 0?i:!0,this._changeSubsetOpacity(n,0,i)}}]),t}(Ps);function KF(a){var e=JF();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function JF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rv=function(a){ve(t,a);var e=KF(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"raycast",value:function(n,i){var s=this._selection.atoms,o=[];this._mesh.raycast(n,o);for(var l=this._chunksIdc,c=0,f=o.length;c<f;++c)if(o[c].hasOwnProperty("chunkIdx")){var d=l[o[c].chunkIdx];d<s.length&&(o[c].atom=s[d],i.push(o[c]))}}},{key:"_calcChunksList",value:function(n){for(var i=[],s=this._selection.atoms,o=this._chunksIdc,l=0,c=o.length;l<c;++l){var f=s[o[l]];f.mask&n&&i.push(l)}return i}}]),t}(hh);function QF(a){var e=eB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function eB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iv=function(a){ve(t,a);var e=QF(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length,this._polyComplexity]}},{key:"_build",value:function(){for(var n=this._selection.chunks,i=this._selection,s=i.atoms,o=i.parent,l=this._mode,c=this._colorer,f=this._geo,d=0,p=n.length;d<p;++d){var m=s[n[d]];f.setItem(d,m.position,l.calcAtomRadius(m)),f.setColor(d,c.getAtomColor(m,o))}f.finalize()}},{key:"updateToFrame",value:function(n){for(var i=this._selection.chunks,s=this._selection.atoms,o=this._mode,l=this._colorer,c=n.needsColorUpdate(l),f=this._geo,d=0,p=i.length;d<p;++d){var m=s[i[d]];f.setItem(d,n.getAtomPos(i[d]),o.calcAtomRadius(m)),c&&f.setColor(d,n.getAtomColor(l,m))}f.finalize()}}]),t}(rv);function tB(a){var e=nB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function nB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rB=function(a){ve(t,a);var e=tB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){for(var n=[],i=this._selection,s=i.atoms,o=i.chunks,l=o.length,c=0;c<l;++c)n[c]=s[o[c]];var f=this._mode.getSurfaceOpts();return f.atoms=n,[l,f]}}]),t}(iv);function iB(a){var e=aB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function aB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sB=function(a){ve(t,a);var e=iB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){for(var n=[],i=this._selection,s=i.atoms,o=i.chunks,l=o.length,c=0;c<l;++c)n[c]=s[o[c]];var f=this._mode.getSurfaceOpts();return f.atoms=n,f.selection=this._selection,f.colorMode=this._colorer,[l,f]}}]),t}(iv);function oB(a){var e=lB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function lB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function cB(a){var e=a>>16&255,t=a>>8&255,r=a&255;return .2126*e+.7152*t+.0722*r>127?(e=e*3/10,t=t*3/10,r=r*3/10):(e=255-(255-e)*3/10,t=255-(255-t)*3/10,r=255-(255-r)*3/10),e<<16|t<<8|r}function uB(a){var e=a>>16&255,t=a>>8&255,r=a&255;return 255-e<<16|255-t<<8|255-r}function h1(a){return a.name.getNode()!==null?a.name.getNode():a.getVisualName()}var d1={none:function(e){return e},adjust:cB,inverse:uB};function wf(a,e){var t;if(d1.hasOwnProperty(e))t=ke.hexColor(d1[e](a));else{var r=parseInt(e,16);!Number.isNaN(r)&&e.toLowerCase().startsWith("0x")?t=ke.hexColor(r):t="#000000"}return t}var p1={serial:function(e){return e.serial},name:function(e){return e.getVisualName()},elem:function(e){return e.element.name},residue:function(e){return e.residue.getType().getName()},sequence:function(e){return e.residue.getSequence()},chain:function(e){return e.residue.getChain().getName()},hetatm:function(e){return e.isHet()},water:function(e){return e.residue.getType().getName()==="HOH"||e.residue.getType().getName()==="WAT"}},m1=function(e,t){return t.replace(/\{\{(\s*\w+\s*)\}\}/g,function(r){var n=r.replace(/\s+/g,"");return n=n.substring(2,n.length-2).toLowerCase(),p1.hasOwnProperty(n)?p1[n](e):"null"})},fB=function(a){ve(t,a);var e=oB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){var n=this._mode.getLabelOpts();return[this._selection.chunks.length,n]}},{key:"_build",value:function(){for(var n=this._mode.getLabelOpts(),i=this._selection.chunks,s=this._selection,o=s.atoms,l=s.parent,c=this._colorer,f=this._geo,d=0,p=i.length;d<p;++d){var m=o[i[d]],v=n.template?m1(m,n.template):h1(m);if(v){var y=c.getAtomColor(m,l),S=parseInt(wf(y,n.fg).substring(1),16),_=n.showBg?parseInt(wf(y,n.bg).substring(1),16):"transparent";f.setItem(d,m.position,v),f.setColor(d,S,_)}}f.finalize()}},{key:"updateToFrame",value:function(n){for(var i=this._mode.getLabelOpts(),s=this._selection.chunks,o=this._selection.atoms,l=this._colorer,c=this._geo,f=n.needsColorUpdate(l),d=0,p=s.length;d<p;++d){var m=o[s[d]],v=i.template?m1(m,i.template):h1(m);if(v){var y=n.getAtomColor(l,m),S=parseInt(wf(y,i.fg).substring(1),16),_=i.showBg?parseInt(wf(y,i.bg).substring(1),16):"transparent";c.setItem(d,n.getAtomPos(s[d]),v),f&&c.setColor(d,S,_)}}c.finalize()}}]),t}(rv);function hB(a){var e=dB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function dB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function v1(a,e,t,r){var n=Math.sin(a);return e.clone().multiplyScalar(Math.sin((1-r)*a)/n).addScaledVector(t,Math.sin(r*a)/n)}var zS=function(a){ve(t,a);var e=hB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_buildInner",value:function(n,i){for(var s=this._selection.chunks,o=new C,l=new C,c=this._segmentsHeight,f=1/c,d=this._colorer,p=this._selection,m=p.cycles,v=p.parent,y=0,S=s[y],_=0,x=m.length;_<x;++_){var b=m[_],M=b.atoms,E=[],T=[],R=b.center,V=b.radius-n,Y=M.length,$=0,W=M[Y-1].position,j=M[$].position;o.subVectors(W,R),l.subVectors(j,R);for(var X=l.clone().cross(o).normalize();$<Y;++$){var P=o.angleTo(l);T[$]=v1(P,o,l,.5).normalize(),j=M[($+1)%Y].position,o.copy(l),l.subVectors(j,R)}for($=0;$<Y;++$)if(M[$].index===S){for(var N=T[$],I=T[($+1)%Y],G=d.getAtomColor(M[$],v),ee=N.angleTo(I),re=0;re<=c;++re)E[re]=v1(ee,N,I,re*f).multiplyScalar(V).add(R);i(y++,G,E,R,X),S=s[y]}}}}]),t}(rv);function pB(a){var e=mB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function mB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function vB(a,e){for(var t=[],r=0;r<e;++r){var n=-2*r/e*Math.PI;t.push(new C(Math.cos(n)*a,Math.sin(n)*a,0))}return t}var gB=_t.calcChunkMatrix,_B=function(a){ve(t,a);var e=pB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_build",value:function(){var n=this._segmentsHeight,i=this._mode.getAromRadius(),s=new Pe(i,i),o=this._mode.calcStickRadius()+2*i,l=new C,c=[],f=this._geo;this._buildInner(o,function(d,p,m,v,y){for(var S=0;S<=n;++S){var _=m[S],x=_.clone().sub(v).cross(y);l.addVectors(_,x),c[S]=gB(_,l,y,s)}f.setItem(d,c),f.setColor(d,p)}),f.finalize()}},{key:"_makeGeoArgs",value:function(){return this._segmentsHeight=this._polyComplexity,[vB(1,this._polyComplexity),this._segmentsHeight+1,this._selection.chunks.length]}}]),t}(zS);function yB(a){var e=xB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function xB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SB=function(a){ve(t,a);var e=yB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_build",value:function(){var n=this,i=this._geo,s=this._mode.getAromaticOffset();this._buildInner(s,function(o,l,c){for(var f=c[0],d=1;d<=n._segmentsHeight;++d){var p=c[d];i.setSegment(o,d-1,f,p),f=p}i.setColor(o,l)}),i.finalize()}},{key:"_makeGeoArgs",value:function(){return this._segmentsHeight=this._mode.getAromaticArcChunks(),[this._selection.chunks.length,this._segmentsHeight,!0]}}]),t}(zS);function wB(a){var e=bB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function bB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VS=function(a){ve(t,a);var e=wB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"raycast",value:function(n,i){var s=this._selection.residues,o=[];this._mesh.raycast(n,o);for(var l=this._chunksIdc,c=0,f=o.length;c<f;++c)if(o[c].hasOwnProperty("chunkIdx")){var d=l[o[c].chunkIdx];d<s.length&&(o[c].residue=s[d],i.push(o[c]))}}},{key:"_calcChunksList",value:function(n){for(var i=[],s=this._selection.residues,o=this._chunksIdc,l=0,c=o.length;l<c;++l){var f=s[o[l]];f._mask&n&&i.push(l)}return i}}]),t}(hh);function MB(a){var e=EB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function EB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var US=function(a){ve(t,a);var e=MB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"raycast",value:function(n,i){var s=this._selection.residues,o=[];this._mesh.raycast(n,o);for(var l=this._chunksIdc,c=0,f=o.length;c<f;++c)if(o[c].hasOwnProperty("chunkIdx")){var d=l[Math.floor(o[c].chunkIdx/2)];d<s.length&&(o[c].residue=s[d],i.push(o[c]))}}},{key:"_build",value:function(){for(var n=this._selection,i=n.residues,s=n.parent,o=this._colorer,l=this._geo,c=this._mode.calcStickRadius(),f=0,d=this._selection.chunks,p=0,m=d.length;p<m;++p){var v=i[d[p]],y=o.getResidueColor(v,s);this._processItem(f++,v._cylinders[0],v._cylinders[1],c,y)}l.finalize()}},{key:"_calcChunksList",value:function(n){for(var i=[],s=0,o=this._selection.residues,l=this._chunksIdc,c=0,f=l.length;c<f;++c){var d=o[l[c]];d._mask&n&&(i[s++]=2*c,i[s++]=2*c+1)}return i}},{key:"updateToFrame",value:function(n){for(var i=n.getResidues(),s=this._selection.parent,o=this._colorer,l=this._geo,c=this._mode.calcStickRadius(),f=0,d=this._selection.chunks,p=0,m=d.length;p<m;++p){var v=i[d[p]],y=o.getResidueColor(v,s);this._processItem(f++,v._cylinders[0],v._cylinders[1],c,y)}l.finishUpdate()}}]),t}(VS);function CB(a){var e=AB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function AB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TB=function(a){ve(t,a);var e=CB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length,this._polyComplexity]}},{key:"_processItem",value:function(n,i,s,o,l){var c=this._geo;c.setItem(n,i,s,o),c.setColor(n,l,l)}}]),t}(US);function RB(a){var e=LB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function LB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var PB=function(a){ve(t,a);var e=RB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length*2,this._polyComplexity]}},{key:"_processItem",value:function(n,i,s,o,l){var c=this._geo,f=n*2;c.setItem(f,i,o),c.setColor(f,l),f++,c.setItem(f,s,o),c.setColor(f,l)}}]),t}(US),Lf={};(function(a){(function(){var e,t,r,n,i,s,o,l,c,f,d,p,m,v,y,S,_,x,b,M,E,T,R,V,Y,$,W=Object.prototype.hasOwnProperty,j=function(P,N){for(var I in N)W.call(N,I)&&(P[I]=N[I]);function G(){this.constructor=P}return G.prototype=N.prototype,P.prototype=new G,P.__super__=N.prototype,P};r={METHOD_NEAREST:"nearest",METHOD_LINEAR:"linear",METHOD_CUBIC:"cubic",METHOD_LANCZOS:"lanczos",METHOD_SINC:"sinc",CLIP_CLAMP:"clamp",CLIP_ZERO:"zero",CLIP_PERIODIC:"periodic",CLIP_MIRROR:"mirror",CUBIC_TENSION_DEFAULT:0,CUBIC_TENSION_CATMULL_ROM:0},p={method:r.METHOD_CUBIC,cubicTension:r.CUBIC_TENSION_DEFAULT,clip:r.CLIP_CLAMP,scaleTo:0,sincFilterSize:2,sincWindow:void 0},c=function(P,N){return Math.max(0,Math.min(P,N-1))},d=function(P,N){return P=P%N,P<0&&(P+=N),P},f=function(P,N){var I;return I=2*(N-1),P=d(P,I),P>N-1&&(P=I-P),P},e=function(){function X(P,N){if(this.array=P.slice(0),this.length=this.array.length,!(this.clipHelper={clamp:this.clipHelperClamp,zero:this.clipHelperZero,periodic:this.clipHelperPeriodic,mirror:this.clipHelperMirror}[N.clip]))throw"Invalid clip: "+N.clip}return X.prototype.getClippedInput=function(P){return 0<=P&&P<this.length?this.array[P]:this.clipHelper(P)},X.prototype.clipHelperClamp=function(P){return this.array[c(P,this.length)]},X.prototype.clipHelperZero=function(P){return 0},X.prototype.clipHelperPeriodic=function(P){return this.array[d(P,this.length)]},X.prototype.clipHelperMirror=function(P){return this.array[f(P,this.length)]},X.prototype.interpolate=function(P){throw"Subclasses of AbstractInterpolator must override the interpolate() method."},X}(),i=function(X){j(P,X);function P(){P.__super__.constructor.apply(this,arguments)}return P.prototype.interpolate=function(N){return this.getClippedInput(Math.round(N))},P}(e),n=function(X){j(P,X);function P(){P.__super__.constructor.apply(this,arguments)}return P.prototype.interpolate=function(N){var I;return I=Math.floor(N),N-=I,(1-N)*this.getClippedInput(I)+N*this.getClippedInput(I+1)},P}(e),t=function(X){j(P,X);function P(N,I){this.tangentFactor=1-Math.max(-1,Math.min(1,I.cubicTension)),P.__super__.constructor.apply(this,arguments)}return P.prototype.getTangent=function(N){return this.tangentFactor*(this.getClippedInput(N+1)-this.getClippedInput(N-1))/2},P.prototype.interpolate=function(N){var I,G,ee,re,he;return I=Math.floor(N),G=[this.getTangent(I),this.getTangent(I+1)],ee=[this.getClippedInput(I),this.getClippedInput(I+1)],N-=I,re=N*N,he=N*re,(2*he-3*re+1)*ee[0]+(he-2*re+N)*G[0]+(-2*he+3*re)*ee[1]+(he-re)*G[1]},P}(e),T=Math.sin,s=Math.PI,R=function(P){return P===0?1:T(s*P)/(s*P)},_=function(P){return function(N){return R(N/P)}},b=function(P){return function(N){return R(N)*P(N)}},o=function(X){j(P,X);function P(N,I){if(P.__super__.constructor.apply(this,arguments),this.a=I.sincFilterSize,!I.sincWindow)throw"No sincWindow provided";this.kernel=b(I.sincWindow)}return P.prototype.interpolate=function(N){var I,G,ee,re,he;for(I=Math.floor(N),ee=0,G=re=I-this.a+1,he=I+this.a;re<=he?G<=he:G>=he;re<=he?G++:G--)ee+=this.kernel(N-G)*this.getClippedInput(G);return ee},P}(e),m=function(P,N){var I,G,ee,re;for(re=[],G=0,ee=P.length;G<ee;G++)I=P[G],re.push(I[N]);return re},x=function(P,N,I){var G,ee;return I.join==="0,1"?P:(G=N/(I[1]-I[0]),ee=I[0],function(re){return P(G*(re-ee))})},v=function(P){return Object.prototype.toString.call(P).slice(8,-1)},Y=function(P){if(isNaN(P))throw"NaN in Smooth() input";if(v(P)!=="Number")throw"Non-number in Smooth() input";if(!isFinite(P))throw"Infinity in Smooth() input"},$=function(P,N){var I,G,ee;if(v(P)!=="Array")throw"Non-vector in Smooth() input";if(P.length!==N)throw"Inconsistent dimension in Smooth() input";for(G=0,ee=P.length;G<ee;G++)I=P[G],Y(I)},y=function(P){return v(P)==="Number"&&isFinite(P)&&!isNaN(P)},M=function(P){var N;switch(N="scaleTo param must be number or array of two numbers",v(P)){case"Number":if(!y(P))throw N;P=[0,P];break;case"Array":if(P.length!==2||!(y(P[0])&&y(P[1])))throw N;break;default:throw N}return P},E=function(P){var N,I,G;N={};for(I in P)W.call(P,I)&&(G=P[I],N[I]=G);return N},l=function(P,N){var I,G,ee,re,he,pe,Ie,De,Le,Oe,ne;N==null&&(N={}),Le={},N=E(N),Le.config=E(N),N.scaleTo==null&&(N.scaleTo=N.period),N.sincFilterSize==null&&(N.sincFilterSize=N.lanczosFilterSize);for(Ie in p)W.call(p,Ie)&&(ne=p[Ie],N[Ie]==null&&(N[Ie]=ne));if(!(he={nearest:i,linear:n,cubic:t,lanczos:o,sinc:o}[N.method]))throw"Invalid method: "+N.method;if(N.method==="lanczos"&&(N.sincWindow=_(N.sincFilterSize)),P.length<2)throw"Array must have at least two elements";Le.count=P.length,Oe=function(){var at,Ge,We,Ve;switch(v(P[0])){case"Number":if(Le.dimension="scalar",l.deepValidation)for(at=0,We=P.length;at<We;at++)De=P[at],Y(De);return re=new he(P,N),function(Te){return re.interpolate(Te)};case"Array":if(Le.dimension=G=P[0].length,!G)throw"Vectors must be non-empty";if(l.deepValidation)for(Ge=0,Ve=P.length;Ge<Ve;Ge++)ne=P[Ge],$(ne,G);return pe=function(){var Te;for(Te=[],ee=0;0<=G?ee<G:ee>G;0<=G?ee++:ee--)Te.push(new he(m(P,ee),N));return Te}(),function(Te){var me,ge,se,we;for(we=[],ge=0,se=pe.length;ge<se;ge++)me=pe[ge],we.push(me.interpolate(Te));return we};default:throw"Invalid element type: "+v(P[0])}}(),N.clip==="periodic"?I=P.length:I=P.length-1,N.scaleTo||(N.scaleTo=I),Le.domain=M(N.scaleTo),Oe=x(Oe,I,Le.domain),Le.domain.sort();for(Ie in Le)W.call(Le,Ie)&&(ne=Le[Ie],Oe[Ie]=ne);return Oe};for(S in r)W.call(r,S)&&(V=r[S],l[S]=V);l.deepValidation=!0,(a!==null?a:window).Smooth=l}).call(hS)})(Lf);var IB=pt.ResidueType,NB=_t.calcChunkMatrix;function g1(a,e){var t=Lf.Smooth(a,{method:Lf.Smooth.METHOD_CUBIC,clip:Lf.Smooth.CLIP_CLAMP,cubicTension:e,scaleTo:1});return function(r,n){var i=n;i===null&&(i=function(c){return(c*(a.length-1-2)+1)/(a.length-1)});var s=i(r),o=t(s);return new C(o[0],o[1],o[2])}}function Ul(a,e,t,r){if(!r._isValid){a[t]=a[t-1],e[t]=e[t-1];return}var n=r._controlPoint;a[t]=[n.x,n.y,n.z];var i=n.clone().add(r._wingVector);e[t]=[i.x,i.y,i.z]}function kB(a,e,t,r){var n=(r._type.flags&IB.Flags.NUCLEIC)!==0,i=n?"C5'":"N",s=n?"C3'":"C",o,l;if(r.forEachAtom(function(_){var x=_.getVisualName();!o&&x===i?o=_.position:!l&&x===s&&(l=_.position)}),o&&l||(o=r._firstAtom.position,l=r._lastAtom.position),o&&l){var c=l.clone().sub(o),f=r._wingVector,d=r._controlPoint,p=d.clone().add(f),m=d.clone().sub(c),v=m.clone().add(f);a[t]=[m.x,m.y,m.z],e[t]=[v.x,v.y,v.z],++t,a[t]=[m.x,m.y,m.z],e[t]=[v.x,v.y,v.z],++t,a[t]=[d.x,d.y,d.z],e[t]=[p.x,p.y,p.z],++t;var y=d.clone().add(c),S=y.clone().add(f);a[t]=[y.x,y.y,y.z],e[t]=[S.x,S.y,S.z],++t,a[t]=[y.x,y.y,y.z],e[t]=[S.x,S.y,S.z]}}function OB(a,e,t,r){var n=r.start,i=r.end;function s(y){return y>n&&a[y-1]._isValid?y-1:y}function o(y){return y<i&&a[y+1]._isValid?y+1:y}var l=[],c=[],f=0;function d(y,S){var _=a[y]._controlPoint.clone().lerp(a[S]._controlPoint,-.25),x=_.clone().add(a[y]._wingVector);c[f]=[_.x,_.y,_.z],l[f++]=[x.x,x.y,x.z],c[f]=[_.x,_.y,_.z],l[f++]=[x.x,x.y,x.z]}var p=s(e),m=o(t);if(p===m)return kB(c,l,f,a[e]),{centerPoints:c,topPoints:l};e===p?d(e,o(e)):(Ul(c,l,f++,a[s(p)]),Ul(c,l,f++,a[p]));for(var v=e;v<=t;++v)Ul(c,l,f++,a[v]);return m===o(m)?d(t,s(t)):(Ul(c,l,f++,a[m]),Ul(c,l,f,a[o(m)])),{centerPoints:c,topPoints:l}}var DB=function(){function a(e,t,r,n,i,s){K(this,a);var o=OB(e,t,r,s);this._topInterp=g1(o.topPoints,i),this._centerInterp=g1(o.centerPoints,i),this._shift=.5/(r-t+2),this._valueStep=(1-2*this._shift)/(2*(r-t+1)*(n-1)),this._segmentsCount=n}return J(a,[{key:"prepareMatrices",value:function(t,r,n){for(var i=this._segmentsCount,s=new Array(i),o=new Pe(0,0),l=this._topInterp,c=this._centerInterp,f=this._shift+this._valueStep*(i-1)*t,d=0;d<i;++d){var p=Math.min(1,d/(i-1));o.lerpVectors(r,n,p);var m=l(f,null),v=c(f,null);f+=this._valueStep;var y=c(f,null);s[d]=NB(v.clone(),y.clone(),m.clone().sub(v),o)}return s}}]),a}();function FB(a){var e=BB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function BB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function zB(a,e){for(var t=[],r=0;r<e;++r){var n=Math.PI/2-2*Math.PI*r/e;t.push(new C(Math.cos(n)*a,Math.sin(n)*a,0))}return t}function _1(a,e,t,r,n,i){for(var s=0,o=a.length;s<o;++s)for(var l=a[s].arr,c=a[s].boundaries,f=0,d=l.length;f<d;++f)for(var p=[l[f].start,l[f].end],m=new DB(e,p[0],p[1],t,r,c),v=null,y=l[f].start*2,S=l[f].end*2+1,_=n.getResidueRadius(e[0],0),x=y;x<=S;++x){var b=x/2|0,M=e[b],E=n.getResidueRadius(M,x%2),T=n.getResidueRadius(M,1+x%2),R=m.prepareMatrices(x-p[0]*2,E,T);R.unshift(v===null?R[0]:v);var V=E.x!==T.x||E.y!==T.y,Y=E.x!==_.x||E.y!==_.y;i(M,R,V,Y),v=R[t],_=T}}var VB=function(a){ve(t,a);var e=FB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){var n=this._mode.getHeightSegmentsRatio();return this._segmentsHeight=this._polyComplexity*n|0,[zB(1,this._polyComplexity),this._segmentsHeight+1,this._selection.chunks.length*2]}},{key:"_build",value:function(){var n=this._selection,i=n.residues,s=n.parent,o=this._mode,l=this._colorer,c=o.getTension(),f=this._geo,d=0,p=[];_1(this._selection.subdivs,i,this._segmentsHeight,c,o,function(m,v){var y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,_=l.getResidueColor(m,s);p[d]=m._index,f.setItem(d,v,y,S),f.setColor(d++,_)}),this._chunksIdc=p,f.finalize()}},{key:"updateToFrame",value:function(n){var i=this._selection.parent,s=this._mode,o=this._colorer,l=s.getTension(),c=this._geo,f=n.getResidues(),d=0,p=n.needsColorUpdate(o);_1(this._selection.subdivs,f,this._segmentsHeight,l,s,function(m,v){c.setItem(d,v),p&&c.setColor(d,o.getResidueColor(m,i)),d++}),c.finalize()}}]),t}(VS);function UB(a){var e=GB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function GB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HB=function(a){ve(t,a);var e=UB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){for(var n=this._selection.subdivs,i=0,s=0,o=n.length;s<o;++s)for(var l=n[s].arr,c=0,f=l.length;c<f;++c)i+=l[c].end-l[c].start;return[i,this._polyComplexity]}},{key:"_build",value:function(){for(var n=this._selection,i=n.residues,s=n.parent,o=this._mode,l=this._colorer,c=this._geo,f=0,d=[],p=this._selection.subdivs,m=o.calcStickRadius(),v=0,y=p.length;v<y;++v)for(var S=p[v].arr,_=0,x=S.length;_<x;++_)for(var b=S[_].start,M=S[_].end,E=i[b],T=b+1;T<=M;++T){var R=i[T];d[f]={first:E._index,second:R._index},c.setItem(f,E._controlPoint,R._controlPoint,m),c.setColor(f,l.getResidueColor(E,s),l.getResidueColor(R,s)),f++,E=R}this._chunksIdc=d,c.finalize()}},{key:"updateToFrame",value:function(n){for(var i=n.getResidues(),s=this._selection.parent,o=this._mode,l=this._colorer,c=this._geo,f=0,d=this._selection.subdivs,p=o.calcStickRadius(),m=n.needsColorUpdate(l),v=0,y=d.length;v<y;++v)for(var S=d[v].arr,_=0,x=S.length;_<x;++_)for(var b=S[_].start,M=S[_].end,E=i[b],T=b+1;T<=M;++T){var R=i[T];c.setItem(f,E._controlPoint,R._controlPoint,p),m&&c.setColor(f,l.getResidueColor(E,s),l.getResidueColor(R,s)),f++,E=R}c.finalize()}},{key:"raycast",value:function(n,i){var s=[],o=this._selection.residues;this._mesh.raycast(n,s);for(var l=this._chunksIdc,c=0,f=s.length;c<f;++c)if(s[c].hasOwnProperty("chunkIdx")){var d=s[c].chunkIdx,p=l[Math.floor(d/2)],m=d%2===0?p.first:p.second;m<o.length&&(s[c].residue=o[m],i.push(s[c]))}}},{key:"_calcChunksList",value:function(n){for(var i=[],s=this._chunksIdc,o=this._selection.residues,l=0,c=s.length;l<c;++l){var f=s[l];o[f.first]._mask&n&&i.push(l*2),o[f.second]._mask&n&&i.push(l*2+1)}return i}}]),t}(hh);function WB(a){var e=XB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function XB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function YB(a){return a<2?1:a}var GS=function(a){ve(t,a);var e=WB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_makeGeoArgs",value:function(){for(var n=this._mode.drawMultiorderBonds(),i=this._mode.showAromaticLoops(),s=this._selection.chunks,o=this._selection.bonds,l=0,c=0,f=s.length;c<f;++c)l+=this.getBondOrder(o[s[c]],n,i);return[l,this._polyComplexity]}},{key:"getBondOrder",value:function(n,i,s){var o=1;return i&&(!s||n._type!==Rs.BondType.AROMATIC)&&(o=YB(n._order)),o}},{key:"raycast",value:function(n,i){var s=this._selection.bonds,o=[];this._mesh.raycast(n,o);for(var l=this._chunksIdc,c=0,f=o.length;c<f;++c)if(o[c].hasOwnProperty("chunkIdx")){var d=o[c].chunkIdx,p=l[Math.floor(d/2)];if(p<s.length){var m=s[p];o[c].atom=d%2===0?m._left:m._right,i.push(o[c])}}}},{key:"_calcChunksList",value:function(n,i){for(var s=[],o=this._selection.bonds,l=this._chunksIdc,c=0,f=l.length;c<f;++c){var d=o[l[c]];d._left.mask&n&&(!i||d._right.mask&n)&&s.push(2*c),d._right.mask&n&&(!i||d._left.mask&n)&&s.push(2*c+1)}return s}}]),t}(hh);function $B(a){var e=qB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function qB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZB=function(a){ve(t,a);var e=$B(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_build",value:function(){for(var n=this._selection.chunks,i=this._selection,s=i.bonds,o=i.parent,l=this._mode,c=this._colorer,f=this._geo,d=l.drawMultiorderBonds(),p=l.showAromaticLoops(),m=l.calcStickRadius(),v=l.calcSpaceFraction(),y,S=new C,_=new C,x=0,b=[],M=0,E=n.length;M<E;++M){var T=s[n[M]],R=T._left,V=T._right,Y=R.position,$=V.position;y=T.calcNormalDir();for(var W=this.getBondOrder(T,d,p),j=Math.min(l.calcAtomRadius(R),l.calcAtomRadius(V)),X=2*j/W,P=d?Math.min(m,X*.5*(1-v)):m,N=0;N<W;++N){var I=X*(W%2===0?((N/2|0)+.5)*(1-2*(N%2)):((N+1)/2|0)*(-1+2*(N%2)));b[x]=T._index,S.copy(Y),S.addScaledVector(y,I),_.copy($),_.addScaledVector(y,I),f.setItem(x,S,_,P),f.setColor(x++,c.getAtomColor(R,o),c.getAtomColor(V,o))}}f.finalize(),this._chunksIdc=b}},{key:"updateToFrame",value:function(n){for(var i=this._selection.chunks,s=this._selection.bonds,o=this._mode,l=this._colorer,c=this._geo,f=o.drawMultiorderBonds(),d=o.showAromaticLoops(),p=o.calcStickRadius(),m=o.calcSpaceFraction(),v,y=new C,S=new C,_=0,x=n.needsColorUpdate(l),b=0,M=i.length;b<M;++b){var E=s[i[b]],T=E._left,R=E._right,V=n.getAtomPos(T.index).clone(),Y=n.getAtomPos(R.index);v=E.calcNormalDir();for(var $=this.getBondOrder(E,f,d),W=Math.min(o.calcAtomRadius(T),o.calcAtomRadius(R)),j=2*W/$,X=f?Math.min(p,j*.5*(1-m)):p,P=0;P<$;++P){var N=j*($%2===0?((P/2|0)+.5)*(1-2*(P%2)):((P+1)/2|0)*(-1+2*(P%2)));y.copy(V),y.addScaledVector(v,N),S.copy(Y),S.addScaledVector(v,N),c.setItem(_,y,S,X),x&&c.setColor(_,n.getAtomColor(l,T),n.getAtomColor(l,R)),_++}}c.finalize()}}]),t}(GS);function jB(a){var e=KB();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function KB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mo=.15,JB=function(a){ve(t,a);var e=jB(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_build",value:function(){for(var n=this._selection.chunks,i=this._selection,s=i.bonds,o=i.parent,l=this._mode,c=this._colorer,f=this._geo,d=l.drawMultiorderBonds(),p=l.showAromaticLoops(),m=new C,v=new C,y=new C,S=0,_=[],x=0,b=n.length;x<b;++x){var M=s[n[x]],E=M._left,T=M._right,R=E.position,V=T.position,Y=E.bonds.length===1,$=T.bonds.length===1;m.subVectors(V,R);for(var W=m.length(),j=M.calcNormalDir(),X=this.getBondOrder(M,d,p),P=0;P<X;++P){v.copy(R),y.copy(V);var N=X%2===0?((P/2|0)+.5)*(1-2*(P%2)):((P+1)/2|0)*(-1+2*(P%2));_[S]=M._index,X===2&&!Y&&!$&&(N-=.5,N*=-1),!Y&&!$&&X>1&&N!==0&&(v.lerpVectors(R,V,Mo/W),y.lerpVectors(R,V,1-Mo/W)),N*=Mo,v.addScaledVector(j,N),y.addScaledVector(j,N),f.setItem(S,v,y),f.setColor(S++,c.getAtomColor(E,o),c.getAtomColor(T,o))}}f.finalize(),this._chunksIdc=_}},{key:"updateToFrame",value:function(n){for(var i=this._selection.chunks,s=this._selection.bonds,o=this._mode,l=this._colorer,c=this._geo,f=o.drawMultiorderBonds(),d=o.showAromaticLoops(),p=new C,m=new C,v=new C,y=0,S=n.needsColorUpdate(l),_=0,x=i.length;_<x;++_){var b=s[i[_]],M=b._left,E=b._right,T=n.getAtomPos(M.index).clone(),R=n.getAtomPos(E.index),V=M.bonds.length===1,Y=E.bonds.length===1;p.subVectors(R,T);for(var $=p.length(),W=b.calcNormalDir(),j=this.getBondOrder(b,f,d),X=0;X<j;++X){m.copy(T),v.copy(R);var P=j%2===0?((X/2|0)+.5)*(1-2*(X%2)):((X+1)/2|0)*(-1+2*(X%2));j===2&&!V&&!Y&&(P-=.5,P*=-1),!V&&!Y&&j>1&&P!==0&&(m.lerpVectors(T,R,Mo/$),v.lerpVectors(T,R,1-Mo/$)),P*=Mo,m.addScaledVector(W,P),v.addScaledVector(W,P),c.setItem(y,m,v),S&&c.setColor(y,n.getAtomColor(l,M),n.getAtomColor(l,E)),y++}}c.finalize()}}]),t}(GS),wr={AtomsSphereGroup:iv,AtomsSurfaceGroup:rB,AtomsSASSESGroupStub:sB,AtomsTextGroup:fB,AromaticTorusGroup:_B,AromaticLinesGroup:SB,NucleicCylindersGroup:TB,NucleicSpheresGroup:PB,ResiduesSubseqGroup:VB,ResiduesTraceGroup:HB,BondsCylinderGroup:ZB,BondsLinesGroup:JB};function QB(a){var e=ez();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function ez(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HS=function(a){ve(t,a);var e=QB(t);function t(r,n,i,s,o,l,c,f){var d;K(this,t),d=e.call(this);var p=si(d);d._complex=i,d._mode=o;var m=i.getAtoms(),v=i.getTransforms();return i.forEachComponent(function(y){var S=[],_=0;if(y.forEachAtom(function(b){p._checkAtom(b,c)&&(S[_++]=b.index)}),_!==0){var x=new r(n,{atoms:m,chunks:S,parent:i},s,o,v,l,f);x._component=y,p.add(x)}}),d}return J(t,[{key:"_checkAtom",value:function(n,i){return n.mask&i}},{key:"getSubset",value:function(n,i){for(var s=[],o=this.children,l=0,c=0,f=o.length;c<f;++c)if(o[c].getSubset)for(var d=o[c].getSubset(n,i),p=0,m=d.length;p<m;++p){var v=d[p];v._component=o[c]._component,s[l++]=v}return s}}]),t}(Ps);function tz(a){var e=nz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function nz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rz=function(a){ve(t,a);var e=tz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_checkAtom",value:function(n,i){if(!(n.mask&i))return!1;for(var s=n.bonds,o=0,l=s.length;o<l;++o)if(s[o]._left.mask&i&&s[o]._right.mask&i)return!1;return!0}}]),t}(HS);function iz(a){var e=az();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function az(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var WS=function(a){ve(t,a);var e=iz(t);function t(r,n,i,s,o,l,c,f){var d;K(this,t),d=e.call(this);var p=si(d);d._complex=i;var m=i.getResidues(),v=i.getTransforms();return i.forEachComponent(function(y){var S=0,_=[];if(y.forEachResidue(function(b){p._checkResidue(b,c)&&(_[S++]=b._index)}),S!==0){var x=new r(n,{residues:m,chunks:_,parent:i},s,o,v,l,f);x._component=y,p.add(x)}}),d}return J(t,[{key:"checkResidue",value:function(n,i){return n._mask&i}},{key:"getSubset",value:function(n,i){for(var s=[],o=this.children,l=0,c=0,f=o.length;c<f;++c)if(o[c].getSubset)for(var d=o[c].getSubset(n,i),p=0,m=d.length;p<m;++p){var v=d[p];v._component=o[c]._component,s[l++]=v}return s}}]),t}(Ps);function sz(a){var e=oz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function oz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var lz=function(a){ve(t,a);var e=sz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_checkResidue",value:function(n,i){return i&n._mask&&n._cylinders!==null}}]),t}(WS);function cz(a){var e=uz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function uz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fz=function(a){ve(t,a);var e=cz(t);function t(r,n,i,s,o,l,c,f){var d;K(this,t),d=e.call(this);var p=si(d);d._complex=i;var m=i.getResidues(),v=i.getTransforms();return i.forEachComponent(function(y){for(var S=y.getMaskedSubdivSequences(c),_=0,x=[],b=0,M=S.length;b<M;++b)for(var E=S[b].arr,T=0,R=E.length;T<R;++T)for(var V=E[T].start,Y=E[T].end;V<=Y;++V)x[_++]=m[V]._index;if(_!==0){var $=new r(n,{residues:m,chunks:x,subdivs:S,parent:i},s,o,v,l,f);$._component=y,p.add($)}}),d}return J(t,[{key:"getSubset",value:function(n,i){for(var s=[],o=this.children,l=0,c=0,f=o.length;c<f;++c)if(o[c].getSubset)for(var d=o[c].getSubset(n,i),p=0,m=d.length;p<m;++p){var v=d[p];v._component=o[c]._component,s[l++]=v}return s}}]),t}(Ps);function hz(a){var e=dz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function dz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pz=function(a){ve(t,a);var e=hz(t);function t(r,n,i,s,o,l,c,f){var d;K(this,t),d=e.call(this);var p=si(d);d._complex=i;var m=i.getBonds(),v=i.getTransforms();return i.forEachComponent(function(y){var S=[],_=0;if(y.forEachBond(function(b){var M=b._left,E=b._right;!(M.mask&c)||!(E.mask&c)||(S[_++]=b._index)}),_!==0){var x=new r(n,{bonds:m,chunks:S,parent:i},s,o,v,l,f);x._component=y,p.add(x)}}),d}return J(t,[{key:"getSubset",value:function(n,i){for(var s=[],o=this.children,l=0,c=0,f=o.length;c<f;++c)if(o[c].getSubset)for(var d=o[c].getSubset(n,i),p=0,m=d.length;p<m;++p){var v=d[p];v._component=o[c]._component,s[l++]=v}return s}}]),t}(Ps);function mz(a){var e=vz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function vz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gz=function(a){ve(t,a);var e=mz(t);function t(r,n,i,s,o,l,c,f){var d;K(this,t),d=e.call(this);var p=si(d);d._complex=i;var m=i.getAtoms(),v=i.getTransforms();return o.showAromaticLoops()?(i.forEachComponent(function(y){var S=[],_=0,x=[],b=0;y.forEachCycle(function(E){for(var T=E.atoms,R=0,V=0,Y=T.length;V<Y;++V)T[V].mask&c&&(++R,S[_++]=T[V].index);R>0&&(x[b++]=E)});var M=new r(n,{cycles:x,atoms:m,chunks:S,parent:i},s,o,v,l,f);M._component=y,p.add(M)}),d):Me(d)}return J(t,[{key:"getSubset",value:function(n,i){for(var s=[],o=this.children,l=0,c=0,f=o.length;c<f;++c)if(o[c].getSubset)for(var d=o[c].getSubset(n,i),p=0,m=d.length;p<m;++p){var v=d[p];v._component=o[c]._component,s[l++]=v}return s}}]),t}(Ps),br={Atoms:HS,OrphanAtoms:rz,Residues:WS,Nucleic:lz,Subseqs:fz,Bonds:pz,Aromatic:gz};function Mr(a,e,t){return function(r,n,i,s,o,l){return new e(t,a,r,n,i,s,o,l)}}var _z=function(){function a(){K(this,a)}return J(a,null,[{key:"AtomsSpheres",value:function(t,r){var n=Sr.createSpheres(t,r);return Mr(n,br.Atoms,wr.AtomsSphereGroup)}},{key:"OrphanedAtomsCrosses",value:function(t,r,n){var i=Sr.createCrosses(t,r,n);return Mr(i,br.OrphanAtoms,wr.AtomsSphereGroup)}},{key:"BondsCylinders",value:function(t,r){var n=Sr.create2CCylinders(t,r);return Mr(n,br.Bonds,wr.BondsCylinderGroup)}},{key:"BondsLines",value:function(t,r,n){var i=Sr.create2CLines(t,r,n);return Mr(i,br.Bonds,wr.BondsLinesGroup)}},{key:"CartoonChains",value:function(t,r){var n=Sr.createExtrudedChains(t,r);return Mr(n,br.Subseqs,wr.ResiduesSubseqGroup)}},{key:"TraceChains",value:function(t,r){var n=Sr.create2CClosedCylinders(t,r);return Mr(n,br.Subseqs,wr.ResiduesTraceGroup)}},{key:"NucleicSpheres",value:function(t,r){var n=Sr.createSpheres(t,r);return Mr(n,br.Nucleic,wr.NucleicSpheresGroup)}},{key:"NucleicCylinders",value:function(t,r){var n=Sr.create2CCylinders(t,r);return Mr(n,br.Nucleic,wr.NucleicCylindersGroup)}},{key:"ALoopsTorus",value:function(t,r){var n=Sr.createExtrudedChains(t,r);return Mr(n,br.Aromatic,wr.AromaticTorusGroup)}},{key:"ALoopsLines",value:function(t,r,n){var i=Sr.createChunkedLines(t,r,n);return Mr(i,br.Aromatic,wr.AromaticLinesGroup)}},{key:"QuickSurfGeo",value:function(t,r,n){var i=Sr.createQuickSurface(t,r,n);return Mr(i,br.Atoms,wr.AtomsSurfaceGroup)}},{key:"ContactSurfaceGeo",value:function(t,r,n){var i=Sr.createContactSurface(t,r,n);return Mr(i,br.Atoms,wr.AtomsSurfaceGroup)}},{key:"SASSESSurfaceGeo",value:function(t,r,n){var i=Sr.createSASSES(t,r,n);return Mr(i,br.Atoms,wr.AtomsSASSESGroupStub)}},{key:"TextLabelsGeo",value:function(t,r){var n=Sr.createLabels(t,r);return Mr(n,br.Atoms,wr.AtomsTextGroup)}}]),a}(),Tr=function(){function a(e){if(K(this,a),this.constructor===a)throw new Error("Can not instantiate abstract class!");this.opts=xe.merge(ke.deriveDeep(this.settings.now.modes[this.id],!0),e)}return J(a,[{key:"identify",value:function(){var t=ke.objectsDiff(this.opts,this.settings.now.modes[this.id]);return xe.isEmpty(t)?this.id:[this.id,t]}},{key:"buildGeometry",value:function(t,r,n,i){for(var s=this.opts.polyComplexity?this.opts.polyComplexity[this.settings.now.resolution]:0,o=this.depGroups,l=o.length,c=new _t.RCGroup,f=this,d=0;d<l;++d){var p=o[d],m={};if(xe.isArray(p)){m=p[1].call(this);var v=p,y=pn(v,1);p=y[0]}var S=_z[p](null,this.settings,m),_=new S(t,r,f,s,n,i);_.children.length>0&&c.add(_)}return c}}]),a}();Sc(Tr.prototype);Tr.prototype.id="__";Tr.prototype.depGroups=[];function yz(a){var e=xz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function xz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sz(){return{lineWidth:this.opts.lineWidth}}var Ko=function(a){ve(t,a);var e=yz(t);function t(r){var n;K(this,t),n=e.call(this,r),n.depGroups=n.depGroups.slice(0);for(var i=n.depGroups,s=0,o=i.length;s<o;++s)i[s]=[i[s],Sz];return n}return J(t,[{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}},{key:"calcAtomRadius",value:function(){return this.opts.atom}},{key:"getAromaticOffset",value:function(){return this.opts.offsarom}},{key:"getAromaticArcChunks",value:function(){return this.opts.chunkarom}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}}]),t}(Tr);qe(Ko,"id","LN");Ko.prototype.id="LN";Ko.prototype.name="Lines";Ko.prototype.shortName="Lines";Ko.prototype.depGroups=["ALoopsLines","BondsLines","OrphanedAtomsCrosses"];function wz(a){var e=bz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function bz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Jo=function(a){ve(t,a);var e=wz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"calcAtomRadius",value:function(n){return this.opts.bond}},{key:"calcStickRadius",value:function(){return this.opts.bond}},{key:"calcSpaceFraction",value:function(){return this.opts.space}},{key:"getAromRadius",value:function(){return this.opts.aromrad}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}},{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}}]),t}(Tr);qe(Jo,"id","LC");Jo.prototype.id="LC";Jo.prototype.name="Licorice";Jo.prototype.shortName="Licorice";Jo.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];function Mz(a){var e=Ez();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Ez(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Qo=function(a){ve(t,a);var e=Mz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"calcAtomRadius",value:function(n){return n.element.radius*this.opts.atom}},{key:"calcStickRadius",value:function(){return this.opts.bond}},{key:"getAromRadius",value:function(){return this.opts.aromrad}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}},{key:"calcSpaceFraction",value:function(){return this.opts.space}},{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}}]),t}(Tr);qe(Qo,"id","BS");Qo.prototype.id="BS";Qo.prototype.name="Balls and Sticks";Qo.prototype.shortName="Balls";Qo.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];function Cz(a){var e=Az();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Az(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var el=function(a){ve(t,a);var e=Cz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"calcAtomRadius",value:function(n){return n.element.radius}}]),t}(Tr);qe(el,"id","VW");el.prototype.id="VW";el.prototype.name="Van der Waals";el.prototype.shortName="VDW";el.prototype.depGroups=["AtomsSpheres"];function Tz(a){var e=Rz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Rz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tl=function(a){ve(t,a);var e=Tz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"calcStickRadius",value:function(){return this.opts.radius}}]),t}(Tr);qe(tl,"id","TR");tl.prototype.id="TR";tl.prototype.name="Trace";tl.prototype.shortName="Trace";tl.prototype.depGroups=["TraceChains"];function Lz(a){var e=Pz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Pz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nl=function(a){ve(t,a);var e=Lz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getResidueRadius",value:function(n){return this.TUBE_RADIUS}},{key:"getHeightSegmentsRatio",value:function(){return this.opts.heightSegmentsRatio}},{key:"getTension",value:function(){return this.opts.tension}},{key:"buildGeometry",value:function(n,i,s,o){var l=this.opts.radius;return this.TUBE_RADIUS=new Pe(l,l),Tr.prototype.buildGeometry.call(this,n,i,s,o)}}]),t}(Tr);qe(nl,"id","TU");nl.prototype.id="TU";nl.prototype.name="Tube";nl.prototype.shortName="Tube";nl.prototype.depGroups=["CartoonChains"];function Iz(a){var e=Nz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Nz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rl=function(a){ve(t,a);var e=Iz(t);function t(r){var n;return K(this,t),n=e.call(this,r),n.secCache={},n}return J(t,[{key:"getResidueStartRadius",value:function(n){var i=n.getSecondary();if(!i||!i.generic)return this.TUBE_RADIUS;var s=this.secCache[i.generic];return s?i.term===n?s.start:s.center:this.TUBE_RADIUS}},{key:"getResidueEndRadius",value:function(n){var i=n.getSecondary();if(i===null||!i.generic)return this.TUBE_RADIUS;var s=this.secCache[i.generic];return s?i.term===n?this.ARROW_END:s.center:this.TUBE_RADIUS}},{key:"getResidueRadius",value:function(n,i){var s=this.getResidueStartRadius(n);if(i===0)return s;var o=this.getResidueEndRadius(n);return i===2?o:s.clone().lerp(o,i/2)}},{key:"calcStickRadius",value:function(n){return this.opts.radius}},{key:"getHeightSegmentsRatio",value:function(){return this.opts.heightSegmentsRatio}},{key:"getTension",value:function(){return this.opts.tension}},{key:"buildGeometry",value:function(n,i,s,o){var l=this.opts.radius,c=this.opts.depth;this.TUBE_RADIUS=new Pe(l,l),this.ARROW_END=new Pe(c,l);var f={},d=this.opts.ss;for(var p in d)f[p]={center:new Pe(c,d[p].width),start:new Pe(c,d[p].arrow)};return this.secCache=f,Tr.prototype.buildGeometry.call(this,n,i,s,o)}}]),t}(Tr);qe(rl,"id","CA");rl.prototype.id="CA";rl.prototype.name="Cartoon";rl.prototype.shortName="Cartoon";rl.prototype.depGroups=["CartoonChains","NucleicSpheres","NucleicCylinders"];function kz(a){var e=Oz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Oz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Dz=pt.selectors;function Fz(){return{wireframe:this.opts.wireframe,zClip:this.opts.zClip}}var bc=function(a){ve(t,a);var e=kz(t);function t(r){var n;K(this,t),n=e.call(this,r),n.depGroups=n.depGroups.slice(0);for(var i=n.surfaceNames,s=n.depGroups,o=0,l=i.length;o<l;++o)s[s.length]=[i[o],Fz];return n}return J(t,[{key:"calcAtomRadius",value:function(n){return n.element.radius}},{key:"getVisibilitySelector",value:function(){var n=null;if(this.opts.subset!==""){var i=Dz.parse(this.opts.subset);i.error||(n=i.selector)}return n}}]),t}(Tr);bc.prototype.isSurface=!0;bc.prototype.surfaceNames=[];function Bz(a){var e=zz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function zz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var il=function(a){ve(t,a);var e=Bz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getSurfaceOpts",value:function(){return{useBeads:!1,isoValue:this.opts.isoValue,gaussLim:this.opts.gaussLim[this.settings.now.resolution],radScale:this.opts.scale,gridSpacing:this.opts.gridSpacing[this.settings.now.resolution],zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}]),t}(bc);qe(il,"id","QS");il.prototype.id="QS";il.prototype.name="Quick Surface";il.prototype.shortName="Quick Surf";il.prototype.surfaceNames=["QuickSurfGeo"];function Vz(a){var e=Uz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Uz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ts=function(a){ve(t,a);var e=Vz(t);function t(r,n){var i;return K(this,t),i=e.call(this,n),i._excludeProbe=r,i}return J(t,[{key:"calcAtomRadius",value:function(n){return n.element.radius}},{key:"getSurfaceOpts",value:function(){return{gridSpacing:this.opts.polyComplexity[this.settings.now.resolution],radScale:this._radScale,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector(),probeRadius:this.opts.probeRadius,excludeProbe:this._excludeProbe}}}]),t}(bc);ts.prototype.id="SU";ts.prototype.name="Surface";ts.prototype.shortName="Surface";ts.prototype.surfaceNames=["SASSESSurfaceGeo"];ts.prototype._radScale=1;ts.prototype._excludeProbe=!1;function Gz(a){var e=Hz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Hz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mc=function(a){ve(t,a);var e=Gz(t);function t(r){return K(this,t),e.call(this,!1,r)}return J(t)}(ts);qe(Mc,"id","SA");Mc.prototype.id="SA";Mc.prototype.name="Solvent Accessible Surface";Mc.prototype.shortName="SAS";function Wz(a){var e=Xz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Xz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ec=function(a){ve(t,a);var e=Wz(t);function t(r){return K(this,t),e.call(this,!0,r)}return J(t)}(ts);qe(Ec,"id","SE");Ec.prototype.id="SE";Ec.prototype.name="Solvent Excluded Surface";Ec.prototype.shortName="SES";function Yz(a){var e=$z();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function $z(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ns=function(a){ve(t,a);var e=Yz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getSurfaceOpts",value:function(){return{probeRadius:this.opts.probeRadius,radScale:this.opts.polyComplexity[this.settings.now.resolution],scaleFactor:this.opts.polyComplexity[this.settings.now.resolution],gridSpacing:1/this.opts.polyComplexity[this.settings.now.resolution],isoValue:this.opts.isoValue,probePositions:this.opts.probePositions,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}]),t}(bc);qe(Ns,"id","CS");Ns.prototype.id="CS";Ns.prototype.name="Contact Surface";Ns.prototype.shortName="Contact Surf";Ns.prototype.isSurface=!0;Ns.prototype.surfaceNames=["ContactSurfaceGeo"];function qz(a){var e=Zz();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Zz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var al=function(a){ve(t,a);var e=qz(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getTemplateOptions",value:function(){return this.opts.template}},{key:"getLabelOpts",value:function(){return xe.merge(this.opts,{colors:!0,adjustColor:!0,transparent:!0})}}]),t}(Tr);qe(al,"id","TX");al.prototype.id="TX";al.prototype.name="Text mode";al.prototype.shortName="Text";al.prototype.depGroups=["TextLabelsGeo"];var Pf=new Is([Ko,Jo,Qo,el,tl,nl,rl,il,Mc,Ec,Ns,al]);function y1(a,e,t){return a<=t?a<0?0:a:t}function jz(a,e,t){var r=1-t,n=a>>16&255,i=a>>8&255,s=a&255,o=e>>16&255,l=e>>8&255,c=e&255,f=r*n+t*o,d=r*i+t*l,p=r*s+t*c;return f<<16|d<<8|p}var Cc=function(){function a(e,t){K(this,a),this.name=e||"Custom",this.id=t||"CP"}return J(a,[{key:"getElementColor",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.elementColors[t];return n===void 0&&!r?this.defaultElementColor:n}},{key:"getResidueColor",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.residueColors[t];return n===void 0&&!r?this.defaultResidueColor:n}},{key:"getChainColor",value:function(t){var r=t.charCodeAt(0);return r=((r<0?0:r>=256?r-256:r)&31)%this.chainColors.length,this.chainColors[r]}},{key:"getSecondaryColor",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.secondaryColors[t];return n===void 0&&!r?this.defaultSecondaryColor:n}},{key:"getSequentialColor",value:function(t){var r=this.colors,n=r.length;return t<0?r[t%n+n]:r[t%n]}},{key:"getGradientColor",value:function(t,r){var n=this.gradients[r];if(!n)return this.defaultNamedColor;var i=n.length,s=t*(i-1),o=Math.floor(s),l=y1(o+1,0,i-1);return o=y1(o,0,i-1),jz(n[o],n[l],s-o)}},{key:"getNamedColor",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.namedColors[t];return n===void 0&&!r?this.defaultNamedColor:n}}]),a}();xe.assign(Cc.prototype,{colors:[16777215,16711680,65280,255,8421504],minRangeColor:0,midRangeColor:8355711,maxRangeColor:16777215,defaultElementColor:16777215,elementColors:{},defaultResidueColor:16777215,residueColors:{},chainColors:[16777215],defaultSecondaryColor:16777215,secondaryColors:{},defaultGradientColor:0,defaultNamedColor:16777215,namedColorsArray:[["indianred",13458524],["lightcoral",15761536],["salmon",16416882],["darksalmon",15308410],["lightsalmon",16752762],["crimson",14423100],["red",16711680],["firebrick",11674146],["darkred",9109504],["pink",16761035],["lightpink",16758465],["hotpink",16738740],["deeppink",16716947],["mediumvioletred",13047173],["palevioletred",14381203],["coral",16744272],["tomato",16737095],["orangered",16729344],["darkorange",16747520],["orange",16753920],["gold",16766720],["yellow",16776960],["lightyellow",16777184],["lemonchiffon",16775885],["lightgoldenrodyellow",16448210],["papayawhip",16773077],["moccasin",16770229],["peachpuff",16767673],["palegoldenrod",15657130],["khaki",15787660],["darkkhaki",12433259],["lavender",15132410],["thistle",14204888],["plum",14524637],["violet",15631086],["orchid",14315734],["fuchsia",16711935],["magenta",16711935],["mediumorchid",12211667],["mediumpurple",9662683],["rebeccapurple",6697881],["blueviolet",9055202],["darkviolet",9699539],["darkorchid",10040012],["darkmagenta",9109643],["purple",8388736],["indigo",4915330],["slateblue",6970061],["mediumslateblue",8087790],["darkslateblue",4734347],["greenyellow",11403055],["chartreuse",8388352],["lawngreen",8190976],["lime",65280],["limegreen",3329330],["palegreen",10025880],["lightgreen",9498256],["mediumspringgreen",64154],["springgreen",65407],["mediumseagreen",3978097],["seagreen",3050327],["forestgreen",2263842],["green",32768],["darkgreen",25600],["yellowgreen",10145074],["olivedrab",7048739],["olive",8421376],["darkolivegreen",5597999],["mediumaquamarine",6737322],["darkseagreen",9419919],["lightseagreen",2142890],["darkcyan",35723],["teal",32896],["aqua",65535],["cyan",65535],["lightcyan",14745599],["paleturquoise",11529966],["aquamarine",8388564],["turquoise",4251856],["mediumturquoise",4772300],["darkturquoise",52945],["cadetblue",6266528],["steelblue",4620980],["lightsteelblue",11584734],["powderblue",11591910],["lightblue",11393254],["skyblue",8900331],["lightskyblue",8900346],["deepskyblue",49151],["dodgerblue",2003199],["cornflowerblue",6591981],["royalblue",4286945],["blue",255],["mediumblue",205],["darkblue",139],["navy",128],["midnightblue",1644912],["cornsilk",16775388],["blanchedalmond",16772045],["bisque",16770244],["navajowhite",16768685],["wheat",16113331],["burlywood",14596231],["tan",13808780],["rosybrown",12357519],["sandybrown",16032864],["goldenrod",14329120],["darkgoldenrod",12092939],["peru",13468991],["chocolate",13789470],["saddlebrown",9127187],["sienna",10506797],["brown",10824234],["maroon",8388608],["white",16777215],["snow",16775930],["honeydew",15794160],["mintcream",16121850],["azure",15794175],["aliceblue",15792383],["ghostwhite",16316671],["whitesmoke",16119285],["seashell",16774638],["beige",16119260],["oldlace",16643558],["floralwhite",16775920],["ivory",16777200],["antiquewhite",16444375],["linen",16445670],["lavenderblush",16773365],["mistyrose",16770273],["gainsboro",14474460],["lightgray",13882323],["silver",12632256],["darkgray",11119017],["gray",8421504],["dimgray",6908265],["lightslategray",7833753],["slategray",7372944],["darkslategray",3100495],["black",0]],namedColors:{},gradients:{rainbow:[255,65535,65280,16776960,16711680],temp:[255,32767,16777215,16744192,16711680],hot:[16777215,16744192,16711680],cold:[16777215,32767,255],"blue-red":[255,16777215,16711680],reds:[16777215,16711680],blues:[16777215,255]}});var XS=Cc.prototype,x1=XS.namedColorsArray,Kz=XS.namedColors;for(var Ip=0,Jz=x1.length;Ip<Jz;++Ip){var S1=pn(x1[Ip],2),Qz=S1[0],e6=S1[1];Kz[Qz]=e6}var YS=new Cc("CPK","CP");YS.elementColors={H:16777215,C:2105376,N:2121983,O:15605776,F:65280,P:8397055,S:16776960,CL:47872,FE:13684944,CO:13684944,NI:13684944,CU:13684944,BR:34816,I:21760};var na,ks=new Cc("Jmol","JM");ks.colors=[255,22015,44031,65535,65451,65365,65280,5635840,11271936,16776960,16755456,16733440,16711680,16711765,16711851,16711935,11206911,5570815];ks.elementColors={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:4366e3,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998};ks.defaultResidueColor=12492910;ks.residueColors={ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,A:10526975,C:16747595,G:16740464,I:8454143,T:10551200,U:16744576,DA:10526975,DC:16747595,DG:16740464,DI:8454143,DT:10551200,DU:16744576,"+A":10526975,"+C":16747595,"+G":16740464,"+I":8454143,"+T":10551200,"+U":16744576};ks.chainColors=[4294967295,4290826495,4289789872,4294951112,4294967168,4294951167,4289786096,4294955120,4293951616,4294303411,4278239231,4291648604,4284927402,4288335154,4293821166,4278243025,4278255487,4282168177,4278190219,4290623339,4278215680,4286578688,4286611456,4286578816,4278222976,4290283019,4289864226];var Gl=zn.Type;ks.secondaryColors=(na={},qe(na,Gl.HELIX_ALPHA,16711808),qe(na,Gl.HELIX_PI,6291584),qe(na,Gl.HELIX_310,10485888),qe(na,Gl.STRAND,16762880),qe(na,Gl.TURN,6324479),qe(na,"dna",11403518),qe(na,"rna",16580962),na);var Oa,ua=new Cc("VMD","VM");ua.colors=[255,16711680,6316128,16744448,16776960,8421427,10066329,65280,16777215,16751001,4243648,10879142,8447590,15099571,8408320,8421568];ua.defaultElementColor=8408320;ua.elementColors={H:16777215,C:4243391,N:255,O:16711680,P:8421427,S:16776960};ua.defaultResidueColor=4243648;ua.residueColors={ALA:255,ARG:16777215,ASN:8421427,ASP:16711680,CYS:16776960,GLN:16744448,GLU:16751001,GLY:16777215,HIS:4243648,ILE:65280,LEU:16751001,LYS:4243648,MET:16776960,PHE:10879142,PRO:8408064,SER:16776960,THR:15099571,TRP:10066329,TYR:65280,VAL:8421427,A:255,C:16744448,G:16776960,T:10879142,U:65280,DA:255,DC:16744448,DG:16776960,DT:10879142,DU:65280,"+A":255,"+C":16744448,"+G":16776960,"+T":10879142,"+U":65280,WAT:4243648,H2O:4243648,HOH:4243648};ua.chainColors=[16777215].concat(ua.colors);var Eo=zn.Type;ua.secondaryColors=(Oa={},qe(Oa,Eo.HELIX_ALPHA,10879142),qe(Oa,Eo.HELIX_310,255),qe(Oa,Eo.HELIX_PI,16711680),qe(Oa,Eo.STRAND,16776960),qe(Oa,Eo.BRIDGE,8421427),qe(Oa,Eo.TURN,4243648),Oa);var Ho=new Is([YS,ks,ua]),Pr=function(){function a(e){if(K(this,a),this.constructor===a)throw new Error("Can not instantiate abstract class!");this.opts=xe.merge(ke.deriveDeep(fe.now.colorers[this.id],!0),e),this.palette=Ho.first}return J(a,[{key:"identify",value:function(){var t=ke.objectsDiff(this.opts,fe.now.colorers[this.id]);return xe.isEmpty(t)?this.id:[this.id,t]}}]),a}();Pr.prototype.id="__";function t6(a){var e=n6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function n6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ac=function(a){ve(t,a);var e=t6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){var s=n.element.name;return s==="C"&&this.opts.carbon>=0?this.opts.carbon:this.palette.getElementColor(s)}},{key:"getResidueColor",value:function(n,i){return this.palette.defaultResidueColor}}]),t}(Pr);qe(Ac,"id","EL");Ac.prototype.id="EL";Ac.prototype.name="Element";Ac.prototype.shortName="Element";function r6(a){var e=i6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function i6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tc=function(a){ve(t,a);var e=r6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){return this.getResidueColor(n.residue,i)}},{key:"getResidueColor",value:function(n,i){return this.palette.getResidueColor(n._type._name)}}]),t}(Pr);qe(Tc,"id","RT");Tc.prototype.id="RT";Tc.prototype.name="Residue Type";Tc.prototype.shortName="Residue";function a6(a){var e=s6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function s6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Rc=function(a){ve(t,a);var e=a6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){return this.getResidueColor(n.residue,i)}},{key:"getResidueColor",value:function(n,i){var s=n._chain;if(s.minSequence===Number.POSITIVE_INFINITY&&s.maxSequence===Number.NEGATIVE_INFINITY)return this.palette.defaultNamedColor;var o=s.minSequence,l=s.maxSequence>o?s.maxSequence:o+1;return this.palette.getGradientColor((n._sequence-o)/(l-o),this.opts.gradient)}}]),t}(Pr);qe(Rc,"id","SQ");Rc.prototype.id="SQ";Rc.prototype.name="Sequence";Rc.prototype.shortName="Sequence";function o6(a){var e=l6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function l6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Lc=function(a){ve(t,a);var e=o6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){return this.getResidueColor(n.residue,i)}},{key:"getResidueColor",value:function(n,i){return this.palette.getChainColor(n.getChain()._name)}}]),t}(Pr);qe(Lc,"id","CH");Lc.prototype.id="CH";Lc.prototype.name="Chain";Lc.prototype.shortName="Chain";function c6(a){var e=u6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function u6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sl=function(a){ve(t,a);var e=c6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){return this.getResidueColor(n.residue,i)}},{key:"getResidueColor",value:function(n,i){if(n._type.flags&tt.Flags.DNA)return this.palette.getSecondaryColor("dna");if(n._type.flags&tt.Flags.RNA)return this.palette.getSecondaryColor("rna");var s=n.getSecondary();if(s){var o=this.palette.getSecondaryColor(s.type,!0);return o===void 0&&(o=this.palette.getSecondaryColor(s.generic)),o}return this.palette.defaultSecondaryColor}}]),t}(Pr);qe(sl,"id","SS");sl.prototype.id="SS";sl.prototype.name="Secondary Structure";sl.prototype.shortName="Structure";function f6(a){var e=h6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function h6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Pc=function(a){ve(t,a);var e=f6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){return this.opts.color}},{key:"getResidueColor",value:function(n,i){return this.opts.color}}]),t}(Pr);qe(Pc,"id","UN");Pc.prototype.id="UN";Pc.prototype.name="Uniform";Pc.prototype.shortName="Uniform";function d6(a){var e=p6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function p6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ic=function(a){ve(t,a);var e=d6(t);function t(r){var n;K(this,t),n=e.call(this,r);var i=un.parse(n.opts.subset);return n._subsetCached=i.error?un.none():i.selector,n}return J(t,[{key:"getAtomColor",value:function(n,i){return this._subsetCached.includesAtom(n)?this.opts.color:this.opts.baseColor}},{key:"getResidueColor",value:function(n,i){for(var s=this._subsetCached,o=n._atoms,l=0,c=o.length;l<c;++l)if(!s.includesAtom(o[l]))return this.opts.baseColor;return this.opts.color}}]),t}(Pr);qe(Ic,"id","CO");Ic.prototype.id="CO";Ic.prototype.name="Conditional";Ic.prototype.shortName="Conditional";function m6(a){var e=v6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function v6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Nc=function(a){ve(t,a);var e=m6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){return this.palette.getChainColor(String.fromCharCode(n.location))}},{key:"getResidueColor",value:function(n,i){return this.palette.defaultResidueColor}}]),t}(Pr);qe(Nc,"id","CF");Nc.prototype.id="CF";Nc.prototype.name="Conformation";Nc.prototype.shortName="Conformation";function g6(a){var e=_6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function _6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kc=function(a){ve(t,a);var e=g6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){var s=this.opts,o=1;return n.temperature&&s?(s.min===s.max?o=n.temperature>s.max?1:0:o=(n.temperature-s.min)/(s.max-s.min),this.palette.getGradientColor(o,s.gradient)):this.palette.defaultGradientColor}},{key:"getResidueColor",value:function(n,i){var s=this.opts;if(!s)return this.palette.defaultGradientColor;if(n.temperature){var o=0;return s.min===s.max?o=n.temperature>s.max?1:0:o=(n.temperature-s.min)/(s.max-s.min),this.palette.getGradientColor(o,s.gradient)}return this.palette.defaultGradientColor}}]),t}(Pr);qe(kc,"id","TM");kc.prototype.id="TM";kc.prototype.name="Temperature";kc.prototype.shortName="Temperature";function y6(a){var e=x6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function x6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Oc=function(a){ve(t,a);var e=y6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_getColorByOccupancy",value:function(n,i){if(n!==void 0){var s=1-n;return this.palette.getGradientColor(s,i.gradient)}return this.palette.defaultGradientColor}},{key:"getAtomColor",value:function(n,i){var s=this.opts;return this._getColorByOccupancy(n.occupancy,s)}},{key:"getResidueColor",value:function(n,i){var s=this.opts;return this._getColorByOccupancy(n.occupancy,s)}}]),t}(Pr);qe(Oc,"id","OC");Oc.prototype.id="OC";Oc.prototype.name="Occupancy";Oc.prototype.shortName="Occupancy";function S6(a){var e=w6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function w6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Dc=function(a){ve(t,a);var e=S6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){return this.getResidueColor(n.residue,i)}},{key:"getResidueColor",value:function(n,i){var s=this.palette.defaultResidueColor;if(n._type.hydrophobicity!==void 0){var o=-4.5,l=4.5;s=this.palette.getGradientColor((n._type.hydrophobicity-o)/(l-o),this.opts.gradient)}return s}}]),t}(Pr);qe(Dc,"id","HY");Dc.prototype.id="HY";Dc.prototype.name="Hydrophobicity";Dc.prototype.shortName="Hydrophobicity";function b6(a){var e=M6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function M6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Fc=function(a){ve(t,a);var e=b6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){return this.getResidueColor(n.residue,i)}},{key:"getResidueColor",value:function(n,i){var s=n._molecule,o=i.getMoleculeCount();return o>1?this.palette.getGradientColor((s.index-1)/(o-1),this.opts.gradient):this.palette.getGradientColor(0,this.opts.gradient)}}]),t}(Pr);qe(Fc,"id","MO");Fc.prototype.id="MO";Fc.prototype.name="Molecule";Fc.prototype.shortName="Molecule";function E6(a){var e=C6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function C6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A6(a,e){var t=a>>16&255,r=a>>8&255,n=a&255,i=e*t,s=e*r,o=e*n;return i<<16|s<<8|o}var Bc=function(a){ve(t,a);var e=E6(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"getAtomColor",value:function(n,i){var s=this.opts.color,o=A6(s,this.opts.factor);return n.flags&Si.Flags.CARBON?s:o}},{key:"getResidueColor",value:function(n,i){return this.opts.color}}]),t}(Pr);qe(Bc,"id","CB");Bc.prototype.id="CB";Bc.prototype.name="Carbon";Bc.prototype.shortName="Carbon";var If=new Is([Ac,Tc,Rc,Lc,sl,Pc,Ic,Nc,kc,Oc,Dc,Fc,Bc]);function Bn(a){return new nt(a,a,a)}var T6=[{id:"DF",name:"Diffuse",shortName:"Diffuse",uberOptions:{diffuse:Bn(1),specular:Bn(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"SF",name:"Soft Plastic",shortName:"Soft",uberOptions:{diffuse:Bn(1),specular:Bn(.1),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"PL",name:"Glossy Plastic",shortName:"Glossy",uberOptions:{diffuse:Bn(.56),specular:Bn(.28),shininess:100,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"ME",name:"Metal",shortName:"Metal",uberOptions:{diffuse:Bn(.56),specular:Bn(.55),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"TR",name:"Transparent",shortName:"Transparent",uberOptions:{diffuse:Bn(1),specular:Bn(0),shininess:1,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"GL",name:"Glass",shortName:"Glass",uberOptions:{diffuse:Bn(.5),specular:Bn(.65),shininess:100,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"BA",name:"Backdrop",shortName:"Backdrop",uberOptions:{diffuse:Bn(1),specular:Bn(0),shininess:1,opacity:1},values:{lights:!1,fog:!1,depthWrite:!1,transparent:!1,toonShading:!1}},{id:"TN",name:"Toon",shortName:"Toon",uberOptions:{diffuse:Bn(1),specular:Bn(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!0}},{id:"FL",name:"Flat",shortName:"Flat",uberOptions:{diffuse:Bn(1),specular:Bn(0),shininess:0,opacity:1},values:{lights:!1,fog:!0,depthWrite:!0,transparent:!1}}],zo=new Is(T6);function R6(a,e){var t=[];return a.traverse(function(r){for(var n=0;n<e.length;n++)if(r instanceof e[n]){t[t.length]=r;break}}),t}function av(a,e,t){var r=a.material.createInstance();r.setValues(e);var n=new a.constructor(a.geometry,r);return n.material.needsUpdate=!0,n.applyMatrix4(a.matrix),n.layers.set(t),n}function zc(a,e,t){for(var r=R6(a,e),n=0,i=r.length;n<i;++n){var s=r[n];s.parent&&t(s)}}function L6(a,e){var t=e.length;if(!(t<1)){var r=[Ut,$r,Ts];zc(a,r,function(n){n.applyMatrix4(e[0]);for(var i=1;i<t;++i){var s=new n.constructor(n.geometry,n.material);n.parent.add(s),s.applyMatrix4(e[i])}})}}var P6=function(){var a={prepassTransparancy:!0,fakeOpacity:!1,transparent:!1,colorFromDepth:!1,lights:!1,shadowmap:!1,fog:!1};return function(e,t){t instanceof Fi&&zc(e,[Ut,$r],function(r){r.material.setValues({prepassTransparancy:!1,fakeOpacity:!1}),r.material.needsUpdate=!0,r.layers.set(_t.LAYERS.TRANSPARENT);var n=av(r,a,_t.LAYERS.PREPASS_TRANSPARENT);r.parent.add(n)})}}(),I6=function(){var a={colorFromPos:!0,transparent:!1,colorFromDepth:!1,lights:!1,shadowmap:!1,fog:!1,overrideColor:!1,fogTransparent:!1,attrColor:!1,attrColor2:!1,attrAlphaColor:!1,fakeOpacity:!1};return function(e,t){t instanceof Fi&&zc(e,[Ut,$r],function(r){var n=av(r,a,_t.LAYERS.COLOR_FROM_POSITION);r.parent.add(n)})}}(),N6=function(){var a={colorFromDepth:!0,orthoCam:!0,lights:!1,shadowmap:!1,fog:!1};return function(e,t){t instanceof Fi&&zc(e,[Ut,$r],function(r){if(!r.receiveShadow&&r.material.shadowmap&&r.material.setValues({shadowmap:!1}),!!r.material.lights&&r.castShadow&&_t.belongToSelectLayers(r)){var n=av(r,a,_t.LAYERS.SHADOWMAP);n.isShadowmapMesh=!0,r.parent.add(n)}})}}();function k6(a,e){e instanceof Fi&&zc(a,[Ut,$r],function(t){t.isShadowmapMesh&&t.parent.remove(t)})}function $S(a,e){function t(r){r instanceof Ut&&e(r);for(var n=0,i=r.children.length;n<i;n++)t(r.children[n])}t(a)}function O6(a){var e=a.geometry;if(e instanceof Za){var t=e.attributes;for(var r in t)if(t.hasOwnProperty(r)&&t[r]instanceof Er){var n=t[r],i=e.index?e.index.array.length/3:0;return i*n.array.length/n.itemSize}return 0}return e instanceof It?e.index?e.index.array.length/3:0:e.faces?e.faces.length:0}function D6(a){var e=0;return $S(a,function(t){e+=O6(t)}),e}var Vo={applyTransformsToMeshes:L6,processTransparentMaterial:P6,processColFromPosMaterial:I6,createShadowmapMaterial:N6,removeShadowmapMaterial:k6,forEachMeshInGroup:$S,countTriangles:D6},F6=pt.selectors,fm=function(){function a(e,t,r,n){K(this,a);var i={clipPlane:fe.now.draft.clipPlane,fogTransparent:fe.now.bg.transparent,shadowmap:fe.now.shadow.on,shadowmapType:fe.now.shadow.type};this.index=e,this.mode=t,this.colorer=r,this.selector=n,this.selectorString="",this.count=0,this.material=new Fi,this.material.setValues(i),this.material.setUberOptions({fogAlpha:fe.now.fogAlpha}),this.materialPreset=zo.first,this.needsRebuild=!0,this.visible=!0,this.setMode(t)}return J(a,[{key:"markAtoms",value:function(t){return this.count=t.markAtoms(this.selector,1<<this.index),this.needsRebuild=!0,this.count}},{key:"unmarkAtoms",value:function(t){t.clearAtomBits(1<<this.index),this.count=0}},{key:"setMode",value:function(t){this.mode=t}},{key:"setMaterialPreset",value:function(t){this.materialPreset=t,this.material.setUberOptions(t.uberOptions),this.material.setValues(t.values)}},{key:"reset",value:function(){this.geo=null,this.selectionGeo=null}},{key:"buildGeometry",value:function(t){return this.reset(),this.needsRebuild=!1,fe.now.ao&&this.material.setValues({normalsToGBuffer:fe.now.ao}),this.geo=this.mode.buildGeometry(t,this.colorer,1<<this.index,this.material),this.material.uberOptions.opacity<.99&&fe.now.transparency==="prepass"&&Vo.processTransparentMaterial(this.geo,this.material),this.geo.visible=this.visible,_t.processObjRenderOrder(this.geo,this.materialPreset.id),Vo.processColFromPosMaterial(this.geo,this.material),fe.now.shadow.on&&Vo.createShadowmapMaterial(this.geo,this.material),this.geo}},{key:"buildSelectionGeometry",value:function(t){var r=null;if(this.geo&&"getSubset"in this.geo){var n=this.geo.getSubset(t);if(n&&n.length>0){r=new nr,r.matrixAutoUpdate=!1,r.matrix=this.geo.matrix;for(var i=0;i<n.length;i++){var s=n[i];r.add(s)}}}return r&&(r.visible=this.visible),this.selectionGeo=r,this.selectionGeo}},{key:"compare",value:function(t){var r={},n=String(this.selector);(!t||n.valueOf()!==String(t.selector).valueOf())&&(r.selector=n);var i=this.mode.identify();(!t||Array.isArray(i)||i!==t.mode)&&(r.mode=i);var s=this.colorer.identify();return(!t||Array.isArray(s)||s!==t.colorer)&&(r.colorer=s),(!t||this.materialPreset.id!==t.material)&&(r.material=this.materialPreset.id),r}},{key:"change",value:function(t,r,n,i){var s={};if(t.selector){var o=F6.parse(t.selector).selector,l=String(o);this.selectorString!==l&&(s.selector=l,this.selectorString=l,this.selector=o,this.markAtoms(r))}if(t.mode){var c=t.mode;xe.isEqual(this.mode.identify(),c)||(s.mode=c,this.setMode(n))}if(t.colorer){var f=t.colorer;xe.isEqual(this.colorer.identify(),f)||(s.colorer=f,this.colorer=i)}if(t.material){var d=t.material;xe.isEqual(this.materialPreset.id,d)||(s.material=d,this.setMaterialPreset(zo.get(t.material)))}return s}},{key:"show",value:function(t){this.visible=t,this.geo&&(this.geo.visible=t),this.selectionGeo&&(this.selectionGeo.visible=t)}}]),a}();function qS(a){var e=B6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function B6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ZS(a,e,t){var r=a.children;if(r)for(var n=0,i=r.length;n<i;++n){var s=r[n];s._component===e&&t(s),s instanceof _t.RCGroup&&ZS(s,e,t)}}function jS(){}var z6=function(a){ve(t,a);var e=qS(t);function t(r){var n;return K(this,t),n=e.call(this),n._complexVisual=r,n._inProgress=!1,n}return J(t,[{key:"begin",value:function(){var n=this._complexVisual.getComplex();this._componentTransforms=[];for(var i=0;i<n._components.length;++i){var s=n._components[i];this._componentTransforms[s._index]=new Dt}return this._inProgress=!0,!0}},{key:"apply",value:function(){if(this._inProgress){for(var n=this._complexVisual.getComplex(),i=0;i<n._components.length;++i)this._bakeComponentTransform(n._components[i]);n.onAtomPositionChanged(),this._resetComponentTransform(),this._complexVisual.finalizeEdit()}}},{key:"discard",value:function(){this._inProgress&&(this._resetComponentTransform(),this._complexVisual.finalizeEdit())}},{key:"getAltObj",value:function(){var n={objects:[],pivot:new C(0,0,0)},i=this._complexVisual,s=i.getSelectedComponent();if(s===null)return n;var o=this._complexVisual.getSelectionGeo(),l=1<<i.getSelectionBit(),c,f,d,p;for(ZS(i,s,function(y){n.objects.push(y)}),c=0;c<o.children.length;++c)for(d=o.children[c],f=0;f<d.children.length;++f)p=d.children[f],p.hasOwnProperty("_component")&&p._component===s&&n.objects.push(p);n.objects.push(this._componentTransforms[s._index]);var m=new C(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new C(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return s.forEachResidue(function(y){var S=y._atoms;for(f=0;f<S.length;++f)S[f].mask&l&&(m.min(S[f].position),v.max(S[f].position))}),n.pivot.lerpVectors(m,v,.5),n}},{key:"_bakeComponentTransform",value:function(n){var i=this._componentTransforms[n._index];i&&(!(i.position.x===0&&i.position.y===0&&i.position.z===0)||!(i.quaternion.x===0&&i.quaternion.y===0&&i.quaternion.z===0&&i.quaternion.w===1))&&(i.updateMatrix(),n.forEachResidue(function(s){for(var o=s._atoms,l=0;l<o.length;++l)o[l].position.applyMatrix4(i.matrix)}))}},{key:"_resetComponentTransform",value:function(){var n=this._complexVisual,i=this._complexVisual.getSelectionGeo(),s,o,l,c;for(s=0;s<this._componentTransforms.length;++s)c=this._componentTransforms[s],c.position.set(0,0,0),c.quaternion.set(0,0,0,1);for(s=0;s<n.children.length;++s)for(l=n.children[s],o=0;o<l.children.length;++o)c=l.children[o],c.hasOwnProperty("_component")&&(c.position.set(0,0,0),c.quaternion.set(0,0,0,1));for(s=0;s<i.children.length;++s)for(l=i.children[s],o=0;o<l.children.length;++o)c=l.children[o],c.hasOwnProperty("_component")&&(c.position.set(0,0,0),c.quaternion.set(0,0,0,1))}}]),t}(jS),V6=function(a){ve(t,a);var e=qS(t);function t(r){var n;return K(this,t),n=e.call(this),n._complexVisual=r,n._inProgress=!1,n}return J(t,[{key:"begin",value:function(){var n=this._complexVisual,i=this._complexVisual.getSelectionGeo(),s=this._getSelectionBorderAtoms();if(s.length<1||s.length>2)return kn.error("Can only edit fragments with one or two bound atoms."),!1;this._fragmentBoundAtoms=s;var o=1<<n.getSelectionBit();n.disableSubset(o,!0);for(var l=0;l<i.children.length;++l)i.children[l].visible=!1;var c=s[0].position.clone();s.length===2&&c.lerp(s[1].position,.5),this._fragmentGeo=new nr,n.add(this._fragmentGeo),this._fragmentGeo.position.copy(c),this._fragmentSelectionGeo=new nr,i.add(this._fragmentSelectionGeo),this._fragmentSelectionGeo.position.copy(c);var f=c.clone();f.negate();for(var d=0;d<n.children.length;++d){var p=n.children[d];if("getSubset"in p){var m=new nr;this._fragmentGeo.add(m);var v=new nr;this._fragmentSelectionGeo.add(v);for(var y=p.getSubset(o,!0),S=0;S<y.length;S++){var _=y[S];m.add(_),_.position.copy(f)}for(var x=p.getSubset(o,!0),b=0;b<x.length;b++){var M=x[b];v.add(M),M.position.copy(f)}}}return _t.applySelectionMaterial(this._fragmentSelectionGeo),this._inProgress=!0,!0}},{key:"apply",value:function(){if(this._inProgress){var n=this._complexVisual,i=n.getSelectionBit(),s=this._fragmentGeo.position,o=this._fragmentGeo.matrix.clone();o.multiply(new Xe().makeTranslation(-s.x,-s.y,-s.z)),this._bakeAtomTransform(o,1<<i),n.enableSubset(1<<i,!0),n.getComplex().onAtomPositionChanged(),n.finalizeEdit()}}},{key:"discard",value:function(){if(this._inProgress){var n=this._complexVisual,i=this._complexVisual.getSelectionGeo();this._fragmentGeo.parent.remove(this._fragmentGeo),n.enableSubset(1<<n.getSelectionBit(),!0);for(var s=0;s<i.children.length;++s){var o=i.children[s];o.visible?i.remove(o):o.visible=!0}n.finalizeEdit()}}},{key:"isFreeRotationAllowed",value:function(){return this._fragmentBoundAtoms.length<2}},{key:"getAltObj",value:function(){var n={objects:[],pivot:new C(0,0,0)};n.objects.push(this._fragmentGeo,this._fragmentSelectionGeo);var i=this._fragmentBoundAtoms;if(i.length===1){if(i[0].bonds.length===1){var s=i[0].bonds[0];n.axis=new C().subVectors(s._right.position,s._left.position),n.axis.normalize(),n.axis.transformDirection(this._complexVisual.matrixWorld)}}else i.length===2&&(n.axis=new C().subVectors(i[1].position,i[0].position),n.axis.normalize(),n.axis.transformDirection(this._complexVisual.matrixWorld));return n}},{key:"_getSelectionBorderAtoms",value:function(){var n=this._complexVisual.getComplex(),i=1<<this._complexVisual.getSelectionBit(),s={};n.forEachBond(function(p){p._left.mask&i?p._right.mask&i||(s[p._left.index]=1):p._right.mask&i&&(s[p._right.index]=1)});for(var o=[],l=Object.keys(s),c=0,f=l.length;c<f;++c){var d=l[c];o.push(n._atoms[d])}return o}},{key:"_bakeAtomTransform",value:function(n,i){this._complexVisual.getComplex().forEachAtom(function(s){s.mask&i&&s.position.applyMatrix4(n)})}}]),t}(jS),w1={ComponentEditor:z6,FragmentEditor:V6};function U6(a){var e=G6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function G6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cr=pt.selectors;function Co(a,e){Array.isArray(e)||(e=[e]);var t=e,r=pn(t,2),n=r[0],i=r[1],s=a.get(n)||a.first;return new s(i)}var Pi=function(a){ve(t,a);var e=U6(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._complex=n,i._reprList=[],i._repr=null,i._reprListChanged=!0,i._selectionBit=0,i._reprUsedBits=0,i._selectionCount=0,i._selectionGeometry=new nr,i}return J(t,[{key:"getBoundaries",value:function(){return this._complex.getBoundaries()}},{key:"release",value:function(){this._selectionGeometry.parent&&this._selectionGeometry.remove(this._selectionGeometry),dc.prototype.release.call(this)}},{key:"getComplex",value:function(){return this._complex}},{key:"getSelectionCount",value:function(){return this._selectionCount}},{key:"getSelectionGeo",value:function(){return this._selectionGeometry}},{key:"getSelectionBit",value:function(){return this._selectionBit}},{key:"getEditor",value:function(){return this._editor}},{key:"resetReps",value:function(n){this._complex&&this._complex.clearAtomBits(-1),this._reprListChanged=!0,this._reprUsedBits=0,this._reprList.length=n.length;for(var i=0,s=n.length;i<s;++i){var o=n[i],l=void 0,c=void 0;if(typeof o.selector=="string"){c=o.selector;var f=cr.parse(c);l=f.selector}else if(typeof o.selector>"u"){c=fe.now.presets.default[0].selector;var d=cr.parse(c);l=d.selector}else l=o.selector,c=l.toString();var p=Co(Pf,o.mode),m=Co(If,o.colorer),v=zo.get(o.material)||zo.first;this._reprList[i]=new fm(i,p,m,l),this._reprList[i].setMaterialPreset(v),this._reprList[i].selectorString=c,this._complex&&this._complex.markAtoms(l,1<<i),this._reprUsedBits|=1<<i}this._repr=n.length>0?this._reprList[0]:null,this._selectionBit=n.length,this._reprUsedBits|=1<<this._selectionBit,this._selectionCount=0,this._complex&&this._complex.update()}},{key:"repCount",value:function(){return this._reprList.length}},{key:"repCurrent",value:function(n){return n>=0&&n<this._reprList.length?this._repr=this._reprList[n]:n=this._reprList.indexOf(this._repr),n}},{key:"rep",value:function(n,i){if(!i&&(n===void 0||n instanceof Object)&&(i=n,n=this.repCurrent()),n<0||n>this._reprList.length)return kn.error("Rep ".concat(n," does not exist!")),null;if(n===this._reprList.length){var s=this.repAdd(i);return kn.warn("Rep ".concat(n," does not exist! New representation was created.")),{desc:s.desc,index:n,status:"created"}}var o=this._reprList[n],l={selector:o.selectorString,mode:o.mode.identify(),colorer:o.colorer.identify(),material:o.materialPreset.id};if(i){var c=o.change(i,this._complex,Co(Pf,i.mode),Co(If,i.colorer));if(!xe.isEmpty(c)){o.needsRebuild=!0;for(var f in c)c.hasOwnProperty(f)&&(l[f]=c[f],kn.debug("rep[".concat(n,"].").concat(f," changed to ").concat(c[f])));return c.mode&&o.mode.isSurface&&(fe.now.resolution==="ultra"||fe.now.resolution==="high")&&(kn.report('Surface resolution was changed to "medium" to avoid hang-ups.'),fe.set("resolution","medium")),{desc:l,index:n,status:"changed"}}}return{desc:l,index:n,status:""}}},{key:"repGet",value:function(n){return(n===void 0||n instanceof Object)&&(n=this.repCurrent()),n<0||n>=this._reprList.length?null:this._reprList[n]}},{key:"_getFreeReprIdx",value:function(){for(var n=this._reprUsedBits,i=0;i<=t.NUM_REPRESENTATION_BITS;++i,n>>=1)if(!(n&1))return i;return-1}},{key:"repAdd",value:function(n){if(this._reprList.length>=t.NUM_REPRESENTATION_BITS)return null;var i=this._getFreeReprIdx();if(i<0)return null;var s=this.buildSelectorFromMask(1<<this._selectionBit),o=fe.now.presets.default[0],l=xe.merge({selector:o.selector,mode:o.mode,colorer:o.colorer,material:o.material},n),c=typeof l.selector=="string"?cr.parse(l.selector).selector:l.selector,f=new fm(this._selectionBit,Co(Pf,l.mode),Co(If,l.colorer),c);return f.selectorString=c.toString(),f.setMaterialPreset(zo.get(l.material)),f.markAtoms(this._complex),this._reprList.push(f),this._selectionBit=i,this._reprUsedBits|=1<<this._selectionBit,this._complex.markAtoms(s,1<<this._selectionBit),{desc:l,index:this._reprList.length-1}}},{key:"repRemove",value:function(n){n===void 0&&(n=this.repCurrent());var i=this._reprList.length;if(!(n<0||n>=i||i<=1)){var s=this._reprList[n];s.unmarkAtoms(this._complex),this._reprUsedBits&=~(1<<s.index),this._reprList.splice(n,1),s===this._repr&&(--i,n=n<i?n:i-1,this._repr=this._reprList[n]),this._reprListChanged=!0}}},{key:"repHide",value:function(n,i){if(i===void 0&&(i=!0),!(n<0||n>=this._reprList.length)){var s=this._reprList[n];s.show(!i)}}},{key:"select",value:function(n,i){i?this._selectionCount+=this._complex.markAtomsAdditionally(n,1<<this._selectionBit):this._selectionCount=this._complex.markAtoms(n,1<<this._selectionBit),this._complex.updateStructuresMask(),this.rebuildSelectionGeometry()}},{key:"resetSelectionMask",value:function(){this._selectionCount!==0&&(this._selectionCount=0,this._complex&&this._complex.clearAtomBits(1<<this._selectionBit))}},{key:"updateSelectionMask",value:function(n){var i=this,s=n.atom,o=n.residue,l=n.chain,c=n.molecule,f=1<<this._selectionBit,d=~f;if(s)o=s.residue,l=o._chain,c=o._molecule,s.mask&f?(s.mask&=d,o._mask&=d,l._mask&=d,c&&(c.mask&=d),this._selectionCount--):(s.mask|=f,this._selectionCount++,o.collectMask(),l.collectMask(),c&&c.collectMask());else if(o)l=o._chain,c=o._molecule,o._mask&f?(o._mask&=d,l._mask&=d,o.forEachAtom(function(m){m.mask&f&&(m.mask&=d,i._selectionCount--)})):(o._mask|=f,o.forEachAtom(function(m){m.mask&f||(m.mask|=f,i._selectionCount++)}),l.collectMask(),c&&c.collectMask());else if(l||c){var p=l||c;p._mask&f?(p._mask&=d,p.forEachResidue(function(m){m._mask&f&&(m._mask&=d,m.forEachAtom(function(v){v.mask&f&&(v.mask&=d,i._selectionCount--)}),m._mask&=d)})):(p._mask|=f,p.forEachResidue(function(m){if(!(m._mask&f)){m._mask|=f,m.forEachAtom(function(y){y.mask&f||(y.mask|=f,i._selectionCount++)});var v=l?m.getMolecule():m.getChain();v&&v.collectMask()}}))}else this.resetSelectionMask()}},{key:"expandSelection",value:function(){var n=this,i=1<<this._selectionBit,s=1<<31;this._complex.forEachBond(function(l){l._left.mask&i?l._right.mask&i||(l._right.mask|=s):l._right.mask&i&&(l._left.mask|=s)});var o=~s;this._complex.forEachAtom(function(l){l.mask&s&&(l.mask=l.mask&o|i,++n._selectionCount)}),this._complex.updateStructuresMask()}},{key:"shrinkSelection",value:function(){var n=this,i=1<<this._selectionBit,s=1<<31;this._complex.forEachBond(function(l){l._left.mask&i?l._right.mask&i||(l._left.mask|=s):l._right.mask&i&&(l._right.mask|=s)}),this._complex.forEachAtom(function(l){l.mask&i&&l.bonds.length===1&&(l.mask|=s)});var o=~(i|s);this._complex.forEachAtom(function(l){l.mask&s&&(l.mask&=o,--n._selectionCount)}),this._complex.updateStructuresMask()}},{key:"getSelectedComponent",value:function(){var n=1<<this._selectionBit,i=null,s=!1;return this._complex.forEachAtom(function(o){o.mask&n&&(i===null?i=o.residue._component:i!==o.residue._component&&(s=!0))}),s?null:i}},{key:"getSelectionCenter",value:function(n,i,s){n.set(0,0,0);var o=0;return this._complex.forEachAtom(function(l){i(l,s)&&(n.add(l.position),o++)}),o===0?!1:(n.divideScalar(o),n.applyMatrix4(this.matrix),!0)}},{key:"needsRebuild",value:function(){if(this._reprListChanged)return!0;for(var n=this._reprList,i=0,s=n.length;i<s;++i){var o=n[i];if(o.needsRebuild)return!0}return!1}},{key:"rebuild",value:function(){var n=this;return _t.clearTree(this),new Promise(function(i){var s=n._complex;if(!s){i();return}var o=!1;setTimeout(function(){console.time("build");for(var l=n._reprList,c=Ho.get(fe.now.palette)||Ho.first,f=!1,d=0,p=l.length;d<p;++d){var m=l[d];if(m.colorer.palette=c,m.needsRebuild){m.reset();try{m.buildGeometry(s)}catch(v){if(v instanceof ke.OutOfMemoryError)m.needsRebuild=!1,m.reset(),kn.error("Not enough memory to build geometry for representation ".concat(m.index+1)),o=!0;else throw v}}f=o||f||_t.groupHasGeometryToRender(m.geo),m.geo&&n.add(m.geo)}n._reprListChanged=!1,console.timeEnd("build"),i()},10)})}},{key:"setNeedsRebuild",value:function(){for(var n=this._reprList,i=0,s=n.length;i<s;++i)n[i].needsRebuild=!0}},{key:"rebuildSelectionGeometry",value:function(){var n=1<<this._selectionBit;_t.clearTree(this._selectionGeometry);for(var i=0,s=this._reprList.length;i<s;++i){var o=this._reprList[i],l=o.buildSelectionGeometry(n);if(l){this._selectionGeometry.add(l);for(var c=0;c<l.children.length;c++){var f=l.children[c];if(this._editor&&this._editor._componentTransforms){var d=this._editor._componentTransforms[f._component._index];d&&(f.position.copy(d.position),f.quaternion.copy(d.quaternion))}}_t.applySelectionMaterial(l)}}}},{key:"_buildSelectorFromSortedLists",value:function(n,i,s){var o=this._complex;function l(p){for(var m=[],v=0,y=NaN,S=NaN,_=0,x=p.length;_<x;++_){var b=p[_];b===S+1?S=b:(Number.isNaN(y)||(m[v++]=new cr.Range(y,S)),y=S=b)}return Number.isNaN(y)||(m[v]=new cr.Range(y,S)),m}var c=null;if(s.length===o._chains.length)c=cr.all();else{var f;if(s.length>0&&(f=cr.chain(s),c=c?cr.or(c,f):f),Object.keys(i).length>0)for(var d in i)i.hasOwnProperty(d)&&(f=cr.and(cr.chain(d),cr.residx(l(i[d]))),c=c?cr.or(c,f):f);n.length>0&&(f=cr.serial(l(n)),c=c?cr.or(c,f):f),c||(c=cr.none())}return c}},{key:"buildSelectorFromMask",value:function(n){var i=this._complex,s=[],o={},l=[];return i.forEachChain(function(c){c._mask&n&&s.push(c._name)}),i.forEachResidue(function(c){if(c._mask&n&&!(c._chain._mask&n)){var f=c._chain._name;f in o?o[f].push(c._index):o[f]=[c._index]}}),i.forEachAtom(function(c){c.mask&n&&!(c.residue._mask&n)&&l.push(c.serial)}),this._buildSelectorFromSortedLists(l,o,s)}},{key:"forSelectedResidues",value:function(n){var i=1<<this._selectionBit;this._complex.forEachResidue(function(s){s._mask&i&&n(s)})}},{key:"beginComponentEdit",value:function(){if(this._editor)return null;var n=new w1.ComponentEditor(this);return n.begin()?(this._editor=n,n):null}},{key:"beginFragmentEdit",value:function(){if(this._editor)return null;var n=new w1.FragmentEditor(this);return n.begin()?(this._editor=n,n):null}},{key:"finalizeEdit",value:function(){this._editor=null}},{key:"setMaterialValues",value:function(n){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,o=0,l=this._reprList.length;o<l;++o){var c=this._reprList[o];c.material.setValues(n),i&&c.geo.traverse(function(f){f instanceof Ut&&(f.material.setValues(n),s!==void 0&&s(f),f.material.needsUpdate=!0)})}}},{key:"setUberOptions",value:function(n){for(var i=0,s=this._reprList.length;i<s;++i){var o=this._reprList[i];o.material.setUberOptions(n)}}},{key:"within",value:function(n,i){var s=this._complex.getVoxelWorld();if(s===null)return!1;var o=1<<this._selectionBit;return this._complex.markAtoms(n,o),s&&s.forEachAtomWithinDistFromMasked(this._complex,o,Number(i),function(l){l.mask|=o}),this._selectionCount=this._complex.countAtomsByMask(o),this._complex.updateStructuresMask(),this.buildSelectorFromMask(o)}}]),t}(dc);Pi.NUM_REPRESENTATION_BITS=30;var H6=`varying vec3 pos;\r
\r
void main() {\r
  // we're assuming local position is in [-0.5, 0.5]\r
  // we need to offset it to be represented in RGB\r
  pos = position.xyz + 0.5;\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
}`,W6=`varying vec3 pos;\r
\r
void main() {\r
  gl_FragColor = vec4(pos, 0.5);\r
}`,X6=`varying vec4 screenSpacePos;\r
\r
void main() {\r
  screenSpacePos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
  gl_Position = screenSpacePos;\r
}`,Y6=`uniform mat4 projectionMatrix;\r
\r
// 3D volume texture\r
uniform vec3 volumeDim;    // volume dimensions, pixels\r
uniform sampler2D tileTex; // tiled texture containing all Z-slices of a 3D data\r
uniform vec2 tileTexSize;  // size of tiled texture, pixels\r
uniform vec2 tileStride;   // UV stride between slices in tile tex, pixels\r
\r
uniform vec3 boxAngles;//value of angles({x: alpha, y:beta, z:gamma}) types 1 - if angle is obtuse, 0 - if acute\r
uniform vec3 delta; //Projection box delta's from non-orthogonal origin axes; {x: XY, y : XZ, z: YZ}\r
\r
uniform vec3 _isoLevel0;\r
uniform float _flipV;\r
uniform sampler2D _BFLeft;\r
uniform sampler2D _BFRight;\r
uniform sampler2D _FFLeft;\r
uniform sampler2D _FFRight;\r
uniform sampler2D _WFFLeft;\r
uniform sampler2D _WFFRight;\r
\r
varying vec4 screenSpacePos;\r
\r
#define NO_COLOR vec4(0., 0., 0., 0.)\r
\r
vec4 sample3DTexture(vec3 texCoord) {\r
  // a pair of Z slices is determined by nearest slice border\r
  float zSliceBorder = floor(texCoord.z * volumeDim.z + 0.5);\r
  float zSliceNumber1 = max(zSliceBorder - 1.0, 0.0);\r
  float zSliceNumber2 = min(zSliceBorder, volumeDim.z - 1.0);\r
\r
  float rowTiles = floor(tileTexSize.x / tileStride.x);\r
\r
  // calculate coords in tile texture for both slices\r
  vec2 tileOffset = vec2(mod(zSliceNumber1, rowTiles), floor(zSliceNumber1 / rowTiles));\r
  vec2 texCoordSlice1 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r
  tileOffset = vec2(mod(zSliceNumber2, rowTiles), floor(zSliceNumber2 / rowTiles));\r
  vec2 texCoordSlice2 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r
\r
  // bilinear filtering\r
  vec4 colorSlice1 = texture2D(tileTex, texCoordSlice1);\r
  vec4 colorSlice2 = texture2D(tileTex, texCoordSlice2);\r
  float weightSlice2 = texCoord.z * volumeDim.z - (zSliceNumber1 + 0.5);\r
  return mix(colorSlice1, colorSlice2, weightSlice2);\r
}\r
\r
vec4 sample3DTextureInclined(vec3 boxCoord) { // delta:{ x: XY, y : XZ, z: YZ }\r
  vec3 textCoord = boxCoord;\r
  vec2 currDelta = mix(boxCoord.zz, vec2(1., 1.) - boxCoord.zz, boxAngles.yx) * delta.yz;\r
\r
  textCoord.y = (boxCoord.y  - currDelta.y) / (1. - delta.z);\r
  if (textCoord.y < 0.0 || textCoord.y > 1.0)\r
    return NO_COLOR;\r
\r
  currDelta.x += mix(textCoord.y, 1.0 - textCoord.y, boxAngles.z) * delta.x;\r
\r
  textCoord.x = (boxCoord.x - currDelta.x) / (1. - delta.x - delta.y);\r
  if (textCoord.x < 0.0 || textCoord.x > 1.0)\r
    return NO_COLOR;\r
\r
  return sample3DTexture(textCoord);\r
}\r
\r
float CalcColor(vec3 iter, vec3 dir) {\r
  float d = 1. / 128.;\r
  vec3 dx = vec3(d, 0.0, 0.0);\r
  vec3 dy = vec3(0.0, d, 0.0);\r
  vec3 dz = vec3(0.0, 0.0, d);\r
\r
  // #Opt: coordInc.x:(iter + dx).x > 1. ? 0.: sample3DTextureInclined(iter + dx).x,\r
  vec3 coordInc = mix(\r
    vec3(\r
      sample3DTextureInclined(iter + dx).x,\r
      sample3DTextureInclined(iter + dy).x,\r
      sample3DTextureInclined(iter + dz).x\r
    ),\r
    vec3(0. ,0. , 0.),\r
    vec3(floor((iter + dx).x), floor((iter + dy).y), floor((iter + dz).z))\r
  );\r
\r
  // #Opt: coordDec.x:(iter - dx).x < 0. ? 0.: sample3DTextureInclined(iter - dx).x,\r
  vec3 coordDec = mix(\r
    vec3(0. ,0. , 0.),\r
    vec3(\r
      sample3DTextureInclined(iter - dx).x,\r
      sample3DTextureInclined(iter - dy).x,\r
      sample3DTextureInclined(iter - dz).x\r
    ),\r
    vec3(ceil((iter - dx).x), ceil((iter - dy).y), ceil((iter - dz).z))\r
  );\r
\r
  vec3 N = normalize(coordInc - coordDec);\r
  float dif = max(0.0, dot(N, dir));\r
  return dif;\r
}\r
\r
vec3 AccuracyIso(vec3 left, vec3 right, float volLeft, float threshold) {\r
  for (int i = 0; i < 5; i++) {\r
    vec3 iterator = 0.5 * (left + right);\r
    float vol = sample3DTextureInclined(iterator).r;\r
    if ((volLeft - threshold) * (vol - threshold) < 0.)\r
      right = iterator;\r
    else\r
      left = iterator;\r
  }\r
  return 0.5 * (left + right);\r
}\r
\r
vec3 CorrectIso(vec3 left, vec3 right, float tr) {\r
  for (int j = 0; j < 5; j++) {\r
    vec3 iterator = 0.5 * (left + right);\r
    float vol = sample3DTextureInclined(iterator).r;\r
    if (vol < tr)\r
      right = iterator;\r
    else\r
      left = iterator;\r
  }\r
  return 0.5 * (left + right);\r
}\r
\r
vec4 GetIso1(vec3 start, vec3 back, float molDist, vec3 dir, float tr, int count) {\r
  float vol, stepSize = (float(count) + 2.) / float(STEPS_COUNT);\r
  vec3 step = stepSize * dir, iterator = start, left, right;\r
  vec4 acc = NO_COLOR;\r
\r
  for (int i = 0; i < STEPS_COUNT; i++) {\r
    iterator = iterator + step;\r
    vol = sample3DTextureInclined(iterator).r;\r
    if (length(iterator - back) <= stepSize || (vol > tr))\r
      break;\r
  }\r
\r
  if (vol > tr)\r
    acc = vec4(CorrectIso(iterator, iterator - step, tr).xyz, 1.);\r
\r
  return acc;\r
}\r
\r
float easeOut(float x0, float x1, float x) {\r
  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r
  return 1.0 - (1.0 - t) * (1.0 - t);\r
}\r
\r
float easeIn(float x0, float x1, float x) {\r
  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r
  return t * t;\r
}\r
\r
vec3 GetColSimple(float vol) {\r
  float t = easeOut(_isoLevel0.x, _isoLevel0.y, vol);\r
  float s = easeIn(_isoLevel0.y, _isoLevel0.z, vol);\r
  return vec3(0.5, 0.6, 0.7) * (1.0 - t) + 2.0 * vec3(s, 0, 0);\r
}\r
\r
vec4 VolRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  vec4 acc = NO_COLOR, iso;\r
  vec3 iterator = start, sumColor = vec3(0., 0., 0.);\r
  float stepSize, alpha, sumAlpha = 0.0, vol, curStepSize, molD;\r
  vec3 step, col, colOld, right;\r
  float tr0 = _isoLevel0.x;\r
  float dif, r, kd, finish;\r
  int count = 0, stopMol = 0;\r
\r
  for (int k = 0; k < 3; k++) {\r
    stepSize = (float(k) + 2.) / float(STEPS_COUNT);\r
    kd = 140. * tr0 * stepSize;\r
    r = 1. - kd;\r
    step = stepSize * dir;\r
    iso = GetIso1(iterator, back, molDist, dir, tr0, k);\r
    if (iso.a < 0.1 || length(iso.xyz - start) > molDist)\r
      break;\r
    iterator = iso.xyz;\r
    dif = 1.;// CalcColor(iterator, dir);\r
    colOld = GetColSimple(tr0);\r
    curStepSize = stepSize;\r
    for (int i = 0; i < STEPS_COUNT; i++) {\r
      iterator = iterator + step;\r
      molD = length(iterator - start);\r
      vol = sample3DTextureInclined(iterator).r;\r
      finish = distance(iterator, back) - stepSize;\r
      if (finish < 0.0 || vol < tr0 || (sumAlpha > 0.97) || molD > molDist)\r
        break;\r
      alpha = (1. - r);\r
      col = GetColSimple(vol);\r
      vol = sample3DTextureInclined(iterator - 0.5 * step).r;\r
      vec3 colMid = GetColSimple(vol);\r
      sumColor += (1. - sumAlpha) * (colOld + 4.* colMid + col) * alpha / 6.;\r
      sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r
      colOld = col;\r
    } // for i\r
\r
    if (finish < 0.0 || sumAlpha > 0.97)\r
      break;\r
\r
    if (molD > molDist) {\r
      curStepSize = stepSize - (molD - molDist);\r
      right = iterator - (molD - molDist) * dir;\r
      vol = sample3DTextureInclined(right).r;\r
    } else {\r
      vec3 left = iterator - step;\r
      right = CorrectIso(left, iterator, tr0);\r
      curStepSize = distance(left, right);\r
      vol = tr0;\r
    }\r
\r
    alpha = (1. - r) * curStepSize / stepSize;\r
    dif = 1.;// CalcColor(right, dir);\r
    col = GetColSimple(vol);\r
    vol = sample3DTextureInclined(iterator - 0.5 * curStepSize / stepSize * step).r;\r
    vec3 colMid = GetColSimple(vol);\r
    sumColor += (1. - sumAlpha) * (colOld + 4. * colMid + col) * alpha / 6.;\r
    sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r
\r
    if (molD > molDist)\r
      break;\r
  } // for k\r
  acc.rgb = 1. * sumColor / sumAlpha;\r
  acc.a = sumAlpha;\r
  return acc;\r
}\r
\r
vec4 VolRender1(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  float stepSize = 1.0 / float(STEPS_COUNT);\r
  float len = length(back - start);\r
  vec3 step = stepSize * dir;\r
  vec3 iterator = start;\r
  float acc = 0.0;\r
\r
  for (int i = 0; i < STEPS_COUNT; i++) {\r
    if (float(i) * stepSize > len)\r
      break;\r
    iterator = iterator + step;\r
    if (sample3DTextureInclined(iterator).r > _isoLevel0.x)\r
      acc += 10. * sample3DTextureInclined(iterator).r / float(STEPS_COUNT);\r
  }\r
\r
  return vec4(1.,1.,1., acc);\r
}\r
\r
vec4 IsoRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  vec4 tst = GetIso1(start, back, 2., dir, _isoLevel0.x, 0);\r
  vec4 col = NO_COLOR;\r
\r
  if (length(tst.xyz - start) < molDist && tst.a > 0.1) {\r
    float dif =  CalcColor(tst.xyz, dir);\r
    dif = 0.9 * dif * dif;\r
    col = vec4(dif, dif, dif, 1);\r
  }\r
  return col;\r
}\r
\r
vec4 VolRender2(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  return sample3DTexture(start);\r
}\r
\r
void main() {\r
  vec3 tc = screenSpacePos.xyz / screenSpacePos.w * 0.5 + 0.5;\r
\r
  if (_flipV > 0.0) {\r
    tc.y = 1.0 - tc.y;\r
  }\r
\r
  vec3 start;\r
  vec3 back;\r
  vec3 molBack;\r
  if (projectionMatrix[0][2] < 0.0) {\r
    start = texture2D(_FFLeft, tc.xy).xyz;\r
    back = texture2D(_BFLeft, tc.xy).xyz;\r
    molBack = texture2D(_WFFLeft, tc.xy).xyz;\r
  } else {\r
    start = texture2D(_FFRight, tc.xy).xyz;\r
    back = texture2D(_BFRight, tc.xy).xyz;\r
    molBack = texture2D(_WFFRight, tc.xy).xyz;\r
  }\r
\r
  vec3 dir = normalize(back - start);\r
\r
  float molDist = 2.0;\r
  if (length(molBack) > 0.001) {\r
    molDist = distance(start, molBack);\r
  }\r
\r
  #ifdef ISO_MODE\r
    gl_FragColor = IsoRender(start, back, molDist, dir);\r
  #else\r
    gl_FragColor = VolRender(start, back, molDist, dir);\r
  #endif\r
}\r
`,$6=`varying vec4 volPos;\r
uniform float aspectRatio;\r
uniform float farZ;\r
uniform float tanHalfFOV;\r
uniform mat4  matWorld2Volume;\r
\r
void main() {\r
  // rescale plane to fill in the whole far plane area seen from camera\r
  vec3 pos = position.xyz;\r
  pos.x = pos.x * tanHalfFOV * farZ * aspectRatio;\r
  pos.y = pos.y * tanHalfFOV * farZ;\r
  // common transformation\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\r
  // calc pos in volume CS\r
  volPos = matWorld2Volume * modelMatrix * vec4(pos, 1.0);\r
  // we're assuming local position is in [-0.5, 0.5]\r
  // we need to offset it to be represented in RGB\r
  volPos = volPos + 0.5;\r
  volPos.w = 0.5;\r
}\r
`,q6=`varying vec4 volPos;\r
\r
void main() {\r
  gl_FragColor = volPos;\r
}`;function dh(a){var e=Z6();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Z6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var j6=bs.merge([{volumeDim:{type:"v3",value:new C(512,512,512)},tileTex:{type:"t",value:null},tileTexSize:{type:"v2",value:new Pe(512,512)},tileStride:{type:"v2",value:new Pe(512,512)},boxAngles:{type:"v3",value:new C(1,1,1)},delta:{type:"v3",value:new C(0,0,0)},_isoLevel0:{type:"v2",value:new C(.5,.75,1)},_flipV:{type:"f",value:0},_BFLeft:{type:"t",value:null},_BFRight:{type:"t",value:null},_FFLeft:{type:"t",value:null},_FFRight:{type:"t",value:null},_WFFLeft:{type:"t",value:null},_WFFRight:{type:"t",value:null}}]);function KS(a,e){var t=bs.clone(e);for(var r in a)t.hasOwnProperty(r)&&(t[r].value=a[r]);return t}function JS(a,e){return{uniforms:KS(a,{}),vertexShader:H6,fragmentShader:W6,transparent:!1,depthTest:!1,depthWrite:!1,side:e}}var K6=function(a){ve(t,a);var e=dh(t);function t(r){K(this,t);var n=JS(r,Tn);return e.call(this,n)}return J(t)}(wi),QS=J(function a(e,t,r,n){K(this,a),this.uniforms=KS(e,t),this.vertexShader=r,this.fragmentShader=n,this.transparent=!1,this.depthTest=!1,this.depthWrite=!1,this.side=Ss}),J6=function(a){ve(t,a);var e=dh(t);function t(r){K(this,t);var n=bs.merge([{aspectRatio:{type:"f",value:0},farZ:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},matWorld2Volume:{type:"4fv",value:new Xe}}]),i=new QS(r,n,$6,q6);return e.call(this,i)}return J(t)}(wi),Q6=function(a){ve(t,a);var e=dh(t);function t(r){K(this,t);var n=JS(r,Ss);return e.call(this,n)}return J(t)}(wi),eV=function(a){ve(t,a);var e=dh(t);function t(r){var n;K(this,t);var i=new QS(r,j6,X6,Y6);return i.transparent=!0,i.depthTest=!0,n=e.call(this,i),n.updateDefines(),n}return J(t,[{key:"updateDefines",value:function(){this.defines={ISO_MODE:fe.now.modes.VD.isoMode,STEPS_COUNT:fe.now.modes.VD.polyComplexity[fe.now.resolution]*100},this.needsUpdate=!0}}]),t}(wi),Wf={BackFacePosMaterial:K6,BackFacePosMaterialFarPlane:J6,FrontFacePosMaterial:Q6,VolumeMaterial:eV};function tV(a){var e=nV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function nV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zi=function(a){ve(t,a);var e=tV(t);function t(){var r;K(this,t);var n=new It;r=e.call(this,n),qe(si(r),"volumeInfo",{}),r.clipPlane=new yi;var i=new C(.5,.5,.5);return r.size=i,r.cullFlag=[!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1],r.faces=[{indices:[],norm:new C(0,0,-1)},{indices:[],norm:new C(0,0,1)},{indices:[],norm:new C(0,-1,0)},{indices:[],norm:new C(0,1,0)},{indices:[],norm:new C(-1,0,0)},{indices:[],norm:new C(1,0,0)},{indices:[],norm:new C(0,0,0)}],r.vertices=[new C(-i.x,-i.y,-i.z),new C(-i.x,i.y,-i.z),new C(i.x,-i.y,-i.z),new C(i.x,i.y,-i.z),new C(-i.x,-i.y,i.z),new C(-i.x,i.y,i.z),new C(i.x,-i.y,i.z),new C(i.x,i.y,i.z),new C(0,0,0),new C(0,0,0),new C(0,0,0),new C(0,0,0),new C(0,0,0),new C(0,0,0)],n.setAttribute("position",new mt(new Float32Array(r.vertices.length*3),3)),r.name="VolumeMesh",r}return J(t,[{key:"_updateVertices",value:function(){var n=t._corners,i=t._edges,s=t._edgeIntersections,o,l=this.clipPlane.normal,c=this.clipPlane.constant,f=this.vertices,d=this.size,p=[0,0,0,0,0,0,0,0],m=[1,1,1,1,1,1,1,1,1,1,1,1],v=new C,y=null;function S(){if(l.x===0)return 0;var j=-(l.dot(v)+c)/l.x;return-d.x<=j&&j<=d.x?(y.set(j,v.y,v.z),j===d.x?2:j===-d.x?-2:1):0}function _(){if(l.y===0)return 0;var j=-(l.dot(v)+c)/l.y;return-d.y<=j&&j<=d.y?(y.set(v.x,j,v.z),j===d.y?2:j===-d.y?-2:1):0}function x(){if(l.z===0)return 0;var j=-(l.dot(v)+c)/l.z;return-d.z<=j&&j<=d.z?(y.set(v.x,v.y,j),j===d.z?2:j===-d.z?-2:1):0}for(var b=0;b<12;++b){var M=i[b];y=s[b],v.set(M[2],M[3],M[4]),v.multiply(d);var E=0;M[2]===0&&(E=S()),M[3]===0&&(E=_()),M[4]===0&&(E=x()),E===-2?p[M[0]]=1:E===2?p[M[1]]=1:E===0&&(m[b]=0)}var T={indices:[],norm:l.clone().negate()},R=8;for(o=0;o<8;++o)p[o]===1&&(f[R].set(n[o][0],n[o][1],n[o][2]).multiply(d),T.indices.push(R++),m[n[o][3]]=0,m[n[o][4]]=0,m[n[o][5]]=0);for(o=0;o<12;++o)m[o]===1&&(f[R].copy(s[o]),T.indices.push(R++));this.faces[6]=T;var V=new C,Y=new C;for(this.clipPlane.coplanarPoint(Y),o=0;o<f.length;++o)this.cullFlag[o]=!1,o<8?(V.subVectors(f[o],Y),this.cullFlag[o]=l.dot(V)>=0):o<8+T.indices.length&&(this.cullFlag[o]=!0);var $=this.geometry.getAttribute("position"),W=0;for(o=0;o<f.length;++o)$.array[W++]=f[o].x,$.array[W++]=f[o].y,$.array[W++]=f[o].z;$.needsUpdate=!0}},{key:"_collectVertices",value:function(n,i){var s,o=this.vertices;for(n.indices=[],s=0;s<o.length;++s)this.cullFlag[s]&&i(o[s])&&n.indices.push(s)}},{key:"_sortIndices",value:function(n,i){var s,o,l=this.vertices,c=[],f=new C;for(s=1;s<n.indices.length;++s)f.subVectors(l[n.indices[s]],l[n.indices[0]]),f.normalize(),f.cross(i),f.negate(),c[s]=n.norm.dot(f);for(s=1;s<n.indices.length-1;++s)for(o=s+1;o<n.indices.length;++o)if(c[o]<c[s]){var d=c[s];c[s]=c[o],c[o]=d,d=n.indices[s],n.indices[s]=n.indices[o],n.indices[o]=d}}},{key:"_updateIndices",value:function(){var n,i,s,o=this.vertices,l=this.size;this._collectVertices(this.faces[0],function(x){return x.z===-l.z}),this._collectVertices(this.faces[1],function(x){return x.z===l.z}),this._collectVertices(this.faces[2],function(x){return x.y===-l.y}),this._collectVertices(this.faces[3],function(x){return x.y===l.y}),this._collectVertices(this.faces[4],function(x){return x.x===-l.x}),this._collectVertices(this.faces[5],function(x){return x.x===l.x});var c=new C,f=new C,d=new C;for(i=0;i<this.faces.length;++i)if(s=this.faces[i],s.indices.length!==0){for(c.set(0,0,0),n=0;n<s.indices.length;++n)c.add(o[s.indices[n]]);c.multiplyScalar(1/s.indices.length),f.subVectors(o[s.indices[0]],c),f.normalize();var p=[];for(n=0;n<s.indices.length;++n)d.subVectors(o[s.indices[n]],c),p[n]=d.dot(f);for(n=1;n<s.indices.length;++n)if(p[n]<p[0]){var m=p[0];p[0]=p[n],p[n]=m;var v=pn(s.indices,1);m=v[0],s.indices[0]=s.indices[n],s.indices[n]=m}this._sortIndices(s,f)}var y=0;for(i=0;i<this.faces.length;++i)s=this.faces[i],s.indices.length>=3&&(y+=3*(s.indices.length-2));var S=0,_=new Uint16Array(y);for(i=0;i<this.faces.length;++i)for(s=this.faces[i],n=0;n<s.indices.length-2;++n)_[S]=s.indices[0],_[S+1]=s.indices[n+1],_[S+2]=s.indices[n+2],S+=3;this.geometry.setIndex(new mt(_,1))}},{key:"setDataSource",value:function(n){var i=new Wf.VolumeMaterial,s=n.getDimensions(),o=n.getTiledTextureStride(),l=n.buildTiledTexture(),c=n.getBox();i.uniforms.volumeDim.value.set(s[0],s[1],s[2]),i.uniforms.tileTex.value=l,i.uniforms.tileTexSize.value.set(l.image.width,l.image.height),i.uniforms.tileStride.value.set(o[0],o[1]),Object.assign(this.volumeInfo,n.getVolumeInfo());var f=this.volumeInfo;i.uniforms.delta.value.copy(f.delta),i.uniforms.boxAngles.value.set(f.obtuseAngle[0],f.obtuseAngle[1],f.obtuseAngle[2]),this.material=i,c.getSize(this.scale),c.getCenter(this.position)}},{key:"_updateIsoLevel",value:function(){var n=fe.now.modes.VD,i=n.kSigma,s=n.kSigmaMed,o=n.kSigmaMax,l=this.volumeInfo,c=l.dmean-l.dmin,f=l.dmax-l.dmin,d=function(m){return(c+m*l.sd)/f};this.material.uniforms._isoLevel0.value.set(d(i),d(s),d(o))}},{key:"rebuild",value:function(n){var i=t._nearClipPlaneOffset,s=t._pos,o=t._norm,l=t._norm4D,c=t._matrixWorldToLocal,f=t._clipPlane;this._updateIsoLevel(),n.getWorldDirection(o),n.getWorldPosition(s),s.addScaledVector(o,n.near+i),c.copy(this.matrixWorld).invert(),s.applyMatrix4(c),l.set(o.x,o.y,o.z,0),l.applyMatrix4(c),o.copy(l),o.normalize(),f.setFromNormalAndCoplanarPoint(o,s),this.clipPlane.equals(f)||(this.clipPlane=f.clone(),this._updateVertices(),this._updateIndices())}}]),t}(Ut);qe(zi,"_corners",[[-1,-1,-1,0,4,8],[1,-1,-1,0,5,9],[1,1,-1,1,5,10],[-1,1,-1,1,4,11],[-1,-1,1,2,6,8],[1,-1,1,2,7,9],[1,1,1,3,7,10],[-1,1,1,3,6,11]]);qe(zi,"_edges",[[0,1,0,-1,-1],[2,3,0,1,-1],[4,5,0,-1,1],[6,7,0,1,1],[0,3,-1,0,-1],[1,2,1,0,-1],[4,7,-1,0,1],[5,6,1,0,1],[0,4,-1,-1,0],[1,5,1,-1,0],[2,6,-1,1,0],[3,7,1,1,0]]);qe(zi,"_edgeIntersections",function(){for(var a=[],e=0;e<12;++e)a.push(new C);return a}());qe(zi,"_nearClipPlaneOffset",.2);qe(zi,"_pos",new C);qe(zi,"_norm",new C);qe(zi,"_norm4D",new Gt);qe(zi,"_matrixWorldToLocal",new Xe);qe(zi,"_clipPlane",new yi);function rV(a){for(var e=a.length,t=new Float32Array(e*3),r=0;r<e;++r){var n=3*r,i=a[r];t[n]=i.x,t[n+1]=i.y,t[n+2]=i.z}return t}var ew=function(){function a(e,t){K(this,a);var r=t.delta,n=t.obtuseAngle,i=new C;e.getSize(i),i.multiplyScalar(.5);for(var s=this._getBaseVertices(r,n),o=new It,l=[],c=0;c<4;c++)l.push(s[c].clone().multiply(i)),l.push(s[(c+1)%4].clone().multiply(i));for(var f=new C(2*i.x*(1-r.x-r.y),0,0),d=0;d<8;d++)l.push(l[d].clone().add(f));for(var p=0;p<4;p++)l.push(l[p*2].clone()),l.push(l[p*2+8].clone());var m=new C;e.getCenter(m),l.forEach(function(y){return y.add(m)});var v=rV(l);o.setAttribute("position",new mt(v,3)),this._lines=new $r(o,new As({color:16777215})),this._lines.layers.set(_t.LAYERS.VOLUME)}return J(a,[{key:"_getBaseVertices",value:function(t,r){var n=a._projectionTable,i=function(l,c){var f=t[n[l][0]],d=-.5*(c-1)+c*r[n[l][1]];return d*f},s=[new C(-1+2*(i("XZ",1)+i("XY",1)),-1+2*i("YZ",1),-1),new C(-1+2*(i("XZ",-1)+i("XY",1)),-1+2*i("YZ",-1),1),new C(-1+2*(i("XZ",-1)+i("XY",-1)),1-2*i("YZ",1),1),new C(-1+2*(i("XZ",1)+i("XY",-1)),1-2*i("YZ",-1),-1)];return s}},{key:"getMesh",value:function(){return this._lines}}]),a}();qe(ew,"_projectionTable",{XY:["x",2],XZ:["y",1],YZ:["z",0]});var iV=function(){function a(e,t,r){K(this,a);var n=this._initPlaneGeo(t,r),i=new Wf.BackFacePosMaterialFarPlane;this._plane=new ii.Mesh(n,i),this._plane.frustumCulled=!1,this._plane.doubleSided=!0;var s=new Xe;this._plane._onBeforeRender=function(o,l,c,f,d,p){var m=this.material;if(!(!e||!m)){var v=new Gt(0,0,-(c.far-.1),1);v.applyMatrix4(c.matrixWorld),this.matrix.identity(),this.matrix.makeTranslation(v.x,v.y,v.z),this.matrixWorld.copy(this.matrix),this.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,this.matrixWorld),this.normalMatrix.getNormalMatrix(this.modelViewMatrix);var y=e.matrixWorld;s.copy(y).invert(),m.uniforms.aspectRatio.value=c.aspect,m.uniforms.farZ.value=c.far,m.uniforms.tanHalfFOV.value=Math.tan(oa.DEG2RAD*.5*c.fov),m.uniforms.matWorld2Volume.value=s}},this._plane.layers.set(_t.LAYERS.VOLUME_BFPLANE)}return J(a,[{key:"_initPlaneGeo",value:function(t,r){var n=new It;t=t||1,r=r||1;var i=new Float32Array([-.5*t,.5*r,0,.5*t,.5*r,0,-.5*t,-.5*r,0,.5*t,-.5*r,0]);return n.setAttribute("position",new mt(i,3)),n.setIndex([0,2,1,2,3,1]),n}},{key:"getMesh",value:function(){return this._plane}}]),a}();function aV(a){var e=sV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function sV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Np=function(a){ve(t,a);var e=aV(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._mesh=new zi,i._mesh.setDataSource(n),i.add(i._mesh),i._frame=new ew(i.getBoundaries().boundingBox,i._mesh.volumeInfo),i.add(i._frame.getMesh()),i.showFrame(fe.now.modes.VD.frame),i._farPlane=new iV(i._mesh,2,2),i.add(i._farPlane.getMesh()),i}return J(t,[{key:"getBoundaries",value:function(){var n=this._dataSource.getBox(),i=new Lr;return n.getBoundingSphere(i),{boundingBox:n,boundingSphere:i}}},{key:"getMesh",value:function(){return this._mesh}},{key:"showFrame",value:function(n){this._frame.getMesh().material.visible=n}}]),t}(dc);function oV(a){var e=lV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function lV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cV=function(a){ve(t,a);var e=oV(t);function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return K(this,t),e.call(this,r,["types"])}return J(t,[{key:"find",value:function(n){var i=[];if(n.type)i=this._dict.types[n.type.toLowerCase()]||[];else if(n.source)return this._list.filter(function(s){return s.canProbablyLoad&&s.canProbablyLoad(n.source)});return Ms(i)}}]),t}(Is);function uV(a){var e=fV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function fV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ph=function(a){ve(t,a);var e=uV(t);function t(r,n){var i;return K(this,t),i=e.call(this),i._source=r,i._options=n||{},i._abort=!1,i._agent=null,i}return J(t,[{key:"load",value:function(){return Promise.reject(new Error("Loading from this source is not implemented"))}},{key:"abort",value:function(){this._abort=!0,this._agent&&this._agent.abort()}}],[{key:"extractName",value:function(n){}}]),t}(pr);Sc(ph.prototype);function hV(a){var e=dV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function dV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tw=function(a){ve(t,a);var e=hV(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),n=i._options,i._binary=n.binary===!0,i}return J(t,[{key:"load",value:function(){var n=this;return new Promise(function(i,s){if(n._abort)throw new Error("Loading aborted");var o=n._source,l=n._agent=new FileReader;l.addEventListener("load",function(){i(l.result)}),l.addEventListener("error",function(){s(l.error)}),l.addEventListener("abort",function(){s(new Error("Loading aborted"))}),l.addEventListener("progress",function(c){n.dispatchEvent(c)}),n._binary?l.readAsArrayBuffer(o):l.readAsText(o)})}}],[{key:"canProbablyLoad",value:function(n){return File&&n instanceof File||Blob&&n instanceof Blob}},{key:"extractName",value:function(n){return n&&n.name}}]),t}(ph);tw.types=["file","blob"];function pV(a){var e=mV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function mV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vV=/^(https?|ftp):\/\//i,nw=function(a){ve(t,a);var e=pV(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),n=i._options,i._binary=n.binary===!0,i}return J(t,[{key:"load",value:function(){var n=this;return new Promise(function(i,s){if(n._abort)throw new Error("Loading aborted");var o=n._source,l=n._agent=new XMLHttpRequest;l.addEventListener("load",function(){l.status===200?i(l.response):s(new Error("HTTP ".concat(l.status," while fetching ").concat(o)))}),l.addEventListener("error",function(){s(new Error("HTTP request failed"))}),l.addEventListener("abort",function(){s(new Error("Loading aborted"))}),l.addEventListener("progress",function(c){n.dispatchEvent(c)}),l.open("GET",o),n._binary?l.responseType="arraybuffer":l.responseType="text",l.send()})}}],[{key:"canProbablyLoad",value:function(n){return xe.isString(n)&&vV.test(n)}},{key:"extractName",value:function(n){if(n){var i=(n.indexOf("?")+1||n.lastIndexOf("#")+1||n.length+1)-1;return n.slice(n.lastIndexOf("/",i)+1,i)}}}]),t}(ph);nw.types=["url"];function gV(a){var e=_V();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function _V(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rw=function(a){ve(t,a);var e=gV(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"load",value:function(){var n=this;return new Promise(function(i){if(n._abort)throw new Error("Loading aborted");i(n._source)})}}],[{key:"canProbablyLoad",value:function(n){return!1}}]),t}(ph);rw.types=["immediate"];var yV=new cV([tw,nw,rw]);function xV(a){var e=SV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function SV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wV=function(a){ve(t,a);var e=xV(t);function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return K(this,t),e.call(this,r,["formats","extensions"])}return J(t,[{key:"find",value:function(n){var i=[];return n.format?i=this._dict.formats[n.format.toLowerCase()]||[]:n.ext&&(i=this._dict.extensions[n.ext.toLowerCase()]||[]),i.length===0&&!n.format&&n.data?this._list.filter(function(s){return s.canProbablyParse&&s.canProbablyParse(n.data)}):Ms(i)}}]),t}(Is),Xr=function(){function a(e,t){K(this,a),this._data=e,this._options=t||{},this._abort=!1}return J(a,[{key:"parseSync",value:function(){throw new Error("Parsing this type of data is not implemented")}},{key:"parse",value:function(){var t=this;return new Promise(function(r,n){setTimeout(function(){try{return t._abort?n(new Error("Parsing aborted")):r(t.parseSync())}catch(i){return n(i)}})})}},{key:"getModel",value:function(){return this.model._parseHeader(this._data),this.model}},{key:"abort",value:function(){this._abort=!0}}]),a}();Sc(Xr.prototype);var iw=function(){function a(){K(this,a),this.matrices=[],this._matrix=null,this._matrixIndex=-1}return J(a,[{key:"parse",value:function(t){var r=this._matrix;if(t.readString(12,18)==="  SMTRY"){var n=t.readCharCode(19)-49,i=t.readString(20,80).trim().split(/\s+/),s=parseInt(i[0],10);(this._matrix===null||s!==this._matrixIndex)&&(this._matrixIndex=s,this._matrix=r=new Xe,this.matrices[this.matrices.length]=r);var o=r,l=o.elements;l[n]=parseFloat(i[1]),l[n+4]=parseFloat(i[2]),l[n+8]=parseFloat(i[3]),l[n+12]=parseFloat(i[4])}}}]),a}();iw.prototype.id=290;var bV=pt.Assembly,aw=function(){function a(e){K(this,a),this._complex=e,this.assemblies=[],this._assembly=null,this._matrix=null,this._matrixIndex=-1}return J(a,[{key:"parse",value:function(t){var r=this._assembly,n=this._matrix;if(r&&t.readString(12,18)==="  BIOMT"){var i=t.readCharCode(19)-49,s=t.readString(20,80).trim().split(/\s+/),o=parseInt(s[0],10);(this._matrix===null||o!==this._matrixIndex)&&(this._matrixIndex=o,this._matrix=n=new Xe,r.addMatrix(n));var l=n,c=l.elements;c[i]=parseFloat(s[1]),c[i+4]=parseFloat(s[2]),c[i+8]=parseFloat(s[3]),c[i+12]=parseFloat(s[4])}else if(r&&t.readString(35,41)==="CHAINS:")for(var f=t.readString(42,80).split(","),d=0,p=f.length;d<p;++d){var m=f[d].trim();m.length>0&&r.addChain(m)}else t.readString(12,23)==="BIOMOLECULE:"&&(this._matrix=null,this._matrixIndex=-1,this._assembly=r=new bV(this._complex),this.assemblies.push(r))}}]),a}();aw.prototype.id=350;var sw=function(){function a(e){K(this,a),this._data=e,this._start=0,this._nextCR=-1,this._nextLF=-1,this._next=-1,this._end=e.length,this.next()}return J(a,[{key:"readLine",value:function(){return this._data.slice(this._start,this._next)}},{key:"readChar",value:function(t){return t=this._start+t-1,t<this._next?this._data[t]:" "}},{key:"readCharCode",value:function(t){return t=this._start+t-1,t<this._next?this._data.charCodeAt(t):32}},{key:"readString",value:function(t,r){var n=this._start+t-1,i=this._start+r;return this._data.slice(n,i<this._next?i:this._next)}},{key:"readInt",value:function(t,r){return parseInt(this.readString(t,r),10)}},{key:"readFloat",value:function(t,r){return parseFloat(this.readString(t,r))}},{key:"end",value:function(){return this._start>=this._end}},{key:"next",value:function(){var t=this._next+1;this._start=t<this._end?t:this._end,this._start>this._nextCR&&(this._nextCR=(this._data.indexOf("\r",this._start)+1||this._end+1)-1),this._start>this._nextLF&&(this._nextLF=(this._data.indexOf(`
`,this._start)+1||this._end+1)-1),this._next=this._nextCR+1<this._nextLF?this._nextCR:this._nextLF}}]),a}();function MV(a){var e=EV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function EV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var CV=pt.Complex,b1=pt.Element,AV=pt.Helix,TV=pt.Sheet,RV=pt.Strand,bf=pt.Bond,LV=pt.Molecule,PV=6;function IV(a){var e=a.trim().length===4;return a.slice(0,e?1:2).trim()}var NV=/^(HEADER\s|COMPND\s|REMARK\s|ATOM {2}|HETATM|MODEL )/i,kV={290:iw,350:aw},gn=function(a){ve(t,a);var e=MV(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._complex=null,i._chain=null,i._residue=null,i._sheet=null,i._serialAtomMap=null,i._modelId=1,i._compaundFound=!1,i._biomoleculeFound=!1,i._allowedChainsIDs=null,i._lastMolId=-1,i._remarks={},i._remark=null,i._molecules=[],i._molecule=null,i._compndCurrToken="",i._options.fileType="pdb",i}return J(t,[{key:"_finalize",value:function(){this._fixBondsArray(),this._fixChains();var n=this._remarks[290];this._complex.symmetry=xe.isUndefined(n)?[]:n.matrices;var i=this._remarks[350];this._complex.units=this._complex.units.concat(xe.isUndefined(i)?[]:i.assemblies),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"_finalizeMolecules",value:function(){var n={},i,s=this._complex._chains;for(i=0;i<s.length;++i){var o=s[i],l=o._name;n[l]=o}for(i=0;i<this._molecules.length;i++){for(var c=this._molecules[i],f=[],d=0;d<c._chains.length;d++){var p=c._chains[d],m=n[p];f=f.concat(m._residues.slice())}var v=new LV(this._complex,c._name,i+1);v.residues=f,this._complex._molecules[i]=v}}},{key:"_fixChains",value:function(){for(var n={},i=this._complex,s=0;s<i._chains.length;s++){var o=i._chains[s];n[o._name.charCodeAt(0)]=o}}},{key:"_fixBondsArray",value:function(){for(var n=this._serialAtomMap={},i=this._complex,s=i._atoms,o=0,l=s.length;o<l;++o){var c=s[o];n[c.serial]=c}for(var f=i._bonds,d=this.logger,p=0,m=f.length;p<m;++p){var v=f[p];v._right<v._left&&d.debug("_fixBondsArray: Logic error."),v._left=n[v._left]||null,v._right=n[v._right]||null}}},{key:"_parseATOM",value:function(n){if(this._modelId===1){var i=n.readCharCode(1)===72,s=i?n.readInt(7,11):n.readInt(6,11),o=n.readString(13,16),l=n.readChar(17),c=n.readString(18,20).trim(),f=n.readChar(22),d=n.readInt(23,26),p=n.readChar(27),m=n.readFloat(31,38),v=n.readFloat(39,46),y=n.readFloat(47,54),S=n.readFloat(55,60),_=n.readFloat(61,66),x=n.readString(77,78).trim()||IV(o),b=n.readInt(79,80)||0;if(!(this.settings.now.nowater&&(c==="HOH"||c==="WAT"))){o=o.trim();var M=b1.getByName(x),E=b1.Role[o],T=this._chain;(!T||T.getName()!==f)&&(this._chain=T=this._complex.getChain(f)||this._complex.addChain(f),this._residue=null);var R=this._residue;(!R||R.getSequence()!==d||R.getICode()!==p)&&(this._residue=R=T.addResidue(c,d,p));var V=new C(m,v,y);R.addAtom(o,M,V,E,i,s,l,S,_,b)}}}},{key:"_parseENDMDL",value:function(){this._modelId+=1}},{key:"_parseCONECT",value:function(n){var i=n.readInt(7,11),s=n.readInt(12,16),o=n.readInt(17,21),l=n.readInt(22,26),c=n.readInt(27,31),f=this._complex;s&&s>i&&f.addBond(i,s,0,bf.BondType.UNKNOWN,!0),o&&o>i&&f.addBond(i,o,0,bf.BondType.UNKNOWN,!0),l&&l>i&&f.addBond(i,l,0,bf.BondType.UNKNOWN,!0),c&&c>i&&f.addBond(i,c,0,bf.BondType.UNKNOWN,!0)}},{key:"_parseCOMPND",value:function(n){var i=n.readString(11,80),s=i.indexOf(":");if(this._compndCurrToken=s>0?i.substring(0,s).trim():this._compndCurrToken,this._compndCurrToken==="MOL_ID")this._molecule={_index:"",_chains:[]},this._molecule._index=parseInt(i.substring(s+1,i.indexOf(";")),10),this._molecules.push(this._molecule);else if(this._compndCurrToken==="MOLECULE"&&this._molecule!=null)this._molecule._name=i.substring(s+1,i.indexOf(";")).trim();else if(this._compndCurrToken==="CHAIN"&&this._molecule!=null){var o=i.substring(s+1,80).trim(),l=o[o.length-1];(l===";"||l===",")&&(o=o.slice(0,-1)),o=o.replace(/\s+/g,"");var c=o.split(",");this._molecule._chains=this._molecule._chains.concat(c)}}},{key:"_parseREMARK",value:function(n){var i=n.readInt(8,10),s=this._remarks[i];if(xe.isUndefined(s)){var o=kV[i];typeof o=="function"&&(this._remarks[i]=s=new o(this._complex))}xe.isUndefined(s)||s.parse(n)}},{key:"_parseHELIX",value:function(n){var i=this,s=[20,22,32,34];this._parseSTRUCTURE(n,s,function(o){i._complex.addHelix(o),i._complex.structures.push(o)})}},{key:"_parseSHEET",value:function(n){var i=this,s=[22,23,33,34];this._parseSTRUCTURE(n,s,function(o){i._complex.addSheet(o)})}},{key:"_parseSTRUCTURE",value:function(n,i,s){var o=0,l=1,c=2,f=3,d=83,p=n.readInt(8,10),m=n.readString(12,14).trim(),v=n.readString(41,70).trim(),y=n.readInt(72,76),S=n.readInt(39,40),_=n.readInt(15,16),x=n.readInt(42,45),b=n.readInt(57,60),M=n.readString(i[o],i[c]+1).charCodeAt(0),E=n.readString(i[c],i[c]+1).charCodeAt(0),T=n.readInt(i[l],i[l]+3),R=n.readString(i[l]+4,i[l]+4),V=0;R.length>0&&(V=R.charCodeAt(0));var Y=n.readInt(i[f],i[f]+3);R=n.readString(i[f]+4,i[f]+4);var $=0;R.length>0&&($=R.charCodeAt(0));var W,j=this._sheet;if(n.readCharCode(1)===d){j!==null&&j.getName()!==m&&(j=null,this._sheet=null),j===null?(this._sheet=W=new TV(m,_),s(W)):W=j;var X=new RV(W,this._complex.getUnifiedSerial(M,T,V),this._complex.getUnifiedSerial(E,Y,$),S,x,b);W.addStrand(X),this._complex.structures.push(X)}else W=new AV(S,this._complex.getUnifiedSerial(M,T,V),this._complex.getUnifiedSerial(E,Y,$),p,m,v,y),s(W)}},{key:"_parseHEADER",value:function(n){var i=this._complex.metadata;i.classification=n.readString(11,50).trim(),i.date=n.readString(51,59).trim();var s=n.readString(63,66).trim();i.id=s,s&&(this._complex.name=s),i.format="pdb"}},{key:"_parseTITLE",value:function(n){var i=this._complex.metadata;i.title=i.title||[];var s=n.readInt(9,10)||1;i.title[s-1]=n.readString(11,80).trim()}},{key:"parseSync",value:function(){for(var n=new sw(this._data),i=this._complex=new CV;!n.end();){var s=n.readString(1,PV),o=t.tagParsers[s];typeof o=="function"&&o.call(this,n),n.next()}if(this._finalize(),this._serialAtomMap=null,this._sheet=null,this._residue=null,this._chain=null,this._complex=null,i.getAtomCount()===0)throw new Error("The data does not contain valid atoms");return i}}],[{key:"canProbablyParse",value:function(n){return xe.isString(n)&&NV.test(n)}}]),t}(Xr);qe(gn,"tagParsers",{HEADER:gn.prototype._parseHEADER,"TITLE ":gn.prototype._parseTITLE,"ATOM  ":gn.prototype._parseATOM,HETATM:gn.prototype._parseATOM,ENDMDL:gn.prototype._parseENDMDL,CONECT:gn.prototype._parseCONECT,COMPND:gn.prototype._parseCOMPND,REMARK:gn.prototype._parseREMARK,"HELIX ":gn.prototype._parseHELIX,"SHEET ":gn.prototype._parseSHEET,"ATOM 1":gn.prototype._parseATOM,"ATOM 2":gn.prototype._parseATOM,"ATOM 3":gn.prototype._parseATOM,"ATOM 4":gn.prototype._parseATOM,"ATOM 5":gn.prototype._parseATOM,"ATOM 6":gn.prototype._parseATOM,"ATOM 7":gn.prototype._parseATOM,"ATOM 8":gn.prototype._parseATOM,"ATOM 9":gn.prototype._parseATOM});gn.formats=["pdb"];gn.extensions=[".pdb",".ent"];function OV(a){var e=DV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function DV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kp=pt.Complex,Ao=pt.Element,FV=pt.SGroup,M1=pt.Bond,BV={A:0,S:1,D:2,T:3},zV=/\s*<\?xml\b[^?>]*\?>\s*<(?:cml|molecule)\b/i,sv=function(a){ve(t,a);var e=OV(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._complex=null,i._residue=null,i._serialAtomMap=null,i._modelId=1,i._lastMolId=-1,i._readOnlyOneMolecule=!1,i._options.fileType="cml",i}return J(t,[{key:"_rebuidBondIndexes",value:function(n,i){for(var s=n.length,o=0;o<s;o++)for(var l=n[o].id,c=i.length,f=0;f<c;f++){var d=i[f].atomRefs2.split(" ");d[0]===l&&(i[f].start=o),d[1]===l&&(i[f].end=o)}}},{key:"_createSGroup",value:function(n,i){var s=new FV(n.id,n.fieldData,new C(parseFloat(n.x),parseFloat(n.y),0),n.atomRefs,n);n.placement==="Relative"&&(s._center=new C(0,0,0)),n.fieldName==="MDLBG_FRAGMENT_CHARGE"&&(s._charge=parseInt(n.fieldData,10)||0),n.fieldName==="MDLBG_FRAGMENT_COEFFICIENT"&&(s._repeat=parseInt(n.fieldData,10)||1),i.push(s)}},{key:"_extractSGroup",value:function(n,i){if(Array.isArray(i)||(i=[]),n)if(Array.isArray(n))for(var s=n.length,o=0;o<s;o++)n[o].molecule&&(i=i.concat(this._extractSGroup(n[o].molecule))),this._createSGroup(n[o],i);else n.molecule&&n.molecule&&(i=i.concat(this._extractSGroup(n.molecule))),this._createSGroup(n,i);return i}},{key:"_extractSGroups",value:function(n,i){var s=this._extractSGroup(n),o=i.length,l,c;for(l=0;l<o;l++){var f=i[l].id;for(c=0;c<s.length;c++){var d=s[c]._atoms.split(" ")[0];d===f&&(i[l].sgroupRef||(i[l].sgroupRef=[]),i[l].sgroupRef.push(s[c]))}}var p={},m=null,v=1e8,y=new C(v,v,v),S=new C(-v,-v,-v);function _(M){m=p[M],m&&s[c]._atoms.push(m.a)}function x(M){m=p[M],m&&(y.set(Math.min(y.x,m.x),Math.min(y.y,m.y),Math.min(y.z,m.z)),S.set(Math.max(S.x,m.x),Math.max(S.y,m.y),Math.max(S.z,m.z)),_(M))}for(l=0;l<i.length;l++)p[i[l].id]={},p[i[l].id].x=i[l].x2,i[l].x3&&(p[i[l].id].x=i[l].x3),p[i[l].id].x=parseFloat(p[i[l].id].x),p[i[l].id].y=i[l].y2,i[l].y3&&(p[i[l].id].y=i[l].y3),p[i[l].id].y=parseFloat(p[i[l].id].y),p[i[l].id].z="0.0",i[l].z3&&(p[i[l].id].z=i[l].z3),p[i[l].id].z=parseFloat(p[i[l].id].z),p[i[l].id].a=i[l];var b;for(c=0;c<s.length;c++)s[c]._center!==null?(y.set(v,v,v),S.set(-v,-v,-v),b=s[c]._atoms.split(" "),s[c]._atoms=[],b.forEach(x),s[c]._center.addVectors(y,S),s[c]._center.multiplyScalar(.5)):(b=s[c]._atoms.split(" "),s[c]._atoms=[],b.forEach(_));p=null}},{key:"_traverseData",value:function(n){function i(l){return Object.prototype.toString.apply(l)==="[object Array]"}function s(l,c){if(!(l.nodeName==="#text"&&l.nodeValue.trim()==="")){var f={};f.xmlNode=l;var d=c[l.nodeName];d?i(d)?c[l.nodeName].push(f):c[l.nodeName]=[d,f]:c[l.nodeName]=f;var p,m;if(l.attributes)for(p=l.attributes.length,m=0;m<p;m++){var v=l.attributes[m];f[v.nodeName]=v.nodeValue}for(p=l.childNodes.length,m=0;m<p;m++)s(l.childNodes[m],f)}}var o={};return n.childNodes.length&&s(n.childNodes[0],o),o}},{key:"_findSuitableMolecule",value:function(n,i){for(var s in n)if(s!=="xmlNode")if(s==="molecule"){if(n.molecule&&(n.molecule.atomArray&&n.molecule.atomArray.atom&&i.push(n),Array.isArray(n.molecule)))for(var o=0;o<n.molecule.length;o++)n.molecule[o].atomArray&&n.molecule[o].atomArray.atom&&i.push({molecule:n.molecule[o]})}else n[s]&&n[s]!==null&&Di(n[s])==="object"&&this._findSuitableMolecule(n[s],i)}},{key:"_selectComponents",value:function(n){var i=new DOMParser,s=i.parseFromString(n,"application/xml"),o=this._traverseData(s),l,c=this;function f(m){var v=[];if(m.molecule&&m.molecule.atomArray&&m.molecule.atomArray.atom)Array.isArray(m.molecule.atomArray.atom)?v=m.molecule.atomArray.atom:v.push(m.molecule.atomArray.atom);else if(!m.molecule){var y={};return y.atomLabels=null,y.labelsCount=1,y}m.molecule.molecule&&c._extractSGroups(m.molecule.molecule,v);for(var S,_=v.length,x=0;x<_;x++)S=v[x],S.edges=[];var b=[];m.molecule.bondArray&&m.molecule.bondArray.bond&&(Array.isArray(m.molecule.bondArray.bond)?b=m.molecule.bondArray.bond:b.push(m.molecule.bondArray.bond));var M;_=b.length,c._rebuidBondIndexes(v,b);function E(X){return M=b[X],S=v[M.start],!S||(S.edges.push(M.end),S=v[M.end],!S)?!1:(S.edges.push(M.start),!0)}for(var T=0;T<_;T++)if(E(T)){var R=M.xmlNode.getAttribute("order"),V=parseInt(R,10);if(b[T].order=0,b[T].type=M1.BondType.UNKNOWN,V>1)b[T].order=V;else{var Y=BV[R];Y!==void 0&&(b[T].order=Y,R==="A"&&(b[T].type=M1.BondType.AROMATIC))}}_=v.length;for(var $=0;$<_;$++)S=v[$],S.edges.sort();var W=c._breadWidthSearch(v,0),j={};return j.atoms=v,j.bonds=b,j.labels=W.atomLabels,j.count=Math.min(1,W.labelsCount),j.curr=-1,j.originalCML=s,j}o.cml?l=o.cml:l=o;var d=[],p=[];return this._findSuitableMolecule(l,p),this._readOnlyOneMolecule&&p.length>1&&p.splice(1,p.length-1),p.forEach(function(m){var v=f(m);v.atoms.length>0&&d.push(v)}),d}},{key:"_packLabel",value:function(n,i){var s=16;return(i<<s)+n}},{key:"_unpackLabel",value:function(n){var i=16,s=(1<<i)-1;return{molId:n>>>i,compId:n&s}}},{key:"_breadWidthSearch",value:function(n,i){var s=new Array(n.length),o;for(o=0;o<s.length;o++)s[o]=this._packLabel(0,i);for(var l=[],c=0,f=n.length;f>0;){c++;var d=-1;for(o=0;o<s.length;o++)if(this._unpackLabel(s[o]).compId===0){d=o;break}if(d<0)break;for(l.push(n[d]),s[d]=this._packLabel(c,i),f--;l.length>0;){var p=l.shift();if(p)for(var m=0;m<p.edges.length;m++)s[p.edges[m]]!==c&&(l.push(n[p.edges[m]]),s[p.edges[m]]=c,f--)}}var v={};return v.atomLabels=s,v.labelsCount=c,v}},{key:"_parseBond",value:function(n,i,s,o){if(n>=0){var l=[Math.min(n,i),Math.max(n,i)];this._complex.addBond(l[0],l[1],s,o,!0)}}},{key:"_fixBondsArray",value:function(){for(var n=this._serialAtomMap={},i=this._complex,s=i._atoms,o=0,l=s.length;o<l;++o){var c=s[o];n[c.serial]=c}for(var f=i._bonds,d=this.logger,p=0,m=f.length;p<m;++p){var v=f[p];v._right<v._left&&d.debug("_fixBondsArray: Logic error."),v._left=n[v._left]||null,v._right=n[v._right]||null}}},{key:"_parseSet",value:function(n){var i=this._complex=new kp,s=n,o=s.curr,l=s.atoms,c=s.labels,f=null,d,p,m=l.length;function v(he){he.xmlNodeRef=f,f.x2&&(f.x3=f.x2,delete f.x2),f.y2&&(f.y3=f.y2,delete f.y2),f.z3||(f.z3="0.0"),f.complexAtom=he}var y={},S=[];for(d=0;d<m;d++)S.push(d);for(S.sort(function(he,pe){return c[he]-c[pe]}),d=0;d<m;d++){var _=0,x=c[S[d]];if(this._unpackLabel(x).molId===this._unpackLabel(o).molId){f=l[S[d]];var b=f.elementType;if(f.sgroupRef)for(var M=f.sgroupRef.length,E=0;E<M;++E)i._sgroups.push(f.sgroupRef[E]);if(f.x3||f.x2){var T=this._unpackLabel(x).compId,R=" ",V=T,Y=" ",$=T.toString();$.length===1&&($="0".concat($));var W="N".concat($),j=y[R];(!j||j.getName()!==R)&&(y[R]=j=this._complex.getChain(R)||this._complex.addChain(R),this._residue=null);var X=this._residue;(!X||X.getSequence()!==V||X.getICode()!==Y)&&(this._residue=X=j.addResidue(W,V,Y));var P=null;f.x3?P=new C(parseFloat(f.x3),parseFloat(f.y3),parseFloat(f.z3)):f.x2&&(P=new C(parseFloat(f.x2),parseFloat(f.y2),0));var N=Ao.ByName[f.elementType.toUpperCase()];N||(N=JSON.parse(JSON.stringify(Ao.ByName[Object.keys(Ao.ByName)[Object.keys(Ao.ByName).length-1]])),N.number+=1,N.name=f.elementType.toUpperCase(),N.fullName="Unknown",Ao.ByName[f.elementType.toUpperCase()]=N);var I=parseInt(f.id.replace(/[^0-9]/,""),10),G=X.addAtom(b,N,P,Ao.Role.SG,!0,I," ",1,0,_);f.hydrogenCount&&(G.hydrogenCount=parseInt(f.hydrogenCount,10)),f.mrvValence&&(G.valence=parseInt(f.mrvValence,10)),v(G)}}}for(y=null,d=0;d<s.bonds.length;d++){var ee=s.bonds[d];if(this._unpackLabel(c[ee.start]).molId===this._unpackLabel(o).molId&&this._unpackLabel(c[ee.end]).molId===this._unpackLabel(o).molId){if(f=l[ee.start],!f||!l[ee.end])continue;this._parseBond(parseInt(f.id.replace(/[^0-9]/,""),10),parseInt(l[ee.end].id.replace(/[^0-9]/,""),10),ee.order,ee.type)}}for(d=0;d<this._complex.getSGroupCount();d++){var re=this._complex.getSGroups()[d];for(p=0;p<re._atoms.length;p++)re._atoms[p]=re._atoms[p].complexAtom}for(d=0;d<m;d++)this._unpackLabel(c[d]).molId===this._unpackLabel(o).molId&&(f=l[d],f.complexAtom=null,delete f.complexAtom);return this._complex.originalCML=s.originalCML,this._fixBondsArray(),i.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._serialAtomMap=null,this._complex=null,i}},{key:"parseSync",value:function(){var n=[],i=this,s=this._selectComponents(this._data);s.forEach(function(c){c.curr=2,c.count===0&&(c.count=1);for(var f=0;f<c.count;f++)c.curr=f+1,n.push(i._parseSet(c,!1))});var o=0;if(n.forEach(function(c){o+=c.getAtomCount()}),o<=0)throw new Error("The data does not contain valid atoms");if(n.length>1){var l=new kp;return l.joinComplexes(n),l.originalCML=n[0].originalCML,l}return n.length===1?n[0]:new kp}}],[{key:"canProbablyParse",value:function(n){return xe.isString(n)&&zV.test(n)}}]),t}(Xr);sv.formats=["cml"];sv.extensions=[".cml"];var hm={exports:{}};(function(a,e){(function(t,r){r(e)})(hS,function(t){function r(A,D,O){for(var te=(A.byteLength,0),q=O.length;q>te;te++){var Ae=O.charCodeAt(te);if(128>Ae)A.setUint8(D++,Ae>>>0&127|0);else if(2048>Ae)A.setUint8(D++,Ae>>>6&31|192),A.setUint8(D++,Ae>>>0&63|128);else if(65536>Ae)A.setUint8(D++,Ae>>>12&15|224),A.setUint8(D++,Ae>>>6&63|128),A.setUint8(D++,Ae>>>0&63|128);else{if(!(1114112>Ae))throw new Error("bad codepoint "+Ae);A.setUint8(D++,Ae>>>18&7|240),A.setUint8(D++,Ae>>>12&63|128),A.setUint8(D++,Ae>>>6&63|128),A.setUint8(D++,Ae>>>0&63|128)}}}function n(A){for(var D=0,O=0,te=A.length;te>O;O++){var q=A.charCodeAt(O);if(128>q)D+=1;else if(2048>q)D+=2;else if(65536>q)D+=3;else{if(!(1114112>q))throw new Error("bad codepoint "+q);D+=4}}return D}function i(A,D,O){var te=Di(A);if(te==="string"){var q=n(A);if(32>q)return D.setUint8(O,160|q),r(D,O+1,A),1+q;if(256>q)return D.setUint8(O,217),D.setUint8(O+1,q),r(D,O+2,A),2+q;if(65536>q)return D.setUint8(O,218),D.setUint16(O+1,q),r(D,O+3,A),3+q;if(4294967296>q)return D.setUint8(O,219),D.setUint32(O+1,q),r(D,O+5,A),5+q}if(A instanceof Uint8Array){var q=A.byteLength,Ae=new Uint8Array(D.buffer);if(256>q)return D.setUint8(O,196),D.setUint8(O+1,q),Ae.set(A,O+2),2+q;if(65536>q)return D.setUint8(O,197),D.setUint16(O+1,q),Ae.set(A,O+3),3+q;if(4294967296>q)return D.setUint8(O,198),D.setUint32(O+1,q),Ae.set(A,O+5),5+q}if(te==="number"){if(!isFinite(A))throw new Error("Number not finite: "+A);if(Math.floor(A)!==A)return D.setUint8(O,203),D.setFloat64(O+1,A),9;if(A>=0){if(128>A)return D.setUint8(O,A),1;if(256>A)return D.setUint8(O,204),D.setUint8(O+1,A),2;if(65536>A)return D.setUint8(O,205),D.setUint16(O+1,A),3;if(4294967296>A)return D.setUint8(O,206),D.setUint32(O+1,A),5;throw new Error("Number too big 0x"+A.toString(16))}if(A>=-32)return D.setInt8(O,A),1;if(A>=-128)return D.setUint8(O,208),D.setInt8(O+1,A),2;if(A>=-32768)return D.setUint8(O,209),D.setInt16(O+1,A),3;if(A>=-2147483648)return D.setUint8(O,210),D.setInt32(O+1,A),5;throw new Error("Number too small -0x"+(-A).toString(16).substr(1))}if(A===null)return D.setUint8(O,192),1;if(te==="boolean")return D.setUint8(O,A?195:194),1;if(te==="object"){var q,et=0,Re=Array.isArray(A);if(Re)q=A.length;else{var $e=Object.keys(A);q=$e.length}var et;if(16>q?(D.setUint8(O,q|(Re?144:128)),et=1):65536>q?(D.setUint8(O,Re?220:222),D.setUint16(O+1,q),et=3):4294967296>q&&(D.setUint8(O,Re?221:223),D.setUint32(O+1,q),et=5),Re)for(var Ze=0;q>Ze;Ze++)et+=i(A[Ze],D,O+et);else for(var Ze=0;q>Ze;Ze++){var yt=$e[Ze];et+=i(yt,D,O+et),et+=i(A[yt],D,O+et)}return et}throw new Error("Unknown type "+te)}function s(A){var D=Di(A);if(D==="string"){var O=n(A);if(32>O)return 1+O;if(256>O)return 2+O;if(65536>O)return 3+O;if(4294967296>O)return 5+O}if(A instanceof Uint8Array){var O=A.byteLength;if(256>O)return 2+O;if(65536>O)return 3+O;if(4294967296>O)return 5+O}if(D==="number"){if(Math.floor(A)!==A)return 9;if(A>=0){if(128>A)return 1;if(256>A)return 2;if(65536>A)return 3;if(4294967296>A)return 5;throw new Error("Number too big 0x"+A.toString(16))}if(A>=-32)return 1;if(A>=-128)return 2;if(A>=-32768)return 3;if(A>=-2147483648)return 5;throw new Error("Number too small -0x"+A.toString(16).substr(1))}if(D==="boolean"||A===null)return 1;if(D==="object"){var O,te=0;if(Array.isArray(A)){O=A.length;for(var q=0;O>q;q++)te+=s(A[q])}else{var Ae=Object.keys(A);O=Ae.length;for(var q=0;O>q;q++){var Re=Ae[q];te+=s(Re)+s(A[Re])}}if(16>O)return 1+te;if(65536>O)return 3+te;if(4294967296>O)return 5+te;throw new Error("Array or object too long 0x"+O.toString(16))}throw new Error("Unknown type "+D)}function o(A){var D=new ArrayBuffer(s(A)),O=new DataView(D);return i(A,O,0),new Uint8Array(D)}function l(A,D,O){return D?new A(D.buffer,D.byteOffset,D.byteLength/(O||1)):void 0}function c(A){return l(DataView,A)}function f(A){return l(Uint8Array,A)}function d(A){return l(Int8Array,A)}function p(A){return l(Int32Array,A,4)}function m(A){return l(Float32Array,A,4)}function v(A,D){var O=A.length/2;D||(D=new Int16Array(O));for(var te=0,q=0;O>te;++te,q+=2)D[te]=A[q]<<8^A[q+1]<<0;return D}function y(A,D){var O=A.length;D||(D=new Uint8Array(2*O));for(var te=c(D),q=0;O>q;++q)te.setInt16(2*q,A[q]);return f(D)}function S(A,D){var O=A.length/4;D||(D=new Int32Array(O));for(var te=0,q=0;O>te;++te,q+=4)D[te]=A[q]<<24^A[q+1]<<16^A[q+2]<<8^A[q+3]<<0;return D}function _(A,D){var O=A.length;D||(D=new Uint8Array(4*O));for(var te=c(D),q=0;O>q;++q)te.setInt32(4*q,A[q]);return f(D)}function x(A,D){var O=A.length;D||(D=new Float32Array(O/4));for(var te=c(D),q=c(A),Ae=0,Re=0,$e=O/4;$e>Ae;++Ae,Re+=4)te.setFloat32(Re,q.getFloat32(Re),!0);return D}function b(A,D,O){var te=A.length,q=1/D;O||(O=new Float32Array(te));for(var Ae=0;te>Ae;++Ae)O[Ae]=A[Ae]*q;return O}function M(A,D,O){var te=A.length;O||(O=new Int32Array(te));for(var q=0;te>q;++q)O[q]=Math.round(A[q]*D);return O}function E(A,D){var O,te;if(!D){var q=0;for(O=0,te=A.length;te>O;O+=2)q+=A[O+1];D=new A.constructor(q)}var Ae=0;for(O=0,te=A.length;te>O;O+=2)for(var Re=A[O],$e=A[O+1],et=0;$e>et;++et)D[Ae]=Re,++Ae;return D}function T(A){if(A.length===0)return new Int32Array;var D,O,te=2;for(D=1,O=A.length;O>D;++D)A[D-1]!==A[D]&&(te+=2);var q=new Int32Array(te),Ae=0,Re=1;for(D=1,O=A.length;O>D;++D)A[D-1]!==A[D]?(q[Ae]=A[D-1],q[Ae+1]=Re,Re=1,Ae+=2):++Re;return q[Ae]=A[A.length-1],q[Ae+1]=Re,q}function R(A,D){var O=A.length;D||(D=new A.constructor(O)),O&&(D[0]=A[0]);for(var te=1;O>te;++te)D[te]=A[te]+D[te-1];return D}function V(A,D){var O=A.length;D||(D=new A.constructor(O)),D[0]=A[0];for(var te=1;O>te;++te)D[te]=A[te]-A[te-1];return D}function Y(A,D){var O,te,q=A instanceof Int8Array?127:32767,Ae=-q-1,Re=A.length;if(!D){var $e=0;for(O=0;Re>O;++O)A[O]<q&&A[O]>Ae&&++$e;D=new Int32Array($e)}for(O=0,te=0;Re>O;){for(var et=0;A[O]===q||A[O]===Ae;)et+=A[O],++O;et+=A[O],++O,D[te]=et,++te}return D}function $(A,D){var O,te=32767,q=-te-1,Ae=A.length,Re=0;for(O=0;Ae>O;++O){var $e=A[O];$e===0?++Re:Re+=$e===te||$e===q?2:$e>0?Math.ceil($e/te):Math.ceil($e/q)}var et=new Int16Array(Re),Ze=0;for(O=0;Ae>O;++O){var $e=A[O];if($e>=0)for(;$e>=te;)et[Ze]=te,++Ze,$e-=te;else for(;q>=$e;)et[Ze]=q,++Ze,$e-=q;et[Ze]=$e,++Ze}return et}function W(A,D){return R(E(A),D)}function j(A){return T(V(A))}function X(A,D,O){return b(E(A,p(O)),D,O)}function P(A,D){return T(M(A,D))}function N(A,D,O){return b(R(A,p(O)),D,O)}function I(A,D,O){return V(M(A,D),O)}function G(A,D,O){return b(Y(A,p(O)),D,O)}function ee(A,D,O){var te=Y(A,p(O));return N(te,D,m(te))}function re(A,D,O){return $(I(A,D))}function he(Ae){var D=c(Ae),O=D.getInt32(0),te=D.getInt32(4),q=Ae.subarray(8,12),Ae=Ae.subarray(12);return[O,Ae,te,q]}function pe(A,D,O,te){var q=new ArrayBuffer(12+te.byteLength),Ae=new Uint8Array(q),Re=new DataView(q);return Re.setInt32(0,A),Re.setInt32(4,D),O&&Ae.set(O,8),Ae.set(te,12),Ae}function Ie(A){var D=A.length,O=f(A);return pe(2,D,void 0,O)}function De(A){var D=A.length,O=_(A);return pe(4,D,void 0,O)}function Le(A,D){var O=A.length/D,te=_([D]),q=f(A);return pe(5,O,te,q)}function Oe(A){var D=A.length,O=_(T(A));return pe(6,D,void 0,O)}function ne(A){var D=A.length,O=_(j(A));return pe(8,D,void 0,O)}function at(A,D){var O=A.length,te=_([D]),q=_(P(A,D));return pe(9,O,te,q)}function Ge(A,D){var O=A.length,te=_([D]),q=y(re(A,D));return pe(10,O,te,q)}function We(A){var D={};return be.forEach(function(O){A[O]!==void 0&&(D[O]=A[O])}),A.bondAtomList&&(D.bondAtomList=De(A.bondAtomList)),A.bondOrderList&&(D.bondOrderList=Ie(A.bondOrderList)),D.xCoordList=Ge(A.xCoordList,1e3),D.yCoordList=Ge(A.yCoordList,1e3),D.zCoordList=Ge(A.zCoordList,1e3),A.bFactorList&&(D.bFactorList=Ge(A.bFactorList,100)),A.atomIdList&&(D.atomIdList=ne(A.atomIdList)),A.altLocList&&(D.altLocList=Oe(A.altLocList)),A.occupancyList&&(D.occupancyList=at(A.occupancyList,100)),D.groupIdList=ne(A.groupIdList),D.groupTypeList=De(A.groupTypeList),A.secStructList&&(D.secStructList=Ie(A.secStructList)),A.insCodeList&&(D.insCodeList=Oe(A.insCodeList)),A.sequenceIndexList&&(D.sequenceIndexList=ne(A.sequenceIndexList)),D.chainIdList=Le(A.chainIdList,4),A.chainNameList&&(D.chainNameList=Le(A.chainNameList,4)),D}function Ve(A){function D(et){for(var Ze={},yt=0;et>yt;yt++){var Xt=Ae();Ze[Xt]=Ae()}return Ze}function O(et){var Ze=A.subarray(Re,Re+et);return Re+=et,Ze}function te(et){var Ze=A.subarray(Re,Re+et);Re+=et;var yt=65535;if(et>yt){for(var Xt=[],en=0;en<Ze.length;en+=yt)Xt.push(String.fromCharCode.apply(null,Ze.subarray(en,en+yt)));return Xt.join("")}return String.fromCharCode.apply(null,Ze)}function q(et){for(var Ze=new Array(et),yt=0;et>yt;yt++)Ze[yt]=Ae();return Ze}function Ae(){var et,Ze,yt=A[Re];if(!(128&yt))return Re++,yt;if((240&yt)===128)return Ze=15&yt,Re++,D(Ze);if((240&yt)===144)return Ze=15&yt,Re++,q(Ze);if((224&yt)===160)return Ze=31&yt,Re++,te(Ze);if((224&yt)===224)return et=$e.getInt8(Re),Re++,et;switch(yt){case 192:return Re++,null;case 194:return Re++,!1;case 195:return Re++,!0;case 196:return Ze=$e.getUint8(Re+1),Re+=2,O(Ze);case 197:return Ze=$e.getUint16(Re+1),Re+=3,O(Ze);case 198:return Ze=$e.getUint32(Re+1),Re+=5,O(Ze);case 202:return et=$e.getFloat32(Re+1),Re+=5,et;case 203:return et=$e.getFloat64(Re+1),Re+=9,et;case 204:return et=A[Re+1],Re+=2,et;case 205:return et=$e.getUint16(Re+1),Re+=3,et;case 206:return et=$e.getUint32(Re+1),Re+=5,et;case 208:return et=$e.getInt8(Re+1),Re+=2,et;case 209:return et=$e.getInt16(Re+1),Re+=3,et;case 210:return et=$e.getInt32(Re+1),Re+=5,et;case 217:return Ze=$e.getUint8(Re+1),Re+=2,te(Ze);case 218:return Ze=$e.getUint16(Re+1),Re+=3,te(Ze);case 219:return Ze=$e.getUint32(Re+1),Re+=5,te(Ze);case 220:return Ze=$e.getUint16(Re+1),Re+=3,q(Ze);case 221:return Ze=$e.getUint32(Re+1),Re+=5,q(Ze);case 222:return Ze=$e.getUint16(Re+1),Re+=3,D(Ze);case 223:return Ze=$e.getUint32(Re+1),Re+=5,D(Ze)}throw new Error("Unknown type 0x"+yt.toString(16))}var Re=0,$e=new DataView(A.buffer);return Ae()}function Te(A,D,O,te){switch(A){case 1:return x(D);case 2:return d(D);case 3:return v(D);case 4:return S(D);case 5:return f(D);case 6:return E(S(D),new Uint8Array(O));case 7:return E(S(D));case 8:return W(S(D));case 9:return X(S(D),S(te)[0]);case 10:return ee(v(D),S(te)[0]);case 11:return b(v(D),S(te)[0]);case 12:return G(v(D),S(te)[0]);case 13:return G(d(D),S(te)[0]);case 14:return Y(v(D));case 15:return Y(d(D))}}function me(A,D){D=D||{};var O=D.ignoreFields,te={};return He.forEach(function(q){var Ae=O?O.indexOf(q)!==-1:!1,Re=A[q];Ae||Re===void 0||(Re instanceof Uint8Array?te[q]=Te.apply(null,he(Re)):te[q]=Re)}),te}function ge(A){return String.fromCharCode.apply(null,A).replace(/\0/g,"")}function se(A,D,O){O=O||{};var te,q,Ae,Re,$e,et,Ze=O.firstModelOnly,yt=D.onModel,Xt=D.onChain,en=D.onGroup,Lt=D.onAtom,Qe=D.onBond,ct=0,ie=0,Mt=0,le=0,Ot=0,Se=-1,Yt=A.chainNameList,rn=A.secStructList,mr=A.insCodeList,Zn=A.sequenceIndexList,Vn=A.atomIdList,U=A.bFactorList,de=A.altLocList,ce=A.occupancyList,_e=A.bondAtomList,Ye=A.bondOrderList;for(te=0,q=A.chainsPerModel.length;q>te&&!(Ze&&ct>0);++te){var xt=A.chainsPerModel[ct];for(yt&&yt({chainCount:xt,modelIndex:ct}),Ae=0;xt>Ae;++Ae){var ut=A.groupsPerChain[ie];if(Xt){var ot=ge(A.chainIdList.subarray(4*ie,4*ie+4)),dt=null;Yt&&(dt=ge(Yt.subarray(4*ie,4*ie+4))),Xt({groupCount:ut,chainIndex:ie,modelIndex:ct,chainId:ot,chainName:dt})}for(Re=0;ut>Re;++Re){var bt=A.groupList[A.groupTypeList[Mt]],vt=bt.atomNameList.length;if(en){var Et=null;rn&&(Et=rn[Mt]);var ft=null;A.insCodeList&&(ft=String.fromCharCode(mr[Mt]));var Un=null;Zn&&(Un=Zn[Mt]),en({atomCount:vt,groupIndex:Mt,chainIndex:ie,modelIndex:ct,groupId:A.groupIdList[Mt],groupType:A.groupTypeList[Mt],groupName:bt.groupName,singleLetterCode:bt.singleLetterCode,chemCompType:bt.chemCompType,secStruct:Et,insCode:ft,sequenceIndex:Un})}for($e=0;vt>$e;++$e){if(Lt){var Ht=null;Vn&&(Ht=Vn[le]);var Gn=null;U&&(Gn=U[le]);var Kt=null;de&&(Kt=String.fromCharCode(de[le]));var qr=null;ce&&(qr=ce[le]),Lt({atomIndex:le,groupIndex:Mt,chainIndex:ie,modelIndex:ct,atomId:Ht,element:bt.elementList[$e],atomName:bt.atomNameList[$e],formalCharge:bt.formalChargeList[$e],xCoord:A.xCoordList[le],yCoord:A.yCoordList[le],zCoord:A.zCoordList[le],bFactor:Gn,altLoc:Kt,occupancy:qr})}le+=1}if(Qe){var jn=bt.bondAtomList;for($e=0,et=bt.bondOrderList.length;et>$e;++$e)Qe({atomIndex1:le-vt+jn[2*$e],atomIndex2:le-vt+jn[2*$e+1],bondOrder:bt.bondOrderList[$e]})}Mt+=1}ie+=1}if(Ot=Se+1,Se=le-1,Qe&&_e)for($e=0,et=_e.length;et>$e;$e+=2){var fn=_e[$e],Kn=_e[$e+1];(fn>=Ot&&Se>=fn||Kn>=Ot&&Se>=Kn)&&Qe({atomIndex1:fn,atomIndex2:Kn,bondOrder:Ye?Ye[$e/2]:null})}ct+=1}}function we(A){return o(We(A))}function Ee(A,D){A instanceof ArrayBuffer&&(A=new Uint8Array(A));var O;return O=A instanceof Uint8Array?Ve(A):A,me(O,D)}function z(A,D,O,te){function q(){try{var Re=Ee(Ae.response);O(Re)}catch($e){te($e)}}var Ae=new XMLHttpRequest;Ae.addEventListener("load",q,!0),Ae.addEventListener("error",te,!0),Ae.responseType="arraybuffer",Ae.open("GET",D+A.toUpperCase()),Ae.send()}function F(A,D,O){z(A,je,D,O)}function ue(A,D,O){z(A,Je,D,O)}var be=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],Fe=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],He=be.concat(Fe),rt="v1.1.0dev",Ke="//mmtf.rcsb.org/v1.0/",je=Ke+"full/",Je=Ke+"reduced/";t.encode=we,t.decode=Ee,t.traverse=se,t.fetch=F,t.fetchReduced=ue,t.version=rt,t.fetchUrl=je,t.fetchReducedUrl=Je,t.encodeMsgpack=o,t.encodeMmtf=We,t.decodeMsgpack=Ve,t.decodeMmtf=me})})(hm,hm.exports);var E1=hm.exports;function VV(a){var e=UV();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function UV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var GV=pt.Complex,HV=pt.Chain,WV=pt.Atom,C1=pt.Element,XV=pt.Helix,YV=pt.Sheet,$V=pt.Strand,qV=pt.Bond,ZV=pt.Assembly,jV=pt.Molecule,dm=function(){function a(e){K(this,a),this._original=Array.from(e),this._original.sort(),this._sum=0;for(var t=0;t<this._original.length;++t)this._sum+=this._original[t]}return J(a,[{key:"compare",value:function(t){var r=t.length;if(r!==this._original.length)return!1;var n=0,i;for(i=0;i<r;++i)n+=t[i];if(n!==this._sum)return!1;var s=Array.from(t);for(s.sort(),i=0;i<r;++i)if(s[i]!==this._original[i])return!1;return!0}}]),a}();dm.prototype.constructor=dm;var Da=zn.Type,KV=[Da.HELIX_PI,Da.BEND,Da.HELIX_ALPHA,Da.STRAND,Da.HELIX_310,Da.BRIDGE,Da.TURN,Da.COIL];function JV(a){var e=new Uint8Array(a,0,1);return e[0]}var mh=function(a){ve(t,a);var e=VV(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._options.fileType="mmtf",i}return J(t,[{key:"_onModel",value:function(n){}},{key:"_onChain",value:function(n){if(n.modelIndex===0){var i=new HV(this._complex,n.chainName);this._complex._chains[n.chainIndex]=i,i._index=n.chainIndex}}},{key:"_onGroup",value:function(n){if(n.modelIndex===0&&!(this.settings.now.nowater&&(n.groupName==="HOH"||n.groupName==="WAT"))){var i=this._complex._chains[n.chainIndex],s=n.insCode.charCodeAt(0)?n.insCode:"",o=i.addResidue(n.groupName,n.groupId,s);o._index=n.groupIndex,this._updateSecStructure(this._complex,o,n)}}},{key:"_onAtom",value:function(n){if(n.modelIndex===0){var i=n.altLoc.charCodeAt(0)?n.altLoc:"",s=new WV(n.groupIndex,n.atomName,C1.getByName(n.element.toUpperCase()),new C(n.xCoord,n.yCoord,n.zCoord),C1.Role[n.atomName],!1,n.atomId,i,n.occupancy,n.bFactor,n.formalCharge);this._complex._atoms[n.atomIndex]=s,s.index=n.atomIndex,this._serialAtomMap[n.atomId]=s}}},{key:"_onBond",value:function(n){var i=Math.max(n.atomIndex1,n.atomIndex2);if(!(i>=this._complex._atoms.length)){var s=Math.min(n.atomIndex1,n.atomIndex2);this._complex.addBond(this._complex._atoms[s],this._complex._atoms[i],n.bondOrder,qV.BondType.UNKNOWN,!0)}}},{key:"_updateSecStructure",value:function(n,i,s){var o=[3,-1,1,-1,5];if(!xe.isUndefined(s)&&s.secStruct===this._ssType){i._secondary=this._ssStruct,this._ssStruct&&(this._ssStruct.term=i);return}if(!xe.isUndefined(s)){var l=KV[s.secStruct];this._ssType=s.secStruct,this._ssStart=i;var c=null;switch(this._ssType){case-1:case 7:break;case 0:case 2:case 4:c=new XV(o[this._ssType],i,i,0,"","",0),n._helices.push(c);break;case 3:{var f=new YV("",0);n._sheets.push(f),c=new $V(f,i,i,0,null,null);break}default:l!==void 0&&(c=new zn(l,i,i));break}this._ssStruct=c,i._secondary=c,c&&n.structures.push(c)}}},{key:"_updateMolecules",value:function(n){var i=n.entityList;if(i)for(var s=n.chainsPerModel[0],o=0;o<i.length;o++){for(var l=i[o],c=l.chainIndexList,f=[],d=0;d<c.length;d++){var p=c[d];if(!(p>=s)){var m=this._complex._chains[p];f=f.concat(m._residues.slice())}}var v=new jV(this._complex,l.description,o+1);v.residues=f,this._complex._molecules[o]=v}}},{key:"_traverse",value:function(n){var i=this,s=this._complex.metadata;s.id=n.structureId,s.title=[],s.title[0]=n.title,s.date=n.releaseDate,s.format="mmtf";var o={onModel:function(c){i._onModel(c)},onChain:function(c){i._onChain(c)},onGroup:function(c){i._onGroup(c)},onAtom:function(c){i._onAtom(c)},onBond:function(c){i._onBond(c)}};this._ssType=-1,this._ssStruct=null,this._ssStart=null,E1.traverse(n,o),this._updateSecStructure(this._complex),this._updateMolecules(n)}},{key:"_linkAtomsToResidues",value:function(){for(var n=0;n<this._complex._atoms.length;++n){var i=this._complex._atoms[n],s=this._complex._residues[i.residue];i.residue=s,s._atoms.push(i)}}},{key:"_findSynonymousChains",value:function(){for(var n={},i=0;i<this._complex._chains.length;++i){var s=this._complex._chains[i],o=s.getName();n.hasOwnProperty(o)||(n[o]=[]),n[o].push(s._index)}return n}},{key:"_parseAssemblyInfo",value:function(n){var i,s,o,l=[],c=this.logger;for(i=0;i<n.bioAssemblyList.length;++i){var f=n.bioAssemblyList[i];if(f.transformList.length!==0){var d=f.transformList[0].chainIndexList,p=new dm(d),m={};for(s=0;s<d.length;++s)m[this._complex._chains[d[s]].getName()]=1;var v=[],y=void 0;for(y in m)m.hasOwnProperty(y)&&Array.prototype.push.apply(v,this._chainsByName[y]);p.compare(v)||c.debug("MMTF: Assembly is missing some of the synonymous chains. Skipping...");var S=new ZV(this._complex);for(y in m)m.hasOwnProperty(y)&&S.addChain(y);for(S.addMatrix(new Xe().fromArray(f.transformList[0].matrix).transpose()),s=1;s<f.transformList.length;++s){var _=f.transformList[s];if(!p.compare(_.chainIndexList)){c.debug("MMTF: Chain lists differ for different transforms in one assembly. Skipping...");continue}var x=new Xe().fromArray(_.matrix).transpose();for(o=0;o<S.matrices.length&&!S.matrices[o].equals(x);++o);o===S.matrices.length&&S.addMatrix(x)}S.finalize(),l.push(S)}}return l}},{key:"_markHeteroAtoms",value:function(n){for(var i=n.chainsPerModel[0],s=0;s<n.entityList.length;++s){var o=n.entityList[s];if(o.type!=="polymer")for(var l=0;l<o.chainIndexList.length;++l){var c=o.chainIndexList[l];if(!(c>=i))for(var f=this._complex._chains[c],d=0;d<f._residues.length;++d)for(var p=f._residues[d],m=0;m<p._atoms.length;++m)p._atoms[m].het=!0}}}},{key:"_joinSynonymousChains",value:function(){var n,i,s=[],o={};for(n=0;n<this._complex._chains.length;++n){var l=this._complex._chains[n],c=l.getName();if(!o.hasOwnProperty(c)){o[c]=l,l._index=s.length,s.push(l);continue}var f=o[c];for(i=0;i<l._residues.length;++i){var d=l._residues[i];f._residues.push(d),d._chain=f}}this._complex._chains=s}},{key:"parseSync",value:function(){var n=E1.decode(this._data);return this._complex=new GV,this._serialAtomMap={},this._traverse(n),this._linkAtomsToResidues(),this._markHeteroAtoms(n),this._chainsByName=this._findSynonymousChains(),Array.prototype.push.apply(this._complex.units,this._parseAssemblyInfo(n)),this._joinSynonymousChains(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex}}],[{key:"canProbablyParse",value:function(n){return xe.isArrayBuffer(n)&&(JV(n)|1)===223}}]),t}(Xr);mh.formats=["mmtf"];mh.extensions=[".mmtf"];mh.binary=!0;function QV(a){var e=e8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function e8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _i=function(a){ve(t,a);var e=QV(t);function t(r,n,i){var s;return K(this,t),s=e.call(this,"data:".concat(n,":").concat(i,": ").concat(r)),Error.captureStackTrace&&Error.captureStackTrace(si(s),t),s.name="ParsingError",s.parseLine=n,s.parseColumn=i,s}return J(t)}(fc(Error));function vs(a){return a===32||a===10||a===13||a===9}function Op(a,e,t){for(var r=e.length,n=-1;t<r&&(n=e.charCodeAt(t),!(n===a||n===10));)++t;return n===a?t:-1}function t8(a){var e=0,t=0,r=a.length,n=NaN,i=!0,s=1,o=1,l,c=0,f={},d={},p=[],m=0,v="",y=[],S=0,_;function x(){var T;if((n===46||n===63)&&(e+1>=r||vs(a.charCodeAt(e+1)))){++o,++e;return}if(i&&n===59){t=e;var R=0;do{if(t=Op(10,a,t+1),t===-1)throw new _i("Unterminated text block found",s,o);++R}while(t+1<r&&a.charCodeAt(t+1)!==n||t+1>=r);return T=a.substring(e+1,t).replace(/\r/g,""),e=t+2,s+=R,o=1,i=!1,T}if(n===39||n===34){t=e;do if(t=Op(n,a,t+1),t===-1)throw new _i("Unterminated quoted string found",s,o);while(t+1<r&&!vs(a.charCodeAt(t+1)));return T=a.substring(e+1,t),o+=t-e+1,e=t+1,T}for(t=e;t<r&&!vs(a.charCodeAt(t));)++t;T=a.substring(e,t),o+=t-e,e=t;var V=Number(T);return Number.isNaN(V)?T:V}function b(T){p[m++]=T}function M(T){var R=S%m;return y[R].push(T),++S,T}for(;e<=r;){if(n=a.charCodeAt(e),n!==13)if(n===10)i=!0,++s,o=1;else{if(!(n===32||n===9))if(n===35){if(e=Op(10,a,e+1),e===-1)break;continue}else if(c===0)if((n===68||n===100)&&a.substr(e+1,4).toLowerCase()==="ata_"){for(t=e+5,l=t;t<r&&!vs(a.charCodeAt(t));)++t;if(o+=t-e,e=t,l<e){f[a.substring(l,e)]=d={},c=1;continue}else throw new _i("Data block name missing",s,o)}else{if(Number.isNaN(n))break;throw new _i("Unexpected character in state ".concat(c),s,o)}else if(c===1)if((n===68||n===100)&&a.substr(e+1,4).toLowerCase()==="ata_"){c=0;continue}else if(n===95){for(t=e+1,l=t;t<r&&!vs(a.charCodeAt(t));)++t;if(o+=t-e,e=t,l<e){v=a.substring(l,e),c=2;continue}else throw new _i("Tag name missing",s,o)}else if((n===76||n===108)&&a.substr(e+1,4).toLowerCase()==="oop_"){if(e+=5,o+=5,e<r&&!vs(a.charCodeAt(e)))throw new _i("Unexpected character in state ".concat(c),s,o);p=[],m=0,y=[],S=0,c=3;continue}else{if(Number.isNaN(n))break;throw new _i("Unexpected character in state ".concat(c),s,o)}else if(c===2){if(Number.isNaN(n))break;_=x(),xe.set(d,v,_),c=1;continue}else if(c===3)if(n===95){for(t=e+1,l=t;t<r&&!vs(a.charCodeAt(t));)++t;if(o+=t-e,e=t,l<e){b(a.substring(l,e));continue}else throw new _i("Tag name missing",s,o)}else{if(m>0){for(var E=0;E<m;++E)_=[],y[E]=_,xe.set(d,p[E],_);c=4;continue}throw new _i("Data tags are missing inside a loop",s,o)}else if(c===4){(n===68||n===100)&&a.substr(e+1,4).toLowerCase()==="ata_"?c=0:n===95||(n===76||n===108)&&a.substr(e+1,4).toLowerCase()==="oop_"?c=1:Number.isNaN(n)?c=0:M(x());continue}else throw new _i("Unexpected internal state ".concat(c),s,o);i=!1,++o}++e}if(c===2)throw new _i("Unexpected end of file in state ".concat(c),s,o);return f}function ow(a){var e=n8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function n8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var r8=pt.Complex,A1=pt.Element,i8=pt.Helix,a8=pt.Sheet,s8=pt.Strand,o8=pt.Assembly,l8=pt.Molecule,Dp=["auth_seq_id","Cartn_x","Cartn_y","Cartn_z","label_atom_id"],c8={helx:"helix",turn:"turn",strn:"strand"};function u8(a){var e=/[A-Za-z]+/.exec(a);return e?c8[e[0].toLowerCase()]:null}function At(a){return a==null||xe.isArray(a)?a:[a]}function f8(a){var e=a.trim().length===4;return a.slice(0,e?1:2).trim()}var T1=function(a){ve(t,a);var e=ow(t);function t(r){var n;return K(this,t),n=e.call(this),n.name="AtomDataError",n.message=r,n}return J(t)}(fc(Error));function h8(a){if(!a)return null;var e=At(a.id),t=a.matrix,r=a.vector;if(!e||!t||!r)return null;for(var n=[],i=0,s=e.length;i<s;++i){for(var o=new Xe,l=o.elements,c=0;c<3;++c){var f=t[c+1];l[c]=At(f[1])[i],l[c+4]=At(f[2])[i],l[c+8]=At(f[3])[i],l[c+12]=At(r[c+1])[i]}n[e[i]]=o}return n}function d8(a,e){a=xe.isString(a)?a:"".concat(a);for(var t=a.replace(/\)\s*\(/g,"!").replace(/[()']/g,""),r=t.split("!"),n=[],i=0,s=r.length;i<s;++i){for(var o=r[i].split(","),l=[],c=0,f=0,d=o.length;f<d;++f){var p=o[f];if(p.includes("-"))for(var m=p.split("-"),v=parseInt(m[0],10),y=parseInt(m[1],10);v<=y;++v)l[c++]=e[v];else l[c++]=e[p]}n.push(l)}var S=[],_=0;function x(b,M){for(var E=0,T=n[b].length;E<T;++E){var R=M?M.clone():new Xe;R.multiplyMatrices(n[b][E],R),b===0?S[_++]=R:x(b-1,R)}}return x(n.length-1),S}var ov=function(a){ve(t,a);var e=ow(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i.asymDict={},i.molecules=[],i._options.fileType="cif",i}return J(t,[{key:"parseSync",value:function(){this.logger.info("Parsing CIF file..");var n=t8(this._data);return this._toComplex(n)}},{key:"_toComplex",value:function(n){var i=new r8,s=n[Object.keys(n)[0]];return this._extractAtoms(i,s),this._extractSecondary(i,s),this._extractAssemblies(i,s),this._extractMolecules(i,s),this._extractMetadata(i,s),i.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing}),i}},{key:"_extractMetadata",value:function(n,i){var s=n.metadata;s.id=i.entry.id,s.classification=i.struct_keywords.pdbx_keywords;var o=i.database_PDB_rev;s.date=o&&o.date_original?o.date_original:"",s.format="cif",s.title=[],s.title[0]=i.struct.title}},{key:"_extractMolecules",value:function(n,i){var s=i.entity,o=At(s.pdbx_description),l=o.length,c;for(c=0;c<l;c++)this.molecules[c]?this.molecules[c].name=o[c]:this.molecules[c]={name:o[c],residues:[]};var f=n.getMolecules();for(c=0;c<l;c++){var d=this.molecules[c];f[c]=new l8(n,d.name,c+1),f[c].residues=d.residues}}},{key:"_extractAtoms",value:function(n,i){var s=i.atom_site;if(!s)throw new T1("CIF parsing error: atom_site is not specified!");for(var o=0,l=Dp.length;o<l;++o)if(!s[Dp[o]])throw new T1("CIF parsing error: requires field ".concat(Dp[o]," not found!"));for(var c=this.asymDict,f=At(s.auth_seq_id),d=At(s.Cartn_x),p=At(s.Cartn_y),m=At(s.Cartn_z),v=At(s.label_atom_id),y=v.length,S=At(s.group_PDB)||[],_=At(s.auth_asym_id)||[],x=At(s.label_asym_id)||[],b=At(s.id)||[],M=At(s.pdbx_PDB_ins_code)||[],E=At(s.label_comp_id)||[],T=At(s.type_symbol)||[],R=At(s.B_iso_or_equiv)||[],V=At(s.occupancy)||[],Y=At(s.pdbx_formal_charge)||[],$=At(s.label_alt_id)||[],W=At(s.pdbx_PDB_model_num)||[],j=At(s.label_entity_id)||[],X=null,P=null,N=0;N<y;++N){var I=W[N]||1;if(I===1){var G=String(_[N]||" ");(!X||X.getName()!==G)&&(X=n.getChain(G)||n.addChain(G)),c[String(x[N]||" ")]=G;var ee=f[N],re=String(M[N]||" "),he=String(E[N]||"");if(!P||P.getSequence()!==ee||P.getICode()!==re){P=X.addResidue(he,ee,re);var pe=j[N]-1,Ie=this.molecules[pe];Ie||(this.molecules[pe]={name:"",residues:[]},Ie=this.molecules[pe]),Ie.residues.push(P)}var De=v[N],Le=T[N]||f8(De),Oe=A1.getByName(Le),ne=A1.Role[De.trim()],at=new C(d[N],p[N],m[N]),Ge=S[N]==="HETATM"||!1,We=b[N]||N,Ve=R[N]||0,Te=V[N]||0,me=String($[N]||""),ge=Y[N]||0;P.addAtom(De,Oe,at,ne,Ge,We,me,Te,Ve,ge)}}}},{key:"_extractSecondary",value:function(n,i){i.struct_conf&&this._extractConfs(n,i.struct_conf),i.struct_sheet_range&&this._extractSheets(n,i.struct_sheet_range)}},{key:"_extractSheets",value:function(n,i){var s=this.asymDict;if(!i.sheet_id||!i.id||!i.beg_label_seq_id||!i.end_label_seq_id||!i.beg_label_asym_id)return;var o=n._sheets;function l(X){for(var P=o.length,N=0;N<P;++N)if(o[N]._name===X)return o[N];return o[P]=new a8(X,0),o[P]}for(var c=At(i.sheet_id),f=At(i.id),d=At(i.beg_auth_seq_id),p=At(i.end_auth_seq_id),m=At(i.beg_label_asym_id),v=At(i.pdbx_beg_PDB_ins_code)||[],y=At(i.pdbx_end_PDB_ins_code)||[],S=0,_=f.length;S<_;++S){var x=n.getChain(s[m[S]]),b=l(c[S]),M=d[S],E=p[S],T=v[S]||" ",R=y[S]||" ",V=x.findResidue(M,T),Y=x.findResidue(E,R);if(!(!V||!Y)){for(var $=new s8(b,V[0],Y[0],0,null,null),W=x.getResidues(),j=V[1];j<=Y[1];++j)W[j]._secondary=$;b.addStrand($),n.structures.push($)}}}},{key:"_extractConfs",value:function(n,i){var s=this.asymDict;if(!(!i.conf_type_id||!i.beg_label_seq_id||!i.end_label_seq_id||!i.beg_label_asym_id))for(var o=At(i.conf_type_id),l=At(i.beg_auth_seq_id),c=At(i.pdbx_beg_PDB_ins_code)||[],f=At(i.end_auth_seq_id),d=At(i.pdbx_end_PDB_ins_code)||[],p=At(i.details)||[],m=At(i.pdbx_PDB_helix_length)||[],v=At(i.pdbx_PDB_helix_class)||[],y=At(i.id)||[],S=At(i.beg_label_asym_id),_=0,x=o.length;_<x;++_){var b=u8(o[_]);if(b){var M=y[_]||o[_],E=n.getChain(s[S[_]]),T=l[_],R=f[_],V=c[_]||" ",Y=d[_]||" ",$=E.findResidue(T,V),W=E.findResidue(R,Y);if(!(!$||!W)){var j=p[_]||"",X=m[_]||0,P=v[_]||" ",N=void 0;if(b==="helix"){var I=n._helices.length;N=new i8(P,$[0],W[0],I,M,j,X),n.addHelix(N),n.structures.push(N)}else b==="turn"?(N=new zn(zn.Type.TURN,$[0],W[0]),n.structures.push(N)):N=null;if(N)for(var G=E.getResidues(),ee=$[1];ee<=W[1];++ee)G[ee]._secondary=N}}}}},{key:"_extractAssemblies",value:function(n,i){var s=this.asymDict,o=i.pdbx_struct_assembly_gen;if(o){var l=At(o.assembly_id),c=At(o.oper_expression),f=At(o.asym_id_list);if(!(!l||!c||!f)){var d=h8(i.pdbx_struct_oper_list);if(d)for(var p=0,m=l.length;p<m;++p){for(var v=new o8(n),y=d8(c[p],d),S=f[p].split(","),_=0,x=S.length;_<x;++_){var b=S[_].trim();b.length>0&&v.addChain(s[b])}v.matrices=y,n.units.push(v)}}}}}],[{key:"canProbablyParse",value:function(n){return xe.isString(n)&&/^\s*data_/i.test(n)}}]),t}(Xr);ov.formats=["cif","mmcif"];ov.extensions=[".cif",".mmcif"];var Wt={singular:0,vector:1,array:2,buffer:3},lw=function(){function a(){K(this,a),qe(this,"_xyz2crs",[]),qe(this,"_origin",new C(0,0,0)),this._header={},this._boxSize=new C,this._boxStart=new C,this._header.delta={},this._header.extent=[],this._header.nstart=[],this._header.grid=[],this._header.crs2xyz=[],this._header.cellDims=new C,this._header.angles=[],this._header.origin=new C(0,0,0),this._header.dmin=0,this._header.dmean=0,this._header.dmax=0}return J(a,[{key:"_typedCheck",value:function(){if(xe.isTypedArray(this._buff))this._buff=this._buff.buffer;else if(!xe.isArrayBuffer(this._buff))throw new TypeError("Expected ArrayBuffer or TypedArray")}},{key:"_fillHeader",value:function(t,r){for(var n in t)if(t.hasOwnProperty(n))switch(t[n][0]){case Wt.singular:this._header[n]=r[t[n][1]][t[n][2]];break;case Wt.array:this._parseArray(this._header[n],r[t[n][1]],t[n][2]);break;case Wt.vector:this._parseVector(this._header[n],r[t[n][1]],t[n][2]);break;case Wt.buffer:this._header[n]=new Uint8Array(r[t[n][1]],[t[n][2]]*4,[t[n][3]]*4);break}}},{key:"_parseVector",value:function(t,r,n){var i=[r[n],r[n+1],r[n+2]];t.x=i[0],t.y=i[1],t.z=i[2]}},{key:"_parseArray",value:function(t,r,n){t[0]=r[n],t[1]=r[n+1],t[2]=r[n+2]}},{key:"_parseHeader",value:function(t){}},{key:"_setAxisIndices",value:function(){}},{key:"_setOrigins",value:function(){}},{key:"_getAxis",value:function(){var t=this._header,r=t.cellDims.x/t.grid[0],n=t.cellDims.y/t.grid[1],i=t.cellDims.z/t.grid[2],s=pn(t.angles,3),o=s[0],l=s[1],c=s[2],f=Math.cos(l),d=(Math.cos(o)-Math.cos(l)*Math.cos(c))/Math.sin(c),p=Math.sqrt(1-f*f-d*d),m=new C(r,0,0),v=new C(Math.cos(c)*n,Math.sin(c)*n,0),y=new C(f*i,d*i,p*i);return[m,v,y]}},{key:"_getXYZdim",value:function(){return[this._header.extent[this._xyz2crs[0]],this._header.extent[this._xyz2crs[1]],this._header.extent[this._xyz2crs[2]]]}},{key:"_getVolumeInfo",value:function(){var t=xe.pick(this._header,["dmean","dmin","dmax","sd","delta"]);return t.obtuseAngle=this._header.angles.map(function(r){return+(r>=Math.PI/2)}),t}},{key:"_setBoxParams",value:function(t,r,n){var i=this,s=0,o=0,l=pn(this._header.angles,3),c=l[0],f=l[1],d=l[2];d>=Math.PI/2&&(s+=Math.abs(r.x)),f>=Math.PI/2&&(s+=Math.abs(n.x)),c>=Math.PI/2&&(o+=Math.abs(n.y)),this._boxStart=new C(this._origin.x-s,this._origin.y-o,this._origin.z),this._boxSize=new C(Math.abs(t.x)+Math.abs(r.x)+Math.abs(n.x),Math.abs(r.y)+Math.abs(n.y),Math.abs(n.z));var p=function(v,y){return Math.abs(v[y])/i._boxSize[y]};this._header.delta.x=p(r,"x"),this._header.delta.y=p(n,"x"),this._header.delta.z=p(n,"y")}},{key:"_getXYZbox",value:function(){return new An(this._boxStart.clone(),this._boxStart.clone().add(this._boxSize))}},{key:"_toXYZData",value:function(){}},{key:"parse",value:function(t){return this._parseHeader(t),this._setOrigins(),new Km(Float32Array,this._getXYZdim(),this._getXYZbox(),1,this._toXYZData(),this._getVolumeInfo())}}]),a}();function cw(a){var e=p8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function p8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var m8={extent:[Wt.array,"u32",0],type:[Wt.singular,"u32",3],nstart:[Wt.array,"i32",4],grid:[Wt.array,"u32",7],cellDims:[Wt.vector,"f32",10],angles:[Wt.array,"f32",13],crs2xyz:[Wt.array,"i32",16],dmin:[Wt.singular,"f32",19],dmax:[Wt.singular,"f32",20],dmean:[Wt.singular,"f32",21],ispg:[Wt.singular,"u32",22],nsymbt:[Wt.singular,"u32",23],lksflg:[Wt.singular,"u32",24],customData:[Wt.buffer,"buffer",25,9],origin:[Wt.vector,"f32",34],map:[Wt.buffer,"buffer",52,1],machine:[Wt.singular,"u32",53],sd:[Wt.singular,"f32",54],nlabel:[Wt.singular,"f32",55],label:[Wt.buffer,"buffer",56,200]},v8=function(a){ve(t,a);var e=cw(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_parseHeader",value:function(n){this._buff=n,this._typedCheck();var i={};i.u32=new Uint32Array(this._buff,0,56),i.i32=new Int32Array(this._buff,0,56),i.f32=new Float32Array(this._buff,0,56),i.buffer=this._buff;var s=this._header;this._fillHeader(m8,i),s.angles.forEach(function(o,l,c){c[l]*=Math.PI/180})}},{key:"_setAxisIndices",value:function(){var n=this._header;n.cellDims.x===0&&n.cellDims.y===0&&n.cellDims.z===0&&n.cellDims.set(1,1,1);var i=this._header.crs2xyz;i[0]===0&&i[1]===0&&i[2]===0&&(i[0]=1,i[1]=2,i[2]=3);var s=this._xyz2crs;s[i[0]-1]=0,s[i[1]-1]=1,s[i[2]-1]=2}},{key:"_setOrigins",value:function(){var n=this._getAxis(),i=pn(n,3),s=i[0],o=i[1],l=i[2];this._setAxisIndices();var c=this._header,f=this._xyz2crs;if(c.origin.x===0&&c.origin.y===0&&c.origin.z===0?(this._origin.addScaledVector(s,c.nstart[f[0]]),this._origin.addScaledVector(o,c.nstart[f[1]]),this._origin.addScaledVector(l,c.nstart[f[2]])):this._origin=c.origin,s.multiplyScalar(c.extent[f[0]]-1),o.multiplyScalar(c.extent[f[1]]-1),l.multiplyScalar(c.extent[f[2]]-1),c.type===2)this._data=new Float32Array(this._buff,1024+c.nsymbt,c.extent[0]*c.extent[1]*c.extent[2]);else throw new Error("CCP4: Unsupported format ".concat(c.type));this._setBoxParams(s,o,l)}},{key:"_toXYZData",value:function(){var n=this._header,i=this._data,s=this._xyz2crs,o=new Float32Array(i.length),l=this._getXYZdim(),c=l[0],f=l[1],d=0,p=[],m,v,y;for(p[2]=0;p[2]<n.extent[2];p[2]++)for(p[1]=0;p[1]<n.extent[1];p[1]++)for(p[0]=0;p[0]<n.extent[0];p[0]++,d++)m=p[s[0]],v=p[s[1]],y=p[s[2]],o[m+c*(v+f*y)]=i[d];return o}}]),t}(lw),vh=function(a){ve(t,a);var e=cw(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._options.fileType="ccp4",i.model=new v8,i}return J(t,[{key:"parseSync",value:function(){return this.model.parse(this._data)}}],[{key:"canProbablyParse",value:function(n){return!1}}]),t}(Xr);vh.formats=["ccp4"];vh.extensions=[".ccp4",".map",".mrc"];vh.binary=!0;function g8(a){var e=_8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function _8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var y8=pt.Complex,x8=pt.Element,S8=pt.Molecule,lv=function(a){ve(t,a);var e=g8(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._complex=null,i._atomsInf=null,i._options.fileType="xyz",i._fileName=n.name,i}return J(t,[{key:"_parseToAtomsInf",value:function(n){var i=n.indexOf(`
`),s=parseInt(n.substring(0,i),10),o=n.indexOf(`
`,i+1),l=n.slice(i+1,o).trim();l.length===0&&(l=this._fileName);var c=o+n.substring(o).search(/\S/);if(this._atomsInf=n.substring(c).split(/[\s,]*\n[\s,]*/),!Number.isNaN(s)&&this._atomsInf.length-1!==s){this._complex.error={message:"wrong number of atoms"};return}this._complex.metadata.format="xyz",this._complex.name=l}},{key:"_parseAtomsInf",value:function(){for(var n=!0,i=" ",s=1,o=1,l=0,c=this._complex.addChain("A"),f=c.addResidue("UNK",1," "),d=0;d<this._atomsInf.length-1;d++){var p=this._atomsInf[d].split(/[\s,]+/);if(p.length!==4){this._complex.error={message:"missed parameters"};break}var m=d+1,v=p[0],y=new C(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),S=x8.getByName(v),_=void 0;f.addAtom(v,S,y,_,n,m,i,s,o,l)}var x=new S8(this._complex,this._complex.name,1);x.residues=f,this._complex._molecules[0]=x}},{key:"parseSync",value:function(){var n=this._complex=new y8;if(this._parseToAtomsInf(this._data),this._parseAtomsInf(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex=null,this._atomsInf=null,n.error)throw new Error(n.error.message);return n}}],[{key:"canProbablyParse",value:function(n){return xe.isString(n)&&/^\s*\d+ *\n[^\n]*\n\s*\w{1,3}\s+-?\d/.test(n)}}]),t}(Xr);qe(lv,"formats",["xyz"]);qe(lv,"extensions",[".xyz"]);function w8(a){var e=b8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function b8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var M8=pt.Complex,E8=pt.Element,cv=function(a){ve(t,a);var e=w8(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._options.fileType="pubchem+json",i}return J(t,[{key:"parseSync",value:function(){return this.logger.info("Parsing PubChem JSON file..."),this._toComplex(JSON.parse(this._data))}},{key:"_toComplex",value:function(n){var i=new M8,s=n.PC_Compounds&&n.PC_Compounds[0];return s&&(this._extractAtoms(i,s),i.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing})),i}},{key:"_extractAtoms",value:function(n,i){var s=i.atoms&&i.atoms.aid,o=s&&i.atoms.element;if(!o||s.length!==o.length)throw new Error("Unable to parse atom elements");o=xe.fromPairs(xe.zip(s,o));var l={},c=i.coords&&i.coords[0],f=c&&c.conformers&&c.conformers[0],d=f&&f.x,p=f&&f.y,m=f&&f.z||[];if(s=c&&c.aid,!s||!d||!p)throw new Error("Coordinates are not found in the file");for(var v=n.addChain(" "),y=v.addResidue("UNK",1," "),S=0,_=s.length;S<_;++S){var x=s[S],b=E8.ByAtomicNumber[o[x]],M=new C(d[S],p[S],m[S]||0);l[x]=y.addAtom(b.name,b,M,void 0,!0,x," ",1,0,0)}var E=i.bonds&&i.bonds.aid1,T=i.bonds&&i.bonds.aid2,R=i.bonds&&i.bonds.order||[];if(!(!E||!T||E.length!==T.length))for(var V=0,Y=E.length;V<Y;++V)n.addBond(l[E[V]],l[T[V]],R[V]||1,0,!0)}}],[{key:"canProbablyParse",value:function(n){return xe.isString(n)&&n[0]==="{"}}]),t}(Xr);cv.formats=["pubchem","pubchem+json","pc"];cv.extensions=[".json"];var C8=function(){function a(e){K(this,a),this._strings=e.split(/\r?\n|\r/),this._currentStart=0,this._currentStringIndx=0}return J(a,[{key:"setStart",value:function(t){t>=this._strings.length?(this._currentStart=this._strings.length-1,this._currentStringIndx=this._strings.length-1):(this._currentStart=t,this._currentStringIndx=t)}},{key:"getNextString",value:function(){return this._strings[++this._currentStringIndx]}},{key:"getCurrentString",value:function(){return this._strings[this._currentStringIndx]}},{key:"getStringFromStart",value:function(t){return this._currentStringIndx=this._currentStart+t,this._strings[this._currentStart+t]}},{key:"findNextDataItem",value:function(){for(var t=this.getNextString(),r=!1;!xe.isUndefined(t)&&t.trim()!=="$$$$";){if(t.match(/>\s+<(.*)>/)){r=!0;break}t=this.getNextString()}return r}},{key:"findNextCompoundStart",value:function(){for(var t=this.getCurrentString();!xe.isUndefined(t)&&t.trim()!=="$$$$";)t=this.getNextString();return this.setStart(++this._currentStringIndx),this.probablyHaveDataToParse()}},{key:"probablyHaveDataToParse",value:function(){return this._currentStringIndx<this._strings.length-2}}]),a}();function A8(a){var e=T8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function T8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var R8=pt.Complex,L8=pt.Element,ra=pt.Bond,P8=pt.Molecule,I8=[0,3,2,1,0,-1,-2,-3],N8=[0,1,2,3,1,1,1,2],k8=[ra.BondType.UNKNOWN,ra.BondType.COVALENT,ra.BondType.COVALENT,ra.BondType.COVALENT,ra.BondType.AROMATIC,ra.BondType.UNKNOWN,ra.BondType.AROMATIC,ra.BondType.AROMATIC],O8=/.*(M\s\sEND).*|.*(^$$$$).*|.*>\s+<(.+)>.*/,D8=/.*($$$$).*|.*>\s+<(.+)>.*/,Fp={SDF:"sdf",MOL:"mol"},F8=["PUBCHEM_IUPAC_TRADITIONAL_NAME",/PUBCHEM_(.+)_NAME/,/(.+)name/,/(.+)NAME/],B8=["PUBCHEM_COMPOUND_CID","id","ID",/.*CID/,/.*ID/,/.*id/],z8=["msg","MSG","message","title","description","desc"],Bp=["name","id","title"],V8={name:F8,id:B8,title:z8};function U8(a){if(!a)return"A";for(var e=[];a;)e.push(65+a%26),a=Math.trunc(a/26);return e.length>1&&(e.reverse(),e[0]-=1),String.fromCharCode.apply(String,e)}var uv=function(a){ve(t,a);var e=A8(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._format="sdf",i._complex=null,i._chain=null,i._residue=null,i._molecules=null,i._metadata={},i._metadata.molecules=[],i._currentMolProps={},i._compoundIndx=-1,i._assemblies=[],i._atomsParsed=0,i._atomsIndexes=[],i}return J(t,[{key:"canProbablyParse",value:function(n){return xe.isString(n)&&O8.test(n)}},{key:"_parseHeader",value:function(n){var i={};i.name=n.getStringFromStart(0);var s=parseInt(n.getStringFromStart(1).substr(10,6).trim(),10);i.date=s.toString()||"",i.title=n.getStringFromStart(2),this._metadata.molecules.push(i)}},{key:"_parseAtoms",value:function(n,i){var s,o=this._atomsParsed,l=U8(this._compoundIndx),c="UNK",f=1;this._chain=this._complex.getChain(l)||this._complex.addChain(l),this._residue=this._chain.addResidue(c,f," ");for(var d=0;d<i;d++){s=n.getNextString(),o++;var p=parseFloat(s.substr(0,10)),m=parseFloat(s.substr(10,10)),v=parseFloat(s.substr(20,10)),y=I8[parseInt(s.substr(36,3),10)],S=new C(p,m,v),_=s.substr(31,3).trim().toUpperCase(),x=L8.getByName(_);this._atomsIndexes[_]||(this._atomsIndexes[_]=0),this._atomsIndexes[_]+=1,_+=this._atomsIndexes[_],this._residue.addAtom(_,x,S,void 0,!0,o," ",1,0,y)}}},{key:"_parseBonds",value:function(n,i){for(var s,o=0;o<i;o++){s=n.getNextString();var l=parseInt(s.substr(0,3),10)+this._atomsParsed,c=parseInt(s.substr(3,3),10)+this._atomsParsed,f=parseInt(s.substr(6,3),10);if(l>c){var d=[c,l];l=d[0],c=d[1]}this._complex.addBond(l,c,N8[f]||1,k8[f]||ra.BondType.UNKNOWN,!0)}}},{key:"_parseMOL",value:function(n){this._compoundIndx++,this._parseHeader(n);var i=n.getStringFromStart(3),s=parseInt(i.substr(0,3),10),o=parseInt(i.substr(3,3),10);this._parseAtoms(n,s),this._parseBonds(n,o),this._atomsParsed+=s,this._metadata.molecules[this._compoundIndx]._residues=[],this._metadata.molecules[this._compoundIndx]._residues.push(this._residue)}},{key:"_parseDataItem",value:function(n){for(var i=n.getCurrentString(),s=[],o=n.getNextString();o.trim()!=="";)s.push(o),o=n.getNextString();if(s.length===1){var l=s,c=pn(l,1);s=c[0]}this._currentMolProps[i.replace(/[<>]/g,"").trim()]=s}},{key:"_parseCompound",value:function(n){if(this._parseMOL(n),this._format===Fp.SDF){for(this._currentMolProps={};n.findNextDataItem();)this._parseDataItem(n);if(Object.keys(this._currentMolProps).length!==0){var i=this._metadata.molecules[this._compoundIndx];i.props=this._currentMolProps,this._tryToUpdateMoleculeData(i)}}}},{key:"_fixBondsArray",value:function(){for(var n=this._serialAtomMap,i=this._complex,s=i._bonds,o=0;o<s.length;o++){var l=s[o];l._right<l._left&&console.log("_fixBondsArray: Logic error."),l._left=n[l._left]||null,l._right=n[l._right]||null}}},{key:"_buildAssemblies",value:function(){var n=this._complex._chains;if(n.length===1)return this._assemblies;for(var i=0;i<n.length;i++){var s=new qm(this._complex),o=new Xe;s.addMatrix(o),s.addChain(n[i]._name),this._assemblies.push(s)}return this._assemblies}},{key:"_buildMolecules",value:function(){this._complex._molecules=[];for(var n=this._metadata.molecules,i=0;i<n.length;i++){var s=new P8(this._complex,n[i].name,i+1);s.residues=n[i]._residues,this._complex._molecules[i]=s}return this._complex._molecules}},{key:"_searchTag",value:function(n,i){for(var s=0;s<i.length;s++)if(n instanceof RegExp&&n.test(i[s].tag)||n===i[s].tag)return i[s].data}},{key:"_tryToFind",value:function(n,i){for(var s=0;s<n.length;s++){var o=this._searchTag(n[s],i);if(o)return o}}},{key:"_tryToUpdateMoleculeData",value:function(n){for(var i=!1,s=0;s<Bp.length;s++){var o=V8[Bp[s]],l=this._tryToFind(o,n.props);l&&(n[Bp[s]]=l,i=!0)}return n.name=n.name||n.id,n.name.match(/^\d+$/)&&(n.name="CID: ".concat(n.name)),i}},{key:"_finalizeMetadata",value:function(){var n=this._metadata.molecules,i=this._complex.metadata,s=this._complex;if(n.length===1)s.name=n[0].name,i.title=n[0].title,i.date=n[0].date,i.properties=n[0].props;else if(n.length>1){i.molecules=[];for(var o=0;o<n.length;o++)i.molecules.push({name:n[o].name,date:n[o].date,title:n[o].title,properties:n[o].props})}}},{key:"_finalize",value:function(){for(var n=this._serialAtomMap={},i=this._complex._atoms,s=0;s<i.length;s++){var o=i[s];n[o.serial]=o}this._complex._finalizeBonds(),this._fixBondsArray(),this._finalizeMetadata(),this._buildAssemblies(),this._complex.units=this._complex.units.concat(this._assemblies),this._buildMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:!1,enableEditing:!1,serialAtomMap:this._serialAtomMap})}},{key:"defineFormat",value:function(n){var i;return D8.test(n)?i=Fp.SDF:i=Fp.MOL,i}},{key:"parseSync",value:function(){var n=this._complex=new R8,i=new C8(this._data);this._format=this.defineFormat(this._data),n.metadata.format=this._format;do this._parseCompound(i);while(i.findNextCompoundStart());return this._finalize(),n}}]),t}(Xr);uv.formats=["mol","sdf"];uv.extensions=[".mol",".sdf"];function uw(a){var e=G8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function G8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var H8={nstart:[Wt.array,"i16",0],extent:[Wt.array,"i16",3],grid:[Wt.array,"i16",6],cellDims:[Wt.vector,"i16",9],angles:[Wt.array,"i16",12],div:[Wt.singular,"i16",15],adder:[Wt.singular,"i16",16],scaleFactor:[Wt.singular,"i16",17]},W8=function(a){ve(t,a);var e=uw(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"_parseHeader",value:function(n){this._buff=n,this._typedCheck();var i={};if(i.i16=new Int16Array(this._buff),i.i16[18]!==100)for(var s=0,o=i.i16.length;s<o;++s){var l=i.i16[s];i.i16[s]=(l&255)<<8|l>>8&255}if(i.i16[18]!==100)throw new Error("DSN6: Incorrect format ");var c=this._header;this._fillHeader(H8,i),c.cellDims.multiplyScalar(1/c.scaleFactor),c.angles.forEach(function(f,d,p){p[d]*=Math.PI/180/c.scaleFactor}),c.div/=100}},{key:"_setAxisIndices",value:function(){this._xyz2crs[0]=0,this._xyz2crs[1]=1,this._xyz2crs[2]=2}},{key:"_setOrigins",value:function(){var n=this._header,i=this._getAxis(),s=pn(i,3),o=s[0],l=s[1],c=s[2];this._setAxisIndices(),this._origin.addScaledVector(o,n.nstart[0]),this._origin.addScaledVector(l,n.nstart[1]),this._origin.addScaledVector(c,n.nstart[2]),o.multiplyScalar(n.extent[0]),l.multiplyScalar(n.extent[1]),c.multiplyScalar(n.extent[2]),this._setBoxParams(o,l,c)}},{key:"_pointCalculate",value:function(n,i,s,o,l,c,f){var d=this._header;if(l<d.extent[0]&&o<d.extent[1]&&s<d.extent[2]){var p=l+d.extent[0]*(o+d.extent[1]*s);n[p]=(i[c.counter]-d.adder)/d.div,++c.counter}else return c.counter+=8-f,!1;return!0}},{key:"_blockCalculate",value:function(n,i,s,o,l,c){for(var f=0;f<8;++f)for(var d=8*s+f,p=0;p<8;++p)for(var m=8*o+p,v=!0,y=0;v&&y<8;){var S=8*l+y;v=this._pointCalculate(n,i,d,m,S,c,y),y++}}},{key:"_toXYZData",value:function(){var n=this._header,i=new Uint8Array(this._buff),s=new Float32Array(n.extent[0]*n.extent[1]*n.extent[2]),o=new C(n.extent[0]/8,n.extent[1]/8,n.extent[2]/8),l={};l.counter=512;for(var c=0;c<o.z;++c)for(var f=0;f<o.y;++f)for(var d=0;d<o.x;++d)this._blockCalculate(s,i,c,f,d,l);return this._calculateInfoParams(s),s}},{key:"_calculateInfoParams",value:function(n){this._header.dmean/=n.length;for(var i=0,s=n[0],o=n[0],l=0;l<n.length;l++)i+=Math.pow(this._header.dmean-n[l],2),n[l]<s&&(s=n[l]),n[l]>o&&(o=n[l]);this._header.sd=Math.sqrt(i/n.length),this._header.dmax=o,this._header.dmin=s}}]),t}(lw),gh=function(a){ve(t,a);var e=uw(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._options.fileType="dsn6",i.model=new W8,i}return J(t,[{key:"parseSync",value:function(){return this.model.parse(this._data)}}],[{key:"canParse",value:function(n,i){return n?n instanceof ArrayBuffer&&Xr.checkDataTypeOptions(i,"dsn6"):!1}},{key:"canProbablyParse",value:function(n){return!1}}]),t}(Xr);gh.formats=["dsn6"];gh.extensions=[".dsn6",".omap"];gh.binary=!0;function X8(a){var e=Y8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Y8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $8=function(a){ve(t,a);var e=X8(t);function t(r){var n;return K(this,t),n=e.call(this,r),n._next=-1,n.next(),n}return J(t,[{key:"getNext",value:function(){return this._next}}]),t}(sw);function q8(a){var e=Z8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Z8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var j8=pt.Complex,R1=pt.Element,K8=pt.Molecule,fv=function(a){ve(t,a);var e=q8(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._time=null,i._numAtoms=null,i._residueNumber=null,i._residueName="",i._atomName="",i._atomNumber=null,i._atomPosition=[],i._atomVelocity=[],i._complex=null,i._molecules=[],i._molecule=null,i._options.filetype="gro",i}return J(t,[{key:"canProbablyParse",value:function(n){return xe.isString(this._data)&&/^\s*[^\n]*\n\s*\d+ *\n\s*\d+[^\n\d]{3}\s*\w+\s*\d+\s*-?\d/.test(n)}},{key:"_parseTitle",value:function(n){var i=this._complex.metadata;i.id=n.readLine().trim(),i.name=i.id.slice(i.id.lastIndexOf("\\")+1,i.id.lastIndexOf(".")),i.format="gro"}},{key:"_parseNumberOfAtoms",value:function(n){if(this._numAtoms=n.readInt(0,n.getNext()),Number.isNaN(this._numAtoms))throw new Error("Line 2 is not representing atom number. Consider checking input file")}},{key:"_parseAtom",value:function(n){this._residueNumber=n.readInt(1,5),this._residueName=n.readString(6,10).trim(),this._atomName=n.readString(11,15).trim(),this._atomNumber=n.readInt(16,20);var i=n.readFloat(21,28)*10,s=n.readFloat(29,36)*10,o=n.readFloat(37,45)*10;if(Number.isNaN(i)||Number.isNaN(s)||Number.isNaN(o)){this._complex.error={message:'Atom position is invalid in "'.concat(n.readLine(),'"')};return}var l=R1.getByName(this._atomName[0]);if(l.fullName==="Unknown"){this._complex.error={message:"".concat(this._atomName[0]," hasn't been recognised as an atom name.")};return}var c=R1.Role[this._atomName],f=this._chain;f||(this._chain=f=this._complex.addChain("A"));var d=this._residue;(!d||d.getSequence()!==this._residueNumber)&&(this._residue=d=f.addResidue(this._residueName,this._residueNumber," ")),this._atomPosition=new C(i,s,o);var p=!0,m=" ",v=1,y=1,S=0;d.addAtom(this._atomName,l,this._atomPosition,c,p,this._atomNumber,m,v,y,S)}},{key:"_finalize",value:function(){var n=new K8(this._complex,this._complex.metadata.name,1);n.residues=this._chain._residues,n._chains=this._chain,this._complex._molecules[0]=n,this._molecules.push(n),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"parseSync",value:function(){var n=this._complex=new j8,i=new $8(this._data),s=0;for(this._parseTitle(i),i.next(),this._parseNumberOfAtoms(i),i.next(),s=0;s<this._numAtoms&&!i.end();++s)this._parseAtom(i),i.next();if(s<this._numAtoms&&(this._complex.error={message:"File ended unexpectedly."}),n.error)throw new Error(n.error.message);return this._finalize(),this._atomPosition=null,this._complex=null,this._molecules=null,this._molecule=null,n}}]),t}(Xr);fv.formats=["gro"];fv.extensions=[".gro"];function J8(a){var e=Q8();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function Q8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eU=pt.Complex,L1=pt.Element,ia=pt.Bond,tU=pt.Molecule,nU={un:0,1:1,2:2,3:3,ar:1,am:1,nc:0,du:1},rU={un:ia.BondType.UNKNOWN,1:ia.BondType.COVALENT,2:ia.BondType.COVALENT,3:ia.BondType.COVALENT,ar:ia.BondType.AROMATIC,am:ia.BondType.COVALENT,nc:ia.BondType.UNKNOWN,du:ia.BondType.COVALENT},iU=/\d+$/,fw=/\s+/;function P1(a){return a.trim().split(fw)}var hv=function(a){ve(t,a);var e=J8(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._complex=null,i._chain=null,i._residue=null,i._compoundIndx=-1,i._molecules=[],i._molecule=null,i._currPosIdx=0,i._currStartIdx=0,i._serialAtomMap={},i._options.fileType="mol2",i}return J(t,[{key:"_parseRawStrings",value:function(n){return n.split(/\r?\n|\r/)}},{key:"_toStringFromStart",value:function(n,i){var s=this._currStartIdx+n;this._currPosIdx=s<i.length?s:this._currStartIdx}},{key:"_toHeaderString",value:function(n,i){for(this._toStringFromStart(0,i);this._currPosIdx<i.length;){if(i[this._currPosIdx].match("@<TRIPOS>".concat(n)))return;this._currPosIdx++}this._toStringFromStart(0,i)}},{key:"_toStringFromHeader",value:function(n,i,s){this._toHeaderString(n,s);var o=this._currPosIdx+i;s[this._currPosIdx].match("@<TRIPOS>".concat(n))&&o<s.length&&(this._currPosIdx=o)}},{key:"_setStart",value:function(n,i){n>=i.length?this._currStartIdx=this._currPosIdx=i.length-1:this._currStartIdx=this._currPosIdx=n}},{key:"_probablyHaveDataToParse",value:function(n){return this._currPosIdx<n.length-2}},{key:"_findNextCompoundStart",value:function(n){for(;this._currPosIdx<n.length&&n[this._currPosIdx].trim()!=="@<TRIPOS>MOLECULE>";)this._currPosIdx++;return this._setStart(++this._currPosIdx,n),this._probablyHaveDataToParse(n)}},{key:"_parseMolecule",value:function(n){this._toHeaderString("MOLECULE",n);var i=this._complex.metadata;i.name=n[++this._currPosIdx],i.format="mol2",this._molecule={_index:"",_chains:[]},this._molecule._index=this._compoundIndx+1,this._molecules.push(this._molecule)}},{key:"_parseAtoms",value:function(n,i){this._toHeaderString("ATOM",i);for(var s=0;s<n;s++){var o=P1(i[++this._currPosIdx]);if(o.length<6)throw new Error("MOL2 parsing error: Not enough information to create atom!");var l=parseInt(o[0],10),c=o[1],f=parseFloat(o[2]),d=parseFloat(o[3]),p=parseFloat(o[4]),m=o[5].split(".")[0].toUpperCase(),v=0;o.length>=9&&(v=parseFloat(o[8])||0);var y=this._chain;if(y||(this._chain=y=this._complex.getChain("A")||this._complex.addChain("A"),this._residue=null),!!this._setResidue(o)){var S=!1,_=" ",x=1,b=0,M=L1.getByName(m),E=L1.Role[c],T=new C(f,d,p);this._residue.addAtom(c,M,T,E,S,l,_,x,b,v)}}}},{key:"_setResidue",value:function(n){var i=1,s="UNK";if(n.length>=7&&(i=parseInt(n[6],10)),n.length>=8&&n[7]!=="<0>"&&(s=n[7].replace(iU,"")),this.settings.now.nowater&&(s==="HOH"||s==="WAT"))return!1;var o=this._residue,l=this._chain;return(!o||o.getSequence()!==i)&&(this._residue=l.addResidue(s,i,"A")),!0}},{key:"_parseBonds",value:function(n,i){this._toHeaderString("BOND",i);for(var s=0;s<n;s++){var o=P1(i[++this._currPosIdx]);if(o.length<3)throw new Error("MOL2 parsing error: Missing information about bonds!");var l=parseInt(o[1],10),c=parseInt(o[2],10),f=o[3];if(l>c){var d=[c,l];l=d[0],c=d[1]}this._complex.addBond(l,c,nU[f]||0,rU[f]||ia.BondType.UNKNOWN,!0)}}},{key:"_fixSerialAtoms",value:function(){for(var n=this._complex._atoms,i=0;i<n.length;i++){var s=n[i];this._serialAtomMap[s.serial]=s}}},{key:"_fixBondsArray",value:function(){var n=this._serialAtomMap,i=this._complex;if(Object.keys(n).length===0)throw new Error("MOL2 parsing error: Missing atom information!");for(var s=i._bonds,o=0;o<s.length;o++){var l=s[o];l._left=n[l._left]||null,l._right=n[l._right]||null}}},{key:"_finalizeMolecules",value:function(){var n=this._complex._chains[0];this._complex._molecules=[];for(var i=0;i<this._molecules.length;i++){var s=this._molecules[i],o=n._residues,l=new tU(this._complex,s._name,i+1);l.residues=o,this._complex._molecules[i]=l}}},{key:"_finalize",value:function(){this._complex._finalizeBonds(),this._fixSerialAtoms(),this._fixBondsArray(),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"_parseCompound",value:function(n){this._compoundIndx++,this._parseMolecule(n),this._toStringFromHeader("MOLECULE",2,n);var i=n[this._currPosIdx].trim().split(fw),s=i[0],o=i[1];this._parseAtoms(s,n),this._parseBonds(o,n)}},{key:"parseSync",value:function(){var n=this._complex=new eU,i=this._parseRawStrings(this._data);do this._parseCompound(i);while(this._findNextCompoundStart(i));return this._finalize(),n}}]),t}(Xr);hv.formats=["mol2"];hv.extensions=[".mol2",".ml2",".sy2"];var aU=new wV([gn,ov,mh,lv,sv,cv,uv,vh,gh,fv,hv]);function sU(a){var e=oU();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function oU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var lU=function(a){ve(t,a);var e=sU(t);function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return K(this,t),e.call(this,r,["formats"])}return J(t,[{key:"find",value:function(n){var i=[];return n.format&&(i=this._dict.formats[n.format.toLowerCase()]||[]),Ms(i)}}]),t}(Is),dv=function(){function a(e,t){K(this,a),this._source=e,this._options=t||{},this._abort=!1}return J(a,[{key:"exportSync",value:function(){throw new Error("Exporting to this source is not implemented")}},{key:"export",value:function(){var t=this;return new Promise(function(r,n){setTimeout(function(){try{return t._abort?n(new Error("Export aborted")):r(t.exportSync())}catch(i){return n(i)}})})}},{key:"abort",value:function(){this._abort=!0}}]),a}();Sc(dv.prototype);var cU=function(){function a(){K(this,a),this._resultArray=[],this._currentStr=-1,this._tag=null,this._fixedNumeration=!1,this._numeration=!1,this._tagStrNum=0}return J(a,[{key:"getResult",value:function(){return this.writeString(`
`,81,81),this._resultArray.join("")}},{key:"_currentStrLength",value:function(){var t=this._resultArray[this._currentStr];return t?t.length:0}},{key:"newTag",value:function(t,r){t?this._tag=t:this._tag=null,xe.isUndefined(r)?(this._numeration=!1,this._fixedNumeration=!1,this._tagStrNum=0):xe.isNumber(r)?(this._tagStrNum=r,this._numeration=!0,this._fixedNumeration=!0):xe.isBoolean(r)&&(this._tagStrNum=0,this._numeration=r,this._fixedNumeration=!1)}},{key:"newString",value:function(t){this.writeString(`
`,81,81),this._currentStr++,this._resultArray.push(""),t?this.writeString(t,1,6):this._tag&&this.writeString(this._tag,1,6),this._numeration&&(this._fixedNumeration||this._tagStrNum++,this._tagStrNum!==1&&this.writeString(this._tagStrNum.toString(),10,8))}},{key:"writeEntireString",value:function(t,r,n){r||(r=81);for(var i=0;i<t.length;i++)this._currentStrLength()===r&&i!==t.length-1&&(this.newString(),n&&this.writeString(n.tag,n.begin,n.end)),t[i]===`
`?this.newString():this.writeString(t[i])}},{key:"writeString",value:function(t,r,n){var i=this._resultArray[this._currentStr],s,o=i?i.length:0;if(!xe.isUndefined(t)){xe.isNumber(r)||(r=o+1),xe.isNumber(n)||(n=o+t.length),xe.isString(t)?s=t:s=t.toString();var l=r<n?n:r,c=r<n?r:n;if(s.length>Math.abs(r-n)+1&&(s=s.substr(0,Math.abs(r-n+1))),c>o+1)this._resultArray[this._currentStr]+=" ".repeat(c-o-1);else if(c<=o){var f=this._resultArray[this._currentStr];this._resultArray[this._currentStr]=f.slice(0,c-1)}if(n<r){var d=r-n+1;s=" ".repeat(d-s.length)+s}c===11&&this._numeration&&this._tagStrNum!==1&&(s=" ".concat(s)),this._resultArray[this._currentStr]+=s,i=this._resultArray[this._currentStr],l>i.length&&(this._resultArray[this._currentStr]+=" ".repeat(l-i.length))}}},{key:"writeBondsArray",value:function(t,r){for(var n=this._getSubArrays(t,4),i=0;i<n.length;i++){this.newString(),this.writeString(r.serial,11,7);for(var s=0;s<n[i].length;s++){var o=n[i][s]._left.serial===r.serial?n[i][s]._right.serial:n[i][s]._left.serial;this.writeString(o,16+5*s,12+5*s)}}}},{key:"_getSubArrays",value:function(t,r){for(var n=[],i=0;i<t.length;i+=r)n.push(t.slice(i,i+r));return n}},{key:"writeMatrix",value:function(t,r,n){for(var i=0;i<3;i++){this.newString(),this.writeString(n,14,18),this.writeString((i+1).toString(),19,19),this.writeString(r.toString(),23,20);for(var s=0;s<3;s++){var o=parseFloat(t.elements[i*4+s]).toFixed(6);this.writeString(o.toString(),33+s*10,24+s*10)}var l=parseFloat(t.elements[i*4+3]).toFixed(5);this.writeString(l.toString(),68,55)}}},{key:"writeMatrices",value:function(t,r){if(t)for(var n=new Xe,i=0;i<t.length;i++)n.copy(t[i]).transpose(),this.writeMatrix(n,i+1,r)}}]),a}();function uU(a){var e=fU();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function fU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pv=function(a){ve(t,a);var e=uU(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._tags=["HEADER","TITLE","COMPND","REMARK","HELIX","SHEET","ATOM and HETATM","CONECT"],i._result=null,i._tagExtractors={HEADER:i._extractHEADER,TITLE:i._extractTITLE,"ATOM and HETATM":i._extractATOM,CONECT:i._extractCONECT,COMPND:i._extractCOMPND,REMARK:i._extractREMARK,HELIX:i._extractHELIX,SHEET:i._extractSHEET},i._stringForRemark350=`COORDINATES FOR A COMPLETE MULTIMER REPRESENTING THE KNOWN
BIOLOGICALLY SIGNIFICANT OLIGOMERIZATION STATE OF THE
MOLECULE CAN BE GENERATED BY APPLYING BIOMT TRANSFORMATIONS
GIVEN BELOW.  BOTH NON-CRYSTALLOGRAPHIC AND
CRYSTALLOGRAPHIC OPERATIONS ARE GIVEN.`,i._stringForRemark290=`CRYSTALLOGRAPHIC SYMMETRY TRANSFORMATIONS
THE FOLLOWING TRANSFORMATIONS OPERATE ON THE ATOM/HETATM
RECORDS IN THIS ENTRY TO PRODUCE CRYSTALLOGRAPHICALLY
RELATED MOLECULES.`,i}return J(t,[{key:"exportSync",value:function(){var n=new cU;if(!this._source)return this._result;for(var i=0;i<this._tags.length;i++){var s=this._tags[i],o=this._tagExtractors[s];typeof o=="function"&&o.call(this,n)}return this._result=n.getResult(),this._result}},{key:"_extractHEADER",value:function(n){if(this._source.metadata){var i=this._source.metadata;n.newTag("HEADER"),n.newString(),i.classification&&n.writeString(i.classification,11,50),i.date&&n.writeString(i.date,51,59),i.id&&n.writeString(i.id,63,66)}}},{key:"_extractTITLE",value:function(n){if(this._source.metadata){var i=this._source.metadata;if(i.title){n.newTag("TITLE",!0);for(var s=0;s<i.title.length;s++)n.newString(),n.writeString(i.title[s],11,80)}}}},{key:"_extractCONECT",value:function(n){if(this._source._atoms){var i=this._source._atoms;n.newTag("CONECT");for(var s=0;s<i.length;s++){var o=i[s].bonds.filter(function(l){return l._fixed});o.length!==0&&n.writeBondsArray(o.reverse(),i[s])}}}},{key:"_extractSHEET",value:function(n){if(this._source._sheets){n.newTag("SHEET");for(var i=this._source._sheets,s=0;s<i.length;s++)if(i[s]._strands)for(var o=i[s]._strands,l=0;l<o.length;l++)n.newString(),n.writeString(l+1,10,8),n.writeString(i[s]._name,14,12),n.writeString(o.length,16,15),n.writeString(o[l].init._type._name,18,20),n.writeString(o[l].init._chain._name,22,22),n.writeString(o[l].init._sequence,26,23),n.writeString(o[l].init._icode,27,27),n.writeString(o[l].term._type._name,29,31),n.writeString(o[l].init._chain._name,33,33),n.writeString(o[l].term._sequence,37,34),n.writeString(o[l].term._icode,38,38),n.writeString(o[l].sense,40,39)}}},{key:"_extractHELIX",value:function(n){if(this._source._helices){n.newTag("HELIX");for(var i=this._source._helices,s=0;s<i.length;s++){var o=i[s],l=xe.invert(uS);n.newString(),n.writeString(o.serial,10,8),n.writeString(o.name,14,12),n.writeString(o.init._type._name,16,18),n.writeString(o.init._chain._name,20,20),n.writeString(o.init._sequence,25,22),n.writeString(o.init._icode,26,26),n.writeString(o.term._type._name,28,30),n.writeString(o.term._chain._name,32,32),n.writeString(o.term._sequence,37,34),n.writeString(o.term._icode,38,38),n.writeString(l[o.type],40,39),n.writeString(o.comment,41,70),n.writeString(o.length,76,72)}}}},{key:"_extractATOM",value:function(n){if(this._source._atoms)for(var i=this._source._atoms,s=0;s<i.length;s++){var o=i[s].het?"HETATM":"ATOM";n.newString(o);var l=i[s].element.name.length>1||i[s].name.length>3?13:14;n.writeString(i[s].serial,11,7),n.writeString(i[s].name,l,16),n.writeString(String.fromCharCode(i[s].location),17,17),n.writeString(i[s].residue._type._name,20,18),n.writeString(i[s].residue._chain._name,22,22),n.writeString(i[s].residue._sequence,26,23),n.writeString(i[s].residue._icode,27,27),n.writeString(i[s].position.x.toFixed(3),38,31),n.writeString(i[s].position.y.toFixed(3),46,39),n.writeString(i[s].position.z.toFixed(3),54,47),n.writeString(i[s].occupancy.toFixed(2),60,55),n.writeString(i[s].temperature.toFixed(2),66,61),n.writeString(i[s].element.name,78,77),i[s].charge&&n.writeString(i[s].charge,79,80)}}},{key:"_extractCOMPND",value:function(n){if(this._source._molecules){var i=this._source._molecules;n.newTag("COMPND",!0);for(var s=0;s<i.length;s++){var o=this._getMoleculeChains(i[s]);n.newString(),n.writeString("MOL_ID: ".concat(i[s].index,";"),11,80),n.newString(),n.writeString("MOLECULE: ".concat(i[s].name,";"),11,80),n.newString(),n.writeString("CHAIN: ",11,18);var l="".concat(o.join(", "),";");n.writeEntireString(l,81)}}}},{key:"_extractREMARK",value:function(n){this._Remark290(n),this._Remark350(n)}},{key:"_Remark290",value:function(n){if(this._source.symmetry&&this._source.symmetry.length!==0){var i=this._source.symmetry;n.newTag("REMARK",290),n.newString(),n.newString(),n.writeEntireString(this._stringForRemark290),n.writeMatrices(i,"SMTRY"),n.newString(),n.newString(),n.writeString("REMARK: NULL",11,80)}}},{key:"_Remark350",value:function(n){if(this._source.units){var i=this._source.units,s=0;n.newTag("REMARK",350),n.newString(),n.newString(),n.writeEntireString(this._stringForRemark350);for(var o=i.filter(function(d){return d instanceof qm}),l=0;l<o.length;l++){n.newString(),n.newString(),s++,n.writeString("BIOMOLECULE: ".concat(s),11,80);var c=o[l].chains.join(", ");n.newString(),n.writeString("APPLY THE FOLLOWING TO CHAINS: "),n.writeEntireString(c,69,{tag:"AND CHAINS: ",begin:31,end:42});var f=o[l].matrices;n.writeMatrices(f,"BIOMT")}}}},{key:"_getMoleculeChains",value:function(n){function i(o){return o._chain._name}var s=n.residues.map(i);return s.filter(function(o,l){return s.indexOf(o)===l})}}]),t}(dv);pv.formats=["pdb"];pv.SourceClass=xc;var To=3,Hl=3,zp=4;function I1(a,e,t,r){t[r]=a[e],t[r+1]=a[e+1],t[r+2]=a[e+2]}function hU(a,e,t,r,n){t[r]=a[e],t[r+1]=a[e+1],t[r+2]=a[e+2],t[r+3]=n}var Wl=new Gt;function N1(a,e,t,r,n){Wl.set(a[e],a[e+1],a[e+2],n.w),Wl.applyMatrix4(n.matrix),t[r]=Wl.x,t[r+1]=Wl.y,t[r+2]=Wl.z}function Vp(a,e,t,r,n){if(!((e.array.length-e.start)/e.stride<t||(a.array.length-a.start)/a.stride<t))if(a.stride===e.stride)e.array.set(a.array,e.start);else for(var i=e.start,s=a.start,o=0;o<t;++o,i+=e.stride,s+=a.stride)r(a.array,s,e.array,i,n)}var Up=function(){function a(){K(this,a),this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.lastPos=0,this.lastNorm=0,this.lastCol=0,this.lastIdx=0}return J(a,[{key:"init",value:function(t,r){this.positions=new Float32Array(t*To),this.normals=new Float32Array(t*Hl),this.colors=new Float32Array(t*zp),this.indices=new Int32Array(r)}},{key:"setPositions",value:function(t,r,n,i){var s={array:t,start:r,stride:i},o={array:this.positions,start:this.lastPos,stride:To};Vp(s,o,n,I1),this.lastPos+=n*To}},{key:"setTransformedPositions",value:function(t,r,n,i,s){for(var o=this.lastPos,l=r,c={matrix:s,w:1},f=0;f<n;++f,l+=i,o+=To)N1(t,l,this.positions,o,c);this.lastPos+=n*To}},{key:"setNormals",value:function(t,r,n,i){var s={array:t,start:r,stride:i},o={array:this.normals,start:this.lastNorm,stride:Hl};Vp(s,o,n,I1),this.lastNorm+=n*Hl}},{key:"setTransformedNormals",value:function(t,r,n,i,s){for(var o=this.lastNorm,l=r,c={matrix:s,w:0},f=0;f<n;++f,l+=i,o+=Hl)N1(t,l,this.normals,o,c);this.lastNorm+=n*Hl}},{key:"setColors",value:function(t,r,n,i){var s={array:t,start:r,stride:i},o={array:this.colors,start:this.lastCol,stride:zp};Vp(s,o,n,hU,1),this.lastCol+=n*zp}},{key:"setIndices",value:function(t,r,n){this.indices.set(t,this.lastIdx),this.lastIdx+=n}},{key:"setShiftedIndices",value:function(t,r,n){var i=t.map(function(s){return s+n});this.setIndices(i,0,r)}},{key:"getVerticesNumber",value:function(){return this.lastPos/To}},{key:"addInstance",value:function(t,r){var n=this.getVerticesNumber();this.setShiftedIndices(r.indices,r.indices.length,n);var i=r.itemSize;this.setTransformedPositions(r.positions,0,r.vertsCount,i.position,t),this.setTransformedNormals(r.normals,0,r.vertsCount,i.normal,t),this.setColors(r.colors,0,r.vertsCount,i.color)}}]),a}(),hw=function(){function a(){K(this,a),this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.vertsCount=0,this.itemSize=null}return J(a,[{key:"init",value:function(t,r){var n=t.attributes;this.itemSize={position:n.position.itemSize,normal:n.normal.itemSize,color:n.color.itemSize}}}]),a}();function dU(a){var e=pU();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function pU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var k1=function(a){ve(t,a);var e=dU(t);function t(){return K(this,t),e.apply(this,arguments)}return J(t,[{key:"init",value:function(n,i){nn(H(t.prototype),"init",this).call(this,n,i);var s=n.attributes,o=s.position,l=s.normal,c=n.index;this.vertsCount=o.count,this.positions=o.array,this.normals=l.array,this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this.indices=c.array}},{key:"setColors",value:function(n){for(var i=0,s=0,o=this.colors.length,l=this.itemSize.color;s<o;s+=l)this.colors[i++]=n.r,this.colors[i++]=n.g,this.colors[i++]=n.b}}]),t}(hw);function mU(a){var e=vU();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function vU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gU=function(a){ve(t,a);var e=mU(t);function t(){var r;return K(this,t),r=e.call(this),r._cutRawStart=0,r._cutRawEnd=0,r._facesPerSlice=0,r}return J(t,[{key:"init",value:function(n,i){nn(H(t.prototype),"init",this).call(this,n,i);var s=n.attributes.position,o=n.index;this.vertsCount=s.count+i.addPerCylinder,this._facesPerSlice=i.addPerCylinder,this.positions=new Float32Array(this.vertsCount*s.itemSize),this.normals=new Float32Array(this.vertsCount*this.itemSize.normal),this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this._extendVertices(n,i),this.indices=new Uint32Array(o.count),this._extendIndices(n,i)}},{key:"_extendVertices",value:function(n,i){var s=n.attributes.position,o=n.attributes.normal,l=n.getGeoParams(),c=1;this._cutRawStart=c*l.radialSegments,this._cutRawEnd=this._cutRawStart+i.addPerCylinder;{var f=s.array.slice(0,this._cutRawEnd*s.itemSize);this.positions.set(f,0),f=o.array.slice(0,this._cutRawEnd*o.itemSize),this.normals.set(f,0)}{var d=s.array.slice(this._cutRawStart*s.itemSize,s.array.length);this.positions.set(d,this._cutRawEnd*s.itemSize),d=o.array.slice(this._cutRawStart*o.itemSize,o.array.length),this.normals.set(d,this._cutRawEnd*o.itemSize)}}},{key:"_extendIndices",value:function(n,i){var s=n.index,o=6,l=i.addPerCylinder*o,c=i.addPerCylinder,f=s.array.slice(l,s.count);f=f.map(function(d){return d+c}),this.indices.set(s.array,0),this.indices.set(f,l)}},{key:"_setColorRange",value:function(n,i,s,o){for(var l=o.length,c=n;c<i;c+=l)s.set(o,c)}},{key:"setColors",value:function(n,i){var s=this.itemSize.color,o=this._cutRawEnd*s,l=o*2;if(this._setColorRange(0,o,this.colors,n.toArray()),this._setColorRange(o,l,this.colors,i.toArray()),l<this.colors.length){var c=(this._facesPerSlice+1)*s,f=l+c;this._setColorRange(l,f,this.colors,i.toArray());var d=f+c;this._setColorRange(f,d,this.colors,n.toArray())}}}]),t}(hw),_U=function(){function a(){K(this,a),this._materials=[],this._models=[]}return J(a,[{key:"process",value:function(t){this._extractModelsAndMaterials(t);var r=this._flattenModels();return{name:t.name,models:r,materials:this._materials}}},{key:"_extractModelsAndMaterials",value:function(t){var r=this,n=new bm;n.set(_t.LAYERS.DEFAULT),n.enable(_t.LAYERS.TRANSPARENT),t.traverse(function(i){i instanceof Ut&&i.layers.test(n)&&r.checkExportAbility(i)&&(i.geometry.type==="InstancedBufferGeometry"?r._collectInstancedGeoInfo(i):r._collectGeoInfo(i))})}},{key:"_reworkIndices",value:function(t){for(var r=3,n=r-1;n<t.length;n+=r)t[n]*=-1,t[n]--}},{key:"_flattenModels",value:function(){var t=0;function r(v){return v+t}for(var n=[],i=0,s=this._models.length;i<s;i++){var o=this._models[i],l=[],c=[],f=[],d=[];t=0;for(var p=0;p<o.length;p++){var m=o[p];l.push(m.indices.map(r)),t+=m.getVerticesNumber(),c.push(m.positions),f.push(m.normals),d.push(m.colors)}l=ke.mergeTypedArraysUnsafe(l),this._reworkIndices(l),c=ke.mergeTypedArraysUnsafe(c),f=ke.mergeTypedArraysUnsafe(f),d=ke.mergeTypedArraysUnsafe(d),n.push({indices:l,positions:c,normals:f,colors:d,verticesCount:t})}return n}},{key:"checkExportAbility",value:function(t){return t.geometry.attributes.position.count===0?!1:t instanceof FS?(kn.warn("Currently we cannot export 'sprites' modes, like BS, WV, LC. Please turn of settings 'zSprites' and try again"),!1):t instanceof BS?(kn.warn("Currently we cannot export Lines mode"),!1):!0}},{key:"_collectGeoInfo",value:function(t){var r=t.geometry,n=r.attributes,i=n.position,s=n.color,o=n.normal,l=r.index,c=t.matrix,f=new Up,d=i.count;f.init(d,l.count),c.isIdentity()?(f.setPositions(i.array,0,d,i.itemSize),f.setNormals(o.array,0,d,o.itemSize)):(f.setTransformedPositions(i.array,0,d,i.itemSize,c),f.setTransformedNormals(o.array,0,d,o.itemSize,c)),f.setColors(s.array,0,d,s.itemSize),f.setIndices(l.array,0,l.count);var p=this._collectMaterialInfo(t);this._addToPool(f,p)}},{key:"_collectSpheresInfo",value:function(t){var r=t.geometry,n=r.attributes,i=n.position,s=n.color,o=r.index,l=t.matrix,c=new Up,f=t.geometry.instanceCount,d=i.count,p=o.count;c.init(f*d,f*p);var m=new k1;m.init(t.geometry);for(var v=new Xe,y=new Xe,S=new nt,_=0;_<f;++_){var x=_*s.itemSize;S.fromArray(s.array,x),m.setColors(S),this._getSphereInstanceMatrix(t.geometry,_,v),y.multiplyMatrices(l,v),c.addInstance(y,m)}var b=this._collectMaterialInfo(t);this._addToPool(c,b)}},{key:"_collectCylindersInfo",value:function(t){var r=t.geometry,n=r.attributes,i=n.position,s=n.color,o=n.color2,l=r.index,c=t.matrix,f=new Up,d=t.geometry.instanceCount,p=new k1;p.init(t.geometry);var m=this._gatherCylindersColoringInfo(t.geometry),v=null;m.needToSplit>0&&(v=new gU,v.init(t.geometry,m));var y=m.addPerCylinder*m.needToSplit,S=i.count,_=l.count;f.init(d*S+y,d*_);for(var x=new Xe,b=new Xe,M=new nt,E=new nt,T={},R=0;R<d;++R){var V=R*s.itemSize;m.is2Colored[R]?(M.fromArray(o.array,V),E.fromArray(s.array,V),v&&(v.setColors(M,E),T=v)):(M.fromArray(s.array,V),p.setColors(M),T=p),this._getCylinderInstanceMatrix(t.geometry,R,x),b.multiplyMatrices(c,x),f.addInstance(b,T)}var Y=this._collectMaterialInfo(t);this._addToPool(f,Y)}},{key:"_addToPool",value:function(t,r){var n=this._checkExistingMaterial(r);if(n<0)this._models.push([t]),this._materials.push(r);else{var i=this._models[n];i.push(t)}}},{key:"_checkExistingMaterial",value:function(t){return xe.findIndex(this._materials,function(r){return xe.isEqual(r,t)})}},{key:"_gatherCylindersColoringInfo",value:function(t){for(var r=t.instanceCount,n=t.attributes.color.array,i=t.attributes.color2.array,s=t.attributes.color.itemSize,o=new Array(r),l=0,c=0,f=0;f<r;f++,c+=s){var d=Math.abs(n[c]-i[c])>1e-7||Math.abs(n[c+1]-i[c+1])>1e-7||Math.abs(n[c+2]-i[c+2])>1e-7;o[f]=d,l+=d}var p=t.getGeoParams(),m=p.radialSegments;return{is2Colored:o,needToSplit:l,addPerCylinder:m}}},{key:"_collectInstancedGeoInfo",value:function(t){t.geometry instanceof ES?this._collectSpheresInfo(t):t.geometry instanceof CS&&this._collectCylindersInfo(t)}},{key:"_collectMaterialInfo",value:function(t){var r=t.material.uberOptions;return{diffuse:r.diffuse.toArray(),opacity:r.opacity,shininess:r.shininess,specular:r.specular.toArray()}}},{key:"_getCylinderInstanceMatrix",value:function(t,r,n){var i=t.attributes.matVector1.array,s=t.attributes.matVector2.array,o=t.attributes.matVector3.array,l=r*4;n.set(i[l],i[l+1],i[l+2],i[l+3],s[l],s[l+1],s[l+2],s[l+3],o[l],o[l+1],o[l+2],o[l+3],0,0,0,1)}},{key:"_getSphereInstanceMatrix",value:function(t,r,n){var i=t.attributes.offset,s=r*i.itemSize,o=i.array[s],l=i.array[s+1],c=i.array[s+2],f=i.array[s+3];n.set(f,0,0,o,0,f,0,l,0,0,f,c,0,0,0,1)}}]),a}(),yU=`
Definitions:  {
  Version: 100
  Count: 3
  ObjectType: "Model" {
    Count: 1
  }
  ObjectType: "Geometry" {
    Count: 1
  }
  ObjectType: "Material" {
    Count: 1
  }
  ObjectType: "Pose" {
    Count: 1
  }
  ObjectType: "GlobalSettings" {
    Count: 1
  }
} `,xU=`Properties60: {
      Property: "QuaternionInterpolate", "bool", "",0
      Property: "Visibility", "Visibility", "A",1
      Property: "Lcl Translation", "Lcl Translation", "A",0.000000000000000,0.000000000000000,-1789.238037109375000
      Property: "Lcl Rotation", "Lcl Rotation", "A",0.000009334667643,-0.000000000000000,0.000000000000000
      Property: "Lcl Scaling", "Lcl Scaling", "A",1.000000000000000,1.000000000000000,1.000000000000000
      Property: "RotationOffset", "Vector3D", "",0,0,0
      Property: "RotationPivot", "Vector3D", "",0,0,0
      Property: "ScalingOffset", "Vector3D", "",0,0,0
      Property: "ScalingPivot", "Vector3D", "",0,0,0
      Property: "TranslationActive", "bool", "",0
      Property: "TranslationMin", "Vector3D", "",0,0,0
      Property: "TranslationMax", "Vector3D", "",0,0,0
      Property: "TranslationMinX", "bool", "",0
      Property: "TranslationMinY", "bool", "",0
      Property: "TranslationMinZ", "bool", "",0
      Property: "TranslationMaxX", "bool", "",0
      Property: "TranslationMaxY", "bool", "",0
      Property: "TranslationMaxZ", "bool", "",0
      Property: "RotationOrder", "enum", "",0
      Property: "RotationSpaceForLimitOnly", "bool", "",0
      Property: "AxisLen", "double", "",10
      Property: "PreRotation", "Vector3D", "",0,0,0
      Property: "PostRotation", "Vector3D", "",0,0,0
      Property: "RotationActive", "bool", "",0
      Property: "RotationMin", "Vector3D", "",0,0,0
      Property: "RotationMax", "Vector3D", "",0,0,0
      Property: "RotationMinX", "bool", "",0
      Property: "RotationMinY", "bool", "",0
      Property: "RotationMinZ", "bool", "",0
      Property: "RotationMaxX", "bool", "",0
      Property: "RotationMaxY", "bool", "",0
      Property: "RotationMaxZ", "bool", "",0
      Property: "RotationStiffnessX", "double", "",0
      Property: "RotationStiffnessY", "double", "",0
      Property: "RotationStiffnessZ", "double", "",0
      Property: "MinDampRangeX", "double", "",0
      Property: "MinDampRangeY", "double", "",0
      Property: "MinDampRangeZ", "double", "",0
      Property: "MaxDampRangeX", "double", "",0
      Property: "MaxDampRangeY", "double", "",0
      Property: "MaxDampRangeZ", "double", "",0
      Property: "MinDampStrengthX", "double", "",0
      Property: "MinDampStrengthY", "double", "",0
      Property: "MinDampStrengthZ", "double", "",0
      Property: "MaxDampStrengthX", "double", "",0
      Property: "MaxDampStrengthY", "double", "",0
      Property: "MaxDampStrengthZ", "double", "",0
      Property: "PreferedAngleX", "double", "",0
      Property: "PreferedAngleY", "double", "",0
      Property: "PreferedAngleZ", "double", "",0
      Property: "InheritType", "enum", "",0
      Property: "ScalingActive", "bool", "",0
      Property: "ScalingMin", "Vector3D", "",1,1,1
      Property: "ScalingMax", "Vector3D", "",1,1,1
      Property: "ScalingMinX", "bool", "",0
      Property: "ScalingMinY", "bool", "",0
      Property: "ScalingMinZ", "bool", "",0
      Property: "ScalingMaxX", "bool", "",0
      Property: "ScalingMaxY", "bool", "",0
      Property: "ScalingMaxZ", "bool", "",0
      Property: "GeometricTranslation", "Vector3D", "",0,0,0
      Property: "GeometricRotation", "Vector3D", "",0,0,0
      Property: "GeometricScaling", "Vector3D", "",1,1,1
      Property: "LookAtProperty", "object", ""
      Property: "UpVectorProperty", "object", ""
      Property: "Show", "bool", "",1
      Property: "NegativePercentShapeSupport", "bool", "",1
      Property: "DefaultAttributeIndex", "int", "",0
      Property: "Color", "Color", "A+",0,0,0
      Property: "Size", "double", "",100
      Property: "Look", "enum", "",1
    }`,SU=`
    LayerElementMaterial: 0 {
      Version: 101
      Name: ""
      MappingInformationType: "AllSame"
      ReferenceInformationType: "Direct"
      Materials: 0
    }`,wU=`
    Layer: 0 {
      Version: 100
      LayerElement:  {
        Type: "LayerElementNormal"
        TypedIndex: 0
      }
      LayerElement:  {
        Type: "LayerElementColor"
        TypedIndex: 0
      }
      LayerElement:  {
        Type: "LayerElementMaterial"
        TypedIndex: 0
      }
    }`,bU=`GlobalSettings: {
    Version: 1000
    Properties60:  {
      Property: "UpAxis", "int", "",1
      Property: "UpAxisSign", "int", "",1
      Property: "FrontAxis", "int", "",2
      Property: "FrontAxisSign", "int", "",1
      Property: "CoordAxis", "int", "",0
      Property: "CoordAxisSign", "int", "",1
      Property: "UnitScaleFactor", "double", "",1
    }
  }`,MU=function(){function a(){K(this,a),this._resultArray=[],this._info=null}return J(a,[{key:"getResult",value:function(t){return this._info=t,this._resultArray.push(this._writeHeader()),this._resultArray.push(this._writeDefinitions()),this._resultArray.push(this._writeObjects(t.models,t.materials)),this._resultArray.push(this._writeRelations()),this._resultArray.push(this._writeConnections()),this._info=null,this._resultArray.join("")}},{key:"_writeHeader",value:function(){var t=1003,r=6100,n=new Date,i=1e3,s="Miew FBX Exporter v".concat(this._info.version);return`; FBX 6.1.0 project file
; Created by `.concat(s,` Copyright (c) 2015-2020 EPAM Systems, Inc.
; For support please contact miew@epam.com
; ----------------------------------------------------

FBXHeaderExtension:  {
  FBXHeaderVersion: `).concat(t,`
  FBXVersion: `).concat(r,`
  CreationTimeStamp:  {
    Version: `).concat(i,`
    Year: `).concat(n.getFullYear(),`
    Month: `).concat(n.getMonth()+1,` 
    Day: `).concat(n.getDate(),`
    Hour: `).concat(n.getHours(),`
    Minute: `).concat(n.getMinutes(),`
    Second: `).concat(n.getSeconds(),`
    Millisecond: `).concat(n.getMilliseconds(),`
  }
  Creator: "`).concat(s,`"
  OtherFlags:  {
    FlagPLE: 0
  }
}
CreationTime: "`).concat(n,`"
Creator: "`).concat(s,`"  
`)}},{key:"_writeDefinitions",value:function(){return`
; Object definitions
;------------------------------------------------------------------

`.concat(yU,`
`)}},{key:"_models",value:function(){for(var t=232,r="",n=this._info.models,i=0;i<n.length;++i){var s=n[i],o=s.verticesCount;r+=`
  Model: "Model::`.concat(this._info.name,"_").concat(i,`", "Mesh" {
    Version: `).concat(t,` 
    `).concat(xU,`
    `).concat(this._verticesIndices(s.positions,s.indices),`
    `).concat(this._normalLayer(s.normals),` 
    `).concat(this._colorLayer(s.colors,o),` 
    `).concat(SU,`  
    `).concat(wU,`
  }`)}return r}},{key:"_materials",value:function(){for(var t=102,r="",n=this._info.materials,i=0;i<n.length;++i){var s=n[i];r+=`
  Material: "Material::`.concat(this._info.name,"_").concat(i,`_default", "" {
    Version: `).concat(t,`
    ShadingModel: "lambert"
    MultiLayer: 0
    `).concat(this._materialProperties(s),`
  }`)}return r}},{key:"_writeObjects",value:function(){return`
; Object properties
;------------------------------------------------------------------

Objects:  {
  `.concat(this._models(),`
  `).concat(this._materials(),`
  `).concat(bU,`
}
`)}},{key:"_writeRelations",value:function(){for(var t="",r=0;r<this._info.models.length;++r)t+=`
  Model: "Model::`.concat(this._info.name,"_").concat(r,`", "Mesh" {
  }`);for(var n="",i=0;i<this._info.materials.length;++i)n+=`
  Material: "Material::`.concat(this._info.name,"_").concat(i,`_default", "" {
  }`);return`
; Object relations
;------------------------------------------------------------------

Relations:  {
  `.concat(t,`
  Model: "Model::Producer Perspective", "Camera" {
  }
  Model: "Model::Producer Top", "Camera" {
  }
  Model: "Model::Producer Bottom", "Camera" {
  }
  Model: "Model::Producer Front", "Camera" {
  }
  Model: "Model::Producer Back", "Camera" {
  }
  Model: "Model::Producer Right", "Camera" {
  }
  Model: "Model::Producer Left", "Camera" {
  }
  Model: "Model::Camera Switcher", "CameraSwitcher" {
  }
  `).concat(n,`
}`)}},{key:"_writeConnections",value:function(){for(var t="",r=this._info.name,n=0;n<this._info.models.length;++n)t+=`
  Connect: "OO", "Model::`.concat(r,"_").concat(n,'", "Model::Scene"');for(var i="",s=0;s<this._info.materials.length;++s)i+=`
  Connect: "OO", "Material::`.concat(r,"_").concat(s,'_default", "Model::').concat(r,"_").concat(s,'"');return`
; Object connections
;------------------------------------------------------------------

Connections:  {
  `.concat(t,`
  `).concat(i,`
}`)}},{key:"_floatArrayToString",value:function(t){for(var r=[],n=0;n<t.length;++n)r[n]=t[n].toFixed(6);return r.join(",")}},{key:"_colorLayer",value:function(t,r){var n=0,i=101,s="",o=this._floatArrayToString(t),l=Ms(Array(r).keys());return`
    LayerElementColor: `.concat(n,` {
      Version: `).concat(i,`
      Name: "`).concat(s,`"
      MappingInformationType: "ByVertice"
      ReferenceInformationType: "Direct"
      Colors: `).concat(o,`
      ColorIndex: `).concat(l,`
    }`)}},{key:"_normalLayer",value:function(t){var r=0,n=101,i="",s=this._floatArrayToString(t);return`
    LayerElementNormal: `.concat(r,` {
      Version: `).concat(n,`
      Name: "`).concat(i,`"
      MappingInformationType: "ByVertice"
      ReferenceInformationType: "Direct" 
      Normals: `).concat(s,`
    }`)}},{key:"_verticesIndices",value:function(t,r){var n=0,i=1,s="Y",o="CullingOff",l=124,c=this._floatArrayToString(t);return"MultiLayer: ".concat(n,`
    MultiTake: `).concat(i,`
    Shading: `).concat(s,`
    Culling: "`).concat(o,`"
    Vertices: `).concat(c,`
    PolygonVertexIndex: `).concat(r,`
    GeometryVersion: `).concat(l)}},{key:"_materialProperties",value:function(t){return`Properties60:  {
      Property: "ShadingModel", "KString", "", "Lambert"
      Property: "MultiLayer", "bool", "",0
      Property: "EmissiveColor", "ColorRGB", "",0,0,0
      Property: "EmissiveFactor", "double", "",0.0000
      Property: "AmbientColor", "ColorRGB", "",1,1,1
      Property: "AmbientFactor", "double", "",0.0000
      Property: "DiffuseColor", "ColorRGB", "",`.concat(t.diffuse,`
      Property: "DiffuseFactor", "double", "",1.0000
      Property: "Bump", "Vector3D", "",0,0,0
      Property: "TransparentColor", "ColorRGB", "",1,1,1
      Property: "TransparencyFactor", "double", "",0.0000
      Property: "SpecularColor", "ColorRGB", "",`).concat(t.specular,`
      Property: "SpecularFactor", "double", "",1.0000
      Property: "ShininessExponent", "double", "",`).concat(t.shininess,`
      Property: "ReflectionColor", "ColorRGB", "",0,0,0
      Property: "ReflectionFactor", "double", "",1
      Property: "Ambient", "ColorRGB", "",1,1,1
      Property: "Diffuse", "ColorRGB", "",`).concat(t.diffuse,`
      Property: "Specular", "ColorRGB", "",`).concat(t.specular,`
      Property: "Shininess", "double", "",`).concat(t.shininess,`
      Property: "Opacity", "double", "",`).concat(t.opacity,`
      Property: "Reflectivity", "double", "",0
    }`)}}]),a}();function EU(a){var e=CU();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function CU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mv=function(a){ve(t,a);var e=EU(t);function t(r,n){var i;return K(this,t),i=e.call(this,r,n),i._data=r,i._version=n.miewVersion||"0.0-UNSPECIFIED",i._extractor=new _U,i}return J(t,[{key:"exportSync",value:function(){var n=new MU;if(!this._source)return this._result;var i=this._extractor.process(this._data);return i.version=this._version,this._result=n.getResult(i),this._result}}]),t}(dv);mv.formats=["fbx"];mv.SourceClass=Pi;var AU=new lU([pv,mv]),Wa={loaders:yV,parsers:aU,exporters:AU},Xl=new nt,TU=function(){function a(){K(this,a),this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this._vector=new C,this._viewMatrix=new Xe,this._projectionMatrix=new Xe,this._domElement=document.createElement("div"),this._domElement.style.overflow="hidden",this._domElement.style.position="absolute",this._domElement.style.top="0",this._domElement.style.zIndex="0",this._domElement.style.pointerEvents="none"}return J(a,[{key:"getElement",value:function(){return this._domElement}},{key:"reset",value:function(){for(var t=this.getElement();t.firstChild;)t.removeChild(t.firstChild)}},{key:"setSize",value:function(t,r){this._width=t,this._height=r,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this._domElement.style.width="".concat(t,"px"),this._domElement.style.height="".concat(r,"px")}},{key:"_renderObject",value:function(t,r,n){function i(y,S,_){return Xl.setHex(y),Xl.lerp(S,_),"#".concat(Xl.getHexString())}function s(y){return Xl.setHex(y),"#".concat(Xl.getHexString())}if(t instanceof Jm){if(this._vector.setFromMatrixPosition(t.matrixWorld),t.userData!==void 0&&t.userData.offset!==void 0){var o=new C(t.userData.offset.x,t.userData.offset.y,0);this._vector.add(o.multiplyScalar(t.matrixWorld.getMaxScaleOnAxis()))}this._vector.applyMatrix4(this._viewMatrix);var l=this._vector.z>-r.near?"hidden":"visible",c=1e4*(r.far- -this._vector.z)/(r.far-r.near),f=t.getElement();if(typeof n.fog>"u")f.style.color=s(t.userData.color),t.userData.background!=="transparent"&&(f.style.background=s(t.userData.background));else{var d=oa.smoothstep(-this._vector.z,n.fog.near,n.fog.far);f.style.color=i(t.userData.color,n.fog.color,d),t.userData.background!=="transparent"&&(f.style.background=i(t.userData.background,n.fog.color,d))}this._vector.applyMatrix4(this._projectionMatrix);var p="".concat(t.userData!=={}?t.userData.translation:"translate(-50%, -50%) ","translate(").concat(this._vector.x*this._widthHalf+this._widthHalf,"px,").concat(-this._vector.y*this._heightHalf+this._heightHalf,"px)");f.style.visibility=l,f.style.WebkitTransform=p,f.style.MozTransform=p,f.style.oTransform=p,f.style.transform=p,f.style.zIndex=Number(c).toFixed(0),f.parentNode!==this._domElement&&this._domElement.appendChild(f)}for(var m=0,v=t.children.length;m<v;m++)this._renderObject(t.children[m],r,n)}},{key:"render",value:function(t,r){t.updateMatrixWorld(),r.parent===null&&r.updateMatrixWorld(),r.matrixWorldInverse.copy(r.matrixWorld).invert(),this._viewMatrix.copy(r.matrixWorldInverse),this._projectionMatrix.copy(r.projectionMatrix),this._renderObject(t,r,t)}}]),a}(),vv=37,gv=38,_v=39,yv=40,on={NONE:-1,ROTATE:0,TRANSLATE:1,SCALE:2,TRANSLATE_PIVOT:3},RU=.1,pm=new On,Ba=new Xe;function fa(a,e,t,r){this.objects=a;var n=pn(a,1);this.object=n[0],this.camera=e,this.pivot=t,this.axis=new C(0,0,1),this.options=r,this.lastRotation={axis:new C,angle:0}}fa.prototype._rotate=function(){var a=new C,e=new On,t=new C,r=new Xe;return function(n){var i=this.pivot.x===0&&this.pivot.y===0&&this.pivot.z===0;if(r.copy(this.object.matrix),i?r.multiply(Ba.makeRotationFromQuaternion(n)):(r.multiply(Ba.makeTranslation(this.pivot.x,this.pivot.y,this.pivot.z)),r.multiply(Ba.makeRotationFromQuaternion(n)),r.multiply(Ba.makeTranslation(-this.pivot.x,-this.pivot.y,-this.pivot.z))),r.decompose(a,e,t),!i)for(var s=0;s<this.objects.length;++s)this.objects[s].position.copy(a);for(var o=0;o<this.objects.length;++o)this.objects[o].quaternion.copy(e),this.objects[o].updateMatrix()}}();fa.prototype.setObjects=function(a){this.objects=a;var e=pn(a,1);this.object=e[0]};fa.prototype.rotate=function(){var a={axis:new C,angle:0};return function(e,t,r,n){this.mouse2rotation(a,t,r,n),e.setFromAxisAngle(a.axis,a.angle),a.angle&&this._rotate(e),this.lastRotation=a}}();fa.prototype.translate=function(){var a=new C,e=new C;return function(t){a.set(t.x/this.camera.projectionMatrix.elements[0],t.y/this.camera.projectionMatrix.elements[5],0);var r=a.length();a.normalize(),a.transformDirection(Ba.copy(this.object.matrixWorld).invert()),e.copy(this.pivot),this.object.localToWorld(e),r*=Math.abs(e.z-this.camera.position.z),r/=this.object.matrixWorld.getMaxScaleOnAxis();for(var n=0;n<this.objects.length;++n)this.objects[n].translateOnAxis(a,r)}}();fa.prototype.update=function(){var a=new C;return function(e,t){if(fe.now.autoRotation!==0)return fe.now.autoRotationAxisFixed||this.lastRotation.axis.length()===0?a.set(0,1,0).transformDirection(Ba.copy(this.object.matrixWorld).invert()):a.copy(this.lastRotation.axis),this._rotate(pm.setFromAxisAngle(a,fe.now.autoRotation*e)),!0;if(this.options.intertia&&this.lastRotation.angle){var r=this.lastRotation.angle*Math.pow(1-this.options.dynamicDampingFactor,40*t);if(Math.abs(r)<=this.options.intertiaThreshold)this.lastRotation.angle=0;else return this._rotate(pm.setFromAxisAngle(this.lastRotation.axis,r)),!0}return!1}}();fa.prototype.stop=function(){this.lastRotation.angle=0};fa.prototype.mouse2rotation=function(){var a=new C,e=new C,t=new C,r=new C,n=new C,i=new C,s=new Pe;return function(o,l,c,f){if(f)o.axis.copy(this.axis),o.angle=this.options.axisRotateFactor*(c.y-l.y);else{s.subVectors(c,l);var d=s.length();if(d===0)return;a.copy(this.pivot),this.object.localToWorld(a),e.subVectors(this.camera.position,a),t.copy(e).normalize(),r.copy(this.camera.up).normalize(),n.crossVectors(r,t).normalize(),r.setLength(s.y),n.setLength(s.x),i.copy(r.add(n)),o.axis.crossVectors(i,e),o.angle=-d*this.options.rotateFactor}o.axis.transformDirection(Ba.copy(this.object.matrixWorld).invert()),o.angle<0&&(o.axis.negate(),o.angle=-o.angle)}}();function kt(a,e,t,r,n){pr.call(this);var i=this;this.object=a,this.objectPivot=e,this.camera=t,this.domElement=typeof r<"u"?r:document,this.getAltObj=n,this.enabled=!0,this.hotkeysEnabled=!0,this.screen={left:0,top:0,width:0,height:0},this.options={rotateFactor:Math.PI,axisRotateFactor:4*Math.PI,intertia:!0,dynamicDampingFactor:.1,intertiaThreshold:.001},this._state=on.NONE,this._mousePrevPos=new Pe,this._mouseCurPos=new Pe,this._mainObj=new fa([this.object],this.camera,new C(0,0,0),this.options),this._altObj=new fa([this.object],this.camera,new C(0,0,0),this.options),this._affectedObj=this._mainObj,this._isAltObjFreeRotationAllowed=!0,this._isTranslationAllowed=!0,this._isKeysTranslatingObj=!1,this._pressedKeys=[],this._clock=new sh,this._clock.start(),this._lastUpdateTime=this._clock.getElapsedTime(),this._listeners=[{obj:i.domElement,type:"mousedown",handler:function(c){i.mousedown(c)}},{obj:i.domElement,type:"mouseup",handler:function(c){i.mouseup(c)}},{obj:i.domElement,type:"mousemove",handler:function(c){i.mousemove(c)}},{obj:i.domElement,type:"mousewheel",handler:function(c){i.mousewheel(c)}},{obj:i.domElement,type:"DOMMouseScroll",handler:function(c){i.mousewheel(c)}},{obj:i.domElement,type:"mouseout",handler:function(c){i.mouseup(c)}},{obj:i.domElement,type:"touchstart",handler:function(c){i.touchstartend(c)}},{obj:i.domElement,type:"touchend",handler:function(c){i.touchstartend(c)}},{obj:i.domElement,type:"touchmove",handler:function(c){i.touchmove(c)}},{obj:i.getKeyBindObject(),type:"keydown",handler:function(c){i.keydownup(c)}},{obj:i.getKeyBindObject(),type:"keyup",handler:function(c){i.keydownup(c)}},{obj:window,type:"resize",handler:function(){i.handleResize()}},{obj:window,type:"blur",handler:function(){i.resetKeys()}},{obj:i.domElement,type:"contextmenu",handler:function(c){i.contextmenu(c)}}];for(var s=0;s<this._listeners.length;s++){var o=this._listeners[s];o.obj.addEventListener(o.type,o.handler)}this.handleResize(),this.resetKeys(),this.update()}kt.prototype=Object.create(pr.prototype);kt.prototype.constructor=kt;kt.prototype.resetKeys=function(){this._pressedKeys[vv]=!1,this._pressedKeys[gv]=!1,this._pressedKeys[_v]=!1,this._pressedKeys[yv]=!1};kt.prototype.contextmenu=function(a){a.stopPropagation(),a.preventDefault()};kt.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-e.clientLeft,this.screen.top=a.top+window.pageYOffset-e.clientTop,this.screen.width=a.width,this.screen.height=a.height}};kt.prototype.enable=function(a){this.enabled=a};kt.prototype.enableHotkeys=function(a){this.hotkeysEnabled=a};kt.prototype.allowTranslation=function(a){this._isTranslationAllowed=a};kt.prototype.allowAltObjFreeRotation=function(a){this._isAltObjFreeRotationAllowed=a};kt.prototype.keysTranslateObj=function(a){this._isKeysTranslatingObj=a};kt.prototype.isEditingAltObj=function(){return(this._state===on.ROTATE||this._state===on.TRANSLATE)&&this._affectedObj===this._altObj};kt.prototype.convertMouseToOnCircle=function(a,e,t){var r=Math.min(this.screen.width,this.screen.height);if(r===0){a.set(0,0);return}a.set((e-this.screen.width*.5-this.screen.left)/r,(.5*this.screen.height+this.screen.top-t)/r)};kt.prototype.convertMouseToViewport=function(a,e,t){if(this.screen.width===0||this.screen.height===0){a.set(0,0);return}a.set(2*(e-this.screen.width*.5-this.screen.left)/this.screen.width,2*(.5*this.screen.height+this.screen.top-t)/this.screen.height)};kt.prototype.stop=function(){this._mainObj.stop(),this._altObj.stop()};kt.prototype.rotateByMouse=function(){var a=new On;return function(e){this._affectedObj.rotate(a,this._mousePrevPos,this._mouseCurPos,e),this.dispatchEvent({type:"change",action:"rotate",quaternion:a})}}();kt.prototype.rotate=function(a){this.object.quaternion.multiply(a),this.dispatchEvent({type:"change",action:"rotate",quaternion:a})};kt.prototype.getOrientation=function(){return this.object.quaternion};kt.prototype.setOrientation=function(a){this.object.quaternion.copy(a)};kt.prototype.translate=function(){var a=new Pe;return function(){a.subVectors(this._mouseCurPos,this._mousePrevPos),this._affectedObj.translate(a),this.dispatchEvent({type:"change",action:"translate"})}}();kt.prototype.getScale=function(){return this.object.scale.x};kt.prototype.setScale=function(a){this.object.scale.set(a,a,a)};kt.prototype.scale=function(a){a<=0||(this.setScale(this.object.scale.x*a),this.dispatchEvent({type:"change",action:"zoom",factor:a}))};kt.prototype.update=function(){var a=new Pe;return function(){var e=this._clock.getElapsedTime(),t=e-this._lastUpdateTime;if(this._state===on.NONE){var r=e-this._lastMouseMoveTime;(this._mainObj.update(t,r)||this._altObj.update(t,r))&&this.dispatchEvent({type:"change",action:"auto"})}if(this._isKeysTranslatingObj){var n=Number(this._pressedKeys[_v])-Number(this._pressedKeys[vv]),i=Number(this._pressedKeys[gv])-Number(this._pressedKeys[yv]);if(n!==0||i!==0){var s=t,o=this.getAltObj();o.objects.length>0&&(this._altObj.setObjects(o.objects),this._altObj.pivot=o.pivot,"axis"in o?this._altObj.axis=o.axis.clone():this._altObj.axis.set(0,0,1),a.set(s*n,s*i),this._altObj.translate(a),this.dispatchEvent({type:"change",action:"translate"}))}}this._lastUpdateTime=e}}();kt.prototype.reset=function(){this._state=on.NONE,this.object.quaternion.copy(pm.set(0,0,0,1))};kt.prototype.mousedown=function(a){if(!(this.enabled===!1||this._state!==on.NONE)){if(a.preventDefault(),a.stopPropagation(),this._state===on.NONE)if(a.button===0){this._affectedObj.stop();var e=!1;if(a.altKey){var t=this.getAltObj();e=t.objects.length>0,e&&(this._altObj.setObjects(t.objects),this._altObj.pivot=t.pivot,"axis"in t?this._altObj.axis=t.axis.clone():this._altObj.axis.set(0,0,1))}this._affectedObj=e?this._altObj:this._mainObj,this._state=e&&a.ctrlKey&&this._isTranslationAllowed?on.TRANSLATE:on.ROTATE}else a.button===2&&(this._state=on.TRANSLATE_PIVOT);this._state===on.ROTATE&&(this.convertMouseToOnCircle(this._mouseCurPos,a.pageX,a.pageY),this._mousePrevPos.copy(this._mouseCurPos)),(this._state===on.TRANSLATE||this._state===on.TRANSLATE_PIVOT)&&(this.convertMouseToViewport(this._mouseCurPos,a.pageX,a.pageY),this._mousePrevPos.copy(this._mouseCurPos))}};kt.prototype.mousemove=function(a){if(!(this.enabled===!1||this._state===on.NONE))switch(a.preventDefault(),a.stopPropagation(),this._state){case on.ROTATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,a.pageX,a.pageY),this.rotateByMouse(a.altKey&&!this._isAltObjFreeRotationAllowed||a.shiftKey),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case on.TRANSLATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,a.pageX,a.pageY),this.translate();break;case on.TRANSLATE_PIVOT:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,a.pageX,a.pageY),this.translatePivotByMouse();break}};kt.prototype.mousewheel=function(a){if(!(this.enabled===!1||!fe.now.zooming||this._state!==on.NONE||a.shiftKey)){a.preventDefault();var e=0;a.wheelDelta?e=a.wheelDelta/40:a.detail&&(e=-a.detail/3);var t=1+e*.05;t=Math.max(t,.01),this.scale(t)}};kt.prototype.mouseup=function(a){this.enabled===!1||this._state===on.NONE||(a.preventDefault(),a.stopPropagation(),this._state=on.NONE,this._clock.getElapsedTime()-this._lastMouseMoveTime>RU&&this._affectedObj.stop())};kt.prototype.touchstartend=function(a){if(this.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:this._state=on.ROTATE,this.convertMouseToOnCircle(this._mouseCurPos,a.touches[0].pageX,a.touches[0].pageY),this._mousePrevPos.copy(this._mouseCurPos);break;case 2:{this._mainObj.stop(),this._altObj.stop(),this._state=on.SCALE;var e=a.touches[0].pageX-a.touches[1].pageX,t=a.touches[0].pageY-a.touches[1].pageY;this._touchDistanceCur=this._touchDistanceStart=Math.sqrt(e*e+t*t),this._scaleStart=this.object.scale.x;break}default:this._state=on.NONE}};kt.prototype.touchmove=function(a){if(!(this.enabled===!1||this._state===on.NONE))switch(a.preventDefault(),a.stopPropagation(),this._state){case on.ROTATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,a.touches[0].pageX,a.touches[0].pageY),this.rotateByMouse(!1),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case on.SCALE:if(fe.now.zooming){var e=a.touches[0].pageX-a.touches[1].pageX,t=a.touches[0].pageY-a.touches[1].pageY;this._touchDistanceCur=Math.sqrt(e*e+t*t);var r=this._scaleStart*this._touchDistanceCur/this._touchDistanceStart,n=r/this.object.scale.x;this.scale(n)}break}};kt.prototype.keydownup=function(a){if(!(this.enabled===!1||this.hotkeysEnabled===!1))switch(a.keyCode){case vv:case gv:case _v:case yv:this._pressedKeys[a.keyCode]=a.type==="keydown",a.preventDefault(),a.stopPropagation();break}};kt.prototype.getKeyBindObject=function(){return window.top};kt.prototype.dispose=function(){for(var a=0;a<this._listeners.length;a++){var e=this._listeners[a];e.obj.removeEventListener(e.type,e.handler)}};kt.prototype.translatePivotByMouse=function(){var a=new Pe;return function(){a.subVectors(this._mouseCurPos,this._mousePrevPos),this.translatePivotInWorld(fe.now.translationSpeed*a.x,fe.now.translationSpeed*a.y,0)}}();kt.prototype.translatePivotInWorld=function(a,e,t){var r=this.objectPivot.position;r.applyMatrix4(this.object.matrixWorld),r.setX(r.x+a),r.setY(r.y+e),r.setZ(r.z+t),r.applyMatrix4(Ba.copy(this.object.matrixWorld).invert()),this.dispatchEvent({type:"change",action:"translatePivot"})};kt.prototype.translatePivot=function(a,e,t){var r=this.objectPivot.position;r.setX(r.x+a),r.setY(r.y+e),r.setZ(r.z+t),this.dispatchEvent({type:"change",action:"translatePivot"})};kt.prototype.setPivot=function(a){this.objectPivot.position.copy(a),this.dispatchEvent({type:"change",action:"translatePivot"})};function Rr(a,e,t){pr.call(this);var r=this;this.gfxObj=a,this.camera=e,this.domElement=typeof t<"u"?t:document,this.screen={left:0,top:0,width:0,height:0},this._lastMousePos=new Pe(0,0),this._mouseTotalDist=0,this._lastClickBeginTime=-1e3,this._lastClickPos=new Pe(0,0),this._clickBeginTime=0,this._clock=new sh,this._clock.start(),this._listeners=[{obj:r.domElement,type:"mousedown",handler:function(o){r.mousedown(o)}},{obj:r.domElement,type:"mouseup",handler:function(o){r.mouseup(o)}},{obj:r.domElement,type:"mousemove",handler:function(o){r.mousemove(o)}},{obj:r.domElement,type:"touchstart",handler:function(o){r.touchstart(o)}},{obj:r.domElement,type:"touchend",handler:function(o){r.touchend(o)}},{obj:window,type:"resize",handler:function(){r.handleResize()}}];for(var n=0;n<this._listeners.length;n++){var i=this._listeners[n];i.obj.addEventListener(i.type,i.handler)}this.handleResize()}Rr.prototype=Object.create(pr.prototype);Rr.prototype.constructor=Rr;Rr.prototype.reset=function(){this.picked={},this.dispatchEvent({type:"newpick",obj:{}})};Rr.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-e.clientLeft,this.screen.top=a.top+window.pageYOffset-e.clientTop,this.screen.width=a.width,this.screen.height=a.height}};Rr.prototype.pickObject=function(a){if(!this.gfxObj){this.picked={},this.dispatchEvent({type:"newpick",obj:{}});return}var e=this.gfxObj,t=new Xx;t.ray.origin.setFromMatrixPosition(this.camera.matrixWorld),t.ray.direction.set(a.x,a.y,.5).unproject(this.camera).sub(t.ray.origin).normalize();var r=fe.now.draft.clipPlane&&this.clipPlaneValue?this.clipPlaneValue:1/0,n=fe.now.fog&&this.fogFarValue?this.fogFarValue:1/0,i=t.intersectVisibleObject(e,this.camera,r,n);if(!i){this.picked={},this.dispatchEvent({type:"newpick",obj:{}});return}var s={};if(i.residue||i.atom){var o=i.residue||i.atom.residue;fe.now.pick==="chain"?s={chain:o.getChain()}:fe.now.pick==="molecule"?s={molecule:o.getMolecule()}:i.residue||fe.now.pick==="residue"?s={residue:o}:i.atom&&(s={atom:i.atom})}this.picked=s,this.dispatchEvent({type:"newpick",obj:s})};Rr.prototype.getMouseInViewport=function(a,e){return new Pe((a-this.screen.left)/this.screen.width*2-1,-(e-this.screen.top)/this.screen.height*2+1)};Rr.prototype.mousedown=function(a){a.preventDefault(),a.stopPropagation(),a.button===0&&(this._lastMousePos=this.getMouseInViewport(a.pageX,a.pageY),this._mouseTotalDist=0,this._clickBeginTime=this._clock.getElapsedTime())};Rr.prototype.mousemove=function(a){a.preventDefault(),a.stopPropagation();var e=this.getMouseInViewport(a.pageX,a.pageY);this._mouseTotalDist+=e.sub(this._lastMousePos).length()};Rr.prototype.mouseup=function(a){var e=this;if(a.preventDefault(),a.stopPropagation(),a.button===0&&this._mouseTotalDist<.01){var t=this._clock.getElapsedTime(),r=this.getMouseInViewport(a.pageX,a.pageY),n=t-this._lastClickBeginTime;if(n<.7){var i=new Pe().subVectors(r,this._lastClickPos);if(i.length()<.01){this.dispatchEvent({type:"dblclick",obj:this.picked}),this._lastClickPos=r,this._lastClickBeginTime=-1e3;return}}setTimeout(function(){e.pickObject(r)},0),this._lastClickPos=r,this._lastClickBeginTime=this._clickBeginTime}};Rr.prototype.touchstart=function(a){a.preventDefault(),a.stopPropagation(),a.touches.length===1&&(this._lastTouchdownPos=this.getMouseInViewport(a.touches[0].pageX,a.touches[0].pageY))};Rr.prototype.touchend=function(a){var e=this;if(a.preventDefault(),a.stopPropagation(),a.touches.length===0&&a.changedTouches.length===1){var t=this.getMouseInViewport(a.changedTouches[0].pageX,a.changedTouches[0].pageY),r=t.sub(this._lastTouchdownPos).length();r<.01&&setTimeout(function(){e.pickObject(e._lastTouchdownPos)},0)}};Rr.prototype.dispose=function(){for(var a=0;a<this._listeners.length;a++){var e=this._listeners[a];e.obj.removeEventListener(e.type,e.handler)}};var LU=function(){function a(e,t){K(this,a),this._target=e,this._targetCamera=t,this._camera=new En(t.fov,t.aspect,1,100),this._object=new TO(1),this._scene=new Ga,this._scene.add(this._object),this._full=new Pe,this._update()}return J(a,[{key:"_update",value:function(){var t=this._targetCamera.fov,r=this._camera;r.aspect=this._targetCamera.aspect,r.setMinimalFov(t),r.setDistanceToFit(1,t),r.updateProjectionMatrix(),this._object.quaternion.copy(this._target.quaternion)}},{key:"render",value:function(t){this._update(),t.getSize(this._full);var r=this._full.width*.25,n=this._full.height*.25,i=t.autoClear;t.autoClear=!1,t.setViewport(0,0,r,n),t.clear(!1,!0,!1),t.render(this._scene,this._camera),t.setViewport(0,0,this._full.width,this._full.height),t.autoClear=i}}]),a}(),PU=12,IU=268435200,NU=8,kU=255,OU=12,DU=4293918720,FU=20,BU=1048575,zU=4026531840,VU=28,UU=1<<19,GU=1<<20,HU=1,WU=2,XU=["helix","strand"],O1=["fs","ps","ns","us"];function YU(a,e){for(var t=e._residues,r=t.length,n=new Uint8Array(r),i=e._atoms,s=0,o=a.length;s<o;++s){var l=i[s];n[l.residue._index]=a[s]}for(var c=[],f=0;f<r;){if(n[f]!==0){for(var d=f,p=n[f];f<r-1&&n[f+1]===p&&t[f].isConnected(t[f+1]);)++f;c.push({start:d,end:f,type:XU[p-1]})}++f}return c}function Gp(a){return a>=UU?a-GU:a}var dw=function(){function a(e,t,r){K(this,a),this._complex=e,this._secondary=null,this.isLoading=!1,this._framesRange={start:0,end:-1},this.frameIsReady=!1,this._buffer=null,this._frameRequest=null,this._callbacks=r,typeof t=="function"?(this._framesRequestLength=1,this._downloadDataFn=t):this.parseBinaryData(t,!0),this.reset(),this.setFrame(0)}return J(a,[{key:"_prepareBuffer",value:function(t,r){if(t==null&&(t=0),r==null&&(r=t+this._framesRequestLength),this._framesCount!==void 0&&(r=Math.min(this._framesCount-1,r)),this._downloadDataFn){var n=this,i=function(l){if(n.isLoading=!1,n._callbacks&&typeof n._callbacks.onLoadStatusChanged=="function"&&n._callbacks.onLoadStatusChanged(),n._buffer={data:l,state:"ready",start:t,end:r},n._frameRequest!==null){var c=n._frameRequest;n._frameRequest=null,n.setFrame(c)}},s=function(){n.isLoading=!1,n._callbacks&&typeof n._callbacks.onError=="function"&&n._callbacks.onError("Streaming failed")};this._buffer||(this._buffer={}),this._buffer.state="downloading",this.isLoading=!0,n._callbacks&&typeof n._callbacks.onLoadStatusChanged=="function"&&n._callbacks.onLoadStatusChanged(),this._downloadDataFn({start:t,end:r+1},i,s)}}},{key:"_parseBuffer",value:function(){if(this._buffer&&this._buffer.state==="ready"){this._framesRange={start:this._buffer.start,end:this._buffer.end},this.parseBinaryData(this._buffer.data,!1);var t=(this._buffer.end+1)%this._framesCount;if(t>=this._framesCount&&(t=0),this._buffer={state:"none"},this._prepareBuffer(t,t+this._framesRequestLength),this._frameRequest!==null){var r=this._frameRequest;this._frameRequest=null,this.setFrame(r)}}}},{key:"parseBinaryData",value:function(t){var r=new DataView(t),n=0,i=r.getUint32(n,!0);n+=4;var s=r.getUint32(n,!0);this._framesCount=s,this._framesRange.end=this._framesRange.end>0?Math.min(this._framesRange.end,s-1):s-1,n+=4,this._atomsCount=i;var o=1024*1024;this._framesRequestLength=Math.ceil(o/(i*8));var l=this._framesRange.end-this._framesRange.start+1;if(i!==this._complex._atoms.length||t.byteLength!==PU+l*i*8)throw new Error;for(var c=this._complex,f=r.getUint32(n,!0),d=0;f>1e3&&d<O1.length-1;)f/=1e3,++d;this._timeStep="".concat(f.toString()," ").concat(O1[d]),n+=4;for(var p=[],m=new Float32Array(l*i*3),v=0,y=new Int8Array(i),S=0;S<l;++S){for(var _=0;_<i;++_){var x=r.getUint32(n,!0);n+=4;var b=r.getUint32(n,!0);n+=4;var M=(b&zU)>>>VU,E=Gp((b&IU)>>>NU>>0),T=Gp(((b&kU)<<OU|(x&DU)>>>FU)>>0),R=Gp((x&BU)>>0);y[_]=0,M>0&&M<4?y[_]=HU:M===4&&(y[_]=WU),m[v++]=E/100,m[v++]=T/100,m[v++]=R/100}p.push(YU(y,c))}this._secondaryData=p,this._data=m}},{key:"nextFrame",value:function(){this.setFrame((this._currFrame+1)%this._framesCount)}},{key:"needsColorUpdate",value:function(t){return t instanceof sl}},{key:"getAtomColor",value:function(t,r){return t.getResidueColor(this._residues[r.residue._index],this._complex)}},{key:"getResidueColor",value:function(t,r){return t.getResidueColor(this._residues[r._index],this._complex)}},{key:"_updateSecondary",value:function(){var t,r=this._residues,n=r.length;for(t=0;t<n;++t)r[t]._secondary=null;var i=this._secondaryData[this._currFrame-this._framesRange.start];for(t=0,n=i.length;t<n;++t)for(var s=i[t],o=s.start,l=s.end,c={_start:r[o],_end:r[l],type:s.type,generic:s.generic},f=o;f<=l;++f)r[f]._secondary=c}},{key:"reset",value:function(){var t=this._complex._residues,r=t.length;this._residues=new Array(r);for(var n=this._residues,i=function(){return this._secondary},s=0;s<r;++s)n[s]={_type:t[s]._type,_isValid:t[s]._isValid,_controlPoint:null,_wingVector:null,_secondary:null,getSecondary:i}}},{key:"setFrame",value:function(t){if(this.frameIsReady=!1,t>=this._framesRange.start&&t<=this._framesRange.end)this._currFrame=t,this._cachedResidues=!1,this._updateSecondary(),this.frameIsReady=!0;else if(this._frameRequest=t,!this._buffer)this._prepareBuffer(t);else{var r=this;switch(this._buffer.state){case"none":this._prepareBuffer(t);break;case"ready":r._parseBuffer();break}}}},{key:"disableEvents",value:function(){this._callbacks=null}},{key:"getAtomPos",value:function(t){var r=a._vec,n=this,i=n._data,s=(n._atomsCount*(n._currFrame-n._framesRange.start)+t)*3;return r.set(i[s],i[s+1],i[s+2]),r}},{key:"getResidues",value:function(){return this._cachedResidues?this._residues:(this._complex.updateToFrame(this),this._residues)}}]),a}();qe(dw,"_vec",new C);var pw=function(){function a(e,t){if(K(this,a),this.constructor===a)throw new Error("Can not instantiate abstract class!");this.params=e,this.opts=xe.merge(ke.deriveDeep(fe.now.objects[this.type],!0),t),this.needsRebuild=!1,this._mesh=null,this.id=null}return J(a,[{key:"identify",value:function(){var t={type:this.type,params:this.params},r=ke.objectsDiff(this.opts,fe.now.modes[this.id]);return xe.isEmpty(r)||(t.opts=r),t}},{key:"toString",value:function(){var t="o=".concat(this.type,",").concat(this.params.join(",")),r=ke.compareOptionsWithDefaults(this.opts,fe.defaults.objects[this.type]);return t+r}},{key:"getGeometry",value:function(){return this._mesh}},{key:"destroy",value:function(){this._mesh&&_t.destroyObject(this._mesh)}}]),a}();pw.prototype.type="__";function $U(a){var e=qU();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function qU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pc=function(a){ve(t,a);var e=$U(t);function t(r,n){var i;if(K(this,t),i=e.call(this,r,n),r.length<2)throw new Error("Wrong number of argumets on line object creation!");var s=pn(r,2);return i._id1=s[0],i._id2=s[1],i}return J(t,[{key:"_getAtomFromName",value:function(n,i){var s=" - Wrong atom format it must be '#CHAIN_NAME.#RESIDUE_NUMBER.#ATOM_NAME' (e.g. 'A.38.CO1')",o=n.getAtomByFullname(i);if(!o)throw new Error(i+s);return o}},{key:"build",value:function(n){var i=new It;this._atom1=this._getAtomFromName(n,this._id1),this._atom2=this._getAtomFromName(n,this._id2);var s=this._atom1.position,o=this._atom2.position,l=new Float32Array([s.x,s.y,s.z,o.x,o.y,o.z]);i.setAttribute("position",new mt(l,3)),i.computeBoundingBox();var c=new Fi;c.setValues({lights:!1,overrideColor:!0,dashedLine:!0,fogTransparent:fe.now.bg.transparent}),this._line=new ii.Line(i,c),this._line.computeLineDistances(),this._line.material.setUberOptions({fixedColor:new nt(this.opts.color),dashedLineSize:this.opts.dashSize,dashedLinePeriod:this.opts.dashSize+this.opts.gapSize}),this._line.material.updateUniforms(),this._line.raycast=function(d,p){},this._mesh=this._line;var f=n.getTransforms();f.length>0&&(this._mesh=new nr,this._mesh.add(this._line),Vo.applyTransformsToMeshes(this._mesh,f))}},{key:"updateToFrame",value:function(n){if(!(!this._atom1||!this._atom2||!this._line)){var i=this._line.geometry;i.vertices[0].copy(n.getAtomPos(this._atom1.index)),i.vertices[1].copy(n.getAtomPos(this._atom2.index)),this._line.computeLineDistances(),i.computeBoundingSphere(),i.verticesNeedUpdate=!0}}}]),t}(pw);pc.prototype.constructor=pc;pc.prototype.type="line";var ZU=`precision highp float;\r
\r
uniform sampler2D srcTex;\r
uniform vec2 srcTexSize;\r
uniform vec2 thickness;\r
varying vec2 vUv;\r
\r
#ifdef DEPTH_OUTLINE\r
  uniform sampler2D srcDepthTex; //depthTexture\r
  uniform vec3 color;\r
  uniform float threshold;\r
#endif\r
\r
void main() {\r
\r
  vec2 pixelSize = thickness / srcTexSize;\r
\r
  #ifdef DEPTH_OUTLINE\r
    float c00 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,-pixelSize.y)).x;\r
    float c01 = texture2D(srcDepthTex, vUv + vec2(0,-pixelSize.y)).x;\r
    float c02 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,-pixelSize.y)).x;\r
    float c10 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,0)).x;\r
    float c12 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,0)).x;\r
    float c20 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,pixelSize.y)).x;\r
    float c21 = texture2D(srcDepthTex, vUv + vec2(0,pixelSize.y)).x;\r
    float c22 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,pixelSize.y)).x;\r
\r
    float horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r
    float vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r
\r
    float grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r
\r
    gl_FragColor = ( grad > threshold ) ? vec4(color.rgb, 1.0) : gl_FragColor = texture2D(srcTex, vUv);\r
\r
  #else\r
    vec4 c00 = texture2D(srcTex, vUv + vec2(-pixelSize.x,-pixelSize.y));\r
    vec4 c01 = texture2D(srcTex, vUv + vec2(0,-pixelSize.y));\r
    vec4 c02 = texture2D(srcTex, vUv + vec2(pixelSize.x,-pixelSize.y));\r
    vec4 c10 = texture2D(srcTex, vUv + vec2(-pixelSize.x,0));\r
    vec4 c12 = texture2D(srcTex, vUv + vec2(pixelSize.x,0));\r
    vec4 c20 = texture2D(srcTex, vUv + vec2(-pixelSize.x,pixelSize.y));\r
    vec4 c21 = texture2D(srcTex, vUv + vec2(0,pixelSize.y));\r
    vec4 c22 = texture2D(srcTex, vUv + vec2(pixelSize.x,pixelSize.y));\r
\r
    vec4 horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r
    vec4 vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r
\r
    vec4 grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r
    gl_FragColor = grad;\r
  #endif\r
}\r
`;function jU(a){var e=KU();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function KU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mm=function(a){ve(t,a);var e=jU(t);function t(r){var n;K(this,t),n=e.call(this,r);var i={uniforms:{srcTex:{type:"t",value:null},srcDepthTex:{type:"t",value:null},srcTexSize:{type:"v2",value:new Pe(512,512)},color:{type:"v3",value:null},threshold:{type:"f",value:null},opacity:{type:"f",value:1},thickness:{type:"v2",value:new Pe(1,1)}},vertexShader:es,fragmentShader:ZU,transparent:!0,depthTest:!1,depthWrite:!1};return n.setValues(i),n}return J(t,[{key:"copy",value:function(n){nn(H(t.prototype),"copy",this).call(this,n),this.depth=n.depth}},{key:"setValues",value:function(n){if(!(typeof n>"u")){nn(H(t.prototype),"setValues",this).call(this,n);var i={};this.depth&&(i.DEPTH_OUTLINE=1),this.defines=i}}}]),t}(Yr);mm.prototype.depth=!1;var JU=`precision highp float;\r
\r
// edge end finding algorithm parameters\r
#define FXAA_QUALITY_PS 8\r
#define FXAA_QUALITY_P0 1.0\r
#define FXAA_QUALITY_P1 1.5\r
#define FXAA_QUALITY_P2 2.0\r
#define FXAA_QUALITY_P3 2.0\r
#define FXAA_QUALITY_P4 2.0\r
#define FXAA_QUALITY_P5 2.0\r
#define FXAA_QUALITY_P6 4.0\r
#define FXAA_QUALITY_P7 12.0\r
// constants\r
float fxaaQualityEdgeThreshold = 0.125;\r
float fxaaQualityEdgeThresholdMin = 0.0625;\r
float fxaaQualitySubpix = 0.7; //0.65;\r
// global params\r
uniform sampler2D srcTex;\r
uniform vec2 srcTexelSize;\r
uniform vec3 bgColor;\r
// from vs\r
varying vec2 vUv;\r
//=====================================================================//\r
// calc luminance from rgb\r
//'float FxaaLuma(vec3 rgb) {return rgb.y * (0.587/0.299) + rgb.x; } // Lotte's idea about game luminance\r
float FxaaLuma(vec3 rgb) {return dot(rgb, vec3(0.299, 0.587, 0.114)); } // real luminance calculation\r
                                                                           // for non-real scene rendering\r
// texture sampling by pixel position(coords) and offset(in pixels)\r
 vec3 FxaaTex(sampler2D tex, vec2 pos, vec2 off,  vec2 res ) {\r
  #ifdef BG_TRANSPARENT\r
    vec4 color = texture2D( tex, pos + off * res );\r
    return mix(color.rgb, bgColor, 1.0 - color.a);\r
  #else\r
    return texture2D( tex, pos + off * res ).xyz;\r
  #endif\r
}\r
vec3 FxaaTexTop(sampler2D tex, vec2 pos) {\r
  #ifdef BG_TRANSPARENT\r
    vec4 color = texture2D( tex, pos );\r
    return mix(color.rgb, bgColor, 1.0 - color.a);\r
  #else\r
    return texture2D( tex, pos).xyz;\r
  #endif\r
}\r
vec4 FxaaTexTopAlpha(sampler2D tex, vec2 pos) {\r
  return texture2D( tex, pos);\r
}\r
\r
//=====================================================================//\r
void main() {\r
  // renaming\r
  vec2 posM = vUv;\r
  // get luminance for neighbours\r
  float lumaS = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, 1.0 ), srcTexelSize));\r
  float lumaE = FxaaLuma(FxaaTex(srcTex, posM, vec2( 1.0, 0.0 ), srcTexelSize));\r
  float lumaN = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, -1.0 ), srcTexelSize));\r
  float lumaW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, 0.0 ), srcTexelSize));\r
  float lumaM = FxaaLuma(FxaaTexTop(srcTex, posM));\r
  // find max and min luminance\r
  float rangeMax = max(max(lumaN, lumaW), max(lumaE, max(lumaS, lumaM)));\r
  float rangeMin = min(min(lumaN, lumaW), min(lumaE, min(lumaS, lumaM)));\r
  // calc maximum non-edge range\r
  float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\r
  float range = rangeMax - rangeMin;\r
  float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\r
  // exit when luma contrast is small (is not edge)\r
  if(range < rangeMaxClamped){\r
    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r
    return;\r
  }\r
  float subpixRcpRange = 1.0/range;\r
  // note: the sampling coordinates can be calculated in vertex shader but the approach doesn't affect performance\r
  // visibly, thus we decided to leave calculation here for better readability.\r
  // calc other neighbours luminance\r
  float lumaNE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0, -1.0 ), srcTexelSize));\r
  float lumaSW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0,  1.0 ), srcTexelSize));\r
  float lumaSE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0,  1.0 ), srcTexelSize));\r
  float lumaNW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, -1.0 ), srcTexelSize));\r
/*--------------span calculation and subpix amount calulation-----------------*/\r
  float lumaNS = lumaN + lumaS;\r
  float lumaWE = lumaW + lumaE;\r
  float subpixNSWE = lumaNS + lumaWE;\r
  float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\r
  float edgeVert1 = (-2.0 * lumaM) + lumaWE;\r
/*--------------------------------------------------------------------------*/\r
  float lumaNESE = lumaNE + lumaSE;\r
  float lumaNWNE = lumaNW + lumaNE;\r
  float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\r
  float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\r
/*--------------------------------------------------------------------------*/\r
  float lumaNWSW = lumaNW + lumaSW;\r
  float lumaSWSE = lumaSW + lumaSE;\r
  float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\r
  float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\r
  float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\r
  float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\r
  float edgeHorz = abs(edgeHorz3) + edgeHorz4;\r
  float edgeVert = abs(edgeVert3) + edgeVert4;\r
/*--------------------subpix amount calulation------------------------------*/\r
  float subpixNWSWNESE = lumaNWSW + lumaNESE;\r
  float lengthSign = srcTexelSize.x;\r
  bool horzSpan = edgeHorz >= edgeVert;\r
   // debug  code edge span visualization\r
/*'  if (horzSpan)\r
      gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\r
  else\r
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r
  return;*/\r
  float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\r
/*--------------------------------------------------------------------------*/\r
  if(!horzSpan) lumaN = lumaW;\r
  if(!horzSpan) lumaS = lumaE;\r
  if(horzSpan) lengthSign = srcTexelSize.y;\r
  float subpixB = (subpixA * (1.0/12.0)) - lumaM;\r
/*--------------------------------------------------------------------------*/\r
  float gradientN = lumaN - lumaM;\r
  float gradientS = lumaS - lumaM;\r
  float lumaNN = lumaN + lumaM;\r
  float lumaSS = lumaS + lumaM;\r
  bool pairN = abs(gradientN) >= abs(gradientS);\r
  float gradient = max(abs(gradientN), abs(gradientS));\r
  if(pairN) lengthSign = -lengthSign;\r
  float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\r
/*--------------------------------------------------------------------------*/\r
  vec2 posB;\r
  posB = posM;\r
  vec2 offNP;\r
  offNP.x = (!horzSpan) ? 0.0 : srcTexelSize.x;\r
  offNP.y = ( horzSpan) ? 0.0 : srcTexelSize.y;\r
  if(!horzSpan) posB.x += lengthSign * 0.5;\r
  if( horzSpan) posB.y += lengthSign * 0.5;\r
/*--------------------------------------------------------------------------*/\r
  vec2 posN;\r
  posN = posB - offNP * FXAA_QUALITY_P0;\r
  vec2 posP;\r
  posP = posB + offNP * FXAA_QUALITY_P0;\r
  float subpixD = ((-2.0)*subpixC) + 3.0;\r
  float lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN));\r
  float subpixE = subpixC * subpixC;\r
  float lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP));\r
/*--------------------------------------------------------------------------*/\r
  if(!pairN) lumaNN = lumaSS;\r
  float gradientScaled = gradient * 1.0/4.0;\r
  float lumaMM = lumaM - lumaNN * 0.5;\r
  float subpixF = subpixD * subpixE;\r
  bool lumaMLTZero = lumaMM < 0.0;\r
/*---------------------looped edge-end search-------------------------------*/\r
  lumaEndN -= lumaNN * 0.5;\r
  lumaEndP -= lumaNN * 0.5;\r
  bool doneN = abs(lumaEndN) >= gradientScaled;\r
  bool doneP = abs(lumaEndP) >= gradientScaled;\r
  if(!doneN) posN -= offNP * FXAA_QUALITY_P1;\r
  bool doneNP = (!doneN) || (!doneP);\r
  if(!doneP) posP += offNP * FXAA_QUALITY_P1;\r
/*--------------------------------------------------------------------------*/\r
  if(doneNP) {\r
    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
    doneN = abs(lumaEndN) >= gradientScaled;\r
    doneP = abs(lumaEndP) >= gradientScaled;\r
    if(!doneN) posN -= offNP * FXAA_QUALITY_P2;\r
    doneNP = (!doneN) || (!doneP);\r
    if(!doneP) posP += offNP * FXAA_QUALITY_P2;\r
/*--------------------------------------------------------------------------*/\r
    #if (FXAA_QUALITY_PS > 3)\r
      if(doneNP) {\r
        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
        doneN = abs(lumaEndN) >= gradientScaled;\r
        doneP = abs(lumaEndP) >= gradientScaled;\r
        if(!doneN) posN -= offNP * FXAA_QUALITY_P3;\r
        doneNP = (!doneN) || (!doneP);\r
        if(!doneP) posP += offNP * FXAA_QUALITY_P3;\r
/*--------------------------------------------------------------------------*/\r
        #if (FXAA_QUALITY_PS > 4)\r
          if(doneNP) {\r
            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
            doneN = abs(lumaEndN) >= gradientScaled;\r
            doneP = abs(lumaEndP) >= gradientScaled;\r
            if(!doneN) posN -= offNP * FXAA_QUALITY_P4;\r
            doneNP = (!doneN) || (!doneP);\r
            if(!doneP) posP += offNP * FXAA_QUALITY_P4;\r
/*--------------------------------------------------------------------------*/\r
            #if (FXAA_QUALITY_PS > 5)\r
               if(doneNP) {\r
                 if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                 if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                 if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                 if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                 doneN = abs(lumaEndN) >= gradientScaled;\r
                 doneP = abs(lumaEndP) >= gradientScaled;\r
                 if(!doneN) posN -= offNP * FXAA_QUALITY_P5;\r
                 doneNP = (!doneN) || (!doneP);\r
                 if(!doneP) posP += offNP * FXAA_QUALITY_P5;\r
/*--------------------------------------------------------------------------*/\r
                 #if (FXAA_QUALITY_PS > 6)\r
                   if(doneNP) {\r
                     if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                     if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                     if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                     if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                     doneN = abs(lumaEndN) >= gradientScaled;\r
                     doneP = abs(lumaEndP) >= gradientScaled;\r
                     if(!doneN) posN -= offNP * FXAA_QUALITY_P6;\r
                     doneNP = (!doneN) || (!doneP);\r
                     if(!doneP) posP += offNP * FXAA_QUALITY_P6;\r
/*--------------------------------------------------------------------------*/\r
                     #if (FXAA_QUALITY_PS > 7)\r
                       if(doneNP) {\r
                         if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                         if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                         if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                         if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                         doneN = abs(lumaEndN) >= gradientScaled;\r
                         doneP = abs(lumaEndP) >= gradientScaled;\r
                         if(!doneN) posN -= offNP * FXAA_QUALITY_P7;\r
                         doneNP = (!doneN) || (!doneP);\r
                         if(!doneP) posP += offNP * FXAA_QUALITY_P7;\r
/*--------------------------------------------------------------------------*/\r
                       }\r
                     #endif\r
                   }\r
                 #endif\r
               }\r
             #endif\r
           }\r
         #endif\r
      }\r
    #endif\r
  }\r
/*----------------calculate subpix offset due to edge ends-------------------*/\r
  float dstN = posM.x - posN.x;\r
  float dstP = posP.x - posM.x;\r
  if(!horzSpan) dstN = posM.y - posN.y;\r
  if(!horzSpan) dstP = posP.y - posM.y;\r
/*--------------------------------------------------------------------------*/\r
  bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\r
  float spanLength = (dstP + dstN);\r
  bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\r
  float spanLengthRcp = 1.0 / spanLength;\r
/*--------------------------------------------------------------------------*/\r
  bool directionN = dstN < dstP;\r
  float dst = min(dstN, dstP);\r
  bool goodSpan = directionN ? goodSpanN : goodSpanP;\r
  float subpixG = subpixF * subpixF;\r
  float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\r
  float subpixH = subpixG * fxaaQualitySubpix;\r
/*-----------------calc texture offest using subpix-------------------------*/\r
  float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\r
  float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\r
\r
  float offset = pixelOffsetSubpix * lengthSign;\r
  #ifdef BG_TRANSPARENT\r
    // get original texel\r
    vec4 rgbaA = FxaaTexTopAlpha(srcTex, posM);\r
    // calc step to blended texel\r
    vec2 step = sign((!horzSpan) ? vec2 (offset, 0.0) : vec2 (0.0, offset));\r
    // get neighboring texel\r
    vec4 rgbaB = FxaaTexTopAlpha(srcTex, posM + step * srcTexelSize);\r
    //  calc blend factor from offset\r
    float f = (!horzSpan) ? offset / srcTexelSize.x : offset / srcTexelSize.y;\r
    f = abs(f);\r
    // calc alpha (special formula to emulate blending with bg)\r
    gl_FragColor.a = 1.0 - mix(1.0 - rgbaA.a, 1.0 - rgbaB.a, f);\r
    // calc color (special formula to emulate blending with bg)\r
    gl_FragColor.rgb = mix(rgbaA.rgb * rgbaA.a, rgbaB.rgb * rgbaB.a, f) / gl_FragColor.a;\r
  #else\r
    if(!horzSpan) {\r
       posM.x += offset;\r
    } else {\r
       posM.y += offset;\r
    }\r
    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r
  #endif\r
  return;\r
}\r
`;function QU(a){var e=eG();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function eG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mw=function(a){ve(t,a);var e=QU(t);function t(r){var n;return K(this,t),n=e.call(this,r),n.setValues({uniforms:{srcTex:{type:"t",value:null},srcTexelSize:{type:"v2",value:new Pe(1/512,1/512)},bgColor:{type:"c",value:new nt(16777215)}},vertexShader:es,fragmentShader:JU,transparent:!1,depthTest:!1,depthWrite:!1}),n.setValues(r),n}return J(t,[{key:"copy",value:function(n){nn(H(t.prototype),"copy",this).call(this,n),this.depth=n.depth}},{key:"setValues",value:function(n){if(!(typeof n>"u")){nn(H(t.prototype),"setValues",this).call(this,n);var i={};this.bgTransparent&&(i.BG_TRANSPARENT=1),this.defines=i}}}]),t}(Yr);mw.prototype.bgTransparent=!1;var tG=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 32\r
uniform vec3 samplesKernel[MAX_SAMPLES_COUNT];\r
uniform sampler2D noiseTexture;\r
uniform vec2      noiseTexelSize;\r
uniform sampler2D diffuseTexture;\r
uniform sampler2D depthTexture;\r
uniform sampler2D normalTexture;\r
uniform vec2      srcTexelSize;\r
uniform vec2      camNearFar;\r
uniform mat4      projMatrix;\r
\r
uniform float aspectRatio;\r
uniform float tanHalfFOV;\r
\r
uniform float kernelRadius;\r
uniform float depthThreshold;\r
uniform float factor;\r
\r
varying vec2 vUv;\r
\r
float CalcViewZ(vec2 screenPos)\r
{\r
  float depth = texture2D(depthTexture, screenPos).x;\r
  // [0, 1]->[-1, 1]\r
  float clipedZ = 2.0 * depth - 1.0;\r
  // see THREE.js camera.makeFrustum for projection details\r
  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r
}\r
\r
vec3 ViewPosFromDepth(vec2 screenPos)\r
{\r
  vec3 viewPos;\r
  viewPos.z = CalcViewZ(screenPos);\r
  //[0, 1]->[-1, 1]\r
  vec2 projPos = 2.0 * screenPos - 1.0;\r
  // reconstruct viewposition in right-handed sc with z to viewer\r
  viewPos.xy = vec2(\r
                    projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r
                    projPos.y * tanHalfFOV * abs(viewPos.z)\r
                   );\r
  return viewPos;\r
}\r
\r
void main() {\r
  vec3 viewPos = ViewPosFromDepth(vUv);\r
  // remap coordinates to prevent noise exture rescale\r
  vec2 vUvNoise = vUv / srcTexelSize * noiseTexelSize;\r
  vec4 normalData = texture2D(normalTexture, vUv);\r
  // return for background fragments (their normals are zero vectors)\r
  if (length(normalData.rgb) < EPSILON) {\r
    // 0.0 in alpha component means that it is background fragment\r
    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\r
    return;\r
  }\r
  //[0, 1] -> [-1, 1]\r
  vec3 normal = (normalData.rgb * 2.0 - 1.0);\r
  // normalData.a store 1.0 if normal was build for frontfaced surface\r
  // and 0.0 in other case\r
  if (normalData.a < EPSILON) {\r
    normal *= -1.0;\r
  }\r
  // get random vector for sampling sphere rotation\r
  vec3 randN = texture2D(noiseTexture, vUvNoise).rgb * 2.0 - 1.0;\r
  randN = normalize(randN);\r
  // build TBN (randomly rotated around normal)\r
  vec3 tangent   = normalize(randN - normal * dot(randN, normal));\r
  vec3 bitangent = cross(tangent, normal);\r
  mat3 TBN = mat3(tangent, bitangent, normal);\r
  // calc AO value\r
  float AO = 0.0;\r
  for (int i = 0 ; i < MAX_SAMPLES_COUNT ; i++) {\r
    // rotate sampling kernel around normal\r
    vec3 reflectedSample = TBN * samplesKernel[i];\r
    // get sample\r
    vec3 samplePos = viewPos + reflectedSample * kernelRadius;\r
\r
    // project sample to screen to get sample's screen pos\r
    vec4 SampleScrPos = vec4(samplePos, 1.0);\r
    // eye -> clip\r
    SampleScrPos = projMatrix * SampleScrPos;\r
    // normalize\r
    SampleScrPos.xy /= SampleScrPos.w;\r
    //[-1, 1] -> [0, 1]\r
    SampleScrPos.xy = (SampleScrPos.xy + vec2(1.0)) * 0.5;\r
\r
    // get view z for sample projected to the objct surface\r
    float sampleDepth = CalcViewZ(SampleScrPos.xy);\r
    // calc occlusion made by object surface at the sample\r
    AO += step(samplePos.z, sampleDepth);\r
  }\r
  // calc result AO-map color\r
  AO = 1.0 - max(0.0, AO / float(MAX_SAMPLES_COUNT) * factor);\r
  // write value to AO-map\r
  gl_FragColor = vec4(AO, AO, AO, 1.0);\r
}\r
`;function nG(a){var e=rG();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function rG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iG=[new C(.295184,.077723,.068429),new C(-.271976,-.365221,.838363),new C(.547713,.467576,.488515),new C(.662808,-.031733,.584758),new C(-.025717,.218955,.657094),new C(-.310153,-.365223,.370701),new C(-.101407,-.006313,.747665),new C(-.769138,.360399,.086847),new C(-.271988,-.27514,.905353),new C(.09674,-.566901,.700151),new C(.562872,-.735136,.094647),new C(.379877,.359278,.190061),new C(.519064,-.023055,.405068),new C(-.301036,.114696,.088885),new C(-.282922,.598305,.487214),new C(-.181859,.25167,.679702),new C(-.191463,-.635818,.512919),new C(-.293655,.427423,.078921),new C(-.267983,.680534,.13288),new C(.139611,.319637,.477439),new C(-.352086,.31104,.653913),new C(.321032,.805279,.487345),new C(.073516,.820734,.414183),new C(-.155324,.589983,.41146),new C(.335976,.170782,.527627),new C(.46346,-.355658,.167689),new C(.222654,.59655,.769406),new C(.922138,-.04207,.147555),new C(-.72705,-.329192,.369826),new C(-.090731,.53382,.463767),new C(-.323457,-.876559,.238524),new C(-.663277,-.372384,.342856)],aG=function(a){ve(t,a);var e=nG(t);function t(){var r;return K(this,t),r=e.call(this),r.setValues({uniforms:{noiseTexture:{type:"t",value:Bo.noiseTexture},noiseTexelSize:{type:"v2",value:new Pe(1/Bo.noiseWidth,1/Bo.noiseHeight)},diffuseTexture:{type:"t",value:null},normalTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new Pe(1/512,1/512)},camNearFar:{type:"v2",value:new Pe(1,10)},projMatrix:{type:"mat4",value:new Xe},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},samplesKernel:{type:"v3v",value:iG},kernelRadius:{type:"f",value:1},depthThreshold:{type:"f",value:1},factor:{type:"f",value:1}},vertexShader:es,fragmentShader:tG,transparent:!1,depthTest:!1,depthWrite:!1}),r}return J(t)}(Yr),sG=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 5\r
uniform float samplesOffsets[MAX_SAMPLES_COUNT];\r
uniform sampler2D aoMap;\r
uniform sampler2D depthTexture;\r
uniform vec2      srcTexelSize;\r
\r
varying vec2 vUv;\r
\r
void main() {\r
  float x = vUv.x;\r
  float y = vUv.y;\r
  vec4 res = vec4(0.0);\r
  res.a = texture2D(aoMap, vec2(x, y )).a;\r
  // return for background fragments (0.0 in alpha component means that it is background fragment)\r
  if (res.a < EPSILON) {\r
    gl_FragColor = res;\r
    return;\r
  }\r
\r
  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r
  float weightSum = 0.0;\r
  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r
    if (texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).a < EPSILON) {\r
      continue;\r
    }\r
    vec2 samplePos = vec2(x + samplesOffsets[i] * srcTexelSize.x, y);\r
    float depth = texture2D(depthTexture, samplePos).x;\r
    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r
    res.rgb += texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).rgb * weight;\r
    weightSum += weight;\r
  }\r
  res.rgb = res.rgb / weightSum;\r
  gl_FragColor = res;\r
}\r
`;function oG(a){var e=lG();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function lG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cG=[-2,-1,0,1,2],uG=function(a){ve(t,a);var e=oG(t);function t(){var r;return K(this,t),r=e.call(this),r.setValues({uniforms:{depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new Pe(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:cG}},vertexShader:es,fragmentShader:sG,transparent:!1,depthTest:!1,depthWrite:!1}),r}return J(t)}(Yr),fG=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 5\r
uniform float samplesOffsets[MAX_SAMPLES_COUNT];\r
uniform sampler2D diffuseTexture;\r
uniform sampler2D aoMap;\r
uniform sampler2D depthTexture;\r
uniform vec2      srcTexelSize;\r
\r
uniform mat4  projMatrix;\r
uniform float aspectRatio;\r
uniform float tanHalfFOV;\r
\r
#ifdef USE_FOG\r
  uniform vec2 fogNearFar;\r
  uniform vec4 fogColor;\r
#endif\r
varying vec2 vUv;\r
\r
float CalcViewZ(vec2 screenPos)\r
{\r
  float depth = texture2D(depthTexture, screenPos).x;\r
  // [0, 1]->[-1, 1]\r
  float clipedZ = 2.0 * depth - 1.0;\r
  // see THREE.js camera.makeFrustum for projection details\r
  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r
}\r
\r
vec3 ViewPosFromDepth(vec2 screenPos)\r
{\r
  vec3 viewPos;\r
  viewPos.z = CalcViewZ(screenPos);\r
  //[0, 1]->[-1, 1]\r
  vec2 projPos = 2.0 * screenPos - 1.0;\r
  // reconstruct viewposition in right-handed sc with z to viewer\r
  viewPos.xy = vec2(\r
  projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r
  projPos.y * tanHalfFOV * abs(viewPos.z)\r
  );\r
  return viewPos;\r
}\r
\r
void main() {\r
  vec3 viewPos = ViewPosFromDepth(vUv);\r
  float x = vUv.x;\r
  float y = vUv.y;\r
  vec4 color = texture2D(diffuseTexture, vec2(x, y));\r
  vec4 res = vec4(0.0);\r
  res.a = texture2D(aoMap, vec2(x, y )).a;\r
  // return for background fragments (0.0 in alpha component means that it is background fragment)\r
  if (res.a < EPSILON) {\r
    gl_FragColor = color;\r
    return;\r
  }\r
\r
  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r
  float weightSum = 0.0;\r
  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r
    if (texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).a < EPSILON) {\r
      continue;\r
    }\r
    vec2 samplePos = vec2(x, y + samplesOffsets[i] * srcTexelSize.y);\r
    float depth = texture2D(depthTexture, samplePos).x;\r
    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r
    res.rgb += texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).rgb * weight;\r
    weightSum += weight;\r
  }\r
  res.rgb /= weightSum;\r
\r
  #if defined(USE_FOG) && !defined(FOG_TRANSPARENT)\r
    // Add fog to the result value\r
    // Proper way to get an image with fog and ao requires formula:\r
    //          gl_FragColor = fragColor*AO*(1-fogFactor) + fogColor*fogFactor\r
    // But we have already fogged molecule to add AO too. Let's split the straight formula into our real steps!\r
    // We have:  AO, fogFactor, fogColor,\r
    //          color = fragColor*(1-fogFactor) + fogColor*fogFactor (it comes from diffuseTexture,\r
    //                                                                where molecule has been already drawn with fog)\r
    // Transform:\r
    //          fragColor*AO*(1-fogFactor) + fogColor*fogFactor =\r
    //        = [fragColor*(1-fogFactor) = color - fogColor*fogFactor] =\r
    //        = (color - fogColor*fogFactor)*AO + fogColor*fogFactor =\r
    //        = color*AO + fogColor*fogFactor*(1 - AO)\r
    // Result:  gl_FragColor = color*AO + fogColor*fogFactor*(1 - AO)\r
    float fogFactor = smoothstep(fogNearFar.x, fogNearFar.y, - viewPos.z) * fogColor.a;\r
    gl_FragColor.rgb = color.rgb * res.rgb + fogColor.rgb * fogFactor *(vec3(1.0, 1.0, 1.0) - res.rgb);\r
  #else\r
    gl_FragColor.rgb = color.rgb * res.rgb;\r
  #endif\r
  gl_FragColor.a = color.a;\r
}\r
`;function hG(a){var e=dG();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function dG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pG=[-2,-1,0,1,2],xv=function(a){ve(t,a);var e=hG(t);function t(r){var n;return K(this,t),n=e.call(this,r),n.setValues({uniforms:{diffuseTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new Pe(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:pG},projMatrix:{type:"mat4",value:new Xe},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},fogNearFar:{type:"v2",value:new Pe(100,100)},fogColor:{type:"v4",value:new Gt(0,.5,0,1)}},vertexShader:es,fragmentShader:fG,transparent:!1,depthTest:!1,depthWrite:!1}),n.setValues(r),n}return J(t,[{key:"setValues",value:function(n){if(!(typeof n>"u")){nn(H(t.prototype),"setValues",this).call(this,n);var i={};this.useFog&&(i.USE_FOG=1),this.fogTransparent&&(i.FOG_TRANSPARENT=1),this.defines=i}}}]),t}(Yr);xv.prototype.useFog=!0;xv.prototype.fogTransparent=!1;var mG=`precision highp float;\r
\r
uniform sampler2D srcL;\r
uniform sampler2D srcR;\r
varying vec2 vUv;\r
\r
void main() {\r
  vec4 l = texture2D(srcL, vUv);\r
  vec4 r = texture2D(srcR, vUv);\r
  gl_FragColor = vec4(l.r, r.g, r.b, 1.0);\r
}\r
`;function vG(a){var e=gG();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function gG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _G=function(a){ve(t,a);var e=vG(t);function t(){var r;K(this,t),r=e.call(this);var n={uniforms:{srcL:{type:"t",value:null},srcR:{type:"t",value:null}},vertexShader:es,fragmentShader:mG,transparent:!1,depthTest:!1,depthWrite:!1};return r.setValues(n),r}return J(t)}(Yr),yG=function(){function a(){K(this,a),this.position=new C(0,0,0),this.scale=1,this.orientation=new On(0,0,0,1)}return J(a,[{key:"set",value:function(t,r,n){this.position=t,this.scale=r,this.orientation=n}}]),a}(),xG=1.5,SG=function(){function a(){K(this,a)}return J(a,[{key:"setup",value:function(t,r){this._startTime=void 0,this._endTime=void 0,this._isPaused=!1,this._srcView=t,this._dstView=r,this._isMoving=!1}},{key:"isMoving",value:function(){return this._isMoving}},{key:"wasStarted",value:function(){return typeof this._startTime<"u"&&typeof this._endTime<"u"}},{key:"start",value:function(){this._startTime=Date.now();var t=fe.now.interpolateViews?xG*1e3:0;this._endTime=this._startTime+t,this._isMoving=!0}},{key:"getCurrentView",value:function(){if(typeof this._srcView>"u"||typeof this._dstView>"u"||!this._isMoving||!this.wasStarted())return{success:!1};var t=this.createView(),r=Date.now();if(r>this._endTime)return t=this._dstView,this.reset(),{success:!0,view:t};var n=(r-this._startTime)/(this._endTime-this._startTime);return t.position.copy(this._srcView.position),t.position.lerp(this._dstView.position,n),t.scale=(1-n)*this._srcView.scale+n*this._dstView.scale,t.orientation.copy(this._srcView.orientation),t.orientation.slerp(this._dstView.orientation,n),{success:!0,view:t}}},{key:"reset",value:function(){this._startTime=this._endTime=0,this._isMoving=!1}},{key:"pause",value:function(){this._isPaused||(this.setup(this.getCurrentView().view,this._dstView),this._isPaused=!0)}},{key:"resume",value:function(){this._isPaused=!1}},{key:"createView",value:function(){return new yG}}]),a}(),wG=4e3,bG="Cnt";function MG(a,e){for(var t=a.length,r=[],n=0,i=0;i<t;n++,i+=e)r[n]=a.slice(i,i+e);return r}function Ei(a,e){this.context=a,this._opts=xe.merge({path:"/"},e)}Sc(Ei.prototype);Ei.prototype.removeCookie=function(a){var e=this._toCount(a),t=this._getSimpleCookie(e);if(!t){this._removeSimpleCookie(a);return}this._removeSimpleCookie(e),t=parseInt(t,10);for(var r=0;r<t;++r)this._removeSimpleCookie(a+r)};Ei.prototype.setCookie=function(a,e){this.removeCookie(a),e=encodeURIComponent(e);var t=MG(e,wG-a.length-1),r=t.length;if(r===1){this._setSimpleCookie(a,e);return}var n=this._toCount(a);this._setSimpleCookie(n,r.toString());for(var i=0;i<r;++i)this._setSimpleCookie(a+i,t[i])};Ei.prototype.getCookie=function(a){var e=this._toCount(a),t=this._getSimpleCookie(e);if(!t)return this._getSimpleCookie(a);t=parseInt(t,10);for(var r=[],n=0;n<t;++n)r[n]=this._getSimpleCookie(a+n);return r.join("")};Ei.prototype._toCount=function(a){return a+bG};Ei.prototype._removeSimpleCookie=function(a){document.cookie="".concat(a,"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;")};Ei.prototype._getExpirationDate=function(){var a=new Date,e=10;return a.setFullYear(a.getFullYear()+e),a};Ei.prototype._setSimpleCookie=function(a,e){document.cookie="".concat(a,"=").concat(e,";expires=").concat(this._getExpirationDate().toUTCString(),";path=").concat(this._opts.path)};Ei.prototype._getSimpleCookie=function(a){var e=document.cookie.match(new RegExp("(?:^|; )".concat(a,"=([^;]*)")));return e?decodeURIComponent(e[1]):""};Ei.prototype._exists=function(a){return document.cookie.match(new RegExp("(?:^|; )".concat(a,"=([^;]*)")))};function EG(a){function e(s){s.style.display="",s.style.cursor="pointer",s.style.left="calc(50% - 50px)",s.style.width="100px",s.textContent="ENTER VR";var o=null;function l(){o.removeEventListener("end",l),s.textContent="ENTER VR",o=null}function c(f){f.addEventListener("end",l),a._gfx.renderer.xr.setReferenceSpaceType("local"),a._gfx.renderer.xr.setSession(f),s.textContent="EXIT VR",o=f}s.onmouseenter=function(){s.style.opacity="1.0"},s.onmouseleave=function(){s.style.opacity="0.5"},s.onclick=function(){if(o===null){var f={optionalFeatures:["local-floor","bounded-floor"]};navigator.xr.requestSession("immersive-vr",f).then(c),a.moveSceneBehindHeadset()}else o.end()}}function t(s){s.style.display="",s.style.cursor="auto",s.style.left="calc(50% - 75px)",s.style.width="150px",s.textContent="VR NOT FOUND",s.onmouseenter=null,s.onmouseleave=null,s.onclick=null}function r(s){s.style.position="absolute",s.style.bottom="20px",s.style.padding="12px 6px",s.style.border="1px solid #fff",s.style.borderRadius="4px",s.style.background="transparent",s.style.color="#fff",s.style.font="normal 13px sans-serif",s.style.textAlign="center",s.style.opacity="0.5",s.style.outline="none",s.style.zIndex="999"}if("xr"in navigator){var n=document.createElement("button");return n.style.display="none",r(n),navigator.xr.isSessionSupported("immersive-vr").then(function(s){return s?e(n):t(n)}),n}var i=document.createElement("a");return i.href="https://webvr.info",i.innerHTML="WEBXR NOT SUPPORTED",i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",r(i),i}var CG=function(){function a(e){K(this,a),this._mainCamera=new En,this._button=null,this._onToggle=e,this._molContainer=new _t.RCGroup,this._user=new _t.RCGroup,this._scalingPivot=new Dt,this._user.add(this._scalingPivot),this._controller1=null,this._controller2=null,this._pressedGripsCounter=0,this._distance=0,this._gfx=null}return J(a,[{key:"startScalingByControllers",value:function(){this._distance=this._controller1.position.distanceTo(this._controller2.position),_t.getMiddlePoint(this._controller1.position,this._controller2.position,this._scalingPivot.position),this._scalingPivot.scale.set(1,1,1),this._scalingPivot.updateMatrix(),this._scalingPivot.updateMatrixWorld(),this._scalingPivot.addSavingWorldTransform(this._molContainer)}},{key:"stopScalingByControllers",value:function(){this._gfx.scene.addSavingWorldTransform(this._molContainer)}},{key:"handleGripsDown",value:function(t){this._pressedGripsCounter++,this._pressedGripsCounter===2?this.startScalingByControllers():this._pressedGripsCounter===1&&t.target.addSavingWorldTransform(this._molContainer)}},{key:"handleGripsUp",value:function(t){if(this._pressedGripsCounter--,this._pressedGripsCounter===1){this.stopScalingByControllers();var r=t.target===this._controller1?this._controller2:this._controller1;r.addSavingWorldTransform(this._molContainer)}else this._pressedGripsCounter===0&&this._gfx.scene.addSavingWorldTransform(this._molContainer)}},{key:"enable",value:function(t){if(!t){kn.warn("WebVR couldn't be enabled, because gfx is not defined");return}this._gfx=t;var r=t.renderer,n=t.camera;if(!r)throw new Error("No renderer is available to toggle WebVR");if(!n)throw new Error("No camera is available to toggle WebVR");r.xr.enabled=!0,this._button?this._button.style.display="block":(this._button=EG(this),document.body.appendChild(this._button)),this._mainFog=fe.now.fog,fe.set("fog",!1),this._plugVRNodesIntoScene(t,r),this._setControllersListeners(),this._onToggle&&this._onToggle(!0)}},{key:"_plugVRNodesIntoScene",value:function(t,r){this._mainCamera.copy(t.camera),t.scene.add(this._user),t.scene.add(this._molContainer),this._molContainer.add(t.root),this._controller1=r.xr.getController(0),this._controller2=r.xr.getController(1);var n=this._createControllerMesh();this._controller1.add(n),this._controller2.add(n.clone()),this._user.add(this._controller1),this._user.add(this._controller2)}},{key:"_setControllersListeners",value:function(){var t=this;this._controller1.addEventListener("selectstart",function(r){t.handleGripsDown(r)}),this._controller1.addEventListener("selectend",function(r){t.handleGripsUp(r)}),this._controller2.addEventListener("selectstart",function(r){t.handleGripsDown(r)}),this._controller2.addEventListener("selectend",function(r){t.handleGripsUp(r)}),this._controller1.addEventListener("squeezestart",function(r){t.handleGripsDown(r)}),this._controller1.addEventListener("squeezeend",function(r){t.handleGripsUp(r)}),this._controller2.addEventListener("squeezestart",function(r){t.handleGripsDown(r)}),this._controller2.addEventListener("squeezeend",function(r){t.handleGripsUp(r)})}},{key:"disable",value:function(){if(this._gfx){var t=this._gfx,r=t.renderer,n=t.camera;if(!r)throw new Error("No renderer is available to toggle WebVR");r.setAnimationLoop(null);var i=r.xr.getSession();i&&i.end(),r.xr.enabled=!1,this._button&&(this._button.style.display="none"),fe.set("fog",this._mainFog),this._unplugVRNodesFromScene(n),this._onToggle&&this._onToggle(!1)}}},{key:"_unplugVRNodesFromScene",value:function(t){this._mainCamera&&t&&t.copy(this._mainCamera);var r=this._molContainer.children[0];r&&this._gfx.scene.add(r),this._molContainer.parent.remove(this._molContainer),this._user&&this._gfx.scene.remove(this._user),this._molContainer=null,this._user=null,this._scalingPivot=null,this._user=null,this._controller1=null,this._controller2=null}},{key:"_createControllerMesh",value:function(){var t=new gc(.04,.04,.3),r=new Fi;r.setValues({lights:!1,overrideColor:!0}),r.setUberOptions({fixedColor:new nt(4474111)}),r.updateUniforms();var n=new Ut(t,r);return n.rotateX(-Math.PI/2),n}},{key:"updateMoleculeScale",value:function(){if(!(!this._controller1||!this._controller2)){var t=this;if(t._pressedGripsCounter===2){_t.getMiddlePoint(t._controller1.position,t._controller2.position,t._scalingPivot.position);var r=t._controller1.position.distanceTo(t._controller2.position),n=r/t._distance;t._scalingPivot.scale.multiplyScalar(n),t._distance=r}}}},{key:"moveSceneBehindHeadset",value:function(){var t=this._gfx,r=t.camera,n=this._molContainer;n.matrix.identity(),n.position.set(0,0,-4),n.updateMatrix(),n.matrixWorld.multiplyMatrices(r.matrixWorld,n.matrix),t.scene.addSavingWorldTransform(n),this._onToggle&&this._onToggle(!0)}},{key:"getCanvas",value:function(){var t=this._gfx;return t&&t.renderer?t.renderer.domElement:null}}]),a}(),AG=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform vec3 aberration;\r
\r
void main() {\r
  vec2 uv = vUv * 2.0 - 1.0;\r
  \r
  gl_FragColor.r = texture2D(srcTex, 0.5 * (uv * aberration[0] + 1.0)).r;\r
  gl_FragColor.g = texture2D(srcTex, 0.5 * (uv * aberration[1] + 1.0)).g;\r
  gl_FragColor.b = texture2D(srcTex, 0.5 * (uv * aberration[2] + 1.0)).b;\r
  gl_FragColor.a = 1.0;\r
}`;function TG(a){var e=RG();return function(){var r=H(a),n;if(e){var i=H(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Me(this,n)}}function RG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mf=pt.selectors,LG=pt.Atom,PG=pt.Residue,IG=pt.Chain,NG=pt.Molecule,vn={COMPLEX:0,COMPONENT:1,FRAGMENT:2},vm="Could not find suitable loader for this source",kG="Could not find suitable parser for this source",Ef=ke.createElement;function OG(a,e,t){a.near=e-t*fe.now.fogNearFactor,a.far=e+t*fe.now.fogFarFactor}function D1(a){var e=a.lastIndexOf(".");return e>=0&&(a=a.substr(0,e)),a}function DG(a){var e=!1;return a.forEachComponent(function(t){t.forEachResidue(function(r){r._isValid&&(e=!0)})}),e}function F1(a,e,t){var r=100;t!==void 0?a.debug("".concat(e,"... ").concat(Math.floor(t*r),"%")):a.debug("".concat(e,"..."))}function Cf(){return fe.now.fogColorEnable?fe.now.fogColor:fe.now.bg.color}function Hp(a,e){for(var t=a;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(e)}function B1(a){return a.getExtension("EXT_frag_depth")}function z1(a){return a.getExtension("WEBGL_depth_texture")&&a.getExtension("WEBGL_draw_buffers")}var FG=/^(?:(pdb|cif|mmtf|ccp4|dsn6):\s*)?(\d[a-z\d]{3})$/i,BG=/^(?:pc|pubchem):\s*([a-z]+)$/i,zG=/^([a-z][a-z\d\-+.]*):/i;function VG(a,e){if(!xe.isString(a))return a;var t=FG.exec(a);if(t){var r=pn(t,3),n=r[1],i=n===void 0?"pdb":n,s=r[2];switch(i=i.toLowerCase(),s=s.toUpperCase(),i){case"pdb":a="https://files.rcsb.org/download/".concat(s,".pdb");break;case"cif":a="https://files.rcsb.org/download/".concat(s,".cif");break;case"mmtf":a="https://mmtf.rcsb.org/v1.0/full/".concat(s);break;case"ccp4":a="https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(s.toLowerCase(),".ccp4");break;case"dsn6":a="https://edmaps.rcsb.org/maps/".concat(s.toLowerCase(),"_2fofc.dsn6");break;default:throw new Error("Unexpected data format shortcut")}return e.fileType=i,e.fileName="".concat(s,".").concat(i),e.sourceType="url",a}var o=BG.exec(a);if(o){var l=o[1].toLowerCase();return a="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/".concat(l,"/JSON?record_type=3d"),e.fileType="pubchem",e.fileName="".concat(l,".json"),e.sourceType="url",a}return(e.sourceType==="url"||e.sourceType===void 0)&&(e.sourceType="url",zG.test(a)||(a=ke.resolveURL(a))),a}function UG(a){var e=a.binary;if(a.fileType!==void 0){var t=xe.head(Wa.parsers.find({format:a.fileType}));if(t)e=t.binary||!1;else throw new Error("Could not find suitable parser for this format")}if(e===void 0&&a.fileExt!==void 0){var r=xe.head(Wa.parsers.find({ext:a.fileExt}));r&&(e=r.binary||!1)}a.fileExt!==void 0&&a.fileExt.toLowerCase()===".man"&&(a.binary=!0,a.animation=!0),e!==void 0&&a.binary!==void 0&&a.binary!==e&&a.context.logger.warn("Overriding incorrect binary mode"),a.binary=e||!1}function GG(a,e,t){return new Promise(function(r){if(t.shouldCancel())throw new Error("Operation cancelled");t.notify({type:"fetching"}),a=VG(a,e);var n=xe.head(Wa.loaders.find({type:e.sourceType,source:a}));if(!n)throw new Error(vm);var i=e.fileName||n.extractName(a);if(i){var s=ke.splitFileName(i),o=pn(s,2),l=o[0],c=o[1];xe.defaults(e,{name:l,fileExt:c,fileName:i})}UG(e);var f=xe.get(e,"preset.expression");if(!xe.isUndefined(f)&&(f=JSON.parse(f),f&&f.settings))for(var d=["singleUnit"],p=0,m=d.length;p<m;++p){var v=d[p],y=xe.get(f.settings,v);xe.isUndefined(y)||fe.set(v,y)}var S=new n(a,e);S.context=e.context,t.addEventListener("cancel",function(){return S.abort()}),S.addEventListener("progress",function(x){x.lengthComputable&&x.total>0?F1(S.logger,"Fetching",x.loaded/x.total):F1(S.logger,"Fetching")}),console.time("fetch");var _=S.load().then(function(x){return console.timeEnd("fetch"),e.context.logger.info("Fetching finished"),t.notify({type:"fetchingDone",data:x}),x}).catch(function(x){throw console.timeEnd("fetch"),e.context.logger.debug(x.message),x.stack&&e.context.logger.debug(x.stack),e.context.logger.error("Fetching failed"),t.notify({type:"fetchingDone",error:x}),x});r(_)})}function HG(a,e,t){if(t.shouldCancel())return Promise.reject(new Error("Operation cancelled"));t.notify({type:"parsing"});var r=xe.head(Wa.parsers.find({format:e.fileType,ext:e.fileExt,data:a}));if(!r)return Promise.reject(new Error("Could not find suitable parser"));var n=new r(a,e);return n.context=e.context,t.addEventListener("cancel",function(){return n.abort()}),console.time("parse"),n.parse().then(function(i){return console.timeEnd("parse"),t.notify({type:"parsingDone",data:i}),i}).catch(function(i){throw console.timeEnd("parse"),e.error=i,e.context.logger.debug(i.message),i.stack&&e.context.logger.debug(i.stack),e.context.logger.error("Parsing failed"),t.notify({type:"parsingDone",error:i}),i})}function WG(a,e){return a.mask&1<<e}function XG(a,e){return e.selector.includesAtom(a)}var dr=function(a){ve(t,a);var e=TG(t);function t(r){var n;K(this,t),n=e.call(this),n._opts=xe.merge({settingsCookie:"settings",cookiePath:"/"},r),n._gfx=null,n._interpolator=new SG,n._container=r&&r.container||document.getElementById("miew-container")||xe.head(document.getElementsByClassName("miew-container"))||document.body,n._containerRoot=n._container,n._running=!1,n._halting=!1,n._building=!1,n._needRender=!0,n._hotKeysEnabled=!0,n.settings=fe;var i=kn;i.console=!1,i.level="info",n.logger=i,n._cookies=new Ei(si(n)),n.restoreSettings(),r&&r.settings&&n.settings.set(r.settings),n._spinner=null,n._loading=[],n._animInterval=null,n._visuals={},n._curVisualName=null,n._objects=[],n._sourceWindow=null,n.reset(),n._repr&&i.debug("Selected ".concat(n._repr.mode.name," mode with ").concat(n._repr.colorer.name," colorer."));var s=si(n);return t.registeredPlugins.forEach(function(o){o.call(s)}),n._initOnSettingsChanged(),n.shadowMatrix=new Xe,n.direction=new C,n.OBB={center:new C,halfSize:new C},n._bSphereForOneVisual=new Lr,n._bBoxForOneVisual=new An,n._bBox=new An,n._invMatrix=new Xe,n._points=[new C,new C,new C,new C],n._anaglyphMat=new _G,n._size=new Pe,n._scene=new Ga,n._camera=new Yo(-1,1,1,-1,-500,1e3),n._material=new Yr({uniforms:{srcTex:{type:"t",value:null},aberration:{type:"fv3",value:new C(1)}},vertexShader:es,fragmentShader:AG,transparent:!1,depthTest:!1,depthWrite:!1}),n._geo=_t.buildDistorionMesh(10,10,fe.now.debug.stereoBarrel),n._outlineMaterial=new mm({depth:!0}),n.pars={minFilter:_n,magFilter:_n,format:Mn},n.VERSION="0.10.0+20220125.134627.b36f6a2-mod",n}return J(t,[{key:"getMaxRepresentationCount",value:function(){return Pi.NUM_REPRESENTATION_BITS}},{key:"_updateShadowCamera",value:function(){this._gfx.scene.updateMatrixWorld();for(var n=0;n<this._gfx.scene.children.length;n++)if(this._gfx.scene.children[n].type==="DirectionalLight"){var i=this._gfx.scene.children[n];this.shadowMatrix.copy(i.shadow.camera.matrixWorldInverse),this.getOBB(this.shadowMatrix,this.OBB),this.direction.subVectors(i.target.position,i.position),i.position.subVectors(this.OBB.center,this.direction),i.target.position.copy(this.OBB.center),i.shadow.bias=.09,i.shadow.camera.bottom=-this.OBB.halfSize.y,i.shadow.camera.top=this.OBB.halfSize.y,i.shadow.camera.right=this.OBB.halfSize.x,i.shadow.camera.left=-this.OBB.halfSize.x,i.shadow.camera.near=this.direction.length()-this.OBB.halfSize.z,i.shadow.camera.far=this.direction.length()+this.OBB.halfSize.z,i.shadow.camera.updateProjectionMatrix()}}},{key:"init",value:function(){var n=this._container,i=ke.createElement("div",{class:"miew-canvas"});Hp(n,i),this._container=i;var s=document.createDocumentFragment();if(s.appendChild(this._msgMode=Ef("div",{class:"mode-message overlay"},Ef("p",{},"COMPONENT EDIT MODE"))),s.appendChild(this._msgAtomInfo=Ef("div",{class:"atom-info overlay"},Ef("p",{},""))),n.appendChild(s),this._gfx!==null)return!0;var o=this;this._showMessage("Viewer is being initialized...");try{this._initGfx(),this._initListeners(),this._spinner=new kO({lines:13,length:28,width:14,radius:42,color:"#fff",zIndex:700}),window.top.addEventListener("keydown",function(d){o._onKeyDown(d)}),window.top.addEventListener("keyup",function(d){o._onKeyUp(d)}),this._objectControls=new kt(this._gfx.root,this._gfx.pivot,this._gfx.camera,this._gfx.renderer.domElement,function(){return o._getAltObj()}),this._objectControls.addEventListener("change",function(d){switch(fe.now.shadow.on&&o._updateShadowCamera(),d.action){case"rotate":o.dispatchEvent({type:"rotate",quaternion:d.quaternion});break;case"zoom":o.dispatchEvent({type:"zoom",factor:d.factor});break;default:o.dispatchEvent({type:d.action})}o.dispatchEvent({type:"transform"}),o._needRender=!0});var l=this._gfx;this._picker=new Rr(l.root,l.camera,l.renderer.domElement),this._picker.addEventListener("newpick",function(d){o._onPick(d)}),this._picker.addEventListener("dblclick",function(d){o.center(d)})}catch(d){if(d.name==="TypeError"&&d.message==="Cannot read property 'getExtension' of null")this._showMessage("Could not create WebGL context.");else if(d.message.search(/webgl/i)>1)this._showMessage(d.message);else throw this._showMessage("Viewer initialization failed."),d;return!1}var c=this._opts&&this._opts.load;if(c){var f=this._opts&&this._opts.type;this.load(c,{fileType:f,keepRepsInfo:!0})}return!0}},{key:"term",value:function(){this._showMessage("Viewer has been terminated."),this._loading.forEach(function(n){n.cancel()}),this._loading.length=0,this.halt(),this._gfx=null}},{key:"_showMessage",value:function(n){var i=document.createElement("div");i.setAttribute("class","miew-message"),i.appendChild(document.createElement("p")).appendChild(document.createTextNode(n)),Hp(this._container,i)}},{key:"_showCanvas",value:function(){Hp(this._container,this._gfx.renderer.domElement)}},{key:"_requestAnimationFrame",value:function(n){var i=this._gfx.renderer.xr;if(i&&i.enabled){this._gfx.renderer.setAnimationLoop(n);return}requestAnimationFrame(n)}},{key:"_initGfx",value:function(){var n={width:this._container.clientWidth,height:this._container.clientHeight},i={preserveDrawingBuffer:!0,alpha:!0,premultipliedAlpha:!1};fe.now.antialias&&(i.antialias=!0),n.renderer2d=new TU,n.renderer=new xx(i),n.renderer.shadowMap.enabled=fe.now.shadow.on,n.renderer.shadowMap.autoUpdate=!1,n.renderer.shadowMap.type=gm,NS.init(n.renderer),B1(n.renderer.getContext())||fe.set("zSprites",!1),z1(n.renderer.getContext())||fe.set("ao",!1),n.renderer.autoClear=!1,n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(n.width,n.height),n.renderer.setClearColor(fe.now.bg.color,+!fe.now.bg.transparent),n.renderer.clearColor(),n.renderer2d.setSize(n.width,n.height),n.camera=new En(fe.now.camFov,n.width/n.height,fe.now.camNear,fe.now.camFar),n.camera.setMinimalFov(fe.now.camFov),n.camera.position.z=fe.now.camDistance,n.camera.updateProjectionMatrix(),n.camera.layers.set(_t.LAYERS.DEFAULT),n.camera.layers.enable(_t.LAYERS.VOLUME),n.camera.layers.enable(_t.LAYERS.VOLUME_BFPLANE),n.stereoCam=new Wx,n.scene=new Ga;var s=Cf();n.scene.fog=new ac(s,fe.now.camNear,fe.now.camFar),n.root=new _t.RCGroup,n.scene.add(n.root),n.pivot=new _t.RCGroup,n.root.add(n.pivot),n.selectionScene=new Ga,n.selectionRoot=new nr,n.selectionRoot.matrixAutoUpdate=!1,n.selectionScene.add(n.selectionRoot),n.selectionPivot=new nr,n.selectionPivot.matrixAutoUpdate=!1,n.selectionRoot.add(n.selectionPivot);var o=new Ux(16777215,.45);o.position.set(0,.414,1),o.layers.enable(_t.LAYERS.TRANSPARENT),o.castShadow=!0,o.shadow.bias=.09,o.shadow.radius=fe.now.shadow.radius,o.shadow.camera.layers.set(_t.LAYERS.SHADOWMAP);var l=n.renderer.getPixelRatio(),c=Math.max(n.width,n.height)*l;o.shadow.mapSize.width=c,o.shadow.mapSize.height=c,o.target.position.set(0,0,0),n.scene.add(o),n.scene.add(o.target);var f=new Gx(6710886);f.layers.enable(_t.LAYERS.TRANSPARENT),n.scene.add(f),n.axes=new LU(n.root,n.camera);var d=n.width*l,p=n.height*l;n.offscreenBuf=new Rn(d,p,{minFilter:qt,magFilter:_n,format:Mn,depthBuffer:!0}),n.renderer.getContext().getExtension("WEBGL_depth_texture")&&(n.offscreenBuf.depthTexture=new Ex,n.offscreenBuf.depthTexture.type=tc),n.offscreenBuf2=new Rn(d,p,{minFilter:qt,magFilter:qt,format:Mn,depthBuffer:!1}),n.offscreenBuf3=new Rn(d,p,{minFilter:qt,magFilter:qt,format:Mn,depthBuffer:!1}),n.offscreenBuf4=new Rn(d,p,{minFilter:qt,magFilter:qt,format:Mn,depthBuffer:!1}),n.volBFTex=n.offscreenBuf3,n.volFFTex=n.offscreenBuf4,n.volWFFTex=n.offscreenBuf,n.renderer.getContext().getExtension("OES_texture_float")?(n.offscreenBuf5=new Rn(d,p,{minFilter:qt,magFilter:qt,format:Mn,type:Ni,depthBuffer:!1}),n.offscreenBuf6=new Rn(d,p,{minFilter:qt,magFilter:qt,format:Mn,type:Ni,depthBuffer:!1}),n.offscreenBuf7=new Rn(d,p,{minFilter:qt,magFilter:qt,format:Mn,type:Ni,depthBuffer:!0}),n.volBFTex=n.offscreenBuf5,n.volFFTex=n.offscreenBuf6,n.volWFFTex=n.offscreenBuf7):this.logger.warn("Device doesn't support OES_texture_float extension"),n.stereoBufL=new Rn(d,p,{minFilter:qt,magFilter:qt,format:Mn,depthBuffer:!1}),n.stereoBufR=new Rn(d,p,{minFilter:qt,magFilter:qt,format:Mn,depthBuffer:!1}),this._gfx=n,this._showCanvas(),this._embedWebXR(fe.now.stereo==="WEBVR"),this._container.appendChild(n.renderer2d.getElement());var m=new zO;m.domElement.style.position="absolute",m.domElement.style.right="0",m.domElement.style.bottom="0",this._container.appendChild(m.domElement),this._fps=m,this._fps.show(fe.now.fps)}},{key:"_initListeners",value:function(){var n=this;window.addEventListener("resize",function(){n._onResize()})}},{key:"_makeUniqueVisualName",value:function(n){if(!n)return Math.random().toString();for(var i=n,s=1;this._visuals.hasOwnProperty(i);)i="".concat(n," (").concat(s.toString(),")"),s++;return i}},{key:"_addVisual",value:function(n){if(!n)return null;var i=this._makeUniqueVisualName(n.name);return n.name=i,this._visuals[i]=n,this._gfx.pivot.add(n),n.getSelectionGeo&&this._gfx.selectionPivot.add(n.getSelectionGeo()),i}},{key:"_removeVisual",value:function(n){var i="",s=null;n instanceof dc?(i=n.name,s=n):typeof n=="string"&&(i=n,s=this._visuals[i]),!(!s||!this._visuals.hasOwnProperty(i)||this._visuals[i]!==s)&&(i===this._curVisualName&&(this._curVisualName=void 0),delete this._visuals[i],s.release(),this._needRender=!0)}},{key:"_forEachVisual",value:function(n){for(var i in this._visuals)this._visuals.hasOwnProperty(i)&&n(this._visuals[i])}},{key:"_releaseAllVisuals",value:function(){if(!(!this._gfx||!this._gfx.pivot)){for(var n in this._visuals)this._visuals.hasOwnProperty(n)&&this._visuals[n].release();this._visuals={}}}},{key:"_forEachComplexVisual",value:function(n){if(!(!this._gfx||!this._gfx.pivot))for(var i in this._visuals)this._visuals.hasOwnProperty(i)&&this._visuals[i]instanceof Pi&&n(this._visuals[i])}},{key:"_getComplexVisual",value:function(n){n=n||this._curVisualName;var i=null,s=null;return this._forEachComplexVisual(function(o){i=o,o.name===n&&(s=o)}),s||i}},{key:"_getVolumeVisual",value:function(){var n=null;return this._forEachVisual(function(i){i instanceof Np&&(n=i)}),n}},{key:"_getVisualForComplex",value:function(n){if(!n)return null;var i=null;return this._forEachComplexVisual(function(s){s.getComplex()===n&&(i=s)}),i}},{key:"getVisuals",value:function(){return Object.keys(this._visuals)}},{key:"getComplexVisualsCount",value:function(){var n=0;return this._forEachComplexVisual(function(){return n++}),n}},{key:"getCurrentVisual",value:function(){return this._curVisualName}},{key:"setCurrentVisual",value:function(n){this._visuals[n]&&(this._curVisualName=n)}},{key:"run",value:function(){var n=this;if(!this._running){if(this._running=!0,this._halting){this._halting=!1;return}this._objectControls.enable(!0),this._interpolator.resume(),this._requestAnimationFrame(function(){return n._onTick()})}}},{key:"halt",value:function(){this._running&&(this._discardComponentEdit(),this._discardFragmentEdit(),this._objectControls.enable(!1),this._interpolator.pause(),this._halting=!0)}},{key:"enableHotKeys",value:function(n){this._hotKeysEnabled=n,this._objectControls.enableHotkeys(n)}},{key:"_onResize",value:function(){this._needRender=!0;var n=this._gfx;n.width=this._container.clientWidth,n.height=this._container.clientHeight,n.camera.aspect=n.width/n.height,n.camera.setMinimalFov(fe.now.camFov),n.camera.updateProjectionMatrix(),n.renderer.setSize(n.width,n.height),n.renderer2d.setSize(n.width,n.height),this.dispatchEvent({type:"resize"})}},{key:"_resizeOffscreenBuffers",value:function(n,i,s){var o=this._gfx;s=s||"NONE";var l=s==="NONE"||s==="ANAGLYPH",c=l?1:.5;o.offscreenBuf.setSize(c*n,i),o.offscreenBuf2.setSize(c*n,i),o.offscreenBuf3.setSize(c*n,i),o.offscreenBuf4.setSize(c*n,i),o.offscreenBuf5&&o.offscreenBuf5.setSize(c*n,i),o.offscreenBuf6&&o.offscreenBuf6.setSize(c*n,i),o.offscreenBuf7&&o.offscreenBuf7.setSize(c*n,i),l&&(o.stereoBufL.setSize(n,i),o.stereoBufR.setSize(n,i))}},{key:"_onTick",value:function(){var n=this;if(this._halting){this._running=!1,this._halting=!1;return}this._fps.update(),this._requestAnimationFrame(function(){return n._onTick()}),this._onUpdate(),this._needRender&&(this._onRender(),this._needRender=!fe.now.suspendRender||fe.now.stereo==="WEBVR")}},{key:"_getBSphereRadius",value:function(){var n=0;return this._forEachVisual(function(i){n=Math.max(n,i.getBoundaries().boundingSphere.radius)}),n*this._objectControls.getScale()}},{key:"getOBB",value:function(n,i){var s=this;this._bBox.makeEmpty(),this._forEachVisual(function(d){s._bSphereForOneVisual.copy(d.getBoundaries().boundingSphere),s._bSphereForOneVisual.applyMatrix4(d.matrixWorld).applyMatrix4(n),s._bSphereForOneVisual.getBoundingBox(s._bBoxForOneVisual),s._bBox.union(s._bBoxForOneVisual)}),this._bBox.getCenter(i.center),this._invMatrix.copy(n).invert(),i.center.applyMatrix4(this._invMatrix);var o=this._bBox.min,l=this._bBox.max;this._points[0].set(o.x,o.y,o.z),this._points[1].set(l.x,o.y,o.z),this._points[2].set(o.x,l.y,o.z),this._points[3].set(o.x,o.y,l.z);for(var c=0,f=this._points.length;c<f;c++)this._points[c].applyMatrix4(this._invMatrix);i.halfSize.set(Math.abs(this._points[0].x-this._points[1].x),Math.abs(this._points[0].y-this._points[2].y),Math.abs(this._points[0].z-this._points[3].z)).multiplyScalar(.5)}},{key:"_updateFog",value:function(){var n=this._gfx;if(fe.now.fog){if(typeof n.scene.fog>"u"||n.scene.fog===null){var i=Cf();n.scene.fog=new ac(i),this._setUberMaterialValues({fog:fe.now.fog})}OG(n.scene.fog,n.camera.position.z,this._getBSphereRadius())}else n.scene.fog&&(n.scene.fog=void 0,this._setUberMaterialValues({fog:fe.now.fog}))}},{key:"_onUpdate",value:function(){this.isScriptingCommandAvailable!==void 0&&this.isScriptingCommandAvailable()&&!this._building&&this.callNextCmd(),this._objectControls.update(),this._forEachComplexVisual(function(n){n.getComplex().update()}),fe.now.autobuild&&!this._loading.length&&!this._building&&this._needRebuild()&&this.rebuild(),!this._loading.length&&!this._building&&!this._needRebuild()&&this._updateView(),this._updateFog(),this._gfx.renderer.xr.enabled&&this.webVR.updateMoleculeScale()}},{key:"_onRender",value:function(){var n=this._gfx;n.scene.updateMatrixWorld(),n.camera.updateMatrixWorld(),this._clipPlaneUpdateValue(this._getBSphereRadius()),this._fogFarUpdateValue(),n.renderer.setRenderTarget(null),n.renderer.clear(),this._renderFrame(fe.now.stereo)}},{key:"_renderFrame",value:function(n){var i=this._gfx,s=i.renderer;s.getSize(this._size),n!=="NONE"&&(i.camera.focus=i.camera.position.z,i.stereoCam.aspect=1,n==="ANAGLYPH"?i.stereoCam.update(i.camera):i.stereoCam.updateHalfSized(i.camera,fe.now.camFov));var o=i.renderer.getPixelRatio();switch(this._resizeOffscreenBuffers(this._size.width*o,this._size.height*o,n),this._renderShadowMap(),n){case"WEBVR":case"NONE":this._renderScene(i.camera,!1);break;case"SIMPLE":case"DISTORTED":s.setScissorTest(!0),s.setScissor(0,0,this._size.width/2,this._size.height),s.setViewport(0,0,this._size.width/2,this._size.height),this._renderScene(this._gfx.stereoCam.cameraL,n==="DISTORTED"),s.setScissor(this._size.width/2,0,this._size.width/2,this._size.height),s.setViewport(this._size.width/2,0,this._size.width/2,this._size.height),this._renderScene(this._gfx.stereoCam.cameraR,n==="DISTORTED"),s.setScissorTest(!1);break;case"ANAGLYPH":this._renderScene(this._gfx.stereoCam.cameraL,!1,i.stereoBufL),this._renderScene(this._gfx.stereoCam.cameraR,!1,i.stereoBufR),s.setRenderTarget(null),this._anaglyphMat.uniforms.srcL.value=i.stereoBufL.texture,this._anaglyphMat.uniforms.srcR.value=i.stereoBufR.texture,i.renderer.renderScreenQuad(this._anaglyphMat);break}i.renderer2d.render(i.scene,i.camera),fe.now.axes&&i.axes&&!i.renderer.xr.enabled&&i.axes.render(s)}},{key:"_onBgColorChanged",value:function(){var n=this._gfx,i=Cf();n&&(n.scene.fog&&n.scene.fog.color.set(i),n.renderer.setClearColor(fe.now.bg.color,+!fe.now.bg.transparent)),this._needRender=!0}},{key:"_onFogColorChanged",value:function(){var n=this._gfx,i=Cf();n&&n.scene.fog&&n.scene.fog.color.set(i),this._needRender=!0}},{key:"_setUberMaterialValues",value:function(n){this._gfx.root.traverse(function(i){(i instanceof Ut||i instanceof $r||i instanceof Ts)&&i.material instanceof Fi&&(i.material.setValues(n),i.material.needsUpdate=!0)})}},{key:"_enableMRT",value:function(n,i,s){var o=this._gfx,l=o.renderer.getContext(),c=l.getExtension("WEBGL_draw_buffers"),f=o.renderer.properties;if(!n){c.drawBuffersWEBGL([l.COLOR_ATTACHMENT0,null]);return}o.renderer.setRenderTarget(s);var d=f.get(s.texture).__webglTexture;l.bindTexture(l.TEXTURE_2D,d),o.renderer.setRenderTarget(i);var p=f.get(i).__webglFramebuffer,m=f.get(i.texture).__webglTexture;l.bindFramebuffer(l.FRAMEBUFFER,p),p.width=i.width,p.height=i.height,l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,m,0),l.framebufferTexture2D(l.FRAMEBUFFER,c.COLOR_ATTACHMENT1_WEBGL,l.TEXTURE_2D,d,0),c.drawBuffersWEBGL([l.COLOR_ATTACHMENT0,c.COLOR_ATTACHMENT1_WEBGL])}},{key:"_renderScene",value:function(n,i,s){i=i||!1,s=s||null;var o=this._gfx;if(o.renderer.setClearColor(fe.now.bg.color,+!fe.now.bg.transparent),o.renderer.setRenderTarget(s),o.renderer.clear(),o.renderer.xr.enabled){o.renderer.render(o.scene,n);return}o.renderer.setClearColor(0,0),o.renderer.setRenderTarget(o.offscreenBuf4),o.renderer.clearColor(),o.renderer.setClearColor(fe.now.bg.color,+!fe.now.bg.transparent),o.renderer.setRenderTarget(o.offscreenBuf),o.renderer.clear();var l=this._getComplexVisual()!==null,c=this._getVolumeVisual(),f=l&&fe.now.ao;f&&this._enableMRT(!0,o.offscreenBuf,o.offscreenBuf4),fe.now.transparency==="prepass"?this._renderWithPrepassTransparency(n,o.offscreenBuf):fe.now.transparency==="standard"&&(o.renderer.setRenderTarget(o.offscreenBuf),o.renderer.render(o.scene,n)),f&&this._enableMRT(!1,null,null);var d=l&&fe.now.outline.on,p=l&&fe.now.fxaa,m=c!==null&&c.getMesh().material!=null,v=f||d||m||p||i?o.offscreenBuf2:s,y=o.offscreenBuf;f?(this._performAO(y,o.offscreenBuf4,o.offscreenBuf.depthTexture,v,o.offscreenBuf3,o.offscreenBuf2),!p&&!i&&!m&&!d&&(y=v,v=s,o.renderer.setRenderTarget(v),o.renderer.renderScreenQuadFromTex(y.texture,1))):(o.renderer.setRenderTarget(v),o.renderer.renderScreenQuadFromTex(y.texture,1)),d&&(y=v,v=m||p||i?o.offscreenBuf3:s,y!=null&&this._renderOutline(n,o.offscreenBuf,y,v)),this._renderSelection(n,o.offscreenBuf,v),m&&(o.renderer.setRenderTarget(o.offscreenBuf),o.renderer.renderScreenQuadFromTex(v.texture,1),v=o.offscreenBuf,this._renderVolume(c,n,v,o.volBFTex,o.volFFTex,o.volWFFTex),!p&&!i&&(o.renderer.setRenderTarget(s),o.renderer.renderScreenQuadFromTex(v.texture,1))),y=v,p&&(v=i?o.offscreenBuf4:s,this._performFXAA(y,v),y=v),i&&(v=s,this._performDistortion(y,v,!0))}},{key:"_performDistortion",value:function(n,i,s){this._scene.add(new ii.Mesh(this._geo,this._material)),this._gfx.renderer.setRenderTarget(i),this._gfx.renderer.clear(),s?(this._material.uniforms.srcTex.value=n.texture,this._material.uniforms.aberration.value.set(.995,1,1.01),this._gfx.renderer.render(this._scene,this._camera)):this._gfx.renderer.renderScreenQuadFromTexWithDistortion(n,fe.now.debug.stereoBarrel)}},{key:"_renderOutline",value:function(n,i,s,o){var l=this,c=l._gfx;this._outlineMaterial.uniforms.srcTex.value=s.texture,this._outlineMaterial.uniforms.srcDepthTex.value=i.depthTexture,this._outlineMaterial.uniforms.srcTexSize.value.set(i.width,i.height),this._outlineMaterial.uniforms.color.value=new nt(fe.now.outline.color),this._outlineMaterial.uniforms.threshold.value=fe.now.outline.threshold,this._outlineMaterial.uniforms.thickness.value=new Pe(fe.now.outline.thickness,fe.now.outline.thickness),c.renderer.setRenderTarget(o),c.renderer.renderScreenQuad(this._outlineMaterial)}},{key:"_renderShadowMap",value:function(){if(fe.now.shadow.on){var n=this._gfx,i=n.renderer.getRenderTarget(),s=n.renderer.getActiveCubeFace(),o=n.renderer.getActiveMipmapLevel(),l=n.renderer.state;l.setBlending(sa),l.buffers.color.setClear(1,1,1,1),l.buffers.depth.setTest(!0),l.setScissorTest(!1);for(var c=0;c<n.scene.children.length;c++)if(n.scene.children[c].type==="DirectionalLight"){var f=n.scene.children[c];f.shadow.map==null&&(f.shadow.map=new Rn(f.shadow.mapSize.width,f.shadow.mapSize.height,this.pars),f.shadow.camera.updateProjectionMatrix()),f.shadow.updateMatrices(f),n.renderer.setRenderTarget(f.shadow.map),n.renderer.clear(),n.renderer.render(n.scene,f.shadow.camera)}n.renderer.setRenderTarget(i,s,o)}}},{key:"_hasSelectionToRender",value:function(){for(var n=this._gfx.selectionPivot,i=0;i<n.children.length;i++){var s=n.children[i];if(s.children.length>0)return!0}return!1}},{key:"_renderSelection",value:function(n,i,s){var o=new mm,l=this,c=l._gfx;c.renderer.setClearColor("black",0),c.renderer.setRenderTarget(i),c.renderer.clear(!0,!1,!1),l._hasSelectionToRender()?(c.selectionRoot.matrix=c.root.matrix,c.selectionPivot.matrix=c.pivot.matrix,c.renderer.render(c.selectionScene,n)):c.renderer.renderDummyQuad(),c.renderer.setRenderTarget(s),c.renderer.renderScreenQuadFromTex(i.texture,.6),o.uniforms.srcTex.value=i.texture,o.uniforms.srcTexSize.value.set(i.width,i.height),c.renderer.renderScreenQuad(o)}},{key:"_checkVolumeRenderingSupport",value:function(n){if(!n)return!1;var i=this._gfx,s=i.renderer.getRenderTarget();i.renderer.setRenderTarget(n);var o=i.renderer.getContext(),l=o.checkFramebufferStatus(o.FRAMEBUFFER);return i.renderer.setRenderTarget(s),l!==o.FRAMEBUFFER_COMPLETE?(this.logger.warn("Device doesn't support electron density rendering"),!1):!0}},{key:"_renderVolume",value:function(n,i,s,o,l,c){var f=new Wf.BackFacePosMaterial,d=new Wf.FrontFacePosMaterial,p=new Xe().makeTranslation(.5,.5,.5),m=new Xe,v,y=this._gfx;if(typeof v>"u"&&(v=this._checkVolumeRenderingSupport(o)),!!v){var S=n.getMesh();S.rebuild(y.camera),y.renderer.setClearColor("black",0),y.renderer.setRenderTarget(o),y.renderer.clear(),y.renderer.setRenderTarget(l),y.renderer.clear(),y.renderer.setRenderTarget(c),y.renderer.clear(),y.renderer.setRenderTarget(o),i.layers.set(_t.LAYERS.VOLUME_BFPLANE),y.renderer.render(y.scene,i),i.layers.set(_t.LAYERS.VOLUME),y.scene.overrideMaterial=f,y.renderer.render(y.scene,i),y.renderer.setRenderTarget(l),i.layers.set(_t.LAYERS.VOLUME),y.scene.overrideMaterial=d,y.renderer.render(y.scene,i),y.scene.overrideMaterial=null,i.layers.set(_t.LAYERS.DEFAULT),m.copy(S.matrixWorld).invert(),Fi.prototype.uberOptions.world2colorMatrix.multiplyMatrices(p,m),i.layers.set(_t.LAYERS.COLOR_FROM_POSITION),y.renderer.setRenderTarget(c),y.renderer.render(y.scene,i);var _=S.material;_.uniforms._BFRight.value=o.texture,_.uniforms._FFRight.value=l.texture,_.uniforms._WFFRight.value=c.texture,i.layers.set(_t.LAYERS.VOLUME),y.renderer.setRenderTarget(s),y.renderer.render(y.scene,i),i.layers.set(_t.LAYERS.DEFAULT)}}},{key:"_renderWithPrepassTransparency",value:function(n,i){var s=this._gfx;s.renderer.setRenderTarget(i),n.layers.set(_t.LAYERS.DEFAULT),s.renderer.render(s.scene,n),n.layers.set(_t.LAYERS.PREPASS_TRANSPARENT),s.renderer.getContext().colorMask(!1,!1,!1,!1),s.renderer.render(s.scene,n),s.renderer.getContext().colorMask(!0,!0,!0,!0),n.layers.set(_t.LAYERS.TRANSPARENT),s.renderer.render(s.scene,n),n.layers.set(_t.LAYERS.DEFAULT)}},{key:"_performFXAA",value:function(n,i){var s=new mw;if(!(typeof n>"u"||typeof i>"u")){var o=this._gfx;o.renderer.setClearColor(fe.now.bg.color,+!fe.now.bg.transparent),o.renderer.setRenderTarget(i),o.renderer.clear(),s.uniforms.srcTex.value=n.texture,s.uniforms.srcTexelSize.value.set(1/n.width,1/n.height),s.uniforms.bgColor.value.set(fe.now.bg.color),s.bgTransparent!==fe.now.bg.transparent&&(s.setValues({bgTransparent:fe.now.bg.transparent}),s.needsUpdate=!0),o.renderer.renderScreenQuad(s)}}},{key:"_performAO",value:function(n,i,s,o,l,c){var f=new aG,d=new uG,p=new xv,m=new C;if(!(!n||!i||!s||!o||!l||!c)){var v=this._gfx,y=Math.tan(oa.DEG2RAD*.5*v.camera.fov);f.uniforms.diffuseTexture.value=n.texture,f.uniforms.depthTexture.value=s,f.uniforms.normalTexture.value=i.texture,f.uniforms.srcTexelSize.value.set(1/n.width,1/n.height),f.uniforms.camNearFar.value.set(v.camera.near,v.camera.far),f.uniforms.projMatrix.value=v.camera.projectionMatrix,f.uniforms.aspectRatio.value=v.camera.aspect,f.uniforms.tanHalfFOV.value=y,v.root.matrix.extractScale(m),f.uniforms.kernelRadius.value=fe.now.debug.ssaoKernelRadius*m.x,f.uniforms.depthThreshold.value=2*this._getBSphereRadius(),f.uniforms.factor.value=fe.now.debug.ssaoFactor,v.renderer.setRenderTarget(c),v.renderer.renderScreenQuad(f),d.uniforms.aoMap.value=c.texture,d.uniforms.srcTexelSize.value.set(1/c.width,1/c.height),d.uniforms.depthTexture.value=s,v.renderer.setRenderTarget(l),v.renderer.renderScreenQuad(d),p.uniforms.aoMap.value=l.texture,p.uniforms.diffuseTexture.value=n.texture,p.uniforms.srcTexelSize.value.set(1/l.width,1/l.height),p.uniforms.depthTexture.value=s,p.uniforms.projMatrix.value=v.camera.projectionMatrix,p.uniforms.aspectRatio.value=v.camera.aspect,p.uniforms.tanHalfFOV.value=y;var S=v.scene.fog;S&&(p.uniforms.fogNearFar.value.set(S.near,S.far),p.uniforms.fogColor.value.set(S.color.r,S.color.g,S.color.b,fe.now.fogAlpha)),(p.useFog!==fe.now.fog||p.fogTransparent!==fe.now.bg.transparent)&&(p.setValues({useFog:fe.now.fog,fogTransparent:fe.now.bg.transparent}),p.needsUpdate=!0),v.renderer.setRenderTarget(o),v.renderer.renderScreenQuad(p)}}},{key:"reset",value:function(){this._picker&&this._picker.reset(),this._lastPick=null,this._releaseAllVisuals(),this._setEditMode(vn.COMPLEX),this._resetObjects(),this._gfx&&(_t.clearTree(this._gfx.pivot),this._gfx.renderer2d.reset()),this.setNeedRender()}},{key:"_resetScene",value:function(){this._objectControls.reset(),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.resetReps(),this.resetPivot(),this.rebuildAll()}},{key:"resetView",value:function(){this._picker&&this._picker.reset(),this._setEditMode(vn.COMPLEX),this._resetScene(),this._forEachComplexVisual(function(n){n.updateSelectionMask({}),n.rebuildSelectionGeometry()})}},{key:"_export",value:function(n){var i=xe.head(Wa.exporters.find({format:n}));if(!i)return this.logger.error("Could not find suitable exporter for this source"),Promise.reject(new Error("Could not find suitable exporter for this source"));if(this.dispatchEvent({type:"exporting"}),this._visuals[this._curVisualName]instanceof Pi){var s=null;i.SourceClass===Pi?s=this._visuals[this._curVisualName]:i.SourceClass===xc&&(s=this._visuals[this._curVisualName]._complex);var o=new i(s,{miewVersion:t.VERSION});return o.export().then(function(l){return l})}return this._visuals[this._curVisualName]instanceof Np?Promise.reject(new Error("Sorry, exporter for volume data not implemented yet")):Promise.reject(new Error("Unexpected format of data"))}},{key:"load",value:function(n,i){var s=this;i=xe.merge({},i,{context:this}),this.settings.now.use.multiFile||(this._loading.length&&(this._loading.forEach(function(c){c.cancel()}),this._loading.length=0),i.animation||this.reset(!0)),this._interpolator.reset(),this.dispatchEvent({type:"loading",options:i,source:n});var o=new g4;this._loading.push(o),o.addEventListener("notification",function(c){s.dispatchEvent(c.slaveEvent)}),this._spinner.spin(this._container);var l=function(f){var d=s._loading.indexOf(o);return d!==-1&&s._loading.splice(d,1),s._spinner.stop(),s._refreshTitle(),o.notify({type:"loadingDone",anything:f}),f};return GG(n,i,o).then(function(c){return HG(c,i,o)}).then(function(c){var f=s._onLoad(c,i);return l(f)}).catch(function(c){throw s.logger.error("Could not load data"),s.logger.debug(c),l(c)})}},{key:"unload",value:function(n){this._removeVisual(n||this.getCurrentVisual()),this.resetPivot(),fe.now.shadow.on&&this._updateShadowCamera()}},{key:"_startAnimation",value:function(n){this._stopAnimation();var i=this,s=this._getComplexVisual();if(s===null){this.logger.error("Unable to start animation - no molecule is loaded.");return}try{this._frameInfo=new dw(s.getComplex(),n,{onLoadStatusChanged:function(){i.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:i._isAnimating,isLoading:i._frameInfo?i._frameInfo.isLoading:!0}})},onError:function(l){i._stopAnimation(),i.logger.error(l)}})}catch{this.logger.error("Animation file does not fit to current complex!");return}this._continueAnimation()}},{key:"_pauseAnimation",value:function(){this._animInterval!==null&&(this._isAnimating=!1,clearInterval(this._animInterval),this._animInterval=null,this._frameInfo&&this.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:this._isAnimating,isLoading:this._frameInfo.isLoading}}))}},{key:"_continueAnimation",value:function(){this._isAnimating=!0;var n=1e3/fe.now.maxfps;n=Number.isNaN(n)?0:n;var i=this,s=i._gfx.pivot,o=this._getComplexVisual();o&&(o.resetSelectionMask(),o.rebuildSelectionGeometry(),this._msgAtomInfo.style.opacity=0),this._animInterval=setInterval(function(){if(i.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:i._isAnimating,isLoading:i._frameInfo.isLoading}}),i._frameInfo.frameIsReady){s.updateToFrame(i._frameInfo),i._updateObjsToFrame(i._frameInfo),i._refreshTitle(" Frame ".concat(i._frameInfo._currFrame," of ").concat(i._frameInfo._framesCount," time interval - ").concat(i._frameInfo._timeStep));try{i._frameInfo.nextFrame()}catch{i.logger.error("Error during animation"),i._stopAnimation();return}i._needRender=!0}},n)}},{key:"_stopAnimation",value:function(){this._animInterval!==null&&(clearInterval(this._animInterval),this._frameInfo.disableEvents(),this._frameInfo=null,this._animInterval=null,this.dispatchEvent({type:"mdPlayerStateChanged",state:null}))}},{key:"_onLoad",value:function(n,i){var s=this._gfx,o=null;if(i.animation)return this._refreshTitle(),this._startAnimation(n),null;if(this._stopAnimation(),(!i||!i.keepRepsInfo)&&(this._opts.reps=null,this._opts._objects=null),n.id==="Complex"){var l=n;i.fileName?l.name=l.name||D1(i.fileName).toUpperCase():i.amberFileName?l.name=l.name||D1(i.amberFileName).toUpperCase():l.name="Dynamic ".concat(i.fileType," molecule"),o=this._addVisual(new Pi(l.name,l)),this._curVisualName=o;var c=this.info();if(this.logger.info("Parsed ".concat(i.fileName," (").concat(c.atoms," atoms, ").concat(c.bonds," bonds, ").concat(c.residues," residues, ").concat(c.chains," chains).")),xe.isNumber(this._opts.unit)&&l.setCurrentUnit(this._opts.unit),!i.preset)if(fe.now.autoPreset)switch(i.fileType){case"cml":this.resetReps("small");break;case"pdb":case"mmtf":case"cif":DG(l)?this.resetReps("macro"):this.resetReps("small");break;default:this.resetReps("default");break}else this.resetReps("default")}else n.id==="Volume"&&(this.resetEd(),o=this._onLoadEd(n));return s.camera.updateProjectionMatrix(),this._updateFog(),s.root.resetTransform(),this.resetPivot(),this._objectControls.setScale(fe.now.radiusToFit/this._getBSphereRadius()),this._resetObjects(),fe.now.autoResolution&&this._tweakResolution(),fe.now.shadow.on&&this._updateShadowCamera(),this._opts.view&&(this.view(this._opts.view),delete this._opts.view),this._refreshTitle(),o}},{key:"resetEd",value:function(){this._edLoader&&(this._edLoader.abort(),this._edLoader=null),this._removeVisual(this._getVolumeVisual()),this._needRender=!0}},{key:"loadEd",value:function(n){var i=this;this.resetEd();var s=xe.head(Wa.loaders.find({source:n}));if(!s)return this.logger.error(vm),Promise.reject(new Error(vm));var o=this._edLoader=new s(n,{binary:!0});return o.context=this,o.load().then(function(l){var c=xe.head(Wa.parsers.find({format:"ccp4"}));if(!c)throw new Error(kG);var f=new c(l);return f.context=i,f.parse().then(function(d){i._onLoadEd(d)})}).catch(function(l){i.logger.error("Could not load ED data"),i.logger.debug(l)})}},{key:"_onLoadEd",value:function(n){n.normalize();var i=new Np("volume",n);i.getMesh().layers.set(_t.LAYERS.VOLUME);var s=this._addVisual(i);return this._needRender=!0,s}},{key:"_needRebuild",value:function(){var n=!1;return this._forEachComplexVisual(function(i){n=n||i.needsRebuild()}),n}},{key:"_rebuildObjects",value:function(){var n=this,i=this._gfx,s,o,l=[];for(s=0;s<i.pivot.children.length;++s){var c=i.pivot.children[s];c instanceof dc||l.push(c)}for(s=0;s<l.length;++s)l[s].parent.remove(l[s]);setTimeout(function(){var f=n._objects;for(s=0,o=f.length;s<o;++s){var d=f[s];d.needsRebuild&&d.build(),d.getGeometry()&&i.pivot.add(d.getGeometry())}},10)}},{key:"changeUnit",value:function(n,i){var s=this._getComplexVisual(i);if(!s)throw new Error("There is no complex to change!");function o(){var l=s?s.getComplex().getCurrentUnit():0,c=l>0?"Bio molecule ".concat(l):"Asymmetric unit";return"Current unit: ".concat(l," (").concat(c,")")}return n===void 0||(xe.isString(n)&&(n=Math.max(parseInt(n,10),0)),s.getComplex().setCurrentUnit(n)&&(this._resetScene(),this._updateInfoPanel())),o()}},{key:"rebuild",value:function(){var n=this;if(this._building){this.logger.warn("Miew.rebuild(): already building!");return}this._building=!0,this.dispatchEvent({type:"rebuilding"}),this._rebuildObjects(),this._gfx.renderer2d.reset();var i=[];this._forEachComplexVisual(function(o){o.needsRebuild()&&i.push(o.rebuild().then(function(){return new Promise(function(l){o.rebuildSelectionGeometry(),l()})}))});var s=this;this._spinner.spin(this._container),Promise.all(i).then(function(){s._spinner.stop(),s._needRender=!0,s._refreshTitle(),n.dispatchEvent({type:"buildingDone"}),s._building=!1})}},{key:"rebuildAll",value:function(){this._forEachComplexVisual(function(n){n.setNeedsRebuild()})}},{key:"_refreshTitle",value:function(n){var i;n=n===void 0?"":n;var s=this._getComplexVisual();if(s){i=s.getComplex().name;var o=s.repGet(s.repCurrent());i+=o?" – ".concat(o.mode.name," Mode"):""}else i=Object.keys(this._visuals).length>0?"Unknown":"No Data";i+=n,this.dispatchEvent({type:"titleChanged",data:i})}},{key:"setNeedRender",value:function(){this._needRender=!0}},{key:"_extractRepresentation",value:function(){var n=this,i=[];this._forEachComplexVisual(function(s){if(s.getSelectionCount()!==0){var o=s.buildSelectorFromMask(1<<s.getSelectionBit()),l=fe.now.presets.default,c=s.repAdd({selector:o,mode:l[0].mode.id,colorer:l[0].colorer.id,material:l[0].material.id});if(!c){s.repCount()===Pi.NUM_REPRESENTATION_BITS&&n.logger.warn("Number of representations is limited to ".concat(Pi.NUM_REPRESENTATION_BITS));return}n.dispatchEvent({type:"repAdded",index:c.index,name:s.name}),s.repCurrent(c.index),i.push(s.name)}}),i.length>0&&this.logger.report("New representation from selection for complexes: ".concat(i.join(", ")))}},{key:"_setReps",value:function(n){n=n||this._opts&&this._opts.reps||[],this._forEachComplexVisual(function(i){return i.resetReps(n)})}},{key:"applyPreset",value:function(n){for(var i=fe.now.presets,s=[n||fe.defaults.preset,fe.defaults.preset,Object.keys(i)[0]],o=null,l=0;!o&&l<s.length;++l)fe.set("preset",s[l]),o=i[fe.now.preset],o||this.logger.warn('Unknown preset "'.concat(fe.now.preset,'"'));this._setReps(o)}},{key:"resetReps",value:function(n){var i=this._opts&&this._opts.reps;i?this._setReps(i):this.applyPreset(n)}},{key:"repCount",value:function(n){var i=this._getComplexVisual(n);return i?i.repCount():0}},{key:"repCurrent",value:function(n,i){var s=this._getComplexVisual(i),o=s?s.repCurrent(n):-1;return n&&o!==n&&this.logger.warn("Representation ".concat(n," was not found. Current rep remains unchanged.")),o}},{key:"rep",value:function(n,i){var s=this._getComplexVisual("");if(!s)return null;var o=s.rep(n,i);return o.status==="created"?this.dispatchEvent({type:"repAdded",index:o.index,name:s.name}):o.status==="changed"&&this.dispatchEvent({type:"repChanged",index:o.index,name:s.name}),o.desc}},{key:"repGet",value:function(n,i){var s=this._getComplexVisual(i);return s?s.repGet(n):null}},{key:"repAdd",value:function(n,i){var s=this._getComplexVisual(i);if(!s)return-1;var o=s.repAdd(n);return o?(this.dispatchEvent({type:"repAdded",index:o.index,name:i}),o.index):-1}},{key:"repRemove",value:function(n,i){var s=this._getComplexVisual(i);s&&(s.repRemove(n),this.dispatchEvent({type:"repRemoved",index:n,name:i}))}},{key:"repHide",value:function(n,i,s){this._needRender=!0;var o=this._getComplexVisual(s);return o?o.repHide(n,i):null}},{key:"_setEditMode",value:function(n){this._editMode=n;var i=this._msgMode;if(i&&(i.style.opacity=n===vn.COMPLEX?0:1,n!==vn.COMPLEX)){var s=i.getElementsByTagName("p")[0];s.innerHTML=n===vn.COMPONENT?"COMPONENT EDIT MODE":"FRAGMENT EDIT MODE"}this.dispatchEvent({type:"editModeChanged",data:n===vn.COMPLEX})}},{key:"_enterComponentEditMode",value:function(){if(this._editMode===vn.COMPLEX){var n=[];this._forEachComplexVisual(function(i){var s=i.beginComponentEdit();s&&n.push(s)}),n!==[]&&(this._editors=n,this.logger.info("COMPONENT EDIT MODE -- ON"),this._setEditMode(vn.COMPONENT),this._objectControls.keysTranslateObj(!0))}}},{key:"_applyComponentEdit",value:function(){if(this._editMode===vn.COMPONENT){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(var n=0;n<this._editors.length;++n)this._editors[n].apply();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (applied)"),this._setEditMode(vn.COMPLEX),this.rebuildAll()}}},{key:"_discardComponentEdit",value:function(){if(this._editMode===vn.COMPONENT){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(var n=0;n<this._editors.length;++n)this._editors[n].discard();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (discarded)"),this._setEditMode(vn.COMPLEX),this._needRender=!0,this.rebuildAll()}}},{key:"_enterFragmentEditMode",value:function(){if(this._editMode===vn.COMPLEX){var n=[];if(this._forEachComplexVisual(function(s){s instanceof Pi&&s.getSelectionCount()>0&&n.push(s)}),n.length===1){var i=n[0].beginFragmentEdit();i&&(this._editors=[i],this.logger.info("FRAGMENT EDIT MODE -- ON (single bond)"),this._setEditMode(vn.FRAGMENT),this._objectControls.allowTranslation(!1),this._objectControls.allowAltObjFreeRotation(i.isFreeRotationAllowed()),this._needRender=!0)}}}},{key:"_applyFragmentEdit",value:function(){if(this._editMode===vn.FRAGMENT){this._objectControls.stop();for(var n=0;n<this._editors.length;++n)this._editors[n].apply();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (applied)"),this._setEditMode(vn.COMPLEX),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.rebuildAll()}}},{key:"_discardFragmentEdit",value:function(){if(this._editMode===vn.FRAGMENT){this._objectControls.stop();for(var n=0;n<this._editors.length;++n)this._editors[n].discard();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (discarded)"),this._setEditMode(vn.COMPLEX),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this._needRender=!0}}},{key:"_onPick",value:function(n){if(!fe.now.picking||this._animInterval!==null||this._editMode===vn.FRAGMENT||this._objectControls.isEditingAltObj())return;var i=null;n.obj.atom?(i=n.obj.atom.residue.getChain().getComplex(),this._lastPick=n.obj.atom):n.obj.residue?(i=n.obj.residue.getChain().getComplex(),this._lastPick=n.obj.residue):n.obj.chain?(i=n.obj.chain.getComplex(),this._lastPick=n.obj.chain):n.obj.molecule?(i=n.obj.molecule.complex,this._lastPick=n.obj.molecule):this._lastPick=null;function s(l){l.updateSelectionMask(n.obj),l.rebuildSelectionGeometry()}if(i){var o=this._getVisualForComplex(i);o&&(s(o),this._needRender=!0)}else this._forEachComplexVisual(s),this._needRender=!0;this._updateInfoPanel(),this.dispatchEvent(n)}},{key:"_onKeyDown",value:function(n){if(!(!this._running||!this._hotKeysEnabled))switch(n.keyCode){case 67:fe.now.editing&&this._enterComponentEditMode();break;case 70:fe.now.editing&&this._enterFragmentEditMode();break;case 65:switch(this._editMode){case vn.COMPONENT:this._applyComponentEdit();break;case vn.FRAGMENT:this._applyFragmentEdit();break}break;case 68:switch(this._editMode){case vn.COMPONENT:this._discardComponentEdit();break;case vn.FRAGMENT:this._discardFragmentEdit();break}break;case 83:n.preventDefault(),n.stopPropagation(),fe.set("ao",!fe.now.ao),this._needRender=!0;break;case 107:n.preventDefault(),n.stopPropagation(),this._forEachComplexVisual(function(i){i.expandSelection(),i.rebuildSelectionGeometry()}),this._updateInfoPanel(),this._needRender=!0;break;case 109:n.preventDefault(),n.stopPropagation(),this._forEachComplexVisual(function(i){i.shrinkSelection(),i.rebuildSelectionGeometry()}),this._updateInfoPanel(),this._needRender=!0;break}}},{key:"_onKeyUp",value:function(n){!this._running||!this._hotKeysEnabled||n.keyCode===88&&this._extractRepresentation()}},{key:"_updateInfoPanel",value:function(){var n=this._msgAtomInfo.getElementsByTagName("p")[0],i,s,o=0;for(this._forEachComplexVisual(function(m){o+=m.getSelectionCount()});n.firstChild;)n.removeChild(n.firstChild);if(o===0){this._msgAtomInfo.style.opacity=0;return}var l="".concat(String(o)," atom").concat(o!==1?"s":""," selected");this._lastPick!==null&&(l+=", the last pick:");var c="",f="",d="";if(this._lastPick instanceof LG){i=this._lastPick,s=i.residue,f=i.name;var p=i.location!==32?String.fromCharCode(i.location):"";c="".concat(i.element.fullName," #").concat(i.serial).concat(p,":       ").concat(s._chain._name,".").concat(s._type._name).concat(s._sequence).concat(s._icode.trim(),"."),c+=f,d="Coord: (".concat(i.position.x.toFixed(2).toString(),",     ").concat(i.position.y.toFixed(2).toString(),",     ").concat(i.position.z.toFixed(2).toString(),")")}else this._lastPick instanceof PG?(s=this._lastPick,c="".concat(s._type._fullName,":       ").concat(s._chain._name,".").concat(s._type._name).concat(s._sequence).concat(s._icode.trim())):this._lastPick instanceof IG?c="chain ".concat(this._lastPick._name):this._lastPick instanceof NG&&(c="molecule ".concat(this._lastPick._name));n.appendChild(document.createTextNode(l)),c!==""&&(n.appendChild(document.createElement("br")),n.appendChild(document.createTextNode(c))),d!==""&&(n.appendChild(document.createElement("br")),n.appendChild(document.createTextNode(d))),this._msgAtomInfo.style.opacity=1}},{key:"_getAltObj",value:function(){if(this._editors){for(var n=null,i=0;i<this._editors.length;++i){var s=this._editors[i].getAltObj();if(s.objects.length>0){if(n){n=null;break}n=s}}if(n)return n}return{objects:[],pivot:new C(0,0,0)}}},{key:"resetPivot",value:function(){var n=new An,i=new C;n.makeEmpty(),this._forEachVisual(function(s){n.union(s.getBoundaries().boundingBox)}),n.getCenter(i),this._objectControls.setPivot(i.negate()),this.dispatchEvent({type:"transform"})}},{key:"setPivotResidue",value:function(n){var i=new C,s=this._getVisualForComplex(n.getChain().getComplex());if(s){if(n._controlPoint)i.copy(n._controlPoint);else{for(var o=0,l=0,c=0,f=n._atoms.length,d=0;d<f;++d){var p=n._atoms[d].position;o+=p.x/f,l+=p.y/f,c+=p.z/f}i.set(o,l,c)}i.applyMatrix4(s.matrix).negate(),this._objectControls.setPivot(i),this.dispatchEvent({type:"transform"})}}},{key:"setPivotAtom",value:function(n){var i=new C,s=this._getVisualForComplex(n.residue.getChain().getComplex());s&&(i.copy(n.position),i.applyMatrix4(s.matrix).negate(),this._objectControls.setPivot(i),this.dispatchEvent({type:"transform"}))}},{key:"getSelectionCenter",value:function(n,i,s){var o=new C(0,0,0);n.set(0,0,0);var l=0;return this._forEachComplexVisual(function(c){c.getSelectionCenter(o,i,s||c.getSelectionBit())&&(n.add(o),l++)}),l===0?!1:(n.divideScalar(l),n.negate(),!0)}},{key:"setPivotSubset",value:function(n){var i=new C(0,0,0),s=n?XG:WG;this.getSelectionCenter(i,s,n)?(this._objectControls.setPivot(i),this.dispatchEvent({type:"transform"})):this.logger.warn("selection is empty. Center operation not performed")}},{key:"screenshot",value:function(n,i){var s=this._gfx,o=s.renderer.domElement.width,l=s.renderer.domElement.height;function c(b){return Math.tan(oa.degToRad(.5*b))}function f(b){return oa.radToDeg(Math.atan(b))*2}function d(){var b,M=ke.getBrowser();if(M===ke.browserType.SAFARI){var E=document.createElement("canvas"),T=E.getContext("2d");E.width=n===void 0?o:n,E.height=i===void 0?l:i,T.drawImage(s.renderer.domElement,0,0,E.width,E.height),b=E.toDataURL("image/png")}else b=s.renderer.domElement.toDataURL("image/png");return b}i=i||n;var p;if(n===void 0&&i===void 0||n===o&&i===l)p=d();else{var m=s.camera.aspect,v=s.camera.fov,y=c(s.camera.fov),S=Math.min(s.width,s.height),_=y*S/s.height,x=n/i;s.renderer.setPixelRatio(1),s.camera.aspect=x,s.camera.fov=f(_/Math.min(x,1)),s.camera.updateProjectionMatrix(),s.renderer.setDrawingBufferSize(n,i,1),this._renderFrame(fe.now.stereo),p=d(),s.renderer.setPixelRatio(window.devicePixelRatio),s.camera.aspect=m,s.camera.fov=v,s.camera.updateProjectionMatrix(),s.renderer.setDrawingBufferSize(s.width,s.height,window.devicePixelRatio),this._needRender=!0}return p}},{key:"screenshotSave",value:function(n,i,s){var o=this.screenshot(i,s);ke.shotDownload(o,n)}},{key:"save",value:function(n){var i=this;this._export(n.fileType).then(function(s){var o=i._visuals[i._curVisualName]._complex.name;ke.download(s,o,n.fileType),i._refreshTitle(),i.dispatchEvent({type:"exportingDone"})}).catch(function(s){i.logger.error("Could not export data"),i.logger.debug(s),i._refreshTitle(),i.dispatchEvent({type:"exportingDone",error:s})})}},{key:"_tweakResolution",value:function(){var n=[["poor",100],["low",500],["medium",1e3],["high",5e3],["ultra",Number.MAX_VALUE]],i=0;if(this._forEachComplexVisual(function(l){i+=l.getComplex().getAtomCount()}),i>0){for(var s=this._gfxScore*1e6/i,o=0;o<n.length;++o)if(s<n[o][1]){this._autoChangeResolution(n[o][0]);break}}}},{key:"_autoChangeResolution",value:function(n){n!==fe.now.resolution&&this.logger.report('Your rendering resolution was changed to "'.concat(n,'" for best performance.')),fe.now.resolution=n}},{key:"saveSettings",value:function(){this._cookies.setCookie(this._opts.settingsCookie,JSON.stringify(this.settings.getDiffs(!0)))}},{key:"restoreSettings",value:function(){try{var n=this._cookies.getCookie(this._opts.settingsCookie),i=n?JSON.parse(n):{};this.settings.applyDiffs(i,!0)}catch(s){this.logger.error("Cookies parse error: ".concat(s.message))}}},{key:"resetSettings",value:function(){this.settings.reset()}},{key:"setOptions",value:function(n){typeof n=="string"&&(n=t.options.fromAttr(n)),n.reps&&(this._opts.reps=null),xe.merge(this._opts,n),n.settings&&this.set(n.settings),this._opts._objects=n._objects,this._resetObjects(),n.load&&this.load(n.load,{fileType:n.type}),n.preset&&(fe.now.preset=n.preset),n.reps&&this.resetReps(n.preset),this._opts.view&&(this.view(this._opts.view),delete this._opts.view);var i=this._getComplexVisual();i&&(i.getComplex().resetCurrentUnit(),xe.isNumber(n.unit)&&i.getComplex().setCurrentUnit(n.unit),this.resetView(),this.rebuildAll())}},{key:"info",value:function(n){var i=this._getComplexVisual(n);if(!i)return{};var s=i.getComplex(),o=s.metadata;return{id:o.id||s.name||"UNKNOWN",title:o.title&&o.title.join(" ")||"UNKNOWN DATA",atoms:s.getAtomCount(),bonds:s.getBondCount(),residues:s.getResidueCount(),chains:s.getChainCount()}}},{key:"addObject",value:function(n,i){var s=null;if(n.type===pc.prototype.type&&(s=pc),s===null)throw new Error("Unknown scene object type - ".concat(n.type));try{var o=new s(n.params,n.opts);this._addSceneObject(o)}catch(l){if(!i)this.logger.debug("Error during scene object creation: ".concat(l.message));else throw l}this._needRender=!0}},{key:"_addSceneObject",value:function(n){var i=this._getComplexVisual();n.build&&i&&(n.build(i.getComplex()),this._gfx.pivot.add(n.getGeometry()));var s=this._objects;s[s.length]=n}},{key:"_updateObjsToFrame",value:function(n){for(var i=this._objects,s=0,o=i.length;s<o;++s)i[s].updateToFrame&&i[s].updateToFrame(n)}},{key:"_resetObjects",value:function(){var n=this._opts._objects;if(this._objects=[],n)for(var i=0,s=n.length;i<s;++i)this.addObject(n[i],!1)}},{key:"removeObject",value:function(n){var i=this._objects[n];if(!i)throw new Error("Scene object with index ".concat(n," does not exist"));i.destroy(),this._objects.splice(n,1),this._needRender=!0}},{key:"getURL",value:function(n){return om.toURL(this.getState(xe.defaults(n,{compact:!0,settings:!1,view:!1})))}},{key:"getScript",value:function(n){return om.toScript(this.getState(xe.defaults(n,{compact:!0,settings:!0,view:!0})))}},{key:"_compareReps",value:function(n,i){var s={},o=0;n&&(o=n.repCount());var l=fe.defaults.presets[fe.now.preset],c=i;l===void 0||l.length>o?(c=!1,s.preset="empty"):fe.now.preset!==fe.defaults.preset&&(s.preset=fe.now.preset);for(var f=[],d=!0,p=0,m=o;p<m;++p)f[p]=n.repGet(p).compare(c?l[p]:null),xe.isEmpty(f[p])||(d=!1);return d||(s.reps=f),s}},{key:"getState",value:function(n){var i={};n=xe.defaults(n,{compact:!0,settings:!1,view:!1});var s=this._getComplexVisual();if(s!==null){var o=s.getComplex(),l=o.metadata;if(l.id){var c=l.format?"".concat(l.format,":"):"";i.load=c+l.id}var f=o.getCurrentUnit();f!==1&&(i.unit=f)}var d=this._compareReps(s,n.compact);d.preset&&(i.preset=d.preset),d.reps&&(i.reps=d.reps);for(var p=this._objects,m=[],v=0,y=p.length;v<y;++v)m[v]=p[v].identify();if(p.length>0&&(i._objects=m),n.view&&(i.view=this.view()),n.settings){var S=this.settings.getDiffs(!1);xe.isEmpty(S)||(i.settings=S)}return i}},{key:"get",value:function(n,i){return fe.get(n,i)}},{key:"_clipPlaneUpdateValue",value:function(n){var i=Math.max(this._gfx.camera.position.z-n*fe.now.draft.clipPlaneFactor,fe.now.camNear),s={clipPlaneValue:i};this._forEachComplexVisual(function(f){f.setUberOptions(s)});for(var o=0,l=this._objects.length;o<l;++o){var c=this._objects[o];c._line&&c._line.material.setUberOptions(s)}this._picker!==null&&(this._picker.clipPlaneValue=i)}},{key:"_fogFarUpdateValue",value:function(){this._picker!==null&&(this._gfx.scene.fog?this._picker.fogFarValue=this._gfx.scene.fog.far:this._picker.fogFarValue=void 0)}},{key:"_updateShadowmapMeshes",value:function(n){this._forEachComplexVisual(function(i){for(var s=i._reprList,o=0,l=s.length;o<l;++o){var c=s[o];n(c.geo,c.material)}})}},{key:"_updateMaterials",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this._forEachComplexVisual(function(f){return f.setMaterialValues(n,i,s)});for(var o=0,l=this._objects.length;o<l;++o){var c=this._objects[o];c._line&&(c._line.material.setValues(n),c._line.material.needsUpdate=!0)}}},{key:"_fogAlphaChanged",value:function(){this._forEachComplexVisual(function(n){n.setUberOptions({fogAlpha:fe.now.fogAlpha})})}},{key:"_embedWebXR",value:function(){var n=this;if(fe.now.stereo!=="WEBVR"){this.webVR&&this.webVR.disable(),this.webVR=null;return}this.webVR||(this.webVR=new CG(function(){n._requestAnimationFrame(function(){return n._onTick()}),n._needRender=!0,n._onResize()})),this.webVR.enable(this._gfx)}},{key:"_initOnSettingsChanged",value:function(){var n=this,i=function(o,l){o=xe.isArray(o)?o:[o],o.forEach(function(c){n.settings.addEventListener("change:".concat(c),l)})};i("modes.VD.frame",function(){var s=n._getVolumeVisual();s!==null&&(s.showFrame(fe.now.modes.VD.frame),n._needRender=!0)}),i("modes.VD.isoMode",function(){var s=n._getVolumeVisual();s!==null&&(s.getMesh().material.updateDefines(),n._needRender=!0)}),i("bg.color",function(){n._onBgColorChanged()}),i("ao",function(){if(fe.now.ao&&!z1(n._gfx.renderer.getContext()))n.logger.warn("Your device or browser does not support ao"),fe.set("ao",!1);else{var s={normalsToGBuffer:fe.now.ao};n._setUberMaterialValues(s)}}),i("zSprites",function(){fe.now.zSprites&&!B1(n._gfx.renderer.getContext())&&(n.logger.warn("Your device or browser does not support zSprites"),fe.set("zSprites",!1)),n.rebuildAll()}),i("fogColor",function(){n._onFogColorChanged()}),i("fogColorEnable",function(){n._onFogColorChanged()}),i("bg.transparent",function(s){var o=n._gfx;o&&o.renderer.setClearColor(fe.now.bg.color,+!fe.now.bg.transparent),n._updateMaterials({fogTransparent:s.value}),n.rebuildAll()}),i("draft.clipPlane",function(s){n._updateMaterials({clipPlane:s.value}),n.rebuildAll()}),i("shadow.on",function(s){var o={shadowmap:s.value,shadowmapType:fe.now.shadow.type},l=n._gfx;l&&(l.renderer.shadowMap.enabled=!!o.shadowmap),n._updateMaterials(o,!0),o.shadowmap?(n._updateShadowCamera(),n._updateShadowmapMeshes(Vo.createShadowmapMaterial)):n._updateShadowmapMeshes(Vo.removeShadowmapMaterial),n._needRender=!0}),i("shadow.type",function(s){fe.now.shadow.on&&(n._updateMaterials({shadowmapType:s.value},!0),n._needRender=!0)}),i("shadow.radius",function(s){for(var o=0;o<n._gfx.scene.children.length;o++)if(n._gfx.scene.children[o].shadow!==void 0){var l=n._gfx.scene.children[o];l.shadow.radius=s.value,n._needRender=!0}}),i("fps",function(){n._fps.show(fe.now.fps)}),i(["fog","fogNearFactor","fogFarFactor"],function(){n._updateFog(),n._needRender=!0}),i("fogAlpha",function(){var s=fe.now.fogAlpha;(s<0||s>1)&&n.logger.warn("fogAlpha must belong range [0,1]"),n._fogAlphaChanged(),n._needRender=!0}),i("autoResolution",function(s){s.value&&!n._gfxScore&&n.logger.warn("Benchmarks are missed, autoresolution will not work! Autoresolution should be set during miew startup.")}),i("stereo",function(){n._embedWebXR(fe.now.stereo==="WEBVR"),n._needRender=!0}),i(["transparency","palette"],function(){n.rebuildAll()}),i("resolution",function(){n.rebuildAll();var s=n._getVolumeVisual();s&&(s.getMesh().material.updateDefines(),n._needRender=!0)}),i(["axes","fxaa","ao","outline.on","outline.color","outline.threshold","outline.thickness"],function(){n._needRender=!0})}},{key:"set",value:function(n,i){fe.set(n,i)}},{key:"select",value:function(n,i){var s=this._getComplexVisual();if(s){var o=n;xe.isString(n)&&(o=Mf.parse(n).selector),s.select(o,i),this._lastPick=null,this._updateInfoPanel(),this._needRender=!0}}},{key:"view",value:function(n){var i="1",s=this,o=this._gfx.pivot,l=[],c="ZXY";function f(){var p=o.position,m=s._objectControls.getScale()/fe.now.radiusToFit,v=new la;return v.setFromQuaternion(s._objectControls.getOrientation(),c),l=[p.x,p.y,p.z,m,v.x,v.y,v.z],i+ke.arrayToBase64(l,Float32Array)}function d(){n.length===40&&(n="0".concat(n));var p=n[0];if(l=ke.arrayFromBase64(n.substr(1),Float32Array),p!==i)if(p==="0")l[3]/=8;else{s.logger.warn("Encoded view version mismatch, stored as ".concat(p," vs ").concat(i," expected"));return}var m=s._interpolator,v=m.createView();v.position.copy(o.position),v.scale=s._objectControls.getScale(),v.orientation.copy(s._objectControls.getOrientation());var y=m.createView();y.position.set(l[0],l[1],l[2]),s._getComplexVisual()&&y.position.sub(s._getComplexVisual().position),y.scale=l[3],y.orientation.setFromEuler(new la(l[4],l[5],l[6],c)),m.setup(v,y)}return typeof n>"u"?f():(d(),n)}},{key:"_updateView",value:function(){var n=this,i=this._gfx.pivot,s=this._interpolator;if(s.wasStarted()||s.start(),!!s.isMoving()){var o=s.getCurrentView();if(o.success){var l=o.view;i.position.copy(l.position),n._objectControls.setScale(l.scale*fe.now.radiusToFit),n._objectControls.setOrientation(l.orientation),this.dispatchEvent({type:"transform"}),n._needRender=!0}}}},{key:"translate",value:function(n,i,s){this._objectControls.translatePivot(n,i,s),this.dispatchEvent({type:"transform"}),this._needRender=!0}},{key:"rotate",value:function(n,i,s){this._objectControls.rotate(new On().setFromEuler(new la(n,i,s,"XYZ"))),this.dispatchEvent({type:"transform"}),this._needRender=!0}},{key:"scale",value:function(n){if(n<=0)throw new RangeError("Scale should be greater than zero");this._objectControls.scale(n),this.dispatchEvent({type:"transform"}),this._needRender=!0}},{key:"center",value:function(n){if(n===void 0){this.setPivotSubset(),this._needRender=!0;return}if(n.obj!==void 0&&("atom"in n.obj||"residue"in n.obj)){"atom"in n.obj?this.setPivotAtom(n.obj.atom):this.setPivotResidue(n.obj.residue),this._needRender=!0;return}if(n.obj===void 0&&n!==""){var i=Mf.parse(n);if(i.error===void 0){this.setPivotSubset(i),this._needRender=!0;return}}this.resetPivot(),this._needRender=!0}},{key:"within",value:function(n,i){var s=this._getComplexVisual();if(!s)return Mf.None();n instanceof String&&(n=Mf.parse(n));var o=s.within(n,i);return o&&(s.rebuildSelectionGeometry(),this._needRender=!0),o}},{key:"projected",value:function(n,i){var s=this._getComplexVisual(i);if(!s)return!1;var o=s.getComplex().getAtomByFullname(n);if(o===null)return!1;var l=o.position.clone();return this._gfx.pivot.updateMatrixWorldRecursive(),this._gfx.camera.updateMatrixWorldRecursive(),this._gfx.pivot.localToWorld(l),l.project(this._gfx.camera),{x:(l.x+1)*.5*this._gfx.width,y:(1-l.y)*.5*this._gfx.height}}},{key:"dssp",value:function(n){var i=this._getComplexVisual(n);i&&(i.getComplex().dssp(),i._reprList.forEach(function(s){(s.mode.id==="CA"||s.colorer.id==="SS")&&(s.needsRebuild=!0)}))}},{key:"exportCML",value:function(){var n=this;function i(f){var d=new C,p=new C,m=new C;f.extractBasis(d,p,m),d.normalize(),p.normalize(),m.normalize();var v=new Xe;return v.identity(),v.makeBasis(d,p,m),v}function s(f){var d=n._gfx.root,p=i(d.matrixWorld),m=new Gt(0,0,0,0),v=new Gt(0,0,0,0),y=null,S=null;f.forEachAtom(function(_){_.xmlNodeRef&&_.xmlNodeRef.xmlNode&&(y=_.xmlNodeRef.xmlNode,S=_.position,m.set(S.x,S.y,S.z,1),m.applyMatrix4(p),y.setAttribute("x3",m.x.toString()),y.setAttribute("y3",m.y.toString()),y.setAttribute("z3",m.z.toString()),y.removeAttribute("x2"),y.removeAttribute("y2"))}),f.forEachSGroup(function(_){if(_.xmlNodeRef&&_.xmlNodeRef.xmlNode){y=_.xmlNodeRef.xmlNode,S=_.getPosition(),m.set(S.x,S.y,S.z,1);var x=_.getCentralPoint();x===null?m.applyMatrix4(p):(v.set(x.x,x.y,x.z,0),m.add(v),m.applyMatrix4(p),v.set(x.x,x.y,x.z,1),v.applyMatrix4(p),m.sub(v)),y.setAttribute("x",m.x.toString()),y.setAttribute("y",m.y.toString()),y.setAttribute("z",m.z.toString())}})}var o=n._getComplexVisual(),l=o?o.getComplex():null;if(l&&l.originalCML){s(l);var c=new XMLSerializer;return c.serializeToString(l.originalCML)}return null}},{key:"motm",value:function(){fe.set({fogColorEnable:!0,fogColor:0,outline:{on:!0,threshold:.01},bg:{color:16777215}}),this._forEachComplexVisual(function(n){for(var i=[],s=n.getComplex(),o=Ho.get(fe.now.palette),l=0;l<s.getChainCount();l++){var c=s._chains[l]._name,f=o.getChainColor(c);i[l]={selector:"chain ".concat(c),mode:"VW",colorer:["CB",{color:f,factor:.9}],material:"FL"}}n.resetReps(i)})}}]),t}(pr);xe.assign(dr,{VERSION:dr.VERSION,registeredPlugins:[],chem:pt,io:Wa,modes:Pf,colorers:If,materials:zo,palettes:Ho,options:om,settings:fe,utils:ke,gfx:{Representation:fm}});var YG=function(){var a=function(Lt,Qe,ct,ie){for(ct=ct||{},ie=Lt.length;ie--;ct[Lt[ie]]=Qe);return ct},e=[1,60],t=[1,62],r=[1,63],n=[1,65],i=[1,66],s=[1,67],o=[1,68],l=[1,69],c=[1,80],f=[1,72],d=[1,73],p=[1,74],m=[1,75],v=[1,99],y=[1,76],S=[1,100],_=[1,79],x=[1,51],b=[1,81],M=[1,82],E=[1,84],T=[1,83],R=[1,85],V=[1,96],Y=[1,97],$=[1,98],W=[1,86],j=[1,87],X=[1,64],P=[1,70],N=[1,71],I=[1,77],G=[1,78],ee=[1,53],re=[1,54],he=[1,55],pe=[1,61],Ie=[1,88],De=[1,89],Le=[1,90],Oe=[1,91],ne=[1,92],at=[1,93],Ge=[1,94],We=[1,95],Ve=[1,101],Te=[1,102],me=[1,103],ge=[1,104],se=[1,105],we=[1,56],Ee=[1,57],z=[1,58],F=[1,59],ue=[1,115],be=[1,111],Fe=[1,114],He=[1,112],rt=[1,113],Ke=[1,118],je=[1,117],Je=[1,134],A=[1,149],D=[1,150],O=[1,157],te=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],q=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,71,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],Ae=[5,6,7,9,13,15,17,18,19,20,23,25,26,27,30,33,34,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,82,83,84,85,86,87,88,89,90,91,92,93,94,95],Re=[5,70,72],$e=[5,74],et=[71,101],Ze={trace:function(){},yy:{},symbols_:{error:2,Program:3,Command:4,EOF:5,RESET:6,BUILD:7,ALL:8,HELP:9,Path:10,MOTM:11,OneArgCommand:12,GET:13,STRING:14,SET:15,Value:16,SET_SAVE:17,SET_RESTORE:18,SET_RESET:19,PRESET:20,AddRepresentation:21,EditRepresentation:22,REMOVE:23,RepresentationReference:24,HIDE:25,SHOW:26,LIST:27,EXPAND_KEY:28,SELECTOR_KEY:29,SELECT:30,AS:31,WordAll:32,SELECTOR:33,WITHIN:34,NUMBER:35,OF:36,MATERIAL:37,IDENTIFIER:38,ModeCMD:39,ColorCMD:40,VIEW:41,BASE_64:42,UNIT:43,DSSP:44,SCALE:45,ROTATE:46,AxesList:47,TRANSLATE:48,CENTER:49,GetURLBranch:50,Screenshot:51,LINE:52,ArgList:53,LISTOBJ:54,REMOVEOBJ:55,URL:56,VIEW_KEY:57,SCREENSHOT:58,LOAD:59,Url:60,FILE_KEY:61,ADD:62,Description:63,REP:64,MODE:65,COLOR:66,Descriptor:67,RepresentationOwnProperty:68,RepresentationOwnPropertyOpts:69,DESC_KEY:70,"=":71,DESC_KEY_OPTS:72,AxesArg:73,DESC_KEY_AXES:74,Arg:75,PathWoDescKey:76,HEX:77,BOOL:78,Word:79,CommandSetWoDESC_KEY:80,DescKeys:81,CLEAR:82,FILE_LIST:83,FILE_REGISTER:84,FILE_DELETE:85,PRESET_ADD:86,PRESET_DELETE:87,PRESET_UPDATE:88,PRESET_RENAME:89,PRESET_OPEN:90,CREATE_SCENARIO:91,RESET_SCENARIO:92,DELETE_SCENARIO:93,ADD_SCENARIO_ITEM:94,LIST_SCENARIO:95,PDB_KEY:96,DELAY_KEY:97,PRST_KEY:98,DESCRIPTION_KEY:99,CommandSet:100,".":101,PresetPath:102,"/":103,HexOrNumber:104,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"RESET",7:"BUILD",8:"ALL",9:"HELP",11:"MOTM",13:"GET",14:"STRING",15:"SET",17:"SET_SAVE",18:"SET_RESTORE",19:"SET_RESET",20:"PRESET",23:"REMOVE",25:"HIDE",26:"SHOW",27:"LIST",28:"EXPAND_KEY",29:"SELECTOR_KEY",30:"SELECT",31:"AS",33:"SELECTOR",34:"WITHIN",35:"NUMBER",36:"OF",37:"MATERIAL",38:"IDENTIFIER",41:"VIEW",42:"BASE_64",43:"UNIT",44:"DSSP",45:"SCALE",46:"ROTATE",48:"TRANSLATE",49:"CENTER",52:"LINE",54:"LISTOBJ",55:"REMOVEOBJ",56:"URL",57:"VIEW_KEY",58:"SCREENSHOT",59:"LOAD",61:"FILE_KEY",62:"ADD",64:"REP",65:"MODE",66:"COLOR",70:"DESC_KEY",71:"=",72:"DESC_KEY_OPTS",74:"DESC_KEY_AXES",77:"HEX",78:"BOOL",82:"CLEAR",83:"FILE_LIST",84:"FILE_REGISTER",85:"FILE_DELETE",86:"PRESET_ADD",87:"PRESET_DELETE",88:"PRESET_UPDATE",89:"PRESET_RENAME",90:"PRESET_OPEN",91:"CREATE_SCENARIO",92:"RESET_SCENARIO",93:"DELETE_SCENARIO",94:"ADD_SCENARIO_ITEM",95:"LIST_SCENARIO",96:"PDB_KEY",97:"DELAY_KEY",98:"PRST_KEY",99:"DESCRIPTION_KEY",101:".",103:"/"},productions_:[0,[3,2],[3,1],[4,1],[4,1],[4,2],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,2],[4,2],[4,1],[4,2],[4,2],[4,2],[4,4],[4,2],[4,6],[4,2],[4,1],[4,1],[4,1],[4,2],[4,2],[4,1],[4,2],[4,1],[4,2],[4,2],[4,2],[4,1],[4,2],[4,1],[4,1],[4,3],[4,3],[4,4],[4,4],[4,1],[4,2],[50,1],[50,2],[50,2],[50,3],[50,3],[51,1],[51,2],[51,3],[12,2],[12,2],[12,2],[21,1],[21,2],[21,2],[21,3],[22,2],[22,3],[39,2],[39,3],[40,2],[40,3],[24,1],[24,1],[63,1],[63,2],[63,3],[63,4],[67,1],[67,1],[67,2],[68,3],[69,3],[47,1],[47,2],[73,2],[53,1],[53,2],[75,3],[16,1],[16,1],[16,1],[16,1],[16,1],[79,1],[79,1],[32,1],[32,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[100,1],[100,1],[76,1],[76,3],[76,3],[10,1],[10,1],[10,3],[10,3],[10,3],[60,1],[102,1],[102,3],[104,1],[104,1]],performAction:function(Lt,Qe,ct,ie,Mt,le,Ot){var Se=le.length-1;switch(Mt){case 1:return le[Se-1];case 3:this.$=ie.miew.reset(!1),ie.ClearContext(),ie.miew.resetReps("empty");break;case 4:this.$=ie.miew.rebuild();break;case 5:this.$=ie.miew.rebuildAll(),ie.miew.rebuild();break;case 6:this.$=ie.echo(ie.utils.help().toString());break;case 7:this.$=ie.echo(ie.utils.help(le[Se]).toString());break;case 8:this.$=ie.miew.motm();break;case 10:case 11:this.$=ie.utils.propagateProp(le[Se]),ie.echo(ie.miew.get(le[Se]).toString());break;case 12:case 13:this.$=ie.miew.set(le[Se-1],ie.utils.propagateProp(le[Se-1],le[Se]));break;case 14:this.$=ie.miew.saveSettings();break;case 15:this.$=ie.miew.restoreSettings();break;case 16:this.$=ie.miew.resetSettings();break;case 17:this.$=ie.miew.resetReps();break;case 18:this.$=ie.miew.applyPreset(le[Se]);break;case 21:this.$=ie.miew.repRemove(le[Se]),ie.representations.remove(le[Se]);break;case 22:this.$=ie.miew.repHide(le[Se]);break;case 23:this.$=ie.miew.repHide(le[Se],!1);break;case 24:this.$=ie.echo(ie.utils.listRep(ie.miew,ie.representations,le[Se],"-e"));break;case 25:this.$=ie.echo(ie.utils.list(ie.miew,ie.representations));break;case 26:this.$=ie.echo(ie.utils.list(ie.miew,ie.representations,le[Se]));break;case 27:this.$=ie.echo(ie.utils.listSelector(ie.miew,ie.Context));break;case 28:this.$=ie.miew.select(ie.utils.checkArg(le[Se-1].toLowerCase(),le[Se],!0));break;case 29:this.$=ie.Context[le[Se].toLowerCase()]=ie.utils.checkArg(le[Se-3].toLowerCase(),le[Se-2],!0),ie.miew.select(ie.Context[le[Se].toLowerCase()]);break;case 30:this.$=ie.miew.rep(ie.miew.repCurrent(),{selector:ie.utils.checkArg(le[Se-1].toLowerCase(),le[Se])});break;case 31:this.$=ie.Context[le[Se].toLowerCase()]=ie.miew.within(ie.utils.checkArg("select",le[Se-2],!0),Number(le[Se-4]));break;case 32:this.$=ie.miew.rep(ie.miew.repCurrent(),{material:ie.utils.checkArg(le[Se-1].toLowerCase(),le[Se].toUpperCase())});break;case 35:this.$=ie.echo(ie.miew.view());break;case 36:case 37:this.$=ie.miew.view(le[Se]);break;case 38:this.$=ie.echo(ie.miew.changeUnit());break;case 39:this.$=ie.echo(ie.miew.changeUnit(le[Se]));break;case 40:this.$=ie.miew.dssp();break;case 41:this.$=ie.miew.scale(le[Se]);break;case 42:for(var Yt=0,rn=le[Se].length;Yt<rn;Yt++)ie.miew.rotate(le[Se][Yt].x*Math.PI/180,le[Se][Yt].y*Math.PI/180,le[Se][Yt].z*Math.PI/180);break;case 43:for(var Yt=0,rn=le[Se].length;Yt<rn;Yt++)ie.miew.translate(le[Se][Yt].x||0,le[Se][Yt].y||0,le[Se][Yt].z||0);break;case 44:this.$=ie.miew.center();break;case 45:this.$=ie.miew.center(le[Se]);break;case 48:case 49:this.$=ie.miew.addObject({type:"line",params:[le[Se-1],le[Se]]},!0);break;case 50:case 51:this.$=ie.miew.addObject({type:"line",params:[le[Se-2],le[Se-1]],opts:le[Se].toJSO(ie.utils,"objects","line")},!0);break;case 52:this.$=ie.echo(ie.utils.listObjs(ie.miew));break;case 53:this.$=ie.miew.removeObject(le[Se]);break;case 54:this.$=ie.echo(ie.miew.getURL({view:!1,settings:!1}));break;case 55:this.$=ie.echo(ie.miew.getURL({view:!1,settings:!0}));break;case 56:this.$=ie.echo(ie.miew.getURL({view:!0,settings:!1}));break;case 57:case 58:this.$=ie.echo(ie.miew.getURL({view:!0,settings:!0}));break;case 59:this.$=ie.miew.screenshotSave();break;case 60:this.$=ie.miew.screenshotSave("",Number(le[Se]));break;case 61:this.$=ie.miew.screenshotSave("",Number(le[Se-1]),Number(le[Se]));break;case 62:case 63:case 64:this.$=ie.utils.load(ie.miew,le[Se]),ie.representations.clear();break;case 65:this.$=ie.echo(ie.representations.add(ie.miew.repAdd()));break;case 66:this.$=ie.echo(ie.representations.add(le[Se],ie.miew.repAdd()));break;case 67:this.$=ie.echo(ie.representations.add(ie.miew.repAdd(le[Se])));break;case 68:this.$=ie.echo(ie.representations.add(le[Se-1],ie.miew.repAdd(le[Se])));break;case 69:this.$=ie.miew.rep(le[Se]),ie.miew.repCurrent(le[Se]);break;case 70:this.$=ie.miew.rep(le[Se-1],le[Se]),ie.miew.repCurrent(le[Se-1]);break;case 71:this.$=ie.miew.rep(ie.miew.repCurrent(),{mode:ie.utils.checkArg(le[Se-1].toLowerCase(),le[Se].toUpperCase())});break;case 72:this.$=ie.miew.rep(ie.miew.repCurrent(),{mode:new Array(ie.utils.checkArg(le[Se-2].toLowerCase(),le[Se-1].toUpperCase()),le[Se].toJSO(ie.utils,le[Se-2],le[Se-1].toUpperCase()))});break;case 73:this.$=ie.miew.rep(ie.miew.repCurrent(),{colorer:ie.utils.checkArg(le[Se-1].toLowerCase(),le[Se].toUpperCase())});break;case 74:this.$=ie.miew.rep(ie.miew.repCurrent(),{colorer:new Array(ie.utils.checkArg(le[Se-2].toLowerCase(),le[Se-1].toUpperCase()),le[Se].toJSO(ie.utils,le[Se-2],le[Se-1].toUpperCase()))});break;case 75:this.$=Number(ie.representations.get(le[Se]));break;case 76:case 92:this.$=Number(le[Se]);break;case 77:this.$=le[Se];break;case 78:this.$=ie.assign(le[Se-1],le[Se]);break;case 79:this.$=ie.assign(le[Se-2],le[Se-1],le[Se]);break;case 80:this.$=ie.assign(le[Se-3],le[Se-2],le[Se-1],le[Se]);break;case 81:case 82:this.$=ie.CreateObjectPair(le[Se].key,le[Se].val);break;case 83:this.$=ie.CreateObjectPair(le[Se-1].key,new Array(le[Se-1].val,le[Se].toJSO(ie.utils,le[Se-1].key,le[Se-1].val)));break;case 84:case 85:this.$=Object.create({key:ie.keyRemap(le[Se-2]),val:ie.utils.checkArg(le[Se-2],le[Se])});break;case 86:this.$=[le[Se]];break;case 87:this.$=le[Se-1].concat(le[Se]);break;case 88:this.$=ie.CreateObjectPair(le[Se-1].toLowerCase(),Number(le[Se]));break;case 89:this.$=new ie.ArgList(le[Se]);break;case 90:this.$=le[Se-1].append(le[Se]);break;case 91:this.$=new ie.Arg(le[Se-2],le[Se]);break;case 93:this.$=parseInt(le[Se]);break;case 94:this.$=JSON.parse(le[Se]);break;case 95:case 96:this.$=String(le[Se]);break;case 157:case 158:case 161:case 162:case 163:this.$=le[Se-2]+le[Se-1]+le[Se];break;case 166:this.$=le[Se-2]=le[Se-2]+le[Se-1]+le[Se];break}},table:[{3:1,4:2,5:[1,3],6:[1,4],7:[1,5],9:[1,6],11:[1,7],12:8,13:[1,9],15:[1,10],17:[1,11],18:[1,12],19:[1,13],20:[1,14],21:15,22:16,23:[1,17],25:[1,18],26:[1,19],27:[1,20],30:[1,21],33:[1,22],34:[1,23],37:[1,24],39:25,40:26,41:[1,27],43:[1,28],44:[1,29],45:[1,30],46:[1,31],48:[1,32],49:[1,33],50:34,51:35,52:[1,36],54:[1,37],55:[1,38],56:[1,44],58:[1,45],59:[1,39],62:[1,40],64:[1,41],65:[1,42],66:[1,43]},{1:[3]},{5:[1,46]},{1:[2,2]},{5:[2,3]},{5:[2,4],8:[1,47]},{5:[2,6],6:e,7:t,9:r,10:48,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,70:ee,72:re,74:he,79:49,80:52,81:50,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,96:we,97:Ee,98:z,99:F},{5:[2,8]},{5:[2,9]},{6:e,7:t,9:r,10:106,13:n,14:[1,107],15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,70:ee,72:re,74:he,79:49,80:52,81:50,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,96:we,97:Ee,98:z,99:F},{6:e,7:t,9:r,10:108,13:n,14:[1,109],15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,70:ee,72:re,74:he,79:49,80:52,81:50,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,96:we,97:Ee,98:z,99:F},{5:[2,14]},{5:[2,15]},{5:[2,16]},{5:[2,17],14:ue,16:110,35:be,38:Fe,77:He,78:rt},{5:[2,19]},{5:[2,20]},{24:116,35:Ke,38:je},{24:119,35:Ke,38:je},{24:120,35:Ke,38:je},{5:[2,25],24:121,28:[1,122],29:[1,123],35:Ke,38:je},{14:[1,124]},{14:[1,125]},{35:[1,126]},{38:[1,127]},{5:[2,33]},{5:[2,34]},{5:[2,35],14:[1,128],42:[1,129]},{5:[2,38],35:[1,130]},{5:[2,40]},{35:[1,131]},{47:132,73:133,74:Je},{47:135,73:133,74:Je},{5:[2,44],14:[1,136]},{5:[2,46]},{5:[2,47]},{6:e,7:t,9:r,10:138,13:n,14:[1,137],15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,70:ee,72:re,74:he,79:49,80:52,81:50,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,96:we,97:Ee,98:z,99:F},{5:[2,52]},{35:[1,139]},{14:[1,143],38:[1,141],60:140,61:[1,142]},{5:[2,65],38:[1,144],63:145,67:146,68:147,69:148,70:A,72:D},{24:151,35:Ke,38:je},{38:[1,152]},{38:[1,153]},{5:[2,54],29:[1,154],57:[1,155]},{5:[2,59],35:[1,156]},{1:[2,1]},{5:[2,5]},{5:[2,7],101:O},a(te,[2,159]),a(te,[2,160]),a(q,[2,97]),a(q,[2,98]),a(te,[2,147]),a(te,[2,148]),a(te,[2,149]),a(te,[2,150]),a(te,[2,151]),a(te,[2,152]),a(te,[2,153]),a(q,[2,101]),a(q,[2,102]),a(q,[2,103]),a(q,[2,104]),a(q,[2,105]),a(q,[2,106]),a(q,[2,107]),a(q,[2,108]),a(q,[2,109]),a(q,[2,110]),a(q,[2,111]),a(q,[2,112]),a(q,[2,113]),a(q,[2,114]),a(q,[2,115]),a(q,[2,116]),a(q,[2,117]),a(q,[2,118]),a(q,[2,119]),a(q,[2,120]),a(q,[2,121]),a(q,[2,122]),a(q,[2,123]),a(q,[2,124]),a(q,[2,125]),a(q,[2,126]),a(q,[2,127]),a(q,[2,128]),a(q,[2,129]),a(q,[2,130]),a(q,[2,131]),a(q,[2,132]),a(q,[2,133]),a(q,[2,134]),a(q,[2,135]),a(q,[2,136]),a(q,[2,137]),a(q,[2,138]),a(q,[2,139]),a(q,[2,140]),a(q,[2,141]),a(q,[2,142]),a(q,[2,143]),a(q,[2,144]),a(q,[2,145]),a(q,[2,146]),{5:[2,10],101:O},{5:[2,11]},{14:ue,16:158,35:be,38:Fe,77:He,78:rt,101:O},{14:ue,16:159,35:be,38:Fe,77:He,78:rt},{5:[2,18]},a(Ae,[2,92]),a(Ae,[2,93]),a(Ae,[2,94]),a(Ae,[2,95]),a(Ae,[2,96]),{5:[2,21]},a(Re,[2,75]),a(Re,[2,76]),{5:[2,22]},{5:[2,23]},{5:[2,24]},{5:[2,26]},{5:[2,27]},{5:[2,28],31:[1,160]},{5:[2,30]},{36:[1,161]},{5:[2,32]},{5:[2,36]},{5:[2,37]},{5:[2,39]},{5:[2,41]},{5:[2,42],73:162,74:Je},a($e,[2,86]),{35:[1,163]},{5:[2,43],73:162,74:Je},{5:[2,45]},{14:[1,164]},{6:e,7:t,9:r,10:165,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,70:ee,72:re,74:he,79:49,80:52,81:50,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,96:we,97:Ee,98:z,99:F,101:O},{5:[2,53]},{5:[2,62]},{5:[2,63]},{5:[2,64]},{5:[2,164]},{5:[2,66],63:166,67:146,68:147,69:148,70:A,72:D},{5:[2,67]},{5:[2,77],67:167,68:147,69:148,70:A,72:D},a(Re,[2,81]),a(Re,[2,82],{80:52,53:168,75:169,76:170,79:171,6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se}),{71:[1,172]},{71:[1,173]},{5:[2,69],63:174,67:146,68:147,69:148,70:A,72:D},{5:[2,71],6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,53:175,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,75:169,76:170,79:171,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se},{5:[2,73],6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,53:176,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,75:169,76:170,79:171,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se},{5:[2,55],57:[1,177]},{5:[2,56],29:[1,178]},{5:[2,60],35:[1,179]},{6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,35:[1,181],37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,70:ee,72:re,74:he,79:180,80:52,81:182,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,96:we,97:Ee,98:z,99:F},{5:[2,12]},{5:[2,13]},{6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,32:183,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,70:ee,72:re,74:he,79:184,80:52,81:185,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,96:we,97:Ee,98:z,99:F},{14:[1,186]},a($e,[2,87]),a($e,[2,88]),{5:[2,48],6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,53:187,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,75:169,76:170,79:171,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se},{5:[2,49],6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,53:188,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,75:169,76:170,79:171,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,101:O},{5:[2,68]},{5:[2,78],67:189,68:147,69:148,70:A,72:D},a(Re,[2,83],{80:52,76:170,79:171,75:190,6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se}),a(Ae,[2,89]),{71:[1,191],101:[1,192]},a(et,[2,156]),{14:ue,16:193,35:be,38:Fe,77:He,78:rt},{14:ue,16:194,35:be,38:Fe,77:He,78:rt},{5:[2,70]},{5:[2,72],6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,75:190,76:170,79:171,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se},{5:[2,74],6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,75:190,76:170,79:171,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se},{5:[2,57]},{5:[2,58]},{5:[2,61]},a(te,[2,161]),a(te,[2,162]),a(te,[2,163]),{5:[2,29]},{5:[2,99]},{5:[2,100]},{31:[1,195]},{5:[2,50],6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,75:190,76:170,79:171,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se},{5:[2,51],6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,75:190,76:170,79:171,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se},{5:[2,79],67:196,68:147,69:148,70:A,72:D},a(Ae,[2,90]),{14:ue,16:197,35:be,38:Fe,77:He,78:rt},{6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,33:y,34:S,35:[1,199],37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,79:198,80:52,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se},a(Re,[2,84]),a(Ae,[2,85]),{6:e,7:t,9:r,13:n,15:i,17:s,18:o,19:l,20:c,23:f,25:d,26:p,27:m,30:v,32:200,33:y,34:S,37:_,38:x,41:b,43:M,45:E,46:T,49:R,52:V,54:Y,55:$,56:W,58:j,59:X,62:P,64:N,65:I,66:G,70:ee,72:re,74:he,79:184,80:52,81:185,82:pe,83:Ie,84:De,85:Le,86:Oe,87:ne,88:at,89:Ge,90:We,91:Ve,92:Te,93:me,94:ge,95:se,96:we,97:Ee,98:z,99:F},{5:[2,80]},a(Ae,[2,91]),a(et,[2,157]),a(et,[2,158]),{5:[2,31]}],defaultActions:{3:[2,2],4:[2,3],7:[2,8],8:[2,9],11:[2,14],12:[2,15],13:[2,16],15:[2,19],16:[2,20],25:[2,33],26:[2,34],29:[2,40],34:[2,46],35:[2,47],37:[2,52],46:[2,1],47:[2,5],107:[2,11],110:[2,18],116:[2,21],119:[2,22],120:[2,23],121:[2,24],122:[2,26],123:[2,27],125:[2,30],127:[2,32],128:[2,36],129:[2,37],130:[2,39],131:[2,41],136:[2,45],139:[2,53],140:[2,62],141:[2,63],142:[2,64],143:[2,164],145:[2,67],158:[2,12],159:[2,13],166:[2,68],174:[2,70],177:[2,57],178:[2,58],179:[2,61],183:[2,29],184:[2,99],185:[2,100],196:[2,80],200:[2,31]},parseError:function(Lt,Qe){if(Qe.recoverable)this.trace(Lt);else{var ct=new Error(Lt);throw ct.hash=Qe,ct}},parse:function(Lt){var Qe=this,ct=[0],ie=[],Mt=[null],le=[],Ot=this.table,Se="",Yt=0,rn=0,mr=2,Zn=1,Vn=le.slice.call(arguments,1),U=Object.create(this.lexer),de={yy:{}};for(var ce in this.yy)Object.prototype.hasOwnProperty.call(this.yy,ce)&&(de.yy[ce]=this.yy[ce]);U.setInput(Lt,de.yy),de.yy.lexer=U,de.yy.parser=this,typeof U.yylloc>"u"&&(U.yylloc={});var _e=U.yylloc;le.push(_e);var Ye=U.options&&U.options.ranges;typeof de.yy.parseError=="function"?this.parseError=de.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function xt(){var Kt;return Kt=ie.pop()||U.lex()||Zn,typeof Kt!="number"&&(Kt instanceof Array&&(ie=Kt,Kt=ie.pop()),Kt=Qe.symbols_[Kt]||Kt),Kt}for(var ut,ot,dt,bt,vt={},Et,ft,Un,Ht;;){if(ot=ct[ct.length-1],this.defaultActions[ot]?dt=this.defaultActions[ot]:((ut===null||typeof ut>"u")&&(ut=xt()),dt=Ot[ot]&&Ot[ot][ut]),typeof dt>"u"||!dt.length||!dt[0]){var Gn="";Ht=[];for(Et in Ot[ot])this.terminals_[Et]&&Et>mr&&Ht.push("'"+this.terminals_[Et]+"'");U.showPosition?Gn="Parse error on line "+(Yt+1)+`:
`+U.showPosition()+`
Expecting `+Ht.join(", ")+", got '"+(this.terminals_[ut]||ut)+"'":Gn="Parse error on line "+(Yt+1)+": Unexpected "+(ut==Zn?"end of input":"'"+(this.terminals_[ut]||ut)+"'"),this.parseError(Gn,{text:U.match,token:this.terminals_[ut]||ut,line:U.yylineno,loc:_e,expected:Ht})}if(dt[0]instanceof Array&&dt.length>1)throw new Error("Parse Error: multiple actions possible at state: "+ot+", token: "+ut);switch(dt[0]){case 1:ct.push(ut),Mt.push(U.yytext),le.push(U.yylloc),ct.push(dt[1]),ut=null,rn=U.yyleng,Se=U.yytext,Yt=U.yylineno,_e=U.yylloc;break;case 2:if(ft=this.productions_[dt[1]][1],vt.$=Mt[Mt.length-ft],vt._$={first_line:le[le.length-(ft||1)].first_line,last_line:le[le.length-1].last_line,first_column:le[le.length-(ft||1)].first_column,last_column:le[le.length-1].last_column},Ye&&(vt._$.range=[le[le.length-(ft||1)].range[0],le[le.length-1].range[1]]),bt=this.performAction.apply(vt,[Se,rn,Yt,de.yy,dt[1],Mt,le].concat(Vn)),typeof bt<"u")return bt;ft&&(ct=ct.slice(0,-1*ft*2),Mt=Mt.slice(0,-1*ft),le=le.slice(0,-1*ft)),ct.push(this.productions_[dt[1]][0]),Mt.push(vt.$),le.push(vt._$),Un=Ot[ct[ct.length-2]][ct[ct.length-1]],ct.push(Un);break;case 3:return!0}}return!0}},yt=function(){var en={EOF:1,parseError:function(Qe,ct){if(this.yy.parser)this.yy.parser.parseError(Qe,ct);else throw new Error(Qe)},setInput:function(Qe,ct){return this.yy=ct||this.yy||{},this._input=Qe,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var Qe=this._input[0];this.yytext+=Qe,this.yyleng++,this.offset++,this.match+=Qe,this.matched+=Qe;var ct=Qe.match(/(?:\r\n?|\n).*/g);return ct?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),Qe},unput:function(Qe){var ct=Qe.length,ie=Qe.split(/(?:\r\n?|\n)/g);this._input=Qe+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-ct),this.offset-=ct;var Mt=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),ie.length-1&&(this.yylineno-=ie.length-1);var le=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:ie?(ie.length===Mt.length?this.yylloc.first_column:0)+Mt[Mt.length-ie.length].length-ie[0].length:this.yylloc.first_column-ct},this.options.ranges&&(this.yylloc.range=[le[0],le[0]+this.yyleng-ct]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(Qe){this.unput(this.match.slice(Qe))},pastInput:function(){var Qe=this.matched.substr(0,this.matched.length-this.match.length);return(Qe.length>20?"...":"")+Qe.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var Qe=this.match;return Qe.length<20&&(Qe+=this._input.substr(0,20-Qe.length)),(Qe.substr(0,20)+(Qe.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var Qe=this.pastInput(),ct=new Array(Qe.length+1).join("-");return Qe+this.upcomingInput()+`
`+ct+"^"},test_match:function(Qe,ct){var ie,Mt,le;if(this.options.backtrack_lexer&&(le={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(le.yylloc.range=this.yylloc.range.slice(0))),Mt=Qe[0].match(/(?:\r\n?|\n).*/g),Mt&&(this.yylineno+=Mt.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:Mt?Mt[Mt.length-1].length-Mt[Mt.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+Qe[0].length},this.yytext+=Qe[0],this.match+=Qe[0],this.matches=Qe,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(Qe[0].length),this.matched+=Qe[0],ie=this.performAction.call(this,this.yy,this,ct,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),ie)return ie;if(this._backtrack){for(var Ot in le)this[Ot]=le[Ot];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var Qe,ct,ie,Mt;this._more||(this.yytext="",this.match="");for(var le=this._currentRules(),Ot=0;Ot<le.length;Ot++)if(ie=this._input.match(this.rules[le[Ot]]),ie&&(!ct||ie[0].length>ct[0].length)){if(ct=ie,Mt=Ot,this.options.backtrack_lexer){if(Qe=this.test_match(ie,le[Ot]),Qe!==!1)return Qe;if(this._backtrack){ct=!1;continue}else return!1}else if(!this.options.flex)break}return ct?(Qe=this.test_match(ct,le[Mt]),Qe!==!1?Qe:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var Qe=this.next();return Qe||this.lex()},begin:function(Qe){this.conditionStack.push(Qe)},popState:function(){var Qe=this.conditionStack.length-1;return Qe>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(Qe){return Qe=this.conditionStack.length-1-Math.abs(Qe||0),Qe>=0?this.conditionStack[Qe]:"INITIAL"},pushState:function(Qe){this.begin(Qe)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(Qe,ct,ie,Mt){switch(ie){case 0:break;case 1:return"";case 2:return"";case 3:return 42;case 4:return 35;case 5:return 77;case 6:return 78;case 7:return 78;case 8:return 8;case 9:return 6;case 10:return 82;case 11:return 7;case 12:return 9;case 13:return 59;case 14:return 13;case 15:return 15;case 16:return 17;case 17:return 18;case 18:return 19;case 19:return 20;case 20:return 11;case 21:return 62;case 22:return 64;case 23:return 23;case 24:return 25;case 25:return 26;case 26:return 27;case 27:return 30;case 28:return 34;case 29:return 33;case 30:return 65;case 31:return 66;case 32:return 37;case 33:return 41;case 34:return 43;case 35:return 52;case 36:return 54;case 37:return 55;case 38:return 46;case 39:return 48;case 40:return 45;case 41:return 49;case 42:return 56;case 43:return 58;case 44:return 44;case 45:return 83;case 46:return 84;case 47:return 85;case 48:return 86;case 49:return 87;case 50:return 88;case 51:return 89;case 52:return 90;case 53:return 91;case 54:return 92;case 55:return 93;case 56:return 94;case 57:return 95;case 58:return 70;case 59:return 70;case 60:return 72;case 61:return 72;case 62:return 74;case 63:return 74;case 64:return 74;case 65:return 31;case 66:return 36;case 67:return 96;case 68:return 97;case 69:return 98;case 70:return 99;case 71:return ct.yytext=Qe.utils.unquoteString(ct.yytext),14;case 72:return 38;case 73:return 5;case 74:return 101;case 75:return 103;case 76:return"\\";case 77:return 28;case 78:return 61;case 79:return 29;case 80:return 57;case 81:return 71}},rules:[/^(?:\s+)/i,/^(?:[#].*)/i,/^(?:\/\/.*)/i,/^(?:([_A-Z0-9\/\+]+==))/i,/^(?:-?[0-9]+(\.[0-9]+)?\b)/i,/^(?:0[xX][0-9A-F]+\b)/i,/^(?:false\b)/i,/^(?:true\b)/i,/^(?:all\b)/i,/^(?:reset\b)/i,/^(?:clear\b)/i,/^(?:build\b)/i,/^(?:help\b)/i,/^(?:load\b)/i,/^(?:get\b)/i,/^(?:set\b)/i,/^(?:set_save\b)/i,/^(?:set_restore\b)/i,/^(?:set_reset\b)/i,/^(?:preset\b)/i,/^(?:motm\b)/i,/^(?:add\b)/i,/^(?:rep\b)/i,/^(?:remove\b)/i,/^(?:hide\b)/i,/^(?:show\b)/i,/^(?:list\b)/i,/^(?:select\b)/i,/^(?:within\b)/i,/^(?:selector\b)/i,/^(?:mode\b)/i,/^(?:color\b)/i,/^(?:material\b)/i,/^(?:view\b)/i,/^(?:unit\b)/i,/^(?:line\b)/i,/^(?:listobj\b)/i,/^(?:removeobj\b)/i,/^(?:rotate\b)/i,/^(?:translate\b)/i,/^(?:scale\b)/i,/^(?:center\b)/i,/^(?:url\b)/i,/^(?:screenshot\b)/i,/^(?:dssp\b)/i,/^(?:file_list\b)/i,/^(?:file_register\b)/i,/^(?:file_delete\b)/i,/^(?:preset_add\b)/i,/^(?:preset_delete\b)/i,/^(?:preset_update\b)/i,/^(?:preset_rename\b)/i,/^(?:preset_open\b)/i,/^(?:create_scenario\b)/i,/^(?:reset_scenario\b)/i,/^(?:delete_scenario\b)/i,/^(?:add_scenario_item\b)/i,/^(?:list_scenario\b)/i,/^(?:s\b)/i,/^(?:mt\b)/i,/^(?:m\b)/i,/^(?:c\b)/i,/^(?:x\b)/i,/^(?:y\b)/i,/^(?:z\b)/i,/^(?:as\b)/i,/^(?:of\b)/i,/^(?:pdb\b)/i,/^(?:delay\b)/i,/^(?:prst\b)/i,/^(?:desc\b)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:\.)/i,/^(?:\/)/i,/^(?:\\)/i,/^(?:-e\b)/i,/^(?:-f\b)/i,/^(?:-s\b)/i,/^(?:-v\b)/i,/^(?:=)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81],inclusive:!0}}};return en}();Ze.lexer=yt;function Xt(){this.yy={}}return Xt.prototype=Ze,Ze.Parser=Xt,new Xt}(),Xa={parser:YG},Sv={$help:["Rendering mode shortcut","    BS - balls and sticks mode","    LN - lines mode","    LC - licorice mode","    VW - van der waals mode","    TR - trace mode","    TU - tube mode","    CA - cartoon mode","    SA - isosurface mode","    QS - quick surface mode","    SE - solvent excluded mode","    TX - text mode"],BS:{$help:["   Balls and sticks","      aromrad = <number> #aromatic radius","      atom = <number>    #atom radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      space = <number>   #space value
`]},CA:{$help:["   Cartoon","      arrow = <number>   #arrow size","      depth = <number>   #depth of surface","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius","      tension = <number> #",`      width = <number>  #secondary width
`]},LN:{$help:["   Lines","      atom = <number>    #atom radius","      chunkarom = <number>","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      offsarom = <number>
`]},LC:{$help:["   Licorice","      aromrad = <number> #aromatic radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      space = <number>   #space value
`]},VW:{$help:["   Van der Waals",`      nothing
`]},TR:{$help:["   Trace",`      radius = <number>  #tube radius
`]},TU:{$help:["   Tube","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius",`      tension = <number> 
`]},SA:{$help:["   Surface",`      zClip = <bool> #clip z plane
`]},QS:{$help:["   Quick surface","      isoValue = <number>","      scale = <number>","      wireframe = <bool>",`      zClip = <bool> #clip z plane
`]},SE:{$help:["   Solvent excluded surface",`      zClip = <bool> #clip z plane
`]},TX:{$help:["   Text mode",'      template = <format string> string that can include "{{ id }}"',"          it will be replaced by value, id can be one of next:",`          serial, name, type, sequence, residue, chain, hetatm, water
`,'      horizontalAlign = <string> {"left", "right", "center"}','      verticalAlign = <string> {"top", "bottom", "middle"}',"      dx = <number> #offset along x","      dy = <number> #offset along y","      dz = <number> #offset along z","      fg = <string> #text color modificator","           could be keyword, named color or hex","      fg = <string> #back color modificator","           could be keyword, named color or hex","      showBg = <bool> #if set show background","           plate under text"]}},wv={$help:["Coloring mode shortcut","    EL - color by element","    CH - color by chain","    SQ - color by sequence","    RT - color by residue type","    SS - color by secondary structure","    UN - uniform"],UN:{$help:["Parameters of coloring modes customization","   Uniform",`      color = <number|color> #RGB->HEX->dec
`],color:{$help:Object.keys(Ho.get(fe.now.palette).namedColors).sort().join(`
`)}}},vw={$help:["Material shortcut","    DF - diffuse","    TR - transparent","    SF - soft plastic","    PL - glossy plastic","    ME - metal","    GL - glass"]},V1={$help:["Short (packed) representation description as a set of variables","    s=<EXPRESSION>","        selector property","    m=<MODE_ID>[!<PARAMETER>:<VALUE>[,...]]","        render mode property","    c=<COLORER_ID>[!<PARAMETER>:<VALUE>[,...]]","        color mode property","    mt=<MATERIAL_ID>","        material property"],s:{$help:"Selection expression string as it is in menu->representations->selection"},m:Sv,c:wv,mt:vw},U1={$help:["Parameters of rendering modes customization: modes","Parameters of colorer customization: colorers","Autobuild: autobuild = (<number>|<bool>)"],modes:Sv,colorers:wv},Wp={$help:["help (<cmd name>| <path to property>)","You can get detailed information about command options",`   using "help cmd.opt.opt.[...]"
`,"   you can use one line comments","   everything started from (#|//) will be skipped",`   Example: >build //some comment
`,"List of available commands:"],reset:{$help:["Reload current object, delete all representations","    Nothing will work until load new object"]},load:{$help:["load (<PDBID>|<URL>|-f [<*.NC FILE URL STRING>])","    Load new pdb object from selected source"],PDBID:{$help:"pdb id in remote molecule database"},URL:{$help:"url to source file"},f:{$help:["open file system dialog to fetch local file","optionally you can determine trajectory file","via URL for *.top model"]}},clear:{$help:"No args. Clear terminal"},add:{$help:["add [<REP_NAME>] [<DESCRIPTION>]","    Add new item to representation set with","    default or <DESCRIPTION> params"],REP_NAME:{$help:"Identifier string [_,a-z,A-Z,0-9] can not start from digit"},DESCRIPTION:V1},rep:{$help:["rep [<REP_NAME>|<REP_INDEX>] [<DESCRIPTION>]","    set current representation by name or index","    edit current representation by <DESCRIPTION>"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"},DESCRIPTION:V1},remove:{$help:["remove (<REP_NAME>|<REP_INDEX>)","Remove representation by name or index"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"}},selector:{$help:["selector <EXPRESSION>","   set selector from EXPRESSION to current representation"],EXPRESSION:{$help:"Selection expression string as it is in menu->representations->selection"}},mode:{$help:["mode <MODE_ID> [<PARAMETER>=<VALUE>...]","   set rendering mode and apply parameters to current representation"],MODE_ID:Sv},color:{$help:["color <COLORER_ID> [<PARAMETER>=<VALUE>...]","   set colorer and apply parameters to current representation"],COLORER_ID:wv},material:{$help:["material <MATERIAL_ID>","   set material to current representation"],MATERIAL_ID:vw},build:{$help:"build help str",add:{$help:"build.add",new:{$help:["add.new","add.new new line 1","add.new new line 2","add.new new line 3"]}},del:{$help:"build.del"}},list:{$help:["list [-e|-s|<REP_NAME>|<REP_INDEX>]","Print representations if no args print list of representations","    -e expand list and show all representations","    -s show all user-registered selectors","    <REP_NAME>|<REP_INDEX> show only current representation"]},hide:{$help:["hide (<REP_NAME>|<REP_INDEX>)","Hide representation referenced in args"]},show:{$help:["show (<REP_NAME>|<REP_INDEX>)","Show representation referenced in args"]},get:{$help:["get <PARAMETER>","Print <PARAMETER> value","    <PARAMETER> - path to option use get.PARAMETER to get more info"],PARAMETER:U1},set:{$help:["set <PARAMETER> <VALUE>","Set <PARAMETER> with <VALUE>","    <PARAMETER> - path to option use set.PARAMETER to get more info"],PARAMETER:U1},set_save:{$help:["set_save","Save current settings to cookie"]},set_restore:{$help:["set_restore","Load and apply settings from cookie"]},set_reset:{$help:["set_reset","Reset current settings to the defaults"]},preset:{$help:["preset [<PRESET>]","Reset current representation or set preset to <PRESET>"],PRESET:{$help:["default","wire","small","macro"]}},unit:{$help:["unit [<unit_id>]","Change current biological structure view. Zero <unit_id> value means asymmetric unit,","positive values set an assembly with corresponding number.","Being called with no parameters command prints current unit information."]},view:{$help:["view [<ENCODED_VIEW>]","Get current encoded view or set if ENCODED_VIEW placed as argument"],ENCODED_VIEW:{$help:["encoded view matrix string (binary code)"]}},rotate:{$help:["rotate (x|y|z) [<DEGREES>] [(x|y|z) [<DEGREES>]]...","Rotate scene"]},scale:{$help:["scale <SCALE>","Scale scene"]},select:{$help:["select <SELECTOR_STRING> [as <SELECTOR_NAME>]","Select atoms using selector defined in SELECTOR_STRING","    and if SELECTOR_NAME is defined register it in viewer","    you can use it later as a complex selector"]},within:{$help:["within <DISTANCE> of <SELECTOR_STRING> as <SELECTOR_NAME>","Build within named selector","    DISTANCE        <number>","    SELECTOR_STRING <string(selection language)>","    SELECTOR_NAME   <identifier>"]},url:{$help:["url [-s] [-v]","Report URL encoded scene","    if -s set that include settings in the URL","    if -v set that include view in the URL"]},screenshot:{$help:["screenshot [<WIDTH> [<HEIGHT>]]","Make a screenshot of the scene","    WIDTH  <number> in pixels","    HEIGHT <number> in pixels, equal to WIDTH by default"]},line:{$help:["line <first_atom_path> <second_atom_path> [<PARAMETER>=<VALUE>]","Draw dashed line between two specified atoms"]},removeobj:{$help:["removeobj <id>","Remove scene object by its index. Indices could be obtained by <listobj> command"]},listobj:{$help:["listobj","Display the list of all existing scene objects"]}},bv=dr.chem.selectors,$G=dr.modes,qG=dr.colorers,ZG=dr.materials,G1=dr.palettes,jG=dr.options,Af=dr.settings;function KG(){}var gw=function(){var a=new KG;return function(){return a}}(),JG=function(){function a(){K(this,a),this.representationMap={},this.representationID={}}return J(a,[{key:"get",value:function(t){return this.representationMap[t]||this.representationID[t]||"<no name>"}},{key:"add",value:function(t,r){if(t===-1)return"Can not create representation: there is no data";if(r!==void 0)if(!this.representationMap.hasOwnProperty(t))this.representationMap[t.toString()]=r,this.representationID[r]=t.toString();else return"This name has already existed, registered without name";return"Representation ".concat(t," successfully added")}},{key:"remove",value:function(t){t&&this.representationID.hasOwnProperty(t)&&(delete this.representationMap[this.representationID[t]],delete this.representationID[t]);var r=Object.keys(this.representationID).sort();for(var n in r)if(r.hasOwnProperty(n)){var i=r[n];i>t&&(this.representationID[i-1]=this.representationID[i],this.representationMap[this.representationID[i]]-=1,delete this.representationID[i])}}},{key:"clear",value:function(){this.representationMap={},this.representationID={}}}]),a}(),QG=new JG;function Xf(a){var e={s:"selector",m:"mode",c:"colorer",mt:"material",mode:"modes",color:"colorers",colorer:"colorers",select:"selector",material:"materials",selector:"selector"},t=e[a];return t===void 0?a:t}var e9=function(){function a(){K(this,a)}return J(a,[{key:"list",value:function(t,r,n){var i="";if(t&&r!==void 0&&(n===void 0||n==="-e"))for(var s=t.repCount(),o=0;o<s;o++)i+=this.listRep(t,r,o,n);return i}},{key:"listRep",value:function(t,r,n,i){var s="",o=t.repGet(n);if(!o)return kn.warn("Rep ".concat(n," does not exist!")),s;var l=n,c=r.get(l),f=o.mode,d=o.colorer,p=o.selectorString,m=o.materialPreset;return s+="#".concat(l," : ").concat(f.name).concat(c==="<no name>"?"":", ".concat(c),`
`),i!==void 0&&(s+='    selection : "'.concat(p,`"
`),s+="    mode      : (".concat(f.id,"), ").concat(f.name,`
`),s+="    colorer   : (".concat(d.id,"), ").concat(d.name,`
`),s+="    material  : (".concat(m.id,"), ").concat(m.name,`
`)),s}},{key:"listSelector",value:function(t,r){var n="";for(var i in r)r.hasOwnProperty(i)&&(n+="".concat(i,' : "').concat(r[i],`"
`));return n}},{key:"listObjs",value:function(t){var r=t._objects;if(!r||!Array.isArray(r)||r.length===0)return"There are no objects on the scene";for(var n=[],i=0,s=r.length;i<s;++i)n[i]="".concat(i,": ").concat(r[i].toString());return n.join(`
`)}},{key:"joinHelpStr",value:function(t){return t instanceof Array?t.join(`
`):t}},{key:"help",value:function(t){if(xe.isUndefined(t))return"".concat(this.joinHelpStr(Wp.$help),`
`).concat(xe.slice(xe.sortBy(xe.keys(Wp)),1).join(", "),`
`);var r=xe.get(Wp,t);return xe.isUndefined(r)?this.help():"".concat(this.joinHelpStr(r.$help),`
`)}},{key:"load",value:function(t,r){if(!(t===void 0||r===void 0||r==="-f")){t.awaitWhileCMDisInProcess();var n=function(){return t.finishAwaitingCMDInProcess()};t.load(r).then(n,n)}}},{key:"checkArg",value:function(t,r,n){if(t!==void 0&&r!==void 0){if(Xf(t)==="selector"){var i=bv.parse(r);if(i.error!==void 0){var s={message:i.error};throw s}return n!==void 0&&n?i.selector:r}for(var o={colorers:qG,modes:$G,materials:ZG},l=t,c;l!==c;)c=l,l=Xf(c);if(o[l].get(r)===void 0){var f={message:"".concat(r," is not existed in ").concat(l)};throw f}return r}return gw}},{key:"propagateProp",value:function(t,r){if(t!==void 0){var n={},i=jG.adapters[Di(xe.get(Af.defaults,t))];if(i===void 0){var s={message:"".concat(t," is not existed")};throw s}if((t.endsWith(".color")||t.endsWith(".baseColor")||t.endsWith(".EL.carbon"))&&typeof r!="number"&&(r=G1.get(Af.now.palette).getNamedColor(r)),t.endsWith(".fg")||t.endsWith(".bg"))if(typeof r!="number"){var o=G1.get(Af.now.palette).getNamedColor(r,!0);o!==void 0&&(r="0x".concat(o.toString(16)))}else r="0x".concat(r.toString(16));if(t.endsWith(".template")&&(r=r.replace(/\\n/g,`
`)),r!==void 0&&i(r)!==r&&i(r)!==r>0)throw n={message:"".concat(t,' must be a "').concat(Di(xe.get(Af.defaults,t)),'"')},n}return r}},{key:"unquoteString",value:function(t){return ke.unquoteString(t)}}]),a}(),t9=new e9;function n9(a,e){var t={};return t[a]=e,t}function _h(a){if(a instanceof this.constructor)return a;a instanceof Array?this._values=a.slice(0):a?this._values=[a]:this._values=[]}_h.prototype.append=function(a){var e=this._values;return e[e.length]=a,this};_h.prototype.remove=function(a){var e=this._values,t=e.indexOf(a);return t>=0&&e.splice(t,1),this};_h.prototype.toJSO=function(a,e,t){for(var r={},n=this._values,i=0,s=n.length;i<s;++i)xe.set(r,n[i].id,a.propagateProp("".concat(Xf(e),".").concat(t,".").concat(n[i].id),n[i].val));return r};function r9(a,e){this.id=a,this.val=e}var Ir=Object.create({});Ir.Arg=r9;Ir.ArgList=_h;Ir.miew=null;Ir.echo=null;Ir.representations=QG;Ir.utils=t9;Ir.assign=xe.assign;Ir.CreateObjectPair=n9;Ir.keyRemap=Xf;Ir.Context=bv.Context;Ir.ClearContext=bv.ClearContext;Ir.NULL=gw;Ir.notimplemented=function(){return this.NULL};dr.prototype.script=function(a,e,t){Xa.parser.yy.miew=this,Xa.parser.yy.echo=e,Xa.parser.yy.error=t,this.cmdQueue===void 0&&(this.cmdQueue=[]),this.commandInAction===void 0&&(this.commandInAction=!1),this.cmdQueue=this.cmdQueue.concat(a.split(`
`))};dr.prototype.awaitWhileCMDisInProcess=function(){this.commandInAction=!0};dr.prototype.finishAwaitingCMDInProcess=function(){this.commandInAction=!1};dr.prototype.isScriptingCommandAvailable=function(){return this.commandInAction!==void 0&&!this.commandInAction&&this.cmdQueue!==void 0&&this.cmdQueue.length>0};dr.prototype.callNextCmd=function(){if(this.isScriptingCommandAvailable()){var a=this.cmdQueue.shift(),e={};e.success=!1;try{Xa.parser.parse(a),e.success=!0}catch(t){e.error=t.message,Xa.parser.yy.error(e.error),this.finishAwaitingCMDInProcess()}return e}return""};Xa.parser.yy=Ir;Xa.parser.yy.parseError=Xa.parser.parseError;const i9={class:"container-3d"},a9={class:"info"},s9={key:0},o9=wT({__name:"MolRender3D",props:{data3D:{},data3DFormat:{},molName:{}},setup(a){const e=a,t=Rd(null),r=Rd(null),n=Rd(!1);let i=null,s=null;const o=Z_(()=>!!e.data3D),l=Z_(()=>e.data3DFormat=="sdf");bT(()=>{o.value&&c()}),MT(()=>o.value,c),ET(()=>{i&&(i.term(),i=null)});function c(){if(t.value){if(!o.value){i.term(),i=null,t.value.innerHTML="";return}d()}}async function f(p){n.value=p,p&&(await IT(),d(!0))}function d(p=!1){let m;if(p&&!s||!p&&!i){const v=p?r.value:t.value;m=new dr({container:v,settings:{axes:!1,fps:!1,camDistance:l.value?3:2,resolution:"high",zooming:p,bg:{color:16053492}}}),m.init()&&(m.enableHotKeys(p),m.run()),e.data3DFormat=="sdf"?m.load(e.data3D,{sourceType:"immediate",fileType:"sdf"}):e.data3DFormat=="pdb"?m.load(e.data3D,{sourceType:"immediate",fileType:"pdb"}):e.data3DFormat=="cif"&&m.load(e.data3D,{sourceType:"immediate",fileType:"cif"}),p?s=m:i=m}}return(p,m)=>(j_(),K_(PT,null,[bl("div",i9,[J_(Q_,{icon:"icn-full-screen-large",iconHover:"icn-full-screen-large-hover",icnSize:"large",btnStyle:"soft",onClick:m[0]||(m[0]=v=>f(!0))}),bl("div",{class:"viewer",ref_key:"$container3d",ref:t},null,512)]),bl("div",{id:"container-3d-fs",class:LT(["container-3d",{show:n.value}])},[J_(Q_,{icon:"icn-close",btnStyle:"soft",icnSize:"large",onClick:m[1]||(m[1]=v=>f(!1))}),bl("div",a9,[p.molName?(j_(),K_("h4",s9,CT(AT(TT)(p.molName)),1)):RT("",!0)]),bl("div",{class:"viewer",ref_key:"$container3dFs",ref:r},null,512)],2)],64))}}),d9=NT(o9,[["__scopeId","data-v-bb26b776"]]);export{d9 as M};
